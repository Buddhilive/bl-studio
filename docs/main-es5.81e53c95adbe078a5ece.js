function _objectDestructuringEmpty(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)})(e)}function _construct(e,t,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(a,n.prototype),a}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,a=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function asyncGeneratorStep(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){asyncGeneratorStep(i,r,a,o,s,"next",e)}function s(e){asyncGeneratorStep(i,r,a,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass2(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _slicedToArray2(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){a=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}/*! For license information please see main-es2015.81e53c95adbe078a5ece.js.LICENSE.txt */(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"/TJp":function(e,t){e.exports=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){a=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}}},0:function(e,t,n){e.exports=n("zUnb")},1:function(e,t){},"1PgL":function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"8tAB":function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},B9Yq:function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},BIA0:function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},BNHZ:function(e,t,n){!function(e,t,n,r){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=a(t),o=a(n),s=a(r),u=function(e,t,n){return{endTime:t,insertTime:n,type:"exponentialRampToValue",value:e}},c=function(e,t,n){return{endTime:t,insertTime:n,type:"linearRampToValue",value:e}},l=function(e,t){return{startTime:t,type:"setValue",value:e}},h=function(e,t,n){return{duration:n,startTime:t,type:"setValueCurve",values:e}},f=function(e,t,n){var r=n.target;return r+(t-r)*Math.exp((n.startTime-e)/n.timeConstant)},d=function(e){return"exponentialRampToValue"===e.type},p=function(e){return"linearRampToValue"===e.type},m=function(e){return d(e)||p(e)},v=function(e){return"setValue"===e.type},g=function(e){return"setValueCurve"===e.type},y=function e(t,n,r,a){var i=t[n];return void 0===i?a:m(i)||v(i)?i.value:g(i)?i.values[i.values.length-1]:f(r,e(t,n-1,i.startTime,a),i)},_=function(e,t,n,r,a){return void 0===n?[r.insertTime,a]:m(n)?[n.endTime,n.value]:v(n)?[n.startTime,n.value]:g(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,y(e,t-1,n.startTime,a)]},b=function(e){return"cancelAndHold"===e.type},k=function(e){return"cancelScheduledValues"===e.type},w=function(e){return b(e)||k(e)?e.cancelTime:d(e)||p(e)?e.endTime:e.startTime},x=function(e,t,n,r){var a=r.value;return n===a?a:0<n&&0<a||n<0&&a<0?n*Math.pow(a/n,(e-t)/(r.endTime-t)):0},C=function(e,t,n,r){return n+(e-t)/(r.endTime-t)*(r.value-n)},S=function(e){return"setTarget"===e.type};e.AutomationEventList=function(){function e(t){o.default(this,e),this._automationEvents=[],this._currenTime=0,this._defaultValue=t}return s.default(e,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(e){var t=w(e);if(b(e)||k(e)){var n=this._automationEvents.findIndex((function(n){return k(e)&&g(n)?n.startTime+n.duration>=t:w(n)>=t})),r=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),b(e)){var a=this._automationEvents[this._automationEvents.length-1];if(void 0!==r&&m(r)){if(S(a))throw new Error("The internal list is malformed.");var i=g(a)?a.startTime+a.duration:w(a),o=g(a)?a.values[a.values.length-1]:a.value,s=d(r)?x(t,i,o,r):C(t,i,o,r),f=d(r)?u(s,t,this._currenTime):c(s,t,this._currenTime);this._automationEvents.push(f)}void 0!==a&&S(a)&&this._automationEvents.push(l(this.getValue(t),t)),void 0!==a&&g(a)&&a.startTime+a.duration>t&&(this._automationEvents[this._automationEvents.length-1]=h(new Float32Array([6,7]),a.startTime,t-a.startTime))}}else{var v=this._automationEvents.findIndex((function(e){return w(e)>t})),y=-1===v?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[v-1];if(void 0!==y&&g(y)&&w(y)+y.duration>t)return!1;var _=d(e)?u(e.value,e.endTime,this._currenTime):p(e)?c(e.value,t,this._currenTime):e;if(-1===v)this._automationEvents.push(_);else{if(g(e)&&t+e.duration>w(this._automationEvents[v]))return!1;this._automationEvents.splice(v,0,_)}}return!0}},{key:"flush",value:function(e){var t=this._automationEvents.findIndex((function(t){return w(t)>e}));if(t>1){var n=this._automationEvents.slice(t-1),r=n[0];S(r)&&n.unshift(l(y(this._automationEvents,t-2,r.startTime,this._defaultValue),r.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(e){if(0===this._automationEvents.length)return this._defaultValue;var t=this._automationEvents[this._automationEvents.length-1],n=this._automationEvents.findIndex((function(t){return w(t)>e})),r=this._automationEvents[n],a=w(t)<=e?t:this._automationEvents[n-1];if(void 0!==a&&S(a)&&(void 0===r||!m(r)||r.insertTime>e))return f(e,y(this._automationEvents,n-2,a.startTime,this._defaultValue),a);if(void 0!==a&&v(a)&&(void 0===r||!m(r)))return a.value;if(void 0!==a&&g(a)&&(void 0===r||!m(r)||a.startTime+a.duration>e))return e<a.startTime+a.duration?function(e,t){var n=t.values;return function(e,t){var n=Math.floor(t),r=Math.ceil(t);return n===r?e[n]:(1-(t-n))*e[n]+(1-(r-t))*e[r]}(n,(e-t.startTime)/t.duration*(n.length-1))}(e,a):a.values[a.values.length-1];if(void 0!==a&&m(a)&&(void 0===r||!m(r)))return a.value;if(void 0!==r&&d(r)){var o=_(this._automationEvents,n-1,a,r,this._defaultValue),s=i.default(o,2);return x(e,s[0],s[1],r)}if(void 0!==r&&p(r)){var u=_(this._automationEvents,n-1,a,r,this._defaultValue),c=i.default(u,2);return C(e,c[0],c[1],r)}return this._defaultValue}}]),e}(),e.createCancelAndHoldAutomationEvent=function(e){return{cancelTime:e,type:"cancelAndHold"}},e.createCancelScheduledValuesAutomationEvent=function(e){return{cancelTime:e,type:"cancelScheduledValues"}},e.createExponentialRampToValueAutomationEvent=function(e,t){return{endTime:t,type:"exponentialRampToValue",value:e}},e.createLinearRampToValueAutomationEvent=function(e,t){return{endTime:t,type:"linearRampToValue",value:e}},e.createSetTargetAutomationEvent=function(e,t,n){return{startTime:t,target:e,timeConstant:n,type:"setTarget"}},e.createSetValueAutomationEvent=l,e.createSetValueCurveAutomationEvent=h,Object.defineProperty(e,"__esModule",{value:!0})}(t,n("SNoo"),n("BIA0"),n("NN06"))},EhIR:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},Eq7A:function(e,t,n){var r=n("8tAB");e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}},HeOh:function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},NN06:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},PDX0:function(e,t){(function(t){e.exports=t}).call(this,{})},SNoo:function(e,t,n){var r=n("HeOh"),a=n("/TJp"),i=n("Eq7A"),o=n("1PgL");e.exports=function(e,t){return r(e)||a(e,t)||i(e,t)||o()}},XlTo:function(e,t,n){"use strict";var r=regeneratorRuntime.mark(is),a=regeneratorRuntime.mark(os),i=regeneratorRuntime.mark(ss),o=regeneratorRuntime.mark(cs),s=regeneratorRuntime.mark(ls),u=regeneratorRuntime.mark(hs),c=regeneratorRuntime.mark(fs),l=regeneratorRuntime.mark(ds);n.r(t);var h={};n.r(h),n.d(h,"assert",(function(){return Qr})),n.d(h,"assertRange",(function(){return Yr})),n.d(h,"assertContextRunning",(function(){return Zr})),n.d(h,"setLogger",(function(){return $r})),n.d(h,"log",(function(){return ea})),n.d(h,"warn",(function(){return ta}));var f={};n.r(f);var d=n("BNHZ"),p=new WeakSet,m=new WeakMap,v=new WeakMap,g=new WeakMap,y=new WeakMap,_=new WeakMap,b=new WeakMap,k=new WeakMap,w=new WeakMap,x=new WeakMap,C={construct:function(){return C}},S=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,T=function(e,t){for(var n=[],r=e.replace(/^[\s]+/,""),a=r.match(S);null!==a;){var i=a[1].slice(1,-1),o=a[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,t).toString());n.push(o),a=(r=r.slice(a[0].length).replace(/^[\s]+/,"")).match(S)}return[n.join(";"),r]},A=function(e){if(void 0!==e&&!Array.isArray(e))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},E=function(e){if(!function(e){try{new new Proxy(e,C)}catch(t){return!1}return!0}(e))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===e.prototype||"object"!=typeof e.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},I=function(e,t){var n=e.get(t);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},R=function(e,t){var n=Array.from(e).filter(t);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");var r=_slicedToArray2(n,1)[0];return e.delete(r),r},O=function(e,t,n,r){var a=I(e,t),i=R(a,(function(e){return e[0]===n&&e[1]===r}));return 0===a.size&&e.delete(t),i},N=function(e){return I(b,e)},D=function(e){if(p.has(e))throw new Error("The AudioNode is already stored.");p.add(e),N(e).forEach((function(e){return e(!0)}))},P=function(e){return"port"in e},F=function(e){if(!p.has(e))throw new Error("The AudioNode is not stored.");p.delete(e),N(e).forEach((function(e){return e(!1)}))},M=function(e,t){!P(e)&&t.every((function(e){return 0===e.size}))&&F(e)},L={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},z=function(e,t){return e.context===t},B=function(e){try{e.copyToChannel(new Float32Array(1),0,-1)}catch(t){return!1}return!0},j=function(){return new DOMException("","IndexSizeError")},V=function(e){var t;e.getChannelData=(t=e.getChannelData,function(n){try{return t.call(e,n)}catch(r){if(12===r.code)throw j();throw r}})},q={numberOfChannels:1},U=function(e){return p.has(e)},W={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},G=function(e){return I(m,e)},H=function(e){return I(g,e)},K=function(e){!function e(t,n){G(t).activeInputs.forEach((function(r){return r.forEach((function(r){var a=_slicedToArray2(r,1)[0];n.includes(t)||e(a,[].concat(_toConsumableArray(n),[t]))}))}));var r,a=_createForOfIteratorHelper(function(e){return"playbackRate"in e}(t)?[t.playbackRate]:P(t)?Array.from(t.parameters.values()):function(e){return"frequency"in e&&"gain"in e}(t)?[t.Q,t.detune,t.frequency,t.gain]:function(e){return"offset"in e}(t)?[t.offset]:function(e){return!("frequency"in e)&&"gain"in e}(t)?[t.gain]:function(e){return"detune"in e&&"frequency"in e}(t)?[t.detune,t.frequency]:function(e){return"pan"in e}(t)?[t.pan]:[]);try{for(a.s();!(r=a.n()).done;){var i=r.value,o=H(i);void 0!==o&&o.activeInputs.forEach((function(t){var r=_slicedToArray2(t,1)[0];return e(r,n)}))}}catch(s){a.e(s)}finally{a.f()}U(t)&&F(t)}(e.destination,[])},X=function(e){return"context"in e},Q=function(e){return X(e[0])},Y=function(e,t,n,r){var a,i=_createForOfIteratorHelper(e);try{for(i.s();!(a=i.n()).done;){if(n(a.value)){if(r)return!1;throw Error("The set contains at least one similar element.")}}}catch(o){i.e(o)}finally{i.f()}return e.add(t),!0},Z=function(e,t,n,r){var a=_slicedToArray2(n,2),i=a[0],o=a[1];Y(e,[t,i,o],(function(e){return e[0]===t&&e[1]===i}),r)},J=function(e,t,n){var r=_slicedToArray2(t,3),a=r[0],i=r[1],o=r[2],s=e.get(a);void 0===s?e.set(a,new Set([[i,o]])):Y(s,[i,o],(function(e){return e[0]===i}),n)},$=function(e){return"inputs"in e},ee=function(e,t,n,r){if($(t)){var a=t.inputs[r];return e.connect(a,n,0),[a,n,0]}return e.connect(t,n,r),[t,n,r]},te=function(e,t,n){var r,a=_createForOfIteratorHelper(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i[0]===t&&i[1]===n)return e.delete(i),i}}catch(o){a.e(o)}finally{a.f()}return null},ne=function(e,t){if(!N(e).delete(t))throw new Error("Missing the expected event listener.")},re=function(e,t,n){var r=I(e,t),a=R(r,(function(e){return e[0]===n}));return 0===r.size&&e.delete(t),a},ae=function(e,t,n,r){$(t)?e.disconnect(t.inputs[r],n,0):e.disconnect(t,n,r)},ie=function(e){return I(v,e)},oe=function(e){return I(y,e)},se=function(e){return k.has(e)},ue=function(e){return!p.has(e)},ce=function(e){return new Promise((function(t){var n=e.createScriptProcessor(256,1,1),r=e.createGain(),a=e.createBuffer(1,2,44100),i=a.getChannelData(0);i[0]=1,i[1]=1;var o=e.createBufferSource();o.buffer=a,o.loop=!0,o.connect(n).connect(e.destination),o.connect(r),o.disconnect(r),n.onaudioprocess=function(r){var a=r.inputBuffer.getChannelData(0);Array.prototype.some.call(a,(function(e){return 1===e}))?t(!0):t(!1),o.stop(),n.onaudioprocess=null,o.disconnect(n),n.disconnect(e.destination)},o.start()}))},le=function(e,t){var n,r=new Map,a=_createForOfIteratorHelper(e);try{for(a.s();!(n=a.n()).done;){var i,o=_createForOfIteratorHelper(n.value);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=r.get(s);r.set(s,void 0===u?1:u+1)}}catch(c){o.e(c)}finally{o.f()}}}catch(c){a.e(c)}finally{a.f()}r.forEach((function(e,n){return t(n,e)}))},he=function(e){return"context"in e},fe=function(e,t,n,r,a){var i=_slicedToArray2(function(e,t,n,r){var a=G(t),i=a.activeInputs,o=a.passiveInputs,s=te(i[r],e,n);return null===s?[O(o,e,n,r)[2],!1]:[s[2],!0]}(e,n,r,a),2),o=i[0],s=i[1];if(null!==o&&(ne(e,o),!s||t||se(e)||ae(ie(e),ie(n),r,a)),U(n)){var u=G(n).activeInputs;M(n,u)}},de=function(e,t,n,r){var a=_slicedToArray2(function(e,t,n){var r=H(t),a=r.activeInputs,i=r.passiveInputs,o=te(a,e,n);return null===o?[re(i,e,n)[1],!1]:[o[2],!0]}(e,n,r),2),i=a[0],o=a[1];null!==i&&(ne(e,i),!o||t||se(e)||ie(e).disconnect(oe(n),r))},pe=function(){function e(t){_classCallCheck2(this,e),this._map=new Map(t)}return _createClass2(e,[{key:"entries",value:function(){return this._map.entries()}},{key:"forEach",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._map.forEach((function(r,a){return e.call(n,r,a,t)}))}},{key:"get",value:function(e){return this._map.get(e)}},{key:"has",value:function(e){return this._map.has(e)}},{key:"keys",value:function(){return this._map.keys()}},{key:"values",value:function(){return this._map.values()}},{key:"size",get:function(){return this._map.size}}]),e}(),me={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function ve(e,t,n,r,a){if("function"==typeof e.copyFromChannel)0===t[n].byteLength&&(t[n]=new Float32Array(128)),e.copyFromChannel(t[n],r,a);else{var i=e.getChannelData(r);if(0===t[n].byteLength)t[n]=i.slice(a,a+128);else{var o=new Float32Array(i.buffer,a*Float32Array.BYTES_PER_ELEMENT,128);t[n].set(o)}}}var ge=function(e,t,n,r,a){"function"==typeof e.copyToChannel?0!==t[n].byteLength&&e.copyToChannel(t[n],r,a):0!==t[n].byteLength&&e.getChannelData(r).set(t[n],a)},ye=function(e,t){for(var n=[],r=0;r<e;r+=1){for(var a=[],i="number"==typeof t?t:t[r],o=0;o<i;o+=1)a.push(new Float32Array(128));n.push(a)}return n},_e={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},be={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},ke={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},we={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},xe={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},Ce={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Se=function(e,t,n){var r=t[n];if(void 0===r)throw e();return r},Te={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Ae={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},Ee=function(){return new DOMException("","InvalidStateError")},Ie=function(){return new DOMException("","InvalidAccessError")},Re={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Oe=function(e,t,n,r,a,i,o,s,u,c,l){for(var h=c.length,f=s,d=0;d<h;d+=1){for(var p=n[0]*c[d],m=1;m<a;m+=1){var v=f-m&u-1;p+=n[m]*i[v],p-=e[m]*o[v]}for(var g=a;g<r;g+=1)p+=n[g]*i[f-g&u-1];for(var y=a;y<t;y+=1)p-=e[y]*o[f-y&u-1];i[f]=c[d],o[f]=p,f=f+1&u-1,l[d]=p}return f},Ne={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},De=function(e){var t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{var n=e.decodeAudioData(t.buffer,(function(){}));return void 0!==n&&(n.catch((function(){})),!0)}catch(r){}return!1},Pe=function(e,t,n){var r=t[n];void 0!==r&&r!==e[n]&&(e[n]=r)},Fe=function(e,t){Pe(e,t,"channelCount"),Pe(e,t,"channelCountMode"),Pe(e,t,"channelInterpretation")},Me=function(e){return"function"==typeof e.getFloatTimeDomainData},Le=function(e,t,n){var r=t[n];void 0!==r&&r!==e[n].value&&(e[n].value=r)},ze=function(e){var t;e.start=(t=e.start,function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;if("number"==typeof a&&a<0||r<0||n<0)throw new RangeError("The parameters can't be negative.");t.call(e,n,r,a)})},Be=function(e){var t;e.stop=(t=e.stop,function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(n<0)throw new RangeError("The parameter can't be negative.");t.call(e,n)})},je=function(e,t){return null===e?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(e*t)))))},Ve=function(e,t){var n=e.createBiquadFilter();return Fe(n,t),Le(n,t,"Q"),Le(n,t,"detune"),Le(n,t,"frequency"),Le(n,t,"gain"),Pe(n,t,"type"),n},qe=function(e,t){var n,r,a=e.createChannelSplitter(t.numberOfOutputs);return Fe(a,t),r=(n=a).numberOfOutputs,Object.defineProperty(n,"channelCount",{get:function(){return r},set:function(e){if(e!==r)throw Ee()}}),Object.defineProperty(n,"channelCountMode",{get:function(){return"explicit"},set:function(e){if("explicit"!==e)throw Ee()}}),Object.defineProperty(n,"channelInterpretation",{get:function(){return"discrete"},set:function(e){if("discrete"!==e)throw Ee()}}),a},Ue=function(e,t){return e.connect=t.connect.bind(t),e.disconnect=t.disconnect.bind(t),e},We=function(e,t){var n=e.createDelay(t.maxDelayTime);return Fe(n,t),Le(n,t,"delayTime"),n},Ge=function(e,t){var n=e.createGain();return Fe(n,t),Le(n,t,"gain"),n};function He(e,t){for(var n,r,a=[0,0],i=e.length-1;i>=0;i-=1)(a=[(n=a)[0]*(r=t)[0]-n[1]*r[1],n[0]*r[1]+n[1]*r[0]])[0]+=e[i];return a}var Ke,Xe,Qe,Ye,Ze,Je,$e,et,tt,nt,rt,at,it,ot,st,ut,ct,lt,ht,ft,dt,pt,mt,vt,gt,yt,_t,bt,kt,wt,xt,Ct,St,Tt,At,Et,It,Rt,Ot=function(e,t,n,r){return e.createScriptProcessor(t,n,r)},Nt=function(){return new DOMException("","NotSupportedError")},Dt={numberOfChannels:1},Pt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Ft={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Mt={disableNormalization:!1},Lt={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},zt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Bt=function(e){if(null===e)return!1;var t=e.length;return t%2!=0?0!==e[Math.floor(t/2)]:e[t/2-1]+e[t/2]!==0},jt=function(e,t,n,r){for(var a=Object.getPrototypeOf(e);!a.hasOwnProperty(t);)a=Object.getPrototypeOf(a);var i=Object.getOwnPropertyDescriptor(a,t),o=i.get,s=i.set;Object.defineProperty(e,t,{get:n(o),set:r(s)})},Vt=function(e){var t=e.createOscillator();try{t.start(-1)}catch(n){return n instanceof RangeError}return!1},qt=function(e){var t=e.createBuffer(1,1,44100),n=e.createBufferSource();n.buffer=t,n.start(),n.stop();try{return n.stop(),!0}catch(r){return!1}},Ut=function(e){var t=e.createOscillator();try{t.stop(-1)}catch(n){return n instanceof RangeError}return!1},Wt=function(){try{new DOMException}catch(e){return!1}return!0},Gt=function(){return new Promise((function(e){var t=new ArrayBuffer(0),n=new MessageChannel,r=n.port1,a=n.port2;r.onmessage=function(t){var n=t.data;return e(null!==n)},a.postMessage(t,[t])}))},Ht=function(e,t){var n=t.createGain();e.connect(n);var r,a,i,o=(r=e.disconnect,function(){r.call(e,n),e.removeEventListener("ended",o)});e.addEventListener("ended",o),Ue(e,n),e.stop=(a=e.stop,i=!1,function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(i)try{a.call(e,t)}catch(r){n.gain.setValueAtTime(0,t)}else a.call(e,t),i=!0})},Kt=function(e,t){return function(n){var r={value:e};return Object.defineProperties(n,{currentTarget:r,target:r}),"function"==typeof t?t.call(e,n):t.handleEvent.call(e,n)}},Xt=(Ke=Y,function(e,t,n,r){var a=_slicedToArray2(n,3),i=a[0],o=a[1],s=a[2];Ke(e[o],[t,i,s],(function(e){return e[0]===t&&e[1]===i}),r)}),Qt=function(e){return function(t,n,r,a){var i=_slicedToArray2(r,3),o=i[0],s=i[1],u=i[2],c=t.get(o);void 0===c?t.set(o,new Set([[s,n,u]])):e(c,[s,n,u],(function(e){return e[0]===s&&e[1]===n}),a)}}(Y),Yt=function(e){return function(t,n,r,a){return e(t[a],(function(e){return e[0]===n&&e[1]===r}))}}(R),Zt=new WeakMap,Jt=function(e){return function(t){var n;return null!==(n=e.get(t))&&void 0!==n?n:0}}(Zt),$t=(Xe=new Map,Qe=new WeakMap,function(e,t){var n=Qe.get(e);if(void 0!==n)return n;var r=Xe.get(e);if(void 0!==r)return r;try{var a=t();return a instanceof Promise?(Xe.set(e,a),a.catch((function(){return!1})).then((function(t){return Xe.delete(e),Qe.set(e,t),t}))):(Qe.set(e,a),a)}catch(i){return Qe.set(e,!1),!1}}),en="undefined"==typeof window?null:window,tn=(Ye=$t,Ze=j,function(e,t){var n=e.createAnalyser();if(Fe(n,t),!(t.maxDecibels>t.minDecibels))throw Ze();return Pe(n,t,"fftSize"),Pe(n,t,"maxDecibels"),Pe(n,t,"minDecibels"),Pe(n,t,"smoothingTimeConstant"),Ye(Me,(function(){return Me(n)}))||function(e){e.getFloatTimeDomainData=function(t){var n=new Uint8Array(t.length);e.getByteTimeDomainData(n);for(var r=Math.max(n.length,e.fftSize),a=0;a<r;a+=1)t[a]=.0078125*(n[a]-128);return t}}(n),n}),nn=(Je=G,function(e){var t=Je(e);if(null===t.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer}),rn=function(e,t,n){return function(){var r=_asyncToGenerator(regeneratorRuntime.mark((function r(a,i,o,s){var u,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return u=e(a),c=[].concat(_toConsumableArray(s),[a]),r.next=3,Promise.all(u.activeInputs.map((function(e,r){return Array.from(e).filter((function(e){var t=_slicedToArray2(e,1)[0];return!c.includes(t)})).map(function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(s){var u,l,h,f,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=_slicedToArray2(s,2),l=u[0],h=u[1],f=t(l),e.next=4,f.render(l,i,c);case 4:d=e.sent,p=a.context.destination,n(l)||a===p&&n(a)||d.connect(o,h,r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).reduce((function(e,t){return[].concat(_toConsumableArray(e),_toConsumableArray(t))}),[]));case 3:case"end":return r.stop()}}),r)})));return function(e,t,n,a){return r.apply(this,arguments)}}()}(G,nn,se),an=($e=tn,et=ie,tt=rn,function(){var e=new WeakMap;return{render:function(t,n,r){var a,i=e.get(n);return void 0!==i?Promise.resolve(i):(a=_asyncToGenerator(regeneratorRuntime.mark((function t(n,r,a){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=et(n),z(i,r)||(i=$e(r,{channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,fftSize:i.fftSize,maxDecibels:i.maxDecibels,minDecibels:i.minDecibels,smoothingTimeConstant:i.smoothingTimeConstant})),e.set(r,i),t.next=5,tt(n,r,i,a);case 5:return t.abrupt("return",i);case 6:case"end":return t.stop()}}),t)}))),function(e,t,n){return a.apply(this,arguments)})(t,n,r)}}}),on=(nt=_,function(e){var t=nt.get(e);if(void 0===t)throw Ee();return t}),sn=function(e){return null===e?null:e.hasOwnProperty("OfflineAudioContext")?e.OfflineAudioContext:e.hasOwnProperty("webkitOfflineAudioContext")?e.webkitOfflineAudioContext:null}(en),un=(rt=sn,function(e){return null!==rt&&e instanceof rt}),cn=new WeakMap,ln=(at=Kt,function(){function e(t){_classCallCheck2(this,e),this._nativeEventTarget=t,this._listeners=new WeakMap}return _createClass2(e,[{key:"addEventListener",value:function(e,t,n){if(null!==t){var r=this._listeners.get(t);void 0===r&&(r=at(this,t),"function"==typeof t&&this._listeners.set(t,r)),this._nativeEventTarget.addEventListener(e,r,n)}}},{key:"dispatchEvent",value:function(e){return this._nativeEventTarget.dispatchEvent(e)}},{key:"removeEventListener",value:function(e,t,n){var r=null===t?void 0:this._listeners.get(t);this._nativeEventTarget.removeEventListener(e,void 0===r?null:r,n)}}]),e}()),hn=function(e){return null===e?null:e.hasOwnProperty("AudioContext")?e.AudioContext:e.hasOwnProperty("webkitAudioContext")?e.webkitAudioContext:null}(en),fn=(it=hn,function(e){return null!==it&&e instanceof it}),dn=function(e){return function(t){return null!==e&&"function"==typeof e.AudioNode&&t instanceof e.AudioNode}}(en),pn=function(e){return function(t){return null!==e&&"function"==typeof e.AudioParam&&t instanceof e.AudioParam}}(en),mn=function(e,t,n,r,a,i,o,s,u,c,l,h,f,d,p){return function(c){_inherits(g,c);var m=_createSuper(g);function g(t,r,a,i){var o;_classCallCheck2(this,g),(o=m.call(this,a))._context=t,o._nativeAudioNode=a;var s=l(t);return h(s)&&!0!==n(ce,(function(){return ce(s)}))&&function(e){var t,n,r=new Map;e.connect=(t=e.connect.bind(e),function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=he(e)?t(e,n,a):t(e,n),o=r.get(e);return void 0===o?r.set(e,[{input:a,output:n}]):o.every((function(e){return e.input!==a||e.output!==n}))&&o.push({input:a,output:n}),i}),e.disconnect=(n=e.disconnect,function(t,a,i){if(n.apply(e),void 0===t)r.clear();else if("number"==typeof t){var o,s=_createForOfIteratorHelper(r);try{for(s.s();!(o=s.n()).done;){var u=_slicedToArray2(o.value,2),c=u[0],l=u[1].filter((function(e){return e.output!==t}));0===l.length?r.delete(c):r.set(c,l)}}catch(v){s.e(v)}finally{s.f()}}else if(r.has(t))if(void 0===a)r.delete(t);else{var h=r.get(t);if(void 0!==h){var f=h.filter((function(e){return e.output!==a&&(e.input!==i||void 0===i)}));0===f.length?r.delete(t):r.set(t,f)}}var d,p=_createForOfIteratorHelper(r);try{var m=function(){var t=_slicedToArray2(d.value,2),n=t[0];t[1].forEach((function(t){he(n)?e.connect(n,t.output,t.input):e.connect(n,t.output)}))};for(p.s();!(d=p.n()).done;)m()}catch(v){p.e(v)}finally{p.f()}})}(a),v.set(_assertThisInitialized(o),a),b.set(_assertThisInitialized(o),new Set),"closed"!==t.state&&r&&D(_assertThisInitialized(o)),e(_assertThisInitialized(o),i,a),o}return _createClass2(g,[{key:"connect",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw a();var c=l(this._context),h=p(c);if(f(e)||d(e))throw i();if(X(e)){var m=ie(e);try{var v,g=ee(this._nativeAudioNode,m,n,s),y=ue(this);(h||y)&&(v=this._nativeAudioNode).disconnect.apply(v,_toConsumableArray(g)),"closed"!==this.context.state&&!y&&ue(e)&&D(e)}catch(w){if(12===w.code)throw i();throw w}if(t(this,e,n,s,h)){var _=u([this],e);le(_,r(h))}return e}var b=oe(e);if("playbackRate"===b.name)throw o();try{this._nativeAudioNode.connect(b,n),(h||ue(this))&&this._nativeAudioNode.disconnect(b,n)}catch(w){if(12===w.code)throw i();throw w}if(function(e,t,n,r){var a=H(t),i=a.activeInputs,o=a.passiveInputs,s=G(e).outputs,u=N(e),c=function(a){var s=ie(e),u=oe(t);if(a){var c=re(o,e,n);Z(i,e,c,!1),r||se(e)||s.connect(u,n)}else{var l=function(e,t,n){return R(e,(function(e){return e[0]===t&&e[1]===n}))}(i,e,n);J(o,l,!1),r||se(e)||s.disconnect(u,n)}};return!!Y(s,[t,n],(function(e){return e[0]===t&&e[1]===n}),!0)&&(u.add(c),U(e)?Z(i,e,[n,c],!0):J(o,[e,n,c],!0),!0)}(this,e,n,h)){var k=u([this],e);le(k,r(h))}}},{key:"disconnect",value:function(e,t,n){var r,o=l(this._context),c=p(o);if(void 0===e)r=function(e,t){var n,r=G(e),a=[],i=_createForOfIteratorHelper(r.outputs);try{for(i.s();!(n=i.n()).done;){var o=n.value;Q(o)?fe.apply(void 0,[e,t].concat(_toConsumableArray(o))):de.apply(void 0,[e,t].concat(_toConsumableArray(o))),a.push(o[0])}}catch(s){i.e(s)}finally{i.f()}return r.outputs.clear(),a}(this,c);else if("number"==typeof e){if(e<0||e>=this.numberOfOutputs)throw a();r=function(e,t,n){var r,a=G(e),i=[],o=_createForOfIteratorHelper(a.outputs);try{for(o.s();!(r=o.n()).done;){var s=r.value;s[1]===n&&(Q(s)?fe.apply(void 0,[e,t].concat(_toConsumableArray(s))):de.apply(void 0,[e,t].concat(_toConsumableArray(s))),i.push(s[0]),a.outputs.delete(s))}}catch(u){o.e(u)}finally{o.f()}return i}(this,c,e)}else{if(void 0!==t&&(t<0||t>=this.numberOfOutputs))throw a();if(X(e)&&void 0!==n&&(n<0||n>=e.numberOfInputs))throw a();if(0===(r=function(e,t,n,r,a){var i=G(e);return Array.from(i.outputs).filter((function(e){return!(e[0]!==n||void 0!==r&&e[1]!==r||void 0!==a&&e[2]!==a)})).map((function(n){return Q(n)?fe.apply(void 0,[e,t].concat(_toConsumableArray(n))):de.apply(void 0,[e,t].concat(_toConsumableArray(n))),i.outputs.delete(n),n[0]}))}(this,c,e,t,n)).length)throw i()}var h,f=_createForOfIteratorHelper(r);try{for(f.s();!(h=f.n()).done;){var d=h.value,m=u([this],d);le(m,s)}}catch(v){f.e(v)}finally{f.f()}}},{key:"channelCount",get:function(){return this._nativeAudioNode.channelCount},set:function(e){this._nativeAudioNode.channelCount=e}},{key:"channelCountMode",get:function(){return this._nativeAudioNode.channelCountMode},set:function(e){this._nativeAudioNode.channelCountMode=e}},{key:"channelInterpretation",get:function(){return this._nativeAudioNode.channelInterpretation},set:function(e){this._nativeAudioNode.channelInterpretation=e}},{key:"context",get:function(){return this._context}},{key:"numberOfInputs",get:function(){return this._nativeAudioNode.numberOfInputs}},{key:"numberOfOutputs",get:function(){return this._nativeAudioNode.numberOfOutputs}}]),g}(c)}((ot=m,function(e,t,n){for(var r=[],a=0;a<n.numberOfInputs;a+=1)r.push(new Set);ot.set(e,{activeInputs:r,outputs:new Set,passiveInputs:new WeakMap,renderer:t})}),function(e,t,n,r,a,i,o,s,u,c,l,h,f){return function(d,p,m,v,g){var y=i(p),_=y.activeInputs,b=y.passiveInputs,k=i(d).outputs,w=s(d),x=function(i){var s=u(p),c=u(d);if(i){var y=O(b,d,m,v);e(_,d,y,!1),g||h(d)||n(c,s,m,v),f(p)&&D(p)}else{var k=r(_,d,m,v);t(b,v,k,!1),g||h(d)||a(c,s,m,v);var w=o(p);0===w?l(p)&&M(p,_):setTimeout((function(){l(p)&&M(p,_)}),1e3*w)}};return!!c(k,[p,m,v],(function(e){return e[0]===p&&e[1]===m&&e[2]===v}),!0)&&(w.add(x),l(d)?e(_,d,[m,v,x],!0):t(b,v,[d,m,x],!0),!0)}}(Xt,Qt,ee,Yt,ae,G,Jt,N,ie,Y,U,se,ue),$t,function(e,t,n,r,a,i){return function(o){return function(s,u){var c=e.get(s);if(void 0===c){if(!o&&i(s)){var l,h=r(s),f=_createForOfIteratorHelper(n(s).outputs);try{for(f.s();!(l=f.n()).done;){var d=l.value;if(Q(d)){var p=r(d[0]);t(h,p,d[1],d[2])}else{var m=a(d[0]);h.disconnect(m,d[1])}}}catch(v){f.e(v)}finally{f.f()}}e.set(s,u)}else e.set(s,c+u)}}}(k,ae,G,ie,oe,U),j,Ie,Nt,function(e,t,n,r,a,i,o,s){return function(u,c){var l=t.get(u);if(void 0===l)throw new Error("Missing the expected cycle count.");var h=i(u.context),f=s(h);if(l===c){if(t.delete(u),!f&&o(u)){var d,p=r(u),m=_createForOfIteratorHelper(n(u).outputs);try{for(m.s();!(d=m.n()).done;){var v=d.value;if(Q(v)){var g=r(v[0]);e(p,g,v[1],v[2])}else{var y=a(v[0]);p.connect(y,v[1])}}}catch(_){m.e(_)}finally{m.f()}}}else t.set(u,l-c)}}(ee,k,G,ie,oe,on,U,un),function(e,t,n){return function r(a,i){var o=X(i)?i:n(e,i);if(function(e){return"delayTime"in e}(o))return[];if(a[0]===o)return[a];if(a.includes(o))return[];var s=t(o).outputs;return Array.from(s).map((function(e){return r([].concat(_toConsumableArray(a),[o]),e[0])})).reduce((function(e,t){return e.concat(t)}),[])}}(cn,G,I),ln,on,fn,dn,pn,un),vn=function(e,t,n,r,a,i){return function(e){_inherits(s,e);var o=_createSuper(s);function s(e,n){var u;_classCallCheck2(this,s);var c=a(e),l=_objectSpread(_objectSpread({},L),n),h=r(c,l);return(u=o.call(this,e,!1,h,i(c)?t():null))._nativeAnalyserNode=h,u}return _createClass2(s,[{key:"getByteFrequencyData",value:function(e){this._nativeAnalyserNode.getByteFrequencyData(e)}},{key:"getByteTimeDomainData",value:function(e){this._nativeAnalyserNode.getByteTimeDomainData(e)}},{key:"getFloatFrequencyData",value:function(e){this._nativeAnalyserNode.getFloatFrequencyData(e)}},{key:"getFloatTimeDomainData",value:function(e){this._nativeAnalyserNode.getFloatTimeDomainData(e)}},{key:"fftSize",get:function(){return this._nativeAnalyserNode.fftSize},set:function(e){this._nativeAnalyserNode.fftSize=e}},{key:"frequencyBinCount",get:function(){return this._nativeAnalyserNode.frequencyBinCount}},{key:"maxDecibels",get:function(){return this._nativeAnalyserNode.maxDecibels},set:function(e){var t=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=e,!(e>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=t,n()}},{key:"minDecibels",get:function(){return this._nativeAnalyserNode.minDecibels},set:function(e){var t=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=e,!(this._nativeAnalyserNode.maxDecibels>e))throw this._nativeAnalyserNode.minDecibels=t,n()}},{key:"smoothingTimeConstant",get:function(){return this._nativeAnalyserNode.smoothingTimeConstant},set:function(e){this._nativeAnalyserNode.smoothingTimeConstant=e}}]),s}(e)}(mn,an,j,tn,on,un),gn=new WeakSet,yn=function(e){return null===e?null:e.hasOwnProperty("AudioBuffer")?e.AudioBuffer:null}(en),_n=(st=new Uint32Array(1),function(e){return st[0]=e,st[0]}),bn=function(e,t){return function(n){n.copyFromChannel=function(r,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e(i),s=e(a);if(s>=n.numberOfChannels)throw t();for(var u=n.length,c=n.getChannelData(s),l=r.length,h=o<0?-o:0;h+o<u&&h<l;h+=1)r[h]=c[h+o]},n.copyToChannel=function(r,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e(i),s=e(a);if(s>=n.numberOfChannels)throw t();for(var u=n.length,c=n.getChannelData(s),l=r.length,h=o<0?-o:0;h+o<u&&h<l;h+=1)c[h+o]=r[h]}}}(_n,j),kn=function(e){return function(t){t.copyFromChannel=function(n){return function(r,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e(i),s=e(a);if(o<t.length)return n.call(t,r,s,o)}}(t.copyFromChannel),t.copyToChannel=function(n){return function(r,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e(i),s=e(a);if(o<t.length)return n.call(t,r,s,o)}}(t.copyToChannel)}}(_n),wn=function(e,t,n,r,a,i,o,s){var u=null;return(function(){function c(l){if(_classCallCheck2(this,c),null===a)throw new Error("Missing the native OfflineAudioContext constructor.");var h=_objectSpread(_objectSpread({},q),l),f=h.length,d=h.numberOfChannels,p=h.sampleRate;null===u&&(u=new a(1,1,44100));var m=null!==r&&t(i,i)?new r({length:f,numberOfChannels:d,sampleRate:p}):u.createBuffer(d,f,p);if(0===m.numberOfChannels)throw n();return"function"!=typeof m.copyFromChannel?(o(m),V(m)):t(B,(function(){return B(m)}))||s(m),e.add(m),m}return _createClass2(c,null,[{key:Symbol.hasInstance,value:function(t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===c.prototype||e.has(t)}}]),c}())}(gn,$t,Nt,yn,sn,(ut=yn,function(){if(null===ut)return!1;try{new ut({length:1,sampleRate:44100})}catch(e){return!1}return!0}),bn,kn),xn=(ct=Ge,function(e,t){var n=ct(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(n).connect(e.destination);t.addEventListener("ended",(function e(){t.removeEventListener("ended",e),t.disconnect(n),n.disconnect()}))}),Cn=function(e,t,n){return function(){var r=_asyncToGenerator(regeneratorRuntime.mark((function r(a,i,o,s){var u;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return u=t(a),r.next=3,Promise.all(Array.from(u.activeInputs).map(function(){var t=_asyncToGenerator(regeneratorRuntime.mark((function t(r){var a,u,c,l,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=_slicedToArray2(r,2),u=a[0],c=a[1],l=e(u),t.next=4,l.render(u,i,s);case 4:h=t.sent,n(u)||h.connect(o,c);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:case"end":return r.stop()}}),r)})));return function(e,t,n,a){return r.apply(this,arguments)}}()}(nn,H,se),Sn=function(e){return function(t,n,r,a){return e(n,t,r,a)}}(Cn),Tn=function(e,t,n,r,a,i,o,s,u,c,l){return function(u,h){var f=u.createBufferSource();return Fe(f,h),Le(f,h,"playbackRate"),Pe(f,h,"buffer"),Pe(f,h,"loop"),Pe(f,h,"loopEnd"),Pe(f,h,"loopStart"),t(n,(function(){return n(u)}))||function(e){var t,n;e.start=(t=e.start,n=!1,function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(n)throw Ee();t.call(e,r,a,i),n=!0})}(f),t(r,(function(){return r(u)}))||function(e){var t;e.start=(t=e.start,function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0,i=e.buffer,o=null===i?r:Math.min(i.duration,r);null!==i&&o>i.duration-.5/e.context.sampleRate?t.call(e,n,0,0):t.call(e,n,o,a)})}(f),t(a,(function(){return a(u)}))||c(f,u),t(i,(function(){return i(u)}))||ze(f),t(o,(function(){return o(u)}))||l(f,u),t(s,(function(){return s(u)}))||Be(f),e(u,f),f}}(xn,$t,(function(e){var t=e.createBufferSource();t.start();try{t.start()}catch(n){return!0}return!1}),(function(e){var t=e.createBufferSource(),n=e.createBuffer(1,1,44100);t.buffer=n;try{t.start(0,1)}catch(r){return!1}return!0}),(function(e){var t=e.createBufferSource();t.start();try{t.stop()}catch(n){return!1}return!0}),Vt,qt,Ut,0,(lt=jt,function(e,t){var n=t.createBuffer(1,1,44100);null===e.buffer&&(e.buffer=n),lt(e,"buffer",(function(t){return function(){var r=t.call(e);return r===n?null:r}}),(function(t){return function(r){return t.call(e,null===r?n:r)}}))}),Ht),An=function(e,t){return function(n,r,a,i){return e(r).replay(a),t(r,n,a,i)}}(function(e){return function(t){var n=e(t);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer}}(H),Cn),En=function(e,t,n,r,a){return function(){var i=new WeakMap,o=null,s=null;return{set start(e){o=e},set stop(e){s=e},render:function(u,c,l){var h,f=i.get(c);return void 0!==f?Promise.resolve(f):(h=_asyncToGenerator(regeneratorRuntime.mark((function u(c,l,h){var f,d,p;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(d=n(c),(p=z(d,l))||(d=t(l,{buffer:d.buffer,channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,loop:d.loop,loopEnd:d.loopEnd,loopStart:d.loopStart,playbackRate:d.playbackRate.value}),null!==o&&(f=d).start.apply(f,_toConsumableArray(o)),null!==s&&d.stop(s)),i.set(l,d),!p){u.next=9;break}return u.next=7,e(l,c.playbackRate,d.playbackRate,h);case 7:u.next=11;break;case 9:return u.next=11,r(l,c.playbackRate,d.playbackRate,h);case 11:return u.next=13,a(c,l,d,h);case 13:return u.abrupt("return",d);case 14:case"end":return u.stop()}}),u)}))),function(e,t,n){return h.apply(this,arguments)})(u,c,l)}}}}(Sn,Tn,ie,An,rn),In=function(e,t,n,r,a,i,o,s,u,c,l,h){return function(r,f,p){var m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=new d.AutomationEventList(p.defaultValue),y=f?function(e){return{replay:function(t){var n,r=_createForOfIteratorHelper(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if("exponentialRampToValue"===a.type){var i=a.endTime,o=a.value;t.exponentialRampToValueAtTime(o,i)}else if("linearRampToValue"===a.type){var s=a.endTime,u=a.value;t.linearRampToValueAtTime(u,s)}else if("setTarget"===a.type){var c=a.startTime,l=a.target,h=a.timeConstant;t.setTargetAtTime(l,c,h)}else if("setValue"===a.type){var f=a.startTime,d=a.value;t.setValueAtTime(d,f)}else{if("setValueCurve"!==a.type)throw new Error("Can't apply an unknown automation.");var p=a.duration,m=a.startTime,v=a.values;t.setValueCurveAtTime(v,m,p)}}}catch(g){r.e(g)}finally{r.f()}}}}(g):null,_={get defaultValue(){return p.defaultValue},get maxValue(){return null===m?p.maxValue:m},get minValue(){return null===v?p.minValue:v},get value(){return p.value},set value(e){p.value=e,_.setValueAtTime(e,r.context.currentTime)},cancelAndHoldAtTime:function(e){if("function"==typeof p.cancelAndHoldAtTime)null===y&&g.flush(r.context.currentTime),g.add(a(e)),p.cancelAndHoldAtTime(e);else{var t=Array.from(g).pop();null===y&&g.flush(r.context.currentTime),g.add(a(e));var n=Array.from(g).pop();p.cancelScheduledValues(e),t!==n&&void 0!==n&&("exponentialRampToValue"===n.type?p.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?p.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?p.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&p.setValueCurveAtTime(n.values,n.startTime,n.duration))}return _},cancelScheduledValues:function(e){return null===y&&g.flush(r.context.currentTime),g.add(i(e)),p.cancelScheduledValues(e),_},exponentialRampToValueAtTime:function(e,t){if(0===e)throw new RangeError;if(!Number.isFinite(t)||t<0)throw new RangeError;return null===y&&g.flush(r.context.currentTime),g.add(o(e,t)),p.exponentialRampToValueAtTime(e,t),_},linearRampToValueAtTime:function(e,t){return null===y&&g.flush(r.context.currentTime),g.add(s(e,t)),p.linearRampToValueAtTime(e,t),_},setTargetAtTime:function(e,t,n){return null===y&&g.flush(r.context.currentTime),g.add(u(e,t,n)),p.setTargetAtTime(e,t,n),_},setValueAtTime:function(e,t){return null===y&&g.flush(r.context.currentTime),g.add(c(e,t)),p.setValueAtTime(e,t),_},setValueCurveAtTime:function(e,t,n){var a=e instanceof Float32Array?e:new Float32Array(e);if(null!==h&&"webkitAudioContext"===h.name){for(var i=t+n,o=r.context.sampleRate,s=Math.ceil(t*o),u=Math.floor(i*o),c=u-s,f=new Float32Array(c),d=0;d<c;d+=1){var m=(a.length-1)/n*((s+d)/o-t),v=Math.floor(m),b=Math.ceil(m);f[d]=v===b?a[v]:(1-(m-v))*a[v]+(1-(b-m))*a[b]}null===y&&g.flush(r.context.currentTime),g.add(l(f,t,n)),p.setValueCurveAtTime(f,t,n);var k=u/o;k<i&&_.setValueAtTime(f[f.length-1],k),_.setValueAtTime(a[a.length-1],i)}else null===y&&g.flush(r.context.currentTime),g.add(l(a,t,n)),p.setValueCurveAtTime(a,t,n);return _}};return n.set(_,p),t.set(_,r),e(_,y),_}}((ht=g,function(e,t){ht.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})}),cn,y,0,d.createCancelAndHoldAutomationEvent,d.createCancelScheduledValuesAutomationEvent,d.createExponentialRampToValueAutomationEvent,d.createLinearRampToValueAutomationEvent,d.createSetTargetAutomationEvent,d.createSetValueAutomationEvent,d.createSetValueCurveAutomationEvent,hn),Rn=function(e,t,n,r,a,i,o,s){return function(e){_inherits(c,e);var u=_createSuper(c);function c(e,r){var s;_classCallCheck2(this,c);var l=i(e),h=_objectSpread(_objectSpread({},W),r),f=a(l,h),d=o(l),p=d?t():null;return(s=u.call(this,e,!1,f,p))._audioBufferSourceNodeRenderer=p,s._isBufferNullified=!1,s._isBufferSet=null!==h.buffer,s._nativeAudioBufferSourceNode=f,s._onended=null,s._playbackRate=n(_assertThisInitialized(s),d,f.playbackRate,34028234663852886e22,-34028234663852886e22),s}return _createClass2(c,[{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(this._nativeAudioBufferSourceNode.start(t,n,r),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===r?[t,n]:[t,n,r]),"closed"!==this.context.state){D(this);var a=function t(){e._nativeAudioBufferSourceNode.removeEventListener("ended",t),U(e)&&F(e)};this._nativeAudioBufferSourceNode.addEventListener("ended",a)}}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._nativeAudioBufferSourceNode.stop(e),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=e)}},{key:"buffer",get:function(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer},set:function(e){if(this._nativeAudioBufferSourceNode.buffer=e,null!==e){if(this._isBufferSet)throw r();this._isBufferSet=!0}}},{key:"loop",get:function(){return this._nativeAudioBufferSourceNode.loop},set:function(e){this._nativeAudioBufferSourceNode.loop=e}},{key:"loopEnd",get:function(){return this._nativeAudioBufferSourceNode.loopEnd},set:function(e){this._nativeAudioBufferSourceNode.loopEnd=e}},{key:"loopStart",get:function(){return this._nativeAudioBufferSourceNode.loopStart},set:function(e){this._nativeAudioBufferSourceNode.loopStart=e}},{key:"onended",get:function(){return this._onended},set:function(e){var t="function"==typeof e?s(this,e):null;this._nativeAudioBufferSourceNode.onended=t;var n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===t?e:n}},{key:"playbackRate",get:function(){return this._playbackRate}}]),c}(e)}(mn,En,In,Ee,Tn,on,un,Kt),On=function(e,t,n,r,a,i,o,s){return function(e){_inherits(u,e);var t=_createSuper(u);function u(e,n){var r;_classCallCheck2(this,u);var c=i(e),l=o(c),h=a(c,n,l);return(r=t.call(this,e,!1,h,l?function(e){var t=null;return{render:function(n,r,a){return null===t&&(t=(i=_asyncToGenerator(regeneratorRuntime.mark((function t(n,r,a){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=r.destination,t.next=3,e(n,r,i,a);case 3:return t.abrupt("return",i);case 4:case"end":return t.stop()}}),t)}))),function(e,t,n){return i.apply(this,arguments)})(n,r,a)),t;var i}}}(s):null))._isNodeOfNativeOfflineAudioContext=l,r._nativeAudioDestinationNode=h,r}return _createClass2(u,[{key:"channelCount",get:function(){return this._nativeAudioDestinationNode.channelCount},set:function(e){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(e>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=e}},{key:"channelCountMode",get:function(){return this._nativeAudioDestinationNode.channelCountMode},set:function(e){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=e}},{key:"maxChannelCount",get:function(){return this._nativeAudioDestinationNode.maxChannelCount}}]),u}(e)}(mn,0,j,Ee,function(e,t){return function(n,r,a){var i=n.destination;if(i.channelCount!==r)try{i.channelCount=r}catch(s){}a&&"explicit"!==i.channelCountMode&&(i.channelCountMode="explicit"),0===i.maxChannelCount&&Object.defineProperty(i,"maxChannelCount",{value:r});var o=e(n,{channelCount:r,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return t(o,"channelCount",(function(e){return function(){return e.call(o)}}),(function(e){return function(t){e.call(o,t);try{i.channelCount=t}catch(n){if(t>i.maxChannelCount)throw n}}})),t(o,"channelCountMode",(function(e){return function(){return e.call(o)}}),(function(e){return function(t){e.call(o,t),i.channelCountMode=t}})),t(o,"channelInterpretation",(function(e){return function(){return e.call(o)}}),(function(e){return function(t){e.call(o,t),i.channelInterpretation=t}})),Object.defineProperty(o,"maxChannelCount",{get:function(){return i.maxChannelCount}}),o.connect(i),o}}(Ge,jt),on,un,rn),Nn=function(e,t,n,r,a){return function(){var i=new WeakMap;return{render:function(o,s,u){var c,l=i.get(s);return void 0!==l?Promise.resolve(l):(c=_asyncToGenerator(regeneratorRuntime.mark((function o(s,u,c){var l,h;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(l=n(s),(h=z(l,u))||(l=t(u,{Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type})),i.set(u,l),!h){o.next=15;break}return o.next=7,e(u,s.Q,l.Q,c);case 7:return o.next=9,e(u,s.detune,l.detune,c);case 9:return o.next=11,e(u,s.frequency,l.frequency,c);case 11:return o.next=13,e(u,s.gain,l.gain,c);case 13:o.next=23;break;case 15:return o.next=17,r(u,s.Q,l.Q,c);case 17:return o.next=19,r(u,s.detune,l.detune,c);case 19:return o.next=21,r(u,s.frequency,l.frequency,c);case 21:return o.next=23,r(u,s.gain,l.gain,c);case 23:return o.next=25,a(s,u,l,c);case 25:return o.abrupt("return",l);case 26:case"end":return o.stop()}}),o)}))),function(e,t,n){return c.apply(this,arguments)})(o,s,u)}}}}(Sn,Ve,ie,An,rn),Dn=function(e){return function(t,n){return e.set(t,n)}}(Zt),Pn=(ft=In,dt=Nn,pt=Ie,mt=Ve,vt=on,gt=un,yt=Dn,function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;_classCallCheck2(this,n);var i=vt(e),o=_objectSpread(_objectSpread({},_e),r),s=mt(i,o),u=gt(i);return(a=t.call(this,e,!1,s,u?dt():null))._Q=ft(_assertThisInitialized(a),u,s.Q,34028234663852886e22,-34028234663852886e22),a._detune=ft(_assertThisInitialized(a),u,s.detune,1200*Math.log2(34028234663852886e22),-1200*Math.log2(34028234663852886e22)),a._frequency=ft(_assertThisInitialized(a),u,s.frequency,e.sampleRate/2,0),a._gain=ft(_assertThisInitialized(a),u,s.gain,40*Math.log10(34028234663852886e22),-34028234663852886e22),a._nativeBiquadFilterNode=s,yt(_assertThisInitialized(a),1),a}return _createClass2(n,[{key:"getFrequencyResponse",value:function(e,t,n){if(this._nativeBiquadFilterNode.getFrequencyResponse(e,t,n),e.length!==t.length||t.length!==n.length)throw pt()}},{key:"detune",get:function(){return this._detune}},{key:"frequency",get:function(){return this._frequency}},{key:"gain",get:function(){return this._gain}},{key:"Q",get:function(){return this._Q}},{key:"type",get:function(){return this._nativeBiquadFilterNode.type},set:function(e){this._nativeBiquadFilterNode.type=e}}]),n}(mn)),Fn=function(e,t){return function(n,r,a){var i,o,s=new Set;return n.connect=(i=n.connect,function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=0===s.size;if(t(a))return i.call(n,a,o,u),e(s,[a,o,u],(function(e){return e[0]===a&&e[1]===o&&e[2]===u}),!0),c&&r(),a;i.call(n,a,o),e(s,[a,o],(function(e){return e[0]===a&&e[1]===o}),!0),c&&r()}),n.disconnect=(o=n.disconnect,function(e,r,i){var u=s.size>0;if(void 0===e)o.apply(n),s.clear();else if("number"==typeof e){o.call(n,e);var c,l=_createForOfIteratorHelper(s);try{for(l.s();!(c=l.n()).done;){var h=c.value;h[1]===e&&s.delete(h)}}catch(m){l.e(m)}finally{l.f()}}else{t(e)?o.call(n,e,r,i):o.call(n,e,r);var f,d=_createForOfIteratorHelper(s);try{for(d.s();!(f=d.n()).done;){var p=f.value;p[0]!==e||void 0!==r&&p[1]!==r||void 0!==i&&p[2]!==i||s.delete(p)}}catch(m){d.e(m)}finally{d.f()}}u&&0===s.size&&a()}),n}}(Y,dn),Mn=(_t=Ee,bt=Fn,function(e,t){t.channelCount=1,t.channelCountMode="explicit",Object.defineProperty(t,"channelCount",{get:function(){return 1},set:function(){throw _t()}}),Object.defineProperty(t,"channelCountMode",{get:function(){return"explicit"},set:function(){throw _t()}});var n=e.createBufferSource();bt(t,(function(){for(var e=t.numberOfInputs,r=0;r<e;r+=1)n.connect(t,0,r)}),(function(){return n.disconnect(t)}))}),Ln=function(e,t){return function(n,r){var a=n.createChannelMerger(r.numberOfInputs);return null!==e&&"webkitAudioContext"===e.name&&t(n,a),Fe(a,r),a}}(hn,Mn),zn=function(e,t,n,r,a){return function(e){_inherits(o,e);var i=_createSuper(o);function o(e,s){_classCallCheck2(this,o);var u=r(e),c=_objectSpread(_objectSpread({},be),s);return i.call(this,e,!1,n(u,c),a(u)?t():null)}return o}(e)}(mn,function(e,t,n){return function(){var r=new WeakMap;return{render:function(a,i,o){var s,u=r.get(i);return void 0!==u?Promise.resolve(u):(s=_asyncToGenerator(regeneratorRuntime.mark((function a(i,o,s){var u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return u=t(i),z(u,o)||(u=e(o,{channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,numberOfInputs:u.numberOfInputs})),r.set(o,u),a.next=5,n(i,o,u,s);case 5:return a.abrupt("return",u);case 6:case"end":return a.stop()}}),a)}))),function(e,t,n){return s.apply(this,arguments)})(a,i,o)}}}}(Ln,ie,rn),Ln,on,un),Bn=function(e,t,n,r,a,i){return function(e){_inherits(o,e);var i=_createSuper(o);function o(e,s){_classCallCheck2(this,o);var u=r(e),c=function(e){return _objectSpread(_objectSpread({},e),{},{channelCount:e.numberOfOutputs})}(_objectSpread(_objectSpread({},ke),s));return i.call(this,e,!1,n(u,c),a(u)?t():null)}return o}(e)}(mn,function(e,t,n){return function(){var r=new WeakMap;return{render:function(a,i,o){var s,u=r.get(i);return void 0!==u?Promise.resolve(u):(s=_asyncToGenerator(regeneratorRuntime.mark((function a(i,o,s){var u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return u=t(i),z(u,o)||(u=e(o,{channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,numberOfOutputs:u.numberOfOutputs})),r.set(o,u),a.next=5,n(i,o,u,s);case 5:return a.abrupt("return",u);case 6:case"end":return a.stop()}}),a)}))),function(e,t,n){return s.apply(this,arguments)})(a,i,o)}}}}(qe,ie,rn),qe,on,un),jn=function(e,t,n,r){return function(a,i){var o=i.offset,s=_objectWithoutProperties(i,["offset"]),u=a.createBuffer(1,2,44100),c=t(a,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=n(a,_objectSpread(_objectSpread({},s),{},{gain:o})),h=u.getChannelData(0);h[0]=1,h[1]=1,c.buffer=u,c.loop=!0;var f={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(e){l.channelCount=e},get channelCountMode(){return l.channelCountMode},set channelCountMode(e){l.channelCountMode=e},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(e){l.channelInterpretation=e},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(e){c.onended=e},addEventListener:function(){return c.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent:function(){return c.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener:function(){return c.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},start:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;c.start.call(c,e)},stop:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;c.stop.call(c,e)}};return e(a,c),r(Ue(f,l),(function(){return c.connect(l)}),(function(){return c.disconnect(l)}))}}(xn,Tn,Ge,Fn),Vn=function(e,t,n,r,a){return function(i,o){if(void 0===i.createConstantSource)return n(i,o);var s=i.createConstantSource();return Fe(s,o),Le(s,o,"offset"),t(r,(function(){return r(i)}))||ze(s),t(a,(function(){return a(i)}))||Be(s),e(i,s),s}}(xn,$t,jn,Vt,Ut),qn=function(e,t,n,r,a,i,o){return function(e){_inherits(u,e);var s=_createSuper(u);function u(e,o){var c;_classCallCheck2(this,u);var l=a(e),h=_objectSpread(_objectSpread({},we),o),f=r(l,h),d=i(l),p=d?n():null;return(c=s.call(this,e,!1,f,p))._constantSourceNodeRenderer=p,c._nativeConstantSourceNode=f,c._offset=t(_assertThisInitialized(c),d,f.offset,34028234663852886e22,-34028234663852886e22),c._onended=null,c}return _createClass2(u,[{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){D(this);var n=function t(){e._nativeConstantSourceNode.removeEventListener("ended",t),U(e)&&F(e)};this._nativeConstantSourceNode.addEventListener("ended",n)}}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._nativeConstantSourceNode.stop(e),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=e)}},{key:"offset",get:function(){return this._offset}},{key:"onended",get:function(){return this._onended},set:function(e){var t="function"==typeof e?o(this,e):null;this._nativeConstantSourceNode.onended=t;var n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===t?e:n}}]),u}(e)}(mn,In,function(e,t,n,r,a){return function(){var i=new WeakMap,o=null,s=null;return{set start(e){o=e},set stop(e){s=e},render:function(u,c,l){var h,f=i.get(c);return void 0!==f?Promise.resolve(f):(h=_asyncToGenerator(regeneratorRuntime.mark((function u(c,l,h){var f,d;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(f=n(c),(d=z(f,l))||(f=t(l,{channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,offset:f.offset.value}),null!==o&&f.start(o),null!==s&&f.stop(s)),i.set(l,f),!d){u.next=9;break}return u.next=7,e(l,c.offset,f.offset,h);case 7:u.next=11;break;case 9:return u.next=11,r(l,c.offset,f.offset,h);case 11:return u.next=13,a(c,l,f,h);case 13:return u.abrupt("return",f);case 14:case"end":return u.stop()}}),u)}))),function(e,t,n){return h.apply(this,arguments)})(u,c,l)}}}}(Sn,Vn,ie,An,rn),Vn,on,un,Kt),Un=function(e,t){return function(n,r){var a=n.createConvolver();if(Fe(a,r),r.disableNormalization===a.normalize&&(a.normalize=!r.disableNormalization),Pe(a,r,"buffer"),r.channelCount>2)throw e();if(t(a,"channelCount",(function(e){return function(){return e.call(a)}}),(function(t){return function(n){if(n>2)throw e();return t.call(a,n)}})),"max"===r.channelCountMode)throw e();return t(a,"channelCountMode",(function(e){return function(){return e.call(a)}}),(function(t){return function(n){if("max"===n)throw e();return t.call(a,n)}})),a}}(Nt,jt),Wn=function(e,t,n,r,a,i){return function(e){_inherits(s,e);var o=_createSuper(s);function s(e,u){var c;_classCallCheck2(this,s);var l=r(e),h=_objectSpread(_objectSpread({},xe),u),f=n(l,h);return(c=o.call(this,e,!1,f,a(l)?t():null))._isBufferNullified=!1,c._nativeConvolverNode=f,null!==h.buffer&&i(_assertThisInitialized(c),h.buffer.duration),c}return _createClass2(s,[{key:"buffer",get:function(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer},set:function(e){this._nativeConvolverNode.buffer=e,null===e&&null!==this._nativeConvolverNode.buffer?(this._nativeConvolverNode.buffer=this._nativeConvolverNode.context.createBuffer(1,1,44100),this._isBufferNullified=!0,i(this,0)):(this._isBufferNullified=!1,i(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration))}},{key:"normalize",get:function(){return this._nativeConvolverNode.normalize},set:function(e){this._nativeConvolverNode.normalize=e}}]),s}(e)}(mn,function(e,t,n){return function(){var r=new WeakMap;return{render:function(a,i,o){var s,u=r.get(i);return void 0!==u?Promise.resolve(u):(s=_asyncToGenerator(regeneratorRuntime.mark((function a(i,o,s){var u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(u=t(i),z(u,o)||(u=e(o,{buffer:u.buffer,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,disableNormalization:!u.normalize})),r.set(o,u),!$(u)){a.next=8;break}return a.next=6,n(i,o,u.inputs[0],s);case 6:a.next=10;break;case 8:return a.next=10,n(i,o,u,s);case 10:return a.abrupt("return",u);case 11:case"end":return a.stop()}}),a)}))),function(e,t,n){return s.apply(this,arguments)})(a,i,o)}}}}(Un,ie,rn),Un,on,un,Dn),Gn=function(e,t,n,r,a,i,o){return function(e){_inherits(u,e);var s=_createSuper(u);function u(e,c){var l;_classCallCheck2(this,u);var h=a(e),f=_objectSpread(_objectSpread({},Ce),c),d=r(h,f),p=i(h);return(l=s.call(this,e,!1,d,p?n(f.maxDelayTime):null))._delayTime=t(_assertThisInitialized(l),p,d.delayTime),o(_assertThisInitialized(l),f.maxDelayTime),l}return _createClass2(u,[{key:"delayTime",get:function(){return this._delayTime}}]),u}(e)}(mn,In,function(e,t,n,r,a){return function(i){var o=new WeakMap;return{render:function(s,u,c){var l,h=o.get(u);return void 0!==h?Promise.resolve(h):(l=_asyncToGenerator(regeneratorRuntime.mark((function s(u,c,l){var h,f;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(h=n(u),(f=z(h,c))||(h=t(c,{channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,delayTime:h.delayTime.value,maxDelayTime:i})),o.set(c,h),!f){s.next=9;break}return s.next=7,e(c,u.delayTime,h.delayTime,l);case 7:s.next=11;break;case 9:return s.next=11,r(c,u.delayTime,h.delayTime,l);case 11:return s.next=13,a(u,c,h,l);case 13:return s.abrupt("return",h);case 14:case"end":return s.stop()}}),s)}))),function(e,t,n){return l.apply(this,arguments)})(s,u,c)}}}}(Sn,We,ie,An,rn),We,on,un,Dn),Hn=(kt=Nt,function(e,t){var n=e.createDynamicsCompressor();if(Fe(n,t),t.channelCount>2)throw kt();if("max"===t.channelCountMode)throw kt();return Le(n,t,"attack"),Le(n,t,"knee"),Le(n,t,"ratio"),Le(n,t,"release"),Le(n,t,"threshold"),n}),Kn=function(e,t,n,r,a,i,o,s){return function(e){_inherits(c,e);var u=_createSuper(c);function c(e,a){var l;_classCallCheck2(this,c);var h=i(e),f=_objectSpread(_objectSpread({},Te),a),d=r(h,f),p=o(h);return(l=u.call(this,e,!1,d,p?n():null))._attack=t(_assertThisInitialized(l),p,d.attack),l._knee=t(_assertThisInitialized(l),p,d.knee),l._nativeDynamicsCompressorNode=d,l._ratio=t(_assertThisInitialized(l),p,d.ratio),l._release=t(_assertThisInitialized(l),p,d.release),l._threshold=t(_assertThisInitialized(l),p,d.threshold),s(_assertThisInitialized(l),.006),l}return _createClass2(c,[{key:"attack",get:function(){return this._attack}},{key:"channelCount",get:function(){return this._nativeDynamicsCompressorNode.channelCount},set:function(e){var t=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=e,e>2)throw this._nativeDynamicsCompressorNode.channelCount=t,a()}},{key:"channelCountMode",get:function(){return this._nativeDynamicsCompressorNode.channelCountMode},set:function(e){var t=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=e,"max"===e)throw this._nativeDynamicsCompressorNode.channelCountMode=t,a()}},{key:"knee",get:function(){return this._knee}},{key:"ratio",get:function(){return this._ratio}},{key:"reduction",get:function(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}},{key:"release",get:function(){return this._release}},{key:"threshold",get:function(){return this._threshold}}]),c}(e)}(mn,In,function(e,t,n,r,a){return function(){var i=new WeakMap;return{render:function(o,s,u){var c,l=i.get(s);return void 0!==l?Promise.resolve(l):(c=_asyncToGenerator(regeneratorRuntime.mark((function o(s,u,c){var l,h;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(l=n(s),(h=z(l,u))||(l=t(u,{attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value})),i.set(u,l),!h){o.next=17;break}return o.next=7,e(u,s.attack,l.attack,c);case 7:return o.next=9,e(u,s.knee,l.knee,c);case 9:return o.next=11,e(u,s.ratio,l.ratio,c);case 11:return o.next=13,e(u,s.release,l.release,c);case 13:return o.next=15,e(u,s.threshold,l.threshold,c);case 15:o.next=27;break;case 17:return o.next=19,r(u,s.attack,l.attack,c);case 19:return o.next=21,r(u,s.knee,l.knee,c);case 21:return o.next=23,r(u,s.ratio,l.ratio,c);case 23:return o.next=25,r(u,s.release,l.release,c);case 25:return o.next=27,r(u,s.threshold,l.threshold,c);case 27:return o.next=29,a(s,u,l,c);case 29:return o.abrupt("return",l);case 30:case"end":return o.stop()}}),o)}))),function(e,t,n){return c.apply(this,arguments)})(o,s,u)}}}}(Sn,Hn,ie,An,rn),Hn,Nt,on,un,Dn),Xn=function(e,t,n,r,a,i){return function(e){_inherits(s,e);var o=_createSuper(s);function s(e,u){var c;_classCallCheck2(this,s);var l=a(e),h=_objectSpread(_objectSpread({},Ae),u),f=r(l,h),d=i(l);return(c=o.call(this,e,!1,f,d?n():null))._gain=t(_assertThisInitialized(c),d,f.gain,34028234663852886e22,-34028234663852886e22),c}return _createClass2(s,[{key:"gain",get:function(){return this._gain}}]),s}(e)}(mn,In,function(e,t,n,r,a){return function(){var i=new WeakMap;return{render:function(o,s,u){var c,l=i.get(s);return void 0!==l?Promise.resolve(l):(c=_asyncToGenerator(regeneratorRuntime.mark((function o(s,u,c){var l,h;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(l=n(s),(h=z(l,u))||(l=t(u,{channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value})),i.set(u,l),!h){o.next=9;break}return o.next=7,e(u,s.gain,l.gain,c);case 7:o.next=11;break;case 9:return o.next=11,r(u,s.gain,l.gain,c);case 11:return o.next=13,a(s,u,l,c);case 13:return o.abrupt("return",l);case 14:case"end":return o.stop()}}),o)}))),function(e,t,n){return c.apply(this,arguments)})(o,s,u)}}}}(Sn,Ge,ie,An,rn),Ge,on,un),Qn=function(e,t,n,r){return function(a,i,o){var s=o.channelCount,u=o.channelCountMode,c=o.channelInterpretation,l=o.feedback,h=o.feedforward,f=je(i,a.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),p=h instanceof Float64Array?h:new Float64Array(h),m=d.length,v=p.length,g=Math.min(m,v);if(0===m||m>20)throw r();if(0===d[0])throw t();if(0===v||v>20)throw r();if(0===p[0])throw t();if(1!==d[0]){for(var y=0;y<v;y+=1)p[y]/=d[0];for(var _=1;_<m;_+=1)d[_]/=d[0]}var b=n(a,f,s,s);b.channelCount=s,b.channelCountMode=u,b.channelInterpretation=c;for(var k=[],w=[],x=[],C=0;C<s;C+=1){k.push(0);var S=new Float32Array(32),T=new Float32Array(32);S.fill(0),T.fill(0),w.push(S),x.push(T)}b.onaudioprocess=function(e){for(var t=e.inputBuffer,n=e.outputBuffer,r=t.numberOfChannels,a=0;a<r;a+=1){var i=t.getChannelData(a),o=n.getChannelData(a);k[a]=Oe(d,m,p,v,g,w[a],x[a],k[a],32,i,o)}};var A=a.sampleRate/2;return Ue({get bufferSize(){return f},get channelCount(){return b.channelCount},set channelCount(e){b.channelCount=e},get channelCountMode(){return b.channelCountMode},set channelCountMode(e){b.channelCountMode=e},get channelInterpretation(){return b.channelInterpretation},set channelInterpretation(e){b.channelInterpretation=e},get context(){return b.context},get inputs(){return[b]},get numberOfInputs(){return b.numberOfInputs},get numberOfOutputs(){return b.numberOfOutputs},addEventListener:function(){return b.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent:function(){return b.dispatchEvent(arguments.length<=0?void 0:arguments[0])},getFrequencyResponse:function(t,n,r){if(t.length!==n.length||n.length!==r.length)throw e();for(var a,i,o,s=t.length,u=0;u<s;u+=1){var c=-Math.PI*(t[u]/A),l=[Math.cos(c),Math.sin(c)],h=(a=He(p,l),i=He(d,l),o=void 0,o=i[0]*i[0]+i[1]*i[1],[(a[0]*i[0]+a[1]*i[1])/o,(a[1]*i[0]-a[0]*i[1])/o]);n[u]=Math.sqrt(h[0]*h[0]+h[1]*h[1]),r[u]=Math.atan2(h[1],h[0])}},removeEventListener:function(){return b.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}},b)}}(Ie,Ee,Ot,Nt),Yn=function(e,t,n,r){return function(a){return e(De,(function(){return De(a)}))?Promise.resolve(e(r,r)).then((function(e){if(!e){var t=n(a,512,0,1);a.oncomplete=function(){t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=function(){return a.currentTime},t.connect(a.destination)}return a.startRendering()})):new Promise((function(e){var n=t(a,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});a.oncomplete=function(t){n.disconnect(),e(t.renderedBuffer)},n.connect(a.destination),a.startRendering()}))}}($t,Ge,Ot,function(e,t){return function(){if(null===t)return Promise.resolve(!1);var n=new t(1,1,44100),r=e(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((function(e){n.oncomplete=function(){r.disconnect(),e(0!==n.currentTime)},n.startRendering()}))}}(Ge,sn)),Zn=function(e,t,n,r,a){return function(i,o){var s=new WeakMap,u=null;return{render:function(c,l,h){var f,d=s.get(l);return void 0!==d?Promise.resolve(d):(f=_asyncToGenerator(regeneratorRuntime.mark((function c(l,h,f){var d,p,m,v,g;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(d=null,p=t(l),m=z(p,h),void 0===h.createIIRFilter?d=e(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):m||(p=h.createIIRFilter(o,i)),s.set(h,null===d?p:d),null===d){c.next=12;break}if(null!==u){c.next=8;break}if(null!==n){c.next=6;break}throw new Error("Missing the native OfflineAudioContext constructor.");case 6:v=new n(l.context.destination.channelCount,l.context.length,h.sampleRate),u=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(l,v,v.destination,f);case 2:return e.t0=function(e,t,n,r){var a=n instanceof Float64Array?n:new Float64Array(n),i=r instanceof Float64Array?r:new Float64Array(r),o=a.length,s=i.length,u=Math.min(o,s);if(1!==a[0]){for(var c=0;c<o;c+=1)i[c]/=a[0];for(var l=1;l<s;l+=1)a[l]/=a[0]}for(var h=new Float32Array(32),f=new Float32Array(32),d=t.createBuffer(e.numberOfChannels,e.length,e.sampleRate),p=e.numberOfChannels,m=0;m<p;m+=1){var v=e.getChannelData(m),g=d.getChannelData(m);h.fill(0),f.fill(0),Oe(a,o,i,s,u,h,f,0,32,v,g)}return d},e.next=5,a(v);case 5:return e.t1=e.sent,e.t2=h,e.t3=i,e.t4=o,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3,e.t4));case 10:case"end":return e.stop()}}),e)})))();case 8:return c.next=10,u;case 10:return g=c.sent,c.abrupt("return",(d.buffer=g,d.start(0),d));case 12:return c.next=14,r(l,h,p,f);case 14:return c.abrupt("return",p);case 15:case"end":return c.stop()}}),c)}))),function(e,t,n){return f.apply(this,arguments)})(c,l,h)}}}}(Tn,ie,sn,rn,Yn),Jn=function(e,t,n,r,a,i){return function(e){_inherits(s,e);var o=_createSuper(s);function s(e,u){var c;_classCallCheck2(this,s);var l=r(e),h=a(l),f=_objectSpread(_objectSpread({},Re),u),d=t(l,h?null:e.baseLatency,f);return c=o.call(this,e,!1,d,h?n(f.feedback,f.feedforward):null),function(e){var t;e.getFrequencyResponse=(t=e.getFrequencyResponse,function(n,r,a){if(n.length!==r.length||r.length!==a.length)throw Ie();return t.call(e,n,r,a)})}(d),c._nativeIIRFilterNode=d,i(_assertThisInitialized(c),1),c}return _createClass2(s,[{key:"getFrequencyResponse",value:function(e,t,n){return this._nativeIIRFilterNode.getFrequencyResponse(e,t,n)}}]),s}(e)}(mn,(wt=Qn,function(e,t,n){if(void 0===e.createIIRFilter)return wt(e,t,n);var r=e.createIIRFilter(n.feedforward,n.feedback);return Fe(r,n),r}),Zn,on,un,Dn),$n=function(e,t,n,r,a){return function(i,o){var s,u,c,l,h,f,d=o.listener,p=void 0===d.forwardX?(s=t(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),u=a(o),c=r(o,256,9,0),l=function(t,r){var a=n(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:r});return a.connect(s,0,t),a.start(),Object.defineProperty(a.offset,"defaultValue",{get:function(){return r}}),e({context:i},u,a.offset,34028234663852886e22,-34028234663852886e22)},h=[0,0,-1,0,1,0],f=[0,0,0],c.onaudioprocess=function(e){var t=e.inputBuffer,n=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0],t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];n.some((function(e,t){return e!==h[t]}))&&(d.setOrientation.apply(d,n),h=n);var r=[t.getChannelData(6)[0],t.getChannelData(7)[0],t.getChannelData(8)[0]];r.some((function(e,t){return e!==f[t]}))&&(d.setPosition.apply(d,r),f=r)},s.connect(c),{forwardX:l(0,0),forwardY:l(1,0),forwardZ:l(2,-1),positionX:l(6,0),positionY:l(7,0),positionZ:l(8,0),upX:l(3,0),upY:l(4,1),upZ:l(5,0)}):d,m=p.forwardX,v=p.forwardY,g=p.forwardZ,y=p.positionX,_=p.positionY,b=p.positionZ,k=p.upX,w=p.upY,x=p.upZ;return{get forwardX(){return m},get forwardY(){return v},get forwardZ(){return g},get positionX(){return y},get positionY(){return _},get positionZ(){return b},get upX(){return k},get upY(){return w},get upZ(){return x}}}}(In,Ln,Vn,Ot,un),er=new WeakMap,tr=function(e,t,n,r,a,i){return function(n){_inherits(s,n);var o=_createSuper(s);function s(n,i){var u;return _classCallCheck2(this,s),(u=o.call(this,n))._nativeContext=n,_.set(_assertThisInitialized(u),n),r(n)&&a.set(n,new Set),u._destination=new e(_assertThisInitialized(u),i),u._listener=t(_assertThisInitialized(u),n),u._onstatechange=null,u}return _createClass2(s,[{key:"currentTime",get:function(){return this._nativeContext.currentTime}},{key:"destination",get:function(){return this._destination}},{key:"listener",get:function(){return this._listener}},{key:"onstatechange",get:function(){return this._onstatechange},set:function(e){var t="function"==typeof e?i(this,e):null;this._nativeContext.onstatechange=t;var n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===t?e:n}},{key:"sampleRate",get:function(){return this._nativeContext.sampleRate}},{key:"state",get:function(){return this._nativeContext.state}}]),s}(n)}(On,$n,ln,un,er,Kt),nr=function(e,t,n,r,a,i){return function(o,s){var u=o.createOscillator();return Fe(u,s),Le(u,s,"detune"),Le(u,s,"frequency"),void 0!==s.periodicWave?u.setPeriodicWave(s.periodicWave):Pe(u,s,"type"),t(n,(function(){return n(o)}))||ze(u),t(r,(function(){return r(o)}))||i(u,o),t(a,(function(){return a(o)}))||Be(u),e(o,u),u}}(xn,$t,Vt,qt,Ut,Ht),rr=function(e,t,n,r,a,i,o){return function(e){_inherits(u,e);var s=_createSuper(u);function u(e,o){var c;_classCallCheck2(this,u);var l=a(e),h=_objectSpread(_objectSpread({},Pt),o),f=n(l,h),d=i(l),p=d?r():null,m=e.sampleRate/2;return(c=s.call(this,e,!1,f,p))._detune=t(_assertThisInitialized(c),d,f.detune,153600,-153600),c._frequency=t(_assertThisInitialized(c),d,f.frequency,m,-m),c._nativeOscillatorNode=f,c._onended=null,c._oscillatorNodeRenderer=p,null!==c._oscillatorNodeRenderer&&void 0!==h.periodicWave&&(c._oscillatorNodeRenderer.periodicWave=h.periodicWave),c}return _createClass2(u,[{key:"setPeriodicWave",value:function(e){this._nativeOscillatorNode.setPeriodicWave(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=e)}},{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){D(this);var n=function t(){e._nativeOscillatorNode.removeEventListener("ended",t),U(e)&&F(e)};this._nativeOscillatorNode.addEventListener("ended",n)}}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._nativeOscillatorNode.stop(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=e)}},{key:"detune",get:function(){return this._detune}},{key:"frequency",get:function(){return this._frequency}},{key:"onended",get:function(){return this._onended},set:function(e){var t="function"==typeof e?o(this,e):null;this._nativeOscillatorNode.onended=t;var n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===t?e:n}},{key:"type",get:function(){return this._nativeOscillatorNode.type},set:function(e){this._nativeOscillatorNode.type=e,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}}]),u}(e)}(mn,In,nr,function(e,t,n,r,a){return function(){var i=new WeakMap,o=null,s=null,u=null;return{set periodicWave(e){o=e},set start(e){s=e},set stop(e){u=e},render:function(c,l,h){var f,d=i.get(l);return void 0!==d?Promise.resolve(d):(f=_asyncToGenerator(regeneratorRuntime.mark((function c(l,h,f){var d,p;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(d=n(l),(p=z(d,h))||(d=t(h,{channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:null===o?void 0:o,type:d.type}),null!==s&&d.start(s),null!==u&&d.stop(u)),i.set(h,d),!p){c.next=11;break}return c.next=7,e(h,l.detune,d.detune,f);case 7:return c.next=9,e(h,l.frequency,d.frequency,f);case 9:c.next=15;break;case 11:return c.next=13,r(h,l.detune,d.detune,f);case 13:return c.next=15,r(h,l.frequency,d.frequency,f);case 15:return c.next=17,a(l,h,d,f);case 17:return c.abrupt("return",d);case 18:case"end":return c.stop()}}),c)}))),function(e,t,n){return f.apply(this,arguments)})(c,l,h)}}}}(Sn,nr,ie,An,rn),on,un,Kt),ar=(xt=Tn,function(e,t){var n=xt(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),r=e.createBuffer(1,2,44100);return n.buffer=r,n.loop=!0,n.connect(t),n.start(),function(){n.stop(),n.disconnect(t)}}),ir=function(e,t,n,r,a){return function(i,o){var s=o.curve,u=o.oversample,c=_objectWithoutProperties(o,["curve","oversample"]),l=i.createWaveShaper(),h=i.createWaveShaper();Fe(l,c),Fe(h,c);var f=n(i,_objectSpread(_objectSpread({},c),{},{gain:1})),d=n(i,_objectSpread(_objectSpread({},c),{},{gain:-1})),p=n(i,_objectSpread(_objectSpread({},c),{},{gain:1})),m=n(i,_objectSpread(_objectSpread({},c),{},{gain:-1})),v=null,g=!1,y=null,_={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(e){f.channelCount=e,d.channelCount=e,l.channelCount=e,p.channelCount=e,h.channelCount=e,m.channelCount=e},get channelCountMode(){return l.channelCountMode},set channelCountMode(e){f.channelCountMode=e,d.channelCountMode=e,l.channelCountMode=e,p.channelCountMode=e,h.channelCountMode=e,m.channelCountMode=e},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(e){f.channelInterpretation=e,d.channelInterpretation=e,l.channelInterpretation=e,p.channelInterpretation=e,h.channelInterpretation=e,m.channelInterpretation=e},get context(){return l.context},get curve(){return y},set curve(n){if(null!==n&&n.length<2)throw t();if(null===n)l.curve=n,h.curve=n;else{var a=n.length,o=new Float32Array(a+2-a%2),s=new Float32Array(a+2-a%2);o[0]=n[0],s[0]=-n[a-1];for(var u=Math.ceil((a+1)/2),c=(a+1)/2-1,d=1;d<u;d+=1){var p=d/u*c,m=Math.floor(p),_=Math.ceil(p);o[d]=m===_?n[m]:(1-(p-m))*n[m]+(1-(_-p))*n[_],s[d]=m===_?-n[a-1-m]:-(1-(p-m))*n[a-1-m]-(1-(_-p))*n[a-1-_]}o[u]=a%2==1?n[u-1]:(n[u-2]+n[u-1])/2,l.curve=o,h.curve=s}y=n,g&&(r(y)&&null===v?v=e(i,f):null!==v&&(v(),v=null))},get inputs(){return[f]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(e){l.oversample=e,h.oversample=e},addEventListener:function(){return f.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent:function(){return f.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener:function(){return f.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}};return null!==s&&(_.curve=s instanceof Float32Array?s:new Float32Array(s)),u!==_.oversample&&(_.oversample=u),a(Ue(_,p),(function(){f.connect(l).connect(p),f.connect(d).connect(h).connect(m).connect(p),g=!0,r(y)&&(v=e(i,f))}),(function(){f.disconnect(l),l.disconnect(p),f.disconnect(d),d.disconnect(h),h.disconnect(m),m.disconnect(p),g=!1,null!==v&&(v(),v=null)}))}}(ar,Ee,Ge,Bt,Fn),or=function(e,t,n,r,a,i,o){return function(s,u){var c=s.createWaveShaper();if(null!==i&&"webkitAudioContext"===i.name)return n(s,u);Fe(c,u);var l=null===u.curve||u.curve instanceof Float32Array?u.curve:new Float32Array(u.curve);if(null!==l&&l.length<2)throw t();Pe(c,{curve:l},"curve"),Pe(c,u,"oversample");var h=null,f=!1;return o(c,"curve",(function(e){return function(){return e.call(c)}}),(function(t){return function(n){return t.call(c,n),f&&(r(n)&&null===h?h=e(s,c):r(n)||null===h||(h(),h=null)),n}})),a(c,(function(){f=!0,r(c.curve)&&(h=e(s,c))}),(function(){f=!1,null!==h&&(h(),h=null)}))}}(ar,Ee,ir,Bt,Fn,hn,jt),sr=function(e,t,n,r,a,i,o,s,u){return function(c,l){var h=l.coneInnerAngle,f=l.coneOuterAngle,d=l.coneOuterGain,p=l.distanceModel,m=l.maxDistance,v=l.orientationX,g=l.orientationY,y=l.orientationZ,_=l.panningModel,b=l.positionX,k=l.positionY,w=l.positionZ,x=l.refDistance,C=l.rolloffFactor,S=_objectWithoutProperties(l,["coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","orientationX","orientationY","orientationZ","panningModel","positionX","positionY","positionZ","refDistance","rolloffFactor"]),T=c.createPanner();if(S.channelCount>2)throw o();if("max"===S.channelCountMode)throw o();Fe(T,S);var A={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},E=n(c,_objectSpread(_objectSpread({},A),{},{channelInterpretation:"speakers",numberOfInputs:6})),I=r(c,_objectSpread(_objectSpread({},S),{},{gain:1})),R=r(c,_objectSpread(_objectSpread({},A),{},{gain:1})),O=r(c,_objectSpread(_objectSpread({},A),{},{gain:0})),N=r(c,_objectSpread(_objectSpread({},A),{},{gain:0})),D=r(c,_objectSpread(_objectSpread({},A),{},{gain:0})),P=r(c,_objectSpread(_objectSpread({},A),{},{gain:0})),F=r(c,_objectSpread(_objectSpread({},A),{},{gain:0})),M=a(c,256,6,1),L=i(c,_objectSpread(_objectSpread({},A),{},{curve:new Float32Array([1,1]),oversample:"none"})),z=[v,g,y],B=[b,k,w];M.onaudioprocess=function(e){var t=e.inputBuffer,n=[t.getChannelData(0)[0],t.getChannelData(1)[0],t.getChannelData(2)[0]];n.some((function(e,t){return e!==z[t]}))&&(T.setOrientation.apply(T,n),z=n);var r=[t.getChannelData(3)[0],t.getChannelData(4)[0],t.getChannelData(5)[0]];r.some((function(e,t){return e!==B[t]}))&&(T.setPosition.apply(T,r),B=r)},Object.defineProperty(O.gain,"defaultValue",{get:function(){return 0}}),Object.defineProperty(N.gain,"defaultValue",{get:function(){return 0}}),Object.defineProperty(D.gain,"defaultValue",{get:function(){return 0}}),Object.defineProperty(P.gain,"defaultValue",{get:function(){return 0}}),Object.defineProperty(F.gain,"defaultValue",{get:function(){return 0}});var j={get bufferSize(){},get channelCount(){return T.channelCount},set channelCount(e){if(e>2)throw o();I.channelCount=e,T.channelCount=e},get channelCountMode(){return T.channelCountMode},set channelCountMode(e){if("max"===e)throw o();I.channelCountMode=e,T.channelCountMode=e},get channelInterpretation(){return T.channelInterpretation},set channelInterpretation(e){I.channelInterpretation=e,T.channelInterpretation=e},get coneInnerAngle(){return T.coneInnerAngle},set coneInnerAngle(e){T.coneInnerAngle=e},get coneOuterAngle(){return T.coneOuterAngle},set coneOuterAngle(e){T.coneOuterAngle=e},get coneOuterGain(){return T.coneOuterGain},set coneOuterGain(e){if(e<0||e>1)throw t();T.coneOuterGain=e},get context(){return T.context},get distanceModel(){return T.distanceModel},set distanceModel(e){T.distanceModel=e},get inputs(){return[I]},get maxDistance(){return T.maxDistance},set maxDistance(e){if(e<0)throw new RangeError;T.maxDistance=e},get numberOfInputs(){return T.numberOfInputs},get numberOfOutputs(){return T.numberOfOutputs},get orientationX(){return R.gain},get orientationY(){return O.gain},get orientationZ(){return N.gain},get panningModel(){return T.panningModel},set panningModel(e){T.panningModel=e},get positionX(){return D.gain},get positionY(){return P.gain},get positionZ(){return F.gain},get refDistance(){return T.refDistance},set refDistance(e){if(e<0)throw new RangeError;T.refDistance=e},get rolloffFactor(){return T.rolloffFactor},set rolloffFactor(e){if(e<0)throw new RangeError;T.rolloffFactor=e},addEventListener:function(){return I.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent:function(){return I.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener:function(){return I.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}};return h!==j.coneInnerAngle&&(j.coneInnerAngle=h),f!==j.coneOuterAngle&&(j.coneOuterAngle=f),d!==j.coneOuterGain&&(j.coneOuterGain=d),p!==j.distanceModel&&(j.distanceModel=p),m!==j.maxDistance&&(j.maxDistance=m),v!==j.orientationX.value&&(j.orientationX.value=v),g!==j.orientationY.value&&(j.orientationY.value=g),y!==j.orientationZ.value&&(j.orientationZ.value=y),_!==j.panningModel&&(j.panningModel=_),b!==j.positionX.value&&(j.positionX.value=b),k!==j.positionY.value&&(j.positionY.value=k),w!==j.positionZ.value&&(j.positionZ.value=w),x!==j.refDistance&&(j.refDistance=x),C!==j.rolloffFactor&&(j.rolloffFactor=C),1===z[0]&&0===z[1]&&0===z[2]||T.setOrientation.apply(T,_toConsumableArray(z)),0===B[0]&&0===B[1]&&0===B[2]||T.setPosition.apply(T,_toConsumableArray(B)),u(Ue(j,T),(function(){I.connect(T),e(I,L,0,0),L.connect(R).connect(E,0,0),L.connect(O).connect(E,0,1),L.connect(N).connect(E,0,2),L.connect(D).connect(E,0,3),L.connect(P).connect(E,0,4),L.connect(F).connect(E,0,5),E.connect(M).connect(c.destination)}),(function(){I.disconnect(T),s(I,L,0,0),L.disconnect(R),R.disconnect(E),L.disconnect(O),O.disconnect(E),L.disconnect(N),N.disconnect(E),L.disconnect(D),D.disconnect(E),L.disconnect(P),P.disconnect(E),L.disconnect(F),F.disconnect(E),E.disconnect(M),M.disconnect(c.destination)}))}}(ee,Ee,Ln,Ge,Ot,or,Nt,ae,Fn),ur=(Ct=sr,function(e,t){var n=e.createPanner();return void 0===n.orientationX?Ct(e,t):(Fe(n,t),Le(n,t,"orientationX"),Le(n,t,"orientationY"),Le(n,t,"orientationZ"),Le(n,t,"positionX"),Le(n,t,"positionY"),Le(n,t,"positionZ"),Pe(n,t,"coneInnerAngle"),Pe(n,t,"coneOuterAngle"),Pe(n,t,"coneOuterGain"),Pe(n,t,"distanceModel"),Pe(n,t,"maxDistance"),Pe(n,t,"panningModel"),Pe(n,t,"refDistance"),Pe(n,t,"rolloffFactor"),n)}),cr=function(e,t,n,r,a,i,o){return function(e){_inherits(u,e);var s=_createSuper(u);function u(e,c){var l;_classCallCheck2(this,u);var h=a(e),f=_objectSpread(_objectSpread({},Ft),c),d=n(h,f),p=i(h);return(l=s.call(this,e,!1,d,p?r():null))._nativePannerNode=d,l._orientationX=t(_assertThisInitialized(l),p,d.orientationX,34028234663852886e22,-34028234663852886e22),l._orientationY=t(_assertThisInitialized(l),p,d.orientationY,34028234663852886e22,-34028234663852886e22),l._orientationZ=t(_assertThisInitialized(l),p,d.orientationZ,34028234663852886e22,-34028234663852886e22),l._positionX=t(_assertThisInitialized(l),p,d.positionX,34028234663852886e22,-34028234663852886e22),l._positionY=t(_assertThisInitialized(l),p,d.positionY,34028234663852886e22,-34028234663852886e22),l._positionZ=t(_assertThisInitialized(l),p,d.positionZ,34028234663852886e22,-34028234663852886e22),o(_assertThisInitialized(l),1),l}return _createClass2(u,[{key:"coneInnerAngle",get:function(){return this._nativePannerNode.coneInnerAngle},set:function(e){this._nativePannerNode.coneInnerAngle=e}},{key:"coneOuterAngle",get:function(){return this._nativePannerNode.coneOuterAngle},set:function(e){this._nativePannerNode.coneOuterAngle=e}},{key:"coneOuterGain",get:function(){return this._nativePannerNode.coneOuterGain},set:function(e){this._nativePannerNode.coneOuterGain=e}},{key:"distanceModel",get:function(){return this._nativePannerNode.distanceModel},set:function(e){this._nativePannerNode.distanceModel=e}},{key:"maxDistance",get:function(){return this._nativePannerNode.maxDistance},set:function(e){this._nativePannerNode.maxDistance=e}},{key:"orientationX",get:function(){return this._orientationX}},{key:"orientationY",get:function(){return this._orientationY}},{key:"orientationZ",get:function(){return this._orientationZ}},{key:"panningModel",get:function(){return this._nativePannerNode.panningModel},set:function(e){this._nativePannerNode.panningModel=e}},{key:"positionX",get:function(){return this._positionX}},{key:"positionY",get:function(){return this._positionY}},{key:"positionZ",get:function(){return this._positionZ}},{key:"refDistance",get:function(){return this._nativePannerNode.refDistance},set:function(e){this._nativePannerNode.refDistance=e}},{key:"rolloffFactor",get:function(){return this._nativePannerNode.rolloffFactor},set:function(e){this._nativePannerNode.rolloffFactor=e}}]),u}(e)}(mn,In,ur,function(e,t,n,r,a,i,o,s,u,c){return function(){var l=new WeakMap,h=null;return{render:function(f,d,p){var m,v=l.get(d);return void 0!==v?Promise.resolve(v):(m=_asyncToGenerator(regeneratorRuntime.mark((function f(d,p,m){var v,g,y,_,b,k,w;return regeneratorRuntime.wrap((function(f){for(;;)switch(f.prev=f.next){case 0:if(v=null,g=i(d),y={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},_=_objectSpread(_objectSpread({},y),{},{coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor}),b=z(g,p),"bufferSize"in g?v=r(p,_objectSpread(_objectSpread({},y),{},{gain:1})):b||(k=_objectSpread(_objectSpread({},_),{},{orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value}),g=a(p,k)),l.set(p,null===v?g:v),null===v){f.next=8;break}return f.delegateYield(regeneratorRuntime.mark((function e(){var i,l,f,g,b,k,w,x,C,S,T,A,E,I;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==h){e.next=5;break}if(null!==o){e.next=3;break}throw new Error("Missing the native OfflineAudioContext constructor.");case 3:i=new o(6,d.context.length,p.sampleRate),(l=t(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6})).connect(i.destination),h=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map(function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===r?1:0}),e.next=3,s(i,t,a.offset,m);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 2:for(t=e.sent,r=0;r<6;r+=1)t[r].connect(l,0,r),t[r].start(0);return e.abrupt("return",c(i));case 5:case"end":return e.stop()}}),e)})))();case 5:return e.next=7,h;case 7:return f=e.sent,g=r(p,_objectSpread(_objectSpread({},y),{},{gain:1})),e.next=11,u(d,p,g,m);case 11:for(b=[],k=0;k<f.numberOfChannels;k+=1)b.push(f.getChannelData(k));for(w=[b[0][0],b[1][0],b[2][0]],x=[b[3][0],b[4][0],b[5][0]],C=r(p,_objectSpread(_objectSpread({},y),{},{gain:1})),S=a(p,_objectSpread(_objectSpread({},_),{},{orientationX:w[0],orientationY:w[1],orientationZ:w[2],positionX:x[0],positionY:x[1],positionZ:x[2]})),g.connect(C).connect(S.inputs[0]),S.connect(v),T=128;T<f.length;T+=128)A=[b[0][T],b[1][T],b[2][T]],E=[b[3][T],b[4][T],b[5][T]],(A.some((function(e,t){return e!==w[t]}))||E.some((function(e,t){return e!==x[t]})))&&(w=A,x=E,I=T/p.sampleRate,C.gain.setValueAtTime(0,I),C=r(p,_objectSpread(_objectSpread({},y),{},{gain:0})),S=a(p,_objectSpread(_objectSpread({},_),{},{orientationX:w[0],orientationY:w[1],orientationZ:w[2],positionX:x[0],positionY:x[1],positionZ:x[2]})),C.gain.setValueAtTime(1,I),g.connect(C).connect(S.inputs[0]),S.connect(v));return e.abrupt("return",{v:v});case 17:case"end":return e.stop()}}),e)}))(),"t0",5);case 5:if("object"!=typeof(w=f.t0)){f.next=8;break}return f.abrupt("return",w.v);case 8:if(!b){f.next=23;break}return f.next=11,e(p,d.orientationX,g.orientationX,m);case 11:return f.next=13,e(p,d.orientationY,g.orientationY,m);case 13:return f.next=15,e(p,d.orientationZ,g.orientationZ,m);case 15:return f.next=17,e(p,d.positionX,g.positionX,m);case 17:return f.next=19,e(p,d.positionY,g.positionY,m);case 19:return f.next=21,e(p,d.positionZ,g.positionZ,m);case 21:f.next=35;break;case 23:return f.next=25,s(p,d.orientationX,g.orientationX,m);case 25:return f.next=27,s(p,d.orientationY,g.orientationY,m);case 27:return f.next=29,s(p,d.orientationZ,g.orientationZ,m);case 29:return f.next=31,s(p,d.positionX,g.positionX,m);case 31:return f.next=33,s(p,d.positionY,g.positionY,m);case 33:return f.next=35,s(p,d.positionZ,g.positionZ,m);case 35:if(!$(g)){f.next=40;break}return f.next=38,u(d,p,g.inputs[0],m);case 38:f.next=42;break;case 40:return f.next=42,u(d,p,g,m);case 42:return f.abrupt("return",g);case 43:case"end":return f.stop()}}),f)}))),function(e,t,n){return m.apply(this,arguments)})(f,d,p)}}}}(Sn,Ln,Vn,Ge,ur,ie,sn,An,rn,Yn),on,un,Dn),lr=function(e,t,n,r){return function(){function r(a,i){_classCallCheck2(this,r);var o=t(a),s=function(e){var t=e.imag,n=e.real;return _objectSpread(_objectSpread({},e),{},void 0===t?void 0===n?{imag:[0,0],real:[0,0]}:{imag:Array.from(n,(function(){return 0})),real:n}:void 0===n?{imag:t,real:Array.from(t,(function(){return 0}))}:{imag:t,real:n})}(_objectSpread(_objectSpread({},Mt),i)),u=e(o,s);return n.add(u),u}return _createClass2(r,null,[{key:Symbol.hasInstance,value:function(e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===r.prototype||n.has(e)}}]),r}()}(function(e){return function(t,n){var r=n.disableNormalization,a=n.imag,i=n.real,o=a instanceof Float32Array?a:new Float32Array(a),s=i instanceof Float32Array?i:new Float32Array(i),u=t.createPeriodicWave(s,o,{disableNormalization:r});if(Array.from(a).length<2)throw e();return u}}(j),on,new WeakSet),hr=function(e,t){return function(n,r){var a=r.channelCountMode;if("clamped-max"===a)throw t();if(void 0===n.createStereoPanner)return e(n,r);var i=n.createStereoPanner();return Fe(i,r),Le(i,r,"pan"),Object.defineProperty(i,"channelCountMode",{get:function(){return a},set:function(e){if(e!==a)throw t()}}),i}}(function(e,t,n,r,a,i){var o=new Float32Array([1,1]),s=Math.PI/2,u={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},c=_objectSpread(_objectSpread({},u),{},{oversample:"none"}),l=function(e,i,l,h,f){if(1===i)return function(e,t,a,i){for(var l=new Float32Array(16385),h=new Float32Array(16385),f=0;f<16385;f+=1){var d=f/16384*s;l[f]=Math.cos(d),h[f]=Math.sin(d)}var p=n(e,_objectSpread(_objectSpread({},u),{},{gain:0})),m=r(e,_objectSpread(_objectSpread({},c),{},{curve:l})),v=r(e,_objectSpread(_objectSpread({},c),{},{curve:o})),g=n(e,_objectSpread(_objectSpread({},u),{},{gain:0})),y=r(e,_objectSpread(_objectSpread({},c),{},{curve:h}));return{connectGraph:function(){t.connect(p),t.connect(v.inputs[0]),t.connect(g),v.connect(a),a.connect(m.inputs[0]),a.connect(y.inputs[0]),m.connect(p.gain),y.connect(g.gain),p.connect(i,0,0),g.connect(i,0,1)},disconnectGraph:function(){t.disconnect(p),t.disconnect(v.inputs[0]),t.disconnect(g),v.disconnect(a),a.disconnect(m.inputs[0]),a.disconnect(y.inputs[0]),m.disconnect(p.gain),y.disconnect(g.gain),p.disconnect(i,0,0),g.disconnect(i,0,1)}}}(e,l,h,f);if(2===i)return function(e,a,i,l){for(var h=new Float32Array(16385),f=new Float32Array(16385),d=new Float32Array(16385),p=new Float32Array(16385),m=Math.floor(8192.5),v=0;v<16385;v+=1)if(v>m){var g=(v-m)/(16384-m)*s;h[v]=Math.cos(g),f[v]=Math.sin(g),d[v]=0,p[v]=1}else{var y=v/(16384-m)*s;h[v]=1,f[v]=0,d[v]=Math.cos(y),p[v]=Math.sin(y)}var _=t(e,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),b=n(e,_objectSpread(_objectSpread({},u),{},{gain:0})),k=r(e,_objectSpread(_objectSpread({},c),{},{curve:h})),w=n(e,_objectSpread(_objectSpread({},u),{},{gain:0})),x=r(e,_objectSpread(_objectSpread({},c),{},{curve:f})),C=r(e,_objectSpread(_objectSpread({},c),{},{curve:o})),S=n(e,_objectSpread(_objectSpread({},u),{},{gain:0})),T=r(e,_objectSpread(_objectSpread({},c),{},{curve:d})),A=n(e,_objectSpread(_objectSpread({},u),{},{gain:0})),E=r(e,_objectSpread(_objectSpread({},c),{},{curve:p}));return{connectGraph:function(){a.connect(_),a.connect(C.inputs[0]),_.connect(b,0),_.connect(w,0),_.connect(S,1),_.connect(A,1),C.connect(i),i.connect(k.inputs[0]),i.connect(x.inputs[0]),i.connect(T.inputs[0]),i.connect(E.inputs[0]),k.connect(b.gain),x.connect(w.gain),T.connect(S.gain),E.connect(A.gain),b.connect(l,0,0),S.connect(l,0,0),w.connect(l,0,1),A.connect(l,0,1)},disconnectGraph:function(){a.disconnect(_),a.disconnect(C.inputs[0]),_.disconnect(b,0),_.disconnect(w,0),_.disconnect(S,1),_.disconnect(A,1),C.disconnect(i),i.disconnect(k.inputs[0]),i.disconnect(x.inputs[0]),i.disconnect(T.inputs[0]),i.disconnect(E.inputs[0]),k.disconnect(b.gain),x.disconnect(w.gain),T.disconnect(S.gain),E.disconnect(A.gain),b.disconnect(l,0,0),S.disconnect(l,0,0),w.disconnect(l,0,1),A.disconnect(l,0,1)}}}(e,l,h,f);throw a()};return function(t,r){var o=r.channelCount,s=r.channelCountMode,u=r.pan,c=_objectWithoutProperties(r,["channelCount","channelCountMode","pan"]);if("max"===s)throw a();var h=e(t,_objectSpread(_objectSpread({},c),{},{channelCount:1,channelCountMode:s,numberOfInputs:2})),f=n(t,_objectSpread(_objectSpread({},c),{},{channelCount:o,channelCountMode:s,gain:1})),d=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:u}),p=l(t,o,f,d,h),m=p.connectGraph,v=p.disconnectGraph;Object.defineProperty(d.gain,"defaultValue",{get:function(){return 0}}),Object.defineProperty(d.gain,"minValue",{get:function(){return-1}});var g={get bufferSize(){},get channelCount(){return f.channelCount},set channelCount(e){var n;f.channelCount!==e&&(y&&v(),n=l(t,e,f,d,h),m=n.connectGraph,v=n.disconnectGraph,y&&m()),f.channelCount=e},get channelCountMode(){return f.channelCountMode},set channelCountMode(e){if("clamped-max"===e||"max"===e)throw a();f.channelCountMode=e},get channelInterpretation(){return f.channelInterpretation},set channelInterpretation(e){f.channelInterpretation=e},get context(){return f.context},get inputs(){return[f]},get numberOfInputs(){return f.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get pan(){return d.gain},addEventListener:function(){return f.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent:function(){return f.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener:function(){return f.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}},y=!1;return i(Ue(g,h),(function(){m(),y=!0}),(function(){v(),y=!1}))}}(Ln,qe,Ge,or,Nt,Fn),Nt),fr=function(e,t,n,r,a,i){return function(e){_inherits(s,e);var o=_createSuper(s);function s(e,u){var c;_classCallCheck2(this,s);var l=a(e),h=_objectSpread(_objectSpread({},Lt),u),f=n(l,h),d=i(l);return(c=o.call(this,e,!1,f,d?r():null))._pan=t(_assertThisInitialized(c),d,f.pan),c}return _createClass2(s,[{key:"pan",get:function(){return this._pan}}]),s}(e)}(mn,In,hr,function(e,t,n,r,a){return function(){var i=new WeakMap;return{render:function(o,s,u){var c,l=i.get(s);return void 0!==l?Promise.resolve(l):(c=_asyncToGenerator(regeneratorRuntime.mark((function o(s,u,c){var l,h;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(l=n(s),(h=z(l,u))||(l=t(u,{channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value})),i.set(u,l),!h){o.next=9;break}return o.next=7,e(u,s.pan,l.pan,c);case 7:o.next=11;break;case 9:return o.next=11,r(u,s.pan,l.pan,c);case 11:if(!$(l)){o.next=16;break}return o.next=14,a(s,u,l.inputs[0],c);case 14:o.next=18;break;case 16:return o.next=18,a(s,u,l,c);case 18:return o.abrupt("return",l);case 19:case"end":return o.stop()}}),o)}))),function(e,t,n){return c.apply(this,arguments)})(o,s,u)}}}}(Sn,hr,ie,An,rn),on,un),dr=function(e,t,n){return function(){var r=new WeakMap;return{render:function(a,i,o){var s,u=r.get(i);return void 0!==u?Promise.resolve(u):(s=_asyncToGenerator(regeneratorRuntime.mark((function a(i,o,s){var u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(u=t(i),z(u,o)||(u=e(o,{channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,curve:u.curve,oversample:u.oversample})),r.set(o,u),!$(u)){a.next=8;break}return a.next=6,n(i,o,u.inputs[0],s);case 6:a.next=10;break;case 8:return a.next=10,n(i,o,u,s);case 10:return a.abrupt("return",u);case 11:case"end":return a.stop()}}),a)}))),function(e,t,n){return s.apply(this,arguments)})(a,i,o)}}}}(or,ie,rn),pr=function(e,t,n,r,a,i,o){return function(e){_inherits(u,e);var s=_createSuper(u);function u(e,t){var c;_classCallCheck2(this,u);var l=a(e),h=_objectSpread(_objectSpread({},zt),t),f=n(l,h);return(c=s.call(this,e,!0,f,i(l)?r():null))._isCurveNullified=!1,c._nativeWaveShaperNode=f,o(_assertThisInitialized(c),1),c}return _createClass2(u,[{key:"curve",get:function(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve},set:function(e){if(null===e)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(e.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=e}}},{key:"oversample",get:function(){return this._nativeWaveShaperNode.oversample},set:function(e){this._nativeWaveShaperNode.oversample=e}}]),u}(e)}(mn,Ee,or,dr,on,un,Dn),mr=function(e){return null!==e&&e.isSecureContext}(en),vr=function(e){return function(t,n,r){Object.defineProperties(e,{currentFrame:{configurable:!0,get:function(){return Math.round(t*n)}},currentTime:{configurable:!0,get:function(){return t}}});try{return r()}finally{null!==e&&(delete e.currentFrame,delete e.currentTime)}}}(en),gr=new WeakMap,yr=function(e,t){return function(n){var r=e.get(n);if(void 0!==r)return r;if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new t(1,1,8e3),e.set(n,r),r}}(gr,sn),_r=function(e){return null===e?null:e.hasOwnProperty("AudioWorkletNode")?e.AudioWorkletNode:null}(en),br=mr?function(e,t,n,r,a,i,o,s,u,c,l,h){return function(f,d){var p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{credentials:"omit"},m=i(f),v=new URL(d,h.location.href).toString();if(void 0!==m.audioWorklet)return Promise.all([a(d),Promise.resolve(e(l,l))]).then((function(e){var t=_slicedToArray2(e,2),n=t[0],r=t[1],a=_slicedToArray2(T(n,v),2),i=a[0],u=a[1],c=r?u:u.replace(/\s+extends\s+AudioWorkletProcessor\s*{/," extends (class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}){"),l=new Blob(["".concat(i,";(registerProcessor=>{").concat(c,"\n})((n,p)=>registerProcessor(n,class extends p{").concat(r?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));","process(i,o,p){").concat(r?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));","return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}))")],{type:"application/javascript; charset=utf-8"}),h=URL.createObjectURL(l);return m.audioWorklet.addModule(h,p).then((function(){if(!s(m))return o(m).audioWorklet.addModule(h,p)})).finally((function(){return URL.revokeObjectURL(h)}))}));var g=c.get(f);if(void 0!==g&&g.has(d))return Promise.resolve();var y=u.get(f);if(void 0!==y){var _=y.get(d);if(void 0!==_)return _}var b=a(d).then((function(e){var t=_slicedToArray2(T(e,v),2),r=t[0],a=t[1];return n("".concat(r,";((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{").concat(a,"\n})})(window,'_AWGS')"))})).then((function(){var e=h._AWGS.pop();if(void 0===e)throw new SyntaxError;r(m.currentTime,m.sampleRate,(function(){return e(function(){return function e(){_classCallCheck2(this,e)}}(),void 0,(function(e,n){if(""===e.trim())throw t();var r=w.get(m);if(void 0!==r){if(r.has(e))throw t();E(n),A(n.parameterDescriptors),r.set(e,n)}else E(n),A(n.parameterDescriptors),w.set(m,new Map([[e,n]]))}),m.sampleRate,void 0,void 0)}))}));return void 0===y?u.set(f,new Map([[d,b]])):y.set(d,b),b.then((function(){var e=c.get(f);void 0===e?c.set(f,new Set([d])):e.add(d)})).finally((function(){var e=u.get(f);void 0!==e&&e.delete(d)})),b}}($t,Nt,function(e){return function(t){return new Promise((function(n,r){if(null!==e){var a=e.document.head;if(null===a)r(new SyntaxError);else{var i=e.document.createElement("script"),o=new Blob([t],{type:"application/javascript"}),s=URL.createObjectURL(o),u=e.onerror,c=function(){e.onerror=u,URL.revokeObjectURL(s)};e.onerror=function(t,n,a,i,o){return n===s||n===e.location.href&&1===a&&1===i?(c(),r(o),!1):null!==u?u(t,n,a,i,o):void 0},i.onerror=function(){c(),r(new SyntaxError)},i.onload=function(){c(),n()},i.src=s,i.type="module",a.appendChild(i)}}else r(new SyntaxError)}))}}(en),vr,function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:if(!(n=e.sent).ok){e.next=6;break}return e.abrupt("return",n.text());case 6:e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:throw new DOMException("","AbortError");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),on,yr,un,new WeakMap,new WeakMap,function(e,t){return _asyncToGenerator(regeneratorRuntime.mark((function n(){var r,a,i,o,s,u,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!==e){n.next=2;break}return n.abrupt("return",!0);case 2:if(null!==t){n.next=4;break}return n.abrupt("return",!1);case 4:return r=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),a=new t(1,128,8e3),i=URL.createObjectURL(r),o=!1,s=!1,n.prev=6,n.next=9,a.audioWorklet.addModule(i);case 9:return u=new e(a,"a",{numberOfOutputs:0}),c=a.createOscillator(),u.port.onmessage=function(){return o=!0},u.onprocessorerror=function(){return s=!0},c.connect(u),n.next=15,a.startRendering();case 15:n.next=19;break;case 17:n.prev=17,n.t0=n.catch(6);case 19:return n.prev=19,URL.revokeObjectURL(i),n.finish(19);case 22:return n.abrupt("return",o&&!s);case 23:case"end":return n.stop()}}),n,null,[[6,17,19,22]])})))}(_r,sn),en):void 0,kr=function(e,t){return function(n){return e(n)||t(n)}}(fn,un),wr=function(e,t,n,r,a,i,o,s,u,c,l,h,f,d,p,m,v,g,y,_){return function(p){_inherits(k,p);var b=_createSuper(k);function k(t,n){var r;return _classCallCheck2(this,k),(r=b.call(this,t,n))._nativeContext=t,r._audioWorklet=void 0===e?void 0:{addModule:function(t,n){return e(_assertThisInitialized(r),t,n)}},r}return _createClass2(k,[{key:"createAnalyser",value:function(){return new t(this)}},{key:"createBiquadFilter",value:function(){return new a(this)}},{key:"createBuffer",value:function(e,t,r){return new n({length:t,numberOfChannels:e,sampleRate:r})}},{key:"createBufferSource",value:function(){return new r(this)}},{key:"createChannelMerger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return new i(this,{numberOfInputs:e})}},{key:"createChannelSplitter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return new o(this,{numberOfOutputs:e})}},{key:"createConstantSource",value:function(){return new s(this)}},{key:"createConvolver",value:function(){return new u(this)}},{key:"createDelay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new l(this,{maxDelayTime:e})}},{key:"createDynamicsCompressor",value:function(){return new h(this)}},{key:"createGain",value:function(){return new f(this)}},{key:"createIIRFilter",value:function(e,t){return new d(this,{feedback:t,feedforward:e})}},{key:"createOscillator",value:function(){return new m(this)}},{key:"createPanner",value:function(){return new v(this)}},{key:"createPeriodicWave",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{disableNormalization:!1};return new g(this,_objectSpread(_objectSpread({},n),{},{imag:t,real:e}))}},{key:"createStereoPanner",value:function(){return new y(this)}},{key:"createWaveShaper",value:function(){return new _(this)}},{key:"decodeAudioData",value:function(e,t,n){return c(this._nativeContext,e).then((function(e){return"function"==typeof t&&t(e),e})).catch((function(e){throw"function"==typeof n&&n(e),e}))}},{key:"audioWorklet",get:function(){return this._audioWorklet}}]),k}(p)}(br,vn,wn,Rn,Pn,zn,Bn,qn,Wn,function(e,t,n,r,a,i,o,s,u,c,l){return function(n,r){var h=o(n)?n:i(n);if(a.has(r)){var f=new DOMException("","DataCloneError");return Promise.reject(f)}try{a.add(r)}catch(d){}return t(u,(function(){return u(h)}))?h.decodeAudioData(r).then((function(n){return t(s,(function(){return s(n)}))||l(n),e.add(n),n})):new Promise((function(t,n){var a=function(){try{e=r,(new MessageChannel).port1.postMessage(e,[e])}catch(t){}var e},i=function(e){n(e),a()};try{h.decodeAudioData(r,(function(n){"function"!=typeof n.copyFromChannel&&(c(n),V(n)),e.add(n),a(),t(n)}),(function(e){i(null===e?new DOMException("","EncodingError"):e)}))}catch(o){i(o)}}))}}(gn,$t,0,0,new WeakSet,on,kr,B,De,bn,kn),Gn,Kn,Xn,Jn,tr,rr,cr,lr,fr,pr),xr=function(e,t,n,r){return function(e){_inherits(a,e);var t=_createSuper(a);function a(e,i){var o;_classCallCheck2(this,a);var s=n(e),u=function(e,t){return e.createMediaElementSource(t.mediaElement)}(s,i);if(r(s))throw TypeError();return(o=t.call(this,e,!0,u,null))._nativeMediaElementAudioSourceNode=u,o}return _createClass2(a,[{key:"mediaElement",get:function(){return this._nativeMediaElementAudioSourceNode.mediaElement}}]),a}(e)}(mn,0,on,un),Cr=function(e,t,n,r){return function(e){_inherits(a,e);var t=_createSuper(a);function a(e,i){var o;_classCallCheck2(this,a);var s=n(e);if(r(s))throw new TypeError;var u=function(e,t){var n=e.createMediaStreamDestination();return Fe(n,t),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:function(){return 0}}),n}(s,_objectSpread(_objectSpread({},Ne),i));return(o=t.call(this,e,!1,u,null))._nativeMediaStreamAudioDestinationNode=u,o}return _createClass2(a,[{key:"stream",get:function(){return this._nativeMediaStreamAudioDestinationNode.stream}}]),a}(e)}(mn,0,on,un),Sr=function(e,t,n,r){return function(e){_inherits(a,e);var t=_createSuper(a);function a(e,i){var o;_classCallCheck2(this,a);var s=n(e),u=function(e,t){var n=t.mediaStream,r=n.getAudioTracks();r.sort((function(e,t){return e.id<t.id?-1:e.id>t.id?1:0}));var a=r.slice(0,1),i=e.createMediaStreamSource(new MediaStream(a));return Object.defineProperty(i,"mediaStream",{value:n}),i}(s,i);if(r(s))throw new TypeError;return(o=t.call(this,e,!0,u,null))._nativeMediaStreamAudioSourceNode=u,o}return _createClass2(a,[{key:"mediaStream",get:function(){return this._nativeMediaStreamAudioSourceNode.mediaStream}}]),a}(e)}(mn,0,on,un),Tr=function(e,t,n){return function(e){_inherits(a,e);var r=_createSuper(a);function a(e,i){_classCallCheck2(this,a);var o=n(e);return r.call(this,e,!0,t(o,i),null)}return a}(e)}(mn,function(e,t){return function(n,r){var a=r.mediaStreamTrack;if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(a);var i=new MediaStream([a]),o=n.createMediaStreamSource(i);if("audio"!==a.kind)throw e();if(t(n))throw new TypeError;return o}}(Ee,un),on),Ar=function(e,t,n,r,a,i,o,s,u){return function(e){_inherits(l,e);var c=_createSuper(l);function l(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck2(this,l),null===u)throw new Error("Missing the native AudioContext constructor.");var a=new u(t);if(null===a)throw r();if(!function(e){return void 0===e||"number"==typeof e||"string"==typeof e&&("balanced"===e||"interactive"===e||"playback"===e)}(t.latencyHint))throw new TypeError("The provided value '".concat(t.latencyHint,"' is not a valid enum value of type AudioContextLatencyCategory."));if(void 0!==t.sampleRate&&a.sampleRate!==t.sampleRate)throw n();e=c.call(this,a,2);var i=t.latencyHint,o=a.sampleRate;if(e._baseLatency="number"==typeof a.baseLatency?a.baseLatency:"balanced"===i?512/o:"interactive"===i||void 0===i?256/o:"playback"===i?1024/o:128*Math.max(2,Math.min(128,Math.round(i*o/128)))/o,e._nativeAudioContext=a,"webkitAudioContext"===u.name?(e._nativeGainNode=a.createGain(),e._nativeOscillatorNode=a.createOscillator(),e._nativeGainNode.gain.value=1e-37,e._nativeOscillatorNode.connect(e._nativeGainNode).connect(a.destination),e._nativeOscillatorNode.start()):(e._nativeGainNode=null,e._nativeOscillatorNode=null),e._state=null,"running"===a.state){e._state="suspended";var s=function t(){"suspended"===e._state&&(e._state=null),a.removeEventListener("statechange",t)};a.addEventListener("statechange",s)}return e}return _createClass2(l,[{key:"close",value:function(){var e=this;return"closed"===this.state?this._nativeAudioContext.close().then((function(){throw t()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((function(){null!==e._nativeGainNode&&null!==e._nativeOscillatorNode&&(e._nativeOscillatorNode.stop(),e._nativeGainNode.disconnect(),e._nativeOscillatorNode.disconnect()),K(e)})))}},{key:"createMediaElementSource",value:function(e){return new a(this,{mediaElement:e})}},{key:"createMediaStreamDestination",value:function(){return new i(this)}},{key:"createMediaStreamSource",value:function(e){return new o(this,{mediaStream:e})}},{key:"createMediaStreamTrackSource",value:function(e){return new s(this,{mediaStreamTrack:e})}},{key:"resume",value:function(){var e=this;return"suspended"===this._state?new Promise((function(t,n){e._nativeAudioContext.addEventListener("statechange",(function r(){e._nativeAudioContext.removeEventListener("statechange",r),"running"===e._nativeAudioContext.state?t():e.resume().then(t,n)}))})):this._nativeAudioContext.resume().catch((function(e){if(void 0===e||15===e.code)throw t();throw e}))}},{key:"suspend",value:function(){return this._nativeAudioContext.suspend().catch((function(e){if(void 0===e)throw t();throw e}))}},{key:"baseLatency",get:function(){return this._baseLatency}},{key:"state",get:function(){return null!==this._state?this._state:this._nativeAudioContext.state}}]),l}(e)}(wr,Ee,Nt,(function(){return new DOMException("","UnknownError")}),xr,Cr,Sr,Tr,hn),Er=(St=er,function(e){var t=St.get(e);if(void 0===t)throw new Error("The context has no set of AudioWorkletNodes.");return t}),Ir=(Tt=Er,function(e,t){Tt(e).add(t)}),Rr=function(e){return function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=t[r];if(void 0===i)throw e();return he(n)?i.connect(n,0,a):i.connect(n,0)}}(j),Or=function(e){return function(t,n){e(t).delete(n)}}(Er),Nr=function(e){return function(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return void 0===n?t.forEach((function(e){return e.disconnect()})):"number"==typeof n?Se(e,t,n).disconnect():he(n)?void 0===r?t.forEach((function(e){return e.disconnect(n)})):void 0===a?Se(e,t,r).disconnect(n,0):Se(e,t,r).disconnect(n,0,a):void 0===r?t.forEach((function(e){return e.disconnect(n)})):Se(e,t,r).disconnect(n,0)}}(j),Dr=new WeakMap,Pr=function(e,t){return function(n){return t(e,n)}}(Dr,I),Fr=function(e,t,n,r,a,i,o,s,u,c,l,h,f){return function(d,p,m,v){if(0===v.numberOfInputs&&0===v.numberOfOutputs)throw u();var g=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(g.some((function(e){return e<1})))throw u();if(g.length!==v.numberOfOutputs)throw t();if("explicit"!==v.channelCountMode)throw u();var y=v.channelCount*v.numberOfInputs,_=g.reduce((function(e,t){return e+t}),0),b=void 0===m.parameterDescriptors?0:m.parameterDescriptors.length;if(y+b>6||_>6)throw u();for(var k=new MessageChannel,w=[],C=[],S=0;S<v.numberOfInputs;S+=1)w.push(o(d,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),C.push(a(d,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));var T=[];if(void 0!==m.parameterDescriptors){var A,E=_createForOfIteratorHelper(m.parameterDescriptors);try{var I=function(){var e=A.value,t=e.defaultValue,n=e.maxValue,r=e.minValue,a=e.name,o=i(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==v.parameterData[a]?v.parameterData[a]:void 0===t?0:t});Object.defineProperties(o.offset,{defaultValue:{get:function(){return void 0===t?0:t}},maxValue:{get:function(){return void 0===n?34028234663852886e22:n}},minValue:{get:function(){return void 0===r?-34028234663852886e22:r}}}),T.push(o)};for(E.s();!(A=E.n()).done;)I()}catch(ae){E.e(ae)}finally{E.f()}}for(var R=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,y+b)}),O=je(p,d.sampleRate),N=s(d,O,y+b,Math.max(1,_)),D=a(d,{channelCount:Math.max(1,_),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,_)}),P=[],F=0;F<v.numberOfOutputs;F+=1)P.push(r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:g[F]}));for(var M=0;M<v.numberOfInputs;M+=1){w[M].connect(C[M]);for(var L=0;L<v.channelCount;L+=1)C[M].connect(R,L,M*v.channelCount+L)}var z=new pe(void 0===m.parameterDescriptors?[]:m.parameterDescriptors.map((function(e,t){var n=e.name,r=T[t];return r.connect(R,0,y+t),r.start(0),[n,r.offset]})));R.connect(N);var B,j,V=v.channelInterpretation,q=null,U=0===v.numberOfOutputs?[N]:P,W={get bufferSize(){return O},get channelCount(){return v.channelCount},set channelCount(e){throw n()},get channelCountMode(){return v.channelCountMode},set channelCountMode(e){throw n()},get channelInterpretation(){return V},set channelInterpretation(e){var t,n=_createForOfIteratorHelper(w);try{for(n.s();!(t=n.n()).done;){t.value.channelInterpretation=e}}catch(ae){n.e(ae)}finally{n.f()}V=e},get context(){return N.context},get inputs(){return w},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get onprocessorerror(){return q},set onprocessorerror(e){"function"==typeof q&&W.removeEventListener("processorerror",q),"function"==typeof(q="function"==typeof e?e:null)&&W.addEventListener("processorerror",q)},get parameters(){return z},get port(){return k.port2},addEventListener:function(){return N.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},connect:e.bind(null,U),disconnect:c.bind(null,U),dispatchEvent:function(){return N.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener:function(){return N.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}},G=new Map;k.port1.addEventListener=(B=k.port1.addEventListener,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("message"===t[0]){var r="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==r){var a=G.get(t[1]);void 0!==a?t[1]=a:(t[1]=function(e){l(d.currentTime,d.sampleRate,(function(){return r(e)}))},G.set(r,t[1]))}}return B.call(k.port1,t[0],t[1],t[2])}),k.port1.removeEventListener=(j=k.port1.removeEventListener,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("message"===t[0]){var r=G.get(t[1]);void 0!==r&&(G.delete(t[1]),t[1]=r)}return j.call(k.port1,t[0],t[1],t[2])});var H=null;Object.defineProperty(k.port1,"onmessage",{get:function(){return H},set:function(e){"function"==typeof H&&k.port1.removeEventListener("message",H),"function"==typeof(H="function"==typeof e?e:null)&&(k.port1.addEventListener("message",H),k.port1.start())}}),m.prototype.port=k.port1;var K=null;(function(e,t,n,r){var a=x.get(e);void 0===a&&(a=new WeakMap,x.set(e,a));var i,o=(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,function(e){return new Promise((function(t,n){var r=new MessageChannel,a=r.port1,i=r.port2;a.onmessage=function(e){var n=e.data;a.close(),i.close(),t(n)},a.onmessageerror=function(e){var t=e.data;a.close(),i.close(),n(t)},i.postMessage(e)}))}(n);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})(n,r);return a.set(t,o),o})(d,W,m,v).then((function(e){return K=e}));var X=ye(v.numberOfInputs,v.channelCount),Q=ye(v.numberOfOutputs,g),Y=void 0===m.parameterDescriptors?[]:m.parameterDescriptors.reduce((function(e,t){var n=t.name;return _objectSpread(_objectSpread({},e),{},_defineProperty({},n,new Float32Array(128)))}),{}),Z=!0,J=function(){v.numberOfOutputs>0&&N.disconnect(D);for(var e=0,t=0;e<v.numberOfOutputs;e+=1){for(var n=P[e],r=0;r<g[e];r+=1)D.disconnect(n,t+r,r);t+=g[e]}},$=new Map;N.onaudioprocess=function(e){var t=e.inputBuffer,n=e.outputBuffer;null!==K&&function(){for(var e=h(W),r=function(r){for(var a=0;a<v.numberOfInputs;a+=1)for(var i=0;i<v.channelCount;i+=1)ve(t,X[a],i,i,r);void 0!==m.parameterDescriptors&&m.parameterDescriptors.forEach((function(e,n){var a=e.name;ve(t,Y,a,y+n,r)}));for(var o=0;o<v.numberOfInputs;o+=1)for(var s=0;s<g[o];s+=1)0===Q[o][s].byteLength&&(Q[o][s]=new Float32Array(128));try{var u=X.map((function(t,n){if(e[n].size>0)return $.set(n,O/128),t;var r=$.get(n);return void 0===r?[]:(t.every((function(e){return e.every((function(e){return 0===e}))}))&&(1===r?$.delete(n):$.set(n,r-1)),t)})),c=l(d.currentTime+r/d.sampleRate,d.sampleRate,(function(){return K.process(u,Q,Y)}));Z=c;for(var h=0,f=0;h<v.numberOfOutputs;h+=1){for(var p=0;p<g[h];p+=1)ge(n,Q[h],p,f+p,r);f+=g[h]}}catch(A){Z=!1,W.dispatchEvent(new ErrorEvent("processorerror",{colno:A.colno,filename:A.filename,lineno:A.lineno,message:A.message}))}if(!Z){for(var _=0;_<v.numberOfInputs;_+=1){w[_].disconnect(C[_]);for(var b=0;b<v.channelCount;b+=1)C[r].disconnect(R,b,_*v.channelCount+b)}if(void 0!==m.parameterDescriptors)for(var k=m.parameterDescriptors.length,x=0;x<k;x+=1){var S=T[x];S.disconnect(R,0,y+x),S.stop()}return R.disconnect(N),N.onaudioprocess=null,ee?J():re(),"break"}},a=0;a<O;a+=128){if("break"===r(a))break}}()};var ee=!1,te=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),ne=function(){return N.connect(te).connect(d.destination)},re=function(){N.disconnect(te),te.disconnect()};return ne(),f(W,(function(){if(Z){re(),v.numberOfOutputs>0&&N.connect(D);for(var e=0,t=0;e<v.numberOfOutputs;e+=1){for(var n=P[e],r=0;r<g[e];r+=1)D.connect(n,t+r,r);t+=g[e]}}ee=!0}),(function(){Z&&(ne(),J()),ee=!1}))}}(Rr,j,Ee,Ln,qe,Vn,Ge,Ot,Nt,Nr,vr,Pr,Fn),Mr=function(e,t,n,r,a){return function(i,o,s,u,c,l){if(null!==s)try{var h=new s(i,u,l),f=new Map,d=null;if(Object.defineProperties(h,{channelCount:{get:function(){return l.channelCount},set:function(){throw e()}},channelCountMode:{get:function(){return"explicit"},set:function(){throw e()}},onprocessorerror:{get:function(){return d},set:function(e){"function"==typeof d&&h.removeEventListener("processorerror",d),"function"==typeof(d="function"==typeof e?e:null)&&h.addEventListener("processorerror",d)}}}),h.addEventListener=(v=h.addEventListener,function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if("processorerror"===n[0]){var a="function"==typeof n[1]?n[1]:"object"==typeof n[1]&&null!==n[1]&&"function"==typeof n[1].handleEvent?n[1].handleEvent:null;if(null!==a){var i=f.get(n[1]);void 0!==i?n[1]=i:(n[1]=function(e){"error"===e.type?(Object.defineProperties(e,{type:{value:"processorerror"}}),a(e)):a(new ErrorEvent(n[0],_objectSpread({},e)))},f.set(a,n[1]))}}return v.call(h,"error",n[1],n[2]),(e=v).call.apply(e,[h].concat(n))}),h.removeEventListener=(m=h.removeEventListener,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("processorerror"===t[0]){var r=f.get(t[1]);void 0!==r&&(f.delete(t[1]),t[1]=r)}return m.call(h,"error",t[1],t[2]),m.call(h,t[0],t[1],t[2])}),0!==l.numberOfOutputs){var p=n(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(p).connect(i.destination),a(h,(function(){return p.disconnect()}),(function(){return p.connect(i.destination)}))}return h}catch(g){if(11===g.code)throw r();throw g}var m,v;if(void 0===c)throw r();return function(e){var t=(new MessageChannel).port1;try{t.postMessage(e)}finally{t.close()}}(l),t(i,o,c,l)}}(Ee,Fr,Ge,Nt,Fn),Lr=function(e,t,n,r,a,i,o,s,u,c,l,h,f,d,p,m){return function(v,g,y){var _=new WeakMap,b=null;return{render:function(k,w,C){s(w,k);var S,T=_.get(w);return void 0!==T?Promise.resolve(T):(S=_asyncToGenerator(regeneratorRuntime.mark((function s(k,w,C){var S,T,A,E,R,O,N,D,P,F,M,L,B,j,V,q,U,W,H,K,X,Q,Y,Z,J,$,ee,te,ne,re,ae,oe,se;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(S=l(k),T=null,A=z(S,w),E=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount),null===h){for(R=E.reduce((function(e,t){return e+t}),0),O=a(w,{channelCount:Math.max(1,R),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,R)}),N=[],D=0;D<k.numberOfOutputs;D+=1)N.push(r(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:E[D]}));(P=o(w,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})).connect=t.bind(null,N),P.disconnect=u.bind(null,N),T=[O,N,P]}else A||(S=new h(w,v));if(_.set(w,null===T?S:T[2]),null===T){s.next=38;break}if(null!==b){s.next=26;break}if(void 0!==y){s.next=7;break}throw new Error("Missing the processor constructor.");case 7:if(null!==f){s.next=9;break}throw new Error("Missing the native OfflineAudioContext constructor.");case 9:if(F=k.channelCount*k.numberOfInputs,M=void 0===y.parameterDescriptors?0:y.parameterDescriptors.length,L=F+M,B=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,s,u,c,l,h,v,y,_,b,x,S;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=new f(L,128*Math.ceil(k.context.length/128),w.sampleRate),n=[],s=[],u=0;u<g.numberOfInputs;u+=1)n.push(o(t,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),s.push(a(t,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));return e.next=4,Promise.all(Array.from(k.parameters.values()).map(function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:n.value}),e.next=3,d(t,n,r.offset,C);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:for(c=e.sent,l=r(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,F+M)}),h=0;h<g.numberOfInputs;h+=1)for(n[h].connect(s[h]),v=0;v<g.channelCount;v+=1)s[h].connect(l,v,h*g.channelCount+v);y=_createForOfIteratorHelper(c.entries());try{for(y.s();!(_=y.n()).done;)b=_slicedToArray2(_.value,2),x=b[0],(S=b[1]).connect(l,0,F+x),S.start(0)}catch(T){y.e(T)}finally{y.f()}return l.connect(t.destination),e.next=12,Promise.all(n.map((function(e){return p(k,t,e,C)})));case 12:return e.abrupt("return",m(t));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s.t0=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a,i,o,s){var u,c,l,h,f,d,p,m,v,g,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=null===n?128*Math.ceil(t.context.length/128):n.length,c=a.channelCount*a.numberOfInputs,l=i.reduce((function(e,t){return e+t}),0),h=0===l?null:r.createBuffer(l,u,r.sampleRate),void 0!==o){e.next=3;break}throw new Error("Missing the processor constructor.");case 3:return f=G(t),e.next=6,function(e,t){var n=I(x,e),r=ie(t);return I(n,r)}(r,t);case 6:d=e.sent,p=ye(a.numberOfInputs,a.channelCount),m=ye(a.numberOfOutputs,i),v=Array.from(t.parameters.keys()).reduce((function(e,t){return _objectSpread(_objectSpread({},e),{},_defineProperty({},t,new Float32Array(128)))}),{}),g=function(e){if(a.numberOfInputs>0&&null!==n)for(var u=0;u<a.numberOfInputs;u+=1)for(var l=0;l<a.channelCount;l+=1)ve(n,p[u],l,l,e);void 0!==o.parameterDescriptors&&null!==n&&o.parameterDescriptors.forEach((function(t,r){var a=t.name;ve(n,v,a,c+r,e)}));for(var g=0;g<a.numberOfInputs;g+=1)for(var y=0;y<i[g];y+=1)0===m[g][y].byteLength&&(m[g][y]=new Float32Array(128));try{var _=p.map((function(e,t){return 0===f.activeInputs[t].size?[]:e})),b=s(e/r.sampleRate,r.sampleRate,(function(){return d.process(_,m,v)}));if(null!==h)for(var k=0,w=0;k<a.numberOfOutputs;k+=1){for(var x=0;x<i[k];x+=1)ge(h,m[k],x,w+x,e);w+=i[k]}if(!b)return"break"}catch(C){return t.dispatchEvent(new ErrorEvent("processorerror",{colno:C.colno,filename:C.filename,lineno:C.lineno,message:C.message})),"break"}},y=0;case 12:if(!(y<u)){e.next=19;break}if("break"!==g(y)){e.next=16;break}return e.abrupt("break",19);case 16:y+=128,e.next=12;break;case 19:return e.abrupt("return",h);case 20:case"end":return e.stop()}}),e)})));return function(t,n,r,a,i,o,s){return e.apply(this,arguments)}}(),s.t1=k,0!==L){s.next=16;break}s.t2=null,s.next=19;break;case 16:return s.next=18,B();case 18:s.t2=s.sent;case 19:s.t3=s.t2,s.t4=w,s.t5=g,s.t6=E,s.t7=y,s.t8=c,b=(0,s.t0)(s.t1,s.t3,s.t4,s.t5,s.t6,s.t7,s.t8);case 26:return s.next=28,b;case 28:for(j=s.sent,V=n(w,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),q=_slicedToArray2(T,3),U=q[0],W=q[1],H=q[2],null!==j&&(V.buffer=j,V.start(0)),V.connect(U),K=0,X=0;K<k.numberOfOutputs;K+=1){for(Q=W[K],Y=0;Y<E[K];Y+=1)U.connect(Q,X+Y,Y);X+=E[K]}return s.abrupt("return",H);case 38:if(!A){s.next=58;break}Z=_createForOfIteratorHelper(k.parameters.entries()),s.prev=40,Z.s();case 42:if((J=Z.n()).done){s.next=48;break}return $=_slicedToArray2(J.value,2),ee=$[0],te=$[1],s.next=46,e(w,te,S.parameters.get(ee),C);case 46:s.next=42;break;case 48:s.next=53;break;case 50:s.prev=50,s.t9=s.catch(40),Z.e(s.t9);case 53:return s.prev=53,Z.f(),s.finish(53);case 56:s.next=75;break;case 58:ne=_createForOfIteratorHelper(k.parameters.entries()),s.prev=59,ne.s();case 61:if((re=ne.n()).done){s.next=67;break}return ae=_slicedToArray2(re.value,2),oe=ae[0],se=ae[1],s.next=65,d(w,se,S.parameters.get(oe),C);case 65:s.next=61;break;case 67:s.next=72;break;case 69:s.prev=69,s.t10=s.catch(59),ne.e(s.t10);case 72:return s.prev=72,ne.f(),s.finish(72);case 75:return s.next=77,p(k,w,S,C);case 77:return s.abrupt("return",S);case 78:case"end":return s.stop()}}),s,null,[[40,50,53,56],[59,69,72,75]])}))),function(e,t,n){return S.apply(this,arguments)})(k,w,C)}}}}(Sn,Rr,Tn,Ln,qe,Vn,Ge,Or,Nr,vr,ie,_r,sn,An,rn,Yn),zr=function(e){return function(t){return e.get(t)}}(gr),Br=function(e){return function(t,n){e.set(t,n)}}(Dr),jr=mr?function(e,t,n,r,a,i,o,s,u,c,l,h,f){return function(t){_inherits(d,t);var l=_createSuper(d);function d(t,f,p){var m,v;_classCallCheck2(this,d);var g=s(t),y=u(g),_=function(e){return _objectSpread(_objectSpread({},e),{},{outputChannelCount:void 0!==e.outputChannelCount?e.outputChannelCount:1===e.numberOfInputs&&1===e.numberOfOutputs?[e.channelCount]:Array.from({length:e.numberOfOutputs},(function(){return 1}))})}(_objectSpread(_objectSpread({},me),p)),b=w.get(g),k=null==b?void 0:b.get(f),x=y||"closed"!==g.state?g:null!==(v=o(g))&&void 0!==v?v:g,C=a(x,y?null:t.baseLatency,c,f,k,_);m=l.call(this,t,!0,C,y?r(f,_,k):null);var S=[];C.parameters.forEach((function(e,t){var r=n(_assertThisInitialized(m),y,e);S.push([t,r])})),m._nativeAudioWorkletNode=C,m._onprocessorerror=null,m._parameters=new pe(S),y&&e(g,_assertThisInitialized(m));var T=i(_assertThisInitialized(m)).activeInputs;return h(C,T),m}return _createClass2(d,[{key:"onprocessorerror",get:function(){return this._onprocessorerror},set:function(e){var t="function"==typeof e?f(this,e):null;this._nativeAudioWorkletNode.onprocessorerror=t;var n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===t?e:n}},{key:"parameters",get:function(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}},{key:"port",get:function(){return this._nativeAudioWorkletNode.port}}]),d}(t)}(Ir,mn,In,Lr,Mr,G,zr,on,un,_r,0,Br,Kt):void 0,Vr=function(e,t){return function(n,r,a){if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(n,r,a)}catch(i){if("SyntaxError"===i.name)throw e();throw i}}}(Nt,sn),qr=function(e,t,n,r,a,i,o,s){var u=[];return function(c,l){return n(c).render(c,l,u).then((function(){return Promise.all(Array.from(r(l)).map((function(e){return n(e).render(e,l,u)})))})).then((function(){return a(l)})).then((function(n){return"function"!=typeof n.copyFromChannel?(o(n),V(n)):t(i,(function(){return i(n)}))||s(n),e.add(n),n}))}}(gn,$t,nn,Er,Yn,B,bn,kn),Ur=function(e,t,n,r,a){return function(e){_inherits(o,e);var i=_createSuper(o);function o(e,n,a){var s,u;if(_classCallCheck2(this,o),"number"==typeof e&&void 0!==n&&void 0!==a)u={length:n,numberOfChannels:e,sampleRate:a};else{if("object"!=typeof e)throw new Error("The given parameters are not valid.");u=e}var c,l=_objectSpread(_objectSpread({},Dt),u),h=l.length,f=l.numberOfChannels,d=l.sampleRate,p=r(f,h,d);return t(De,(function(){return De(p)}))||p.addEventListener("statechange",(c=0,function e(t){"running"===s._state&&(c>0?(p.removeEventListener("statechange",e),t.stopImmediatePropagation(),s._waitForThePromiseToSettle(t)):c+=1)})),(s=i.call(this,p,f))._length=h,s._nativeOfflineAudioContext=p,s._state=null,s}return _createClass2(o,[{key:"startRendering",value:function(){var e=this;return"running"===this._state?Promise.reject(n()):(this._state="running",a(this.destination,this._nativeOfflineAudioContext).finally((function(){e._state=null,K(e)})))}},{key:"_waitForThePromiseToSettle",value:function(e){var t=this;null===this._state?this._nativeOfflineAudioContext.dispatchEvent(e):setTimeout((function(){return t._waitForThePromiseToSettle(e)}))}},{key:"length",get:function(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}},{key:"state",get:function(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}}]),o}(e)}(wr,$t,Ee,Vr,qr),Wr=function(e,t){return function(n){var r=e.get(n);return t(r)||t(n)}}(_,fn),Gr=(At=v,Et=dn,function(e){return At.has(e)||Et(e)}),Hr=(It=y,Rt=pn,function(e){return It.has(e)||Rt(e)}),Kr=function(e,t){return function(n){var r=e.get(n);return t(r)||t(n)}}(_,un),Xr=function(){return(e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a,i,o,s,u,c,l,h,f,d,p,m,v){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!!(t(n,n)&&t(r,r)&&t(i,i)&&t(o,o)&&t(u,u)&&t(c,c)&&t(l,l)&&t(h,h)&&t(f,f)&&t(d,d)&&t(p,p)),!e.t0){e.next=5;break}return e.next=4,Promise.all([t(a,a),t(s,s),t(m,m),t(v,v)]);case 4:e.t0=e.sent.every((function(e){return e}));case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e)}))),function(t,n,r,a,i,o,s,u,c,l,h,f,d,p,m,v){return e.apply(this,arguments)})($t,function(e){return function(){if(null===e)return!1;var t=new e(1,1,44100).createBuffer(1,1,44100);if(void 0===t.copyToChannel)return!0;var n=new Float32Array(2);try{t.copyFromChannel(n,0,0)}catch(r){return!1}return!0}}(sn),function(e){return function(){if(null===e)return!1;if(void 0!==e.prototype&&void 0!==e.prototype.close)return!0;var t=new e,n=void 0!==t.close;try{t.close()}catch(r){}return n}}(hn),function(e){return function(){if(null===e)return Promise.resolve(!1);var t=new e(1,1,44100);return new Promise((function(e){var n,r=!0,a=function(n){r&&(r=!1,t.startRendering(),e(n instanceof TypeError))};try{n=t.decodeAudioData(null,(function(){}),a)}catch(i){a(i)}void 0!==n&&n.catch(a)}))}}(sn),function(e){return function(){if(null===e)return!1;var t;try{t=new e({latencyHint:"balanced"})}catch(n){return!1}return t.close(),!0}}(hn),function(e){return function(){if(null===e)return!1;var t=new e(1,1,44100).createGain(),n=t.connect(t)===t;return t.disconnect(t),n}}(sn),function(e,t){return _asyncToGenerator(regeneratorRuntime.mark((function n(){var r,a,i,o,s,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!==e){n.next=2;break}return n.abrupt("return",!0);case 2:if(null!==t){n.next=4;break}return n.abrupt("return",!1);case 4:return r=new Blob(['class A extends AudioWorkletProcessor{process(){this.port.postMessage(0)}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),a=new t(1,128,8e3),i=URL.createObjectURL(r),o=!1,n.prev=6,n.next=9,a.audioWorklet.addModule(i);case 9:return s=new e(a,"a",{numberOfOutputs:0}),u=a.createOscillator(),s.port.onmessage=function(){return o=!0},u.connect(s),u.start(0),n.next=15,a.startRendering();case 15:if(n.t0=o,n.t0){n.next=19;break}return n.next=19,new Promise((function(e){return setTimeout(e,5)}));case 19:n.next=23;break;case 21:n.prev=21,n.t1=n.catch(6);case 23:return n.prev=23,URL.revokeObjectURL(i),n.finish(23);case 26:return n.abrupt("return",o);case 27:case"end":return n.stop()}}),n,null,[[6,21,23,26]])})))}(_r,sn),function(e){return function(){if(null===e)return!1;var t=new e(1,1,44100).createChannelMerger();if("max"===t.channelCountMode)return!0;try{t.channelCount=2}catch(n){return!0}return!1}}(sn),function(e){return function(){if(null===e)return!1;var t=new e(1,1,44100);return void 0===t.createConstantSource||t.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY}}(sn),function(e){return function(){if(null===e)return!1;var t=new e(1,1,44100),n=t.createConvolver();n.buffer=t.createBuffer(1,1,t.sampleRate);try{n.buffer=t.createBuffer(1,1,t.sampleRate)}catch(r){return!1}return!0}}(sn),function(e){return function(){if(null===e)return!1;var t=new e(1,1,44100).createConvolver();try{t.channelCount=1}catch(n){return!1}return!0}}(sn),Wt,function(e){return function(){return null!==e&&e.hasOwnProperty("isSecureContext")}}(en),function(e){return function(){if(null===e)return!1;var t=new e;try{return t.createMediaStreamSource(new MediaStream),!1}catch(n){return!0}}}(hn),function(e){return function(){if(null===e)return Promise.resolve(!1);var t=new e(1,1,44100);if(void 0===t.createStereoPanner)return Promise.resolve(!0);if(void 0===t.createConstantSource)return Promise.resolve(!0);var n=t.createConstantSource(),r=t.createStereoPanner();return n.channelCount=1,n.offset.value=1,r.channelCount=1,n.start(),n.connect(r).connect(t.destination),t.startRendering().then((function(e){return 1!==e.getChannelData(0)[0]}))}}(sn),Gt);var e};function Qr(e,t){if(!e)throw new Error(t)}function Yr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;if(!(t<=e&&e<=n))throw new RangeError("Value must be within [".concat(t,", ").concat(n,"], got: ").concat(e))}function Zr(e){e.isOffline||"running"===e.state||ta('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}var Jr=console;function $r(e){Jr=e}function ea(){var e;(e=Jr).log.apply(e,arguments)}function ta(){var e;(e=Jr).warn.apply(e,arguments)}function na(e){return void 0===e}function ra(e){return!na(e)}function aa(e){return"function"==typeof e}function ia(e){return"number"==typeof e}function oa(e){return"[object Object]"===Object.prototype.toString.call(e)&&e.constructor===Object}function sa(e){return"boolean"==typeof e}function ua(e){return Array.isArray(e)}function ca(e){return"string"==typeof e}function la(e){return ca(e)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(e)}var ha="object"==typeof self?self:null,fa=ha&&(ha.hasOwnProperty("AudioContext")||ha.hasOwnProperty("webkitAudioContext"));function da(e,t,n,r){var a,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o}function pa(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}var ma=function(){function e(t,n,r){_classCallCheck2(this,e),this._callback=t,this._type=n,this._updateInterval=r,this._createClock()}return _createClass2(e,[{key:"_createWorker",value:function(){var e=new Blob(["\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ".concat((1e3*this._updateInterval).toFixed(1),";\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t")],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}},{key:"_createTimeout",value:function(){var e=this;this._timeout=setTimeout((function(){e._createTimeout(),e._callback()}),1e3*this._updateInterval)}},{key:"_createClock",value:function(){if("worker"===this._type)try{this._createWorker()}catch(e){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}},{key:"_disposeClock",value:function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}},{key:"dispose",value:function(){this._disposeClock()}},{key:"updateInterval",get:function(){return this._updateInterval},set:function(e){this._updateInterval=Math.max(e,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*e,1))}},{key:"type",get:function(){return this._type},set:function(e){this._disposeClock(),this._type=e,this._createClock()}}]),e}();function va(e){return Hr(e)}function ga(e){return Gr(e)}function ya(e){return Kr(e)}function _a(e){return Wr(e)}function ba(e){return e instanceof AudioBuffer}function ka(e,t){return"value"===e||va(t)||ga(t)||ba(t)}function wa(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(!n.length)return e;var a=n.shift();if(oa(e)&&oa(a))for(var i in a)ka(i,a[i])?e[i]=a[i]:oa(a[i])?(e[i]||Object.assign(e,_defineProperty({},i,{})),wa(e[i],a[i])):Object.assign(e,_defineProperty({},i,a[i]));return wa.apply(void 0,[e].concat(n))}function xa(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0,a={},i=Array.from(t);if(oa(i[0])&&r&&!Reflect.has(i[0],r)&&(Object.keys(i[0]).some((function(t){return Reflect.has(e,t)}))||(wa(a,_defineProperty({},r,i[0])),n.splice(n.indexOf(r),1),i.shift())),1===i.length&&oa(i[0]))wa(a,i[0]);else for(var o=0;o<n.length;o++)ra(i[o])&&(a[n[o]]=i[o]);return wa(e,a)}function Ca(e,t){return na(e)?t:e}function Sa(e,t){return t.forEach((function(t){Reflect.has(e,t)&&delete e[t]})),e}var Ta=function(){function e(){_classCallCheck2(this,e),this.debug=!1,this._wasDisposed=!1}return _createClass2(e,[{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];(this.debug||ha&&this.toString()===ha.TONE_DEBUG_CLASS)&&ea.apply(void 0,[this].concat(t))}},{key:"dispose",value:function(){return this._wasDisposed=!0,this}},{key:"toString",value:function(){return this.name}},{key:"disposed",get:function(){return this._wasDisposed}}],[{key:"getDefaults",value:function(){return{}}}]),e}();function Aa(e,t){return e>t+1e-6}function Ea(e,t){return Aa(e,t)||Ra(e,t)}function Ia(e,t){return e+1e-6<t}function Ra(e,t){return Math.abs(e-t)<1e-6}function Oa(e,t,n){return Math.max(Math.min(e,n),t)}Ta.version="14.7.58";var Na=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this)).name="Timeline",e._timeline=[];var r=xa(n.getDefaults(),arguments,["memory"]);return e.memory=r.memory,e.increasing=r.increasing,e}return _createClass2(n,[{key:"add",value:function(e){if(Qr(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length)Qr(Ea(e.time,this._timeline[this.length-1].time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e);else{var t=this._search(e.time);this._timeline.splice(t+1,0,e)}return this.length>this.memory&&this._timeline.splice(0,this.length-this.memory),this}},{key:"remove",value:function(e){var t=this._timeline.indexOf(e);return-1!==t&&this._timeline.splice(t,1),this}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"time",n=this._search(e,t);return-1!==n?this._timeline[n]:null}},{key:"peek",value:function(){return this._timeline[0]}},{key:"shift",value:function(){return this._timeline.shift()}},{key:"getAfter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"time",n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}},{key:"getBefore",value:function(e){var t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];var n=this._search(e);return n-1>=0?this._timeline[n-1]:null}},{key:"cancel",value:function(e){if(this._timeline.length>1){var t=this._search(e);if(t>=0)if(Ra(this._timeline[t].time,e)){for(var n=t;n>=0&&Ra(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else 1===this._timeline.length&&Ea(this._timeline[0].time,e)&&(this._timeline=[]);return this}},{key:"cancelBefore",value:function(e){var t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}},{key:"previousEvent",value:function(e){var t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}},{key:"_search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"time";if(0===this._timeline.length)return-1;var n=0,r=this._timeline.length,a=r;if(r>0&&this._timeline[r-1][t]<=e)return r-1;for(;n<a;){var i=Math.floor(n+(a-n)/2),o=this._timeline[i],s=this._timeline[i+1];if(Ra(o[t],e)){for(var u=i;u<this._timeline.length&&Ra(this._timeline[u][t],e);u++)i=u;return i}if(Ia(o[t],e)&&Aa(s[t],e))return i;Aa(o[t],e)?a=i:n=i+1}return-1}},{key:"_iterate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._timeline.length-1;this._timeline.slice(t,n+1).forEach(e)}},{key:"forEach",value:function(e){return this._iterate(e),this}},{key:"forEachBefore",value:function(e,t){var n=this._search(e);return-1!==n&&this._iterate(t,0,n),this}},{key:"forEachAfter",value:function(e,t){var n=this._search(e);return this._iterate(t,n+1),this}},{key:"forEachBetween",value:function(e,t,n){var r=this._search(e),a=this._search(t);return-1!==r&&-1!==a?(this._timeline[r].time!==e&&(r+=1),this._timeline[a].time===t&&(a-=1),this._iterate(n,r,a)):-1===r&&this._iterate(n,0,a),this}},{key:"forEachFrom",value:function(e,t){for(var n=this._search(e);n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}},{key:"forEachAtTime",value:function(e,t){var n=this._search(e);if(-1!==n&&Ra(this._timeline[n].time,e)){for(var r=n,a=n;a>=0&&Ra(this._timeline[a].time,e);a--)r=a;this._iterate((function(e){t(e)}),r,n)}return this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._timeline=[],this}},{key:"length",get:function(){return this._timeline.length}}],[{key:"getDefaults",value:function(){return{memory:1/0,increasing:!1}}}]),n}(Ta),Da=[];function Pa(e){Da.push(e)}var Fa=[];function Ma(e){Fa.push(e)}var La=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="Emitter",e}return _createClass2(n,[{key:"on",value:function(e,t){var n=this;return e.split(/\W+/).forEach((function(e){na(n._events)&&(n._events={}),n._events.hasOwnProperty(e)||(n._events[e]=[]),n._events[e].push(t)})),this}},{key:"once",value:function(e,t){var n=this;return this.on(e,(function r(){t.apply(void 0,arguments),n.off(e,r)})),this}},{key:"off",value:function(e,t){var n=this;return e.split(/\W+/).forEach((function(r){if(na(n._events)&&(n._events={}),n._events.hasOwnProperty(e))if(na(t))n._events[e]=[];else for(var a=n._events[e],i=a.length-1;i>=0;i--)a[i]===t&&a.splice(i,1)})),this}},{key:"emit",value:function(e){if(this._events&&this._events.hasOwnProperty(e)){for(var t=this._events[e].slice(0),n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];for(var i=0,o=t.length;i<o;i++)t[i].apply(this,r)}return this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._events=void 0,this}}],[{key:"mixin",value:function(e){["on","once","off","emit"].forEach((function(t){var r=Object.getOwnPropertyDescriptor(n.prototype,t);Object.defineProperty(e.prototype,t,r)}))}}]),n}(Ta),za=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).isOffline=!1,e}return n}(La),Ba=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this)).name="Context",e._constants=new Map,e._timeouts=new Na,e._timeoutIds=0,e._initialized=!1,e.isOffline=!1,e._workletModules=new Map;var r=xa(n.getDefaults(),arguments,["context"]);return e._context=r.context?r.context:function(e){return new Ar(e)}({latencyHint:r.latencyHint}),e._ticker=new ma(e.emit.bind(_assertThisInitialized(e),"tick"),r.clockSource,r.updateInterval),e.on("tick",e._timeoutLoop.bind(_assertThisInitialized(e))),e._context.onstatechange=function(){e.emit("statechange",e.state)},e._setLatencyHint(r.latencyHint),e.lookAhead=r.lookAhead,e}return _createClass2(n,[{key:"initialize",value:function(){var e;return this._initialized||(e=this,Da.forEach((function(t){return t(e)})),this._initialized=!0),this}},{key:"createAnalyser",value:function(){return this._context.createAnalyser()}},{key:"createOscillator",value:function(){return this._context.createOscillator()}},{key:"createBufferSource",value:function(){return this._context.createBufferSource()}},{key:"createBiquadFilter",value:function(){return this._context.createBiquadFilter()}},{key:"createBuffer",value:function(e,t,n){return this._context.createBuffer(e,t,n)}},{key:"createChannelMerger",value:function(e){return this._context.createChannelMerger(e)}},{key:"createChannelSplitter",value:function(e){return this._context.createChannelSplitter(e)}},{key:"createConstantSource",value:function(){return this._context.createConstantSource()}},{key:"createConvolver",value:function(){return this._context.createConvolver()}},{key:"createDelay",value:function(e){return this._context.createDelay(e)}},{key:"createDynamicsCompressor",value:function(){return this._context.createDynamicsCompressor()}},{key:"createGain",value:function(){return this._context.createGain()}},{key:"createIIRFilter",value:function(e,t){return this._context.createIIRFilter(e,t)}},{key:"createPanner",value:function(){return this._context.createPanner()}},{key:"createPeriodicWave",value:function(e,t,n){return this._context.createPeriodicWave(e,t,n)}},{key:"createStereoPanner",value:function(){return this._context.createStereoPanner()}},{key:"createWaveShaper",value:function(){return this._context.createWaveShaper()}},{key:"createMediaStreamSource",value:function(e){return Qr(_a(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}},{key:"createMediaStreamDestination",value:function(){return Qr(_a(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}},{key:"decodeAudioData",value:function(e){return this._context.decodeAudioData(e)}},{key:"createAudioWorkletNode",value:function(e,t){return function(e,t,n){return Qr(ra(jr),"This node only works in a secure context (https or localhost)"),new jr(e,t,n)}(this.rawContext,e,t)}},{key:"addAudioWorkletModule",value:function(e,t){return pa(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return Qr(ra(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(t)||this._workletModules.set(t,this.rawContext.audioWorklet.addModule(e)),n.next=4,this._workletModules.get(t);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"workletsAreReady",value:function(){return pa(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],this._workletModules.forEach((function(e){return t.push(e)})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"_setLatencyHint",value:function(e){var t=0;if(this._latencyHint=e,ca(e))switch(e){case"interactive":t=.1;break;case"playback":t=.5;break;case"balanced":t=.25}this.lookAhead=t,this.updateInterval=t/2}},{key:"now",value:function(){return this._context.currentTime+this.lookAhead}},{key:"immediate",value:function(){return this._context.currentTime}},{key:"resume",value:function(){return"suspended"===this._context.state&&_a(this._context)?this._context.resume():Promise.resolve()}},{key:"close",value:function(){return pa(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=_a(this._context),!e.t0){e.next=4;break}return e.next=4,this._context.close();case 4:this._initialized&&(t=this,Fa.forEach((function(e){return e(t)})));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"getConstant",value:function(e){if(this._constants.has(e))return this._constants.get(e);for(var t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0),r=0;r<n.length;r++)n[r]=e;var a=this._context.createBufferSource();return a.channelCount=1,a.channelCountMode="explicit",a.buffer=t,a.loop=!0,a.start(0),this._constants.set(e,a),a}},{key:"dispose",value:function(){var e=this;return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((function(t){return e._constants[t].disconnect()})),this}},{key:"_timeoutLoop",value:function(){for(var e=this.now(),t=this._timeouts.peek();this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}},{key:"setTimeout",value:function(e,t){this._timeoutIds++;var n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}},{key:"clearTimeout",value:function(e){var t=this;return this._timeouts.forEach((function(n){n.id===e&&t._timeouts.remove(n)})),this}},{key:"clearInterval",value:function(e){return this.clearTimeout(e)}},{key:"setInterval",value:function(e,t){var n=this,r=++this._timeoutIds;return function a(){var i=n.now();n._timeouts.add({callback:function(){e(),a()},id:r,time:i+t})}(),r}},{key:"currentTime",get:function(){return this._context.currentTime}},{key:"state",get:function(){return this._context.state}},{key:"sampleRate",get:function(){return this._context.sampleRate}},{key:"listener",get:function(){return this.initialize(),this._listener},set:function(e){Qr(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}},{key:"transport",get:function(){return this.initialize(),this._transport},set:function(e){Qr(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}},{key:"draw",get:function(){return this.initialize(),this._draw},set:function(e){Qr(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}},{key:"destination",get:function(){return this.initialize(),this._destination},set:function(e){Qr(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}},{key:"updateInterval",get:function(){return this._ticker.updateInterval},set:function(e){this._ticker.updateInterval=e}},{key:"clockSource",get:function(){return this._ticker.type},set:function(e){this._ticker.type=e}},{key:"latencyHint",get:function(){return this._latencyHint}},{key:"rawContext",get:function(){return this._context}}],[{key:"getDefaults",value:function(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}}]),n}(za);function ja(e,t){ua(t)?t.forEach((function(t){return ja(e,t)})):Object.defineProperty(e,t,{enumerable:!0,writable:!1})}function Va(e,t){ua(t)?t.forEach((function(t){return Va(e,t)})):Object.defineProperty(e,t,{writable:!0})}var qa=function(){},Ua=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this)).name="ToneAudioBuffer",e.onload=qa;var r=xa(n.getDefaults(),arguments,["url","onload","onerror"]);return e.reverse=r.reverse,e.onload=r.onload,r.url&&ba(r.url)||r.url instanceof n?e.set(r.url):ca(r.url)&&e.load(r.url).catch(r.onerror),e}return _createClass2(n,[{key:"set",value:function(e){var t=this;return e instanceof n?e.loaded?this._buffer=e.get():e.onload=function(){t.set(e),t.onload(t)}:this._buffer=e,this._reversed&&this._reverse(),this}},{key:"get",value:function(){return this._buffer}},{key:"load",value:function(e){return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,a,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.load(e).then((function(e){i.set(e),i.onload(i)})),n.downloads.push(r),t.prev=2,t.next=5,r;case 5:return t.prev=5,a=n.downloads.indexOf(r),n.downloads.splice(a,1),t.finish(5);case 9:return t.abrupt("return",this);case 10:case"end":return t.stop()}}),t,this,[[2,,5,9]])})))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._buffer=void 0,this}},{key:"fromArray",value:function(e){for(var t=ua(e)&&e[0].length>0,n=t?e.length:1,r=t?e[0].length:e.length,a=Ka(),i=a.createBuffer(n,r,a.sampleRate),o=t||1!==n?e:[e],s=0;s<n;s++)i.copyToChannel(o[s],s);return this._buffer=i,this}},{key:"toMono",value:function(e){if(ia(e))this.fromArray(this.toArray(e));else{for(var t=new Float32Array(this.length),n=this.numberOfChannels,r=0;r<n;r++)for(var a=this.toArray(r),i=0;i<a.length;i++)t[i]+=a[i];t=t.map((function(e){return e/n})),this.fromArray(t)}return this}},{key:"toArray",value:function(e){if(ia(e))return this.getChannelData(e);if(1===this.numberOfChannels)return this.toArray(0);for(var t=[],n=0;n<this.numberOfChannels;n++)t[n]=this.getChannelData(n);return t}},{key:"getChannelData",value:function(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}},{key:"slice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.duration,r=Math.floor(e*this.sampleRate),a=Math.floor(t*this.sampleRate);Qr(r<a,"The start time must be less than the end time");for(var i=a-r,o=Ka().createBuffer(this.numberOfChannels,i,this.sampleRate),s=0;s<this.numberOfChannels;s++)o.copyToChannel(this.getChannelData(s).subarray(r,a),s);return new n(o)}},{key:"_reverse",value:function(){if(this.loaded)for(var e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}},{key:"sampleRate",get:function(){return this._buffer?this._buffer.sampleRate:Ka().sampleRate}},{key:"loaded",get:function(){return this.length>0}},{key:"duration",get:function(){return this._buffer?this._buffer.duration:0}},{key:"length",get:function(){return this._buffer?this._buffer.length:0}},{key:"numberOfChannels",get:function(){return this._buffer?this._buffer.numberOfChannels:0}},{key:"reverse",get:function(){return this._reversed},set:function(e){this._reversed!==e&&(this._reversed=e,this._reverse())}}],[{key:"getDefaults",value:function(){return{onerror:qa,onload:qa,reverse:!1}}},{key:"fromArray",value:function(e){return(new n).fromArray(e)}},{key:"fromUrl",value:function(e){return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new n,t.next=3,r.load(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))}},{key:"load",value:function(e){return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,a,i,o,s,u,c,l,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=e.match(/\[(.+\|?)+\]$/))){t.next=23;break}a=r[1].split("|"),i=a[0],o=_createForOfIteratorHelper(a),t.prev=5,o.s();case 7:if((s=o.n()).done){t.next=14;break}if(u=s.value,!n.supportsType(u)){t.next=12;break}return i=u,t.abrupt("break",14);case 12:t.next=7;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(5),o.e(t.t0);case 19:return t.prev=19,o.f(),t.finish(19);case 22:e=e.replace(r[0],i);case 23:return c=""===n.baseUrl||n.baseUrl.endsWith("/")?n.baseUrl:n.baseUrl+"/",t.next=26,fetch(c+e);case 26:if((l=t.sent).ok){t.next=29;break}throw new Error("could not load url: "+e);case 29:return t.next=31,l.arrayBuffer();case 31:return h=t.sent,t.next=34,Ka().decodeAudioData(h);case 34:return t.abrupt("return",t.sent);case 35:case"end":return t.stop()}}),t,null,[[5,16,19,22]])})))}},{key:"supportsType",value:function(e){var t=e.split("."),n=t[t.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}},{key:"loaded",value:function(){return pa(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve();case 2:if(!n.downloads.length){e.next=7;break}return e.next=5,n.downloads[0];case 5:e.next=2;break;case 7:case"end":return e.stop()}}),e)})))}}]),n}(Ta);Ua.baseUrl="",Ua.downloads=[];var Wa=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r,a,i;return _classCallCheck2(this,n),(e=t.call(this,{clockSource:"offline",context:ya(arguments[0])?arguments[0]:(r=arguments[0],a=arguments[1]*arguments[2],i=arguments[2],new Ur(r,a,i)),lookAhead:0,updateInterval:ya(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]})).name="OfflineContext",e._currentTime=0,e.isOffline=!0,e._duration=ya(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1],e}return _createClass2(n,[{key:"now",value:function(){return this._currentTime}},{key:"_renderClock",value:function(e){return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(this._duration-this._currentTime>=0)){t.next=10;break}if(this.emit("tick"),this._currentTime+=128/this.sampleRate,n++,r=Math.floor(this.sampleRate/128),t.t0=e&&n%r==0,!t.t0){t.next=8;break}return t.next=8,new Promise((function(e){return setTimeout(e,1)}));case 8:t.next=1;break;case 10:case"end":return t.stop()}}),t,this)})))}},{key:"render",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.workletsAreReady();case 2:return t.next=4,this._renderClock(e);case 4:return t.next=6,this._context.startRendering();case 6:return n=t.sent,t.abrupt("return",new Ua(n));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"close",value:function(){return Promise.resolve()}},{key:"currentTime",get:function(){return this._currentTime}}]),n}(Ba),Ga=new(function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).lookAhead=0,e.latencyHint=0,e.isOffline=!1,e}return _createClass2(n,[{key:"createAnalyser",value:function(){return{}}},{key:"createOscillator",value:function(){return{}}},{key:"createBufferSource",value:function(){return{}}},{key:"createBiquadFilter",value:function(){return{}}},{key:"createBuffer",value:function(e,t,n){return{}}},{key:"createChannelMerger",value:function(e){return{}}},{key:"createChannelSplitter",value:function(e){return{}}},{key:"createConstantSource",value:function(){return{}}},{key:"createConvolver",value:function(){return{}}},{key:"createDelay",value:function(e){return{}}},{key:"createDynamicsCompressor",value:function(){return{}}},{key:"createGain",value:function(){return{}}},{key:"createIIRFilter",value:function(e,t){return{}}},{key:"createPanner",value:function(){return{}}},{key:"createPeriodicWave",value:function(e,t,n){return{}}},{key:"createStereoPanner",value:function(){return{}}},{key:"createWaveShaper",value:function(){return{}}},{key:"createMediaStreamSource",value:function(e){return{}}},{key:"createMediaStreamDestination",value:function(){return{}}},{key:"decodeAudioData",value:function(e){return Promise.resolve({})}},{key:"createAudioWorkletNode",value:function(e,t){return{}}},{key:"addAudioWorkletModule",value:function(e,t){return pa(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve());case 1:case"end":return e.stop()}}),e)})))}},{key:"resume",value:function(){return Promise.resolve()}},{key:"setTimeout",value:function(e,t){return 0}},{key:"clearTimeout",value:function(e){return this}},{key:"setInterval",value:function(e,t){return 0}},{key:"clearInterval",value:function(e){return this}},{key:"getConstant",value:function(e){return{}}},{key:"now",value:function(){return 0}},{key:"immediate",value:function(){return 0}},{key:"rawContext",get:function(){return{}}},{key:"currentTime",get:function(){return 0}},{key:"state",get:function(){return{}}},{key:"sampleRate",get:function(){return 0}},{key:"listener",get:function(){return{}}},{key:"transport",get:function(){return{}}},{key:"draw",get:function(){return{}},set:function(e){}},{key:"destination",get:function(){return{}},set:function(e){}}]),n}(za)),Ha=Ga;function Ka(){return Ha===Ga&&fa&&Xa(new Ba),Ha}function Xa(e){Ha=_a(e)?new Ba(e):ya(e)?new Wa(e):e}function Qa(){return Ha.resume()}function Ya(e){return Math.pow(10,e/20)}function Za(e){return Math.log(e)/Math.LN10*20}function Ja(e){return Math.pow(2,e/12)}ha&&!ha.TONE_SILENCE_LOGGING&&console.log("%c * Tone.js v14.7.58 * ","background: #000; color: #fff");var $a=440;function ei(e){return Math.round(ti(e))}function ti(e){return 69+12*Math.log2(e/$a)}function ni(e){return $a*Math.pow(2,(e-69)/12)}var ri=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="TimeClass",e}return _createClass2(n,[{key:"_getExpressions",value:function(){var e=this;return Object.assign(_get(_getPrototypeOf(n.prototype),"_getExpressions",this).call(this),{now:{method:function(t){return e._now()+new e.constructor(e.context,t).valueOf()},regexp:/^\+(.+)/},quantize:{method:function(t){var r=new n(e.context,t).valueOf();return e._secondsToUnits(e.context.transport.nextSubdivision(r))},regexp:/^@(.+)/}})}},{key:"quantize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=new this.constructor(this.context,e).valueOf(),r=this.valueOf();return r+(Math.round(r/n)*n-r)*t}},{key:"toNotation",value:function(){for(var e=this,t=this.toSeconds(),r=["1m"],a=1;a<9;a++){var i=Math.pow(2,a);r.push(i+"n."),r.push(i+"n"),r.push(i+"t")}r.push("0");var o=r[0],s=new n(this.context,r[0]).toSeconds();return r.forEach((function(r){var a=new n(e.context,r).toSeconds();Math.abs(a-t)<Math.abs(s-t)&&(o=r,s=a)})),o}},{key:"toBarsBeatsSixteenths",value:function(){var e=this._beatsToUnits(1),t=this.valueOf()/e;t=parseFloat(t.toFixed(4));var n=Math.floor(t/this._getTimeSignature()),r=t%1*4;t=Math.floor(t)%this._getTimeSignature();var a=r.toString();return a.length>3&&(r=parseFloat(parseFloat(a).toFixed(3))),[n,t,r].join(":")}},{key:"toTicks",value:function(){var e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())}},{key:"toSeconds",value:function(){return this.valueOf()}},{key:"toMidi",value:function(){return ei(this.toFrequency())}},{key:"_now",value:function(){return this.context.now()}}]),n}(function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this)).defaultUnits="s",i._val=r,i._units=a,i.context=e,i._expressions=i._getExpressions(),i}return _createClass2(n,[{key:"_getExpressions",value:function(){var e=this;return{hz:{method:function(t){return e._frequencyToUnits(parseFloat(t))},regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:function(t){return e._ticksToUnits(parseInt(t,10))},regexp:/^(\d+)i$/i},m:{method:function(t){return e._beatsToUnits(parseInt(t,10)*e._getTimeSignature())},regexp:/^(\d+)m$/i},n:{method:function(t,n){var r=parseInt(t,10),a="."===n?1.5:1;return 1===r?e._beatsToUnits(e._getTimeSignature())*a:e._beatsToUnits(4/r)*a},regexp:/^(\d+)n(\.?)$/i},number:{method:function(t){return e._expressions[e.defaultUnits].method.call(e,t)},regexp:/^(\d+(?:\.\d+)?)$/},s:{method:function(t){return e._secondsToUnits(parseFloat(t))},regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:function(t){return parseInt(t,10)/e.context.sampleRate},regexp:/^(\d+)samples$/},t:{method:function(t){var n=parseInt(t,10);return e._beatsToUnits(8/(3*Math.floor(n)))},regexp:/^(\d+)t$/i},tr:{method:function(t,n,r){var a=0;return t&&"0"!==t&&(a+=e._beatsToUnits(e._getTimeSignature()*parseFloat(t))),n&&"0"!==n&&(a+=e._beatsToUnits(parseFloat(n))),r&&"0"!==r&&(a+=e._beatsToUnits(parseFloat(r)/4)),a},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}},{key:"valueOf",value:function(){if(this._val instanceof n&&this.fromType(this._val),na(this._val))return this._noArg();if(ca(this._val)&&na(this._units)){for(var e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(oa(this._val)){var t=0;for(var r in this._val)if(ra(this._val[r])){var a=this._val[r];t+=new this.constructor(this.context,r).valueOf()*a}return t}if(ra(this._units)){var i=this._expressions[this._units],o=this._val.toString().trim().match(i.regexp);return o?i.method.apply(this,o.slice(1)):i.method.call(this,this._val)}return ca(this._val)?parseFloat(this._val):this._val}},{key:"_frequencyToUnits",value:function(e){return 1/e}},{key:"_beatsToUnits",value:function(e){return 60/this._getBpm()*e}},{key:"_secondsToUnits",value:function(e){return e}},{key:"_ticksToUnits",value:function(e){return e*this._beatsToUnits(1)/this._getPPQ()}},{key:"_noArg",value:function(){return this._now()}},{key:"_getBpm",value:function(){return this.context.transport.bpm.value}},{key:"_getTimeSignature",value:function(){return this.context.transport.timeSignature}},{key:"_getPPQ",value:function(){return this.context.transport.PPQ}},{key:"fromType",value:function(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi()}return this}},{key:"toFrequency",value:function(){return 1/this.toSeconds()}},{key:"toSamples",value:function(){return this.toSeconds()*this.context.sampleRate}},{key:"toMilliseconds",value:function(){return 1e3*this.toSeconds()}}]),n}(Ta));function ai(e,t){return new ri(Ka(),e,t)}var ii=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="Frequency",e.defaultUnits="hz",e}return _createClass2(n,[{key:"_getExpressions",value:function(){return Object.assign({},_get(_getPrototypeOf(n.prototype),"_getExpressions",this).call(this),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method:function(e){return"midi"===this.defaultUnits?e:n.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(e,t){var r=oi[e.toLowerCase()]+12*(parseInt(t,10)+1);return"midi"===this.defaultUnits?r:n.mtof(r)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(e,t,n){var r=1;return e&&"0"!==e&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(r*=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(r*=this._beatsToUnits(parseFloat(n)/4)),r}}})}},{key:"transpose",value:function(e){return new n(this.context,this.valueOf()*Ja(e))}},{key:"harmonize",value:function(e){var t=this;return e.map((function(e){return t.transpose(e)}))}},{key:"toMidi",value:function(){return ei(this.valueOf())}},{key:"toNote",value:function(){var e=this.toFrequency(),t=Math.log2(e/n.A4),r=Math.round(12*t)+57,a=Math.floor(r/12);return a<0&&(r+=-12*a),si[r%12]+a.toString()}},{key:"toSeconds",value:function(){return 1/_get(_getPrototypeOf(n.prototype),"toSeconds",this).call(this)}},{key:"toTicks",value:function(){var e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}},{key:"_noArg",value:function(){return 0}},{key:"_frequencyToUnits",value:function(e){return e}},{key:"_ticksToUnits",value:function(e){return 1/(60*e/(this._getBpm()*this._getPPQ()))}},{key:"_beatsToUnits",value:function(e){return 1/_get(_getPrototypeOf(n.prototype),"_beatsToUnits",this).call(this,e)}},{key:"_secondsToUnits",value:function(e){return 1/e}}],[{key:"mtof",value:function(e){return ni(e)}},{key:"ftom",value:function(e){return ei(e)}},{key:"A4",get:function(){return $a},set:function(e){!function(e){$a=e}(e)}}]),n}(ri),oi={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},si=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function ui(e,t){return new ii(Ka(),e,t)}var ci=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="TransportTime",e}return _createClass2(n,[{key:"_now",value:function(){return this.context.transport.seconds}}]),n}(ri);function li(e,t){return new ci(Ka(),e,t)}var hi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),e=t.call(this);var r=xa(n.getDefaults(),arguments,["context"]);return e.context=e.defaultContext?e.defaultContext:r.context,e}return _createClass2(n,[{key:"now",value:function(){return this.context.currentTime+this.context.lookAhead}},{key:"immediate",value:function(){return this.context.currentTime}},{key:"toSeconds",value:function(e){return new ri(this.context,e).toSeconds()}},{key:"toFrequency",value:function(e){return new ii(this.context,e).toFrequency()}},{key:"toTicks",value:function(e){return new ci(this.context,e).toTicks()}},{key:"_getPartialProperties",value:function(e){var t=this.get();return Object.keys(t).forEach((function(n){na(e[n])&&delete t[n]})),t}},{key:"get",value:function(){var e=this,t=this.constructor.getDefaults();return Object.keys(t).forEach((function(r){if(Reflect.has(e,r)){var a=e[r];ra(a)&&ra(a.value)&&ra(a.setValueAtTime)?t[r]=a.value:a instanceof n?t[r]=a._getPartialProperties(t[r]):ua(a)||ia(a)||ca(a)||sa(a)?t[r]=a:delete t[r]}})),t}},{key:"set",value:function(e){var t=this;return Object.keys(e).forEach((function(r){Reflect.has(t,r)&&ra(t[r])&&(t[r]&&ra(t[r].value)&&ra(t[r].setValueAtTime)?t[r].value!==e[r]&&(t[r].value=e[r]):t[r]instanceof n?t[r].set(e[r]):t[r]=e[r])})),this}},{key:"sampleTime",get:function(){return 1/this.context.sampleRate}},{key:"blockTime",get:function(){return 128/this.context.sampleRate}}],[{key:"getDefaults",value:function(){return{context:Ka()}}}]),n}(Ta),fi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"stopped";return _classCallCheck2(this,n),(e=t.call(this)).name="StateTimeline",e._initial=r,e.setStateAtTime(e._initial,0),e}return _createClass2(n,[{key:"getValueAtTime",value:function(e){var t=this.get(e);return null!==t?t.state:this._initial}},{key:"setStateAtTime",value:function(e,t,n){return Yr(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}},{key:"getLastState",value:function(e,t){for(var n=this._search(t);n>=0;n--){var r=this._timeline[n];if(r.state===e)return r}}},{key:"getNextState",value:function(e,t){var n=this._search(t);if(-1!==n)for(var r=n;r<this._timeline.length;r++){var a=this._timeline[r];if(a.state===e)return a}}}]),n}(Na),di=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["param","units","convert"]))).name="Param",e.overridden=!1,e._minOutput=1e-7;var r=xa(n.getDefaults(),arguments,["param","units","convert"]);for(Qr(ra(r.param)&&(va(r.param)||r.param instanceof n),"param must be an AudioParam");!va(r.param);)r.param=r.param._param;return e._swappable=!!ra(r.swappable)&&r.swappable,e._swappable?(e.input=e.context.createGain(),e._param=r.param,e.input.connect(e._param)):e._param=e.input=r.param,e._events=new Na(1e3),e._initialValue=e._param.defaultValue,e.units=r.units,e.convert=r.convert,e._minValue=r.minValue,e._maxValue=r.maxValue,ra(r.value)&&r.value!==e._toType(e._initialValue)&&e.setValueAtTime(r.value,0),e}return _createClass2(n,[{key:"_is",value:function(e,t){return this.units===t}},{key:"_assertRange",value:function(e){return ra(this.maxValue)&&ra(this.minValue)&&Yr(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}},{key:"_fromType",value:function(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?Ya(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}},{key:"_toType",value:function(e){return this.convert&&"decibels"===this.units?Za(e):e}},{key:"setValueAtTime",value:function(e,t){var n=this.toSeconds(t),r=this._fromType(e);return Qr(isFinite(r)&&isFinite(n),"Invalid argument(s) to setValueAtTime: ".concat(JSON.stringify(e),", ").concat(JSON.stringify(t))),this._assertRange(r),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,n),this}},{key:"getValueAtTime",value:function(e){var t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),r=this._events.get(t),a=this._initialValue;if(null===r)a=this._initialValue;else if("setTargetAtTime"!==r.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)a=r.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){var i=r.value;if("setTargetAtTime"===r.type){var o=this._events.getBefore(r.time);i=null===o?this._initialValue:o.value}a="linearRampToValueAtTime"===n.type?this._linearInterpolate(r.time,i,n.time,n.value,t):this._exponentialInterpolate(r.time,i,n.time,n.value,t)}else a=r.value;else{var s,u=this._events.getBefore(r.time);s=null===u?this._initialValue:u.value,"setTargetAtTime"===r.type&&(a=this._exponentialApproach(r.time,s,r.value,r.constant,t))}return this._toType(a)}},{key:"setRampPoint",value:function(e){e=this.toSeconds(e);var t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),0===this._fromType(t)&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}},{key:"linearRampToValueAtTime",value:function(e,t){var n=this._fromType(e),r=this.toSeconds(t);return Qr(isFinite(n)&&isFinite(r),"Invalid argument(s) to linearRampToValueAtTime: ".concat(JSON.stringify(e),", ").concat(JSON.stringify(t))),this._assertRange(n),this._events.add({time:r,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,r),this._param.linearRampToValueAtTime(n,r),this}},{key:"exponentialRampToValueAtTime",value:function(e,t){var n=this._fromType(e);n=Math.max(this._minOutput,n),this._assertRange(n);var r=this.toSeconds(t);return Qr(isFinite(n)&&isFinite(r),"Invalid argument(s) to exponentialRampToValueAtTime: ".concat(JSON.stringify(e),", ").concat(JSON.stringify(t))),this._events.add({time:r,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,r),this._param.exponentialRampToValueAtTime(n,r),this}},{key:"exponentialRampTo",value:function(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}},{key:"linearRampTo",value:function(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}},{key:"targetRampTo",value:function(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}},{key:"exponentialApproachValueAtTime",value:function(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);var r=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,r),this.cancelAndHoldAtTime(t+.9*n),this.linearRampToValueAtTime(e,t+n),this}},{key:"setTargetAtTime",value:function(e,t,n){var r=this._fromType(e);Qr(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");var a=this.toSeconds(t);return this._assertRange(r),Qr(isFinite(r)&&isFinite(a),"Invalid argument(s) to setTargetAtTime: ".concat(JSON.stringify(e),", ").concat(JSON.stringify(t))),this._events.add({constant:n,time:a,type:"setTargetAtTime",value:r}),this.log(this.units,"setTargetAtTime",e,a,n),this._param.setTargetAtTime(r,a,n),this}},{key:"setValueCurveAtTime",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;n=this.toSeconds(n),t=this.toSeconds(t);var a=this._fromType(e[0])*r;this.setValueAtTime(this._toType(a),t);for(var i=n/(e.length-1),o=1;o<e.length;o++){var s=this._fromType(e[o])*r;this.linearRampToValueAtTime(this._toType(s),t+o*i)}return this}},{key:"cancelScheduledValues",value:function(e){var t=this.toSeconds(e);return Qr(isFinite(t),"Invalid argument to cancelScheduledValues: "+JSON.stringify(e)),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}},{key:"cancelAndHoldAtTime",value:function(e){var t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));Qr(isFinite(t),"Invalid argument to cancelAndHoldAtTime: "+JSON.stringify(e)),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);var r=this._events.get(t),a=this._events.getAfter(t);return r&&Ra(r.time,t)?a?(this._param.cancelScheduledValues(a.time),this._events.cancel(a.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):a&&(this._param.cancelScheduledValues(a.time),this._events.cancel(a.time),"linearRampToValueAtTime"===a.type?this.linearRampToValueAtTime(this._toType(n),t):"exponentialRampToValueAtTime"===a.type&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}},{key:"rampTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,n=arguments.length>2?arguments[2]:void 0;return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}},{key:"apply",value:function(e){var t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);var n=this._events.get(t);if(n&&"setTargetAtTime"===n.type)for(var r=this._events.getAfter(n.time),a=r?r.time:t+2,i=(a-t)/10,o=t;o<a;o+=i)e.linearRampToValueAtTime(this.getValueAtTime(o),o);return this._events.forEachAfter(this.context.currentTime,(function(t){"cancelScheduledValues"===t.type?e.cancelScheduledValues(t.time):"setTargetAtTime"===t.type?e.setTargetAtTime(t.value,t.time,t.constant):e[t.type](t.value,t.time)})),this}},{key:"setParam",value:function(e){Qr(this._swappable,"The Param must be assigned as 'swappable' in the constructor");var t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._events.dispose(),this}},{key:"_exponentialApproach",value:function(e,t,n,r,a){return n+(t-n)*Math.exp(-(a-e)/r)}},{key:"_linearInterpolate",value:function(e,t,n,r,a){return t+(a-e)/(n-e)*(r-t)}},{key:"_exponentialInterpolate",value:function(e,t,n,r,a){return t*Math.pow(r/t,(a-e)/(n-e))}},{key:"value",get:function(){var e=this.now();return this.getValueAtTime(e)},set:function(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}},{key:"minValue",get:function(){return ra(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}},{key:"maxValue",get:function(){return ra(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}},{key:"defaultValue",get:function(){return this._toType(this._param.defaultValue)}}],[{key:"getDefaults",value:function(){return Object.assign(hi.getDefaults(),{convert:!0,units:"number"})}}]),n}(hi),pi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="ToneAudioNode",e._internalChannels=[],e}return _createClass2(n,[{key:"_isAudioNode",value:function(e){return ra(e)&&(e instanceof n||ga(e))}},{key:"_getInternalNodes",value:function(){var e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}},{key:"_setChannelProperties",value:function(e){this._getInternalNodes().forEach((function(t){t.channelCount=e.channelCount,t.channelCountMode=e.channelCountMode,t.channelInterpretation=e.channelInterpretation}))}},{key:"_getChannelProperties",value:function(){var e=this._getInternalNodes();Qr(e.length>0,"ToneAudioNode does not have any internal nodes");var t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}},{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return vi(this,e,t,n),this}},{key:"toDestination",value:function(){return this.connect(this.context.destination),this}},{key:"toMaster",value:function(){return ta("toMaster() has been renamed toDestination()"),this.toDestination()}},{key:"disconnect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return gi(this,e,t,n),this}},{key:"chain",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return mi.apply(void 0,[this].concat(t)),this}},{key:"fan",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){return e.connect(t)})),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),ra(this.input)&&(this.input instanceof n?this.input.dispose():ga(this.input)&&this.input.disconnect()),ra(this.output)&&(this.output instanceof n?this.output.dispose():ga(this.output)&&this.output.disconnect()),this._internalChannels=[],this}},{key:"numberOfInputs",get:function(){return ra(this.input)?va(this.input)||this.input instanceof di?1:this.input.numberOfInputs:0}},{key:"numberOfOutputs",get:function(){return ra(this.output)?this.output.numberOfOutputs:0}},{key:"channelCount",get:function(){return this._getChannelProperties().channelCount},set:function(e){var t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}},{key:"channelCountMode",get:function(){return this._getChannelProperties().channelCountMode},set:function(e){var t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}},{key:"channelInterpretation",get:function(){return this._getChannelProperties().channelInterpretation},set:function(e){var t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}}]),n}(hi);function mi(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.shift();t.reduce((function(e,t){return e instanceof pi?e.connect(t):ga(e)&&vi(e,t),t}),r)}function vi(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;for(Qr(ra(e),"Cannot connect from undefined node"),Qr(ra(t),"Cannot connect to undefined node"),(t instanceof pi||ga(t))&&Qr(t.numberOfInputs>0,"Cannot connect to node with no inputs"),Qr(e.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof pi||t instanceof di;)ra(t.input)&&(t=t.input);for(;e instanceof pi;)ra(e.output)&&(e=e.output);va(t)?e.connect(t,n):e.connect(t,n,r)}function gi(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(ra(t))for(;t instanceof pi;)t=t.input;for(;!ga(e);)ra(e.output)&&(e=e.output);va(t)?e.disconnect(t,n):ga(t)?e.disconnect(t,n,r):e.disconnect()}var yi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["gain","units"]))).name="Gain",e._gainNode=e.context.createGain(),e.input=e._gainNode,e.output=e._gainNode;var r=xa(n.getDefaults(),arguments,["gain","units"]);return e.gain=new di({context:e.context,convert:r.convert,param:e._gainNode.gain,units:r.units,value:r.gain,minValue:r.minValue,maxValue:r.maxValue}),ja(_assertThisInitialized(e),"gain"),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._gainNode.disconnect(),this.gain.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{convert:!0,gain:1,units:"gain"})}}]),n}(pi),_i=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).onended=qa,r._startTime=-1,r._stopTime=-1,r._timeout=-1,r.output=new yi({context:r.context,gain:0}),r._gainNode=r.output,r.getStateAtTime=function(e){var t=this.toSeconds(e);return-1!==this._startTime&&t>=this._startTime&&(-1===this._stopTime||t<=this._stopTime)?"started":"stopped"},r._fadeIn=e.fadeIn,r._fadeOut=e.fadeOut,r._curve=e.curve,r.onended=e.onended,r}return _createClass2(n,[{key:"_startGain",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Qr(-1===this._startTime,"Source cannot be started more than once");var n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}},{key:"stop",value:function(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}},{key:"_stopGain",value:function(e){var t=this;Qr(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();var n=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+n,this._stopTime=Math.max(this._stopTime,this.context.currentTime),n>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,n,e):this._gainNode.gain.targetRampTo(0,n,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((function(){var e="exponential"===t._curve?2*n:0;t._stopSource(t.now()+e),t._onended()}),this._stopTime-this.context.currentTime),this}},{key:"_onended",value:function(){var e=this;if(this.onended!==qa&&(this.onended(this),this.onended=qa,!this.context.isOffline)){var t=function(){return e.dispose()};void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}},{key:"cancelStop",value:function(){return this.log("cancelStop"),Qr(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._gainNode.disconnect(),this}},{key:"state",get:function(){return this.getStateAtTime(this.now())}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:qa})}}]),n}(pi),bi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["offset"]))).name="ToneConstantSource",e._source=e.context.createConstantSource();var r=xa(n.getDefaults(),arguments,["offset"]);return vi(e._source,e._gainNode),e.offset=new di({context:e.context,convert:r.convert,param:e._source.offset,units:r.units,value:r.offset,minValue:r.minValue,maxValue:r.maxValue}),e}return _createClass2(n,[{key:"start",value:function(e){var t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}},{key:"_stopSource",value:function(e){this._source.stop(e)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(_i.getDefaults(),{convert:!0,offset:1,units:"number"})}}]),n}(_i),ki=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["value","units"]))).name="Signal",e.override=!0;var r=xa(n.getDefaults(),arguments,["value","units"]);return e.output=e._constantSource=new bi({context:e.context,convert:r.convert,offset:r.value,units:r.units,minValue:r.minValue,maxValue:r.maxValue}),e._constantSource.start(0),e.input=e._param=e._constantSource.offset,e}return _createClass2(n,[{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return wi(this,e,t,n),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._param.dispose(),this._constantSource.dispose(),this}},{key:"setValueAtTime",value:function(e,t){return this._param.setValueAtTime(e,t),this}},{key:"getValueAtTime",value:function(e){return this._param.getValueAtTime(e)}},{key:"setRampPoint",value:function(e){return this._param.setRampPoint(e),this}},{key:"linearRampToValueAtTime",value:function(e,t){return this._param.linearRampToValueAtTime(e,t),this}},{key:"exponentialRampToValueAtTime",value:function(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}},{key:"exponentialRampTo",value:function(e,t,n){return this._param.exponentialRampTo(e,t,n),this}},{key:"linearRampTo",value:function(e,t,n){return this._param.linearRampTo(e,t,n),this}},{key:"targetRampTo",value:function(e,t,n){return this._param.targetRampTo(e,t,n),this}},{key:"exponentialApproachValueAtTime",value:function(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}},{key:"setTargetAtTime",value:function(e,t,n){return this._param.setTargetAtTime(e,t,n),this}},{key:"setValueCurveAtTime",value:function(e,t,n,r){return this._param.setValueCurveAtTime(e,t,n,r),this}},{key:"cancelScheduledValues",value:function(e){return this._param.cancelScheduledValues(e),this}},{key:"cancelAndHoldAtTime",value:function(e){return this._param.cancelAndHoldAtTime(e),this}},{key:"rampTo",value:function(e,t,n){return this._param.rampTo(e,t,n),this}},{key:"apply",value:function(e){return this._param.apply(e),this}},{key:"value",get:function(){return this._param.value},set:function(e){this._param.value=e}},{key:"convert",get:function(){return this._param.convert},set:function(e){this._param.convert=e}},{key:"units",get:function(){return this._param.units}},{key:"overridden",get:function(){return this._param.overridden},set:function(e){this._param.overridden=e}},{key:"maxValue",get:function(){return this._param.maxValue}},{key:"minValue",get:function(){return this._param.minValue}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{convert:!0,units:"number",value:0})}}]),n}(pi);function wi(e,t,n,r){(t instanceof di||va(t)||t instanceof ki&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof ki&&(t.overridden=!0)),vi(e,t,n,r)}var xi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["value"]))).name="TickParam",e._events=new Na(1/0),e._multiplier=1;var r=xa(n.getDefaults(),arguments,["value"]);return e._multiplier=r.multiplier,e._events.cancel(0),e._events.add({ticks:0,time:0,type:"setValueAtTime",value:e._fromType(r.value)}),e.setValueAtTime(r.value,0),e}return _createClass2(n,[{key:"setTargetAtTime",value:function(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);for(var r=this._fromType(e),a=this._events.get(t),i=Math.round(Math.max(1/n,1)),o=0;o<=i;o++){var s=n*o+t,u=this._exponentialApproach(a.time,a.value,r,n,s);this.linearRampToValueAtTime(this._toType(u),s)}return this}},{key:"setValueAtTime",value:function(e,t){var r=this.toSeconds(t);_get(_getPrototypeOf(n.prototype),"setValueAtTime",this).call(this,e,t);var a=this._events.get(r),i=this._events.previousEvent(a),o=this._getTicksUntilEvent(i,r);return a.ticks=Math.max(o,0),this}},{key:"linearRampToValueAtTime",value:function(e,t){var r=this.toSeconds(t);_get(_getPrototypeOf(n.prototype),"linearRampToValueAtTime",this).call(this,e,t);var a=this._events.get(r),i=this._events.previousEvent(a),o=this._getTicksUntilEvent(i,r);return a.ticks=Math.max(o,0),this}},{key:"exponentialRampToValueAtTime",value:function(e,t){t=this.toSeconds(t);for(var n=this._fromType(e),r=this._events.get(t),a=Math.round(Math.max(10*(t-r.time),1)),i=(t-r.time)/a,o=0;o<=a;o++){var s=i*o+r.time,u=this._exponentialInterpolate(r.time,r.value,t,n,s);this.linearRampToValueAtTime(this._toType(u),s)}return this}},{key:"_getTicksUntilEvent",value:function(e,t){if(null===e)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(na(e.ticks)){var n=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(n,e.time)}var r=this._fromType(this.getValueAtTime(e.time)),a=this._fromType(this.getValueAtTime(t)),i=this._events.get(t);return i&&i.time===t&&"setValueAtTime"===i.type&&(a=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(r+a)+e.ticks}},{key:"getTicksAtTime",value:function(e){var t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}},{key:"getDurationOfTicks",value:function(e,t){var n=this.toSeconds(t),r=this.getTicksAtTime(t);return this.getTimeOfTick(r+e)-n}},{key:"getTimeOfTick",value:function(e){var t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&"linearRampToValueAtTime"===n.type&&t.value!==n.value){var r=this._fromType(this.getValueAtTime(t.time)),a=(this._fromType(this.getValueAtTime(n.time))-r)/(n.time-t.time),i=Math.sqrt(Math.pow(r,2)-2*a*(t.ticks-e)),o=(-r+i)/a;return(o>0?o:(-r-i)/a)+t.time}return t?0===t.value?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}},{key:"ticksToTime",value:function(e,t){return this.getDurationOfTicks(e,t)}},{key:"timeToTicks",value:function(e,t){var n=this.toSeconds(t),r=this.toSeconds(e),a=this.getTicksAtTime(n);return this.getTicksAtTime(n+r)-a}},{key:"_fromType",value:function(e){return"bpm"===this.units&&this.multiplier?1/(60/e/this.multiplier):_get(_getPrototypeOf(n.prototype),"_fromType",this).call(this,e)}},{key:"_toType",value:function(e){return"bpm"===this.units&&this.multiplier?e/this.multiplier*60:_get(_getPrototypeOf(n.prototype),"_toType",this).call(this,e)}},{key:"multiplier",get:function(){return this._multiplier},set:function(e){var t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}],[{key:"getDefaults",value:function(){return Object.assign(di.getDefaults(),{multiplier:1,units:"hertz",value:1})}}]),n}(di),Ci=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["value"]))).name="TickSignal";var r=xa(n.getDefaults(),arguments,["value"]);return e.input=e._param=new xi({context:e.context,convert:r.convert,multiplier:r.multiplier,param:e._constantSource.offset,units:r.units,value:r.value}),e}return _createClass2(n,[{key:"ticksToTime",value:function(e,t){return this._param.ticksToTime(e,t)}},{key:"timeToTicks",value:function(e,t){return this._param.timeToTicks(e,t)}},{key:"getTimeOfTick",value:function(e){return this._param.getTimeOfTick(e)}},{key:"getDurationOfTicks",value:function(e,t){return this._param.getDurationOfTicks(e,t)}},{key:"getTicksAtTime",value:function(e){return this._param.getTicksAtTime(e)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._param.dispose(),this}},{key:"multiplier",get:function(){return this._param.multiplier},set:function(e){this._param.multiplier=e}}],[{key:"getDefaults",value:function(){return Object.assign(ki.getDefaults(),{multiplier:1,units:"hertz",value:1})}}]),n}(ki),Si=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency"]))).name="TickSource",e._state=new fi,e._tickOffset=new Na;var r=xa(n.getDefaults(),arguments,["frequency"]);return e.frequency=new Ci({context:e.context,units:r.units,value:r.frequency}),ja(_assertThisInitialized(e),"frequency"),e._state.setStateAtTime("stopped",0),e.setTicksAtTime(0,0),e}return _createClass2(n,[{key:"start",value:function(e,t){var n=this.toSeconds(e);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),ra(t)&&this.setTicksAtTime(t,n)),this}},{key:"stop",value:function(e){var t=this.toSeconds(e);if("stopped"===this._state.getValueAtTime(t)){var n=this._state.get(t);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this}},{key:"pause",value:function(e){var t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&this._state.setStateAtTime("paused",t),this}},{key:"cancel",value:function(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this}},{key:"getTicksAtTime",value:function(e){var t=this,n=this.toSeconds(e),r=this._state.getLastState("stopped",n),a={state:"paused",time:n};this._state.add(a);var i=r,o=0;return this._state.forEachBetween(r.time,n+this.sampleTime,(function(e){var n=i.time,r=t._tickOffset.get(e.time);r&&r.time>=i.time&&(o=r.ticks,n=r.time),"started"===i.state&&"started"!==e.state&&(o+=t.frequency.getTicksAtTime(e.time)-t.frequency.getTicksAtTime(n)),i=e})),this._state.remove(a),o}},{key:"getSecondsAtTime",value:function(e){var t=this;e=this.toSeconds(e);var n=this._state.getLastState("stopped",e),r={state:"paused",time:e};this._state.add(r);var a=n,i=0;return this._state.forEachBetween(n.time,e+this.sampleTime,(function(e){var n=a.time,r=t._tickOffset.get(e.time);r&&r.time>=a.time&&(i=r.seconds,n=r.time),"started"===a.state&&"started"!==e.state&&(i+=e.time-n),a=e})),this._state.remove(r),i}},{key:"setTicksAtTime",value:function(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this}},{key:"getStateAtTime",value:function(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}},{key:"getTimeOfTick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.now(),n=this._tickOffset.get(t),r=this._state.get(t),a=Math.max(n.time,r.time),i=this.frequency.getTicksAtTime(a)+e-n.ticks;return this.frequency.getTimeOfTick(i)}},{key:"forEachTickBetween",value:function(e,t,n){var r=this,a=this._state.get(e);this._state.forEachBetween(e,t,(function(t){a&&"started"===a.state&&"started"!==t.state&&r.forEachTickBetween(Math.max(a.time,e),t.time-r.sampleTime,n),a=t}));var i=null;if(a&&"started"===a.state){var o=Math.max(a.time,e),s=this.frequency.getTicksAtTime(o),u=s-this.frequency.getTicksAtTime(a.time),c=Math.ceil(u)-u;c=Ra(c,1)?0:c;for(var l=this.frequency.getTimeOfTick(s+c);l<t;){try{n(l,Math.round(this.getTicksAtTime(l)))}catch(h){i=h;break}l+=this.frequency.getDurationOfTicks(1,l)}}if(i)throw i;return this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}},{key:"state",get:function(){return this.getStateAtTime(this.now())}},{key:"ticks",get:function(){return this.getTicksAtTime(this.now())},set:function(e){this.setTicksAtTime(e,this.now())}},{key:"seconds",get:function(){return this.getSecondsAtTime(this.now())},set:function(e){var t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}}],[{key:"getDefaults",value:function(){return Object.assign({frequency:1,units:"hertz"},hi.getDefaults())}}]),n}(hi),Ti=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["callback","frequency"]))).name="Clock",e.callback=qa,e._lastUpdate=0,e._state=new fi("stopped"),e._boundLoop=e._loop.bind(_assertThisInitialized(e));var r=xa(n.getDefaults(),arguments,["callback","frequency"]);return e.callback=r.callback,e._tickSource=new Si({context:e.context,frequency:r.frequency,units:r.units}),e._lastUpdate=0,e.frequency=e._tickSource.frequency,ja(_assertThisInitialized(e),"frequency"),e._state.setStateAtTime("stopped",0),e.context.on("tick",e._boundLoop),e}return _createClass2(n,[{key:"start",value:function(e,t){Zr(this.context);var n=this.toSeconds(e);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}},{key:"stop",value:function(e){var t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}},{key:"pause",value:function(e){var t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}},{key:"getSecondsAtTime",value:function(e){return this._tickSource.getSecondsAtTime(e)}},{key:"setTicksAtTime",value:function(e,t){return this._tickSource.setTicksAtTime(e,t),this}},{key:"getTimeOfTick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.now();return this._tickSource.getTimeOfTick(e,t)}},{key:"getTicksAtTime",value:function(e){return this._tickSource.getTicksAtTime(e)}},{key:"nextTickTime",value:function(e,t){var n=this.toSeconds(t),r=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(r+e,n)}},{key:"_loop",value:function(){var e=this,t=this._lastUpdate,n=this.now();this._lastUpdate=n,this.log("loop",t,n),t!==n&&(this._state.forEachBetween(t,n,(function(t){switch(t.state){case"started":var n=e._tickSource.getTicksAtTime(t.time);e.emit("start",t.time,n);break;case"stopped":0!==t.time&&e.emit("stop",t.time);break;case"paused":e.emit("pause",t.time)}})),this._tickSource.forEachTickBetween(t,n,(function(t,n){e.callback(t,n)})))}},{key:"getStateAtTime",value:function(e){var t=this.toSeconds(e);return this._state.getValueAtTime(t)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}},{key:"state",get:function(){return this._state.getValueAtTime(this.now())}},{key:"ticks",get:function(){return Math.ceil(this.getTicksAtTime(this.now()))},set:function(e){this._tickSource.ticks=e}},{key:"seconds",get:function(){return this._tickSource.seconds},set:function(e){this._tickSource.seconds=e}}],[{key:"getDefaults",value:function(){return Object.assign(hi.getDefaults(),{callback:qa,frequency:1,units:"hertz"})}}]),n}(hi);La.mixin(Ti);var Ai=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["delayTime","maxDelay"]))).name="Delay";var r=xa(n.getDefaults(),arguments,["delayTime","maxDelay"]),a=e.toSeconds(r.maxDelay);return e._maxDelay=Math.max(a,e.toSeconds(r.delayTime)),e._delayNode=e.input=e.output=e.context.createDelay(a),e.delayTime=new di({context:e.context,param:e._delayNode.delayTime,units:"time",value:r.delayTime,minValue:0,maxValue:e.maxDelay}),ja(_assertThisInitialized(e),"delayTime"),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._delayNode.disconnect(),this.delayTime.dispose(),this}},{key:"maxDelay",get:function(){return this._maxDelay}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{delayTime:0,maxDelay:1})}}]),n}(pi);function Ei(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ka().sampleRate;return pa(this,void 0,void 0,regeneratorRuntime.mark((function a(){var i,o,s,u;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=Ka(),Xa(o=new Wa(n,t,r)),a.next=4,e(o);case 4:return s=o.render(),Xa(i),a.next=8,s;case 8:return u=a.sent,a.abrupt("return",new Ua(u));case 10:case"end":return a.stop()}}),a)})))}var Ii=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this)).name="ToneAudioBuffers",e._buffers=new Map,e._loadingCount=0;var r=xa(n.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");return e.baseUrl=r.baseUrl,Object.keys(r.urls).forEach((function(t){e._loadingCount++,e.add(t,r.urls[t],e._bufferLoaded.bind(_assertThisInitialized(e),r.onload),r.onerror)})),e}return _createClass2(n,[{key:"has",value:function(e){return this._buffers.has(e.toString())}},{key:"get",value:function(e){return Qr(this.has(e),"ToneAudioBuffers has no buffer named: "+e),this._buffers.get(e.toString())}},{key:"_bufferLoaded",value:function(e){this._loadingCount--,0===this._loadingCount&&e&&e()}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qa,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qa;return ca(t)?this._buffers.set(e.toString(),new Ua(this.baseUrl+t,n,r)):this._buffers.set(e.toString(),new Ua(t,n,r)),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._buffers.forEach((function(e){return e.dispose()})),this._buffers.clear(),this}},{key:"loaded",get:function(){return Array.from(this._buffers).every((function(e){var t=_slicedToArray2(e,2);t[0];return t[1].loaded}))}}],[{key:"getDefaults",value:function(){return{baseUrl:"",onerror:qa,onload:qa,urls:{}}}}]),n}(Ta),Ri=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="MidiClass",e.defaultUnits="midi",e}return _createClass2(n,[{key:"_frequencyToUnits",value:function(e){return ei(_get(_getPrototypeOf(n.prototype),"_frequencyToUnits",this).call(this,e))}},{key:"_ticksToUnits",value:function(e){return ei(_get(_getPrototypeOf(n.prototype),"_ticksToUnits",this).call(this,e))}},{key:"_beatsToUnits",value:function(e){return ei(_get(_getPrototypeOf(n.prototype),"_beatsToUnits",this).call(this,e))}},{key:"_secondsToUnits",value:function(e){return ei(_get(_getPrototypeOf(n.prototype),"_secondsToUnits",this).call(this,e))}},{key:"toMidi",value:function(){return this.valueOf()}},{key:"toFrequency",value:function(){return ni(this.toMidi())}},{key:"transpose",value:function(e){return new n(this.context,this.toMidi()+e)}}]),n}(ii);function Oi(e,t){return new Ri(Ka(),e,t)}var Ni=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="Ticks",e.defaultUnits="i",e}return _createClass2(n,[{key:"_now",value:function(){return this.context.transport.ticks}},{key:"_beatsToUnits",value:function(e){return this._getPPQ()*e}},{key:"_secondsToUnits",value:function(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}},{key:"_ticksToUnits",value:function(e){return e}},{key:"toTicks",value:function(){return this.valueOf()}},{key:"toSeconds",value:function(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}]),n}(ci);function Di(e,t){return new Ni(Ka(),e,t)}var Pi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="Draw",e.expiration=.25,e.anticipation=.008,e._events=new Na,e._boundDrawLoop=e._drawLoop.bind(_assertThisInitialized(e)),e._animationFrame=-1,e}return _createClass2(n,[{key:"schedule",value:function(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}},{key:"cancel",value:function(e){return this._events.cancel(this.toSeconds(e)),this}},{key:"_drawLoop",value:function(){for(var e=this.context.currentTime;this._events.length&&this._events.peek().time-this.anticipation<=e;){var t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}]),n}(hi);Pa((function(e){e.draw=new Pi({context:e})})),Ma((function(e){e.draw.dispose()}));var Fi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="IntervalTimeline",e._root=null,e._length=0,e}return _createClass2(n,[{key:"add",value:function(e){Qr(ra(e.time),"Events must have a time property"),Qr(ra(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();var t=new Mi(e.time,e.time+e.duration,e);for(null===this._root?this._root=t:this._root.insert(t),this._length++;null!==t;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}},{key:"remove",value:function(e){if(null!==this._root){var t=[];this._root.search(e.time,t);for(var n=0,r=t;n<r.length;n++){var a=r[n];if(a.event===e){this._removeNode(a),this._length--;break}}}return this}},{key:"cancel",value:function(e){var t=this;return this.forEachFrom(e,(function(e){return t.remove(e)})),this}},{key:"_setRoot",value:function(e){this._root=e,null!==this._root&&(this._root.parent=null)}},{key:"_replaceNodeInParent",value:function(e,t){null!==e.parent?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}},{key:"_removeNode",value:function(e){if(null===e.left&&null===e.right)this._replaceNodeInParent(e,null);else if(null===e.right)this._replaceNodeInParent(e,e.left);else if(null===e.left)this._replaceNodeInParent(e,e.right);else{var t,n=null;if(e.getBalance()>0)if(null===e.left.right)(t=e.left).right=e.right,n=t;else{for(t=e.left.right;null!==t.right;)t=t.right;t.parent&&(t.parent.right=t.left,n=t.parent,t.left=e.left,t.right=e.right)}else if(null===e.right.left)(t=e.right).left=e.left,n=t;else{for(t=e.right.left;null!==t.left;)t=t.left;t.parent&&(t.parent.left=t.right,n=t.parent,t.left=e.left,t.right=e.right)}null!==e.parent?e.isLeftChild()?e.parent.left=t:e.parent.right=t:this._setRoot(t),n&&this._rebalance(n)}e.dispose()}},{key:"_rotateLeft",value:function(e){var t=e.parent,n=e.isLeftChild(),r=e.right;r&&(e.right=r.left,r.left=e),null!==t?n?t.left=r:t.right=r:this._setRoot(r)}},{key:"_rotateRight",value:function(e){var t=e.parent,n=e.isLeftChild(),r=e.left;r&&(e.left=r.right,r.right=e),null!==t?n?t.left=r:t.right=r:this._setRoot(r)}},{key:"_rebalance",value:function(e){var t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}},{key:"get",value:function(e){if(null!==this._root){var t=[];if(this._root.search(e,t),t.length>0){for(var n=t[0],r=1;r<t.length;r++)t[r].low>n.low&&(n=t[r]);return n.event}}return null}},{key:"forEach",value:function(e){if(null!==this._root){var t=[];this._root.traverse((function(e){return t.push(e)})),t.forEach((function(t){t.event&&e(t.event)}))}return this}},{key:"forEachAtTime",value:function(e,t){if(null!==this._root){var n=[];this._root.search(e,n),n.forEach((function(e){e.event&&t(e.event)}))}return this}},{key:"forEachFrom",value:function(e,t){if(null!==this._root){var n=[];this._root.searchAfter(e,n),n.forEach((function(e){e.event&&t(e.event)}))}return this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),null!==this._root&&this._root.traverse((function(e){return e.dispose()})),this._root=null,this}},{key:"length",get:function(){return this._length}}]),n}(Ta),Mi=function(){function e(t,n,r){_classCallCheck2(this,e),this._left=null,this._right=null,this.parent=null,this.height=0,this.event=r,this.low=t,this.high=n,this.max=this.high}return _createClass2(e,[{key:"insert",value:function(e){e.low<=this.low?null===this.left?this.left=e:this.left.insert(e):null===this.right?this.right=e:this.right.insert(e)}},{key:"search",value:function(e,t){e>this.max||(null!==this.left&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),this.low>e||null!==this.right&&this.right.search(e,t))}},{key:"searchAfter",value:function(e,t){this.low>=e&&(t.push(this),null!==this.left&&this.left.searchAfter(e,t)),null!==this.right&&this.right.searchAfter(e,t)}},{key:"traverse",value:function(e){e(this),null!==this.left&&this.left.traverse(e),null!==this.right&&this.right.traverse(e)}},{key:"updateHeight",value:function(){this.height=null!==this.left&&null!==this.right?Math.max(this.left.height,this.right.height)+1:null!==this.right?this.right.height+1:null!==this.left?this.left.height+1:0}},{key:"updateMax",value:function(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}},{key:"getBalance",value:function(){var e=0;return null!==this.left&&null!==this.right?e=this.left.height-this.right.height:null!==this.left?e=this.left.height+1:null!==this.right&&(e=-(this.right.height+1)),e}},{key:"isLeftChild",value:function(){return null!==this.parent&&this.parent.left===this}},{key:"dispose",value:function(){this.parent=null,this._left=null,this._right=null,this.event=null}},{key:"left",get:function(){return this._left},set:function(e){this._left=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}},{key:"right",get:function(){return this._right},set:function(e){this._right=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}}]),e}(),Li=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["volume"]))).name="Volume";var r=xa(n.getDefaults(),arguments,["volume"]);return e.input=e.output=new yi({context:e.context,gain:r.volume,units:"decibels"}),e.volume=e.output.gain,ja(_assertThisInitialized(e),"volume"),e._unmutedVolume=r.volume,e.mute=r.mute,e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.input.dispose(),this.volume.dispose(),this}},{key:"mute",get:function(){return this.volume.value===-1/0},set:function(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{mute:!1,volume:0})}}]),n}(pi),zi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="Destination",e.input=new Li({context:e.context}),e.output=new yi({context:e.context}),e.volume=e.input.volume;var r=xa(n.getDefaults(),arguments);return mi(e.input,e.output,e.context.rawContext.destination),e.mute=r.mute,e._internalChannels=[e.input,e.context.rawContext.destination,e.output],e}return _createClass2(n,[{key:"chain",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.input.disconnect(),t.unshift(this.input),t.push(this.output),mi.apply(void 0,t),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.volume.dispose(),this}},{key:"mute",get:function(){return this.input.mute},set:function(e){this.input.mute=e}},{key:"maxChannelCount",get:function(){return this.context.rawContext.destination.maxChannelCount}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{mute:!1,volume:0})}}]),n}(pi);Pa((function(e){e.destination=new zi({context:e})})),Ma((function(e){e.destination.dispose()}));var Bi=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this)).name="TimelineValue",r._timeline=new Na({memory:10}),r._initialValue=e,r}return _createClass2(n,[{key:"set",value:function(e,t){return this._timeline.add({value:e,time:t}),this}},{key:"get",value:function(e){var t=this._timeline.get(e);return t?t.value:this._initialValue}}]),n}(Ta),ji=function(){function e(t,n){_classCallCheck2(this,e),this.id=e._eventId++;var r=Object.assign(e.getDefaults(),n);this.transport=t,this.callback=r.callback,this._once=r.once,this.time=r.time}return _createClass2(e,[{key:"invoke",value:function(e){this.callback&&(this.callback(e),this._once&&this.transport.clear(this.id))}},{key:"dispose",value:function(){return this.callback=void 0,this}}],[{key:"getDefaults",value:function(){return{callback:qa,once:!1,time:0}}}]),e}();ji._eventId=0;var Vi=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;_classCallCheck2(this,n),(a=t.call(this,e,r))._currentId=-1,a._nextId=-1,a._nextTick=a.time,a._boundRestart=a._restart.bind(_assertThisInitialized(a));var i=Object.assign(n.getDefaults(),r);return a.duration=new Ni(e.context,i.duration).valueOf(),a._interval=new Ni(e.context,i.interval).valueOf(),a._nextTick=i.time,a.transport.on("start",a._boundRestart),a.transport.on("loopStart",a._boundRestart),a.context=a.transport.context,a._restart(),a}return _createClass2(n,[{key:"invoke",value:function(e){this._createEvents(e),_get(_getPrototypeOf(n.prototype),"invoke",this).call(this,e)}},{key:"_createEvents",value:function(e){var t=this.transport.getTicksAtTime(e);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ni(this.context,this._nextTick).toSeconds()))}},{key:"_restart",value:function(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;var t=this.transport.getTicksAtTime(e);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new Ni(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ni(this.context,this._nextTick).toSeconds())}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}],[{key:"getDefaults",value:function(){return Object.assign({},ji.getDefaults(),{duration:1/0,interval:1,once:!1})}}]),n}(ji),qi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="Transport",e._loop=new Bi(!1),e._loopStart=0,e._loopEnd=0,e._scheduledEvents={},e._timeline=new Na,e._repeatedEvents=new Fi,e._syncedSignals=[],e._swingAmount=0;var r=xa(n.getDefaults(),arguments);return e._ppq=r.ppq,e._clock=new Ti({callback:e._processTick.bind(_assertThisInitialized(e)),context:e.context,frequency:0,units:"bpm"}),e._bindClockEvents(),e.bpm=e._clock.frequency,e._clock.frequency.multiplier=r.ppq,e.bpm.setValueAtTime(r.bpm,0),ja(_assertThisInitialized(e),"bpm"),e._timeSignature=r.timeSignature,e._swingTicks=r.ppq/2,e}return _createClass2(n,[{key:"_processTick",value:function(e,t){if(this._swingAmount>0&&t%this._ppq!=0&&t%(2*this._swingTicks)!=0){var n=Math.sin(t%(2*this._swingTicks)/(2*this._swingTicks)*Math.PI)*this._swingAmount;e+=new Ni(this.context,2*this._swingTicks/3).toSeconds()*n}this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._timeline.forEachAtTime(t,(function(t){return t.invoke(e)}))}},{key:"schedule",value:function(e,t){var n=new ji(this,{callback:e,time:new ci(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}},{key:"scheduleRepeat",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,a=new Vi(this,{callback:e,duration:new ri(this.context,r).toTicks(),interval:new ri(this.context,t).toTicks(),time:new ci(this.context,n).toTicks()});return this._addEvent(a,this._repeatedEvents)}},{key:"scheduleOnce",value:function(e,t){var n=new ji(this,{callback:e,once:!0,time:new ci(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}},{key:"clear",value:function(e){if(this._scheduledEvents.hasOwnProperty(e)){var t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}},{key:"_addEvent",value:function(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}},{key:"cancel",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=this.toTicks(t);return this._timeline.forEachFrom(n,(function(t){return e.clear(t.id)})),this._repeatedEvents.forEachFrom(n,(function(t){return e.clear(t.id)})),this}},{key:"_bindClockEvents",value:function(){var e=this;this._clock.on("start",(function(t,n){n=new Ni(e.context,n).toSeconds(),e.emit("start",t,n)})),this._clock.on("stop",(function(t){e.emit("stop",t)})),this._clock.on("pause",(function(t){e.emit("pause",t)}))}},{key:"start",value:function(e,t){var n;return ra(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}},{key:"stop",value:function(e){return this._clock.stop(e),this}},{key:"pause",value:function(e){return this._clock.pause(e),this}},{key:"toggle",value:function(e){return e=this.toSeconds(e),"started"!==this._clock.getStateAtTime(e)?this.start(e):this.stop(e),this}},{key:"setLoopPoints",value:function(e,t){return this.loopStart=e,this.loopEnd=t,this}},{key:"getTicksAtTime",value:function(e){return Math.round(this._clock.getTicksAtTime(e))}},{key:"getSecondsAtTime",value:function(e){return this._clock.getSecondsAtTime(e)}},{key:"nextSubdivision",value:function(e){if(e=this.toTicks(e),"started"!==this.state)return 0;var t=this.now(),n=this.getTicksAtTime(t);return this._clock.nextTickTime(e-n%e,t)}},{key:"syncSignal",value:function(e,t){if(!t){var n=this.now();if(0!==e.getValueAtTime(n)){var r=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);t=e.getValueAtTime(n)/r}else t=0}var a=new yi(t);return this.bpm.connect(a),a.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:a,signal:e}),e.value=0,this}},{key:"unsyncSignal",value:function(e){for(var t=this._syncedSignals.length-1;t>=0;t--){var n=this._syncedSignals[t];n.signal===e&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._clock.dispose(),Va(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}},{key:"state",get:function(){return this._clock.getStateAtTime(this.now())}},{key:"timeSignature",get:function(){return this._timeSignature},set:function(e){ua(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}},{key:"loopStart",get:function(){return new ri(this.context,this._loopStart,"i").toSeconds()},set:function(e){this._loopStart=this.toTicks(e)}},{key:"loopEnd",get:function(){return new ri(this.context,this._loopEnd,"i").toSeconds()},set:function(e){this._loopEnd=this.toTicks(e)}},{key:"loop",get:function(){return this._loop.get(this.now())},set:function(e){this._loop.set(e,this.now())}},{key:"swing",get:function(){return this._swingAmount},set:function(e){this._swingAmount=e}},{key:"swingSubdivision",get:function(){return new Ni(this.context,this._swingTicks).toNotation()},set:function(e){this._swingTicks=this.toTicks(e)}},{key:"position",get:function(){var e=this.now(),t=this._clock.getTicksAtTime(e);return new Ni(this.context,t).toBarsBeatsSixteenths()},set:function(e){var t=this.toTicks(e);this.ticks=t}},{key:"seconds",get:function(){return this._clock.seconds},set:function(e){var t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}},{key:"progress",get:function(){if(this.loop){var e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}},{key:"ticks",get:function(){return this._clock.ticks},set:function(e){if(this._clock.ticks!==e){var t=this.now();if("started"===this.state){var n=this._clock.getTicksAtTime(t),r=this._clock.getTimeOfTick(Math.ceil(n));this.emit("stop",r),this._clock.setTicksAtTime(e,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this._clock.setTicksAtTime(e,t)}}},{key:"PPQ",get:function(){return this._clock.frequency.multiplier},set:function(e){this._clock.frequency.multiplier=e}}],[{key:"getDefaults",value:function(){return Object.assign(hi.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}}]),n}(hi);La.mixin(qi),Pa((function(e){e.transport=new qi({context:e})})),Ma((function(e){e.transport.dispose()}));var Ui=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).input=void 0,r._state=new fi("stopped"),r._synced=!1,r._scheduled=[],r._syncedStart=qa,r._syncedStop=qa,r._state.memory=100,r._state.increasing=!0,r._volume=r.output=new Li({context:r.context,mute:e.mute,volume:e.volume}),r.volume=r._volume.volume,ja(_assertThisInitialized(r),"volume"),r.onstop=e.onstop,r}return _createClass2(n,[{key:"_clampToCurrentTime",value:function(e){return this._synced?e:Math.max(e,this.context.currentTime)}},{key:"start",value:function(e,t,n){var r=this,a=na(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(a=this._clampToCurrentTime(a),this._synced||"started"!==this._state.getValueAtTime(a))if(this.log("start",a),this._state.setStateAtTime("started",a),this._synced){var i=this._state.get(a);i&&(i.offset=this.toSeconds(Ca(t,0)),i.duration=n?this.toSeconds(n):void 0);var o=this.context.transport.schedule((function(e){r._start(e,t,n)}),a);this._scheduled.push(o),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>a&&this._syncedStart(this.now(),this.context.transport.seconds)}else Zr(this.context),this._start(a,t,n);else Qr(Aa(a,this._state.get(a).time),"Start time must be strictly greater than previous start time"),this._state.cancel(a),this._state.setStateAtTime("started",a),this.log("restart",a),this.restart(a,t,n);return this}},{key:"stop",value:function(e){var t=na(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),"started"===this._state.getValueAtTime(t)||ra(this._state.getNextState("started",t))){if(this.log("stop",t),this._synced){var n=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(n)}else this._stop(t);this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}},{key:"restart",value:function(e,t,n){return e=this.toSeconds(e),"started"===this._state.getValueAtTime(e)&&(this._state.cancel(e),this._restart(e,t,n)),this}},{key:"sync",value:function(){var e=this;return this._synced||(this._synced=!0,this._syncedStart=function(t,n){if(n>0){var r=e._state.get(n);if(r&&"started"===r.state&&r.time!==n){var a,i=n-e.toSeconds(r.time);r.duration&&(a=e.toSeconds(r.duration)-i),e._start(t,e.toSeconds(r.offset)+i,a)}}},this._syncedStop=function(t){var n=e.context.transport.getSecondsAtTime(Math.max(t-e.sampleTime,0));"started"===e._state.getValueAtTime(n)&&e._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}},{key:"unsync",value:function(){var e=this;return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((function(t){return e.context.transport.clear(t)})),this._scheduled=[],this._state.cancel(0),this._stop(0),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.onstop=qa,this.unsync(),this._volume.dispose(),this._state.dispose(),this}},{key:"state",get:function(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}},{key:"mute",get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{mute:!1,onstop:qa,volume:0})}}]),n}(pi),Wi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["url","onload"]))).name="ToneBufferSource",e._source=e.context.createBufferSource(),e._internalChannels=[e._source],e._sourceStarted=!1,e._sourceStopped=!1;var r=xa(n.getDefaults(),arguments,["url","onload"]);return vi(e._source,e._gainNode),e._source.onended=function(){return e._stopSource()},e.playbackRate=new di({context:e.context,param:e._source.playbackRate,units:"positive",value:r.playbackRate}),e.loop=r.loop,e.loopStart=r.loopStart,e.loopEnd=r.loopEnd,e._buffer=new Ua(r.url,r.onload,r.onerror),e._internalChannels.push(e._source),e}return _createClass2(n,[{key:"start",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Qr(this.buffer.loaded,"buffer is either not set or not loaded");var a=this.toSeconds(e);this._startGain(a,r),t=Ca(t,this.loop?this.loopStart:0);var i=Math.max(this.toSeconds(t),0);if(this.loop){var o=this.toSeconds(this.loopEnd)||this.buffer.duration,s=this.toSeconds(this.loopStart),u=o-s;Ea(i,o)&&(i=(i-s)%u+s),Ra(i,this.buffer.duration)&&(i=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Ia(i,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(a,i)),ra(n)){var c=this.toSeconds(n);c=Math.max(c,0),this.stop(a+c)}return this}},{key:"_stopSource",value:function(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}},{key:"fadeIn",get:function(){return this._fadeIn},set:function(e){this._fadeIn=e}},{key:"fadeOut",get:function(){return this._fadeOut},set:function(e){this._fadeOut=e}},{key:"curve",get:function(){return this._curve},set:function(e){this._curve=e}},{key:"loopStart",get:function(){return this._source.loopStart},set:function(e){this._source.loopStart=this.toSeconds(e)}},{key:"loopEnd",get:function(){return this._source.loopEnd},set:function(e){this._source.loopEnd=this.toSeconds(e)}},{key:"buffer",get:function(){return this._buffer},set:function(e){this._buffer.set(e)}},{key:"loop",get:function(){return this._source.loop},set:function(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}}],[{key:"getDefaults",value:function(){return Object.assign(_i.getDefaults(),{url:new Ua,loop:!1,loopEnd:0,loopStart:0,onload:qa,onerror:qa,playbackRate:1})}}]),n}(_i),Gi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["type"]))).name="Noise",e._source=null;var r=xa(n.getDefaults(),arguments,["type"]);return e._playbackRate=r.playbackRate,e.type=r.type,e._fadeIn=r.fadeIn,e._fadeOut=r.fadeOut,e}return _createClass2(n,[{key:"_start",value:function(e){var t=this,n=Ki[this._type];this._source=new Wi({url:n,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:function(){return t.onstop(t)},playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(n.duration-.001))}},{key:"_stop",value:function(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}},{key:"_restart",value:function(e){this._stop(e),this._start(e)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._source&&this._source.disconnect(),this}},{key:"type",get:function(){return this._type},set:function(e){if(Qr(e in Ki,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,"started"===this.state)){var t=this.now();this._stop(t),this._start(t)}}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}},{key:"fadeIn",get:function(){return this._fadeIn},set:function(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}},{key:"fadeOut",get:function(){return this._fadeOut},set:function(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}}],[{key:"getDefaults",value:function(){return Object.assign(Ui.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}}]),n}(Ui),Hi={brown:null,pink:null,white:null},Ki={get brown(){if(!Hi.brown){for(var e=[],t=0;t<2;t++){var n=new Float32Array(220500);e[t]=n;for(var r=0,a=0;a<220500;a++){var i=2*Math.random()-1;n[a]=(r+.02*i)/1.02,r=n[a],n[a]*=3.5}}Hi.brown=(new Ua).fromArray(e)}return Hi.brown},get pink(){if(!Hi.pink){for(var e=[],t=0;t<2;t++){var n=new Float32Array(220500),r=void 0,a=void 0,i=void 0,o=void 0,s=void 0,u=void 0,c=void 0;e[t]=n,r=a=i=o=s=u=c=0;for(var l=0;l<220500;l++){var h=2*Math.random()-1;r=.99886*r+.0555179*h,a=.99332*a+.0750759*h,i=.969*i+.153852*h,o=.8665*o+.3104856*h,s=.55*s+.5329522*h,u=-.7616*u-.016898*h,n[l]=r+a+i+o+s+u+c+.5362*h,n[l]*=.11,c=.115926*h}}Hi.pink=(new Ua).fromArray(e)}return Hi.pink},get white(){if(!Hi.white){for(var e=[],t=0;t<2;t++){var n=new Float32Array(220500);e[t]=n;for(var r=0;r<220500;r++)n[r]=2*Math.random()-1}Hi.white=(new Ua).fromArray(e)}return Hi.white}},Xi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["volume"]))).name="UserMedia";var r=xa(n.getDefaults(),arguments,["volume"]);return e._volume=e.output=new Li({context:e.context,volume:r.volume}),e.volume=e._volume.volume,ja(_assertThisInitialized(e),"volume"),e.mute=r.mute,e}return _createClass2(n,[{key:"open",value:function(e){return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){var r,a,i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Qr(n.supported,"UserMedia is not supported"),"started"===this.state&&this.close(),t.next=3,n.enumerateDevices();case 3:return r=t.sent,ia(e)?this._device=r[e]:(this._device=r.find((function(t){return t.label===e||t.deviceId===e})),!this._device&&r.length>0&&(this._device=r[0]),Qr(ra(this._device),"No matching device "+e)),a={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}},this._device&&(a.audio.deviceId=this._device.deviceId),t.next=9,navigator.mediaDevices.getUserMedia(a);case 9:return i=t.sent,this._stream||(this._stream=i,vi(o=this.context.createMediaStreamSource(i),this.output),this._mediaStream=o),t.abrupt("return",this);case 12:case"end":return t.stop()}}),t,this)})))}},{key:"close",value:function(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach((function(e){e.stop()})),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.close(),this._volume.dispose(),this.volume.dispose(),this}},{key:"state",get:function(){return this._stream&&this._stream.active?"started":"stopped"}},{key:"deviceId",get:function(){return this._device?this._device.deviceId:void 0}},{key:"groupId",get:function(){return this._device?this._device.groupId:void 0}},{key:"label",get:function(){return this._device?this._device.label:void 0}},{key:"mute",get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{mute:!1,volume:0})}},{key:"enumerateDevices",value:function(){return pa(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return e.abrupt("return",e.sent.filter((function(e){return"audioinput"===e.kind})));case 3:case"end":return e.stop()}}),e)})))}},{key:"supported",get:function(){return ra(navigator.mediaDevices)&&ra(navigator.mediaDevices.getUserMedia)}}]),n}(pi);function Qi(e,t){return pa(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,a;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t/e.context.sampleRate,a=new Wa(1,r,e.context.sampleRate),new e.constructor(Object.assign(e.get(),{frequency:2/r,detune:0,context:a})).toDestination().start(0),n.next=4,a.render();case 4:return n.abrupt("return",n.sent.getChannelData(0));case 5:case"end":return n.stop()}}),n)})))}var Yi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","type"]))).name="ToneOscillatorNode",e._oscillator=e.context.createOscillator(),e._internalChannels=[e._oscillator];var r=xa(n.getDefaults(),arguments,["frequency","type"]);return vi(e._oscillator,e._gainNode),e.type=r.type,e.frequency=new di({context:e.context,param:e._oscillator.frequency,units:"frequency",value:r.frequency}),e.detune=new di({context:e.context,param:e._oscillator.detune,units:"cents",value:r.detune}),ja(_assertThisInitialized(e),["frequency","detune"]),e}return _createClass2(n,[{key:"start",value:function(e){var t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}},{key:"_stopSource",value:function(e){this._oscillator.stop(e)}},{key:"setPeriodicWave",value:function(e){return this._oscillator.setPeriodicWave(e),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}},{key:"type",get:function(){return this._oscillator.type},set:function(e){this._oscillator.type=e}}],[{key:"getDefaults",value:function(){return Object.assign(_i.getDefaults(),{detune:0,frequency:440,type:"sine"})}}]),n}(_i),Zi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","type"]))).name="Oscillator",e._oscillator=null;var r=xa(n.getDefaults(),arguments,["frequency","type"]);return e.frequency=new ki({context:e.context,units:"frequency",value:r.frequency}),ja(_assertThisInitialized(e),"frequency"),e.detune=new ki({context:e.context,units:"cents",value:r.detune}),ja(_assertThisInitialized(e),"detune"),e._partials=r.partials,e._partialCount=r.partialCount,e._type=r.type,r.partialCount&&"custom"!==r.type&&(e._type=e.baseType+r.partialCount.toString()),e.phase=r.phase,e}return _createClass2(n,[{key:"_start",value:function(e){var t=this,n=this.toSeconds(e),r=new Yi({context:this.context,onended:function(){return t.onstop(t)}});this._oscillator=r,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(n)}},{key:"_stop",value:function(e){var t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}},{key:"_restart",value:function(e){var t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}},{key:"syncFrequency",value:function(){return this.context.transport.syncSignal(this.frequency),this}},{key:"unsyncFrequency",value:function(){return this.context.transport.unsyncSignal(this.frequency),this}},{key:"_getCachedPeriodicWave",value:function(){var e=this;if("custom"===this._type)return n._periodicWaveCache.find((function(t){return t.phase===e._phase&&(n=t.partials).length===(r=e._partials).length&&n.every((function(e,t){return r[t]===e}));var n,r}));var t=n._periodicWaveCache.find((function(t){return t.type===e._type&&t.phase===e._phase}));return this._partialCount=t?t.partialCount:this._partialCount,t}},{key:"_getRealImaginary",value:function(e,t){var n=2048,r=new Float32Array(n),a=new Float32Array(n),i=1;if("custom"===e){if(i=this._partials.length+1,this._partialCount=this._partials.length,n=i,0===this._partials.length)return[r,a]}else{var o=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);o?(i=parseInt(o[2],10)+1,this._partialCount=parseInt(o[2],10),e=o[1],n=i=Math.max(i,2)):this._partialCount=0,this._partials=[]}for(var s=1;s<n;++s){var u=2/(s*Math.PI),c=void 0;switch(e){case"sine":c=s<=i?1:0,this._partials[s-1]=c;break;case"square":c=1&s?2*u:0,this._partials[s-1]=c;break;case"sawtooth":c=u*(1&s?1:-1),this._partials[s-1]=c;break;case"triangle":c=1&s?u*u*2*(s-1>>1&1?-1:1):0,this._partials[s-1]=c;break;case"custom":c=this._partials[s-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}0!==c?(r[s]=-c*Math.sin(t*s),a[s]=c*Math.cos(t*s)):(r[s]=0,a[s]=0)}return[r,a]}},{key:"_inverseFFT",value:function(e,t,n){for(var r=0,a=e.length,i=0;i<a;i++)r+=e[i]*Math.cos(i*n)+t[i]*Math.sin(i*n);return r}},{key:"getInitialValue",value:function(){for(var e=_slicedToArray2(this._getRealImaginary(this._type,0),2),t=e[0],n=e[1],r=0,a=2*Math.PI,i=0;i<32;i++)r=Math.max(this._inverseFFT(t,n,i/32*a),r);return Oa(-this._inverseFFT(t,n,this._phase)/r,-1,1)}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Qi(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}},{key:"type",get:function(){return this._type},set:function(e){this._type=e;var t=-1!==["sine","square","sawtooth","triangle"].indexOf(e);if(0===this._phase&&t)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=e);else{var r=this._getCachedPeriodicWave();if(ra(r)){var a=r.partials,i=r.wave;this._wave=i,this._partials=a,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{var o=_slicedToArray2(this._getRealImaginary(e,this._phase),2),s=o[0],u=o[1],c=this.context.createPeriodicWave(s,u);this._wave=c,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),n._periodicWaveCache.push({imag:u,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:s,type:this._type,wave:this._wave}),n._periodicWaveCache.length>100&&n._periodicWaveCache.shift()}}}},{key:"baseType",get:function(){return this._type.replace(this.partialCount.toString(),"")},set:function(e){this.type=this.partialCount&&"custom"!==this._type&&"custom"!==e?e+this.partialCount:e}},{key:"partialCount",get:function(){return this._partialCount},set:function(e){Yr(e,0);var t=this._type,n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(t=n[1]),"custom"!==this._type)this.type=0===e?t:t+e.toString();else{var r=new Float32Array(e);this._partials.forEach((function(e,t){return r[t]=e})),this._partials=Array.from(r),this.type=this._type}}},{key:"partials",get:function(){return this._partials.slice(0,this.partialCount)},set:function(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}},{key:"phase",get:function(){return this._phase*(180/Math.PI)},set:function(e){this._phase=e*Math.PI/180,this.type=this._type}}],[{key:"getDefaults",value:function(){return Object.assign(Ui.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}}]),n}(Ui);Zi._periodicWaveCache=[];var Ji=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.call(this,Object.assign(xa(n.getDefaults(),arguments,["context"])))}return _createClass2(n,[{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return wi(this,e,t,n),this}}]),n}(pi),$i=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments,["mapping","length"])))).name="WaveShaper",e._shaper=e.context.createWaveShaper(),e.input=e._shaper,e.output=e._shaper;var r=xa(n.getDefaults(),arguments,["mapping","length"]);return ua(r.mapping)||r.mapping instanceof Float32Array?e.curve=Float32Array.from(r.mapping):aa(r.mapping)&&e.setMap(r.mapping,r.length),e}return _createClass2(n,[{key:"setMap",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,n=new Float32Array(t),r=0,a=t;r<a;r++)n[r]=e(r/(a-1)*2-1,r);return this.curve=n,this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._shaper.disconnect(),this}},{key:"curve",get:function(){return this._shaper.curve},set:function(e){this._shaper.curve=e}},{key:"oversample",get:function(){return this._shaper.oversample},set:function(e){Qr(["none","2x","4x"].some((function(t){return t.includes(e)})),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}}],[{key:"getDefaults",value:function(){return Object.assign(ki.getDefaults(),{length:1024})}}]),n}(Ji),eo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="AudioToGain",e._norm=new $i({context:e.context,mapping:function(e){return(e+1)/2}}),e.input=e._norm,e.output=e._norm,e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._norm.dispose(),this}}]),n}(Ji),to=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments,["value"])))).name="Multiply",e.override=!1;var r=xa(n.getDefaults(),arguments,["value"]);return e._mult=e.input=e.output=new yi({context:e.context,minValue:r.minValue,maxValue:r.maxValue}),e.factor=e._param=e._mult.gain,e.factor.setValueAtTime(r.value,0),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._mult.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(ki.getDefaults(),{value:0})}}]),n}(ki),no=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","type","modulationType"]))).name="AMOscillator",e._modulationScale=new eo({context:e.context}),e._modulationNode=new yi({context:e.context});var r=xa(n.getDefaults(),arguments,["frequency","type","modulationType"]);return e._carrier=new Zi({context:e.context,detune:r.detune,frequency:r.frequency,onstop:function(){return e.onstop(_assertThisInitialized(e))},phase:r.phase,type:r.type}),e.frequency=e._carrier.frequency,e.detune=e._carrier.detune,e._modulator=new Zi({context:e.context,phase:r.phase,type:r.modulationType}),e.harmonicity=new to({context:e.context,units:"positive",value:r.harmonicity}),e.frequency.chain(e.harmonicity,e._modulator.frequency),e._modulator.chain(e._modulationScale,e._modulationNode.gain),e._carrier.chain(e._modulationNode,e.output),ja(_assertThisInitialized(e),["frequency","detune","harmonicity"]),e}return _createClass2(n,[{key:"_start",value:function(e){this._modulator.start(e),this._carrier.start(e)}},{key:"_stop",value:function(e){this._modulator.stop(e),this._carrier.stop(e)}},{key:"_restart",value:function(e){this._modulator.restart(e),this._carrier.restart(e)}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Qi(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}},{key:"type",get:function(){return this._carrier.type},set:function(e){this._carrier.type=e}},{key:"baseType",get:function(){return this._carrier.baseType},set:function(e){this._carrier.baseType=e}},{key:"partialCount",get:function(){return this._carrier.partialCount},set:function(e){this._carrier.partialCount=e}},{key:"modulationType",get:function(){return this._modulator.type},set:function(e){this._modulator.type=e}},{key:"phase",get:function(){return this._carrier.phase},set:function(e){this._carrier.phase=e,this._modulator.phase=e}},{key:"partials",get:function(){return this._carrier.partials},set:function(e){this._carrier.partials=e}}],[{key:"getDefaults",value:function(){return Object.assign(Zi.getDefaults(),{harmonicity:1,modulationType:"square"})}}]),n}(Ui),ro=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","type","modulationType"]))).name="FMOscillator",e._modulationNode=new yi({context:e.context,gain:0});var r=xa(n.getDefaults(),arguments,["frequency","type","modulationType"]);return e._carrier=new Zi({context:e.context,detune:r.detune,frequency:0,onstop:function(){return e.onstop(_assertThisInitialized(e))},phase:r.phase,type:r.type}),e.detune=e._carrier.detune,e.frequency=new ki({context:e.context,units:"frequency",value:r.frequency}),e._modulator=new Zi({context:e.context,phase:r.phase,type:r.modulationType}),e.harmonicity=new to({context:e.context,units:"positive",value:r.harmonicity}),e.modulationIndex=new to({context:e.context,units:"positive",value:r.modulationIndex}),e.frequency.connect(e._carrier.frequency),e.frequency.chain(e.harmonicity,e._modulator.frequency),e.frequency.chain(e.modulationIndex,e._modulationNode),e._modulator.connect(e._modulationNode.gain),e._modulationNode.connect(e._carrier.frequency),e._carrier.connect(e.output),e.detune.connect(e._modulator.detune),ja(_assertThisInitialized(e),["modulationIndex","frequency","detune","harmonicity"]),e}return _createClass2(n,[{key:"_start",value:function(e){this._modulator.start(e),this._carrier.start(e)}},{key:"_stop",value:function(e){this._modulator.stop(e),this._carrier.stop(e)}},{key:"_restart",value:function(e){return this._modulator.restart(e),this._carrier.restart(e),this}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Qi(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}},{key:"type",get:function(){return this._carrier.type},set:function(e){this._carrier.type=e}},{key:"baseType",get:function(){return this._carrier.baseType},set:function(e){this._carrier.baseType=e}},{key:"partialCount",get:function(){return this._carrier.partialCount},set:function(e){this._carrier.partialCount=e}},{key:"modulationType",get:function(){return this._modulator.type},set:function(e){this._modulator.type=e}},{key:"phase",get:function(){return this._carrier.phase},set:function(e){this._carrier.phase=e,this._modulator.phase=e}},{key:"partials",get:function(){return this._carrier.partials},set:function(e){this._carrier.partials=e}}],[{key:"getDefaults",value:function(){return Object.assign(Zi.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}}]),n}(Ui),ao=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","width"]))).name="PulseOscillator",e._widthGate=new yi({context:e.context,gain:0}),e._thresh=new $i({context:e.context,mapping:function(e){return e<=0?-1:1}});var r=xa(n.getDefaults(),arguments,["frequency","width"]);return e.width=new ki({context:e.context,units:"audioRange",value:r.width}),e._triangle=new Zi({context:e.context,detune:r.detune,frequency:r.frequency,onstop:function(){return e.onstop(_assertThisInitialized(e))},phase:r.phase,type:"triangle"}),e.frequency=e._triangle.frequency,e.detune=e._triangle.detune,e._triangle.chain(e._thresh,e.output),e.width.chain(e._widthGate,e._thresh),ja(_assertThisInitialized(e),["width","frequency","detune"]),e}return _createClass2(n,[{key:"_start",value:function(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}},{key:"_stop",value:function(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}},{key:"_restart",value:function(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Qi(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}},{key:"phase",get:function(){return this._triangle.phase},set:function(e){this._triangle.phase=e}},{key:"type",get:function(){return"pulse"}},{key:"baseType",get:function(){return"pulse"}},{key:"partials",get:function(){return[]}},{key:"partialCount",get:function(){return 0}},{key:"carrierType",set:function(e){this._triangle.type=e}}],[{key:"getDefaults",value:function(){return Object.assign(Ui.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}}]),n}(Ui),io=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","type","spread"]))).name="FatOscillator",e._oscillators=[];var r=xa(n.getDefaults(),arguments,["frequency","type","spread"]);return e.frequency=new ki({context:e.context,units:"frequency",value:r.frequency}),e.detune=new ki({context:e.context,units:"cents",value:r.detune}),e._spread=r.spread,e._type=r.type,e._phase=r.phase,e._partials=r.partials,e._partialCount=r.partialCount,e.count=r.count,ja(_assertThisInitialized(e),["frequency","detune"]),e}return _createClass2(n,[{key:"_start",value:function(e){e=this.toSeconds(e),this._forEach((function(t){return t.start(e)}))}},{key:"_stop",value:function(e){e=this.toSeconds(e),this._forEach((function(t){return t.stop(e)}))}},{key:"_restart",value:function(e){this._forEach((function(t){return t.restart(e)}))}},{key:"_forEach",value:function(e){for(var t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Qi(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.frequency.dispose(),this.detune.dispose(),this._forEach((function(e){return e.dispose()})),this}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._forEach((function(t){return t.type=e}))}},{key:"spread",get:function(){return this._spread},set:function(e){if(this._spread=e,this._oscillators.length>1){var t=-e/2,n=e/(this._oscillators.length-1);this._forEach((function(e,r){return e.detune.value=t+n*r}))}}},{key:"count",get:function(){return this._oscillators.length},set:function(e){var t=this;if(Yr(e,1),this._oscillators.length!==e){this._forEach((function(e){return e.dispose()})),this._oscillators=[];for(var n=0;n<e;n++){var r=new Zi({context:this.context,volume:-6-1.1*e,type:this._type,phase:this._phase+n/e*360,partialCount:this._partialCount,onstop:0===n?function(){return t.onstop(t)}:qa});"custom"===this.type&&(r.partials=this._partials),this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.detune.overridden=!1,r.connect(this.output),this._oscillators[n]=r}this.spread=this._spread,"started"===this.state&&this._forEach((function(e){return e.start()}))}}},{key:"phase",get:function(){return this._phase},set:function(e){var t=this;this._phase=e,this._forEach((function(e,n){return e.phase=t._phase+n/t.count*360}))}},{key:"baseType",get:function(){return this._oscillators[0].baseType},set:function(e){this._forEach((function(t){return t.baseType=e})),this._type=this._oscillators[0].type}},{key:"partials",get:function(){return this._oscillators[0].partials},set:function(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach((function(t){return t.partials=e})))}},{key:"partialCount",get:function(){return this._oscillators[0].partialCount},set:function(e){this._partialCount=e,this._forEach((function(t){return t.partialCount=e})),this._type=this._oscillators[0].type}}],[{key:"getDefaults",value:function(){return Object.assign(Zi.getDefaults(),{count:3,spread:20,type:"sawtooth"})}}]),n}(Ui),oo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","modulationFrequency"]))).name="PWMOscillator",e.sourceType="pwm",e._scale=new to({context:e.context,value:2});var r=xa(n.getDefaults(),arguments,["frequency","modulationFrequency"]);return e._pulse=new ao({context:e.context,frequency:r.modulationFrequency}),e._pulse.carrierType="sine",e.modulationFrequency=e._pulse.frequency,e._modulator=new Zi({context:e.context,detune:r.detune,frequency:r.frequency,onstop:function(){return e.onstop(_assertThisInitialized(e))},phase:r.phase}),e.frequency=e._modulator.frequency,e.detune=e._modulator.detune,e._modulator.chain(e._scale,e._pulse.width),e._pulse.connect(e.output),ja(_assertThisInitialized(e),["modulationFrequency","frequency","detune"]),e}return _createClass2(n,[{key:"_start",value:function(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}},{key:"_stop",value:function(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}},{key:"_restart",value:function(e){this._modulator.restart(e),this._pulse.restart(e)}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Qi(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}},{key:"type",get:function(){return"pwm"}},{key:"baseType",get:function(){return"pwm"}},{key:"partials",get:function(){return[]}},{key:"partialCount",get:function(){return 0}},{key:"phase",get:function(){return this._modulator.phase},set:function(e){this._modulator.phase=e}}],[{key:"getDefaults",value:function(){return Object.assign(Ui.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}}]),n}(Ui),so={am:no,fat:io,fm:ro,oscillator:Zi,pulse:ao,pwm:oo},uo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","type"]))).name="OmniOscillator";var r=xa(n.getDefaults(),arguments,["frequency","type"]);return e.frequency=new ki({context:e.context,units:"frequency",value:r.frequency}),e.detune=new ki({context:e.context,units:"cents",value:r.detune}),ja(_assertThisInitialized(e),["frequency","detune"]),e.set(r),e}return _createClass2(n,[{key:"_start",value:function(e){this._oscillator.start(e)}},{key:"_stop",value:function(e){this._oscillator.stop(e)}},{key:"_restart",value:function(e){return this._oscillator.restart(e),this}},{key:"set",value:function(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),_get(_getPrototypeOf(n.prototype),"set",this).call(this,e),this}},{key:"_createNewOscillator",value:function(e){var t=this;if(e!==this._sourceType){this._sourceType=e;var n=so[e],r=this.now();if(this._oscillator){var a=this._oscillator;a.stop(r),this.context.setTimeout((function(){return a.dispose()}),this.blockTime)}this._oscillator=new n({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=function(){return t.onstop(t)},"started"===this.state&&this._oscillator.start(r)}}},{key:"_getOscType",value:function(e,t){return e instanceof so[t]}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Qi(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}},{key:"type",get:function(){var e=this,t="";return["am","fm","fat"].some((function(t){return e._sourceType===t}))&&(t=this._sourceType),t+this._oscillator.type},set:function(e){"fm"===e.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"am"===e.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"fat"===e.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):"pwm"===e?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===e?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}},{key:"partials",get:function(){return this._oscillator.partials},set:function(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=e)}},{key:"partialCount",get:function(){return this._oscillator.partialCount},set:function(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=e)}},{key:"phase",get:function(){return this._oscillator.phase},set:function(e){this._oscillator.phase=e}},{key:"sourceType",get:function(){return this._sourceType},set:function(e){var t="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(t=this._oscillator.type),"fm"===e?this.type="fm"+t:"am"===e?this.type="am"+t:"fat"===e?this.type="fat"+t:"oscillator"===e?this.type=t:"pulse"===e?this.type="pulse":"pwm"===e&&(this.type="pwm")}},{key:"baseType",get:function(){return this._oscillator.baseType},set:function(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===e||"pwm"===e||(this._oscillator.baseType=e)}},{key:"width",get:function(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}},{key:"count",get:function(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0},set:function(e){this._getOscType(this._oscillator,"fat")&&ia(e)&&(this._oscillator.count=e)}},{key:"spread",get:function(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0},set:function(e){this._getOscType(this._oscillator,"fat")&&ia(e)&&(this._oscillator.spread=e)}},{key:"modulationType",get:function(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0},set:function(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&ca(e)&&(this._oscillator.modulationType=e)}},{key:"modulationIndex",get:function(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}},{key:"harmonicity",get:function(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}},{key:"modulationFrequency",get:function(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}}],[{key:"getDefaults",value:function(){return Object.assign(Zi.getDefaults(),ro.getDefaults(),no.getDefaults(),io.getDefaults(),ao.getDefaults(),oo.getDefaults())}}]),n}(Ui),co=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments,["value"])))).override=!1,e.name="Add",e._sum=new yi({context:e.context}),e.input=e._sum,e.output=e._sum,e.addend=e._param,mi(e._constantSource,e._sum),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._sum.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(ki.getDefaults(),{value:0})}}]),n}(ki),lo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments,["min","max"])))).name="Scale";var r=xa(n.getDefaults(),arguments,["min","max"]);return e._mult=e.input=new to({context:e.context,value:r.max-r.min}),e._add=e.output=new co({context:e.context,value:r.min}),e._min=r.min,e._max=r.max,e.input.connect(e.output),e}return _createClass2(n,[{key:"_setRange",value:function(){this._add.value=this._min,this._mult.value=this._max-this._min}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._add.dispose(),this._mult.dispose(),this}},{key:"min",get:function(){return this._min},set:function(e){this._min=e,this._setRange()}},{key:"max",get:function(){return this._max},set:function(e){this._max=e,this._setRange()}}],[{key:"getDefaults",value:function(){return Object.assign(Ji.getDefaults(),{max:1,min:0})}}]),n}(Ji),ho=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments)))).name="Zero",e._gain=new yi({context:e.context}),e.output=e._gain,e.input=void 0,vi(e.context.getConstant(0),e._gain),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),gi(this.context.getConstant(0),this._gain),this}}]),n}(Ji),fo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","min","max"]))).name="LFO",e._stoppedValue=0,e._units="number",e.convert=!0,e._fromType=di.prototype._fromType,e._toType=di.prototype._toType,e._is=di.prototype._is,e._clampValue=di.prototype._clampValue;var r=xa(n.getDefaults(),arguments,["frequency","min","max"]);return e._oscillator=new Zi({context:e.context,frequency:r.frequency,type:r.type}),e.frequency=e._oscillator.frequency,e._amplitudeGain=new yi({context:e.context,gain:r.amplitude,units:"normalRange"}),e.amplitude=e._amplitudeGain.gain,e._stoppedSignal=new ki({context:e.context,units:"audioRange",value:0}),e._zeros=new ho({context:e.context}),e._a2g=new eo({context:e.context}),e._scaler=e.output=new lo({context:e.context,max:r.max,min:r.min}),e.units=r.units,e.min=r.min,e.max=r.max,e._oscillator.chain(e._a2g,e._amplitudeGain,e._scaler),e._zeros.connect(e._a2g),e._stoppedSignal.connect(e._a2g),ja(_assertThisInitialized(e),["amplitude","frequency"]),e.phase=r.phase,e}return _createClass2(n,[{key:"start",value:function(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}},{key:"stop",value:function(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}},{key:"sync",value:function(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}},{key:"unsync",value:function(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}},{key:"connect",value:function(e,t,n){return(e instanceof di||e instanceof ki)&&(this.convert=e.convert,this.units=e.units),wi(this,e,t,n),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}},{key:"min",get:function(){return this._toType(this._scaler.min)},set:function(e){e=this._fromType(e),this._scaler.min=e}},{key:"max",get:function(){return this._toType(this._scaler.max)},set:function(e){e=this._fromType(e),this._scaler.max=e}},{key:"type",get:function(){return this._oscillator.type},set:function(e){this._oscillator.type=e,this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}},{key:"phase",get:function(){return this._oscillator.phase},set:function(e){this._oscillator.phase=e,this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}},{key:"units",get:function(){return this._units},set:function(e){var t=this.min,n=this.max;this._units=e,this.min=t,this.max=n}},{key:"state",get:function(){return this._oscillator.state}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,phase:0,type:"sine",units:"number"})}}]),n}(pi);function po(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=new WeakMap;return function(r,a){Reflect.defineProperty(r,a,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(r){Yr(r,e,t),n.set(this,r)}})}}function mo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=new WeakMap;return function(r,a){Reflect.defineProperty(r,a,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(r){Yr(this.toSeconds(r),e,t),n.set(this,r)}})}}var vo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["url","onload"]))).name="Player",e._activeSources=new Set;var r=xa(n.getDefaults(),arguments,["url","onload"]);return e._buffer=new Ua({onload:e._onload.bind(_assertThisInitialized(e),r.onload),onerror:r.onerror,reverse:r.reverse,url:r.url}),e.autostart=r.autostart,e._loop=r.loop,e._loopStart=r.loopStart,e._loopEnd=r.loopEnd,e._playbackRate=r.playbackRate,e.fadeIn=r.fadeIn,e.fadeOut=r.fadeOut,e}return _createClass2(n,[{key:"load",value:function(e){return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._buffer.load(e);case 2:return this._onload(),t.abrupt("return",this);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"_onload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qa;e(),this.autostart&&this.start()}},{key:"_onSourceEnd",value:function(e){this.onstop(this),this._activeSources.delete(e),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}},{key:"start",value:function(e,t,r){return _get(_getPrototypeOf(n.prototype),"start",this).call(this,e,t,r),this}},{key:"_start",value:function(e,t,n){t=Ca(t,this._loop?this._loopStart:0);var r=this.toSeconds(t);this._synced&&(r*=this._playbackRate);var a=n;n=Ca(n,Math.max(this._buffer.duration-r,0));var i=this.toSeconds(n);i/=this._playbackRate,e=this.toSeconds(e);var o=new Wi({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(e+i),this._state.setStateAtTime("stopped",e+i,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&na(a)?o.start(e,r):o.start(e,r,i-this.toSeconds(this.fadeOut))}},{key:"_stop",value:function(e){var t=this.toSeconds(e);this._activeSources.forEach((function(e){return e.stop(t)}))}},{key:"restart",value:function(e,t,r){return _get(_getPrototypeOf(n.prototype),"restart",this).call(this,e,t,r),this}},{key:"_restart",value:function(e,t,n){this._stop(e),this._start(e,t,n)}},{key:"seek",value:function(e,t){var n=this.toSeconds(t);if("started"===this._state.getValueAtTime(n)){var r=this.toSeconds(e);this._stop(n),this._start(n,r)}return this}},{key:"setLoopPoints",value:function(e,t){return this.loopStart=e,this.loopEnd=t,this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._activeSources.forEach((function(e){return e.dispose()})),this._activeSources.clear(),this._buffer.dispose(),this}},{key:"loopStart",get:function(){return this._loopStart},set:function(e){this._loopStart=e,this.buffer.loaded&&Yr(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((function(t){t.loopStart=e}))}},{key:"loopEnd",get:function(){return this._loopEnd},set:function(e){this._loopEnd=e,this.buffer.loaded&&Yr(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((function(t){t.loopEnd=e}))}},{key:"buffer",get:function(){return this._buffer},set:function(e){this._buffer.set(e)}},{key:"loop",get:function(){return this._loop},set:function(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach((function(t){t.loop=e})),e)){var t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){this._playbackRate=e;var t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((function(e){return e.cancelStop()}))),this._activeSources.forEach((function(n){n.playbackRate.setValueAtTime(e,t)}))}},{key:"reverse",get:function(){return this._buffer.reverse},set:function(e){this._buffer.reverse=e}},{key:"loaded",get:function(){return this._buffer.loaded}}],[{key:"getDefaults",value:function(){return Object.assign(Ui.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:qa,onerror:qa,playbackRate:1,reverse:!1})}}]),n}(Ui);da([mo(0)],vo.prototype,"fadeIn",void 0),da([mo(0)],vo.prototype,"fadeOut",void 0);var go=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["urls","onload"],"urls"))).name="Players",e.input=void 0,e._players=new Map;var r=xa(n.getDefaults(),arguments,["urls","onload"],"urls");return e._volume=e.output=new Li({context:e.context,volume:r.volume}),e.volume=e._volume.volume,ja(_assertThisInitialized(e),"volume"),e._buffers=new Ii({urls:r.urls,onload:r.onload,baseUrl:r.baseUrl,onerror:r.onerror}),e.mute=r.mute,e._fadeIn=r.fadeIn,e._fadeOut=r.fadeOut,e}return _createClass2(n,[{key:"has",value:function(e){return this._buffers.has(e)}},{key:"player",value:function(e){if(Qr(this.has(e),"No Player with the name ".concat(e," exists on this object")),!this._players.has(e)){var t=new vo({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(e)}).connect(this.output);this._players.set(e,t)}return this._players.get(e)}},{key:"add",value:function(e,t,n){return Qr(!this._buffers.has(e),"A buffer with that name already exists on this object"),this._buffers.add(e,t,n),this}},{key:"stopAll",value:function(e){return this._players.forEach((function(t){return t.stop(e)})),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._volume.dispose(),this.volume.dispose(),this._players.forEach((function(e){return e.dispose()})),this._buffers.dispose(),this}},{key:"mute",get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}},{key:"fadeIn",get:function(){return this._fadeIn},set:function(e){this._fadeIn=e,this._players.forEach((function(t){t.fadeIn=e}))}},{key:"fadeOut",get:function(){return this._fadeOut},set:function(e){this._fadeOut=e,this._players.forEach((function(t){t.fadeOut=e}))}},{key:"state",get:function(){return Array.from(this._players).some((function(e){var t=_slicedToArray2(e,2);t[0];return"started"===t[1].state}))?"started":"stopped"}},{key:"loaded",get:function(){return this._buffers.loaded}}],[{key:"getDefaults",value:function(){return Object.assign(Ui.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:qa,onerror:qa,urls:{},volume:0})}}]),n}(pi),yo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["url","onload"]))).name="GrainPlayer",e._loopStart=0,e._loopEnd=0,e._activeSources=[];var r=xa(n.getDefaults(),arguments,["url","onload"]);return e.buffer=new Ua({onload:r.onload,onerror:r.onerror,reverse:r.reverse,url:r.url}),e._clock=new Ti({context:e.context,callback:e._tick.bind(_assertThisInitialized(e)),frequency:1/r.grainSize}),e._playbackRate=r.playbackRate,e._grainSize=r.grainSize,e._overlap=r.overlap,e.detune=r.detune,e.overlap=r.overlap,e.loop=r.loop,e.playbackRate=r.playbackRate,e.grainSize=r.grainSize,e.loopStart=r.loopStart,e.loopEnd=r.loopEnd,e.reverse=r.reverse,e._clock.on("stop",e._onstop.bind(_assertThisInitialized(e))),e}return _createClass2(n,[{key:"_start",value:function(e,t,n){t=Ca(t,0),t=this.toSeconds(t),e=this.toSeconds(e);var r=1/this._clock.frequency.getValueAtTime(e);this._clock.start(e,t/r),n&&this.stop(e+this.toSeconds(n))}},{key:"restart",value:function(e,t,r){return _get(_getPrototypeOf(n.prototype),"restart",this).call(this,e,t,r),this}},{key:"_restart",value:function(e,t,n){this._stop(e),this._start(e,t,n)}},{key:"_stop",value:function(e){this._clock.stop(e)}},{key:"_onstop",value:function(e){this._activeSources.forEach((function(t){t.fadeOut=0,t.stop(e)})),this.onstop(this)}},{key:"_tick",value:function(e){var t=this,n=this._clock.getTicksAtTime(e),r=n*this._grainSize;if(this.log("offset",r),!this.loop&&r>this.buffer.duration)this.stop(e);else{var a=new Wi({context:this.context,url:this.buffer,fadeIn:r<this._overlap?0:this._overlap,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:Ja(this.detune/100)}).connect(this.output);a.start(e,this._grainSize*n),a.stop(e+this._grainSize/this.playbackRate),this._activeSources.push(a),a.onended=function(){var e=t._activeSources.indexOf(a);-1!==e&&t._activeSources.splice(e,1)}}}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach((function(e){return e.dispose()})),this}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){Yr(e,.001),this._playbackRate=e,this.grainSize=this._grainSize}},{key:"loopStart",get:function(){return this._loopStart},set:function(e){this.buffer.loaded&&Yr(this.toSeconds(e),0,this.buffer.duration),this._loopStart=this.toSeconds(e)}},{key:"loopEnd",get:function(){return this._loopEnd},set:function(e){this.buffer.loaded&&Yr(this.toSeconds(e),0,this.buffer.duration),this._loopEnd=this.toSeconds(e)}},{key:"reverse",get:function(){return this.buffer.reverse},set:function(e){this.buffer.reverse=e}},{key:"grainSize",get:function(){return this._grainSize},set:function(e){this._grainSize=this.toSeconds(e),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}},{key:"overlap",get:function(){return this._overlap},set:function(e){var t=this.toSeconds(e);Yr(t,0),this._overlap=t}},{key:"loaded",get:function(){return this.buffer.loaded}}],[{key:"getDefaults",value:function(){return Object.assign(Ui.getDefaults(),{onload:qa,onerror:qa,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}}]),n}(Ui),_o=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="Abs",e._abs=new $i({context:e.context,mapping:function(e){return Math.abs(e)<.001?0:Math.abs(e)}}),e.input=e._abs,e.output=e._abs,e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._abs.dispose(),this}}]),n}(Ji),bo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="GainToAudio",e._norm=new $i({context:e.context,mapping:function(e){return 2*Math.abs(e)-1}}),e.input=e._norm,e.output=e._norm,e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._norm.dispose(),this}}]),n}(Ji),ko=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="Negate",e._multiply=new to({context:e.context,value:-1}),e.input=e._multiply,e.output=e._multiply,e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._multiply.dispose(),this}}]),n}(Ji),wo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments,["value"])))).override=!1,e.name="Subtract",e._sum=new yi({context:e.context}),e.input=e._sum,e.output=e._sum,e._neg=new ko({context:e.context}),e.subtrahend=e._param,mi(e._constantSource,e._neg,e._sum),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._neg.dispose(),this._sum.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(ki.getDefaults(),{value:0})}}]),n}(ki),xo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments)))).name="GreaterThanZero",e._thresh=e.output=new $i({context:e.context,length:127,mapping:function(e){return e<=0?0:1}}),e._scale=e.input=new to({context:e.context,value:1e4}),e._scale.connect(e._thresh),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._scale.dispose(),this._thresh.dispose(),this}}]),n}(Ji),Co=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments,["value"])))).name="GreaterThan",e.override=!1;var r=xa(n.getDefaults(),arguments,["value"]);return e._subtract=e.input=new wo({context:e.context,value:r.value}),e._gtz=e.output=new xo({context:e.context}),e.comparator=e._param=e._subtract.subtrahend,ja(_assertThisInitialized(e),"comparator"),e._subtract.connect(e._gtz),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(ki.getDefaults(),{value:0})}}]),n}(ki),So=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments,["value"])))).name="Pow";var r=xa(n.getDefaults(),arguments,["value"]);return e._exponentScaler=e.input=e.output=new $i({context:e.context,mapping:e._expFunc(r.value),length:8192}),e._exponent=r.value,e}return _createClass2(n,[{key:"_expFunc",value:function(e){return function(t){return Math.pow(Math.abs(t),e)}}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._exponentScaler.dispose(),this}},{key:"value",get:function(){return this._exponent},set:function(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}}],[{key:"getDefaults",value:function(){return Object.assign(Ji.getDefaults(),{value:1})}}]),n}(Ji),To=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments,["min","max","exponent"])))).name="ScaleExp";var r=xa(n.getDefaults(),arguments,["min","max","exponent"]);return e.input=e._exp=new So({context:e.context,value:r.exponent}),e._exp.connect(e._mult),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._exp.dispose(),this}},{key:"exponent",get:function(){return this._exp.value},set:function(e){this._exp.value=e}}],[{key:"getDefaults",value:function(){return Object.assign(lo.getDefaults(),{exponent:1})}}]),n}(lo),Ao=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(ki.getDefaults(),arguments,["value","units"]))).name="SyncedSignal",e.override=!1;var r=xa(ki.getDefaults(),arguments,["value","units"]);return e._lastVal=r.value,e._synced=e.context.transport.scheduleRepeat(e._onTick.bind(_assertThisInitialized(e)),"1i"),e._syncedCallback=e._anchorValue.bind(_assertThisInitialized(e)),e.context.transport.on("start",e._syncedCallback),e.context.transport.on("pause",e._syncedCallback),e.context.transport.on("stop",e._syncedCallback),e._constantSource.disconnect(),e._constantSource.stop(0),e._constantSource=e.output=new bi({context:e.context,offset:r.value,units:r.units}).start(0),e.setValueAtTime(r.value,0),e}return _createClass2(n,[{key:"_onTick",value:function(e){var t=_get(_getPrototypeOf(n.prototype),"getValueAtTime",this).call(this,this.context.transport.seconds);this._lastVal!==t&&(this._lastVal=t,this._constantSource.offset.setValueAtTime(t,e))}},{key:"_anchorValue",value:function(e){var t=_get(_getPrototypeOf(n.prototype),"getValueAtTime",this).call(this,this.context.transport.seconds);this._lastVal=t,this._constantSource.offset.cancelAndHoldAtTime(e),this._constantSource.offset.setValueAtTime(t,e)}},{key:"getValueAtTime",value:function(e){var t=new ci(this.context,e).toSeconds();return _get(_getPrototypeOf(n.prototype),"getValueAtTime",this).call(this,t)}},{key:"setValueAtTime",value:function(e,t){var r=new ci(this.context,t).toSeconds();return _get(_getPrototypeOf(n.prototype),"setValueAtTime",this).call(this,e,r),this}},{key:"linearRampToValueAtTime",value:function(e,t){var r=new ci(this.context,t).toSeconds();return _get(_getPrototypeOf(n.prototype),"linearRampToValueAtTime",this).call(this,e,r),this}},{key:"exponentialRampToValueAtTime",value:function(e,t){var r=new ci(this.context,t).toSeconds();return _get(_getPrototypeOf(n.prototype),"exponentialRampToValueAtTime",this).call(this,e,r),this}},{key:"setTargetAtTime",value:function(e,t,r){var a=new ci(this.context,t).toSeconds();return _get(_getPrototypeOf(n.prototype),"setTargetAtTime",this).call(this,e,a,r),this}},{key:"cancelScheduledValues",value:function(e){var t=new ci(this.context,e).toSeconds();return _get(_getPrototypeOf(n.prototype),"cancelScheduledValues",this).call(this,t),this}},{key:"setValueCurveAtTime",value:function(e,t,r,a){var i=new ci(this.context,t).toSeconds();return r=this.toSeconds(r),_get(_getPrototypeOf(n.prototype),"setValueCurveAtTime",this).call(this,e,i,r,a),this}},{key:"cancelAndHoldAtTime",value:function(e){var t=new ci(this.context,e).toSeconds();return _get(_getPrototypeOf(n.prototype),"cancelAndHoldAtTime",this).call(this,t),this}},{key:"setRampPoint",value:function(e){var t=new ci(this.context,e).toSeconds();return _get(_getPrototypeOf(n.prototype),"setRampPoint",this).call(this,t),this}},{key:"exponentialRampTo",value:function(e,t,r){var a=new ci(this.context,r).toSeconds();return _get(_getPrototypeOf(n.prototype),"exponentialRampTo",this).call(this,e,t,a),this}},{key:"linearRampTo",value:function(e,t,r){var a=new ci(this.context,r).toSeconds();return _get(_getPrototypeOf(n.prototype),"linearRampTo",this).call(this,e,t,a),this}},{key:"targetRampTo",value:function(e,t,r){var a=new ci(this.context,r).toSeconds();return _get(_getPrototypeOf(n.prototype),"targetRampTo",this).call(this,e,t,a),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}]),n}(ki),Eo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["attack","decay","sustain","release"]))).name="Envelope",e._sig=new ki({context:e.context,value:0}),e.output=e._sig,e.input=void 0;var r=xa(n.getDefaults(),arguments,["attack","decay","sustain","release"]);return e.attack=r.attack,e.decay=r.decay,e.sustain=r.sustain,e.release=r.release,e.attackCurve=r.attackCurve,e.releaseCurve=r.releaseCurve,e.decayCurve=r.decayCurve,e}return _createClass2(n,[{key:"_getCurve",value:function(e,t){if(ca(e))return e;var n;for(n in Io)if(Io[n][t]===e)return n;return e}},{key:"_setCurve",value:function(e,t,n){if(ca(n)&&Reflect.has(Io,n)){var r=Io[n];oa(r)?"_decayCurve"!==e&&(this[e]=r[t]):this[e]=r}else{if(!ua(n)||"_decayCurve"===e)throw new Error("Envelope: invalid curve: "+n);this[e]=n}}},{key:"triggerAttack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.log("triggerAttack",e,t),e=this.toSeconds(e);var n=this.toSeconds(this.attack),r=this.toSeconds(this.decay),a=this.getValueAtTime(e);if(a>0&&(n=(1-a)/(1/n)),n<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if("linear"===this._attackCurve)this._sig.linearRampTo(t,n,e);else if("exponential"===this._attackCurve)this._sig.targetRampTo(t,n,e);else{this._sig.cancelAndHoldAtTime(e);for(var i=this._attackCurve,o=1;o<i.length;o++)if(i[o-1]<=a&&a<=i[o]){(i=this._attackCurve.slice(o))[0]=a;break}this._sig.setValueCurveAtTime(i,e,n,t)}if(r&&this.sustain<1){var s=t*this.sustain,u=e+n;this.log("decay",u),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(s,r+u):this._sig.exponentialApproachValueAtTime(s,u,r)}return this}},{key:"triggerRelease",value:function(e){this.log("triggerRelease",e),e=this.toSeconds(e);var t=this.getValueAtTime(e);if(t>0){var n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,e):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,e):(Qr(ua(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}},{key:"getValueAtTime",value:function(e){return this._sig.getValueAtTime(e)}},{key:"triggerAttackRelease",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}},{key:"cancel",value:function(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}},{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return wi(this,e,t,n),this}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,i,o,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e/this.context.sampleRate,r=new Wa(1,n,this.context.sampleRate),a=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=a+this.toSeconds(this.release),s=i+(o=.1*i),(u=new this.constructor(Object.assign(this.get(),{attack:n*this.toSeconds(this.attack)/s,decay:n*this.toSeconds(this.decay)/s,release:n*this.toSeconds(this.release)/s,context:r})))._sig.toDestination(),u.triggerAttackRelease(n*(a+o)/s,0),t.next=5,r.render();case 5:return t.abrupt("return",t.sent.getChannelData(0));case 6:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._sig.dispose(),this}},{key:"value",get:function(){return this.getValueAtTime(this.now())}},{key:"attackCurve",get:function(){return this._getCurve(this._attackCurve,"In")},set:function(e){this._setCurve("_attackCurve","In",e)}},{key:"releaseCurve",get:function(){return this._getCurve(this._releaseCurve,"Out")},set:function(e){this._setCurve("_releaseCurve","Out",e)}},{key:"decayCurve",get:function(){return this._decayCurve},set:function(e){Qr(["linear","exponential"].some((function(t){return t===e})),"Invalid envelope curve: "+e),this._decayCurve=e}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}}]),n}(pi);da([mo(0)],Eo.prototype,"attack",void 0),da([mo(0)],Eo.prototype,"decay",void 0),da([po(0,1)],Eo.prototype,"sustain",void 0),da([mo(0)],Eo.prototype,"release",void 0);var Io=function(){var e,t,n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/127*(Math.PI/2));var r=[];for(e=0;e<127;e++){t=e/127;var a=Math.sin(t*(2*Math.PI)*6.4-Math.PI/2)+1;r[e]=a/10+.83*t}r[127]=1;var i=[];for(e=0;e<128;e++)i[e]=Math.ceil(e/127*5)/5;var o=[];for(e=0;e<128;e++)t=e/127,o[e]=.5*(1-Math.cos(Math.PI*t));var s,u=[];for(e=0;e<128;e++){t=e/127;var c=4*Math.pow(t,3)+.2,l=Math.cos(c*Math.PI*2*t);u[e]=Math.abs(l*(1-t))}function h(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=1-e[n];return t}return{bounce:{In:h(u),Out:u},cosine:{In:n,Out:(s=n,s.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:r,Out:h(r)},sine:{In:o,Out:h(o)},step:{In:i,Out:h(i)}}}(),Ro=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments)))._scheduledEvents=[],e._synced=!1,e._original_triggerAttack=e.triggerAttack,e._original_triggerRelease=e.triggerRelease;var r=xa(n.getDefaults(),arguments);return e._volume=e.output=new Li({context:e.context,volume:r.volume}),e.volume=e._volume.volume,ja(_assertThisInitialized(e),"volume"),e}return _createClass2(n,[{key:"sync",value:function(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}},{key:"_syncState",value:function(){var e=!1;return this._synced||(this._synced=!0,e=!0),e}},{key:"_syncMethod",value:function(e,t){var n=this,r=this["_original_"+e]=this[e];this[e]=function(){for(var e=arguments.length,a=new Array(e),i=0;i<e;i++)a[i]=arguments[i];var o=n.context.transport.schedule((function(e){a[t]=e,r.apply(n,a)}),a[t]);n._scheduledEvents.push(o)}}},{key:"unsync",value:function(){var e=this;return this._scheduledEvents.forEach((function(t){return e.context.transport.clear(t)})),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}},{key:"triggerAttackRelease",value:function(e,t,n,r){var a=this.toSeconds(n),i=this.toSeconds(t);return this.triggerAttack(e,a,r),this.triggerRelease(a+i),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{volume:0})}}]),n}(pi),Oo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),e=t.call(this,xa(n.getDefaults(),arguments));var r=xa(n.getDefaults(),arguments);return e.portamento=r.portamento,e.onsilence=r.onsilence,e}return _createClass2(n,[{key:"triggerAttack",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.log("triggerAttack",e,t,n);var r=this.toSeconds(t);return this._triggerEnvelopeAttack(r,n),this.setNote(e,r),this}},{key:"triggerRelease",value:function(e){this.log("triggerRelease",e);var t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}},{key:"setNote",value:function(e,t){var n=this.toSeconds(t),r=e instanceof ii?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){var a=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(r,a,n)}else this.frequency.setValueAtTime(r,n);return this}}],[{key:"getDefaults",value:function(){return Object.assign(Ro.getDefaults(),{detune:0,onsilence:qa,portamento:0})}}]),n}(Ro);da([mo(0)],Oo.prototype,"portamento",void 0);var No=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["attack","decay","sustain","release"]))).name="AmplitudeEnvelope",e._gainNode=new yi({context:e.context,gain:0}),e.output=e._gainNode,e.input=e._gainNode,e._sig.connect(e._gainNode.gain),e.output=e._gainNode,e.input=e._gainNode,e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._gainNode.dispose(),this}}]),n}(Eo),Do=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="Synth";var r=xa(n.getDefaults(),arguments);return e.oscillator=new uo(Object.assign({context:e.context,detune:r.detune,onstop:function(){return e.onsilence(_assertThisInitialized(e))}},r.oscillator)),e.frequency=e.oscillator.frequency,e.detune=e.oscillator.detune,e.envelope=new No(Object.assign({context:e.context},r.envelope)),e.oscillator.chain(e.envelope,e.output),ja(_assertThisInitialized(e),["oscillator","frequency","detune","envelope"]),e}return _createClass2(n,[{key:"_triggerEnvelopeAttack",value:function(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),0===this.envelope.sustain){var n=this.toSeconds(this.envelope.attack),r=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+r)}}},{key:"_triggerEnvelopeRelease",value:function(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}},{key:"getLevelAtTime",value:function(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.oscillator.dispose(),this.envelope.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Oo.getDefaults(),{envelope:Object.assign(Sa(Eo.getDefaults(),Object.keys(pi.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Sa(uo.getDefaults(),[].concat(_toConsumableArray(Object.keys(Ui.getDefaults())),["frequency","detune"])),{type:"triangle"})})}}]),n}(Oo),Po=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="ModulationSynth";var r=xa(n.getDefaults(),arguments);return e._carrier=new Do({context:e.context,oscillator:r.oscillator,envelope:r.envelope,onsilence:function(){return e.onsilence(_assertThisInitialized(e))},volume:-10}),e._modulator=new Do({context:e.context,oscillator:r.modulation,envelope:r.modulationEnvelope,volume:-10}),e.oscillator=e._carrier.oscillator,e.envelope=e._carrier.envelope,e.modulation=e._modulator.oscillator,e.modulationEnvelope=e._modulator.envelope,e.frequency=new ki({context:e.context,units:"frequency"}),e.detune=new ki({context:e.context,value:r.detune,units:"cents"}),e.harmonicity=new to({context:e.context,value:r.harmonicity,minValue:0}),e._modulationNode=new yi({context:e.context,gain:0}),ja(_assertThisInitialized(e),["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"]),e}return _createClass2(n,[{key:"_triggerEnvelopeAttack",value:function(e,t){this._carrier._triggerEnvelopeAttack(e,t),this._modulator._triggerEnvelopeAttack(e,t)}},{key:"_triggerEnvelopeRelease",value:function(e){return this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this}},{key:"getLevelAtTime",value:function(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Oo.getDefaults(),{harmonicity:3,oscillator:Object.assign(Sa(uo.getDefaults(),[].concat(_toConsumableArray(Object.keys(Ui.getDefaults())),["frequency","detune"])),{type:"sine"}),envelope:Object.assign(Sa(Eo.getDefaults(),Object.keys(pi.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(Sa(uo.getDefaults(),[].concat(_toConsumableArray(Object.keys(Ui.getDefaults())),["frequency","detune"])),{type:"square"}),modulationEnvelope:Object.assign(Sa(Eo.getDefaults(),Object.keys(pi.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}}]),n}(Oo),Fo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="AMSynth",e._modulationScale=new eo({context:e.context}),e.frequency.connect(e._carrier.frequency),e.frequency.chain(e.harmonicity,e._modulator.frequency),e.detune.fan(e._carrier.detune,e._modulator.detune),e._modulator.chain(e._modulationScale,e._modulationNode.gain),e._carrier.chain(e._modulationNode,e.output),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._modulationScale.dispose(),this}}]),n}(Po),Mo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","type"]))).name="BiquadFilter";var r=xa(n.getDefaults(),arguments,["frequency","type"]);return e._filter=e.context.createBiquadFilter(),e.input=e.output=e._filter,e.Q=new di({context:e.context,units:"number",value:r.Q,param:e._filter.Q}),e.frequency=new di({context:e.context,units:"frequency",value:r.frequency,param:e._filter.frequency}),e.detune=new di({context:e.context,units:"cents",value:r.detune,param:e._filter.detune}),e.gain=new di({context:e.context,units:"gain",value:r.gain,param:e._filter.gain}),e.type=r.type,e}return _createClass2(n,[{key:"getFrequencyResponse",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,t=new Float32Array(e),n=0;n<e;n++){var r=Math.pow(n/e,2);t[n]=19980*r+20}var a=new Float32Array(e),i=new Float32Array(e),o=this.context.createBiquadFilter();return o.type=this.type,o.Q.value=this.Q.value,o.frequency.value=this.frequency.value,o.gain.value=this.gain.value,o.getFrequencyResponse(t,a,i),a}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}},{key:"type",get:function(){return this._filter.type},set:function(e){Qr(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e),"Invalid filter type: "+e),this._filter.type=e}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}}]),n}(pi),Lo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","type","rolloff"]))).name="Filter",e.input=new yi({context:e.context}),e.output=new yi({context:e.context}),e._filters=[];var r=xa(n.getDefaults(),arguments,["frequency","type","rolloff"]);return e._filters=[],e.Q=new ki({context:e.context,units:"positive",value:r.Q}),e.frequency=new ki({context:e.context,units:"frequency",value:r.frequency}),e.detune=new ki({context:e.context,units:"cents",value:r.detune}),e.gain=new ki({context:e.context,units:"decibels",value:r.gain}),e._type=r.type,e.rolloff=r.rolloff,ja(_assertThisInitialized(e),["detune","frequency","gain","Q"]),e}return _createClass2(n,[{key:"getFrequencyResponse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,t=new Mo({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),n=new Float32Array(e).map((function(){return 1}));return this._filters.forEach((function(){t.getFrequencyResponse(e).forEach((function(e,t){return n[t]*=e}))})),t.dispose(),n}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._filters.forEach((function(e){e.dispose()})),Va(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}},{key:"type",get:function(){return this._type},set:function(e){Qr(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e),"Invalid filter type: "+e),this._type=e,this._filters.forEach((function(t){return t.type=e}))}},{key:"rolloff",get:function(){return this._rolloff},set:function(e){var t=ia(e)?e:parseInt(e,10),n=[-12,-24,-48,-96],r=n.indexOf(t);Qr(-1!==r,"rolloff can only be "+n.join(", ")),r+=1,this._rolloff=t,this.input.disconnect(),this._filters.forEach((function(e){return e.disconnect()})),this._filters=new Array(r);for(var a=0;a<r;a++){var i=new Mo({context:this.context});i.type=this._type,this.frequency.connect(i.frequency),this.detune.connect(i.detune),this.Q.connect(i.Q),this.gain.connect(i.gain),this._filters[a]=i}this._internalChannels=this._filters,mi.apply(void 0,[this.input].concat(_toConsumableArray(this._internalChannels),[this.output]))}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}}]),n}(pi),zo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["attack","decay","sustain","release"]))).name="FrequencyEnvelope";var r=xa(n.getDefaults(),arguments,["attack","decay","sustain","release"]);return e._octaves=r.octaves,e._baseFrequency=e.toFrequency(r.baseFrequency),e._exponent=e.input=new So({context:e.context,value:r.exponent}),e._scale=e.output=new lo({context:e.context,min:e._baseFrequency,max:e._baseFrequency*Math.pow(2,e._octaves)}),e._sig.chain(e._exponent,e._scale),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._exponent.dispose(),this._scale.dispose(),this}},{key:"baseFrequency",get:function(){return this._baseFrequency},set:function(e){var t=this.toFrequency(e);Yr(t,0),this._baseFrequency=t,this._scale.min=this._baseFrequency,this.octaves=this._octaves}},{key:"octaves",get:function(){return this._octaves},set:function(e){Yr(e,0),this._octaves=e,this._scale.max=this._baseFrequency*Math.pow(2,e)}},{key:"exponent",get:function(){return this._exponent.value},set:function(e){this._exponent.value=e}}],[{key:"getDefaults",value:function(){return Object.assign(Eo.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}}]),n}(Eo),Bo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="MonoSynth";var r=xa(n.getDefaults(),arguments);return e.oscillator=new uo(Object.assign(r.oscillator,{context:e.context,detune:r.detune,onstop:function(){return e.onsilence(_assertThisInitialized(e))}})),e.frequency=e.oscillator.frequency,e.detune=e.oscillator.detune,e.filter=new Lo(Object.assign(r.filter,{context:e.context})),e.filterEnvelope=new zo(Object.assign(r.filterEnvelope,{context:e.context})),e.envelope=new No(Object.assign(r.envelope,{context:e.context})),e.oscillator.chain(e.filter,e.envelope,e.output),e.filterEnvelope.connect(e.filter.frequency),ja(_assertThisInitialized(e),["oscillator","frequency","detune","filter","filterEnvelope","envelope"]),e}return _createClass2(n,[{key:"_triggerEnvelopeAttack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.envelope.triggerAttack(e,t),this.filterEnvelope.triggerAttack(e),this.oscillator.start(e),0===this.envelope.sustain){var n=this.toSeconds(this.envelope.attack),r=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+r)}}},{key:"_triggerEnvelopeRelease",value:function(e){this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}},{key:"getLevelAtTime",value:function(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Oo.getDefaults(),{envelope:Object.assign(Sa(Eo.getDefaults(),Object.keys(pi.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(Sa(Lo.getDefaults(),Object.keys(pi.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(Sa(zo.getDefaults(),Object.keys(pi.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(Sa(uo.getDefaults(),Object.keys(Ui.getDefaults())),{type:"sawtooth"})})}}]),n}(Oo),jo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="DuoSynth";var r=xa(n.getDefaults(),arguments);return e.voice0=new Bo(Object.assign(r.voice0,{context:e.context,onsilence:function(){return e.onsilence(_assertThisInitialized(e))}})),e.voice1=new Bo(Object.assign(r.voice1,{context:e.context})),e.harmonicity=new to({context:e.context,units:"positive",value:r.harmonicity}),e._vibrato=new fo({frequency:r.vibratoRate,context:e.context,min:-50,max:50}),e._vibrato.start(),e.vibratoRate=e._vibrato.frequency,e._vibratoGain=new yi({context:e.context,units:"normalRange",gain:r.vibratoAmount}),e.vibratoAmount=e._vibratoGain.gain,e.frequency=new ki({context:e.context,units:"frequency",value:440}),e.detune=new ki({context:e.context,units:"cents",value:r.detune}),e.frequency.connect(e.voice0.frequency),e.frequency.chain(e.harmonicity,e.voice1.frequency),e._vibrato.connect(e._vibratoGain),e._vibratoGain.fan(e.voice0.detune,e.voice1.detune),e.detune.fan(e.voice0.detune,e.voice1.detune),e.voice0.connect(e.output),e.voice1.connect(e.output),ja(_assertThisInitialized(e),["voice0","voice1","frequency","vibratoAmount","vibratoRate"]),e}return _createClass2(n,[{key:"getLevelAtTime",value:function(e){return e=this.toSeconds(e),this.voice0.envelope.getValueAtTime(e)+this.voice1.envelope.getValueAtTime(e)}},{key:"_triggerEnvelopeAttack",value:function(e,t){this.voice0._triggerEnvelopeAttack(e,t),this.voice1._triggerEnvelopeAttack(e,t)}},{key:"_triggerEnvelopeRelease",value:function(e){return this.voice0._triggerEnvelopeRelease(e),this.voice1._triggerEnvelopeRelease(e),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}],[{key:"getDefaults",value:function(){return wa(Oo.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:wa(Sa(Bo.getDefaults(),Object.keys(Oo.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:wa(Sa(Bo.getDefaults(),Object.keys(Oo.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}}]),n}(Oo),Vo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="FMSynth";var r=xa(n.getDefaults(),arguments);return e.modulationIndex=new to({context:e.context,value:r.modulationIndex}),e.frequency.connect(e._carrier.frequency),e.frequency.chain(e.harmonicity,e._modulator.frequency),e.frequency.chain(e.modulationIndex,e._modulationNode),e.detune.fan(e._carrier.detune,e._modulator.detune),e._modulator.connect(e._modulationNode.gain),e._modulationNode.connect(e._carrier.frequency),e._carrier.connect(e.output),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.modulationIndex.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Po.getDefaults(),{modulationIndex:10})}}]),n}(Po),qo=[1,1.483,1.932,2.546,2.63,3.897],Uo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="MetalSynth",e._oscillators=[],e._freqMultipliers=[];var r=xa(n.getDefaults(),arguments);e.detune=new ki({context:e.context,units:"cents",value:r.detune}),e.frequency=new ki({context:e.context,units:"frequency"}),e._amplitude=new yi({context:e.context,gain:0}).connect(e.output),e._highpass=new Lo({Q:0,context:e.context,type:"highpass"}).connect(e._amplitude);for(var a=0;a<qo.length;a++){var i=new ro({context:e.context,harmonicity:r.harmonicity,modulationIndex:r.modulationIndex,modulationType:"square",onstop:0===a?function(){return e.onsilence(_assertThisInitialized(e))}:qa,type:"square"});i.connect(e._highpass),e._oscillators[a]=i;var o=new to({context:e.context,value:qo[a]});e._freqMultipliers[a]=o,e.frequency.chain(o,i.frequency),e.detune.connect(i.detune)}return e._filterFreqScaler=new lo({context:e.context,max:7e3,min:e.toFrequency(r.resonance)}),e.envelope=new Eo({attack:r.envelope.attack,attackCurve:"linear",context:e.context,decay:r.envelope.decay,release:r.envelope.release,sustain:0}),e.envelope.chain(e._filterFreqScaler,e._highpass.frequency),e.envelope.connect(e._amplitude.gain),e._octaves=r.octaves,e.octaves=r.octaves,e}return _createClass2(n,[{key:"_triggerEnvelopeAttack",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.envelope.triggerAttack(e,n),this._oscillators.forEach((function(t){return t.start(e)})),0===this.envelope.sustain&&this._oscillators.forEach((function(n){n.stop(e+t.toSeconds(t.envelope.attack)+t.toSeconds(t.envelope.decay))})),this}},{key:"_triggerEnvelopeRelease",value:function(e){var t=this;return this.envelope.triggerRelease(e),this._oscillators.forEach((function(n){return n.stop(e+t.toSeconds(t.envelope.release))})),this}},{key:"getLevelAtTime",value:function(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._oscillators.forEach((function(e){return e.dispose()})),this._freqMultipliers.forEach((function(e){return e.dispose()})),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}},{key:"modulationIndex",get:function(){return this._oscillators[0].modulationIndex.value},set:function(e){this._oscillators.forEach((function(t){return t.modulationIndex.value=e}))}},{key:"harmonicity",get:function(){return this._oscillators[0].harmonicity.value},set:function(e){this._oscillators.forEach((function(t){return t.harmonicity.value=e}))}},{key:"resonance",get:function(){return this._filterFreqScaler.min},set:function(e){this._filterFreqScaler.min=this.toFrequency(e),this.octaves=this._octaves}},{key:"octaves",get:function(){return this._octaves},set:function(e){this._octaves=e,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,e)}}],[{key:"getDefaults",value:function(){return wa(Oo.getDefaults(),{envelope:Object.assign(Sa(Eo.getDefaults(),Object.keys(pi.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}}]),n}(Oo),Wo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="MembraneSynth",e.portamento=0;var r=xa(n.getDefaults(),arguments);return e.pitchDecay=r.pitchDecay,e.octaves=r.octaves,ja(_assertThisInitialized(e),["oscillator","envelope"]),e}return _createClass2(n,[{key:"setNote",value:function(e,t){var n=this.toSeconds(t),r=this.toFrequency(e instanceof ii?e.toFrequency():e);return this.oscillator.frequency.setValueAtTime(r*this.octaves,n),this.oscillator.frequency.exponentialRampToValueAtTime(r,n+this.toSeconds(this.pitchDecay)),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this}}],[{key:"getDefaults",value:function(){return wa(Oo.getDefaults(),Do.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}}]),n}(Do);da([po(0)],Wo.prototype,"octaves",void 0),da([mo(0)],Wo.prototype,"pitchDecay",void 0);var Go=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="NoiseSynth";var r=xa(n.getDefaults(),arguments);return e.noise=new Gi(Object.assign({context:e.context},r.noise)),e.envelope=new No(Object.assign({context:e.context},r.envelope)),e.noise.chain(e.envelope,e.output),e}return _createClass2(n,[{key:"triggerAttack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e=this.toSeconds(e),this.envelope.triggerAttack(e,t),this.noise.start(e),0===this.envelope.sustain&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}},{key:"triggerRelease",value:function(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}},{key:"sync",value:function(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}},{key:"triggerAttackRelease",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t=this.toSeconds(t),e=this.toSeconds(e),this.triggerAttack(t,n),this.triggerRelease(t+e),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.noise.dispose(),this.envelope.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Ro.getDefaults(),{envelope:Object.assign(Sa(Eo.getDefaults(),Object.keys(pi.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(Sa(Gi.getDefaults(),Object.keys(Ui.getDefaults())),{type:"white"})})}}]),n}(Ro),Ho=new Set;function Ko(e){Ho.add(e)}function Xo(e,t){Ho.add('registerProcessor("'.concat(e,'", ').concat(t,")"))}var Qo=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;_classCallCheck2(this,n),(r=t.call(this,e)).name="ToneAudioWorklet",r.workletOptions={},r.onprocessorerror=qa;var a=URL.createObjectURL(new Blob([Array.from(Ho).join("\n")],{type:"text/javascript"})),i=r._audioWorkletName();return r._dummyGain=r.context.createGain(),r._dummyParam=r._dummyGain.gain,r.context.addAudioWorkletModule(a,i).then((function(){r.disposed||(r._worklet=r.context.createAudioWorkletNode(i,r.workletOptions),r._worklet.onprocessorerror=r.onprocessorerror.bind(_assertThisInitialized(r)),r.onReady(r._worklet))})),r}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}]),n}(pi);Ko('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n'),Ko("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n"),Ko("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n"),Xo("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');var Yo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["delayTime","resonance"]))).name="FeedbackCombFilter";var r=xa(n.getDefaults(),arguments,["delayTime","resonance"]);return e.input=new yi({context:e.context}),e.output=new yi({context:e.context}),e.delayTime=new di({context:e.context,value:r.delayTime,units:"time",minValue:0,maxValue:1,param:e._dummyParam,swappable:!0}),e.resonance=new di({context:e.context,value:r.resonance,units:"normalRange",param:e._dummyParam,swappable:!0}),ja(_assertThisInitialized(e),["resonance","delayTime"]),e}return _createClass2(n,[{key:"_audioWorkletName",value:function(){return"feedback-comb-filter"}},{key:"onReady",value:function(e){mi(this.input,e,this.output);var t=e.parameters.get("delayTime");this.delayTime.setParam(t);var n=e.parameters.get("feedback");this.resonance.setParam(n)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{delayTime:.1,resonance:.5})}}]),n}(Qo),Zo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","type"]))).name="OnePoleFilter";var r=xa(n.getDefaults(),arguments,["frequency","type"]);return e._frequency=r.frequency,e._type=r.type,e.input=new yi({context:e.context}),e.output=new yi({context:e.context}),e._createFilter(),e}return _createClass2(n,[{key:"_createFilter",value:function(){var e=this,t=this._filter,n=this.toFrequency(this._frequency),r=1/(2*Math.PI*n);if("lowpass"===this._type){var a=1/(r*this.context.sampleRate);this._filter=this.context.createIIRFilter([a,0],[1,a-1])}else this._filter=this.context.createIIRFilter([1,-1],[1,1/(r*this.context.sampleRate)-1]);this.input.chain(this._filter,this.output),t&&this.context.setTimeout((function(){e.disposed||(e.input.disconnect(t),t.disconnect())}),this.blockTime)}},{key:"getFrequencyResponse",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,t=new Float32Array(e),n=0;n<e;n++){var r=Math.pow(n/e,2);t[n]=19980*r+20}var a=new Float32Array(e),i=new Float32Array(e);return this._filter.getFrequencyResponse(t,a,i),a}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}},{key:"frequency",get:function(){return this._frequency},set:function(e){this._frequency=e,this._createFilter()}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._createFilter()}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{frequency:880,type:"lowpass"})}}]),n}(pi),Jo=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["delayTime","resonance","dampening"]))).name="LowpassCombFilter";var r=xa(n.getDefaults(),arguments,["delayTime","resonance","dampening"]);return e._combFilter=e.output=new Yo({context:e.context,delayTime:r.delayTime,resonance:r.resonance}),e.delayTime=e._combFilter.delayTime,e.resonance=e._combFilter.resonance,e._lowpass=e.input=new Zo({context:e.context,frequency:r.dampening,type:"lowpass"}),e._lowpass.connect(e._combFilter),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._combFilter.dispose(),this._lowpass.dispose(),this}},{key:"dampening",get:function(){return this._lowpass.frequency},set:function(e){this._lowpass.frequency=e}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}}]),n}(pi),$o=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="PluckSynth";var r=xa(n.getDefaults(),arguments);return e._noise=new Gi({context:e.context,type:"pink"}),e.attackNoise=r.attackNoise,e._lfcf=new Jo({context:e.context,dampening:r.dampening,resonance:r.resonance}),e.resonance=r.resonance,e.release=r.release,e._noise.connect(e._lfcf),e._lfcf.connect(e.output),e}return _createClass2(n,[{key:"triggerAttack",value:function(e,t){var n=this.toFrequency(e);t=this.toSeconds(t);var r=1/n;return this._lfcf.delayTime.setValueAtTime(r,t),this._noise.start(t),this._noise.stop(t+r*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(t),this._lfcf.resonance.setValueAtTime(this.resonance,t),this}},{key:"triggerRelease",value:function(e){return this._lfcf.resonance.linearRampTo(0,this.release,e),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._noise.dispose(),this._lfcf.dispose(),this}},{key:"dampening",get:function(){return this._lfcf.dampening},set:function(e){this._lfcf.dampening=e}}],[{key:"getDefaults",value:function(){return wa(Ro.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}}]),n}(Ro),es=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["voice","options"]))).name="PolySynth",e._availableVoices=[],e._activeVoices=[],e._voices=[],e._gcTimeout=-1,e._averageActiveVoices=0;var r=xa(n.getDefaults(),arguments,["voice","options"]);Qr(!ia(r.voice),"DEPRECATED: The polyphony count is no longer the first argument.");var a=r.voice.getDefaults();e.options=Object.assign(a,r.options),e.voice=r.voice,e.maxPolyphony=r.maxPolyphony,e._dummyVoice=e._getNextAvailableVoice();var i=e._voices.indexOf(e._dummyVoice);return e._voices.splice(i,1),e._gcTimeout=e.context.setInterval(e._collectGarbage.bind(_assertThisInitialized(e)),1),e}return _createClass2(n,[{key:"_makeVoiceAvailable",value:function(e){this._availableVoices.push(e);var t=this._activeVoices.findIndex((function(t){return t.voice===e}));this._activeVoices.splice(t,1)}},{key:"_getNextAvailableVoice",value:function(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){var e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return e.connect(this.output),this._voices.push(e),e}ta("Max polyphony exceeded. Note dropped.")}},{key:"_collectGarbage",value:function(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){var e=this._availableVoices.shift(),t=this._voices.indexOf(e);this._voices.splice(t,1),this.context.isOffline||e.dispose()}}},{key:"_triggerAttack",value:function(e,t,n){var r=this;e.forEach((function(e){var a=new Ri(r.context,e).toMidi(),i=r._getNextAvailableVoice();i&&(i.triggerAttack(e,t,n),r._activeVoices.push({midi:a,voice:i,released:!1}),r.log("triggerAttack",e,t))}))}},{key:"_triggerRelease",value:function(e,t){var n=this;e.forEach((function(e){var r=new Ri(n.context,e).toMidi(),a=n._activeVoices.find((function(e){var t=e.midi,n=e.released;return t===r&&!n}));a&&(a.voice.triggerRelease(t),a.released=!0,n.log("triggerRelease",e,t))}))}},{key:"_scheduleEvent",value:function(e,t,n,r){var a=this;Qr(!this.disposed,"Synth was already disposed"),n<=this.now()?"attack"===e?this._triggerAttack(t,n,r):this._triggerRelease(t,n):this.context.setTimeout((function(){a._scheduleEvent(e,t,n,r)}),n-this.now())}},{key:"triggerAttack",value:function(e,t,n){Array.isArray(e)||(e=[e]);var r=this.toSeconds(t);return this._scheduleEvent("attack",e,r,n),this}},{key:"triggerRelease",value:function(e,t){Array.isArray(e)||(e=[e]);var n=this.toSeconds(t);return this._scheduleEvent("release",e,n),this}},{key:"triggerAttackRelease",value:function(e,t,n,r){var a=this.toSeconds(n);if(this.triggerAttack(e,a,r),ua(t)){Qr(ua(e),"If the duration is an array, the notes must also be an array"),e=e;for(var i=0;i<e.length;i++){var o=t[Math.min(i,t.length-1)],s=this.toSeconds(o);Qr(s>0,"The duration must be greater than 0"),this.triggerRelease(e[i],a+s)}}else{var u=this.toSeconds(t);Qr(u>0,"The duration must be greater than 0"),this.triggerRelease(e,a+u)}return this}},{key:"sync",value:function(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}},{key:"set",value:function(e){var t=Sa(e,["onsilence","context"]);return this.options=wa(this.options,t),this._voices.forEach((function(e){return e.set(t)})),this._dummyVoice.set(t),this}},{key:"get",value:function(){return this._dummyVoice.get()}},{key:"releaseAll",value:function(e){var t=this.toSeconds(e);return this._activeVoices.forEach((function(e){e.voice.triggerRelease(t)})),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._dummyVoice.dispose(),this._voices.forEach((function(e){return e.dispose()})),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}},{key:"activeVoices",get:function(){return this._activeVoices.length}}],[{key:"getDefaults",value:function(){return Object.assign(Ro.getDefaults(),{maxPolyphony:32,options:{},voice:Do})}}]),n}(Ro),ts=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"))).name="Sampler",e._activeSources=new Map;var r=xa(n.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),a={};return Object.keys(r.urls).forEach((function(t){var n=parseInt(t,10);if(Qr(la(t)||ia(n)&&isFinite(n),"url key is neither a note or midi pitch: "+t),la(t)){var i=new ii(e.context,t).toMidi();a[i]=r.urls[t]}else ia(n)&&isFinite(n)&&(a[n]=r.urls[n])})),e._buffers=new Ii({urls:a,onload:r.onload,baseUrl:r.baseUrl,onerror:r.onerror}),e.attack=r.attack,e.release=r.release,e.curve=r.curve,e._buffers.loaded&&Promise.resolve().then(r.onload),e}return _createClass2(n,[{key:"_findClosest",value:function(e){for(var t=0;t<96;){if(this._buffers.has(e+t))return-t;if(this._buffers.has(e-t))return t;t++}throw new Error("No available buffers for note: "+e)}},{key:"triggerAttack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this.log("triggerAttack",e,t,r),Array.isArray(e)||(e=[e]),e.forEach((function(e){var a=ti(new ii(n.context,e).toFrequency()),i=Math.round(a),o=a-i,s=n._findClosest(i),u=n._buffers.get(i-s),c=Ja(s+o),l=new Wi({url:u,context:n.context,curve:n.curve,fadeIn:n.attack,fadeOut:n.release,playbackRate:c}).connect(n.output);l.start(t,0,u.duration/c,r),ua(n._activeSources.get(i))||n._activeSources.set(i,[]),n._activeSources.get(i).push(l),l.onended=function(){if(n._activeSources&&n._activeSources.has(i)){var e=n._activeSources.get(i),t=e.indexOf(l);-1!==t&&e.splice(t,1)}}})),this}},{key:"triggerRelease",value:function(e,t){var n=this;return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach((function(e){var r=new ii(n.context,e).toMidi();if(n._activeSources.has(r)&&n._activeSources.get(r).length){var a=n._activeSources.get(r);t=n.toSeconds(t),a.forEach((function(e){e.stop(t)})),n._activeSources.set(r,[])}})),this}},{key:"releaseAll",value:function(e){var t=this.toSeconds(e);return this._activeSources.forEach((function(e){for(;e.length;)e.shift().stop(t)})),this}},{key:"sync",value:function(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}},{key:"triggerAttackRelease",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=this.toSeconds(n);return this.triggerAttack(e,i,a),ua(t)?(Qr(ua(e),"notes must be an array when duration is array"),e.forEach((function(e,n){var a=t[Math.min(n,t.length-1)];r.triggerRelease(e,i+r.toSeconds(a))}))):this.triggerRelease(e,i+this.toSeconds(t)),this}},{key:"add",value:function(e,t,n){if(Qr(la(e)||isFinite(e),"note must be a pitch or midi: "+e),la(e)){var r=new ii(this.context,e).toMidi();this._buffers.add(r,t,n)}else this._buffers.add(e,t,n);return this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._buffers.dispose(),this._activeSources.forEach((function(e){e.forEach((function(e){return e.dispose()}))})),this._activeSources.clear(),this}},{key:"loaded",get:function(){return this._buffers.loaded}}],[{key:"getDefaults",value:function(){return Object.assign(Ro.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:qa,onerror:qa,release:.1,urls:{}})}}]),n}(Ro);da([mo(0)],ts.prototype,"attack",void 0),da([mo(0)],ts.prototype,"release",void 0);var ns=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["callback","value"]))).name="ToneEvent",e._state=new fi("stopped"),e._startOffset=0;var r=xa(n.getDefaults(),arguments,["callback","value"]);return e._loop=r.loop,e.callback=r.callback,e.value=r.value,e._loopStart=e.toTicks(r.loopStart),e._loopEnd=e.toTicks(r.loopEnd),e._playbackRate=r.playbackRate,e._probability=r.probability,e._humanize=r.humanize,e.mute=r.mute,e._playbackRate=r.playbackRate,e._state.increasing=!0,e._rescheduleEvents(),e}return _createClass2(n,[{key:"_rescheduleEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._state.forEachFrom(t,(function(t){var n;if("started"===t.state){-1!==t.id&&e.context.transport.clear(t.id);var r=t.time+Math.round(e.startOffset/e._playbackRate);if(!0===e._loop||ia(e._loop)&&e._loop>1){n=1/0,ia(e._loop)&&(n=e._loop*e._getLoopDuration());var a=e._state.getAfter(r);null!==a&&(n=Math.min(n,a.time-r)),n!==1/0&&(e._state.setStateAtTime("stopped",r+n+1,{id:-1}),n=new Ni(e.context,n));var i=new Ni(e.context,e._getLoopDuration());t.id=e.context.transport.scheduleRepeat(e._tick.bind(e),i,new Ni(e.context,r),n)}else t.id=e.context.transport.schedule(e._tick.bind(e),new Ni(e.context,r))}}))}},{key:"start",value:function(e){var t=this.toTicks(e);return"stopped"===this._state.getValueAtTime(t)&&(this._state.add({id:-1,state:"started",time:t}),this._rescheduleEvents(t)),this}},{key:"stop",value:function(e){this.cancel(e);var t=this.toTicks(e);if("started"===this._state.getValueAtTime(t)){this._state.setStateAtTime("stopped",t,{id:-1});var n=this._state.getBefore(t),r=t;null!==n&&(r=n.time),this._rescheduleEvents(r)}return this}},{key:"cancel",value:function(e){var t=this;e=Ca(e,-1/0);var n=this.toTicks(e);return this._state.forEachFrom(n,(function(e){t.context.transport.clear(e.id)})),this._state.cancel(n),this}},{key:"_tick",value:function(e){var t=this.context.transport.getTicksAtTime(e);if(!this.mute&&"started"===this._state.getValueAtTime(t)){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){var n=.02;sa(this.humanize)||(n=this.toSeconds(this.humanize)),e+=(2*Math.random()-1)*n}this.callback(e,this.value)}}},{key:"_getLoopDuration",value:function(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.cancel(),this._state.dispose(),this}},{key:"state",get:function(){return this._state.getValueAtTime(this.context.transport.ticks)}},{key:"startOffset",get:function(){return this._startOffset},set:function(e){this._startOffset=e}},{key:"probability",get:function(){return this._probability},set:function(e){this._probability=e}},{key:"humanize",get:function(){return this._humanize},set:function(e){this._humanize=e}},{key:"loop",get:function(){return this._loop},set:function(e){this._loop=e,this._rescheduleEvents()}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._rescheduleEvents()}},{key:"loopEnd",get:function(){return new Ni(this.context,this._loopEnd).toSeconds()},set:function(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}},{key:"loopStart",get:function(){return new Ni(this.context,this._loopStart).toSeconds()},set:function(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}},{key:"progress",get:function(){if(this._loop){var e=this.context.transport.ticks,t=this._state.get(e);if(null!==t&&"started"===t.state){var n=this._getLoopDuration();return(e-t.time)%n/n}return 0}return 0}}],[{key:"getDefaults",value:function(){return Object.assign(hi.getDefaults(),{callback:qa,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}}]),n}(hi),rs=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["callback","interval"]))).name="Loop";var r=xa(n.getDefaults(),arguments,["callback","interval"]);return e._event=new ns({context:e.context,callback:e._tick.bind(_assertThisInitialized(e)),loop:!0,loopEnd:r.interval,playbackRate:r.playbackRate,probability:r.probability}),e.callback=r.callback,e.iterations=r.iterations,e}return _createClass2(n,[{key:"start",value:function(e){return this._event.start(e),this}},{key:"stop",value:function(e){return this._event.stop(e),this}},{key:"cancel",value:function(e){return this._event.cancel(e),this}},{key:"_tick",value:function(e){this.callback(e)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._event.dispose(),this}},{key:"state",get:function(){return this._event.state}},{key:"progress",get:function(){return this._event.progress}},{key:"interval",get:function(){return this._event.loopEnd},set:function(e){this._event.loopEnd=e}},{key:"playbackRate",get:function(){return this._event.playbackRate},set:function(e){this._event.playbackRate=e}},{key:"humanize",get:function(){return this._event.humanize},set:function(e){this._event.humanize=e}},{key:"probability",get:function(){return this._event.probability},set:function(e){this._event.probability=e}},{key:"mute",get:function(){return this._event.mute},set:function(e){this._event.mute=e}},{key:"iterations",get:function(){return!0===this._event.loop?1/0:this._event.loop},set:function(e){this._event.loop=e===1/0||e}}],[{key:"getDefaults",value:function(){return Object.assign(hi.getDefaults(),{interval:"4n",callback:qa,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}}]),n}(hi),as=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["callback","events"]))).name="Part",e._state=new fi("stopped"),e._events=new Set;var r=xa(n.getDefaults(),arguments,["callback","events"]);return e._state.increasing=!0,r.events.forEach((function(t){ua(t)?e.add(t[0],t[1]):e.add(t)})),e}return _createClass2(n,[{key:"start",value:function(e,t){var n=this,r=this.toTicks(e);if("started"!==this._state.getValueAtTime(r)){t=Ca(t,this._loop?this._loopStart:0),t=Ca(t,this._loop?this._loopStart:0);var a=this.toTicks(t);this._state.add({id:-1,offset:a,state:"started",time:r}),this._forEach((function(e){n._startNote(e,r,a)}))}return this}},{key:"_startNote",value:function(e,t,n){t-=n,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<n&&(t+=this._getLoopDuration()),e.start(new Ni(this.context,t))):e.startOffset<this._loopStart&&e.startOffset>=n&&(e.loop=!1,e.start(new Ni(this.context,t))):e.startOffset>=n&&e.start(new Ni(this.context,t))}},{key:"stop",value:function(e){var t=this.toTicks(e);return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._forEach((function(t){t.stop(e)})),this}},{key:"at",value:function(e,t){for(var n=new ci(this.context,e).toTicks(),r=new Ni(this.context,1).toSeconds(),a=this._events.values(),i=a.next();!i.done;){var o=i.value;if(Math.abs(n-o.startOffset)<r)return ra(t)&&(o.value=t),o;i=a.next()}return ra(t)?(this.add(e,t),this.at(e)):null}},{key:"add",value:function(e,t){e instanceof Object&&Reflect.has(e,"time")&&(e=(t=e).time);var n,r=this.toTicks(e);return t instanceof ns?(n=t).callback=this._tick.bind(this):n=new ns({callback:this._tick.bind(this),context:this.context,value:t}),n.startOffset=r,n.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(n),this._restartEvent(n),this}},{key:"_restartEvent",value:function(e){var t=this;this._state.forEach((function(n){"started"===n.state?t._startNote(e,n.time,n.offset):e.stop(new Ni(t.context,n.time))}))}},{key:"remove",value:function(e,t){var n=this;return oa(e)&&e.hasOwnProperty("time")&&(e=(t=e).time),e=this.toTicks(e),this._events.forEach((function(r){r.startOffset===e&&(na(t)||ra(t)&&r.value===t)&&(n._events.delete(r),r.dispose())})),this}},{key:"clear",value:function(){return this._forEach((function(e){return e.dispose()})),this._events.clear(),this}},{key:"cancel",value:function(e){return this._forEach((function(t){return t.cancel(e)})),this._state.cancel(this.toTicks(e)),this}},{key:"_forEach",value:function(e){return this._events&&this._events.forEach((function(t){t instanceof n?t._forEach(e):e(t)})),this}},{key:"_setAll",value:function(e,t){this._forEach((function(n){n[e]=t}))}},{key:"_tick",value:function(e,t){this.mute||this.callback(e,t)}},{key:"_testLoopBoundries",value:function(e){this._loop&&(e.startOffset<this._loopStart||e.startOffset>=this._loopEnd)?e.cancel(0):"stopped"===e.state&&this._restartEvent(e)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.clear(),this}},{key:"startOffset",get:function(){return this._startOffset},set:function(e){var t=this;this._startOffset=e,this._forEach((function(e){e.startOffset+=t._startOffset}))}},{key:"probability",get:function(){return this._probability},set:function(e){this._probability=e,this._setAll("probability",e)}},{key:"humanize",get:function(){return this._humanize},set:function(e){this._humanize=e,this._setAll("humanize",e)}},{key:"loop",get:function(){return this._loop},set:function(e){var t=this;this._loop=e,this._forEach((function(n){n.loopStart=t.loopStart,n.loopEnd=t.loopEnd,n.loop=e,t._testLoopBoundries(n)}))}},{key:"loopEnd",get:function(){return new Ni(this.context,this._loopEnd).toSeconds()},set:function(e){var t=this;this._loopEnd=this.toTicks(e),this._loop&&this._forEach((function(n){n.loopEnd=e,t._testLoopBoundries(n)}))}},{key:"loopStart",get:function(){return new Ni(this.context,this._loopStart).toSeconds()},set:function(e){var t=this;this._loopStart=this.toTicks(e),this._loop&&this._forEach((function(e){e.loopStart=t.loopStart,t._testLoopBoundries(e)}))}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._setAll("playbackRate",e)}},{key:"length",get:function(){return this._events.size}}],[{key:"getDefaults",value:function(){return Object.assign(ns.getDefaults(),{events:[]})}}]),n}(ns);function is(e){var t;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=0;case 1:if(!(t<e.length)){n.next=8;break}return t=us(t,e),n.next=5,e[t];case 5:t++;case 6:n.next=1;break;case 8:case"end":return n.stop()}}),r)}function os(e){var t;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=e.length-1;case 1:if(!(t>=0)){n.next=8;break}return t=us(t,e),n.next=5,e[t];case 5:t--;case 6:n.next=1;break;case 8:case"end":return n.stop()}}),a)}function ss(e,t){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.delegateYield(t(e),"t0",1);case 1:n.next=0;break;case 3:case"end":return n.stop()}}),i)}function us(e,t){return Oa(e,0,t.length-1)}function cs(e,t){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=t?0:e.length-1;case 1:return n=us(n,e),r.next=4,e[n];case 4:t?++n>=e.length-1&&(t=!1):--n<=0&&(t=!0);case 5:r.next=1;break;case 7:case"end":return r.stop()}}),o)}function ls(e){var t,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=0,n=0;case 1:if(!(t<e.length)){r.next=9;break}return t=us(t,e),r.next=5,e[t];case 5:n++,t+=n%2?2:-1;case 7:r.next=1;break;case 9:case"end":return r.stop()}}),s)}function hs(e){var t,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=e.length-1,n=0;case 1:if(!(t>=0)){r.next=9;break}return t=us(t,e),r.next=5,e[t];case 5:n++,t+=n%2?-2:1;case 7:r.next=1;break;case 9:case"end":return r.stop()}}),u)}function fs(e){var t,n,r;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:for(t=[],n=0;n<e.length;n++)t.push(n);case 2:if(!(t.length>0)){a.next=8;break}return r=us(t.splice(Math.floor(t.length*Math.random()),1)[0],e),a.next=6,e[r];case 6:a.next=2;break;case 8:case"end":return a.stop()}}),c)}function ds(e){var t,n=arguments;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=n.length>1&&void 0!==n[1]?n[1]:"up",n.length>2&&void 0!==n[2]?n[2]:0,r.t0=(Qr(e.length>0,"The array must have more than one value in it"),t),r.next="up"===r.t0?5:"down"===r.t0?6:"upDown"===r.t0?7:"downUp"===r.t0?8:"alternateUp"===r.t0?9:"alternateDown"===r.t0?10:"random"===r.t0?11:"randomOnce"===r.t0?12:"randomWalk"===r.t0?13:14;break;case 5:return r.delegateYield(ss(e,is),"t1",6);case 6:return r.delegateYield(ss(e,os),"t2",7);case 7:return r.delegateYield(cs(e,!0),"t3",8);case 8:return r.delegateYield(cs(e,!1),"t4",9);case 9:return r.delegateYield(ss(e,ls),"t5",10);case 10:return r.delegateYield(ss(e,hs),"t6",11);case 11:return r.delegateYield(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Math.floor(Math.random()*t.length),e.next=3,t[n];case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e)}))(e),"t7",12);case 12:return r.delegateYield(ss(e,fs),"t8",13);case 13:return r.delegateYield(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Math.floor(Math.random()*t.length);case 1:return 0===n?n++:n===t.length-1||Math.random()<.5?n--:n++,e.next=4,t[n];case 4:e.next=1;break;case 6:case"end":return e.stop()}}),e)}))(e),"t9",14);case 14:case"end":return r.stop()}}),l)}var ps=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["callback","values","pattern"]))).name="Pattern";var r=xa(n.getDefaults(),arguments,["callback","values","pattern"]);return e.callback=r.callback,e._values=r.values,e._pattern=ds(r.values,r.pattern),e._type=r.pattern,e}return _createClass2(n,[{key:"_tick",value:function(e){var t=this._pattern.next();this._value=t.value,this.callback(e,this._value)}},{key:"values",get:function(){return this._values},set:function(e){this._values=e,this.pattern=this._type}},{key:"value",get:function(){return this._value}},{key:"pattern",get:function(){return this._type},set:function(e){this._type=e,this._pattern=ds(this._values,this._type)}}],[{key:"getDefaults",value:function(){return Object.assign(rs.getDefaults(),{pattern:"up",values:[],callback:qa})}}]),n}(rs),ms=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["callback","events","subdivision"]))).name="Sequence",e._part=new as({callback:e._seqCallback.bind(_assertThisInitialized(e)),context:e.context}),e._events=[],e._eventsArray=[];var r=xa(n.getDefaults(),arguments,["callback","events","subdivision"]);return e._subdivision=e.toTicks(r.subdivision),e.events=r.events,e.loop=r.loop,e.loopStart=r.loopStart,e.loopEnd=r.loopEnd,e.playbackRate=r.playbackRate,e.probability=r.probability,e.humanize=r.humanize,e.mute=r.mute,e.playbackRate=r.playbackRate,e}return _createClass2(n,[{key:"_seqCallback",value:function(e,t){null!==t&&this.callback(e,t)}},{key:"start",value:function(e,t){return this._part.start(e,t?this._indexTime(t):t),this}},{key:"stop",value:function(e){return this._part.stop(e),this}},{key:"_createSequence",value:function(e){var t=this;return new Proxy(e,{get:function(e,t){return e[t]},set:function(e,n,r){return e[n]=ca(n)&&isFinite(parseInt(n,10))&&ua(r)?t._createSequence(r):r,t._eventsUpdated(),!0}})}},{key:"_eventsUpdated",value:function(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}},{key:"_rescheduleSequence",value:function(e,t,n){var r=this;e.forEach((function(e,a){var i=a*t+n;if(ua(e))r._rescheduleSequence(e,t/e.length,i);else{var o=new Ni(r.context,i,"i").toSeconds();r._part.add(o,e)}}))}},{key:"_indexTime",value:function(e){return new Ni(this.context,e*this._subdivision+this.startOffset).toSeconds()}},{key:"clear",value:function(){return this._part.clear(),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._part.dispose(),this}},{key:"events",get:function(){return this._events},set:function(e){this.clear(),this._eventsArray=e,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}},{key:"subdivision",get:function(){return new Ni(this.context,this._subdivision).toSeconds()}},{key:"loop",get:function(){return this._part.loop},set:function(e){this._part.loop=e}},{key:"loopStart",get:function(){return this._loopStart},set:function(e){this._loopStart=e,this._part.loopStart=this._indexTime(e)}},{key:"loopEnd",get:function(){return this._loopEnd},set:function(e){this._loopEnd=e,this._part.loopEnd=this._indexTime(0===e?this._eventsArray.length:e)}},{key:"startOffset",get:function(){return this._part.startOffset},set:function(e){this._part.startOffset=e}},{key:"playbackRate",get:function(){return this._part.playbackRate},set:function(e){this._part.playbackRate=e}},{key:"probability",get:function(){return this._part.probability},set:function(e){this._part.probability=e}},{key:"progress",get:function(){return this._part.progress}},{key:"humanize",get:function(){return this._part.humanize},set:function(e){this._part.humanize=e}},{key:"length",get:function(){return this._part.length}}],[{key:"getDefaults",value:function(){return Object.assign(Sa(ns.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}}]),n}(ns),vs=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments,["fade"])))).name="CrossFade",e._panner=e.context.createStereoPanner(),e._split=e.context.createChannelSplitter(2),e._g2a=new bo({context:e.context}),e.a=new yi({context:e.context,gain:0}),e.b=new yi({context:e.context,gain:0}),e.output=new yi({context:e.context}),e._internalChannels=[e.a,e.b];var r=xa(n.getDefaults(),arguments,["fade"]);return e.fade=new ki({context:e.context,units:"normalRange",value:r.fade}),ja(_assertThisInitialized(e),"fade"),e.context.getConstant(1).connect(e._panner),e._panner.connect(e._split),e._panner.channelCount=1,e._panner.channelCountMode="explicit",vi(e._split,e.a.gain,0),vi(e._split,e.b.gain,1),e.fade.chain(e._g2a,e._panner.pan),e.a.connect(e.output),e.b.connect(e.output),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{fade:.5})}}]),n}(pi),gs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).name="Effect",r._dryWet=new vs({context:r.context}),r.wet=r._dryWet.fade,r.effectSend=new yi({context:r.context}),r.effectReturn=new yi({context:r.context}),r.input=new yi({context:r.context}),r.output=r._dryWet,r.input.fan(r._dryWet.a,r.effectSend),r.effectReturn.connect(r._dryWet.b),r.wet.setValueAtTime(e.wet,0),r._internalChannels=[r.effectReturn,r.effectSend],ja(_assertThisInitialized(r),"wet"),r}return _createClass2(n,[{key:"connectEffect",value:function(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{wet:1})}}]),n}(pi),ys=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).name="LFOEffect",r._lfo=new fo({context:r.context,frequency:e.frequency,amplitude:e.depth}),r.depth=r._lfo.amplitude,r.frequency=r._lfo.frequency,r.type=e.type,ja(_assertThisInitialized(r),["frequency","depth"]),r}return _createClass2(n,[{key:"start",value:function(e){return this._lfo.start(e),this}},{key:"stop",value:function(e){return this._lfo.stop(e),this}},{key:"sync",value:function(){return this._lfo.sync(),this}},{key:"unsync",value:function(){return this._lfo.unsync(),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}},{key:"type",get:function(){return this._lfo.type},set:function(e){this._lfo.type=e}}],[{key:"getDefaults",value:function(){return Object.assign(gs.getDefaults(),{frequency:1,type:"sine",depth:1})}}]),n}(gs),_s=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","baseFrequency","octaves"]))).name="AutoFilter";var r=xa(n.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);return e.filter=new Lo(Object.assign(r.filter,{context:e.context})),e.connectEffect(e.filter),e._lfo.connect(e.filter.frequency),e.octaves=r.octaves,e.baseFrequency=r.baseFrequency,e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.filter.dispose(),this}},{key:"baseFrequency",get:function(){return this._lfo.min},set:function(e){this._lfo.min=this.toFrequency(e),this.octaves=this._octaves}},{key:"octaves",get:function(){return this._octaves},set:function(e){this._octaves=e,this._lfo.max=this._lfo.min*Math.pow(2,e)}}],[{key:"getDefaults",value:function(){return Object.assign(ys.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}}]),n}(ys),bs=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments,["pan"])))).name="Panner",e._panner=e.context.createStereoPanner(),e.input=e._panner,e.output=e._panner;var r=xa(n.getDefaults(),arguments,["pan"]);return e.pan=new di({context:e.context,param:e._panner.pan,value:r.pan,minValue:-1,maxValue:1}),e._panner.channelCount=r.channelCount,e._panner.channelCountMode="explicit",ja(_assertThisInitialized(e),"pan"),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._panner.disconnect(),this.pan.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{pan:0,channelCount:1})}}]),n}(pi),ks=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency"]))).name="AutoPanner";var r=xa(n.getDefaults(),arguments,["frequency"]);return e._panner=new bs({context:e.context,channelCount:r.channelCount}),e.connectEffect(e._panner),e._lfo.connect(e._panner.pan),e._lfo.min=-1,e._lfo.max=1,e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._panner.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(ys.getDefaults(),{channelCount:1})}}]),n}(ys),ws=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["smoothing"]))).name="Follower";var r=xa(n.getDefaults(),arguments,["smoothing"]);return e._abs=e.input=new _o({context:e.context}),e._lowpass=e.output=new Zo({context:e.context,frequency:1/e.toSeconds(r.smoothing),type:"lowpass"}),e._abs.connect(e._lowpass),e._smoothing=r.smoothing,e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._abs.dispose(),this._lowpass.dispose(),this}},{key:"smoothing",get:function(){return this._smoothing},set:function(e){this._smoothing=e,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{smoothing:.05})}}]),n}(pi),xs=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]))).name="AutoWah";var r=xa(n.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);return e._follower=new ws({context:e.context,smoothing:r.follower}),e._sweepRange=new To({context:e.context,min:0,max:1,exponent:.5}),e._baseFrequency=e.toFrequency(r.baseFrequency),e._octaves=r.octaves,e._inputBoost=new yi({context:e.context}),e._bandpass=new Lo({context:e.context,rolloff:-48,frequency:0,Q:r.Q}),e._peaking=new Lo({context:e.context,type:"peaking"}),e._peaking.gain.value=r.gain,e.gain=e._peaking.gain,e.Q=e._bandpass.Q,e.effectSend.chain(e._inputBoost,e._follower,e._sweepRange),e._sweepRange.connect(e._bandpass.frequency),e._sweepRange.connect(e._peaking.frequency),e.effectSend.chain(e._bandpass,e._peaking,e.effectReturn),e._setSweepRange(),e.sensitivity=r.sensitivity,ja(_assertThisInitialized(e),["gain","Q"]),e}return _createClass2(n,[{key:"_setSweepRange",value:function(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}},{key:"octaves",get:function(){return this._octaves},set:function(e){this._octaves=e,this._setSweepRange()}},{key:"follower",get:function(){return this._follower.smoothing},set:function(e){this._follower.smoothing=e}},{key:"baseFrequency",get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=this.toFrequency(e),this._setSweepRange()}},{key:"sensitivity",get:function(){return Za(1/this._inputBoost.gain.value)},set:function(e){this._inputBoost.gain.value=1/Ya(e)}}],[{key:"getDefaults",value:function(){return Object.assign(gs.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}}]),n}(gs);Xo("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");var Cs=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["bits"]))).name="BitCrusher";var r=xa(n.getDefaults(),arguments,["bits"]);return e._bitCrusherWorklet=new Ss({context:e.context,bits:r.bits}),e.connectEffect(e._bitCrusherWorklet),e.bits=e._bitCrusherWorklet.bits,e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._bitCrusherWorklet.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(gs.getDefaults(),{bits:4})}}]),n}(gs),Ss=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="BitCrusherWorklet";var r=xa(n.getDefaults(),arguments);return e.input=new yi({context:e.context}),e.output=new yi({context:e.context}),e.bits=new di({context:e.context,value:r.bits,units:"positive",minValue:1,maxValue:16,param:e._dummyParam,swappable:!0}),e}return _createClass2(n,[{key:"_audioWorkletName",value:function(){return"bit-crusher"}},{key:"onReady",value:function(e){mi(this.input,e,this.output);var t=e.parameters.get("bits");this.bits.setParam(t)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Qo.getDefaults(),{bits:12})}}]),n}(Qo),Ts=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["order"]))).name="Chebyshev";var r=xa(n.getDefaults(),arguments,["order"]);return e._shaper=new $i({context:e.context,length:4096}),e._order=r.order,e.connectEffect(e._shaper),e.order=r.order,e.oversample=r.oversample,e}return _createClass2(n,[{key:"_getCoefficient",value:function(e,t,n){return n.has(t)||n.set(t,0===t?0:1===t?e:2*e*this._getCoefficient(e,t-1,n)-this._getCoefficient(e,t-2,n)),n.get(t)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._shaper.dispose(),this}},{key:"order",get:function(){return this._order},set:function(e){var t=this;this._order=e,this._shaper.setMap((function(n){return t._getCoefficient(n,e,new Map)}))}},{key:"oversample",get:function(){return this._shaper.oversample},set:function(e){this._shaper.oversample=e}}],[{key:"getDefaults",value:function(){return Object.assign(gs.getDefaults(),{order:1,oversample:"none"})}}]),n}(gs),As=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["channels"]))).name="Split";var r=xa(n.getDefaults(),arguments,["channels"]);return e._splitter=e.input=e.output=e.context.createChannelSplitter(r.channels),e._internalChannels=[e._splitter],e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._splitter.disconnect(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{channels:2})}}]),n}(pi),Es=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["channels"]))).name="Merge";var r=xa(n.getDefaults(),arguments,["channels"]);return e._merger=e.output=e.input=e.context.createChannelMerger(r.channels),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._merger.disconnect(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{channels:2})}}]),n}(pi),Is=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).name="StereoEffect",r.input=new yi({context:r.context}),r.input.channelCount=2,r.input.channelCountMode="explicit",r._dryWet=r.output=new vs({context:r.context,fade:e.wet}),r.wet=r._dryWet.fade,r._split=new As({context:r.context,channels:2}),r._merge=new Es({context:r.context,channels:2}),r.input.connect(r._split),r.input.connect(r._dryWet.a),r._merge.connect(r._dryWet.b),ja(_assertThisInitialized(r),["wet"]),r}return _createClass2(n,[{key:"connectEffectLeft",value:function(){var e;this._split.connect(arguments.length<=0?void 0:arguments[0],0,0),mi.apply(void 0,arguments),vi((e=arguments.length-1)<0||arguments.length<=e?void 0:arguments[e],this._merge,0,0)}},{key:"connectEffectRight",value:function(){var e;this._split.connect(arguments.length<=0?void 0:arguments[0],1,0),mi.apply(void 0,arguments),vi((e=arguments.length-1)<0||arguments.length<=e?void 0:arguments[e],this._merge,0,1)}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{wet:1})}}]),n}(pi),Rs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).feedback=new ki({context:r.context,value:e.feedback,units:"normalRange"}),r._feedbackL=new yi({context:r.context}),r._feedbackR=new yi({context:r.context}),r._feedbackSplit=new As({context:r.context,channels:2}),r._feedbackMerge=new Es({context:r.context,channels:2}),r._merge.connect(r._feedbackSplit),r._feedbackMerge.connect(r._split),r._feedbackSplit.connect(r._feedbackL,0,0),r._feedbackL.connect(r._feedbackMerge,0,0),r._feedbackSplit.connect(r._feedbackR,1,0),r._feedbackR.connect(r._feedbackMerge,0,1),r.feedback.fan(r._feedbackL.gain,r._feedbackR.gain),ja(_assertThisInitialized(r),["feedback"]),r}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Is.getDefaults(),{feedback:.5})}}]),n}(Is),Os=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","delayTime","depth"]))).name="Chorus";var r=xa(n.getDefaults(),arguments,["frequency","delayTime","depth"]);return e._depth=r.depth,e._delayTime=r.delayTime/1e3,e._lfoL=new fo({context:e.context,frequency:r.frequency,min:0,max:1}),e._lfoR=new fo({context:e.context,frequency:r.frequency,min:0,max:1,phase:180}),e._delayNodeL=new Ai({context:e.context}),e._delayNodeR=new Ai({context:e.context}),e.frequency=e._lfoL.frequency,ja(_assertThisInitialized(e),["frequency"]),e._lfoL.frequency.connect(e._lfoR.frequency),e.connectEffectLeft(e._delayNodeL),e.connectEffectRight(e._delayNodeR),e._lfoL.connect(e._delayNodeL.delayTime),e._lfoR.connect(e._delayNodeR.delayTime),e.depth=e._depth,e.type=r.type,e.spread=r.spread,e}return _createClass2(n,[{key:"start",value:function(e){return this._lfoL.start(e),this._lfoR.start(e),this}},{key:"stop",value:function(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}},{key:"sync",value:function(){return this._lfoL.sync(),this._lfoR.sync(),this}},{key:"unsync",value:function(){return this._lfoL.unsync(),this._lfoR.unsync(),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}},{key:"depth",get:function(){return this._depth},set:function(e){this._depth=e;var t=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-t,0),this._lfoL.max=this._delayTime+t,this._lfoR.min=Math.max(this._delayTime-t,0),this._lfoR.max=this._delayTime+t}},{key:"delayTime",get:function(){return 1e3*this._delayTime},set:function(e){this._delayTime=e/1e3,this.depth=this._depth}},{key:"type",get:function(){return this._lfoL.type},set:function(e){this._lfoL.type=e,this._lfoR.type=e}},{key:"spread",get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}}],[{key:"getDefaults",value:function(){return Object.assign(Rs.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}}]),n}(Rs),Ns=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["distortion"]))).name="Distortion";var r=xa(n.getDefaults(),arguments,["distortion"]);return e._shaper=new $i({context:e.context,length:4096}),e._distortion=r.distortion,e.connectEffect(e._shaper),e.distortion=r.distortion,e.oversample=r.oversample,e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._shaper.dispose(),this}},{key:"distortion",get:function(){return this._distortion},set:function(e){this._distortion=e;var t=100*e,n=Math.PI/180;this._shaper.setMap((function(e){return Math.abs(e)<.001?0:(3+t)*e*20*n/(Math.PI+t*Math.abs(e))}))}},{key:"oversample",get:function(){return this._shaper.oversample},set:function(e){this._shaper.oversample=e}}],[{key:"getDefaults",value:function(){return Object.assign(gs.getDefaults(),{distortion:.4,oversample:"none"})}}]),n}(gs),Ds=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).name="FeedbackEffect",r._feedbackGain=new yi({context:r.context,gain:e.feedback,units:"normalRange"}),r.feedback=r._feedbackGain.gain,ja(_assertThisInitialized(r),"feedback"),r.effectReturn.chain(r._feedbackGain,r.effectSend),r}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._feedbackGain.dispose(),this.feedback.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(gs.getDefaults(),{feedback:.125})}}]),n}(gs),Ps=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["delayTime","feedback"]))).name="FeedbackDelay";var r=xa(n.getDefaults(),arguments,["delayTime","feedback"]);return e._delayNode=new Ai({context:e.context,delayTime:r.delayTime,maxDelay:r.maxDelay}),e.delayTime=e._delayNode.delayTime,e.connectEffect(e._delayNode),ja(_assertThisInitialized(e),"delayTime"),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._delayNode.dispose(),this.delayTime.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Ds.getDefaults(),{delayTime:.25,maxDelay:1})}}]),n}(Ds),Fs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).name="PhaseShiftAllpass",r.input=new yi({context:r.context}),r.output=new yi({context:r.context}),r.offset90=new yi({context:r.context}),r._bank0=r._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),r._bank1=r._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),r._oneSampleDelay=r.context.createIIRFilter([0,1],[1,0]),mi.apply(void 0,[r.input].concat(_toConsumableArray(r._bank0),[r._oneSampleDelay,r.output])),mi.apply(void 0,[r.input].concat(_toConsumableArray(r._bank1),[r.offset90])),r}return _createClass2(n,[{key:"_createAllPassFilterBank",value:function(e){var t=this;return e.map((function(e){var n=[[e*e,0,-1],[1,0,-e*e]];return t.context.createIIRFilter(n[0],n[1])}))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach((function(e){return e.disconnect()})),this._bank1.forEach((function(e){return e.disconnect()})),this._oneSampleDelay.disconnect(),this}}]),n}(pi),Ms=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency"]))).name="FrequencyShifter";var r=xa(n.getDefaults(),arguments,["frequency"]);e.frequency=new ki({context:e.context,units:"frequency",value:r.frequency,minValue:-e.context.sampleRate/2,maxValue:e.context.sampleRate/2}),e._sine=new Yi({context:e.context,type:"sine"}),e._cosine=new Zi({context:e.context,phase:-90,type:"sine"}),e._sineMultiply=new to({context:e.context}),e._cosineMultiply=new to({context:e.context}),e._negate=new ko({context:e.context}),e._add=new co({context:e.context}),e._phaseShifter=new Fs({context:e.context}),e.effectSend.connect(e._phaseShifter),e.frequency.fan(e._sine.frequency,e._cosine.frequency),e._phaseShifter.offset90.connect(e._cosineMultiply),e._cosine.connect(e._cosineMultiply.factor),e._phaseShifter.connect(e._sineMultiply),e._sine.connect(e._sineMultiply.factor),e._sineMultiply.connect(e._negate),e._cosineMultiply.connect(e._add),e._negate.connect(e._add.addend),e._add.connect(e.effectReturn);var a=e.immediate();return e._sine.start(a),e._cosine.start(a),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(gs.getDefaults(),{frequency:0})}}]),n}(gs),Ls=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],zs=[225,556,441,341],Bs=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["roomSize","dampening"]))).name="Freeverb",e._combFilters=[],e._allpassFiltersL=[],e._allpassFiltersR=[];var r=xa(n.getDefaults(),arguments,["roomSize","dampening"]);return e.roomSize=new ki({context:e.context,value:r.roomSize,units:"normalRange"}),e._allpassFiltersL=zs.map((function(t){var n=e.context.createBiquadFilter();return n.type="allpass",n.frequency.value=t,n})),e._allpassFiltersR=zs.map((function(t){var n=e.context.createBiquadFilter();return n.type="allpass",n.frequency.value=t,n})),e._combFilters=Ls.map((function(t,n){var a,i,o=new Jo({context:e.context,dampening:r.dampening,delayTime:t});return n<Ls.length/2?(a=e).connectEffectLeft.apply(a,[o].concat(_toConsumableArray(e._allpassFiltersL))):(i=e).connectEffectRight.apply(i,[o].concat(_toConsumableArray(e._allpassFiltersR))),e.roomSize.connect(o.resonance),o})),ja(_assertThisInitialized(e),["roomSize"]),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._allpassFiltersL.forEach((function(e){return e.disconnect()})),this._allpassFiltersR.forEach((function(e){return e.disconnect()})),this._combFilters.forEach((function(e){return e.dispose()})),this.roomSize.dispose(),this}},{key:"dampening",get:function(){return this._combFilters[0].dampening},set:function(e){this._combFilters.forEach((function(t){return t.dampening=e}))}}],[{key:"getDefaults",value:function(){return Object.assign(Is.getDefaults(),{roomSize:.7,dampening:3e3})}}]),n}(Is),js=[.06748,.06404,.08212,.09004],Vs=[.773,.802,.753,.733],qs=[347,113,37],Us=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["roomSize"]))).name="JCReverb",e._allpassFilters=[],e._feedbackCombFilters=[];var r=xa(n.getDefaults(),arguments,["roomSize"]);return e.roomSize=new ki({context:e.context,value:r.roomSize,units:"normalRange"}),e._scaleRoomSize=new lo({context:e.context,min:-.733,max:.197}),e._allpassFilters=qs.map((function(t){var n=e.context.createBiquadFilter();return n.type="allpass",n.frequency.value=t,n})),e._feedbackCombFilters=js.map((function(t,n){var r,a,i=new Yo({context:e.context,delayTime:t});return e._scaleRoomSize.connect(i.resonance),i.resonance.value=Vs[n],n<js.length/2?(r=e).connectEffectLeft.apply(r,_toConsumableArray(e._allpassFilters).concat([i])):(a=e).connectEffectRight.apply(a,_toConsumableArray(e._allpassFilters).concat([i])),i})),e.roomSize.connect(e._scaleRoomSize),ja(_assertThisInitialized(e),["roomSize"]),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._allpassFilters.forEach((function(e){return e.disconnect()})),this._feedbackCombFilters.forEach((function(e){return e.dispose()})),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Is.getDefaults(),{roomSize:.5})}}]),n}(Is),Ws=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e))._feedbackL.disconnect(),r._feedbackL.connect(r._feedbackMerge,0,1),r._feedbackR.disconnect(),r._feedbackR.connect(r._feedbackMerge,0,0),ja(_assertThisInitialized(r),["feedback"]),r}return n}(Rs),Gs=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["delayTime","feedback"]))).name="PingPongDelay";var r=xa(n.getDefaults(),arguments,["delayTime","feedback"]);return e._leftDelay=new Ai({context:e.context,maxDelay:r.maxDelay}),e._rightDelay=new Ai({context:e.context,maxDelay:r.maxDelay}),e._rightPreDelay=new Ai({context:e.context,maxDelay:r.maxDelay}),e.delayTime=new ki({context:e.context,units:"time",value:r.delayTime}),e.connectEffectLeft(e._leftDelay),e.connectEffectRight(e._rightPreDelay,e._rightDelay),e.delayTime.fan(e._leftDelay.delayTime,e._rightDelay.delayTime,e._rightPreDelay.delayTime),e._feedbackL.disconnect(),e._feedbackL.connect(e._rightDelay),ja(_assertThisInitialized(e),["delayTime"]),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Ws.getDefaults(),{delayTime:.25,maxDelay:1})}}]),n}(Ws),Hs=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["pitch"]))).name="PitchShift";var r=xa(n.getDefaults(),arguments,["pitch"]);e._frequency=new ki({context:e.context}),e._delayA=new Ai({maxDelay:1,context:e.context}),e._lfoA=new fo({context:e.context,min:0,max:.1,type:"sawtooth"}).connect(e._delayA.delayTime),e._delayB=new Ai({maxDelay:1,context:e.context}),e._lfoB=new fo({context:e.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(e._delayB.delayTime),e._crossFade=new vs({context:e.context}),e._crossFadeLFO=new fo({context:e.context,min:0,max:1,type:"triangle",phase:90}).connect(e._crossFade.fade),e._feedbackDelay=new Ai({delayTime:r.delayTime,context:e.context}),e.delayTime=e._feedbackDelay.delayTime,ja(_assertThisInitialized(e),"delayTime"),e._pitch=r.pitch,e._windowSize=r.windowSize,e._delayA.connect(e._crossFade.a),e._delayB.connect(e._crossFade.b),e._frequency.fan(e._lfoA.frequency,e._lfoB.frequency,e._crossFadeLFO.frequency),e.effectSend.fan(e._delayA,e._delayB),e._crossFade.chain(e._feedbackDelay,e.effectReturn);var a=e.now();return e._lfoA.start(a),e._lfoB.start(a),e._crossFadeLFO.start(a),e.windowSize=e._windowSize,e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}},{key:"pitch",get:function(){return this._pitch},set:function(e){this._pitch=e;var t=0;e<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,t=Ja(e-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,t=Ja(e)-1),this._frequency.value=t*(1.2/this._windowSize)}},{key:"windowSize",get:function(){return this._windowSize},set:function(e){this._windowSize=this.toSeconds(e),this.pitch=this._pitch}}],[{key:"getDefaults",value:function(){return Object.assign(Ds.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}}]),n}(Ds),Ks=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r,a;_classCallCheck2(this,n),(a=t.call(this,xa(n.getDefaults(),arguments,["frequency","octaves","baseFrequency"]))).name="Phaser";var i=xa(n.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);return a._lfoL=new fo({context:a.context,frequency:i.frequency,min:0,max:1}),a._lfoR=new fo({context:a.context,frequency:i.frequency,min:0,max:1,phase:180}),a._baseFrequency=a.toFrequency(i.baseFrequency),a._octaves=i.octaves,a.Q=new ki({context:a.context,value:i.Q,units:"positive"}),a._filtersL=a._makeFilters(i.stages,a._lfoL),a._filtersR=a._makeFilters(i.stages,a._lfoR),a.frequency=a._lfoL.frequency,a.frequency.value=i.frequency,(e=a).connectEffectLeft.apply(e,_toConsumableArray(a._filtersL)),(r=a).connectEffectRight.apply(r,_toConsumableArray(a._filtersR)),a._lfoL.frequency.connect(a._lfoR.frequency),a.baseFrequency=i.baseFrequency,a.octaves=i.octaves,a._lfoL.start(),a._lfoR.start(),ja(_assertThisInitialized(a),["frequency","Q"]),a}return _createClass2(n,[{key:"_makeFilters",value:function(e,t){for(var n=[],r=0;r<e;r++){var a=this.context.createBiquadFilter();a.type="allpass",this.Q.connect(a.Q),t.connect(a.frequency),n.push(a)}return n}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach((function(e){return e.disconnect()})),this._filtersR.forEach((function(e){return e.disconnect()})),this.frequency.dispose(),this}},{key:"octaves",get:function(){return this._octaves},set:function(e){this._octaves=e;var t=this._baseFrequency*Math.pow(2,e);this._lfoL.max=t,this._lfoR.max=t}},{key:"baseFrequency",get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=this.toFrequency(e),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}}],[{key:"getDefaults",value:function(){return Object.assign(Is.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}}]),n}(Is),Xs=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["decay"]))).name="Reverb",e._convolver=e.context.createConvolver(),e.ready=Promise.resolve();var r=xa(n.getDefaults(),arguments,["decay"]);return e._decay=r.decay,e._preDelay=r.preDelay,e.generate(),e.connectEffect(e._convolver),e}return _createClass2(n,[{key:"generate",value:function(){return pa(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.ready,n=new Wa(2,this._decay+this._preDelay,this.context.sampleRate),r=new Gi({context:n}),a=new Gi({context:n}),i=new Es({context:n}),r.connect(i,0,0),a.connect(i,0,1),o=new yi({context:n}).toDestination(),i.connect(o),r.start(0),a.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay),s=n.render(),this.ready=s.then(qa),e.next=8,t;case 8:return e.next=10,s;case 10:return this._convolver.buffer=e.sent.get(),e.abrupt("return",this);case 12:case"end":return e.stop()}}),e,this)})))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._convolver.disconnect(),this}},{key:"decay",get:function(){return this._decay},set:function(e){Yr(e=this.toSeconds(e),.001),this._decay=e,this.generate()}},{key:"preDelay",get:function(){return this._preDelay},set:function(e){Yr(e=this.toSeconds(e),0),this._preDelay=e,this.generate()}}],[{key:"getDefaults",value:function(){return Object.assign(gs.getDefaults(),{decay:1.5,preDelay:.01})}}]),n}(gs),Qs=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="MidSideSplit",e._split=e.input=new As({channels:2,context:e.context}),e._midAdd=new co({context:e.context}),e.mid=new to({context:e.context,value:Math.SQRT1_2}),e._sideSubtract=new wo({context:e.context}),e.side=new to({context:e.context,value:Math.SQRT1_2}),e._split.connect(e._midAdd,0),e._split.connect(e._midAdd.addend,1),e._split.connect(e._sideSubtract,0),e._split.connect(e._sideSubtract.subtrahend,1),e._midAdd.connect(e.mid),e._sideSubtract.connect(e.side),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}]),n}(pi),Ys=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="MidSideMerge",e.mid=new yi({context:e.context}),e.side=new yi({context:e.context}),e._left=new co({context:e.context}),e._leftMult=new to({context:e.context,value:Math.SQRT1_2}),e._right=new wo({context:e.context}),e._rightMult=new to({context:e.context,value:Math.SQRT1_2}),e._merge=e.output=new Es({context:e.context}),e.mid.fan(e._left),e.side.connect(e._left.addend),e.mid.connect(e._right),e.side.connect(e._right.subtrahend),e._left.connect(e._leftMult),e._right.connect(e._rightMult),e._leftMult.connect(e._merge,0,0),e._rightMult.connect(e._merge,0,1),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}]),n}(pi),Zs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).name="MidSideEffect",r._midSideMerge=new Ys({context:r.context}),r._midSideSplit=new Qs({context:r.context}),r._midSend=r._midSideSplit.mid,r._sideSend=r._midSideSplit.side,r._midReturn=r._midSideMerge.mid,r._sideReturn=r._midSideMerge.side,r.effectSend.connect(r._midSideSplit),r._midSideMerge.connect(r.effectReturn),r}return _createClass2(n,[{key:"connectEffectMid",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this._midSend).chain.apply(e,n.concat([this._midReturn]))}},{key:"connectEffectSide",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this._sideSend).chain.apply(e,n.concat([this._sideReturn]))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}]),n}(gs),Js=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["width"]))).name="StereoWidener";var r=xa(n.getDefaults(),arguments,["width"]);return e.width=new ki({context:e.context,value:r.width,units:"normalRange"}),ja(_assertThisInitialized(e),["width"]),e._twoTimesWidthMid=new to({context:e.context,value:2}),e._twoTimesWidthSide=new to({context:e.context,value:2}),e._midMult=new to({context:e.context}),e._twoTimesWidthMid.connect(e._midMult.factor),e.connectEffectMid(e._midMult),e._oneMinusWidth=new wo({context:e.context}),e._oneMinusWidth.connect(e._twoTimesWidthMid),vi(e.context.getConstant(1),e._oneMinusWidth),e.width.connect(e._oneMinusWidth.subtrahend),e._sideMult=new to({context:e.context}),e.width.connect(e._twoTimesWidthSide),e._twoTimesWidthSide.connect(e._sideMult.factor),e.connectEffectSide(e._sideMult),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Zs.getDefaults(),{width:.5})}}]),n}(Zs),$s=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","depth"]))).name="Tremolo";var r=xa(n.getDefaults(),arguments,["frequency","depth"]);return e._lfoL=new fo({context:e.context,type:r.type,min:1,max:0}),e._lfoR=new fo({context:e.context,type:r.type,min:1,max:0}),e._amplitudeL=new yi({context:e.context}),e._amplitudeR=new yi({context:e.context}),e.frequency=new ki({context:e.context,value:r.frequency,units:"frequency"}),e.depth=new ki({context:e.context,value:r.depth,units:"normalRange"}),ja(_assertThisInitialized(e),["frequency","depth"]),e.connectEffectLeft(e._amplitudeL),e.connectEffectRight(e._amplitudeR),e._lfoL.connect(e._amplitudeL.gain),e._lfoR.connect(e._amplitudeR.gain),e.frequency.fan(e._lfoL.frequency,e._lfoR.frequency),e.depth.fan(e._lfoR.amplitude,e._lfoL.amplitude),e.spread=r.spread,e}return _createClass2(n,[{key:"start",value:function(e){return this._lfoL.start(e),this._lfoR.start(e),this}},{key:"stop",value:function(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}},{key:"sync",value:function(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}},{key:"unsync",value:function(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}},{key:"type",get:function(){return this._lfoL.type},set:function(e){this._lfoL.type=e,this._lfoR.type=e}},{key:"spread",get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}}],[{key:"getDefaults",value:function(){return Object.assign(Is.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}}]),n}(Is),eu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["frequency","depth"]))).name="Vibrato";var r=xa(n.getDefaults(),arguments,["frequency","depth"]);return e._delayNode=new Ai({context:e.context,delayTime:0,maxDelay:r.maxDelay}),e._lfo=new fo({context:e.context,type:r.type,min:0,max:r.maxDelay,frequency:r.frequency,phase:-90}).start().connect(e._delayNode.delayTime),e.frequency=e._lfo.frequency,e.depth=e._lfo.amplitude,e.depth.value=r.depth,ja(_assertThisInitialized(e),["frequency","depth"]),e.effectSend.chain(e._delayNode,e.effectReturn),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}},{key:"type",get:function(){return this._lfo.type},set:function(e){this._lfo.type=e}}],[{key:"getDefaults",value:function(){return Object.assign(gs.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}}]),n}(gs),tu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["type","size"]))).name="Analyser",e._analysers=[],e._buffers=[];var r=xa(n.getDefaults(),arguments,["type","size"]);e.input=e.output=e._gain=new yi({context:e.context}),e._split=new As({context:e.context,channels:r.channels}),e.input.connect(e._split),Yr(r.channels,1);for(var a=0;a<r.channels;a++)e._analysers[a]=e.context.createAnalyser(),e._split.connect(e._analysers[a],a,0);return e.size=r.size,e.type=r.type,e}return _createClass2(n,[{key:"getValue",value:function(){var e=this;return this._analysers.forEach((function(t,n){var r=e._buffers[n];"fft"===e._type?t.getFloatFrequencyData(r):"waveform"===e._type&&t.getFloatTimeDomainData(r)})),1===this.channels?this._buffers[0]:this._buffers}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._analysers.forEach((function(e){return e.disconnect()})),this._split.dispose(),this._gain.dispose(),this}},{key:"size",get:function(){return this._analysers[0].frequencyBinCount},set:function(e){var t=this;this._analysers.forEach((function(n,r){n.fftSize=2*e,t._buffers[r]=new Float32Array(e)}))}},{key:"channels",get:function(){return this._analysers.length}},{key:"type",get:function(){return this._type},set:function(e){Qr("waveform"===e||"fft"===e,"Analyser: invalid type: "+e),this._type=e}},{key:"smoothing",get:function(){return this._analysers[0].smoothingTimeConstant},set:function(e){this._analysers.forEach((function(t){return t.smoothingTimeConstant=e}))}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}}]),n}(pi),nu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="MeterBase",e.input=e.output=e._analyser=new tu({context:e.context,size:256,type:"waveform"}),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._analyser.dispose(),this}}]),n}(pi),ru=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["smoothing"]))).name="Meter",e._rms=0;var r=xa(n.getDefaults(),arguments,["smoothing"]);return e.input=e.output=e._analyser=new tu({context:e.context,size:256,type:"waveform",channels:r.channels}),e.smoothing=r.smoothing,e.normalRange=r.normalRange,e}return _createClass2(n,[{key:"getLevel",value:function(){return ta("'getLevel' has been changed to 'getValue'"),this.getValue()}},{key:"getValue",value:function(){var e=this,t=this._analyser.getValue(),n=(1===this.channels?[t]:t).map((function(t){var n=t.reduce((function(e,t){return e+t*t}),0),r=Math.sqrt(n/t.length);return e._rms=Math.max(r,e._rms*e.smoothing),e.normalRange?e._rms:Za(e._rms)}));return 1===this.channels?n[0]:n}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._analyser.dispose(),this}},{key:"channels",get:function(){return this._analyser.channels}}],[{key:"getDefaults",value:function(){return Object.assign(nu.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}}]),n}(nu),au=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["size"]))).name="FFT";var r=xa(n.getDefaults(),arguments,["size"]);return e.normalRange=r.normalRange,e._analyser.type="fft",e.size=r.size,e}return _createClass2(n,[{key:"getValue",value:function(){var e=this;return this._analyser.getValue().map((function(t){return e.normalRange?Ya(t):t}))}},{key:"getFrequencyOfIndex",value:function(e){return Qr(0<=e&&e<this.size,"index must be greater than or equal to 0 and less than "+this.size),e*this.context.sampleRate/(2*this.size)}},{key:"size",get:function(){return this._analyser.size},set:function(e){this._analyser.size=e}},{key:"smoothing",get:function(){return this._analyser.smoothing},set:function(e){this._analyser.smoothing=e}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}}]),n}(nu),iu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="DCMeter",e._analyser.type="waveform",e._analyser.size=256,e}return _createClass2(n,[{key:"getValue",value:function(){return this._analyser.getValue()[0]}}]),n}(nu),ou=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["size"]))).name="Waveform";var r=xa(n.getDefaults(),arguments,["size"]);return e._analyser.type="waveform",e.size=r.size,e}return _createClass2(n,[{key:"getValue",value:function(){return this._analyser.getValue()}},{key:"size",get:function(){return this._analyser.size},set:function(e){this._analyser.size=e}}],[{key:"getDefaults",value:function(){return Object.assign(nu.getDefaults(),{size:1024})}}]),n}(nu),su=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["solo"]))).name="Solo";var r=xa(n.getDefaults(),arguments,["solo"]);return e.input=e.output=new yi({context:e.context}),n._allSolos.has(e.context)||n._allSolos.set(e.context,new Set),n._allSolos.get(e.context).add(_assertThisInitialized(e)),e.solo=r.solo,e}return _createClass2(n,[{key:"_addSolo",value:function(){n._soloed.has(this.context)||n._soloed.set(this.context,new Set),n._soloed.get(this.context).add(this)}},{key:"_removeSolo",value:function(){n._soloed.has(this.context)&&n._soloed.get(this.context).delete(this)}},{key:"_isSoloed",value:function(){return n._soloed.has(this.context)&&n._soloed.get(this.context).has(this)}},{key:"_noSolos",value:function(){return!n._soloed.has(this.context)||n._soloed.has(this.context)&&0===n._soloed.get(this.context).size}},{key:"_updateSolo",value:function(){this.input.gain.value=this._isSoloed()||this._noSolos()?1:0}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),n._allSolos.get(this.context).delete(this),this._removeSolo(),this}},{key:"solo",get:function(){return this._isSoloed()},set:function(e){e?this._addSolo():this._removeSolo(),n._allSolos.get(this.context).forEach((function(e){return e._updateSolo()}))}},{key:"muted",get:function(){return 0===this.input.gain.value}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{solo:!1})}}]),n}(pi);su._allSolos=new Map,su._soloed=new Map;var uu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["pan","volume"]))).name="PanVol";var r=xa(n.getDefaults(),arguments,["pan","volume"]);return e._panner=e.input=new bs({context:e.context,pan:r.pan,channelCount:r.channelCount}),e.pan=e._panner.pan,e._volume=e.output=new Li({context:e.context,volume:r.volume}),e.volume=e._volume.volume,e._panner.connect(e._volume),e.mute=r.mute,ja(_assertThisInitialized(e),["pan","volume"]),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}},{key:"mute",get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}}]),n}(pi),cu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["volume","pan"]))).name="Channel";var r=xa(n.getDefaults(),arguments,["volume","pan"]);return e._solo=e.input=new su({solo:r.solo,context:e.context}),e._panVol=e.output=new uu({context:e.context,pan:r.pan,volume:r.volume,mute:r.mute,channelCount:r.channelCount}),e.pan=e._panVol.pan,e.volume=e._panVol.volume,e._solo.connect(e._panVol),ja(_assertThisInitialized(e),["pan","volume"]),e}return _createClass2(n,[{key:"_getBus",value:function(e){return n.buses.has(e)||n.buses.set(e,new yi({context:this.context})),n.buses.get(e)}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._getBus(e),r=new yi({context:this.context,units:"decibels",gain:t});return this.connect(r),r.connect(n),r}},{key:"receive",value:function(e){return this._getBus(e).connect(this),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}},{key:"solo",get:function(){return this._solo.solo},set:function(e){this._solo.solo=e}},{key:"muted",get:function(){return this._solo.muted||this.mute}},{key:"mute",get:function(){return this._panVol.mute},set:function(e){this._panVol.mute=e}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}}]),n}(pi);cu.buses=new Map;var lu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["lowFrequency","highFrequency"]))).name="MultibandSplit",e.input=new yi({context:e.context}),e.output=void 0,e.low=new Lo({context:e.context,frequency:0,type:"lowpass"}),e._lowMidFilter=new Lo({context:e.context,frequency:0,type:"highpass"}),e.mid=new Lo({context:e.context,frequency:0,type:"lowpass"}),e.high=new Lo({context:e.context,frequency:0,type:"highpass"}),e._internalChannels=[e.low,e.mid,e.high];var r=xa(n.getDefaults(),arguments,["lowFrequency","highFrequency"]);return e.lowFrequency=new ki({context:e.context,units:"frequency",value:r.lowFrequency}),e.highFrequency=new ki({context:e.context,units:"frequency",value:r.highFrequency}),e.Q=new ki({context:e.context,units:"positive",value:r.Q}),e.input.fan(e.low,e.high),e.input.chain(e._lowMidFilter,e.mid),e.lowFrequency.fan(e.low.frequency,e._lowMidFilter.frequency),e.highFrequency.fan(e.mid.frequency,e.high.frequency),e.Q.connect(e.low.Q),e.Q.connect(e._lowMidFilter.Q),e.Q.connect(e.mid.Q),e.Q.connect(e.high.Q),ja(_assertThisInitialized(e),["high","mid","low","highFrequency","lowFrequency"]),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),Va(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}}]),n}(pi),hu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).name="Listener",e.positionX=new di({context:e.context,param:e.context.rawContext.listener.positionX}),e.positionY=new di({context:e.context,param:e.context.rawContext.listener.positionY}),e.positionZ=new di({context:e.context,param:e.context.rawContext.listener.positionZ}),e.forwardX=new di({context:e.context,param:e.context.rawContext.listener.forwardX}),e.forwardY=new di({context:e.context,param:e.context.rawContext.listener.forwardY}),e.forwardZ=new di({context:e.context,param:e.context.rawContext.listener.forwardZ}),e.upX=new di({context:e.context,param:e.context.rawContext.listener.upX}),e.upY=new di({context:e.context,param:e.context.rawContext.listener.upY}),e.upZ=new di({context:e.context,param:e.context.rawContext.listener.upZ}),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}}]),n}(pi);Pa((function(e){e.listener=new hu({context:e})})),Ma((function(e){e.listener.dispose()}));var fu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["positionX","positionY","positionZ"]))).name="Panner3D";var r=xa(n.getDefaults(),arguments,["positionX","positionY","positionZ"]);return e._panner=e.input=e.output=e.context.createPanner(),e.panningModel=r.panningModel,e.maxDistance=r.maxDistance,e.distanceModel=r.distanceModel,e.coneOuterGain=r.coneOuterGain,e.coneOuterAngle=r.coneOuterAngle,e.coneInnerAngle=r.coneInnerAngle,e.refDistance=r.refDistance,e.rolloffFactor=r.rolloffFactor,e.positionX=new di({context:e.context,param:e._panner.positionX,value:r.positionX}),e.positionY=new di({context:e.context,param:e._panner.positionY,value:r.positionY}),e.positionZ=new di({context:e.context,param:e._panner.positionZ,value:r.positionZ}),e.orientationX=new di({context:e.context,param:e._panner.orientationX,value:r.orientationX}),e.orientationY=new di({context:e.context,param:e._panner.orientationY,value:r.orientationY}),e.orientationZ=new di({context:e.context,param:e._panner.orientationZ,value:r.orientationZ}),e}return _createClass2(n,[{key:"setPosition",value:function(e,t,n){return this.positionX.value=e,this.positionY.value=t,this.positionZ.value=n,this}},{key:"setOrientation",value:function(e,t,n){return this.orientationX.value=e,this.orientationY.value=t,this.orientationZ.value=n,this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}},{key:"panningModel",get:function(){return this._panner.panningModel},set:function(e){this._panner.panningModel=e}},{key:"refDistance",get:function(){return this._panner.refDistance},set:function(e){this._panner.refDistance=e}},{key:"rolloffFactor",get:function(){return this._panner.rolloffFactor},set:function(e){this._panner.rolloffFactor=e}},{key:"distanceModel",get:function(){return this._panner.distanceModel},set:function(e){this._panner.distanceModel=e}},{key:"coneInnerAngle",get:function(){return this._panner.coneInnerAngle},set:function(e){this._panner.coneInnerAngle=e}},{key:"coneOuterAngle",get:function(){return this._panner.coneOuterAngle},set:function(e){this._panner.coneOuterAngle=e}},{key:"coneOuterGain",get:function(){return this._panner.coneOuterGain},set:function(e){this._panner.coneOuterGain=e}},{key:"maxDistance",get:function(){return this._panner.maxDistance},set:function(e){this._panner.maxDistance=e}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}}]),n}(pi),du=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments))).name="Recorder";var r=xa(n.getDefaults(),arguments);return e.input=new yi({context:e.context}),Qr(n.supported,"Media Recorder API is not available"),e._stream=e.context.createMediaStreamDestination(),e.input.connect(e._stream),e._recorder=new MediaRecorder(e._stream.stream,{mimeType:r.mimeType}),e}return _createClass2(n,[{key:"start",value:function(){return pa(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Qr("started"!==this.state,"Recorder is already started"),t=new Promise((function(e){n._recorder.addEventListener("start",(function t(){n._recorder.removeEventListener("start",t,!1),e()}),!1)})),this._recorder.start(),e.next=5,t;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"stop",value:function(){return pa(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Qr("stopped"!==this.state,"Recorder is not started"),t=new Promise((function(e){n._recorder.addEventListener("dataavailable",(function t(r){n._recorder.removeEventListener("dataavailable",t,!1),e(r.data)}),!1)})),this._recorder.stop(),e.next=5,t;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"pause",value:function(){return Qr("started"===this.state,"Recorder must be started"),this._recorder.pause(),this}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.input.dispose(),this._stream.disconnect(),this}},{key:"mimeType",get:function(){return this._recorder.mimeType}},{key:"state",get:function(){return"inactive"===this._recorder.state?"stopped":"paused"===this._recorder.state?"paused":"started"}}],[{key:"getDefaults",value:function(){return pi.getDefaults()}},{key:"supported",get:function(){return null!==ha&&Reflect.has(ha,"MediaRecorder")}}]),n}(pi),pu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["threshold","ratio"]))).name="Compressor",e._compressor=e.context.createDynamicsCompressor(),e.input=e._compressor,e.output=e._compressor;var r=xa(n.getDefaults(),arguments,["threshold","ratio"]);return e.threshold=new di({minValue:e._compressor.threshold.minValue,maxValue:e._compressor.threshold.maxValue,context:e.context,convert:!1,param:e._compressor.threshold,units:"decibels",value:r.threshold}),e.attack=new di({minValue:e._compressor.attack.minValue,maxValue:e._compressor.attack.maxValue,context:e.context,param:e._compressor.attack,units:"time",value:r.attack}),e.release=new di({minValue:e._compressor.release.minValue,maxValue:e._compressor.release.maxValue,context:e.context,param:e._compressor.release,units:"time",value:r.release}),e.knee=new di({minValue:e._compressor.knee.minValue,maxValue:e._compressor.knee.maxValue,context:e.context,convert:!1,param:e._compressor.knee,units:"decibels",value:r.knee}),e.ratio=new di({minValue:e._compressor.ratio.minValue,maxValue:e._compressor.ratio.maxValue,context:e.context,convert:!1,param:e._compressor.ratio,units:"positive",value:r.ratio}),ja(_assertThisInitialized(e),["knee","release","attack","ratio","threshold"]),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}},{key:"reduction",get:function(){return this._compressor.reduction}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}}]),n}(pi),mu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments,["threshold","smoothing"])))).name="Gate";var r=xa(n.getDefaults(),arguments,["threshold","smoothing"]);return e._follower=new ws({context:e.context,smoothing:r.smoothing}),e._gt=new Co({context:e.context,value:Ya(r.threshold)}),e.input=new yi({context:e.context}),e._gate=e.output=new yi({context:e.context}),e.input.connect(e._gate),e.input.chain(e._follower,e._gt,e._gate.gain),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}},{key:"threshold",get:function(){return Za(this._gt.value)},set:function(e){this._gt.value=Ya(e)}},{key:"smoothing",get:function(){return this._follower.smoothing},set:function(e){this._follower.smoothing=e}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{smoothing:.1,threshold:-40})}}]),n}(pi),vu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments,["threshold"])))).name="Limiter";var r=xa(n.getDefaults(),arguments,["threshold"]);return e._compressor=e.input=e.output=new pu({context:e.context,ratio:20,attack:0,release:0,threshold:r.threshold}),e.threshold=e._compressor.threshold,ja(_assertThisInitialized(e),"threshold"),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._compressor.dispose(),this.threshold.dispose(),this}},{key:"reduction",get:function(){return this._compressor.reduction}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{threshold:-12})}}]),n}(pi),gu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments)))).name="MidSideCompressor";var r=xa(n.getDefaults(),arguments);return e._midSideSplit=e.input=new Qs({context:e.context}),e._midSideMerge=e.output=new Ys({context:e.context}),e.mid=new pu(Object.assign(r.mid,{context:e.context})),e.side=new pu(Object.assign(r.side,{context:e.context})),e._midSideSplit.mid.chain(e.mid,e._midSideMerge.mid),e._midSideSplit.side.chain(e.side,e._midSideMerge.side),ja(_assertThisInitialized(e),["mid","side"]),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}}]),n}(pi),yu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,Object.assign(xa(n.getDefaults(),arguments)))).name="MultibandCompressor";var r=xa(n.getDefaults(),arguments);return e._splitter=e.input=new lu({context:e.context,lowFrequency:r.lowFrequency,highFrequency:r.highFrequency}),e.lowFrequency=e._splitter.lowFrequency,e.highFrequency=e._splitter.highFrequency,e.output=new yi({context:e.context}),e.low=new pu(Object.assign(r.low,{context:e.context})),e.mid=new pu(Object.assign(r.mid,{context:e.context})),e.high=new pu(Object.assign(r.high,{context:e.context})),e._splitter.low.chain(e.low,e.output),e._splitter.mid.chain(e.mid,e.output),e._splitter.high.chain(e.high,e.output),ja(_assertThisInitialized(e),["high","mid","low","highFrequency","lowFrequency"]),e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}}]),n}(pi),_u=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["low","mid","high"]))).name="EQ3",e.output=new yi({context:e.context}),e._internalChannels=[];var r=xa(n.getDefaults(),arguments,["low","mid","high"]);return e.input=e._multibandSplit=new lu({context:e.context,highFrequency:r.highFrequency,lowFrequency:r.lowFrequency}),e._lowGain=new yi({context:e.context,gain:r.low,units:"decibels"}),e._midGain=new yi({context:e.context,gain:r.mid,units:"decibels"}),e._highGain=new yi({context:e.context,gain:r.high,units:"decibels"}),e.low=e._lowGain.gain,e.mid=e._midGain.gain,e.high=e._highGain.gain,e.Q=e._multibandSplit.Q,e.lowFrequency=e._multibandSplit.lowFrequency,e.highFrequency=e._multibandSplit.highFrequency,e._multibandSplit.low.chain(e._lowGain,e.output),e._multibandSplit.mid.chain(e._midGain,e.output),e._multibandSplit.high.chain(e._highGain,e.output),ja(_assertThisInitialized(e),["low","mid","high","lowFrequency","highFrequency"]),e._internalChannels=[e._multibandSplit],e}return _createClass2(n,[{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),Va(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}}]),n}(pi),bu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this,xa(n.getDefaults(),arguments,["url","onload"]))).name="Convolver",e._convolver=e.context.createConvolver();var r=xa(n.getDefaults(),arguments,["url","onload"]);return e._buffer=new Ua(r.url,(function(t){e.buffer=t,r.onload()})),e.input=new yi({context:e.context}),e.output=new yi({context:e.context}),e._buffer.loaded&&(e.buffer=e._buffer),e.normalize=r.normalize,e.input.chain(e._convolver,e.output),e}return _createClass2(n,[{key:"load",value:function(e){return pa(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._buffer.load(e);case 2:this.buffer=t.sent;case 3:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._buffer.dispose(),this._convolver.disconnect(),this}},{key:"buffer",get:function(){return this._buffer.length?this._buffer:null},set:function(e){e&&this._buffer.set(e),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));var t=this._buffer.get();this._convolver.buffer=t||null}},{key:"normalize",get:function(){return this._convolver.normalize},set:function(e){this._convolver.normalize=e}}],[{key:"getDefaults",value:function(){return Object.assign(pi.getDefaults(),{normalize:!0,onload:qa})}}]),n}(pi);function ku(){return Ka().now()}function wu(){return Ka().immediate()}n.d(t,"now",(function(){return ku})),n.d(t,"immediate",(function(){return wu})),n.d(t,"Transport",(function(){return xu})),n.d(t,"getTransport",(function(){return Cu})),n.d(t,"Destination",(function(){return Su})),n.d(t,"Master",(function(){return Tu})),n.d(t,"getDestination",(function(){return Au})),n.d(t,"Listener",(function(){return Eu})),n.d(t,"getListener",(function(){return Iu})),n.d(t,"Draw",(function(){return Ru})),n.d(t,"getDraw",(function(){return Ou})),n.d(t,"context",(function(){return Nu})),n.d(t,"loaded",(function(){return Du})),n.d(t,"Buffer",(function(){return Pu})),n.d(t,"Buffers",(function(){return Fu})),n.d(t,"BufferSource",(function(){return Mu})),n.d(t,"getContext",(function(){return Ka})),n.d(t,"setContext",(function(){return Xa})),n.d(t,"ToneAudioBuffer",(function(){return Ua})),n.d(t,"ToneAudioBuffers",(function(){return Ii})),n.d(t,"dbToGain",(function(){return Ya})),n.d(t,"gainToDb",(function(){return Za})),n.d(t,"intervalToFrequencyRatio",(function(){return Ja})),n.d(t,"ftom",(function(){return ei})),n.d(t,"mtof",(function(){return ni})),n.d(t,"optionsFromArguments",(function(){return xa})),n.d(t,"defaultArg",(function(){return Ca})),n.d(t,"Unit",(function(){return f})),n.d(t,"debug",(function(){return h})),n.d(t,"ToneBufferSource",(function(){return Wi})),n.d(t,"Clock",(function(){return Ti})),n.d(t,"Context",(function(){return Ba})),n.d(t,"BaseContext",(function(){return za})),n.d(t,"Delay",(function(){return Ai})),n.d(t,"Gain",(function(){return yi})),n.d(t,"Offline",(function(){return Ei})),n.d(t,"OfflineContext",(function(){return Wa})),n.d(t,"Param",(function(){return di})),n.d(t,"ToneAudioNode",(function(){return pi})),n.d(t,"connectSeries",(function(){return mi})),n.d(t,"connect",(function(){return vi})),n.d(t,"disconnect",(function(){return gi})),n.d(t,"FrequencyClass",(function(){return ii})),n.d(t,"Frequency",(function(){return ui})),n.d(t,"MidiClass",(function(){return Ri})),n.d(t,"Midi",(function(){return Oi})),n.d(t,"TimeClass",(function(){return ri})),n.d(t,"Time",(function(){return ai})),n.d(t,"TicksClass",(function(){return Ni})),n.d(t,"Ticks",(function(){return Di})),n.d(t,"TransportTimeClass",(function(){return ci})),n.d(t,"TransportTime",(function(){return li})),n.d(t,"Emitter",(function(){return La})),n.d(t,"IntervalTimeline",(function(){return Fi})),n.d(t,"StateTimeline",(function(){return fi})),n.d(t,"Timeline",(function(){return Na})),n.d(t,"isUndef",(function(){return na})),n.d(t,"isDefined",(function(){return ra})),n.d(t,"isFunction",(function(){return aa})),n.d(t,"isNumber",(function(){return ia})),n.d(t,"isObject",(function(){return oa})),n.d(t,"isBoolean",(function(){return sa})),n.d(t,"isArray",(function(){return ua})),n.d(t,"isString",(function(){return ca})),n.d(t,"isNote",(function(){return la})),n.d(t,"Noise",(function(){return Gi})),n.d(t,"UserMedia",(function(){return Xi})),n.d(t,"Oscillator",(function(){return Zi})),n.d(t,"AMOscillator",(function(){return no})),n.d(t,"FMOscillator",(function(){return ro})),n.d(t,"PulseOscillator",(function(){return ao})),n.d(t,"FatOscillator",(function(){return io})),n.d(t,"PWMOscillator",(function(){return oo})),n.d(t,"OmniOscillator",(function(){return uo})),n.d(t,"ToneOscillatorNode",(function(){return Yi})),n.d(t,"LFO",(function(){return fo})),n.d(t,"Player",(function(){return vo})),n.d(t,"Players",(function(){return go})),n.d(t,"GrainPlayer",(function(){return yo})),n.d(t,"Add",(function(){return co})),n.d(t,"Abs",(function(){return _o})),n.d(t,"AudioToGain",(function(){return eo})),n.d(t,"GainToAudio",(function(){return bo})),n.d(t,"GreaterThan",(function(){return Co})),n.d(t,"GreaterThanZero",(function(){return xo})),n.d(t,"Multiply",(function(){return to})),n.d(t,"Negate",(function(){return ko})),n.d(t,"Pow",(function(){return So})),n.d(t,"Signal",(function(){return ki})),n.d(t,"connectSignal",(function(){return wi})),n.d(t,"Scale",(function(){return lo})),n.d(t,"ScaleExp",(function(){return To})),n.d(t,"Subtract",(function(){return wo})),n.d(t,"SyncedSignal",(function(){return Ao})),n.d(t,"WaveShaper",(function(){return $i})),n.d(t,"Zero",(function(){return ho})),n.d(t,"AMSynth",(function(){return Fo})),n.d(t,"DuoSynth",(function(){return jo})),n.d(t,"FMSynth",(function(){return Vo})),n.d(t,"MetalSynth",(function(){return Uo})),n.d(t,"MembraneSynth",(function(){return Wo})),n.d(t,"MonoSynth",(function(){return Bo})),n.d(t,"NoiseSynth",(function(){return Go})),n.d(t,"PluckSynth",(function(){return $o})),n.d(t,"PolySynth",(function(){return es})),n.d(t,"Sampler",(function(){return ts})),n.d(t,"Synth",(function(){return Do})),n.d(t,"Loop",(function(){return rs})),n.d(t,"Part",(function(){return as})),n.d(t,"Pattern",(function(){return ps})),n.d(t,"Sequence",(function(){return ms})),n.d(t,"ToneEvent",(function(){return ns})),n.d(t,"AutoFilter",(function(){return _s})),n.d(t,"AutoPanner",(function(){return ks})),n.d(t,"AutoWah",(function(){return xs})),n.d(t,"BitCrusher",(function(){return Cs})),n.d(t,"Chebyshev",(function(){return Ts})),n.d(t,"Chorus",(function(){return Os})),n.d(t,"Distortion",(function(){return Ns})),n.d(t,"FeedbackDelay",(function(){return Ps})),n.d(t,"FrequencyShifter",(function(){return Ms})),n.d(t,"Freeverb",(function(){return Bs})),n.d(t,"JCReverb",(function(){return Us})),n.d(t,"PingPongDelay",(function(){return Gs})),n.d(t,"PitchShift",(function(){return Hs})),n.d(t,"Phaser",(function(){return Ks})),n.d(t,"Reverb",(function(){return Xs})),n.d(t,"StereoWidener",(function(){return Js})),n.d(t,"Tremolo",(function(){return $s})),n.d(t,"Vibrato",(function(){return eu})),n.d(t,"Analyser",(function(){return tu})),n.d(t,"Meter",(function(){return ru})),n.d(t,"FFT",(function(){return au})),n.d(t,"DCMeter",(function(){return iu})),n.d(t,"Waveform",(function(){return ou})),n.d(t,"Follower",(function(){return ws})),n.d(t,"Channel",(function(){return cu})),n.d(t,"CrossFade",(function(){return vs})),n.d(t,"Merge",(function(){return Es})),n.d(t,"MidSideMerge",(function(){return Ys})),n.d(t,"MidSideSplit",(function(){return Qs})),n.d(t,"MultibandSplit",(function(){return lu})),n.d(t,"Panner",(function(){return bs})),n.d(t,"Panner3D",(function(){return fu})),n.d(t,"PanVol",(function(){return uu})),n.d(t,"Recorder",(function(){return du})),n.d(t,"Solo",(function(){return su})),n.d(t,"Split",(function(){return As})),n.d(t,"Volume",(function(){return Li})),n.d(t,"Compressor",(function(){return pu})),n.d(t,"Gate",(function(){return mu})),n.d(t,"Limiter",(function(){return vu})),n.d(t,"MidSideCompressor",(function(){return gu})),n.d(t,"MultibandCompressor",(function(){return yu})),n.d(t,"AmplitudeEnvelope",(function(){return No})),n.d(t,"Envelope",(function(){return Eo})),n.d(t,"FrequencyEnvelope",(function(){return zo})),n.d(t,"EQ3",(function(){return _u})),n.d(t,"Filter",(function(){return Lo})),n.d(t,"OnePoleFilter",(function(){return Zo})),n.d(t,"FeedbackCombFilter",(function(){return Yo})),n.d(t,"LowpassCombFilter",(function(){return Jo})),n.d(t,"Convolver",(function(){return bu})),n.d(t,"BiquadFilter",(function(){return Mo})),n.d(t,"version",(function(){return"14.7.58"})),n.d(t,"start",(function(){return Qa})),n.d(t,"supported",(function(){return Xr}));var xu=Ka().transport;function Cu(){return Ka().transport}var Su=Ka().destination,Tu=Ka().destination;function Au(){return Ka().destination}var Eu=Ka().listener;function Iu(){return Ka().listener}var Ru=Ka().draw;function Ou(){return Ka().draw}var Nu=Ka();function Du(){return Ua.loaded()}var Pu=Ua,Fu=Ii,Mu=Wi},YSVl:function(e,t,n){var r=n("EhIR"),a=n("uDiL"),i=n("pJ6O"),o=n("yuCN"),s=n("euyF"),u=n("ie1u"),c=n("pJ3+");c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},YuTi:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},euyF:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n=a[i]=(n^=n>>>15)^(e^=e>>>12),t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(a=0==(n=s[127&i]^=r+(o=o+1640531527|0))?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,s[a]=(r^=r>>>15)^(n^=n>>>12);e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},g1Bg:function g1Bg(module,exports,__webpack_require__){var e;self,e=function e(__WEBPACK_EXTERNAL_MODULE__2__,__WEBPACK_EXTERNAL_MODULE__10__){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,(function(t){return e[t]}).bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=190)}([function(e,t,n){"use strict";n.d(t,"T",(function(){return H.b})),n.d(t,"Fb",(function(){return Me.a})),n.d(t,"Kb",(function(){return Me.b})),n.d(t,"W",(function(){return ze})),n.d(t,"Y",(function(){return Ve})),n.d(t,"Z",(function(){return K})),n.d(t,"ab",(function(){return Z})),n.d(t,"bb",(function(){return Ge})),n.d(t,"cb",(function(){return it})),n.d(t,"db",(function(){return mt})),n.d(t,"eb",(function(){return vt})),n.d(t,"hb",(function(){return yt})),n.d(t,"mb",(function(){return _t})),n.d(t,"nb",(function(){return bt})),n.d(t,"ob",(function(){return kt})),n.d(t,"pb",(function(){return wt})),n.d(t,"rb",(function(){return xt})),n.d(t,"sb",(function(){return Ct})),n.d(t,"tb",(function(){return At})),n.d(t,"ub",(function(){return Nt})),n.d(t,"xb",(function(){return Be})),n.d(t,"yb",(function(){return Dt})),n.d(t,"zb",(function(){return Pt})),n.d(t,"Bb",(function(){return Ft})),n.d(t,"Cb",(function(){return Lt})),n.d(t,"Db",(function(){return zt})),n.d(t,"Eb",(function(){return Bt})),n.d(t,"Gb",(function(){return We.a})),n.d(t,"Ib",(function(){return jt})),n.d(t,"Mb",(function(){return Gt})),n.d(t,"Nb",(function(){return Ot})),n.d(t,"Ob",(function(){return Ht})),n.d(t,"Jb",(function(){return pt})),n.d(t,"ib",(function(){return Nn})),n.d(t,"Hb",(function(){return Dn})),n.d(t,"gb",(function(){return Pn})),n.d(t,"vb",(function(){return Fn})),n.d(t,"wb",(function(){return $n.e})),n.d(t,"jb",(function(){return c.b})),n.d(t,"qb",(function(){return er.a})),n.d(t,"kb",(function(){return r})),n.d(t,"Lb",(function(){return Fe})),n.d(t,"X",(function(){return o})),n.d(t,"Ab",(function(){return a})),n.d(t,"fb",(function(){return Gr})),n.d(t,"lb",(function(){return s})),n.d(t,"w",(function(){return Yr.b})),n.d(t,"k",(function(){return Yr.a})),n.d(t,"a",(function(){return X.a})),n.d(t,"b",(function(){return X.d})),n.d(t,"c",(function(){return X.m})),n.d(t,"d",(function(){return X.o})),n.d(t,"e",(function(){return X.r})),n.d(t,"f",(function(){return X.v})),n.d(t,"g",(function(){return X.w})),n.d(t,"h",(function(){return X.y})),n.d(t,"i",(function(){return X.z})),n.d(t,"j",(function(){return X.G})),n.d(t,"l",(function(){return X.R})),n.d(t,"m",(function(){return X.W})),n.d(t,"n",(function(){return X.X})),n.d(t,"o",(function(){return X.Y})),n.d(t,"p",(function(){return X.ab})),n.d(t,"q",(function(){return X.bb})),n.d(t,"s",(function(){return X.eb})),n.d(t,"u",(function(){return X.jb})),n.d(t,"t",(function(){return X.ib})),n.d(t,"v",(function(){return X.kb})),n.d(t,"x",(function(){return X.sb})),n.d(t,"y",(function(){return X.yb})),n.d(t,"z",(function(){return X.zb})),n.d(t,"A",(function(){return X.Cb})),n.d(t,"B",(function(){return X.Db})),n.d(t,"C",(function(){return X.Fb})),n.d(t,"D",(function(){return X.Ib})),n.d(t,"E",(function(){return X.Kb})),n.d(t,"I",(function(){return X.Pb})),n.d(t,"F",(function(){return X.Mb})),n.d(t,"G",(function(){return X.Nb})),n.d(t,"H",(function(){return X.Ob})),n.d(t,"J",(function(){return X.Xb})),n.d(t,"K",(function(){return X.bc})),n.d(t,"M",(function(){return X.jc})),n.d(t,"O",(function(){return X.qc})),n.d(t,"N",(function(){return X.oc})),n.d(t,"Q",(function(){return X.xc})),n.d(t,"P",(function(){return X.wc})),n.d(t,"R",(function(){return X.Ac})),n.d(t,"S",(function(){return X.Cc})),n.d(t,"U",(function(){return X.Gc})),n.d(t,"V",(function(){return X.Hc})),n.d(t,"r",(function(){return X.db})),n.d(t,"L",(function(){return X.hc}));var r={};n.r(r),n.d(r,"copyModel",(function(){return V})),n.d(r,"listModels",(function(){return L})),n.d(r,"moveModel",(function(){return U})),n.d(r,"removeModel",(function(){return B})),n.d(r,"browserFiles",(function(){return re})),n.d(r,"browserHTTPRequest",(function(){return me})),n.d(r,"concatenateArrayBuffers",(function(){return l.d})),n.d(r,"decodeWeights",(function(){return l.e})),n.d(r,"encodeWeights",(function(){return l.f})),n.d(r,"fromMemory",(function(){return ye})),n.d(r,"getLoadHandlers",(function(){return m})),n.d(r,"getModelArtifactsInfoForJSON",(function(){return l.g})),n.d(r,"getSaveHandlers",(function(){return p})),n.d(r,"http",(function(){return pe})),n.d(r,"isHTTPScheme",(function(){return fe})),n.d(r,"loadWeights",(function(){return ue})),n.d(r,"registerLoadRouter",(function(){return d})),n.d(r,"registerSaveRouter",(function(){return f})),n.d(r,"weightsLoaderFactory",(function(){return le})),n.d(r,"withSaveHandler",(function(){return _e}));var a={};n.r(a),n.d(a,"assertParamsValid",(function(){return be})),n.d(a,"maskToAxes",(function(){return ke})),n.d(a,"computeOutShape",(function(){return we})),n.d(a,"stridesWithElidedDims",(function(){return xe})),n.d(a,"getNormalizedAxes",(function(){return Te})),n.d(a,"startIndicesWithElidedDims",(function(){return Ae})),n.d(a,"stopIndicesWithElidedDims",(function(){return Ee})),n.d(a,"stridesForAxis",(function(){return Ie})),n.d(a,"startForAxis",(function(){return Re})),n.d(a,"stopForAxis",(function(){return Oe})),n.d(a,"isSliceContinous",(function(){return Ne})),n.d(a,"computeFlatOffset",(function(){return De})),n.d(a,"parseSliceParams",(function(){return Pe}));var i={};n.r(i),n.d(i,"segOpComputeOptimalWindowSize",(function(){return Br})),n.d(i,"computeOutShape",(function(){return jr})),n.d(i,"collectGatherOpShapeInfo",(function(){return Vr}));var o={};n.r(o),n.d(o,"axesAreInnerMostDims",(function(){return ot})),n.d(o,"combineLocations",(function(){return st})),n.d(o,"computeOutAndReduceShapes",(function(){return ut})),n.d(o,"expandShapeToKeepDim",(function(){return ct})),n.d(o,"assertAxesAreInnerMostDims",(function(){return lt})),n.d(o,"getAxesPermutation",(function(){return ht})),n.d(o,"getUndoAxesPermutation",(function(){return ft})),n.d(o,"getInnerMostAxes",(function(){return dt})),n.d(o,"getBroadcastDims",(function(){return qt})),n.d(o,"getReductionAxes",(function(){return Ut})),n.d(o,"assertAndGetBroadcastShape",(function(){return Wt})),n.d(o,"assertParamsConsistent",(function(){return qe})),n.d(o,"computeOutShape",(function(){return Ue})),n.d(o,"computeDilation2DInfo",(function(){return He})),n.d(o,"computePool2DInfo",(function(){return Ke})),n.d(o,"computePool3DInfo",(function(){return Xe})),n.d(o,"computeConv2DInfo",(function(){return Qe})),n.d(o,"computeConv3DInfo",(function(){return Ye})),n.d(o,"computeDefaultPad",(function(){return Ze})),n.d(o,"tupleValuesAreOne",(function(){return nt})),n.d(o,"eitherStridesOrDilationsAreOne",(function(){return rt})),n.d(o,"convertConv2DDataFormat",(function(){return at})),n.d(o,"getFusedDyActivation",(function(){return ir})),n.d(o,"getFusedBiasGradient",(function(){return or})),n.d(o,"applyActivation",(function(){return sr})),n.d(o,"shouldFuse",(function(){return ur})),n.d(o,"PARALLELIZE_THRESHOLD",(function(){return cr})),n.d(o,"computeOptimalWindowSize",(function(){return lr})),n.d(o,"slice_util",(function(){return a})),n.d(o,"upcastType",(function(){return Me.b})),n.d(o,"getImageCenter",(function(){return hr})),n.d(o,"getReshaped",(function(){return fr})),n.d(o,"getPermuted",(function(){return dr})),n.d(o,"getReshapedPermuted",(function(){return pr})),n.d(o,"getSliceBeginCoords",(function(){return mr})),n.d(o,"getSliceSize",(function(){return vr})),n.d(o,"prepareAndValidate",(function(){return gr})),n.d(o,"validateUpdateShape",(function(){return yr})),n.d(o,"validateInput",(function(){return _r})),n.d(o,"calculateShapes",(function(){return br})),n.d(o,"SELU_SCALEALPHA",(function(){return kr})),n.d(o,"SELU_SCALE",(function(){return wr})),n.d(o,"ERF_P",(function(){return xr})),n.d(o,"ERF_A1",(function(){return Cr})),n.d(o,"ERF_A2",(function(){return Sr})),n.d(o,"ERF_A3",(function(){return Tr})),n.d(o,"ERF_A4",(function(){return Ar})),n.d(o,"ERF_A5",(function(){return Er})),n.d(o,"warn",(function(){return Ir})),n.d(o,"log",(function(){return Rr})),n.d(o,"mergeRealAndImagArrays",(function(){return Or})),n.d(o,"splitRealAndImagArrays",(function(){return Nr})),n.d(o,"complexWithEvenIndex",(function(){return Dr})),n.d(o,"complexWithOddIndex",(function(){return Pr})),n.d(o,"getComplexWithIndex",(function(){return Fr})),n.d(o,"assignToTypedArray",(function(){return Mr})),n.d(o,"exponents",(function(){return Lr})),n.d(o,"exponent",(function(){return zr})),n.d(o,"prepareSplitSize",(function(){return Mt})),n.d(o,"segment_util",(function(){return i})),n.d(o,"castTensor",(function(){return qr})),n.d(o,"reshapeTensor",(function(){return Ur})),n.d(o,"linspaceImpl",(function(){return Wr}));var s={};n.r(s),n.d(s,"nonMaxSuppressionV3Impl",(function(){return ln})),n.d(s,"nonMaxSuppressionV4Impl",(function(){return hn})),n.d(s,"nonMaxSuppressionV5Impl",(function(){return fn})),n.d(s,"split",(function(){return Hr})),n.d(s,"tile",(function(){return Kr})),n.d(s,"topkImpl",(function(){return Xr})),n.d(s,"whereImpl",(function(){return Qr}));var u=n(6),c=(n(34),n(11)),l=n(17),h=function(){function e(){_classCallCheck2(this,e),this.saveRouters=[],this.loadRouters=[]}return _createClass2(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),f=function(e){return h.registerSaveRouter(e)},d=function(e){return h.registerLoadRouter(e)},p=function(e){return h.getSaveHandlers(e)},m=function(e,t){return h.getLoadHandlers(e,t)};function v(){if(!Object(c.b)().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function g(e){var t=e.result;t.createObjectStore("models_store",{keyPath:"modelPath"}),t.createObjectStore("model_info_store",{keyPath:"modelPath"})}var y=function(){function e(t){if(_classCallCheck2(this,e),this.indexedDB=v(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}var t,n;return _createClass2(e,[{key:"save",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return g(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction("models_store","readonly"),s=o.objectStore("models_store").get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' in IndexedDB.")));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=Object(l.g)(t),h=i.transaction("model_info_store","readwrite"),f=h.objectStore("model_info_store"),d=f.put({modelPath:n.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var a=(u=i.transaction("models_store","readwrite")).objectStore("models_store").put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(f=h.objectStore("model_info_store")).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},d.onerror=function(e){return i.close(),r(d.error)},h.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();y.URL_SCHEME="indexeddb://";var _=function(e){return Object(c.b)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(y.URL_SCHEME)?(t=e.slice(y.URL_SCHEME.length),new y(t)):null;var t};h.registerSaveRouter(_),h.registerLoadRouter(_);var b=function(){function e(){_classCallCheck2(this,e),this.indexedDB=v()}var t,n;return _createClass2(e,[{key:"listModels",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return g(r)},r.onsuccess=function(){var t=r.result,a=t.transaction("model_info_store","readonly"),i=a.objectStore("model_info_store").getAll();i.onsuccess=function(){var t,n={},r=_createForOfIteratorHelper(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"removeModel",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=(n=t).startsWith(y.URL_SCHEME)?n.slice(y.URL_SCHEME.length):n,new Promise((function(e,n){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return g(a)},a.onsuccess=function(){var r,i=a.result,o=i.transaction("model_info_store","readwrite"),s=o.objectStore("model_info_store"),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),n(new Error("Cannot find model with path '".concat(t,"' in IndexedDB.")));var a=s.delete(t),o=function(){var a=(r=i.transaction("models_store","readwrite")).objectStore("models_store").delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return n(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),n(u.error)}},u.onerror=function(e){return i.close(),n(u.error)},o.oncomplete=function(){null==r?i.close():r.oncomplete=function(){return i.close()}}},a.onerror=function(e){return n(a.error)}}))));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),k=n(16),w="tensorflowjs_models",x="info",C="model_topology",S="weight_specs",T="weight_data",A="model_metadata";function E(e){return{info:[w,e,x].join("/"),topology:[w,e,C].join("/"),weightSpecs:[w,e,S].join("/"),weightData:[w,e,T].join("/"),modelMetadata:[w,e,A].join("/")}}function I(e){var t=e.split("/");if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join("/")}var R=function(){function e(t){if(_classCallCheck2(this,e),!Object(c.b)().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=E(this.modelPath)}var t,n;return _createClass2(e,[{key:"save",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=Object(l.g)(t),e.prev=3,e.abrupt("return",(this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Object(l.a)(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),{modelArtifactsInfo:a}));case 7:throw e.prev=7,e.t0=e.catch(3),this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(a.modelTopologyBytes,", weightSpecsBytes=").concat(a.weightSpecsBytes,", weightDataBytes=").concat(a.weightDataBytes,"."));case 10:case"end":return e.stop()}}),e,this,[[3,7]])}))),function(e){return n.apply(this,arguments)})},{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));case 8:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));case 12:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,n.userDefinedMetadata=o.userDefinedMetadata),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));case 18:return e.abrupt("return",(n.weightData=Object(l.b)(s),n));case 19:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();R.URL_SCHEME="localstorage://";var O=function(e){return Object(c.b)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(R.URL_SCHEME)?(t=e.slice(R.URL_SCHEME.length),new R(t)):null;var t};h.registerSaveRouter(O),h.registerLoadRouter(O);var N=function(){function e(){_classCallCheck2(this,e),Object(k.b)(Object(c.b)().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),Object(k.b)("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}var t,n;return _createClass2(e,[{key:"listModels",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=w+"/",r="/"+x,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(t[I(i)]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"removeModel",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=E(t=(n=t).startsWith(R.URL_SCHEME)?n.slice(R.URL_SCHEME.length):n),null!=this.LS.getItem(r.info)){e.next=3;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 3:return a=JSON.parse(this.LS.getItem(r.info)),e.abrupt("return",(this.LS.removeItem(r.info),this.LS.removeItem(r.topology),this.LS.removeItem(r.weightSpecs),this.LS.removeItem(r.weightData),a));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),D=function(){function e(){_classCallCheck2(this,e),this.managers={}}return _createClass2(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){Object(k.b)(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),Object(k.b)(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();Object(k.b)(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}},{key:"getSchemes",value:function(){return Object.keys(this.getInstance().managers)}}]),e}();function P(e){if(-1===e.indexOf("://"))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+D.getSchemes().join(","));return{scheme:e.split("://")[0],path:e.split("://")[1]}}function F(e,t){return M.apply(this,arguments)}function M(){return(M=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,f,d,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.length>2&&void 0!==p[2]&&p[2],Object(k.b)(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),a=h.getLoadHandlers(t),Object(k.b)(a.length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),Object(k.b)(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") load handlers for source URL ").concat(t,".")})),i=a[0],o=h.getSaveHandlers(n),Object(k.b)(o.length>0,(function(){return"Copying failed because no save handler is found for destination URL ".concat(n,".")})),Object(k.b)(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") save handlers for destination URL ").concat(n,".")})),s=o[0],u=P(t).scheme,c=P(t).path,l=u===P(t).scheme,e.next=12,i.load();case 12:if(f=e.sent,e.t0=r&&l,!e.t0){e.next=17;break}return e.next=17,D.getManager(u).removeModel(c);case 17:return e.next=19,s.save(f);case 19:if(d=e.sent,e.t1=r&&!l,!e.t1){e.next=24;break}return e.next=24,D.getManager(u).removeModel(c);case 24:return e.abrupt("return",d.modelArtifactsInfo);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(){return z.apply(this,arguments)}function z(){return(z=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=D.getSchemes(),n={},r=_createForOfIteratorHelper(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=12;break}return i=a.value,e.next=8,D.getManager(i).listModels();case 8:for(s in o=e.sent)n[i+"://"+s]=o[s];case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])})))).apply(this,arguments)}function B(e){return j.apply(this,arguments)}function j(){return(j=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=P(t),e.abrupt("return",D.getManager(n.scheme).removeModel(n.path));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t){return q.apply(this,arguments)}function q(){return(q=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",F(t,n,!1));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e,t){return W.apply(this,arguments)}function W(){return(W=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",F(t,n,!0));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var G=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}();if(Object(c.b)().get("IS_BROWSER")){Object(c.b)().setPlatform("browser",new G);try{D.registerManager(R.URL_SCHEME,new N)}catch(e){}try{D.registerManager(y.URL_SCHEME,new b)}catch(e){}}n(158);var H=n(5);function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",k.c(e),new H.b(e,t,n)}var X=n(1),Q=n(3),Y=n(4),Z=Object(Y.a)({cast_:function(e,t){var n=Object(Q.a)(e,"x","cast");if(!k.B(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return u.a.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},null,X.v,{dtype:t})}}),J=Object(Y.a)({clone_:function(e){var t=Object(Q.a)(e,"x","clone",null);return u.a.runKernelFunc((function(){return u.a.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{x:t},null,X.jb)}});Object(u.b)();var $={buffer:K,cast:Z,clone:J,print:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};function ee(e){return new Promise((function(e){return setTimeout(e)})).then(e)}Object(H.e)($);var te=function(){function e(t){if(_classCallCheck2(this,e),!Object(c.b)().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}var t;return _createClass2(e,[{key:"save",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=5;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 5:return r=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]})],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=r,e.next=10,ee((function(){return a.dispatchEvent(new MouseEvent("click"))}));case 10:if(null==t.weightData){e.next=16;break}return(i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=n,e.next=16,ee((function(){return i.dispatchEvent(new MouseEvent("click"))}));case 16:return e.abrupt("return",{modelArtifactsInfo:Object(l.g)(t)});case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();te.URL_SCHEME="downloads://";var ne=function(){function e(t){if(_classCallCheck2(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}var t;return _createClass2(e,[{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.files[0],n=this.files.slice(1),e.abrupt("return",new Promise((function(e,a){var i=new FileReader;i.onload=function(i){var o=JSON.parse(i.target.result),s=o.modelTopology;if(null!=s){0===n.length&&e({modelTopology:s});var u=o.weightsManifest;if(null!=u){var c;try{c=r.checkManifestAndWeightFiles(u,n)}catch(t){return void a(t)}var h=[],f=[],d=[];u.forEach((function(e){e.paths.forEach((function(e){f.push(e),d.push(null)})),h.push.apply(h,_toConsumableArray(e.weights))})),u.forEach((function(t){t.paths.forEach((function(t){var n=new FileReader;n.onload=function(n){var r=n.target.result,a=f.indexOf(t);d[a]=r,-1===d.indexOf(null)&&e({modelTopology:s,weightSpecs:h,weightData:Object(l.d)(d),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy,userDefinedMetadata:o.userDefinedMetadata})},n.onerror=function(e){return a("Failed to weights data from file of path '".concat(t,"'."))},n.readAsArrayBuffer(c[t])}))}))}else a(new Error("weightManifest field is missing from file "+t.name))}else a(new Error("modelTopology field is missing from file "+t.name))},i.onerror=function(e){return a("Failed to read model topology and weights manifest JSON from file '".concat(t.name,"'. BrowserFiles supports loading Keras-style tf.Model artifacts only."))},i.readAsText(t)})));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"checkManifestAndWeightFiles",value:function(e,t){var n,r=[],a=t.map((function(e){return Object(l.c)(e.name)})),i={},o=_createForOfIteratorHelper(e);try{for(o.s();!(n=o.n()).done;){n.value.paths.forEach((function(e){var n=Object(l.c)(e);if(-1!==r.indexOf(n))throw new Error("Duplicate file basename found in weights manifest: '".concat(n,"'"));if(r.push(n),-1===a.indexOf(n))throw new Error("Weight file with basename '".concat(n,"' is not provided."));i[e]=t[a.indexOf(n)]}))}}catch(s){o.e(s)}finally{o.f()}if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest (".concat(r.length,") and the number of weight files provided (").concat(t.length,")."));return i}}]),e}();function re(e){return new ne(e)}function ae(e,t,n,r){!function(e){Object(k.b)(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){Object(k.b)(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),Object(k.b)(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),Object(k.b)(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ")+t}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}h.registerSaveRouter((function(e){return Object(c.b)().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(te.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new te(e)}(e.slice(te.URL_SCHEME.length)):null}));var ie=n(40);function oe(e,t){return se.apply(this,arguments)}function se(){return(se=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?Object(c.b)().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),null!=n.onProgress){e.next=9;break}return e.next=6,Promise.all(a);case 6:e.t0=e.sent,e.next=12;break;case 9:return e.next=11,ae(a,n.onProgress,0,.5);case 11:e.t0=e.sent;case 12:if(i=e.t0.map((function(e){return e.arrayBuffer()})),null!=n.onProgress){e.next=19;break}return e.next=16,Promise.all(i);case 16:e.t1=e.sent,e.next=22;break;case 19:return e.next=21,ae(i,n.onProgress,.5,1);case 21:e.t1=e.sent;case 22:return e.abrupt("return",e.t1);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e){return ce.apply(this,arguments)}function ce(){return(ce=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"",r=i.length>2?i[2]:void 0,a=i.length>3?i[3]:void 0,e.abrupt("return",le((function(e){return oe(e,{requestInit:a})}))(t,n,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function le(e){return function(){var t=_asyncToGenerator(regeneratorRuntime.mark((function t(n){var r,a,i,o,s,u,c,h,f,d,p,m,v=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=v.length>1&&void 0!==v[1]?v[1]:"",a=v.length>2?v[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r=ie.a["quantization"in e?e.quantization.dtype:e.dtype]*k.N(e.shape),c=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:r})};null!=a?a.forEach((function(t,n){t===e.name&&(c(),s[n]=!0)})):c(),u.push(e.name),n+=r}))})),s.every((function(e){return e}))){t.next=6;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");case 6:return h=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),f=[],h.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;f.push(t)}))})),t.next=10,e(f);case 10:return d=t.sent,p={},m=0,t.abrupt("return",(h.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=d[m+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var h=new Uint8Array(d[m+c]);s.set(h,u),u+=h.byteLength}o[e].forEach((function(e){var t=i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),n=Object(l.e)(t,[e.manifestEntry]);for(var r in n)p[r]=n[r]})),m+=t})),p));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}var he=function(){function e(t,n){if(_classCallCheck2(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(Object(k.b)("function"==typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=Object(c.b)().platform.fetch,Object(k.b)(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&Object(k.b)(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}var t,n,r;return _createClass2(e,[{key:"save",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n.body.append("model.json",new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:t.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=6,this.fetch(this.path,n);case 6:if(!(r=e.sent).ok){e.next=9;break}return e.abrupt("return",{modelArtifactsInfo:Object(l.g)(t),responses:[r]});case 9:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+r.status+".");case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"load",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s,u,c,l,h,f,d,p,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+t.status+". Please verify this URL points to the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 15:if(a=n.modelTopology,i=n.weightsManifest,o=n.generatedBy,s=n.convertedBy,u=n.format,c=n.userDefinedMetadata,null!=a||null!=i){e.next=18;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model topology or manifest for weights."));case 18:if(null==i){e.next=25;break}return e.next=21,this.loadWeights(i);case 21:f=e.sent,d=_slicedToArray2(f,2),l=d[0],h=d[1];case 25:return p={modelTopology:a,weightSpecs:l,weightData:h,userDefinedMetadata:c,generatedBy:o,convertedBy:s,format:u},m=n.modelInitializer,e.abrupt("return",(m&&(p.modelInitializer=m),p));case 27:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return n.apply(this,arguments)})},{key:"loadWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,u,c,h,f,d,p,m,v,g,y,_,b,k;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(n),a=_slicedToArray2(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=[],c=_createForOfIteratorHelper(t);try{for(c.s();!(h=c.n()).done;)f=h.value,u.push.apply(u,_toConsumableArray(f.weights))}catch(w){c.e(w)}finally{c.f()}d=[],p=[],m=_createForOfIteratorHelper(t);try{for(m.s();!(v=m.n()).done;){g=v.value,y=_createForOfIteratorHelper(g.paths);try{for(y.s();!(_=y.n()).done;)b=_.value,null!=this.weightUrlConverter?p.push(this.weightUrlConverter(b)):d.push(s+b+o)}catch(w){y.e(w)}finally{y.f()}}}catch(w){m.e(w)}finally{m.f()}if(e.t0=this.weightUrlConverter,!e.t0){e.next=16;break}return e.t1=d.push,e.t2=d,e.t3=_toConsumableArray,e.next=13,Promise.all(p);case 13:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 16:return e.next=18,oe(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 18:return k=e.sent,e.abrupt("return",[u,Object(l.d)(k)]);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function fe(e){return null!=e.match(he.URL_SCHEME_REGEX)}he.URL_SCHEME_REGEX=/^https?:\/\//;var de=function(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return fe(e)})):fe(e))?pe(e,t):null};function pe(e,t){return new he(e,t)}function me(e,t){return pe(e,t)}h.registerSaveRouter(de),h.registerLoadRouter(de);var ve=function(){function e(t){_classCallCheck2(this,e),this.modelArtifacts=t}var t;return _createClass2(e,[{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.modelArtifacts);case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),ge=function(){function e(t){_classCallCheck2(this,e),this.saveHandler=t}var t;return _createClass2(e,[{key:"save",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveHandler(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function ye(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new ve(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ve({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new ve({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function _e(e){return new ge(e)}function be(e,t,n){var r=e.shape.length;k.b(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")})),k.b(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")}));for(var a=function(a){k.b(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] (").concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function ke(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function we(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function xe(e,t,n,r){for(var a=_toConsumableArray(e),i=a.length;i<r.length;i++)a.push(1);for(var o=0;o<n;o++)0===o?a[t]=1:(a.splice(t,0,1),a.pop());return a}function Ce(e,t,n){return n<=e?n:n-(t-1)}function Se(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function Te(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),h=new Array(c),f=new Array(c);if(t.length&&n>0){var d=t[0],p=n+1;l=Ae(o,d,p,r,e),h=Ee(s,d,p,a,e),f=xe(i,d,p,e)}else for(var m=0;m<c;m++)l[m]=Re(o,r,i,e,m,u),h[m]=Oe(s,a,i,e,m,u),f[m]=Ie(i,m,u);return{begin:l,end:h,strides:f}}function Ae(e,t,n,r,a){for(var i=_toConsumableArray(a),o=Se(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=Ce(t,n,s),c=r[u];e&1<<u&&(c=0),i[s]=c}return i}function Ee(e,t,n,r,a){for(var i=_toConsumableArray(a),o=Se(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=Ce(t,n,s),c=r[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var h=a[l];i[l]<0&&(i[l]+=h),i[l]=k.i(0,i[l],a[l])}return i}function Ie(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function Re(e,t,n,r,a,i){var o=t[a];(e&1<<a||i&1<<a||null==o)&&(o=(n[a]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[a];return o<0&&(o+=s),o=k.i(0,o,s-1)}function Oe(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?k.i(0,o,u):k.i(-1,o,u-1)}function Ne(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function De(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Pe(e,t,n){var r,a,i=e.shape.length;return(r="number"==typeof t?[t].concat(_toConsumableArray(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){k.b(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"==typeof n?[n].concat(_toConsumableArray(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(k.b(-1===t,(function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}var Fe=n(7),Me=n(27),Le=n(12),ze=Object(Y.a)({add_:function(e,t){var n,r=Object(Q.a)(e,"a","add"),a=Object(Q.a)(t,"b","add");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],u.a.runKernelFunc((function(e,t){var n=e.add(r,a);return t([r,a]),n}),{a:r,b:a},null,X.d)}}),Be=Object(Y.a)({reshape_:function(e,t){var n=Object(Q.a)(e,"x","reshape",null);return u.a.runKernelFunc((function(e,r){return t=k.s(t,n.size),k.b(n.size===k.N(t),(function(){return"new shape and old shape must have the same number of elements."})),r([n]),e.reshape(n,t)}),{x:n},null,X.bc,{shape:t})}});function je(e){return null==e?null:0===e.rank?Be(e,[e.size]):1===e.rank?e:2===e.rank?Be(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Be(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}var Ve=Object(Y.a)({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,c=Object(Q.a)(e,"x","batchNorm"),l=Object(Q.a)(t,"mean","batchNorm"),h=Object(Q.a)(n,"variance","batchNorm");null!=a&&(o=Object(Q.a)(a,"scale","batchNorm")),null!=r&&(s=Object(Q.a)(r,"offset","batchNorm")),k.b(l.rank===h.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),k.b(null==s||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),k.b(null==o||l.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var f=function(e){return 0===e.rank||1===e.rank?Be(e,[1,1,1,e.size]):2===e.rank?Be(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Be(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(c),d=u.a.runKernelFunc((function(e,t){return t([f,l,h,o]),e.batchNorm(f,je(l),je(h),je(s),je(o),i)}),{x:f,scale:o,offset:s,mean:l,variance:h},null,X.eb,{varianceEpsilon:i});return Be(d,c.shape)}});function qe(e,t){var n=e[0].length;e.forEach((function(e,t){k.b(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")}))})),k.b(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)k.b(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")}))}))}function Ue(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}var We=n(23),Ge=Object(Y.a)({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(k.b)(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Object(Q.b)(e,"tensors","concat");return"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),u.a.runKernelFunc((function(e,r){var a=Object(k.I)(t,n[0].shape)[0],i=Ue(n.map((function(e){return e.shape})),a);if(0===Object(k.N)(i))return Object(We.a)([],i);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];qe(n.map((function(e){return e.shape})),a);var o=e.concat(n,a);return r(n),o}),n,null,X.z,{axis:t})}});function He(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0;return Qe(e,[].concat(_toConsumableArray(t),[e[3]]),n,i,r,null,null,at(a))}function Ke(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=Je(t),c=_slicedToArray2(u,2),l=c[0],h=c[1];if("channelsLast"===s)o=[l,h,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);o=[l,h,e[1],e[1]]}return Qe(e,o,n,r,a,i,!1,s)}function Xe(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=$e(t),l=_slicedToArray2(c,3),h=l[0],f=l[1],d=l[2];if("NDHWC"===u)s="channelsLast",o=[h,f,d,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat "+u);s="channelsFirst",o=[h,f,d,e[1],e[1]]}return Ye(e,o,n,r,a,!1,s,i)}function Qe(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,h=-1;if("channelsLast"===s){var f=_slicedToArray2(e,4);u=f[0],c=f[1],l=f[2],h=f[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);var d=_slicedToArray2(e,4);u=d[0],h=d[1],c=d[2],l=d[3]}var p,m=_slicedToArray2(t,4),v=m[0],g=m[1],y=m[3],_=Je(n),b=_slicedToArray2(_,2),w=b[0],x=b[1],C=Je(r),S=_slicedToArray2(C,2),T=S[0],A=S[1],E=et(v,T),I=et(g,A),R=function(e,t,n,r,a,i,o,s,u){var c,l,h;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,a){null==r&&(r=Ze(e,t,n));var i=e[1],o=tt((e[0]-t+2*r)/n+1,a);k.b(k.v(o),(function(){return"The output # of rows (".concat(o,") must be an integer. Change the stride and/or zero pad parameters")}));var s=tt((i-t+2*r)/n+1,a);return k.b(k.v(s),(function(){return"The output # of columns (".concat(s,") must be an integer. Change the stride and/or zero pad parameters")})),[o,s]}([t,n],i,r,e,s);l=f[0],h=f[1]}else if("same"===e){l=Math.ceil(t/r),h=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),p=Math.max(0,(h-1)*a+o-n),m=Math.floor(d/2),v=d-m,g=Math.floor(p/2);c={top:m,bottom:v,left:g,right:p-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),h=Math.ceil((n-o+1)/a);else{if("object"!=typeof e)throw Error("Unknown padding parameter: "+e);var y="channelsLast"===u?e[1][0]:e[2][0],_="channelsLast"===u?e[1][1]:e[2][1],b="channelsLast"===u?e[2][0]:e[3][0],w="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:_,left:b,right:w,type:0===y&&0===_&&0===b&&0===w?"VALID":"EXPLICIT"},l=tt((t-i+y+_)/r+1,s),h=tt((n-o+b+w)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:h}}(a,c,l,w,x,E,I,i,s),O=R.padInfo,N=R.outHeight,D=R.outWidth,P=o?y*h:y;return"channelsFirst"===s?p=[u,P,N,D]:"channelsLast"===s&&(p=[u,N,D,P]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:h,outHeight:N,outWidth:D,outChannels:P,padInfo:O,strideHeight:w,strideWidth:x,filterHeight:v,filterWidth:g,effectiveFilterHeight:E,effectiveFilterWidth:I,dilationHeight:T,dilationWidth:A,inShape:e,outShape:p,filterShape:t}}function Ye(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,h=-1,f=-1;if("channelsLast"===o){var d=_slicedToArray2(e,5);u=d[0],c=d[1],l=d[2],h=d[3],f=d[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);var p=_slicedToArray2(e,5);u=p[0],f=p[1],c=p[2],l=p[3],h=p[4]}var m,v=_slicedToArray2(t,5),g=v[0],y=v[1],_=v[2],b=v[4],w=$e(n),x=_slicedToArray2(w,3),C=x[0],S=x[1],T=x[2],A=$e(r),E=_slicedToArray2(A,3),I=E[0],R=E[1],O=E[2],N=et(g,I),D=et(y,R),P=et(_,O),F=function(e,t,n,r,a,i,o,s,u,c,l){var h,f,d,p;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=Ze(e,t,r));var o=e[1],s=e[2],u=tt((e[0]-t+2*a)/r+1,i);k.b(k.v(u),(function(){return"The output # of depths (".concat(u,") must be an integer. Change the stride and/or zero pad parameters")}));var c=tt((o-t+2*a)/r+1,i);k.b(k.v(c),(function(){return"The output # of rows (".concat(c,") must be an integer. Change the stride and/or zero pad parameters")}));var l=tt((s-t+2*a)/r+1,i);return k.b(k.v(l),(function(){return"The output # of columns (".concat(l,") must be an integer. Change the stride and/or zero pad parameters")})),[u,c,l,1]}([t,n,r,1],s,0,a,e,l);f=m[0],d=m[1],p=m[2]}else if("same"===e){var v=((f=Math.ceil(t/a))-1)*a+s-t,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((p=Math.ceil(r/o))-1)*o+c-r,_=Math.floor(v/2),b=v-_,w=Math.floor(g/2),x=g-w,C=Math.floor(y/2);h={top:w,bottom:x,left:C,right:y-C,front:_,back:b,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/a),d=Math.ceil((n-u+1)/i),p=Math.ceil((r-c+1)/o)}return{padInfo:h,outDepth:f,outHeight:d,outWidth:p}}(a,c,l,h,C,S,T,N,D,P,s),M=F.padInfo,L=F.outDepth,z=F.outHeight,B=F.outWidth,j=i?b*f:b;return"channelsFirst"===o?m=[u,j,L,z,B]:"channelsLast"===o&&(m=[u,L,z,B,j]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:h,inChannels:f,outDepth:L,outHeight:z,outWidth:B,outChannels:j,padInfo:M,strideDepth:C,strideHeight:S,strideWidth:T,filterDepth:g,filterHeight:y,filterWidth:_,effectiveFilterDepth:N,effectiveFilterHeight:D,effectiveFilterWidth:P,dilationDepth:I,dilationHeight:R,dilationWidth:O,inShape:e,outShape:m,filterShape:t}}function Ze(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=et(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Je(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function $e(e){return"number"==typeof e?[e,e,e]:e}function et(e,t){return t<=1?e:e+(e-1)*(t-1)}function tt(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function nt(e){var t=_slicedToArray2(Je(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function rt(e,t){return nt(e)||nt(t)}function at(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}var it=Object(Y.a)({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Object(Q.a)(e,"x","conv2d"),c=Object(Q.a)(t,"filter","conv2d"),l=s,h=!1;3===s.rank&&(h=!0,l=Be(s,[1,s.shape[0],s.shape[1],s.shape[2]])),k.b(4===l.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),k.b(4===c.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+c.rank+"."})),null!=o&&k.b(k.v(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var f="NHWC"===a?l.shape[3]:l.shape[1];k.b(f===c.shape[2],(function(){return"Error in conv2d: depth of input (".concat(f,") must match input depth for filter ").concat(c.shape[2],".")})),k.b(rt(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")}));var d=u.a.runKernelFunc((function(e,t){var s=at(a),u=Qe(l.shape,c.shape,n,i,r,o,!1,s),h=e.conv2d(l,c,u);return t([l,c]),h}),{x:l,filter:c},null,X.A,{strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o});return h?Be(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});function ot(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function st(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function ut(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((function(t){return e[t]}))]}function ct(e,t){return st(e,t.map((function(e){return 1})),t)}function lt(e,t,n){k.b(ot(t,n),(function(){return e+" supports only inner-most axes for now. "+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function ht(e,t){if(ot(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function ft(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function dt(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var pt=Object(Y.a)({transpose_:function(e,t){var n=Object(Q.a)(e,"x","transpose");return null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),k.b(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of perm ").concat(t,".")})),t.forEach((function(e){k.b(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1?n.clone():u.a.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},null,X.Gc,{perm:t})}}),mt=Object(Y.a)({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Object(Q.a)(e,"x","cumsum");return u.a.runKernelFunc((function(e,i){var o=ht([t],a.rank),s=a;null!=o&&(s=pt(a,o));var u=dt(1,a.rank)[0],c=e.cumsum(s,u,n,r);if(i([a]),null!=o){var l=ft(o);c=pt(c,l)}return c}),{x:a},null,X.J,{axis:t,exclusive:n,reverse:r})}}),vt=Object(Y.a)({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Object(Q.a)(e,"x","depthwiseConv2d"),c=Object(Q.a)(t,"filter","depthwiseConv2d"),l=s,h=!1;3===s.rank&&(h=!0,l=Be(s,[1,s.shape[0],s.shape[1],s.shape[2]])),k.b(4===l.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),k.b(4===c.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+c.rank+"."})),k.b(l.shape[3]===c.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels (".concat(l.shape[3],") must match the inChannels dimension in filter ").concat(c.shape[2],".")})),null!=o&&k.b(k.v(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var f=u.a.runKernelFunc((function(e,t){null==i&&(i=[1,1]),k.b(rt(n,i),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")}));var a=Qe(l.shape,c.shape,n,i,r,o,!0),s=e.depthwiseConv2D(l,c,a);return t([l,c]),s}),{x:l,filter:c},null,X.L,{strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o});return h?Be(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),gt=Object(Y.a)({floorDiv_:function(e,t){var n,r=Object(Q.a)(e,"a","floorDiv"),a=Object(Q.a)(t,"b","floorDiv");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],u.a.runKernelFunc((function(e,t){var n=e.floorDiv(r,a);return t([r,a]),n}),{a:r,b:a},null,X.cb)}}),yt=Object(Y.a)({div_:function(e,t){var n,r=Object(Q.a)(e,"a","div"),a=Object(Q.a)(t,"b","div");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],"int32"===r.dtype&&"int32"===a.dtype?gt(r,a):u.a.runKernelFunc((function(e,t){var n=e.realDivide(r,a);return t([r,a]),n}),{a:r,b:a},null,X.R,{})}}),_t=Object(Y.a)({matMul_:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=Object(Q.a)(e,"a","matMul"),o=Object(Q.a)(t,"b","matMul");return n=_slicedToArray2(Object(Le.b)(i,o),2),i=n[0],o=n[1],u.a.runKernelFunc((function(e,t){t([i,o]);var n=r?i.shape[i.rank-2]:i.shape[i.rank-1],s=a?o.shape[o.rank-1]:o.shape[o.rank-2],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],c=a?o.shape[o.rank-2]:o.shape[o.rank-1],l=i.shape.slice(0,-2),h=o.shape.slice(0,-2),f=k.N(l),d=k.N(h);k.b(i.rank>=2&&o.rank>=2&&(f===d||1===f||1===d),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(l,") and (").concat(h,").")})),k.b(n===s,(function(){return"Error in matMul: inner shapes (".concat(n,") and (").concat(s,") of Tensors with shapes ").concat(i.shape," and ").concat(o.shape," and transposeA=").concat(r," and transposeB=").concat(a," must match.")}));var p=(f>d?l:h).concat([u,c]),m=Be(i,r?[f,n,u]:[f,u,n]),v=Be(o,a?[d,c,s]:[d,s,c]),g=e.batchMatMul(m,v,r,a);return Be(g,p)}),{a:i,b:o},null,X.s,{transposeA:r,transposeB:a})}}),bt=Object(Y.a)({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(Q.a)(e,"x","max");return u.a.runKernelFunc((function(e,a){var i=k.I(t,r.shape),o=ht(i,r.rank),s=r;null!=o&&(s=pt(r,o),i=dt(i.length,s.rank));var u=e.max(s,i);null!=o&&s.dispose();var c=u;if(n){var l=ct(c.shape,k.I(t,r.shape));c=Be(c,l),u.dispose()}return a([r,c]),c}),{x:r},null,X.yb,{reductionIndices:t,keepDims:n})}}),kt=Object(Y.a)({maxPool_:function(e,t,n,r,a){var i=Object(Q.a)(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=Be(i,[1,i.shape[0],i.shape[1],i.shape[2]])),k.b(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),k.b(rt(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '1'")})),null!=a&&k.b(k.v(r),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var c=u.a.runKernelFunc((function(e,i){var s,u=Ke(o.shape,t,n,1,r,a);return s=1===u.filterWidth&&1===u.filterHeight&&k.a(u.inShape,u.outShape)?o.clone():e.maxPool(o,u),i([o,s]),s}),{x:o},null,X.zb,{filterSize:t,strides:n,pad:r,dimRoundingMode:a});return s?Be(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),wt=Object(Y.a)({mul_:function(e,t){var n,r=Object(Q.a)(e,"a","mul"),a=Object(Q.a)(t,"b","mul");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],u.a.runKernelFunc((function(e,t){var n=e.multiply(r,a);return t([r,a]),n}),{a:r,b:a},null,X.Kb)}}),xt=Object(Y.a)({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var a=Object(Q.a)(e,"indices","oneHot","int32"),i=[].concat(_toConsumableArray(a.shape),[t]);return u.a.runKernelFunc((function(e,o){return o([a]),Be(e.oneHot(Be(a,[a.size]),t,n,r),i)}),{indices:a},null,X.Qb,{depth:t,onValue:n,offValue:r})}}),Ct=Object(Y.a)({pow_:function(e,t){var n,r=Object(Q.a)(e,"base","pow"),a=Object(Q.a)(t,"exp","pow");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],u.a.runKernelFunc((function(e,t){var n=e.pow(r,a);return t([r,a,n]),n}),{a:r,b:a},null,X.Tb)}}),St=n(47),Tt=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(_classCallCheck2(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=St.alea(i)}return _createClass2(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}(),At=Object(Y.a)({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0,i=K(e,r),o=new Tt(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}}),Et=n(28);function It(e,t){Object(k.d)(e);var n=Object(Q.c)(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Object(Et.a)(e,null,n,t)}var Rt=n(19);function Ot(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=Ot(e,"float32"),r=Ot(e,"float32");return Object(Rt.a)(n,r)}var a=Object(k.F)(Object(k.N)(e),t);return u.a.makeTensor(a,e,t)}function Nt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");return u.a.runKernelFunc((function(){if(e===t||e<t&&n<0||t<e&&n>1)return Ot([0],r);var a=Math.abs(Math.ceil((t-e)/n)),i=Object(k.F)(a,r);t<e&&1===n&&(n=-1),i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return It(i,r)}),{},null,X.Wb,{start:e,stop:t,step:n,dtype:r})}function Dt(e,t){if((Object(k.A)(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Object(k.A)(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Object(Et.a)(e,[],[],t)}var Pt=Object(Y.a)({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=Object(Q.a)(e,"x","separableConv2d"),u=Object(Q.a)(t,"depthwiseFilter","separableConv2d"),c=Object(Q.a)(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=Be(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");k.b(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),k.b(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank ".concat(u.rank,".")})),k.b(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank ".concat(u.rank,".")})),k.b(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ".concat(c.shape[0],".")})),k.b(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ".concat(c.shape[1],".")}));var f=u.shape[2],d=u.shape[3];k.b(c.shape[2]===f*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be ".concat(f*d,", but got ").concat(c.shape[2],".")}));var p=vt(l,u,r,a,o,i),m=it(p,c,1,"valid",o);return h?Be(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),Ft=Object(Y.a)({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Object(Q.a)(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and dim was ").concat(t));return u.a.runKernelFunc((function(e,r){var a=e.softmax(n,t);return r([a]),a}),{logits:n},null,X.rc,{dim:t})}});function Mt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)Object(k.b)(e.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);Object(k.b)(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}Object(k.b)(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}var Lt=Object(Y.a)({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Object(Q.a)(e,"x","split");return u.a.runKernelFunc((function(e,a){var i=Object(k.I)(n,r.shape)[0],o=Mt(r,t,i);return e.split(r,o,i)}),{x:r},null,X.uc,{numOrSizeSplits:t,axis:n})}}),zt=Object(Y.a)({squeeze_:function(e,t){var n=Object(Q.a)(e,"x","squeeze");return Be(n,Object(k.P)(n.shape,t).newShape)}}),Bt=Object(Y.a)({sub_:function(e,t){var n,r=Object(Q.a)(e,"a","sub"),a=Object(Q.a)(t,"b","sub");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],u.a.runKernelFunc((function(e,t){var n=e.subtract(r,a);return t([r,a]),n}),{a:r,b:a},null,X.Ac)}}),jt=Object(Y.a)({tile_:function(e,t){var n=Object(Q.a)(e,"x","tile",null);return k.b(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")})),u.a.runKernelFunc((function(e,r){var a=e.tile(n,t);return r([n]),a}),{x:n},null,X.Ec,{reps:t},[n])}}),Vt=Object(Y.a)({broadcastTo_:function(e,t){var n=Object(Q.a)(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=Be(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));return 0===o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length?J(n):u.a.runKernelFunc((function(e){return e.tile(n,o)}),{x:n},null,X.u,{shape:t,inputShape:i})}});function qt(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function Ut(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function Wt(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o)throw Error("Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,"."));n.unshift(i)}}return n}var Gt=Object(Y.a)({where_:function(e,t,n){var r=Object(Q.a)(t,"a","where"),a=Object(Q.a)(n,"b","where"),i=Object(Q.a)(e,"condition","where","bool"),o=Wt(r.shape,a.shape),s=Vt(r,o),c=Vt(a,o);return 1===i.rank&&Object(k.b)(i.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})),1!==i.rank&&Object(k.e)(i.shape,c.shape,"Error in where: "),u.a.runKernelFunc((function(e,t){var n=e.select(i,s,c);return t([i]),n}),{condition:i,t:s,e:c},null,X.kc)}}),Ht=Object(Y.a)({zerosLike_:function(e){var t=Object(Q.a)(e,"x","zerosLike");return u.a.runKernelFunc((function(e){return e.zerosLike(t)}),{x:t},null,X.Kc)}}),Kt=Object(Y.a)({imag_:function(e){var t=Object(Q.a)(e,"input","imag");return u.a.runKernelFunc((function(e){return e.imag(t)}),{input:t},null,X.kb)}}),Xt=Object(Y.a)({real_:function(e){var t=Object(Q.a)(e,"input","real");return u.a.runKernelFunc((function(e){return e.real(t)}),{input:t},null,X.Xb)}}),Qt=Object(Y.a)({slice_:function(e,t,n){var r=Object(Q.a)(e,"x","slice");if(0===r.rank)throw new Error("Slicing scalar is not possible");return u.a.runKernelFunc((function(e,a){var i=_slicedToArray2(Pe(r,t,n),2),o=i[0],s=i[1];return be(r,o,s),a([r]),e.slice(r,o,s)}),{x:r},null,X.qc,{begin:t,size:n})}}),Yt=Object(Y.a)({fft_:function(e){return Object(k.b)("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got ".concat(e.dtype,".")})),u.a.runKernelFunc((function(t){var n=e.shape[e.shape.length-1],r=e.as2D(e.size/n,n);return t.fft(r).reshape(e.shape)}),{input:e},null,X.Y)}}),Zt=Object(Y.a)({rfft_:function(e,t){Object(k.b)("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=Qt(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=Ge([e,Ot(s)],e.shape.length-1),r=t}else n=e;var u=Ht(n),c=Be(Object(Rt.a)(n,u),[a,r]),l=Yt(c),h=Math.floor(r/2)+1,f=Xt(l),d=Kt(l),p=Lt(f,[h,r-h],f.shape.length-1),m=Lt(d,[h,r-h],d.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=h,Be(Object(Rt.a)(p[0],m[0]),v)}}),Jt=Object(Y.a)({ifft_:function(e){return Object(k.b)("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got ".concat(e.dtype,".")})),u.a.runKernelFunc((function(t){var n=e.shape[e.shape.length-1],r=Be(e,[e.size/n,n]),a=t.ifft(r);return Be(a,e.shape)}),{input:e},null,X.ib)}}),$t=Object(Y.a)({reverse_:function(e,t){var n=Object(Q.a)(e,"x","reverse");return u.a.runKernelFunc((function(e){var r=Object(k.I)(t,n.shape);if(0===n.rank)return J(n);var a=e.reverse(n,r);return Be(a,n.shape)}),{x:n},null,X.gc,{dims:t})}}),en=Object(Y.a)({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=Be(e,[r,n]);t=Jt(a)}else{var i=[r,2*(n-1)],o=Be(Xt(e),[r,n]),s=Be(Kt(e),[r,n]),u=$t(Qt(o,[0,1],[r,n-2]),1),c=wt($t(Qt(s,[0,1],[r,n-2]),1),Dt(-1)),l=Ge([o,u],1),h=Ge([s,c],1),f=Be(Object(Rt.a)(l,h),[i[0],i[1]]);t=Jt(f)}if(t=Xt(t),3===e.rank&&0!==e.shape[0]){var d=t,p=e.shape[0];t=Be(t,[p,t.shape[0]/p,t.shape[1]]),d.dispose()}return t}});function tn(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return It(a,"float32")}Object(Y.a)({hammingWindow_:function(e){return tn(e,.54,.46)}});var nn=Object(Y.a)({hannWindow_:function(e){return tn(e,.5,.5)}});function rn(e,t,n){return u.a.runKernelFunc((function(r){return r.fill(e,t,n)}),{},null,X.Z,{shape:e,value:t,dtype:n})}function an(e,t,n){if(Object(k.d)(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Object(Q.c)(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Object(Et.a)(e,t,r,n)}var on=Object(Y.a)({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(Qt(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Ge([Qt(e,i,t-s),rn([s],a)]);o.push(u),i+=n}return 0===o.length?an([],[0,t]):Be(Ge(o),[o.length,t])}});function sn(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),k.b(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),k.b(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),k.b(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),k.b(1===t.rank,(function(){return"scores must be a 1D tensor"})),k.b(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", but was ")+t.shape[0]})),k.b(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}function un(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||cn)}(e,t,n);e.splice(r<0?-(r+1):r,0,t)}function cn(e,t){return e>t?1:e<t?-1:0}function ln(e,t,n,r,a){return dn(e,t,n,r,a,0).selectedIndices}function hn(e,t,n,r,a,i){return dn(e,t,n,r,a,0,!1,i,!0)}function fn(e,t,n,r,a,i){return dn(e,t,n,r,a,i,!0)}function dn(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(vn);for(var h=i>0?-.5/i:0,f=[],d=[];f.length<n&&c.length>0;){var p=c.pop(),m=p.score,v=p.boxIndex,g=p.suppressBeginIndex;if(m<a)break;for(var y=!1,_=f.length-1;_>=g;--_){var b=pn(e,v,f[_]);if(b>=r){y=!0;break}if(p.score=p.score*mn(r,h,b),p.score<=a)break}p.suppressBeginIndex=f.length,y||(p.score===m?(f.push(v),d.push(p.score)):p.score>a&&un(c,p,vn))}var k=f.length,w=n-k;s&&w>0&&(f.push.apply(f,_toConsumableArray(new Array(w).fill(0))),d.push.apply(d,_toConsumableArray(new Array(w).fill(0))));var x={selectedIndices:It(f,"int32")};return o&&(x.selectedScores=It(d,"float32")),u&&(x.validOutputs=Dt(k,"int32")),x}function pn(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),f=Math.max(a[1],a[3]),d=(s-i)*(u-o),p=(h-c)*(f-l);if(d<=0||p<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,h),y=Math.min(u,f),_=Math.max(g-m,0)*Math.max(y-v,0);return _/(d+p-_)}function mn(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function vn(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}Object(Y.a)({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:nn;null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2)))));for(var i=on(e,t,n),o=wt(i,a(t)),s=[],u=0;u<i.shape[0];u++)s.push(Zt(Qt(o,[u,0],[1,t]),r));return Ge(s)}}),Object(Y.a)({cropAndResize_:function(e,t,n,r,a,i){var o=Object(Q.a)(e,"image","cropAndResize"),s=Object(Q.a)(t,"boxes","cropAndResize","float32"),c=Object(Q.a)(n,"boxInd","cropAndResize","int32");a=a||"bilinear",i=i||0;var l=s.shape[0];return k.b(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank ".concat(o.rank,".")})),k.b(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(l,",4] but had shape ").concat(s.shape,".")})),k.b(1===c.rank&&c.shape[0]===l,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(l,"] but had shape ").concat(s.shape,".")})),k.b(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(r.length,".")})),k.b(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),k.b("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was "+a})),u.a.runKernelFunc((function(e){return e.cropAndResize(o,s,c,r,a,i)}),{image:o,boxes:s,boxInd:c},null,X.I,{method:a,extrapolationValue:i,cropSize:r})}}),Object(Y.a)({flipLeftRight_:function(e){var t=Object(Q.a)(e,"image","flipLeftRight","float32");return k.b(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")})),u.a.runKernel(X.ab,{image:t},{})}}),Object(Y.a)({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=Object(Q.a)(e,"image","rotateWithOffset","float32");return k.b(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(a.rank,".")})),u.a.runKernel(X.hc,{image:a},{radians:t,fillValue:n,center:r})}}),Object(Y.a)({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=Object(Q.a)(e,"boxes","nonMaxSuppression"),o=Object(Q.a)(t,"scores","nonMaxSuppression"),s=sn(i,o,n,r,a);return u.a.runKernelFunc((function(e){return e.nonMaxSuppression(i,o,n,r,a)}),{boxes:i,scores:o},null,X.Mb,{maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold})}}),Object(Y.a)({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Object(Q.a)(e,"boxes","nonMaxSuppression"),s=Object(Q.a)(t,"scores","nonMaxSuppression"),c=sn(o,s,n,r,a,i),l={maxOutputSize:n=c.maxOutputSize,iouThreshold:r=c.iouThreshold,scoreThreshold:a=c.scoreThreshold,softNmsSigma:i=c.softNmsSigma},h=u.a.runKernel(X.Ob,{boxes:o,scores:s},l);return{selectedIndices:h[0],selectedScores:h[1]}}}),Object(Y.a)({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Object(Q.a)(e,"boxes","nonMaxSuppression"),s=Object(Q.a)(t,"scores","nonMaxSuppression"),c=sn(o,s,n,r,a,null),l=u.a.runKernel(X.Nb,{boxes:o,scores:s},{maxOutputSize:c.maxOutputSize,iouThreshold:c.iouThreshold,scoreThreshold:c.scoreThreshold,padToMaxOutputSize:i});return{selectedIndices:l[0],validOutputs:l[1]}}});var gn=Object(Y.a)({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(Q.a)(e,"images","resizeBilinear");k.b(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(r.rank,".")})),k.b(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var a=r,i=!1;3===r.rank&&(i=!0,a=Be(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var o=_slicedToArray2(t,2),s=o[0],c=o[1],l=u.a.runKernelFunc((function(e,t){return t([a]),e.resizeBilinear(a,s,c,n)}),{images:a},null,X.cc,{alignCorners:n,size:t});return i?Be(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),yn=Object(Y.a)({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(Q.a)(e,"images","resizeNearestNeighbor");k.b(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(r.rank,".")})),k.b(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),k.b("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var a=r,i=!1;3===r.rank&&(i=!0,a=Be(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var o=_slicedToArray2(t,2),s=o[0],c=o[1],l=u.a.runKernelFunc((function(e,t){return t([a]),e.resizeNearestNeighbor(a,s,c,n)}),{images:a},null,X.ec,{alignCorners:n,size:t});return i?Be(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),_n=Object(Y.a)({greaterEqual_:function(e,t){var n,r=Object(Q.a)(e,"a","greaterEqual"),a=Object(Q.a)(t,"b","greaterEqual");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],Wt(r.shape,a.shape),u.a.runKernelFunc((function(e,t){var n=e.greaterEqual(r,a);return t([r,a]),n}),{a:r,b:a},null,X.hb)}}),bn=Object(Y.a)({lessEqual_:function(e,t){var n,r=Object(Q.a)(e,"a","lessEqual"),a=Object(Q.a)(t,"b","lessEqual");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],Wt(r.shape,a.shape),u.a.runKernelFunc((function(e,t){var n=e.lessEqual(r,a);return t([r,a]),n}),{a:r,b:a},null,X.rb)}}),kn=Object(Y.a)({logicalAnd_:function(e,t){var n=Object(Q.a)(e,"a","logicalAnd","bool"),r=Object(Q.a)(t,"b","logicalAnd","bool");return Wt(n.shape,r.shape),u.a.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,X.vb)}}),wn=Object(Y.a)({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(Q.a)(e,"x","expandDims",null);k.b(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(k.b(-(n.rank+1)<=t,(function(){return"Axis must be in the interval [".concat(-(n.rank+1),", ").concat(n.rank,"]")})),t=n.rank+t+1),r.splice(t,0,1),Be(n,r)}}),xn=Object(Y.a)({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(Q.b)(e,"tensors","stack");if(k.b(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return wn(n[0],t);var r=n[0].shape,a=n[0].dtype;k.b(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){k.e(r,e.shape,"All tensors passed to stack must have matching shapes"),k.b(a===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=n.map((function(e){return wn(e,t)}));return Ge(i,t)}}),Cn=Object(Y.a)({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(Q.a)(e,"x","unstack");return k.b(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")})),t<0&&(t+=n.shape.length),u.a.runKernelFunc((function(e){return e.unstack(n,t)}),{value:n},null,X.Ic,{axis:t})}});Object(Y.a)({bandPart_:function(e,t,n){Object(k.b)(t%1==0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),Object(k.b)(n%1==0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=Object(Q.a)(e,"a","bandPart");Object(k.b)(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=_slicedToArray2(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(t<=o))throw new Error("bandPart(): numLower (".concat(t,") must not be greater than the number of rows (").concat(o,")."));if(!(n<=s))throw new Error("bandPart(): numUpper (".concat(n,") must not be greater than the number of columns (").concat(s,")."));t<0&&(t=o),n<0&&(n=s);var u=Be(Nt(0,o,1,"int32"),[-1,1]),c=Nt(0,s,1,"int32"),l=Bt(u,c),h=kn(bn(l,Dt(+t,"int32")),_n(l,Dt(-n,"int32"))),f=Ot([o,s],r.dtype);return Be(xn(Cn(Be(r,[-1,o,s])).map((function(e){return Gt(h,e,f)}))),a)}});var Sn=Object(Y.a)({abs_:function(e){var t=Object(Q.a)(e,"x","abs");return u.a.runKernelFunc((function(e,n){return n([t]),"complex64"===t.dtype?e.complexAbs(t):e.abs(t)}),{x:t},null,X.a)}}),Tn=Object(Y.a)({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(Q.a)(e,"x","min");return u.a.runKernelFunc((function(e,a){var i=Object(k.I)(t,r.shape),o=i,s=ht(o,r.rank),u=r;null!=s&&(u=pt(r,s),o=dt(o.length,r.rank));var c=e.min(u,o);null!=s&&u.dispose();var l=c;if(n){var h=ct(l.shape,i);l=Be(c,h),c.dispose()}return a([r,l]),l}),{x:r},null,X.Gb,{axis:t,keepDims:n})}}),An=Object(Y.a)({sqrt_:function(e){var t=Object(Q.a)(e,"x","sqrt");return u.a.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{x:t},null,X.vc)}}),En=Object(Y.a)({square_:function(e){var t=Object(Q.a)(e,"x","square");return u.a.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},[t],[])}}),In=Object(Y.a)({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(Q.a)(e,"x","sum");return"bool"===r.dtype&&(r=Z(r,"int32")),u.a.runKernelFunc((function(e,a){a([r]);var i=Object(k.I)(t,r.shape),o=ht(i,r.rank),s=i,u=r;null!=o&&(u=pt(r,o),s=dt(s.length,r.rank));var c=e.sum(u,s);if(n){var l=ct(c.shape,i);c=Be(c,l)}return c}),{x:r},null,X.Bc,{axis:t,keepDims:n})}}),Rn=Object(Y.a)({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===t.rank)return Sn(t);if(1!==t.rank&&null===r)return e(Be(t,[-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return In(Sn(t),r);if(n===1/0)return bt(Sn(t),r);if(n===-1/0)return Tn(Sn(t),r);if("euclidean"===n||2===n)return An(In(Ct(Sn(t),Dt(2,"int32")),r));throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return bt(In(Sn(t),r[0]),r[1]-1);if(n===1/0)return bt(In(Sn(t),r[1]),r[0]);if(n===-1/0)return Tn(In(Sn(t),r[1]),r[0]);if("fro"===n||"euclidean"===n)return An(In(En(t),r));throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=Object(Q.a)(e,"x","norm"),t,n),i=a.shape;if(r){var o=Object(k.I)(n,e.shape);i=ct(a.shape,o)}return Be(a,i)}});function On(e){Object(c.b)().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Nn(){return u.a}function Dn(e,t){return u.a.tidy(e,t)}function Pn(e){Object(Le.a)(e).forEach((function(e){return e.dispose()}))}function Fn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return u.a.registerBackend(e,t,n)}Object(Y.a)({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,Object(k.b)(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){Object(k.b)(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: (".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=Lt(e,e.shape[0],0).map((function(e){return zt(e,[0])}))),Object(k.b)(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds number of dimensions (").concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(u.a.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=wt(In(wt(n[a],t)),n[a]);t=Bt(t,i)}return yt(t,Rn(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?xn(n,0):n}}),Object(H.d)(On);var Mn,Ln=Object(Y.a)({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=K([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=Be(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return jt(wn(s,0),[n[0],1,1]);if(2===n.length)return jt(wn(wn(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return jt(wn(wn(wn(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received ".concat(n.length,"D."))}}),zn=Object(Y.a)({greater_:function(e,t){var n,r=Object(Q.a)(e,"a","greater"),a=Object(Q.a)(t,"b","greater");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],Wt(r.shape,a.shape),u.a.runKernelFunc((function(e){return e.greater(r,a)}),{a:r,b:a},null,X.gb)}}),Bn=Object(Y.a)({neg_:function(e){var t=Object(Q.a)(e,"x","neg");return u.a.runKernelFunc((function(e){return e.neg(t)}),{x:t},null,X.Lb)}});function jn(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.a.tidy((function(){Object(k.b)(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=Ln(n),i=J(e),o=an([[1]],[1,1]),s=J(o),c=n>=r?r:n,l=function(e){var t,c=i,l=s,h=a;t=_slicedToArray2(u.a.tidy((function(){var t=Qt(i,[e,e],[n-e,1]),u=Rn(t),c=Qt(i,[e,e],[1,1]),l=Gt(zn(c,0),an([[-1]]),an([[1]])),h=Bt(c,wt(l,u)),f=yt(t,h);s=1===f.shape[0]?J(o):Ge([o,Qt(f,[1,0],[f.shape[0]-1,f.shape[1]])],0);var d=Bn(yt(_t(l,h),u)),p=Qt(i,[e,0],[n-e,r]),m=wt(d,s),v=pt(s);if(0===e)i=Bt(p,_t(m,_t(v,p)));else{var g=Bt(p,_t(m,_t(v,p)));i=Ge([Qt(i,[0,0],[e,r]),g],0)}var y=pt(m),_=Qt(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=Bt(_,_t(_t(_,s),y));else{var b=Bt(_,_t(_t(_,s),y));a=Ge([Qt(a,[0,0],[n,e]),b],1)}return[s,i,a]})),3),s=t[0],i=t[1],a=t[2],Pn([c,l,h])},h=0;h<c;++h)l(h);return!t&&n>r&&(a=Qt(a,[0,0],[n,r]),i=Qt(i,[0,0],[r,r])),[a,i]}))}function Vn(e){return u.a.customGrad(e)}function qn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=qn(e,"float32"),r=Ot(e,"float32");return Object(Rt.a)(n,r)}var a=Object(k.D)(Object(k.N)(e),t);return u.a.makeTensor(a,e,t)}Object(Y.a)({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Object(k.b)(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank "+e.rank})),2===e.rank)return jn(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=Cn(Be(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=_slicedToArray2(jn(e,t),2),r=n[0],o=n[1];a.push(r),i.push(o)})),[Be(xn(a,0),e.shape),Be(xn(i,0),e.shape)]}}),function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Mn||(Mn={}));var Un=Object(Y.a)({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(Q.a)(e,"x","mean"),a=Object(k.I)(t,r.shape),i=ut(r.shape,a)[1],o=Object(k.N)(i),s={x:r},c={axis:t,keepDims:n},l=function(){var e=Dt(o),a=e.dtype===r.dtype?r:Z(r,e.dtype),i=yt(a,e);return In(i,t,n)};return Vn((function(e){return{value:u.a.runKernelFunc(l,s,null,X.Fb,c),gradFunc:function(t){var n=e.shape.slice();a.forEach((function(e){n[e]=1}));var r=Be(t,n);return yt(wt(r,qn(e.shape,"float32")),o)}}}))(r)}}),Wn=Object(Y.a)({notEqual_:function(e,t){var n,r=Object(Q.a)(e,"a","notEqual"),a=Object(Q.a)(t,"b","notEqual");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],Wt(r.shape,a.shape),u.a.runKernelFunc((function(e){return e.notEqual(r,a)}),{a:r,b:a},null,X.Pb)}}),Gn=Object(Y.a)({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Mn.SUM_BY_NONZERO_WEIGHTS,r=Object(Q.a)(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=Object(Q.a)(t,"weights","computeWeightedLoss"));var i=null==a?r:wt(r,a);if(n===Mn.NONE)return i;if(n===Mn.SUM)return In(i);if(n===Mn.MEAN){if(null==a)return Un(i);var o=r.size/a.size,s=yt(In(i),In(a));return o>1?yt(s,Dt(o)):s}if(n===Mn.SUM_BY_NONZERO_WEIGHTS){if(null==a)return yt(In(i),Dt(r.size));var u=wt(a,qn(r.shape)),c=Z(In(Wn(u,Dt(0))),"float32");return yt(In(i),c)}throw Error("Unknown reduction: "+n)}});Object(Y.a)({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Mn.SUM_BY_NONZERO_WEIGHTS,a=Object(Q.a)(e,"labels","absoluteDifference"),i=Object(Q.a)(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=Object(Q.a)(n,"weights","absoluteDifference")),Object(k.e)(a.shape,i.shape,"Error in absoluteDifference: ");var s=Sn(Bt(a,i));return Gn(s,o,r)}}),Object(Y.a)({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Mn.SUM_BY_NONZERO_WEIGHTS,i=Object(Q.a)(e,"labels","cosineDistance"),o=Object(Q.a)(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Object(Q.a)(r,"weights","cosineDistance")),Object(k.e)(i.shape,o.shape,"Error in cosineDistance: ");var u=Dt(1),c=Bt(u,In(wt(i,o),n,!0));return Gn(c,s,a)}});var Hn=Object(Y.a)({relu_:function(e){var t=Object(Q.a)(e,"x","relu");return u.a.runKernelFunc((function(e,n){return n([t]),"bool"===t.dtype?Z(t,"int32"):e.relu(t)}),{x:t},null,X.Zb)}});Object(Y.a)({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Mn.SUM_BY_NONZERO_WEIGHTS,a=Object(Q.a)(e,"labels","hingeLoss"),i=Object(Q.a)(t,"predictions","hingeLoss"),o=null;null!=n&&(o=Object(Q.a)(n,"weights","hingeLoss")),Object(k.e)(a.shape,i.shape,"Error in hingeLoss: ");var s=Dt(1);a=Bt(wt(Dt(2),a),s);var u=Hn(Bt(s,wt(a,i)));return Gn(u,o,r)}});var Kn=Object(Y.a)({minimum_:function(e,t){var n,r=Object(Q.a)(e,"a","minimum"),a=Object(Q.a)(t,"b","minimum");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],"bool"===r.dtype&&(r=Z(r,"int32"),a=Z(a,"int32")),Wt(r.shape,a.shape),u.a.runKernelFunc((function(e,t){var n=e.minimum(r,a);return t([r,a]),n}),{a:r,b:a},null,X.Hb)}});Object(Y.a)({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Mn.SUM_BY_NONZERO_WEIGHTS,i=Object(Q.a)(e,"labels","huberLoss"),o=Object(Q.a)(t,"predictions","huberLoss"),s=null;null!=n&&(s=Object(Q.a)(n,"weights","huberLoss")),Object(k.e)(i.shape,o.shape,"Error in huberLoss: ");var u=Dt(r),c=Sn(Bt(o,i)),l=Kn(c,u),h=Bt(c,l),f=ze(wt(Dt(.5),En(l)),wt(u,h));return Gn(f,s,a)}});var Xn=Object(Y.a)({log_:function(e){var t=Object(Q.a)(e,"x","log");return u.a.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},null,X.sb)}});Object(Y.a)({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Mn.SUM_BY_NONZERO_WEIGHTS,i=Object(Q.a)(e,"labels","logLoss"),o=Object(Q.a)(t,"predictions","logLoss"),s=null;null!=n&&(s=Object(Q.a)(n,"weights","logLoss")),Object(k.e)(i.shape,o.shape,"Error in logLoss: ");var u=Dt(1),c=Dt(r),l=Bn(wt(i,Xn(ze(o,c)))),h=wt(Bt(u,i),Xn(ze(Bt(u,o),c))),f=Bt(l,h);return Gn(f,s,a)}});var Qn=Object(Y.a)({squaredDifference_:function(e,t){var n,r=Object(Q.a)(e,"a","squaredDifference"),a=Object(Q.a)(t,"b","squaredDifference");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],Wt(r.shape,a.shape),u.a.runKernelFunc((function(e,t){var n=e.squaredDifference(r,a);return t([r,a]),n}),{a:r,b:a},null,X.xc,{})}});Object(Y.a)({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Mn.SUM_BY_NONZERO_WEIGHTS,a=Object(Q.a)(e,"labels","meanSquaredError"),i=Object(Q.a)(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=Object(Q.a)(n,"weights","meanSquaredError")),Object(k.e)(a.shape,i.shape,"Error in meanSquaredError: ");var s=Qn(a,i);return Gn(s,o,r)}});var Yn=Object(Y.a)({exp_:function(e){var t=Object(Q.a)(e,"x","exp");return u.a.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},null,X.W)}}),Zn=Object(Y.a)({log1p_:function(e){var t=Object(Q.a)(e,"x","log1p");return u.a.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{x:t},null,X.tb)}});Object(Y.a)({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Mn.SUM_BY_NONZERO_WEIGHTS,i=Object(Q.a)(e,"multiClassLabels","sigmoidCrossEntropy"),o=Object(Q.a)(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Object(Q.a)(n,"weights","sigmoidCrossEntropy")),Object(k.e)(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Dt(r),c=Dt(1),l=Dt(.5);i=ze(wt(i,Bt(c,u)),wt(l,u))}var h=function(e,t){var n=Object(Q.a)(e,"labels","sigmoidCrossEntropyWithLogits"),r=Object(Q.a)(t,"logits","sigmoidCrossEntropyWithLogits");Object(k.e)(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Hn(r),i=wt(r,n),o=Zn(Yn(Bn(Sn(r))));return ze(Bt(a,i),o)}(i,o);return Gn(h,s,a)}});var Jn=Object(Y.a)({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(Q.a)(e,"x","logSumExp"),a=Object(k.I)(t,r.shape),i=bt(r,a,!0),o=Bt(r,i),s=Yn(o),u=In(s,a),c=Xn(u),l=ze(Be(i,c.shape),c);if(n){var h=ct(l.shape,a);return Be(l,h)}return l}});Object(Y.a)({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Mn.SUM_BY_NONZERO_WEIGHTS,i=Object(Q.a)(e,"onehotLabels","softmaxCrossEntropy"),o=Object(Q.a)(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Object(Q.a)(n,"weights","softmaxCrossEntropy")),Object(k.e)(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Dt(r),c=Dt(1),l=Dt(i.shape[1]);i=ze(wt(i,Bt(c,u)),yt(u,l))}var h=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ".concat(t.rank," and dim was ")+n);return Vn((function(e,t,r){var a=Jn(t,[n],!0),i=Bt(Z(t,"float32"),a);r([e,i]);var o=Bn(wt(i,e));return{value:In(o,[n]),gradFunc:function(e,t){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=ct(e.shape,[n]);return[wt(Be(e,o),Bt(Z(a,"float32"),Yn(i))),wt(Be(e,o),Bt(Yn(i),Z(a,"float32")))]}}}))(e,t)}(i,o);return Gn(h,s,a)}});var $n=n(25),er=n(75),tr=Object(Y.a)({elu_:function(e){var t=Object(Q.a)(e,"x","elu");return u.a.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{x:t},null,X.S)}}),nr=Object(Y.a)({prelu_:function(e,t){var n=Object(Q.a)(e,"x","prelu"),r=Object(Q.a)(t,"alpha","prelu");return u.a.runKernelFunc((function(e,t){var a=e.prelu(n,r);return t([n,r]),a}),{x:n,alpha:r},null,X.Ub)}}),rr=Object(Y.a)({relu6_:function(e){var t=Object(Q.a)(e,"x","relu6");return u.a.runKernelFunc((function(e,n){return n([t]),"bool"===t.dtype?Z(t,"int32"):e.relu6(t)}),{x:t},null,X.ac)}}),ar=Object(Y.a)({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(Q.a)(e,"x","step");return u.a.runKernelFunc((function(e){return e.step(n,t)}),{x:n},null,X.yc,{alpha:t})}});function ir(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return wt(e,ar(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function or(e,t){var n=t,r=Ut(e.shape,t.shape);return r.length>0&&(n=In(n,r)),Be(n,e.shape)}function sr(e,t,n){if("linear"===t)return e;if("relu"===t)return Hn(e);if("elu"===t)return tr(e);if("relu6"===t)return rr(e);if("prelu"===t)return nr(e,n);throw new Error("Unknown fused activation ".concat(t,"."))}var ur=function(e,t){return!(e>0)||"linear"===t},cr=30;function lr(e){return e<=cr?e:Object(k.G)(e,Math.floor(Math.sqrt(e)))}function hr(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function fr(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function dr(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2==1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function pr(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];a.push(r?e[0]/n:e[0]*n);for(var i=1;i<e.length;++i)a.push(i<=t.length?r?t[i-1]*e[i]:e[i]/t[i-1]:e[i]);return a}function mr(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function vr(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function gr(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[t.rank-1]," vs. ").concat(e.rank));if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var n=t.shape,r=n[n.length-1],a=1,i=0;i<n.length-1;++i)a*=n[i];var o=e.shape,s=n.slice();s.pop();for(var u=1,c=r;c<e.rank;++c)u*=o[c],s.push(o[c]);var l=[].concat(_toConsumableArray(Object(k.j)(e.shape).map((function(e){return e/u}))),[1]).slice(0,r);return[s,a,u,l]}function yr(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < "+(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != "+(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function _r(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}yr(n,t,e)}function br(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:Object(k.N)(t.shape)/u,sliceSize:o,strides:[].concat(_toConsumableArray(Object(k.j)(n.slice(0,a))),[1]),outputSize:Object(k.N)(n)}}var kr=1.7580993408473768,wr=1.0507009873554805,xr=.3275911,Cr=.254829592,Sr=-.284496736,Tr=1.421413741,Ar=-1.453152027,Er=1.061405429;function Ir(){var e;Object(c.b)().getBool("IS_TEST")||(e=console).warn.apply(e,arguments)}function Rr(){var e;Object(c.b)().getBool("IS_TEST")||(e=console).log.apply(e,arguments)}function Or(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function Nr(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function Dr(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function Pr(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function Fr(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Mr(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Lr(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function zr(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Br(e,t){var n,r=!1;for(e<=cr?(n=e,r=!0):n=Object(k.G)(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Object(k.G)(e,n+1);return n}function jr(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)r.push(i!==t?e[i]:n);return r}function Vr(e,t,n){for(var r=e.shape[n],a=[],i=1,o=1,s=0;s<n;s++)a.push(e.shape[s]),i*=e.shape[s];for(var u=0;u<t.rank;u++)a.push(t.shape[u]);for(var c=n+1;c<e.rank;c++)a.push(e.shape[c]),o*=e.shape[c];return{batchSize:i,sliceSize:o,dimSize:r,outputShape:a}}function qr(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=Ot(e.shape),a=Z(e,"float32"),i=n.complex(a,r);return r.dispose(),a.dispose(),i}if(!Object(k.p)(e.dtype,t))return u.a.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e),s=Z(o,t);return o.dispose(),s}if("int32"===t)return n.int(e);if("bool"===t){var c=Dt(0,e.dtype),l=n.notEqual(e,c);return c.dispose(),l}throw new Error("Error in Cast: failed to cast ".concat(e.dtype," to ").concat(t))}function Ur(e,t){return u.a.makeTensorFromDataId(e.dataId,t,e.dtype)}function Wr(e,t,n){var r=(t-e)/(n-1),a=Object(k.F)(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return It(a,"float32")}var Gr=n(46);function Hr(e,t,n){var r=new Array(e.rank).fill(0),a=e.shape.slice();return t.map((function(t){var i=_toConsumableArray(a);i[n]=t;var o=Qt(e,r,i);return r[n]+=t,o}))}function Kr(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=K(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a.toTensor()}function Xr(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=Object(k.o)(n,o*r),c=Object(k.o)("int32",o*r),l=0;l<o;l++){for(var h=l*s,f=e.subarray(h,h+s),d=[],p=0;p<f.length;p++)d.push({value:f[p],index:p});d.sort((function(e,t){return t.value-e.value}));for(var m=l*r,v=u.subarray(m,m+r),g=c.subarray(m,m+r),y=0;y<r;y++)v[y]=d[y].value,g[y]=d[y].index}var _=t.slice();return _[_.length-1]=r,[Object(We.a)(u,_,n),Object(We.a)(c,_,"int32")]}function Qr(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=K(e,"int32"),i=K([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]);i.values.set(s,o*e.length)}return i.toTensor()}var Yr=n(37),Zr={kernelName:X.a,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wt(e,ar(Z(n,"float32"),-1))}}}},Jr={kernelName:X.b,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){var t=En(Z(n,"float32")),r=An(Bt(Dt(1),t));return Bn(yt(e,r))}}}},$r={kernelName:X.c,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){var t=An(Bt(En(Z(n,"float32")),1));return yt(e,t)}}}},ea={kernelName:X.d,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Wt(r.shape,a.shape);return{a:function(){var t=e,n=Ut(r.shape,i);return n.length>0&&(t=In(t,n)),Be(t,r.shape)},b:function(){var t=e,n=Ut(a.shape,i);return n.length>0&&(t=In(t,n)),Be(t,a.shape)}}}},ta={kernelName:X.e,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},na={kernelName:X.h,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return Ht(n)}}}},ra={kernelName:X.i,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return Ht(n)}}}},aa={kernelName:X.j,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return yt(e,An(Bt(Dt(1),En(Z(n,"float32")))))}}}},ia={kernelName:X.k,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){var t=An(ze(Dt(1),En(Z(n,"float32"))));return yt(e,t)}}}},oa={kernelName:X.m,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Wt(r.shape,a.shape);return{a:function(){var t=ze(En(r),En(a)),n=wt(e,yt(a,t)),o=Ut(r.shape,i);return o.length>0&&(n=In(n,o)),Be(n,r.shape)},b:function(){var t=ze(En(r),En(a)),n=Bn(wt(e,yt(r,t))),o=Ut(a.shape,i);return o.length>0&&(n=In(n,o)),Be(n,a.shape)}}}},sa={kernelName:X.l,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return yt(e,ze(En(Z(n,"float32")),1))}}}},ua={kernelName:X.n,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return yt(e,Bt(Dt(1),En(Z(n,"float32"))))}}}},ca=Object(Y.a)({avgPool3dBackprop_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1],i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=Object(Q.a)(e,"dy","avgPool3dBackprop"),c=Object(Q.a)(t,"input","avgPool3dBackprop"),l=s,h=c,f=!1;4===c.rank&&(f=!0,l=Be(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),h=Be(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),k.b(5===l.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+l.rank+"."})),k.b(5===h.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+h.rank+"."})),k.b(rt(r,a),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides ".concat(r," and dilations '").concat(a,"'")})),null!=o&&k.b(k.v(i),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")}));var d=u.a.runKernelFunc((function(e){var t=Xe(h.shape,n,r,a,i,o);return e.avgPool3dBackprop(l,h,t)}),{dy:l,input:h},null,X.q,{filterSize:n,strides:r,dilations:a,pad:i,dimRoundingMode:o});return f?Be(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),la={kernelName:X.p,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.filterSize,i=n.strides,o=n.dilations,s=n.pad,u=n.dimRoundingMode,c=null==o?[1,1,1]:o;return{x:function(){return ca(e,r,a,i,c,s,u)}}}},ha=Object(Y.a)({avgPoolBackprop_:function(e,t,n,r,a){var i=Object(Q.a)(e,"dy","avgPoolBackprop"),o=Object(Q.a)(t,"input","avgPoolBackprop");k.b(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,c=i,l=!1;3===o.rank&&(l=!0,s=Be(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=Be(i,[1,i.shape[0],i.shape[1],i.shape[2]])),k.b(4===c.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),k.b(4===s.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+s.rank+"."}));var h=u.a.runKernelFunc((function(e){var t=Ke(s.shape,n,r,1,a);return e.avgPoolBackprop(c,s,t)}),{dy:c,input:s},null,X.r,{filterSize:n,strides:r,pad:a});return l?Be(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),fa={kernelName:X.o,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return ha(e,r,a,i,o)}}}},da={kernelName:X.s,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return _t(e,i,!1,!1)},b:function(){return _t(e,a,!0,!1)}}:o&&!s?{a:function(){return _t(i,e,!1,!0)},b:function(){return _t(a,e,!1,!1)}}:{a:function(){return _t(i,e,!0,!0)},b:function(){return _t(e,a,!0,!0)}}:{a:function(){return _t(e,i,!1,!0)},b:function(){return _t(a,e,!0,!1)}}}},pa=Object(Y.a)({spaceToBatchND_:function(e,t,n){var r=Object(Q.a)(e,"x","spaceToBatchND");return k.b(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),k.b(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),k.b(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())})),u.a.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{x:r},null,X.tc,{blockShape:t,paddings:n})}}),ma={kernelName:X.t,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return pa(e,r,a)}}}},va={kernelName:X.u,gradFunc:function(e,t,n){for(var r=n.inputShape,a=n.shape,i=Array.from(a),o=r.length-1;o>=0;o--)if(r[o]===a[o])i[o]=1;else if(1!==r[o])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(a,"]."));for(var s=[],u=0;u<i.length;u++)i[u]>1&&s.push(u);return{x:function(){return In(e,s,!0)}}}},ga={kernelName:X.v,gradFunc:function(e){return{x:function(){return e.clone()}}}},ya={kernelName:X.w,gradFunc:function(e){return{x:function(){return Ht(e)}}}},_a={kernelName:X.x,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return Gt(kn(_n(r,a),bn(r,i)),e,Ht(e))}}}},ba={kernelName:X.z,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=n.axis,i=Object(k.I)(a,t[0].shape)[0],o=r.map((function(e){return e[i]}));return Lt(e,o,i).map((function(e){return function(){return e}}))}},ka=Object(Y.a)({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Be(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c=t;3===c.rank&&(c=Be(t,[1,t.shape[0],t.shape[1],t.shape[2]])),k.b(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),k.b(4===c.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+c.shape+"."})),k.b(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var l="NHWC"===i?s.shape[3]:s.shape[1],h="NHWC"===i?c.shape[3]:c.shape[1];return k.b(l===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(l,") must match input depth in filter (").concat(n[2],".")})),k.b(h===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(h,") must match output depth for filter (").concat(n[3],").")})),null!=o&&k.b(k.v(a),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(a,".")})),u.a.runKernelFunc((function(e){var t=at(i),u=Qe(s.shape,n,r,1,a,o,!1,t);return e.conv2dDerFilter(s,c,u)}),{x:s,dy:c},null,X.B,{strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n})}}),wa=Object(Y.a)({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;k.b(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,c=t,l=!1;3===t.rank&&(l=!0,c=Be(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),k.b(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),k.b(4===c.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+c.rank})),k.b(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var h="NHWC"===i?s[3]:s[1],f="NHWC"===i?c.shape[3]:c.shape[1];k.b(h===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(h,") must match input depth for filter ").concat(n.shape[2],".")})),k.b(f===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must match output depth for filter ").concat(n.shape[3],".")})),null!=o&&k.b(k.v(a),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(a,".")}));var d=u.a.runKernelFunc((function(e,t){var u=at(i),l=Qe(s,n.shape,r,1,a,o,!1,u),h=e.conv2dDerInput(c,n,l);return t([c,n]),h}),{dy:c,filter:n},null,X.C,{strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s});return l?Be(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),xa={kernelName:X.A,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return k.b(nt(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return wa(a.shape,e,i,s,u,c)},filter:function(){return ka(a,e,i.shape,s,u,c)}}}},Ca={kernelName:X.C,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return it(e,i,o,s,u,1,c)},filter:function(){return ka(e,a,i.shape,o,s,u,c)}}}},Sa=Object(Y.a)({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=Be(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;return 4===o.rank&&(o=Be(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),k.b(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."})),k.b(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),k.b(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),k.b(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must match input depth in filter (").concat(n[3],".")})),k.b(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must match output depth for filter (").concat(n[4],").")})),u.a.runKernelFunc((function(e){var t=Ye(i.shape,n,r,1,a);return e.conv3dDerFilter(i,o,t)}),{x:i,dy:o},null,X.E,{strides:r,pad:a,filterShape:n})}}),Ta=Object(Y.a)({conv3DBackpropInput_:function(e,t,n,r,a){k.b(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=Be(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var c=i[4],l=o.shape[4];k.b(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."})),k.b(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),k.b(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),k.b(c===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(c,") must match input depth for filter ").concat(n.shape[3],".")})),k.b(l===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(l,") must match output depth for filter ").concat(n.shape[4],".")}));var h=u.a.runKernelFunc((function(e){var t=Ye(i,n.shape,r,1,a);return e.conv3dDerInput(o,n,t)}),{dy:o,filter:n},null,X.F,{pad:a,strides:r,inputShape:i});return s?Be(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}}),Aa={kernelName:X.D,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;k.b(nt(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=_slicedToArray2(t,2),s=o[0],u=o[1];return{x:function(){return Ta(s.shape,e,u,a,i)},filter:function(){return Sa(s,e,u.shape,a,i)}}}},Ea=Object(Y.a)({sin_:function(e){var t=Object(Q.a)(e,"x","sin");return u.a.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},null,X.oc)}}),Ia={kernelName:X.G,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wt(Bn(Ea(Z(n,"float32"))),e)}}}},Ra=Object(Y.a)({sinh_:function(e){var t=Object(Q.a)(e,"x","sinh");return u.a.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{x:t},null,X.pc)}}),Oa={kernelName:X.H,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wt(Ra(Z(n,"float32")),e)}}}},Na={kernelName:X.J,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=ht([a],r.rank),n=mt(e,a,i,!o);return null!=t&&(n=pt(n,t)),n}}}},Da=Object(Y.a)({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Be(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c=t;return 3===c.rank&&(c=Be(t,[1,t.shape[0],t.shape[1],t.shape[2]])),u.a.runKernelFunc((function(t){var u=Qe(e.shape,n,r,i,a,o,!0);return t.depthwiseConv2DDerFilter(s,c,u)}),{x:s,dy:c},null,X.M,{strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n})}}),Pa=Object(Y.a)({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,c=!1;3===t.rank&&(c=!0,s=Be(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var l=u.a.runKernelFunc((function(t){var u=Qe(e,n.shape,r,i,a,o,!0);return t.depthwiseConv2DDerInput(s,n,u)}),{dy:s,filter:n},null,X.N,{strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e});return c?Be(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),Fa={kernelName:X.L,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;k.b(nt(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '".concat(s,"'")}));var u=_slicedToArray2(t,2),c=u[0],l=u[1];return k.b(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ".concat(c.rank,".")})),k.b(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ".concat(l.rank,".")})),k.b(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input channels (".concat(c.shape[3],") must match the inChannels dimension in filter ").concat(l.shape[2],".")})),k.b(rt(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ".concat(a," and dilations '").concat(s,"'.")})),null!=o&&k.b(k.v(i),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")})),{x:function(){return Pa(c.shape,e,l,a,i,r,o)},filter:function(){return Da(c,e,l.shape,a,i,r,o)}}}},Ma={kernelName:X.O,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return u.a.runKernel(X.Q,o,n)},filter:function(){return u.a.runKernel(X.P,s,n)}}}},La={kernelName:X.R,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Wt(r.shape,a.shape);return{a:function(){var t=yt(e,Z(a,"float32")),n=Ut(r.shape,i);return n.length>0?Be(In(t,n),r.shape):t},b:function(){var t=wt(e,Z(r,"float32")),n=Ut(a.shape,i);n.length>0&&(t=Be(In(t,n),a.shape));var o=En(a);return Bn(yt(t,Z(o,"float32")))}}}},za={kernelName:X.S,outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0],r=function(t){return t.eluDer(e,n)},a={dy:e,y:n};return{x:function(){return u.a.runKernelFunc(r,a,null,X.T)}}}},Ba={kernelName:X.V,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0],r=wt(Yn(Bn(En(n))),2/Math.sqrt(Math.PI));return{x:function(){return wt(e,r)}}}},ja={kernelName:X.W,outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wt(e,n)}}}},Va={kernelName:X.X,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wt(e,Yn(n))}}}},qa={kernelName:X.bb,gradFunc:function(e){return{x:function(){return Ht(e)}}}},Ua={kernelName:X.cb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Wt(r.shape,a.shape);return{a:function(){var t=yt(e,Z(a,"float32")),n=Ut(r.shape,i);return n.length>0?Be(In(t,n),r.shape):t},b:function(){var t=wt(e,Z(r,"float32")),n=Ut(a.shape,i);n.length>0&&(t=Be(In(t,n),a.shape));var o=En(a);return Bn(yt(t,Z(o,"float32")))}}}},Wa=Object(Y.a)({rsqrt_:function(e){var t=Object(Q.a)(e,"x","rsqrt");return u.a.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},null,X.jc)}}),Ga={kernelName:X.eb,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=_slicedToArray2(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?Dt(1):u,l=Ut(o.shape,i.shape),h=[];if(1===o.rank){for(var f=0;f<i.shape.length-1;++f)h.push(i.shape[f]);h.push(1)}var d=Bt(i,o),p=wt(e,c),m=Wa(ze(s,Dt(r))),v=wt(wt(wt(m,m),m),Dt(-.5));return{x:function(){return Be(wt(wt(e,1===o.rank?jt(Be(m,[1,1,1,o.shape[0]]),h):m),c),i.shape)},mean:function(){var e=wt(wt(m,Dt(-1)),p);return 1===o.rank&&(e=In(e,l)),Be(e,o.shape)},variance:function(){var e=wt(wt(v,d),p);return 1===o.rank&&(e=In(e,l)),Be(e,o.shape)},scale:function(){var t=wt(d,m),n=wt(e,t);return 1===o.rank&&(n=In(n,l)),Be(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=In(t,l)),Be(t,o.shape)}}}},Ha=Object(Y.a)({unsortedSegmentSum_:function(e,t,n){var r=Object(Q.a)(e,"x","unsortedSegmentSum"),a=Object(Q.a)(t,"segmentIds","unsortedSegmentSum","int32");return Object(k.b)(Object(k.v)(n),(function(){return"numSegments must be of dtype int"})),u.a.runKernelFunc((function(e,t){var i=e.unsortedSegmentSum(r,a,n);return t([a]),i}),{x:r,segmentIds:a},null,X.Jc,{numSegments:n})}}),Ka={kernelName:X.fb,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.axis,s=Object(k.I)(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,h=Xa(0,u),f=Xa(u+1,u+1+l),d=Qa([r,[n],c]),p=Be(e,d),m=Be(i,[n]),v=Qa([[u],h,f]),g=pt(p,v),y=Ha(g,m,a.shape[s]),_=ft(v);return y=pt(y,_)},indices:function(){return i}}}};function Xa(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Qa(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Ya={kernelName:X.hb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1];return{a:function(){return Ht(r)},b:function(){return Ht(a)}}}},Za={kernelName:X.jb,gradFunc:function(e){return{x:function(){return Z(e,"float32")}}}},Ja={kernelName:X.lb,gradFunc:function(e){return{x:function(){return Ht(e)}}}},$a={kernelName:X.mb,gradFunc:function(e){return{x:function(){return Ht(e)}}}},ei={kernelName:X.nb,gradFunc:function(e){return{x:function(){return Ht(e)}}}},ti={kernelName:X.tb,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return yt(e,ze(n,1))}}}},ni={kernelName:X.sb,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return yt(e,Z(n,"float32"))}}}},ri={kernelName:X.ub,inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.axis;return{logits:function(){var t=Yn(r);return Bt(e,wt(In(e,a,!0),t))}}}},ai=Object(Y.a)({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5;return u.a.runKernelFunc((function(s){return s.LRNGrad(n,e,t,r,a,i,o)}),{x:e,y:t,dy:n},null,X.pb,{depthRadius:r,bias:a,alpha:i,beta:o})}}),ii={kernelName:X.ob,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return ai(a,i,e,o,s,u,c)}}}},oi=Object(Y.a)({equal_:function(e,t){var n,r=Object(Q.a)(e,"a","equal"),a=Object(Q.a)(t,"b","equal");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],Wt(r.shape,a.shape),u.a.runKernelFunc((function(e){return e.equal(r,a)}),{a:r,b:a},null,X.U)}});function si(e,t,n,r){return t.rank<n.rank&&(t=Be(t,ct(t.shape,r))),e.rank<n.rank&&(e=Be(e,ct(e.shape,r))),{x:function(){return wt(e,Z(oi(n,t),e.dtype))}}}for(var ui={kernelName:X.yb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=si(e,t[1],a,k.I(r,a.shape));return{x:function(){return i.x()}}}},ci=Object(Y.a)({less_:function(e,t){var n,r=Object(Q.a)(e,"a","less"),a=Object(Q.a)(t,"b","less");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],Wt(r.shape,a.shape),u.a.runKernelFunc((function(e){return e.less(r,a)}),{a:r,b:a},null,X.qb)}}),li={kernelName:X.Eb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1];return{a:function(){return wt(e,Z(_n(r,a),"float32"))},b:function(){return wt(e,Z(ci(r,a),"float32"))}}}},hi=Object(Y.a)({maxPool3dBackprop_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,c=Object(Q.a)(e,"dy","maxPool3dBackprop"),l=Object(Q.a)(t,"input","maxPool3dBackprop"),h=Object(Q.a)(n,"output","maxPool3dBackprop"),f=c,d=l,p=h,m=!1;4===l.rank&&(m=!0,f=Be(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),d=Be(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=Be(h,[1,h.shape[0],h.shape[1],h.shape[2],h.shape[3]])),k.b(5===f.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+f.rank+"."})),k.b(5===d.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."})),k.b(5===p.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+p.rank+"."})),k.b(rt(a,i),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(i,"'")})),null!=s&&k.b(k.v(o),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode ".concat(s," but got pad ").concat(o,".")}));var v=u.a.runKernelFunc((function(e){var t=Xe(d.shape,r,a,i,o,s);return e.maxPool3dBackprop(f,d,p,t)}),{dy:f,input:d,output:p},null,X.Bb,{filterSize:r,strides:a,dilations:i,pad:o,dimRoundingMode:s});return m?Be(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),fi={kernelName:X.Ab,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.dilations,c=n.pad,l=n.dimRoundingMode,h=null==u?[1,1,1]:u;return{x:function(){return hi(e,a,i,o,s,h,c,l)}}}},di=Object(Y.a)({maxPoolBackprop_:function(e,t,n,r,a,i,o){var s=Object(Q.a)(e,"dy","maxPoolBackprop"),c=Object(Q.a)(t,"input","maxPoolBackprop"),l=Object(Q.a)(n,"output","maxPoolBackprop");return k.b(c.rank===s.rank,(function(){return"Rank of input (".concat(c.rank,") does not match rank of dy (").concat(s.rank,")")})),k.b(4===s.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+s.rank+"."})),k.b(4===c.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."})),null!=o&&k.b(k.v(i),(function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")})),u.a.runKernelFunc((function(e){var t=Ke(c.shape,r,a,1,i,o);return e.maxPoolBackprop(s,c,l,t)}),{dy:s,input:c,output:l},null,X.Cb,{filterSize:r,strides:a,pad:i,dimRoundingMode:o})}}),pi={kernelName:X.zb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return di(e,a,i,o,s,u)}}}},mi={kernelName:X.Gb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=_slicedToArray2(t,2),i=a[0],o=si(e,a[1],i,k.I(r,i.shape));return{x:function(){return o.x()}}}},vi={kernelName:X.Hb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1];return{a:function(){return wt(e,Z(bn(r,a),"float32"))},b:function(){return wt(e,Z(zn(r,a),"float32"))}}}},gi={kernelName:X.Ib,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Qt(e,a,r.shape)}}}},yi=Object(Y.a)({floor_:function(e){var t=Object(Q.a)(e,"x","floor");return u.a.runKernelFunc((function(e){return e.floor(t)}),{x:t},null,X.bb)}}),_i={kernelName:X.Jb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Wt(r.shape,a.shape);return{a:function(){var t=Ut(r.shape,i);return t.length>0?Be(In(e,t),r.shape):e},b:function(){var t=wt(e,Bn(yi(yt(r,a)))),n=Ut(a.shape,i);return n.length>0?Be(In(t,n),a.shape):t}}}},bi={kernelName:X.Kb,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Wt(r.shape,a.shape);return{a:function(){var t=wt(e,Z(a,"float32")),n=Ut(r.shape,i);return n.length>0?Be(In(t,n),r.shape):t},b:function(){var t=wt(e,Z(r,"float32")),n=Ut(a.shape,i);return n.length>0?Be(In(t,n),a.shape):t}}}},ki={kernelName:X.Lb,gradFunc:function(e){return{x:function(){return Bn(e)}}}},wi={kernelName:X.Qb,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return Ot(n.shape,"float32")}}}},xi={kernelName:X.Rb,gradFunc:function(e){return{x:function(){return Ht(e)}}}},Ci={kernelName:X.Sb,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Qt(e,a,r.shape)}}}},Si={kernelName:X.Tb,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray2(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=Wt(o.shape,s.shape);return{a:function(){var t=Z(s,"float32"),n=wt(e,wt(t,Ct(o,Bt(t,Dt(1))))),r=Ut(o.shape,u);return r.length>0&&(n=In(n,r)),Be(n,o.shape)},b:function(){var t=zn(o,0),n=Gt(t,Xn(o),Ht(o)),r=wt(e,wt(i,n)),a=Ut(s.shape,u);return a.length>0&&(r=In(r,a)),Be(r,s.shape)}}}},Ti={kernelName:X.Ub,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=zn(r,0);return{x:function(){return Gt(i,e,wt(e,a))},alpha:function(){var t=Gt(i,Ht(e),wt(e,r)),n=Ut(a.shape,e.shape);return n.length>0&&(t=In(t,n)),Be(t,a.shape)}}}},Ai={kernelName:X.Yb,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return yt(e,Bn(En(n)))}}}},Ei={kernelName:X.ac,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0],r=wt(bn(n,6),ar(n));return{x:function(){return wt(e,Z(r,"float32"))}}}},Ii={kernelName:X.Zb,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wt(e,Z(ar(n),"float32"))}}}},Ri={kernelName:X.bc,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return Be(e,n.shape)}}}},Oi={kernelName:X.cc,inputsToSave:["images"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=function(t){var a=n.alignCorners;return t.resizeBilinearBackprop(e,r,a)},i={images:r};return{images:function(){return u.a.runKernelFunc(a,i,null,X.dc,n)}}}},Ni={kernelName:X.ec,inputsToSave:["images"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=function(t){var a=n.alignCorners;return t.resizeNearestNeighborBackprop(e,r,a)},i={images:r};return{images:function(){return u.a.runKernelFunc(a,i,null,X.fc,n)}}}},Di={kernelName:X.gc,gradFunc:function(e,t,n){var r=n.dims,a=Object(k.I)(r,e.shape);return{x:function(){return $t(e,a)}}}},Pi={kernelName:X.ic,gradFunc:function(e){return{x:function(){return Ht(e)}}}},Fi={kernelName:X.jc,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return Bn(yt(e,wt(Ct(n,1.5),2)))}}}},Mi=Object(Y.a)({logicalNot_:function(e){var t=Object(Q.a)(e,"x","logicalNot","bool");return u.a.runKernelFunc((function(e){return e.logicalNot(t)}),{x:t},null,X.wb)}}),Li={kernelName:X.kc,inputsToSave:["condition"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{condition:function(){return Z(Ht(n),"float32")},t:function(){return wt(e,Z(n,e.dtype))},e:function(){return wt(e,Z(Mi(n),e.dtype))}}}},zi={kernelName:X.lc,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){var t=zn(n,Dt(0)),r=Dt(kr),a=Dt(wr),i=wt(e,a),o=wt(wt(e,r),Yn(Z(n,"float32")));return Gt(t,i,o)}}}},Bi={kernelName:X.mc,outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wt(e,wt(n,Bt(Dt(1),n)))}}}},ji={kernelName:X.nc,gradFunc:function(e){return{x:function(){return Ht(e)}}}},Vi=Object(Y.a)({cos_:function(e){var t=Object(Q.a)(e,"x","cos");return u.a.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},null,X.G)}}),qi={kernelName:X.oc,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wt(Vi(Z(n,"float32")),e)}}}},Ui=Object(Y.a)({cosh_:function(e){var t=Object(Q.a)(e,"x","cosh");return u.a.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{x:t},null,X.H)}}),Wi={kernelName:X.pc,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wt(Ui(Z(n,"float32")),e)}}}},Gi=Object(Y.a)({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Object(Q.a)(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return u.a.runKernelFunc((function(e,a){return a([r]),e.pad(r,t,n)}),{x:r},null,X.Sb,{paddings:t,constantValue:n})}}),Hi={kernelName:X.qc,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=_slicedToArray2(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=_slicedToArray2(Pe(r,a,i),2),u=s[0],c=s[1],l=[],h=0;h<e.rank;h++)l.push([u[h],o[h]-u[h]-c[h]]);return{x:function(){return Gi(e,l)}}}},Ki={kernelName:X.rc,outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.dim,i=wt(e,r);return{logits:function(){return Bt(i,wt(In(i,[a],!0),r))}}}},Xi=Object(Y.a)({sigmoid_:function(e){var t=Object(Q.a)(e,"x","sigmoid");return u.a.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},null,X.mc)}}),Qi={kernelName:X.sc,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wt(e,Xi(n))}}}},Yi=Object(Y.a)({batchToSpaceND_:function(e,t,n){var r=Object(Q.a)(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));return k.b(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),k.b(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),k.b(r.shape[0]%a==0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of the elements of blockShape ").concat(t.join(" * ")," === ").concat(a)})),u.a.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{x:r},null,X.t,{blockShape:t,crops:n})}}),Zi={kernelName:X.tc,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return Yi(e,r,a)}}}},Ji={kernelName:X.uc,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return Ge(e,r)}}}},$i={kernelName:X.vc,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return yt(e,wt(An(Z(n,"float32")),2))}}}},eo={kernelName:X.wc,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wt(e,wt(Z(n,"float32"),2))}}}},to={kernelName:X.xc,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Dt(2);return{a:function(){return wt(e,wt(i,Bt(r,a)))},b:function(){return wt(e,wt(i,Bt(a,r)))}}}},no={kernelName:X.yc,gradFunc:function(e){return{x:function(){return Ht(e)}}}},ro={kernelName:X.Ac,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Wt(r.shape,a.shape);return{a:function(){var t=e,n=Ut(r.shape,i);return n.length>0&&(t=In(t,n)),Be(t,r.shape)},b:function(){var t=e,n=Ut(a.shape,i);return n.length>0&&(t=In(t,n)),Be(Bn(t),a.shape)}}}},ao={kernelName:X.Bc,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=r.shape.slice(),i=n.axis;Object(k.I)(i,r.shape).forEach((function(e){a[e]=1}));var o=Be(e,a),s=wt(o,qn(r.shape,"float32"));return{x:function(){return s}}}},io={kernelName:X.Cc,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return yt(e,En(Vi(n)))}}}},oo={kernelName:X.Dc,outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wt(Bt(Dt(1),En(n)),e)}}}},so={kernelName:X.Ec,inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.reps;return{x:function(){var t=Ht(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=ze(t,Qt(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=ze(t,Qt(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=ze(t,Qt(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(var l=0;l<a[0];++l)for(var h=0;h<a[1];++h)for(var f=0;f<a[2];++f)for(var d=0;d<a[3];++d)t=ze(t,Qt(e,[l*r.shape[0],h*r.shape[1],f*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},uo={kernelName:X.Gc,gradFunc:function(e,t,n){var r=ft(n.perm);return{x:function(){return pt(e,r)}}}},co={kernelName:X.Ic,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return xn(e,r)}}}},lo=Object(Y.a)({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Object(Q.a)(e,"x","gather"),a=Object(Q.a)(t,"indices","gather","int32");return u.a.runKernelFunc((function(e,t){var i=Object(k.I)(n,r.shape)[0],o=Vr(r,a,i),s=e.gather(r,Be(a,[a.size]),i);return t([r,a]),Be(s,o.outputShape)}),{x:r,indices:a},null,X.fb,{axis:n})}}),ho=Object(Y.a)({maximum_:function(e,t){var n,r=Object(Q.a)(e,"a","maximum"),a=Object(Q.a)(t,"b","maximum");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],"bool"===r.dtype&&(r=Z(r,"int32"),a=Z(a,"int32")),Wt(r.shape,a.shape),u.a.runKernelFunc((function(e,t){var n=e.maximum(r,a);return t([r,a]),n}),{a:r,b:a},null,X.Eb)}}),fo=0,po=[Zr,Jr,$r,ea,ta,na,ra,aa,ia,oa,sa,ua,la,fa,da,ma,va,ga,ya,_a,ba,Ca,xa,Aa,Ia,Oa,Na,Fa,Ma,La,za,Ba,ja,Va,Ua,qa,Ga,Ka,Ya,Za,Ja,$a,ei,ti,ni,ri,ii,ui,ui,li,fi,pi,mi,vi,gi,_i,bi,ki,wi,xi,Ci,Ci,Si,Ti,Ai,Ei,Ii,Ri,Oi,Ni,Di,Pi,Fi,Li,zi,Bi,ji,qi,Wi,Hi,Ki,Qi,Zi,Zi,Ji,Ji,$i,to,eo,no,ro,ao,io,oo,so,uo,co,{kernelName:X.Jc,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return function(e,t){for(var n=ho(t,Ht(t)),r=lo(e,n),a=_n(t,Dt(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=wn(a,o+1);a=kn(a,qn(r.shape,"bool"));var s=Ht(r);return Gt(a,r,s)}(e,n)}}}},{kernelName:X.Kc,gradFunc:function(e){return{x:function(){return Ht(e)}}}}];fo<po.length;fo++){var mo=po[fo];Object($n.d)(mo)}H.a.prototype.abs=function(){return this.throwIfDisposed(),Sn(this)};var vo=Object(Y.a)({acos_:function(e){var t=Object(Q.a)(e,"x","acos");return u.a.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{x:t},null,X.b)}});H.a.prototype.acos=function(){return this.throwIfDisposed(),vo(this)};var go=Object(Y.a)({acosh_:function(e){var t=Object(Q.a)(e,"x","acosh");return u.a.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{x:t},null,X.c)}});H.a.prototype.acosh=function(){return this.throwIfDisposed(),go(this)};var yo=Object(Y.a)({mod_:function(e,t){var n,r=Object(Q.a)(e,"a","mod"),a=Object(Q.a)(t,"b","mod");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],u.a.runKernelFunc((function(e,t){var n=e.mod(r,a);return t([r,a]),n}),{a:r,b:a},null,X.Jb)}}),_o=Object(Y.a)({addStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","addStrict"),r=Object(Q.a)(t,"b","addStrict");return k.e(n.shape,r.shape,"Error in addStrict: "),ze(n,r)}}),bo=Object(Y.a)({divStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","div"),r=Object(Q.a)(t,"b","div");return k.e(n.shape,r.shape,"Error in divideStrict: "),yt(n,r)}}),ko=Object(Y.a)({maximumStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","maximumStrict"),r=Object(Q.a)(t,"b","maximumStrict");return k.e(n.shape,r.shape,"Error in maximumStrict: "),ho(n,r)}}),wo=Object(Y.a)({minimumStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","minimumStrict"),r=Object(Q.a)(t,"b","minimumStrict");return k.e(n.shape,r.shape,"Error in minimumStrict: "),Kn(n,r)}}),xo=Object(Y.a)({modStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","modStrict"),r=Object(Q.a)(t,"b","modStrict");return k.e(n.shape,r.shape,"Error in modStrict: "),yo(n,r)}}),Co=Object(Y.a)({mulStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","mul"),r=Object(Q.a)(t,"b","mul");return k.e(n.shape,r.shape,"Error in multiplyStrict: "),wt(n,r)}}),So=Object(Y.a)({powStrict_:function(e,t){return On("strict variants of ops have been deprecated and will be removed in future"),k.e(e.shape,t.shape,"Error in powStrict: "),Ct(e,t)}}),To=Object(Y.a)({squaredDifferenceStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","squaredDifferenceStrict"),r=Object(Q.a)(t,"b","squaredDifferenceStrict");return k.e(n.shape,r.shape,"Error in squaredDifferenceStrict: "),Qn(n,r)}}),Ao=Object(Y.a)({subStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","subStrict"),r=Object(Q.a)(t,"b","subStrict");return k.e(n.shape,r.shape,"Error in subStrict: "),Bt(n,r)}});H.a.prototype.addStrict=function(e){return this.throwIfDisposed(),_o(this,e)},H.a.prototype.add=function(e){return this.throwIfDisposed(),ze(this,e)};var Eo=Object(Y.a)({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(Q.a)(e,"x","all","bool");return u.a.runKernelFunc((function(e){var a=Object(k.I)(t,r.shape),i=a,o=ht(i,r.rank);null!=o&&(r=pt(r,o),i=dt(i.length,r.rank));var s=e.all(r,i);if(n){var u=ct(s.shape,a);return Be(s,u)}return s}),{x:r},null,X.f,{axis:t,keepDims:n})}});H.a.prototype.all=function(e,t){return this.throwIfDisposed(),Eo(this,e,t)};var Io=Object(Y.a)({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(Q.a)(e,"x","any","bool");return u.a.runKernelFunc((function(e){var a=Object(k.I)(t,r.shape),i=a,o=ht(i,r.rank);null!=o&&(r=pt(r,o),i=dt(i.length,r.rank));var s=e.any(r,i);if(n){var u=ct(s.shape,a);return Be(s,u)}return s}),{x:r},null,X.g,{axis:t,keepDims:n})}});H.a.prototype.any=function(e,t){return this.throwIfDisposed(),Io(this,e,t)};var Ro=Object(Y.a)({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(Q.a)(e,"x","argMax");return u.a.runKernelFunc((function(e,r){r([n]);var a=k.I(t,n.shape),i=ht(a,n.rank);return null!=i&&(n=pt(n,i),a=dt(a.length,n.rank)),e.argMax(n,a[0])}),{x:n},null,X.h,{axis:t})}});H.a.prototype.argMax=function(e){return this.throwIfDisposed(),Ro(this,e)};var Oo=Object(Y.a)({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(Q.a)(e,"x","argMin");return u.a.runKernelFunc((function(e,r){r([n]),null==t&&(t=0);var a=k.I(t,n.shape),i=ht(a,n.rank);return null!=i&&(n=pt(n,i),a=dt(a.length,n.rank)),e.argMin(n,a[0])}),{x:n},null,X.i,{axis:t})}});H.a.prototype.argMin=function(e){return this.throwIfDisposed(),Oo(this,e)},H.a.prototype.asScalar=function(){return this.throwIfDisposed(),Object(k.b)(1===this.size,(function(){return"The array must have only 1 element."})),Be(this,[])},H.a.prototype.asType=function(e){return this.throwIfDisposed(),Z(this,e)},H.a.prototype.as1D=function(){return this.throwIfDisposed(),Be(this,[this.size])},H.a.prototype.as2D=function(e,t){return this.throwIfDisposed(),Be(this,[e,t])},H.a.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),Be(this,[e,t,n])},H.a.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),Be(this,[e,t,n,r])},H.a.prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),Be(this,[e,t,n,r,a])};var No=Object(Y.a)({asin_:function(e){var t=Object(Q.a)(e,"x","asin");return u.a.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{x:t},null,X.j)}});H.a.prototype.asin=function(){return this.throwIfDisposed(),No(this)};var Do=Object(Y.a)({asinh_:function(e){var t=Object(Q.a)(e,"x","asinh");return u.a.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{x:t},null,X.k)}});H.a.prototype.asinh=function(){return this.throwIfDisposed(),Do(this)};var Po=Object(Y.a)({atan_:function(e){var t=Object(Q.a)(e,"x","atan");return u.a.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{x:t},null,X.l)}});H.a.prototype.atan=function(){return this.throwIfDisposed(),Po(this)};var Fo=Object(Y.a)({atan2_:function(e,t){var n,r=Object(Q.a)(e,"a","atan2"),a=Object(Q.a)(t,"b","atan2");return n=_slicedToArray2(Object(Le.b)(r,a),2),r=n[0],a=n[1],u.a.runKernelFunc((function(e,t){var n=e.atan2(r,a);return t([r,a]),n}),{a:r,b:a},null,X.m)}});H.a.prototype.atan2=function(e){return this.throwIfDisposed(),Fo(this,e)};var Mo=Object(Y.a)({atanh_:function(e){var t=Object(Q.a)(e,"x","atanh");return u.a.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{x:t},null,X.n)}});H.a.prototype.atanh=function(){return this.throwIfDisposed(),Mo(this)};var Lo=Object(Y.a)({avgPool_:function(e,t,n,r,a){var i=Object(Q.a)(e,"x","avgPool","float32");k.b(rt(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '1'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=Be(i,[1,i.shape[0],i.shape[1],i.shape[2]])),k.b(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),null!=a&&k.b(k.v(r),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var c=u.a.runKernelFunc((function(e,i){var s=Ke(o.shape,t,n,1,r,a);return i([o]),1===s.filterWidth&&1===s.filterHeight&&k.a(s.inShape,s.outShape)?o.clone():e.avgPool(o,s)}),{x:o},null,X.o,{filterSize:t,strides:n,pad:r,dimRoundingMode:a});return c=Z(c,i.dtype),s?Be(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});H.a.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Lo(this,e,t,n,r)},H.a.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Yi(this,e,t)},H.a.prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),Ve(this,e,t,n,r,a)},H.a.prototype.broadcastTo=function(e){return this.throwIfDisposed(),Vt(this,e)},H.a.prototype.cast=function(e){return this.throwIfDisposed(),Z(this,e)};var zo=Object(Y.a)({ceil_:function(e){var t=Object(Q.a)(e,"x","ceil");return u.a.runKernelFunc((function(e){return e.ceil(t)}),{x:t},null,X.w)}});H.a.prototype.ceil=function(){return this.throwIfDisposed(),zo(this)};var Bo=Object(Y.a)({clipByValue_:function(e,t,n){var r=Object(Q.a)(e,"x","clipByValue");return k.b(t<=n,(function(){return"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,").")})),u.a.runKernelFunc((function(e,a){var i=e.clip(r,t,n);return a([r]),i}),{x:r},null,X.x,{clipValueMin:t,clipValueMax:n})}});H.a.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Bo(this,e,t)},H.a.prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof H.a&&(e=[e]),Ge([this].concat(_toConsumableArray(e)),t)};var jo=Object(Y.a)({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=Object(Q.a)(e,"x","conv1d"),u=Object(Q.a)(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=Be(s,[1,s.shape[0],s.shape[1]])),k.b(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),k.b(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=o&&k.b(k.v(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(r,".")})),k.b(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match input depth for filter ").concat(u.shape[1],".")})),k.b(rt(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride ".concat(n," and dilation '").concat(i,"'")})),k.b("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var h=Be(u,[1,u.shape[0],u.shape[1],u.shape[2]]),f=Be(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=it(f,h,[1,n],r,"NHWC",[1,i],o);return Be(d,l?[d.shape[2],d.shape[3]]:[d.shape[0],d.shape[2],d.shape[3]])}});H.a.prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),jo(this,e,t,n,r,a,i)};var Vo=Object(Y.a)({conv2dTranspose_:function(e,t,n,r,a,i){var o=Object(Q.a)(e,"x","conv2dTranspose"),s=Object(Q.a)(t,"filter","conv2dTranspose");return wa(n,o,s,r,a,"NHWC",i)}});H.a.prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),Vo(this,e,t,n,r,a)},H.a.prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),it(this,e,t,n,r,a,i)},H.a.prototype.cos=function(){return this.throwIfDisposed(),Vi(this)},H.a.prototype.cosh=function(){return this.throwIfDisposed(),Ui(this)},H.a.prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),mt(this,e,t,n)};var qo=Object(Y.a)({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=Object(Q.a)(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return k.b(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),k.b(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),k.b(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)})),u.a.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{x:r},null,X.K,{blockSize:t,dataFormat:n})}});H.a.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),qo(this,e,t)},H.a.prototype.depthwiseConv2D=function(e,t,n,r,a,i){return On("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),vt(this,e,t,n,r,a,i)},H.a.prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),vt(this,e,t,n,r,a,i)};var Uo=Object(Y.a)({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=Object(Q.a)(e,"x","dilation2d"),s=Object(Q.a)(t,"filter","dilation2d");k.b(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+o.rank+"."})),k.b(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+s.rank+"."})),k.b("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of "+i}));var c=o,l=!1;3===o.rank&&(c=Be(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0);var h=u.a.runKernel(X.O,{x:c,filter:s},{strides:n,pad:r,dilations:a});return l?Be(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});H.a.prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),Uo(this,e,t,n,r,a)};var Wo=Object(Y.a)({divNoNan_:function(e,t){var n=Object(Q.a)(e,"a","div"),r=Object(Q.a)(t,"b","div"),a=_slicedToArray2(Object(Le.b)(n,r),2);n=a[0],r=a[1];var i=yt(n,r),o=Ht(i),s=oi(r,o);return Gt(s,o,i)}});H.a.prototype.divNoNan=function(e){return this.throwIfDisposed(),Wo(this,e)},H.a.prototype.divStrict=function(e){return this.throwIfDisposed(),bo(this,e)},H.a.prototype.div=function(e){return this.throwIfDisposed(),yt(this,e)};var Go=Object(Y.a)({dot_:function(e,t){var n=Object(Q.a)(e,"t1","dot"),r=Object(Q.a)(t,"t2","dot");k.b(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(k.b(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got ".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=Be(n,[1,-1]),s=Be(r,[-1,1]),u=_t(o,s);return Be(u,[])}if(1===n.rank&&2===r.rank){var c=Be(n,[1,-1]),l=Be(r,[r.shape[0],r.shape[1]]),h=_t(c,l);return Be(h,[h.size])}if(2===n.rank&&1===r.rank){var f=Be(r,[-1,1]),d=_t(n,f);return Be(d,[d.size])}var p=Be(r,[r.shape[0],r.shape[1]]);return _t(n,p)}});H.a.prototype.dot=function(e){return this.throwIfDisposed(),Go(this,e)},H.a.prototype.elu=function(){return this.throwIfDisposed(),tr(this)};var Ho=Object(Y.a)({equalStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","equalStrict"),r=Object(Q.a)(t,"b","equalStrict");return Object(k.e)(n.shape,r.shape,"Error in equalStrict: "),oi(n,r)}}),Ko=Object(Y.a)({greaterEqualStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","greaterEqualStrict"),r=Object(Q.a)(t,"b","greaterEqualStrict");return Object(k.e)(n.shape,r.shape,"Error in greaterEqualStrict: "),_n(n,r)}}),Xo=Object(Y.a)({greaterStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","greaterStrict"),r=Object(Q.a)(t,"b","greaterStrict");return Object(k.e)(n.shape,r.shape,"Error in greaterStrict: "),zn(n,r)}}),Qo=Object(Y.a)({lessEqualStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","lessEqualStrict"),r=Object(Q.a)(t,"b","lessEqualStrict");return Object(k.e)(n.shape,r.shape,"Error in lessEqualStrict: "),bn(n,r)}}),Yo=Object(Y.a)({lessStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","lessStrict"),r=Object(Q.a)(t,"b","lessStrict");return Object(k.e)(n.shape,r.shape,"Error in lessStrict: "),ci(n,r)}}),Zo=Object(Y.a)({notEqualStrict_:function(e,t){On("strict variants of ops have been deprecated and will be removed in future");var n=Object(Q.a)(e,"a","notEqualStrict"),r=Object(Q.a)(t,"b","notEqualStrict");return Object(k.e)(n.shape,r.shape,"Error in notEqualStrict: "),Wn(n,r)}});H.a.prototype.equalStrict=function(e){return this.throwIfDisposed(),Ho(this,e)},H.a.prototype.equal=function(e){return this.throwIfDisposed(),oi(this,e)};var Jo=Object(Y.a)({erf_:function(e){var t=Object(Q.a)(e,"x","erf");return k.b("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=Z(t,"float32")),u.a.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{x:t},null,X.V)}});H.a.prototype.erf=function(){return this.throwIfDisposed(),Jo(this)},H.a.prototype.exp=function(){return this.throwIfDisposed(),Yn(this)},H.a.prototype.expandDims=function(e){return this.throwIfDisposed(),wn(this,e)};var $o=Object(Y.a)({expm1_:function(e){var t=Object(Q.a)(e,"x","expm1");return u.a.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{x:t},null,X.X)}});H.a.prototype.expm1=function(){return this.throwIfDisposed(),$o(this)},H.a.prototype.fft=function(){return this.throwIfDisposed(),Yt(this)},H.a.prototype.flatten=function(){return this.throwIfDisposed(),Be(this,[this.size])},H.a.prototype.floor=function(){return this.throwIfDisposed(),yi(this)},H.a.prototype.floorDiv=function(e){return this.throwIfDisposed(),gt(this,e)},H.a.prototype.gather=function(e,t){return this.throwIfDisposed(),lo(this,e,t)},H.a.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Ko(this,e)},H.a.prototype.greaterEqual=function(e){return this.throwIfDisposed(),_n(this,e)},H.a.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Xo(this,e)},H.a.prototype.greater=function(e){return this.throwIfDisposed(),zn(this,e)},H.a.prototype.ifft=function(){return this.throwIfDisposed(),Jt(this)},H.a.prototype.irfft=function(){return this.throwIfDisposed(),en(this)};var es=Object(Y.a)({isFinite_:function(e){var t=Object(Q.a)(e,"x","isFinite");return u.a.runKernelFunc((function(e){return e.isFinite(t)}),{x:t},null,X.lb)}});H.a.prototype.isFinite=function(){return this.throwIfDisposed(),es(this)};var ts=Object(Y.a)({isInf_:function(e){var t=Object(Q.a)(e,"x","isInf");return u.a.runKernelFunc((function(e){return e.isInf(t)}),{x:t},null,X.mb)}});H.a.prototype.isInf=function(){return this.throwIfDisposed(),ts(this)};var ns=Object(Y.a)({isNaN_:function(e){var t=Object(Q.a)(e,"x","isNaN");return u.a.runKernelFunc((function(e){return e.isNaN(t)}),{x:t},null,X.nb)}});H.a.prototype.isNaN=function(){return this.throwIfDisposed(),ns(this)};var rs=Object(Y.a)({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=Object(Q.a)(e,"x","leakyRelu");return ho(wt(Dt(t),n),n)}});H.a.prototype.leakyRelu=function(e){return this.throwIfDisposed(),rs(this,e)},H.a.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Qo(this,e)},H.a.prototype.lessEqual=function(e){return this.throwIfDisposed(),bn(this,e)},H.a.prototype.lessStrict=function(e){return this.throwIfDisposed(),Yo(this,e)},H.a.prototype.less=function(e){return this.throwIfDisposed(),ci(this,e)};var as=Object(Y.a)({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=Object(Q.a)(e,"x","localResponseNormalization");k.b(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),k.b(k.v(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=Be(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var c=u.a.runKernelFunc((function(e,i){var s=e.localResponseNormalization4D(o,t,n,r,a);return i([o,s]),s}),{x:o},null,X.ob,{depthRadius:t,bias:n,alpha:r,beta:a});return s?Be(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});H.a.prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),as(this,e,t,n,r)};var is=Object(Y.a)({softplus_:function(e){var t=Object(Q.a)(e,"x","softplus");return u.a.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{x:t},null,X.sc)}}),os=Object(Y.a)({logSigmoid_:function(e){var t=Object(Q.a)(e,"x","logSigmoid");return Vn((function(e){return{value:Bn(is(Bn(e))),gradFunc:function(t){return wt(t,Xi(Bn(e)))}}}))(t)}});H.a.prototype.logSigmoid=function(){return this.throwIfDisposed(),os(this)};var ss=Object(Y.a)({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Object(Q.a)(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and axis was ").concat(t));return u.a.runKernelFunc((function(n,r){var a=bt(e,t,!0),i=Bt(e,a),o=Bt(Z(i,"float32"),Xn(In(Yn(i),t,!0)));return r([o]),o}),{logits:n},null,X.ub,{axis:t})}});H.a.prototype.logSoftmax=function(e){return this.throwIfDisposed(),ss(this,e)},H.a.prototype.logSumExp=function(e,t){return this.throwIfDisposed(),Jn(this,e,t)},H.a.prototype.log=function(){return this.throwIfDisposed(),Xn(this)},H.a.prototype.log1p=function(){return this.throwIfDisposed(),Zn(this)},H.a.prototype.logicalAnd=function(e){return this.throwIfDisposed(),kn(this,e)},H.a.prototype.logicalNot=function(){return this.throwIfDisposed(),Mi(this)};var us=Object(Y.a)({logicalOr_:function(e,t){var n=Object(Q.a)(e,"a","logicalOr","bool"),r=Object(Q.a)(t,"b","logicalOr","bool");return Wt(n.shape,r.shape),u.a.runKernelFunc((function(e){return e.logicalOr(n,r)}),{a:n,b:r},null,X.xb)}});H.a.prototype.logicalOr=function(e){return this.throwIfDisposed(),us(this,e)};var cs=Object(Y.a)({logicalXor_:function(e,t){var n=Object(Q.a)(e,"a","logicalXor","bool"),r=Object(Q.a)(t,"b","logicalXor","bool");return Wt(n.shape,r.shape),kn(us(e,t),Mi(kn(e,t)))}});H.a.prototype.logicalXor=function(e){return this.throwIfDisposed(),cs(this,e)},H.a.prototype.matMul=function(e,t,n){return this.throwIfDisposed(),_t(this,e,t,n)},H.a.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),kt(this,e,t,n,r)},H.a.prototype.max=function(e,t){return this.throwIfDisposed(),bt(this,e,t)},H.a.prototype.maximumStrict=function(e){return this.throwIfDisposed(),ko(this,e)},H.a.prototype.maximum=function(e){return this.throwIfDisposed(),ho(this,e)},H.a.prototype.mean=function(e,t){return this.throwIfDisposed(),Un(this,e,t)},H.a.prototype.min=function(e,t){return this.throwIfDisposed(),Tn(this,e,t)},H.a.prototype.minimumStrict=function(e){return this.throwIfDisposed(),wo(this,e)},H.a.prototype.minimum=function(e){return this.throwIfDisposed(),Kn(this,e)};var ls=Object(Y.a)({mirrorPad_:function(e,t,n){k.b("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")}));var r=Object(Q.a)(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");k.b(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". Got ").concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){k.b(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),k.b(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal to ").concat(r.shape[e]-a," or less than 0 for input of shape ")+r.shape}))},o=0;o<r.rank;o++)i(o);return u.a.runKernel(X.Ib,{x:r},{paddings:t,mode:n})}});H.a.prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),ls(this,e,t)},H.a.prototype.modStrict=function(e){return this.throwIfDisposed(),xo(this,e)},H.a.prototype.mod=function(e){return this.throwIfDisposed(),yo(this,e)},H.a.prototype.mulStrict=function(e){return this.throwIfDisposed(),Co(this,e)},H.a.prototype.mul=function(e){return this.throwIfDisposed(),wt(this,e)},H.a.prototype.neg=function(){return this.throwIfDisposed(),Bn(this)},H.a.prototype.norm=function(e,t,n){return this.throwIfDisposed(),Rn(this,e,t,n)},H.a.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Zo(this,e)},H.a.prototype.notEqual=function(e){return this.throwIfDisposed(),Wn(this,e)},H.a.prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),xt(this,e,t,n)};var hs=Object(Y.a)({onesLike_:function(e){var t=Object(Q.a)(e,"x","onesLike");return u.a.runKernelFunc((function(e,n){if("complex64"===t.dtype){var r=hs(Xt(t)),a=Ht(Kt(t));return Object(Rt.a)(r,a)}return e.onesLike(t)}),{x:t},null,X.Rb)}});H.a.prototype.onesLike=function(){return this.throwIfDisposed(),hs(this)},H.a.prototype.pad=function(e,t){return this.throwIfDisposed(),Gi(this,e,t)};var fs=Object(Y.a)({pool_:function(e,t,n,r,a,i){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var o=Object(Q.a)(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=Be(o,[1,o.shape[0],o.shape[1],o.shape[2]])),k.b(rt(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(a,"'")}));var c,l=Ke(s.shape,t,i,a,r),h=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var f=1===h[0]&&1===h[1],d=_slicedToArray2(function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,o[t]]}))]}([l.inHeight,l.inWidth],h,c),2),p=d[0],m=d[1],v=f?r:"valid",g=f?s:pa(s,h,p),y=("avg"===n?function(){return Lo(g,t,i,v)}:function(){return kt(g,t,i,v)})(),_=f?y:Yi(y,h,m);return u?Be(_,[_.shape[1],_.shape[2],_.shape[3]]):_}});H.a.prototype.pool=function(e,t,n,r,a){return this.throwIfDisposed(),fs(this,e,t,n,r,a)},H.a.prototype.powStrict=function(e){return this.throwIfDisposed(),So(this,e)},H.a.prototype.pow=function(e){return this.throwIfDisposed(),Ct(this,e)},H.a.prototype.prelu=function(e){return this.throwIfDisposed(),nr(this,e)};var ds=Object(Y.a)({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Object(Q.a)(e,"x","prod");return"bool"===r.dtype&&(r=Z(r,"int32")),u.a.runKernelFunc((function(e){var a=Object(k.I)(t,r.shape),i=ht(a,r.rank),o=a,s=r;null!=i&&(s=pt(r,i),o=dt(o.length,r.rank));var u=e.prod(s,o);if(n){var c=ct(u.shape,a);u=Be(u,c)}return u}),{x:r},null,X.Vb,{axis:t,keepDims:n})}});H.a.prototype.prod=function(e,t){return this.throwIfDisposed(),ds(this,e,t)};var ps=Object(Y.a)({reciprocal_:function(e){var t=Object(Q.a)(e,"x","reciprocal");return u.a.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{x:t},null,X.Yb)}});H.a.prototype.reciprocal=function(){return this.throwIfDisposed(),ps(this)},H.a.prototype.relu=function(){return this.throwIfDisposed(),Hn(this)},H.a.prototype.relu6=function(){return this.throwIfDisposed(),rr(this)},H.a.prototype.reshapeAs=function(e){return this.throwIfDisposed(),Be(this,e.shape)},H.a.prototype.reshape=function(e){return this.throwIfDisposed(),Be(this,e)},H.a.prototype.resizeBilinear=function(e,t){return this.throwIfDisposed(),gn(this,e,t)},H.a.prototype.resizeNearestNeighbor=function(e,t){return this.throwIfDisposed(),yn(this,e,t)},H.a.prototype.reverse=function(e){return this.throwIfDisposed(),$t(this,e)},H.a.prototype.rfft=function(){return this.throwIfDisposed(),Zt(this)};var ms=Object(Y.a)({round_:function(e){var t=Object(Q.a)(e,"x","round");return u.a.runKernelFunc((function(e){return e.round(t)}),{x:t},null,X.ic)}});H.a.prototype.round=function(){return this.throwIfDisposed(),ms(this)},H.a.prototype.rsqrt=function(){return this.throwIfDisposed(),Wa(this)};var vs=Object(Y.a)({selu_:function(e){var t=Object(Q.a)(e,"x","selu");return u.a.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{x:t},null,X.lc)}});H.a.prototype.selu=function(){return this.throwIfDisposed(),vs(this)},H.a.prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Pt(this,e,t,n,r,a,i)},H.a.prototype.sigmoid=function(){return this.throwIfDisposed(),Xi(this)};var gs=Object(Y.a)({sign_:function(e){var t=Object(Q.a)(e,"x","sign");return u.a.runKernelFunc((function(e){return e.sign(t)}),{x:t},null,X.nc)}});H.a.prototype.sign=function(){return this.throwIfDisposed(),gs(this)},H.a.prototype.sin=function(){return this.throwIfDisposed(),Ea(this)},H.a.prototype.sinh=function(){return this.throwIfDisposed(),Ra(this)},H.a.prototype.slice=function(e,t){return this.throwIfDisposed(),Qt(this,e,t)},H.a.prototype.softmax=function(e){return this.throwIfDisposed(),Ft(this,e)},H.a.prototype.softplus=function(){return this.throwIfDisposed(),is(this)},H.a.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),pa(this,e,t)},H.a.prototype.split=function(e,t){return this.throwIfDisposed(),Lt(this,e,t)},H.a.prototype.sqrt=function(){return this.throwIfDisposed(),An(this)},H.a.prototype.square=function(){return this.throwIfDisposed(),En(this)},H.a.prototype.squaredDifference=function(e){return this.throwIfDisposed(),Qn(this,e)},H.a.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),To(this,e)},H.a.prototype.squeeze=function(e){return this.throwIfDisposed(),zt(this,e)},H.a.prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof H.a?[this,e]:[this].concat(_toConsumableArray(e));return xn(n,t)},H.a.prototype.step=function(e){return this.throwIfDisposed(),ar(this,e)};var ys=Object(Y.a)({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l=Object(Q.a)(e,"x","stridedSlice");return u.a.runKernelFunc((function(e){null==r&&(r=new Array(t.length));var u=ke(o);if(u.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==o&&0!==s)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==o&&0!==c)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");var h=l.rank-t.length,f=ke(s),d=l.shape.slice();f.forEach((function(e){t[e]=0,n[e]=1,d.splice(e,0,1)}));var p=Te((l=Be(l,d)).shape,u,h,t,n,r,a,i,o),m=p.begin,v=p.end,g=p.strides;t=m,n=v,r=g;var y=ke(c);y.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var _=we(t,n,r),b=_.filter((function(e,t){return-1===y.indexOf(t)}));if(r.every((function(e){return 1===e})))return Be(Qt(l,t,_),b);var k=e.stridedSlice(l,t,n,r);return Be(k,b)}),{x:l},null,X.zc,{begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:c})}});H.a.prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),ys(this,e,t,n,r,a,i,o,s)},H.a.prototype.subStrict=function(e){return this.throwIfDisposed(),Ao(this,e)},H.a.prototype.sub=function(e){return this.throwIfDisposed(),Bt(this,e)},H.a.prototype.sum=function(e,t){return this.throwIfDisposed(),In(this,e,t)};var _s=Object(Y.a)({tan_:function(e){var t=Object(Q.a)(e,"x","tan");return u.a.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{x:t},null,X.Cc)}});H.a.prototype.tan=function(){return this.throwIfDisposed(),_s(this)};var bs=Object(Y.a)({tanh_:function(e){var t=Object(Q.a)(e,"x","tanh");return u.a.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},null,X.Dc)}});H.a.prototype.tanh=function(){return this.throwIfDisposed(),bs(this)},H.a.prototype.tile=function(e){return this.throwIfDisposed(),jt(this,e)},H.a.prototype.toBool=function(){return this.throwIfDisposed(),Z(this,"bool")},H.a.prototype.toFloat=function(){return this.throwIfDisposed(),Z(this,"float32")},H.a.prototype.toInt=function(){return this.throwIfDisposed(),Z(this,"int32")};var ks=Object(Y.a)({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Object(Q.a)(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") but got ")+t);var i={x:r},o={k:t,sorted:n},s=u.a.runKernelFunc((function(e){return e.topk(r,t,n)}),i,null,X.Fc,o),c=_slicedToArray2(s,2),l=c[0],h=c[1];return{values:l,indices:h}}});H.a.prototype.topk=function(e,t){return this.throwIfDisposed(),ks(this,e,t)},H.a.prototype.transpose=function(e){return this.throwIfDisposed(),pt(this,e)};var ws=Object(Y.a)({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object(Q.a)(e,"x","unique",null);Object(k.b)(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=u.a.runKernel(X.Hc,r,a),o=_slicedToArray2(i,2),s=o[0],c=o[1];return{values:s,indices:c}}});H.a.prototype.unique=function(e){return this.throwIfDisposed(),ws(this,e)},H.a.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Ha(this,e,t)},H.a.prototype.unstack=function(e){return this.throwIfDisposed(),Cn(this,e)},H.a.prototype.where=function(e,t){return this.throwIfDisposed(),Gt(e,this,t)},H.a.prototype.zerosLike=function(){return this.throwIfDisposed(),Ht(this)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"f",(function(){return u})),n.d(t,"g",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"i",(function(){return h})),n.d(t,"j",(function(){return f})),n.d(t,"k",(function(){return d})),n.d(t,"l",(function(){return p})),n.d(t,"n",(function(){return m})),n.d(t,"m",(function(){return v})),n.d(t,"o",(function(){return g})),n.d(t,"r",(function(){return y})),n.d(t,"p",(function(){return _})),n.d(t,"q",(function(){return b})),n.d(t,"s",(function(){return k})),n.d(t,"t",(function(){return w})),n.d(t,"u",(function(){return x})),n.d(t,"v",(function(){return C})),n.d(t,"w",(function(){return S})),n.d(t,"x",(function(){return T})),n.d(t,"y",(function(){return A})),n.d(t,"z",(function(){return E})),n.d(t,"A",(function(){return I})),n.d(t,"B",(function(){return R})),n.d(t,"C",(function(){return O})),n.d(t,"D",(function(){return N})),n.d(t,"E",(function(){return D})),n.d(t,"F",(function(){return P})),n.d(t,"G",(function(){return F})),n.d(t,"H",(function(){return M})),n.d(t,"J",(function(){return L})),n.d(t,"I",(function(){return z})),n.d(t,"K",(function(){return B})),n.d(t,"L",(function(){return j})),n.d(t,"M",(function(){return V})),n.d(t,"N",(function(){return q})),n.d(t,"O",(function(){return U})),n.d(t,"Q",(function(){return W})),n.d(t,"P",(function(){return G})),n.d(t,"R",(function(){return H})),n.d(t,"S",(function(){return K})),n.d(t,"T",(function(){return X})),n.d(t,"V",(function(){return Q})),n.d(t,"U",(function(){return Y})),n.d(t,"W",(function(){return Z})),n.d(t,"X",(function(){return J})),n.d(t,"Y",(function(){return $})),n.d(t,"Z",(function(){return ee})),n.d(t,"ab",(function(){return te})),n.d(t,"bb",(function(){return ne})),n.d(t,"cb",(function(){return re})),n.d(t,"eb",(function(){return ae})),n.d(t,"fb",(function(){return ie})),n.d(t,"gb",(function(){return oe})),n.d(t,"hb",(function(){return se})),n.d(t,"jb",(function(){return ue})),n.d(t,"ib",(function(){return ce})),n.d(t,"kb",(function(){return le})),n.d(t,"lb",(function(){return he})),n.d(t,"mb",(function(){return fe})),n.d(t,"nb",(function(){return de})),n.d(t,"qb",(function(){return pe})),n.d(t,"rb",(function(){return me})),n.d(t,"sb",(function(){return ve})),n.d(t,"tb",(function(){return ge})),n.d(t,"vb",(function(){return ye})),n.d(t,"wb",(function(){return _e})),n.d(t,"xb",(function(){return be})),n.d(t,"ub",(function(){return ke})),n.d(t,"ob",(function(){return we})),n.d(t,"pb",(function(){return xe})),n.d(t,"yb",(function(){return Ce})),n.d(t,"Eb",(function(){return Se})),n.d(t,"zb",(function(){return Te})),n.d(t,"Cb",(function(){return Ae})),n.d(t,"Ab",(function(){return Ee})),n.d(t,"Bb",(function(){return Ie})),n.d(t,"Db",(function(){return Re})),n.d(t,"Fb",(function(){return Oe})),n.d(t,"Gb",(function(){return Ne})),n.d(t,"Hb",(function(){return De})),n.d(t,"Ib",(function(){return Pe})),n.d(t,"Jb",(function(){return Fe})),n.d(t,"Kb",(function(){return Me})),n.d(t,"Lb",(function(){return Le})),n.d(t,"Pb",(function(){return ze})),n.d(t,"Mb",(function(){return Be})),n.d(t,"Nb",(function(){return je})),n.d(t,"Ob",(function(){return Ve})),n.d(t,"Rb",(function(){return qe})),n.d(t,"Qb",(function(){return Ue})),n.d(t,"Sb",(function(){return We})),n.d(t,"Tb",(function(){return Ge})),n.d(t,"Ub",(function(){return He})),n.d(t,"Vb",(function(){return Ke})),n.d(t,"Wb",(function(){return Xe})),n.d(t,"Xb",(function(){return Qe})),n.d(t,"Yb",(function(){return Ye})),n.d(t,"Zb",(function(){return Ze})),n.d(t,"bc",(function(){return Je})),n.d(t,"ec",(function(){return $e})),n.d(t,"fc",(function(){return et})),n.d(t,"cc",(function(){return tt})),n.d(t,"dc",(function(){return nt})),n.d(t,"ac",(function(){return rt})),n.d(t,"gc",(function(){return at})),n.d(t,"ic",(function(){return it})),n.d(t,"jc",(function(){return ot})),n.d(t,"kc",(function(){return st})),n.d(t,"lc",(function(){return ut})),n.d(t,"qc",(function(){return ct})),n.d(t,"oc",(function(){return lt})),n.d(t,"pc",(function(){return ht})),n.d(t,"nc",(function(){return ft})),n.d(t,"mc",(function(){return dt})),n.d(t,"sc",(function(){return pt})),n.d(t,"vc",(function(){return mt})),n.d(t,"Bc",(function(){return vt})),n.d(t,"tc",(function(){return gt})),n.d(t,"uc",(function(){return yt})),n.d(t,"rc",(function(){return _t})),n.d(t,"xc",(function(){return bt})),n.d(t,"wc",(function(){return kt})),n.d(t,"Ac",(function(){return wt})),n.d(t,"zc",(function(){return xt})),n.d(t,"Cc",(function(){return Ct})),n.d(t,"Dc",(function(){return St})),n.d(t,"Ec",(function(){return Tt})),n.d(t,"Fc",(function(){return At})),n.d(t,"Gc",(function(){return Et})),n.d(t,"Hc",(function(){return It})),n.d(t,"Ic",(function(){return Rt})),n.d(t,"Jc",(function(){return Ot})),n.d(t,"Kc",(function(){return Nt})),n.d(t,"yc",(function(){return Dt})),n.d(t,"db",(function(){return Pt})),n.d(t,"hc",(function(){return Ft}));var r="Abs",a="Acos",i="Acosh",o="Add",s="AddN",u="All",c="Any",l="ArgMax",h="ArgMin",f="Asin",d="Asinh",p="Atan",m="Atanh",v="Atan2",g="AvgPool",y="AvgPoolBackprop",_="AvgPool3D",b="AvgPool3DBackprop",k="BatchMatMul",w="BatchToSpaceND",x="BroadcastTo",C="Cast",S="Ceil",T="ClipByValue",A="Complex",E="Concat",I="Conv2D",R="Conv2DBackpropFilter",O="Conv2DBackpropInput",N="Conv3D",D="Conv3DBackpropFilterV2",P="Conv3DBackpropInputV2",F="Cos",M="Cosh",L="Cumsum",z="CropAndResize",B="DepthToSpace",j="DepthwiseConv2dNative",V="DepthwiseConv2dNativeBackpropFilter",q="DepthwiseConv2dNativeBackpropInput",U="Dilation2D",W="Dilation2DBackpropInput",G="Dilation2DBackpropFilter",H="Div",K="Elu",X="EluGrad",Q="Erf",Y="Equal",Z="Exp",J="Expm1",$="FFT",ee="Fill",te="FlipLeftRight",ne="Floor",re="FloorDiv",ae="FusedBatchNorm",ie="GatherV2",oe="Greater",se="GreaterEqual",ue="Identity",ce="IFFT",le="Imag",he="IsFinite",fe="IsInf",de="IsNan",pe="Less",me="LessEqual",ve="Log",ge="Log1p",ye="LogicalAnd",_e="LogicalNot",be="LogicalOr",ke="LogSoftmax",we="LRN",xe="LRNBackprop",Ce="Max",Se="Maximum",Te="MaxPool",Ae="MaxPoolBackprop",Ee="MaxPool3D",Ie="MaxPool3DBackprop",Re="MaxPoolWithArgmax",Oe="Mean",Ne="Min",De="Minimum",Pe="MirrorPad",Fe="Mod",Me="Multiply",Le="Negate",ze="NotEqual",Be="NonMaxSuppressionV3",je="NonMaxSuppressionV4",Ve="NonMaxSuppressionV5",qe="OnesLike",Ue="OneHot",We="PadV2",Ge="Pow",He="Prelu",Ke="Prod",Xe="Range",Qe="Real",Ye="Reciprocal",Ze="Relu",Je="Reshape",$e="ResizeNearestNeighbor",et="ResizeNearestNeighborGrad",tt="ResizeBilinear",nt="ResizeBilinearGrad",rt="Relu6",at="Reverse",it="Round",ot="Rsqrt",st="SelectV2",ut="Selu",ct="Slice",lt="Sin",ht="Sinh",ft="Sign",dt="Sigmoid",pt="Softplus",mt="Sqrt",vt="Sum",gt="SpaceToBatchND",yt="SplitV",_t="Softmax",bt="SquaredDifference",kt="Square",wt="Sub",xt="StridedSlice",Ct="Tan",St="Tanh",Tt="Tile",At="TopK",Et="Transpose",It="Unique",Rt="Unpack",Ot="UnsortedSegmentSum",Nt="ZerosLike",Dt="Step",Pt="FromPixels",Ft="RotateWithOffset"},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__2__},function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return h}));var r=n(6),a=n(11),i=n(5),o=n(16),s=n(7);function u(e,t){var n=e;if(Object(o.A)(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Object(o.A)(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Object(a.b)().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||Object(o.A)(t)){Object(o.b)(n.length>0,(function(){return"Element arr[".concat(r.join("]["),"] should be a primitive, but is an array of ").concat(t.length," elements")})),Object(o.b)(t.length===n[0],(function(){return"Element arr[".concat(r.join("]["),"] should have ").concat(n[0]," elements, but has ").concat(t.length," elements")}));for(var a=n.slice(1),i=0;i<t.length;++i)e(t[i],a,r.concat(i))}else Object(o.b)(0===n.length,(function(){return"Element arr[".concat(r.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(n[0]," elements")}))}(e,r,[]),r}function c(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}function l(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof i.a)return c(a,e.dtype,t,n),e;var l=Object(o.r)(e);if("string"!==l&&["bool","int32","float32"].indexOf(a)>=0&&(l=a),c(a,l,t,n),null==e||!Object(o.A)(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(null==e?"null":e.constructor.name,"'"));var h=u(e,l);Object(o.A)(e)||Array.isArray(e)||(e=[e]);var f="string"!==l?Object(s.toTypedArray)(e,l):Object(o.m)(e,[],!0);return r.a.makeTensor(f,h,l)}function h(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map((function(e,r){return l(e,"".concat(t,"[").concat(r,"]"),n)}),r)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(6),a=n(16);function i(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],i=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var o=function(){r.a.startScope(n);try{var t=i.apply(void 0,arguments);return Object(a.x)(t)&&console.error("Cannot return a Promise inside of tidy."),r.a.endScope(t),t}catch(e){throw r.a.endScope(null),e}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}},function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"f",(function(){return h})),n.d(t,"e",(function(){return f})),n.d(t,"d",(function(){return d})),n.d(t,"a",(function(){return p})),n.d(t,"c",(function(){return m}));var r=n(16);function a(e,t,n){var a;return a=Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":Object(r.z)(e)?"'".concat(e,"'"):"bool"===n?i(e):parseFloat(e.toFixed(7)).toString(),Object(r.L)(a,t)}function i(e){return 0===e?"false":"true"}function o(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var s=n(7),u=function(){function e(t,n,a){var i=this;if(_classCallCheck2(this,e),this.dtype=n,this.shape=t.slice(),this.size=r.N(t),null!=a){var o=a.length;r.b(o===this.size,(function(){return"Length of values '".concat(o,"' does not match the size inferred by the shape '").concat(i.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=a||r.n(n,this.size),this.strides=Object(r.j)(t)}return _createClass2(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];0===a.length&&(a=[0]),r.b(a.length===this.rank,(function(){return"The number of provided coordinates (".concat(a.length,") must match the rank (").concat(t.rank,")")}));var o=this.locToIndex(a);this.values[o]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r])throw new Error("Requested out of range element at ".concat(t,".   Buffer shape=")+this.shape);r++}for(var s=t[t.length-1],u=0;u<t.length-1;++u)s+=this.strides[u]*t[u];return this.values[s]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"toTensor",value:function(){return c().makeTensor(this.values,this.shape,this.dtype)}},{key:"rank",get:function(){return this.shape.length}}]),e}(),c=null,l=null;function h(e){c=e}function f(e){l=e}function d(e){e}var p=function(){function e(t,n,a,i){_classCallCheck2(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=r.N(t),this.strides=Object(r.j)(t),this.dataId=a,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}var t,n,u,h;return _createClass2(e,[{key:"buffer",value:(h=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",l.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"bufferSync",value:function(){return l.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:(u=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Object(r.S)(this.shape,t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"arraySync",value:function(){return Object(r.S)(this.shape,this.dataSync())}},{key:"data",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=c().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return s.decodeString(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])}))),function(){return n.apply(this,arguments)})},{key:"dataSync",value:function(){this.throwIfDisposed();var e=c().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return s.decodeString(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,c().read(this.dataId);case 3:return t=e.sent,e.abrupt("return","string"===this.dtype?t:new Uint8Array(t.buffer));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"dispose",value:function(){this.isDisposed||(c().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return l.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),l.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e,t,n,s){var u=Object(r.j)(t),c=function(e,t,n,i){var s=Object(r.N)(t),u=i[i.length-1],c=new Array(u).fill(0),l=t.length,h="complex64"===n?o(e):e;if(l>1)for(var f=0;f<s/u;f++)for(var d=f*u,p=0;p<u;p++)c[p]=Math.max(c[p],a(h[d+p],0,n).length);return c}(e,t,n,u),l=t.length,h=function e(t,n,r,s,u){var c=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],l="complex64"===r?2:1,h=n[0],f=n.length;if(0===f)return"complex64"===r?[a(o(t)[0],0,r)]:"bool"===r?[i(t[0])]:[t[0].toString()];if(1===f){if(h>20){var d=Array.from(t.slice(0,3*l)),p=Array.from(t.slice((h-3)*l,h*l));return"complex64"===r&&(d=o(d),p=o(p)),["["+d.map((function(e,t){return a(e,u[t],r)})).join(", ")+", ..., "+p.map((function(e,t){return a(e,u[h-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?o(t):Array.from(t)).map((function(e,t){return a(e,u[t],r)})).join(", ")+"]"]}var m=n.slice(1),v=s.slice(1),g=s[0]*l,y=[];if(h>20){for(var _=0;_<3;_++){var b=_*g;y.push.apply(y,_toConsumableArray(e(t.slice(b,b+g),m,r,v,u,!1)))}y.push("...");for(var k=h-3;k<h;k++){var w=k*g;y.push.apply(y,_toConsumableArray(e(t.slice(w,w+g),m,r,v,u,k===h-1)))}}else for(var x=0;x<h;x++){var C=x*g;y.push.apply(y,_toConsumableArray(e(t.slice(C,C+g),m,r,v,u,x===h-1)))}var S=2===f?",":"";y[0]="["+y[0]+S;for(var T=1;T<y.length-1;T++)y[T]=" "+y[T]+S;for(var A=",\n",E=2;E<f;E++)A+="\n";return y[y.length-1]=" "+y[y.length-1]+"]"+(c?"":A),y}(e,t,n,u,c),f=["Tensor"];return s&&(f.push("  dtype: "+n),f.push("  rank: "+l),f.push("  shape: [".concat(t,"]")),f.push("  values:")),f.push(h.map((function(e){return"    "+e})).join("\n")),f.join("\n")}(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),l.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),c().makeVariable(this,e,t,n)}},{key:"rank",get:function(){return this.shape.length}},{key:"isDisposed",get:function(){return this.isDisposedInternal}}]),e}();Object.defineProperty(p,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}});var m=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return _createClass2(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!r.a(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));c().disposeTensor(this),this.dataId=e.dataId,c().incRef(this,null)}},{key:"dispose",value:function(){c().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(p);Object.defineProperty(m,Symbol.hasInstance,{value:function(e){return e instanceof p&&null!=e.assign&&e.assign instanceof Function}})},function(e,t,n){"use strict";n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return g}));var r=n(37),a=n(11),i=n(39),o=n(1),s=n(25),u=n(16),c=function(){function e(t,n){_classCallCheck2(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new l)}return _createClass2(e,[{key:"profileKernel",value:function(e,t,n){for(var r,a=this.backendTimer.time((function(){r=n()})),i=function(t){var n=r[t];n.data().then((function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)}))},o=0;o<r.length;o++)i(o);return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var l=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"==typeof r?u.L(r+"ms",9):r.error,s=u.L(e,25),c=t.rank,l=t.size,h=u.L(t.shape.toString(),14),f="";for(var d in a){var p=a[d];if(null!=p){var m=p.shape||t.shape,v=m.length;f+="".concat(d,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(c,"D ").concat(h,"\t%c").concat(l,"\t%c").concat(f,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}(),h=n(5),f=n(12),d=n(7),p=function(){function e(){_classCallCheck2(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return _createClass2(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),m=function(){function e(t){_classCallCheck2(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new p}var t,n,a,i;return _createClass2(e,[{key:"ready",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=17;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=14;break}return e.next=13,this.setBackend(r);case 13:return e.abrupt("return",void e.sent);case 14:n++,e.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=14;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=11;break}return e.next=8,r;case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=r;case 12:if(e.t0){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",(this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new c(this.backendInstance),!0));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"setupRegisteredKernels",value:function(){var e=this;Object(s.c)(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;Object(s.c)(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(!a||a instanceof r.b||"function"!=typeof a.then)return this.registry[e]=a,{success:!0,asyncInit:!1};var i=++this.pendingBackendInitId,o=a.then((function(n){return!(i<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message)),!1}));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}catch(n){return console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype);return this.addTapeNode(this.state.activeScope.name,{x:e},[t],(function(e){return{x:function(){return g.runKernelFunc((function(t){return t.cast(e,"float32")}),{x:e},null,o.v,{dtype:"float32"})}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n,r,a){return this.runKernelFunc(null,t,null,e,n,r,a)}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=r-t-a-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(i>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(i," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e,t,n,r,a,i,o){var u,c=this,l=[],h=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var f,d=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,v,g=Object(s.b)(r,this.backendName);if(null!=g)f=function(){var e=c.backend.numDataIds();m=g.kernelFunc({inputs:t,attrs:a,backend:c.backend});var n=Array.isArray(m)?m:[m];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return c.makeTensorFromDataId(t,n,r)}));if(h){var u=c.getTensorsForGradient(r,t,s);if(null==u){null==o&&(o=[]);var f=s.filter((function(e,t){return o[t]}));u=(i||[]).slice().concat(f)}l=c.saveTensorsForBackwardMode(u)}return s};else{var y=function(e){h&&(l=e.map((function(e){return c.keep(c.clone(e))})))};f=function(){var t=c.backend.numDataIds();m=c.tidy((function(){return e(c.backend,y)}));var n=Array.isArray(m)?m:[m];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun((function(){return c.state.kernelDepth++}),(function(){return c.state.kernelDepth--}),(function(){c.ENV.getBool("DEBUG")||c.state.profiling?(v=c.profiler.profileKernel(r,t,(function(){return f()})),c.ENV.getBool("DEBUG")&&c.profiler.logKernelProfile(v),u=v.outputs):u=f()})),h&&this.addTapeNode(r,t,u,n,l,a),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-d,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return null!=t[e]?t[e].shape:null})),outputShapes:u.map((function(e){return e.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(m)?u:u[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=Object(s.a)(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(u.b(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var c=n.filter((function(e,t){return o[t]}));return a.concat(c)}return null}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");r=r||this.backend;var a=e;"string"===(n=n||"float32")&&u.z(e[0])&&(a=e.map((function(e){return d.encodeString(e)})));var i=r.write(a,t,n),o=new h.a(t,n,i,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(i),c=Object(u.f)(a);this.state.numBytes+=c-s.bytes,s.bytes=c}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a=new h.a(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,r),a}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new h.c(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"incRef",value:function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*u.g(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof h.c||this.track(e)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[e])}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=5,t();case 5:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,_toConsumableArray(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=_createForOfIteratorHelper(this.state.activeProfile.kernels),e.prev=11,a.s();case 13:if((i=a.n()).done){e.next=23;break}return o=i.value,e.next=17,o.kernelTimeMs;case 17:return o.kernelTimeMs=e.sent,e.next=20,o.extraInfo;case 20:o.extraInfo=e.sent;case 21:e.next=13;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(11),a.e(e.t0);case 28:return e.prev=28,a.f(),e.finish(28);case 31:return e.abrupt("return",this.state.activeProfile);case 32:case"end":return e.stop()}}),e,this,[[11,25,28,31]])}))),function(e){return n.apply(this,arguments)})},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,c={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},l=Object(s.a)(e);null!=l&&(r=l.gradFunc),null!=r&&(c.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=u.F(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(c)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=Object(f.a)(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(u.b(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));u.b(i instanceof h.a,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],h=!1,f=0;f<t.length;f++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),h=!0,a[s.id]=!0;break}if(h)break}}var d={};d[n.id]=!0;for(var p={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(d[v.outputs[y].id]){for(var _ in g)d[g[_].id]=!0,p[v.id]=!0;break}for(var b=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&p[w.id]){var x={};for(var C in w.inputs){var S=w.inputs[C];r[S.id]&&(x[C]=S)}var T=Object.assign({},w);T.inputs=x,T.outputs=w.outputs,b.push(T)}}return b}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?function(e){var t=Object(u.D)(Object(u.N)(e),"float32");return g.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,a){for(var i=function(n){var i=t[n],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];o.push(null!=n?n:null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(i.kernelName,"."));var s=i.gradient(o),c=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". Available gradients found: ").concat(Object.keys(s),"."));var n=function(e){return r.tidy(e)}((function(){return s[t]()}));if("float32"!==n.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ").concat(t," must have 'float32' dtype, but has '").concat(n.dtype,"'"));var o=i.inputs[t];if(!u.a(n.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input '").concat(t,"' has shape '").concat(n.shape,"', which does not match the shape of the input '").concat(o.shape,"'"));if(null==e[o.id])e[o.id]=n;else{var c=e[o.id];e[o.id]=a(c,n),c.dispose()}};for(var l in i.inputs)c(l)},o=t.length-1;o>=0;o--)i(o)}(e,o,0,y);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=_createForOfIteratorHelper(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return u.b(u.u(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;u.b(r.every((function(e){return e instanceof h.a})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};return r.forEach((function(e,t){o[t]=e})),t.runKernelFunc((function(t,n){return i=e.apply(void 0,r.concat([n])),u.b(i.value instanceof h.a,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),u.b(u.u(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value}),o,(function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];u.b(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),u.b(a.every((function(e){return e instanceof h.a})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"time",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(d.now)(),e.next=3,this.backend.time(t);case 3:return r=e.sent,e.abrupt("return",(r.wallMs=Object(d.now)()-n,r));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new p,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(t)}return this.backendInstance}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}}]),e}();function v(){var e=Object(i.b)();if(null==e._tfengine){var t=new a.a(e);e._tfengine=new m(t)}return Object(a.c)(e._tfengine.ENV),Object(h.f)((function(){return e._tfengine})),e._tfengine}m.nextTensorId=0,m.nextVariableId=0;var g=v();function y(e,t){return g.runKernelFunc((function(n,r){var a=n.add(e,t);return r([e,t]),a}),{a:e,b:t},null,o.d)}},function(e,t,n){"use strict";n.r(t),n.d(t,"createScalarValue",(function(){return i})),n.d(t,"toTypedArray",(function(){return o})),n.d(t,"now",(function(){return s})),n.d(t,"fetch",(function(){return u})),n.d(t,"encodeString",(function(){return c})),n.d(t,"decodeString",(function(){return l}));var r=n(11),a=n(16);function i(e,t){return"string"===t?c(e):o([e],t)}function o(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=a.m(e)),Object(r.b)().getBool("DEBUG")&&a.h(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),i=0;i<n.length;++i)0!==Math.round(e[i])&&(n[i]=1);return n}throw new Error("Unknown data type "+t)}function s(){return Object(r.b)().platform.now()}function u(e,t){return Object(r.b)().platform.fetch(e,t)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Object(r.b)().platform.encode(e,t)}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Object(r.b)().platform.decode(e,t)}n.d(t,"shuffle",(function(){return a.M})),n.d(t,"clamp",(function(){return a.i})),n.d(t,"nearestLargerEven",(function(){return a.H})),n.d(t,"sum",(function(){return a.Q})),n.d(t,"randUniform",(function(){return a.J})),n.d(t,"distSquared",(function(){return a.l})),n.d(t,"assert",(function(){return a.b})),n.d(t,"assertShapesMatch",(function(){return a.e})),n.d(t,"assertNonNull",(function(){return a.d})),n.d(t,"flatten",(function(){return a.m})),n.d(t,"sizeFromShape",(function(){return a.N})),n.d(t,"isScalarShape",(function(){return a.y})),n.d(t,"arraysEqual",(function(){return a.a})),n.d(t,"isInt",(function(){return a.v})),n.d(t,"tanh",(function(){return a.R})),n.d(t,"sizeToSquarishShape",(function(){return a.O})),n.d(t,"createShuffledIndices",(function(){return a.k})),n.d(t,"rightPad",(function(){return a.L})),n.d(t,"repeatedTry",(function(){return a.K})),n.d(t,"inferFromImplicitShape",(function(){return a.s})),n.d(t,"parseAxisParam",(function(){return a.I})),n.d(t,"squeezeShape",(function(){return a.P})),n.d(t,"getTypedArrayFromDType",(function(){return a.o})),n.d(t,"getArrayFromDType",(function(){return a.n})),n.d(t,"checkConversionForErrors",(function(){return a.h})),n.d(t,"isValidDtype",(function(){return a.B})),n.d(t,"hasEncodingLoss",(function(){return a.p})),n.d(t,"isTypedArray",(function(){return a.A})),n.d(t,"bytesPerElement",(function(){return a.g})),n.d(t,"bytesFromStringArray",(function(){return a.f})),n.d(t,"isString",(function(){return a.z})),n.d(t,"isBoolean",(function(){return a.t})),n.d(t,"isNumber",(function(){return a.w})),n.d(t,"inferDtype",(function(){return a.r})),n.d(t,"isFunction",(function(){return a.u})),n.d(t,"nearestDivisor",(function(){return a.G})),n.d(t,"computeStrides",(function(){return a.j})),n.d(t,"toNestedArray",(function(){return a.S})),n.d(t,"makeOnesTypedArray",(function(){return a.D})),n.d(t,"makeZerosTypedArray",(function(){return a.F})),n.d(t,"makeZerosNestedTypedArray",(function(){return a.E})),n.d(t,"assertNonNegativeIntegerDimensions",(function(){return a.c})),n.d(t,"locToIndex",(function(){return a.C})),n.d(t,"indexToLoc",(function(){return a.q})),n.d(t,"isPromise",(function(){return a.x}))},function(e,t,n){"use strict";n.r(t),n.d(t,"DEFAULT_QUARTERS_PER_MINUTE",(function(){return r})),n.d(t,"DEFAULT_STEPS_PER_BAR",(function(){return a})),n.d(t,"DEFAULT_STEPS_PER_QUARTER",(function(){return i})),n.d(t,"DEFAULT_STEPS_PER_SECOND",(function(){return o})),n.d(t,"DEFAULT_VELOCITY",(function(){return s})),n.d(t,"DEFAULT_PROGRAM",(function(){return u})),n.d(t,"DEFAULT_TICKS_PER_QUARTER",(function(){return c})),n.d(t,"DEFAULT_CHANNEL",(function(){return l})),n.d(t,"DRUM_CHANNEL",(function(){return h})),n.d(t,"NON_DRUM_CHANNELS",(function(){return f})),n.d(t,"MIN_MIDI_VELOCITY",(function(){return d})),n.d(t,"MAX_MIDI_VELOCITY",(function(){return p})),n.d(t,"MIDI_VELOCITIES",(function(){return m})),n.d(t,"NO_CHORD",(function(){return v})),n.d(t,"NUM_PITCH_CLASSES",(function(){return g})),n.d(t,"MIN_MIDI_PITCH",(function(){return y})),n.d(t,"MAX_MIDI_PITCH",(function(){return _})),n.d(t,"MIDI_PITCHES",(function(){return b})),n.d(t,"MIN_PIANO_PITCH",(function(){return k})),n.d(t,"MAX_PIANO_PITCH",(function(){return w})),n.d(t,"MIN_DRUM_PITCH",(function(){return x})),n.d(t,"MAX_DRUM_PITCH",(function(){return C})),n.d(t,"MIN_MIDI_PROGRAM",(function(){return S})),n.d(t,"MAX_MIDI_PROGRAM",(function(){return T})),n.d(t,"LO_CLICK_PITCH",(function(){return A})),n.d(t,"HI_CLICK_PITCH",(function(){return E})),n.d(t,"LO_CLICK_CLASS",(function(){return I})),n.d(t,"HI_CLICK_CLASS",(function(){return R}));var r=120,a=16,i=4,o=100,s=80,u=0,c=220,l=0,h=9,f=[0,1,2,3,4,5,6,7,8,10,11,12,13,14,15],d=0,p=127,m=p-d+1,v="N.C.",g=12,y=0,_=127,b=_-y+1,k=21,w=108,x=35,C=81,S=0,T=127,A=89,E=90,I=9,R=10},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=n(38).tensorflow.magenta.NoteSequence},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE__10__},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return s}));var r=n(16),a=function(){function e(t){_classCallCheck2(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}var t;return _createClass2(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(t,".")),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t in this.flags,e.t0){e.next=5;break}return e.next=4,this.evaluateFlag(t);case 4:this.flags[t]=e.sent;case 5:return e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Object(r.x)(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t=function(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")})),t}(this.global.location.search);"tfjsflags"in t&&t.tfjsflags.split(",").forEach((function(t){var n=_slicedToArray2(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(r,a)}))}}},{key:"features",get:function(){return this.flags}}]),e}();function i(){return o}var o=null;function s(e){o=e}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r=n(5),a=n(27);function i(e,t){if(e.dtype===t.dtype)return[e,t];var n=Object(a.b)(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function o(e){var t=[];return function e(t,n,a){if(null!=t)if(t instanceof r.a)n.push(t);else if(i=t,Array.isArray(i)||"object"==typeof i){var i,o=t;for(var s in o){var u=o[s];a.has(u)||(a.add(u),e(u,n,a))}}}(e,t,new Set),t}n(16)},function(e,t,n){"use strict";n.r(t),n.d(t,"Level",(function(){return r})),n.d(t,"verbosity",(function(){return i})),n.d(t,"setVerbosity",(function(){return o})),n.d(t,"log",(function(){return s})),n.d(t,"logWithDuration",(function(){return u}));var r,a=n(14);!function(e){e[e.NONE=0]="NONE",e[e.WARN=5]="WARN",e[e.INFO=10]="INFO",e[e.DEBUG=20]="DEBUG"}(r||(r={}));var i=10;function o(e){e=e}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Magenta.js",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;if(0===n)throw Error("Logging level cannot be NONE.");i>=n&&(5===n?console.warn:console.log)("%c ".concat(t," "),"background:magenta; color:white",e)}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Magenta.js",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;s("".concat(e," in ").concat(((a.d.now()-t)/1e3).toPrecision(3),"s"),n,r)}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a})),n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return u}));var r=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw new Error("cannot find the global object")}(),a=r.fetch.bind(r),i=r.performance,o=!!r.webkitOfflineAudioContext,s=void 0!==r.WorkerGlobalScope;function u(e){if(e=o?44100:e,s)throw new Error("Cannot use offline audio context in a web worker.");return o?new(0,r.webkitOfflineAudioContext)(1,e,e):new r.OfflineAudioContext(1,e,e)}}).call(this,n(21))},function(e,t,n){"use strict";n.r(t),n.d(t,"MultipleTimeSignatureException",(function(){return i})),n.d(t,"BadTimeSignatureException",(function(){return o})),n.d(t,"NegativeTimeException",(function(){return s})),n.d(t,"MultipleTempoException",(function(){return u})),n.d(t,"QuantizationStatusException",(function(){return c})),n.d(t,"clone",(function(){return l})),n.d(t,"stepsPerQuarterToStepsPerSecond",(function(){return h})),n.d(t,"quantizeToStep",(function(){return f})),n.d(t,"quantizeNoteSequence",(function(){return m})),n.d(t,"isQuantizedSequence",(function(){return v})),n.d(t,"assertIsQuantizedSequence",(function(){return g})),n.d(t,"isRelativeQuantizedSequence",(function(){return y})),n.d(t,"assertIsRelativeQuantizedSequence",(function(){return _})),n.d(t,"isAbsoluteQuantizedSequence",(function(){return b})),n.d(t,"assertIsAbsoluteQuantizedSequence",(function(){return k})),n.d(t,"unquantizeSequence",(function(){return w})),n.d(t,"createQuantizedNoteSequence",(function(){return x})),n.d(t,"mergeInstruments",(function(){return C})),n.d(t,"replaceInstruments",(function(){return S})),n.d(t,"mergeConsecutiveNotes",(function(){return T})),n.d(t,"concatenate",(function(){return A})),n.d(t,"trim",(function(){return E})),n.d(t,"split",(function(){return O}));var r=n(9),a=n(8),i=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),(this instanceof n?this.constructor:void 0).prototype),r}return n}(),o=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),(this instanceof n?this.constructor:void 0).prototype),r}return n}(),s=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),(this instanceof n?this.constructor:void 0).prototype),r}return n}(),u=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),(this instanceof n?this.constructor:void 0).prototype),r}return n}(),c=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),(this instanceof n?this.constructor:void 0).prototype),r}return n}();function l(e){return r.a.decode(r.a.encode(e).finish())}function h(e,t){return e*t/60}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return Math.floor(e*t+(1-n))}function d(e){return e.controlChanges.concat(e.textAnnotations)}function p(e){if(e.tempos&&0!==e.tempos.length){if(e.tempos.sort((function(e,t){return e.time-t.time})),0!==e.tempos[0].time&&e.tempos[0].qpm!==a.DEFAULT_QUARTERS_PER_MINUTE)throw new u("NoteSequence has an implicit tempo change from initial "+a.DEFAULT_QUARTERS_PER_MINUTE+" qpm to "+"".concat(e.tempos[0].qpm," qpm at ").concat(e.tempos[0].time," seconds."));for(var t=1;t<e.tempos.length;t++)if(e.tempos[t].qpm!==e.tempos[0].qpm)throw new u("NoteSequence has at least one tempo change from ".concat(e.tempos[0].qpm," qpm to ").concat(e.tempos[t].qpm,"qpm at ").concat(e.tempos[t].time," seconds."))}}function m(e,t){var n=l(e);if(n.quantizationInfo=r.a.QuantizationInfo.create({stepsPerQuarter:t}),n.timeSignatures.length>0){if(n.timeSignatures.sort((function(e,t){return e.time-t.time})),0!==n.timeSignatures[0].time&&(4!==n.timeSignatures[0].numerator||4!==n.timeSignatures[0].denominator))throw new i("NoteSequence has an implicit change from initial 4/4 time signature to ".concat(n.timeSignatures[0].numerator,"/")+n.timeSignatures[0].denominator+" at "+n.timeSignatures[0].time+" seconds.");for(var u=1;u<n.timeSignatures.length;u++){var c=n.timeSignatures[u];if(c.numerator!==n.timeSignatures[0].numerator||c.denominator!==n.timeSignatures[0].denominator)throw new i("NoteSequence has at least one time signature change from "+n.timeSignatures[0].numerator+"/"+n.timeSignatures[0].denominator+" to "+"".concat(c.numerator,"/").concat(c.denominator," ")+"at ".concat(c.time," seconds"))}n.timeSignatures[0].time=0,n.timeSignatures=[n.timeSignatures[0]]}else{var m=r.a.TimeSignature.create({numerator:4,denominator:4,time:0});n.timeSignatures.push(m)}var v,g=n.timeSignatures[0];if(!(v=g.denominator)||0!=(v&v-1))throw new o("Denominator is not a power of 2. Time signature: ".concat(g.numerator,"/").concat(g.denominator));if(0===g.numerator)throw new o("Numerator is 0. Time signature: ".concat(g.numerator,"/").concat(g.denominator));if(n.tempos.length>0)p(n),n.tempos[0].time=0,n.tempos=[n.tempos[0]];else{var y=r.a.Tempo.create({qpm:a.DEFAULT_QUARTERS_PER_MINUTE,time:0});n.tempos.push(y)}var _=h(t,n.tempos[0].qpm);return n.totalQuantizedSteps=f(e.totalTime,_),function(e,t){var n,r=_createForOfIteratorHelper(e.notes);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.quantizedStartStep=f(a.startTime,t),a.quantizedEndStep=f(a.endTime,t),a.quantizedEndStep===a.quantizedStartStep&&(a.quantizedEndStep+=1),a.quantizedStartStep<0||a.quantizedEndStep<0)throw new s("Got negative note time: start_step = "+a.quantizedStartStep+", end_step = "+a.quantizedEndStep);a.quantizedEndStep>e.totalQuantizedSteps&&(e.totalQuantizedSteps=a.quantizedEndStep)}}catch(i){r.e(i)}finally{r.f()}d(e).forEach((function(e){if(e.quantizedStep=f(e.time,t),e.quantizedStep<0)throw new s("Got negative event time: step = "+e.quantizedStep)}))}(n,_),n}function v(e){return e.quantizationInfo&&(e.quantizationInfo.stepsPerQuarter>0||e.quantizationInfo.stepsPerSecond>0)}function g(e){if(!v(e))throw new c("NoteSequence ".concat(e.id," is not quantized (missing quantizationInfo)"))}function y(e){return e.quantizationInfo&&e.quantizationInfo.stepsPerQuarter>0}function _(e){if(!y(e))throw new c("NoteSequence ".concat(e.id," is not quantized or is quantized based on absolute timing"))}function b(e){return e.quantizationInfo&&e.quantizationInfo.stepsPerSecond>0}function k(e){if(!b(e))throw new c("NoteSequence ".concat(e.id," is not quantized or is quantized based on relative timing"))}function w(e,t){_(e),p(e);var n=l(e);t?n.tempos&&n.tempos.length>0?n.tempos[0].qpm=t:n.tempos.push(r.a.Tempo.create({time:0,qpm:t})):t=e.tempos&&e.tempos.length>0?n.tempos[0].qpm:a.DEFAULT_QUARTERS_PER_MINUTE;var i=function(e){return e/n.quantizationInfo.stepsPerQuarter*(60/t)};return n.totalTime=i(n.totalQuantizedSteps),n.notes.forEach((function(e){e.startTime=i(e.quantizedStartStep),e.endTime=i(e.quantizedEndStep),n.totalTime=Math.max(n.totalTime,e.endTime),delete e.quantizedStartStep,delete e.quantizedEndStep})),d(n).forEach((function(e){e.time=i(e.time)})),delete n.totalQuantizedSteps,delete n.quantizationInfo,n}function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.DEFAULT_STEPS_PER_QUARTER,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.DEFAULT_QUARTERS_PER_MINUTE;return r.a.create({quantizationInfo:{stepsPerQuarter:e},tempos:[{qpm:t}]})}function C(e){var t=l(e),n=t.notes.concat(t.pitchBends).concat(t.controlChanges),r=Array.from(new Set(n.filter((function(e){return!e.isDrum})).map((function(e){return e.program}))));return n.forEach((function(e){e.isDrum?(e.program=0,e.instrument=r.length):e.instrument=r.indexOf(e.program)})),t}function S(e,t){var n=new Set(e.notes.map((function(e){return e.instrument}))),a=new Set(t.notes.map((function(e){return e.instrument}))),i=[];e.notes.forEach((function(e){a.has(e.instrument)||i.push(r.a.Note.create(e))})),t.notes.forEach((function(e){n.has(e.instrument)&&i.push(r.a.Note.create(e))}));var o=l(e);return o.notes=i.sort((function(e,t){return e.instrument-t.instrument||e.quantizedStartStep-t.quantizedStartStep})),o}function T(e){g(e);var t=l(e);t.notes=[];var n=e.notes.sort((function(e,t){return e.instrument-t.instrument||e.quantizedStartStep-t.quantizedStartStep})),a=new r.a.Note;a.pitch=n[0].pitch,a.instrument=n[0].instrument,a.quantizedStartStep=n[0].quantizedStartStep,a.quantizedEndStep=n[0].quantizedEndStep,t.notes.push(a);for(var i=0,o=1;o<n.length;o++){var s=n[o],u=t.notes[i];if(u.instrument===s.instrument&&u.pitch===s.pitch&&s.quantizedStartStep===u.quantizedEndStep&&s.quantizedStartStep%16!=0)t.notes[i].quantizedEndStep+=s.quantizedEndStep-s.quantizedStartStep;else{var c=new r.a.Note;c.pitch=n[o].pitch,c.instrument=n[o].instrument,c.quantizedStartStep=n[o].quantizedStartStep,c.quantizedEndStep=n[o].quantizedEndStep,t.notes.push(c),i++}}return t}function A(e,t){if(t&&t.length!==e.length)throw new Error("Number of sequences to concatenate and their individual\n durations does not match.");if(v(e[0])){for(var n=0;n<e.length;++n)if(g(e[n]),e[n].quantizationInfo.stepsPerQuarter!==e[0].quantizationInfo.stepsPerQuarter)throw new Error("Not all sequences have the same quantizationInfo");return I(e,"totalQuantizedSteps","quantizedStartStep","quantizedEndStep",t)}return I(e,"totalTime","startTime","endTime",t)}function E(e,t,n,r){return v(e)?R(e,t,n,"totalQuantizedSteps","quantizedStartStep","quantizedEndStep",r):R(e,t,n,"totalTime","startTime","endTime",r)}function I(e,t,n,a,i){for(var o,s=0,u=0;u<e.length;++u){var c=i?i[u]:e[u][t];if(0===c)throw Error("Sequence ".concat(e[u].id," has no ").concat(t,", and no individual duration was provided."));0===u?o=l(e[0]):Array.prototype.push.apply(o.notes,e[u].notes.map((function(e){var t=r.a.Note.create(e);return t[n]+=s,t[a]+=s,t}))),s+=c}return o[t]=s,o}function R(e,t,n,r,a,i,o){var s=l(e);s[r]=n,s.notes=s.notes.filter((function(e){return e[a]>=t&&e[a]<=n&&(o||e[i]<=n)})),s[r]-=t;for(var u=0;u<s.notes.length;u++)s.notes[u][a]-=t,s.notes[u][i]-=t,o&&(s.notes[u][i]=Math.min(s.notes[u][i],s[r]));return s}function O(e,t){g(e);for(var n=l(e),a=n.notes.sort((function(e,t){return e.quantizedStartStep-t.quantizedStartStep})),i=[],o=0,s=[],u=0;u<a.length;u++){var c=a[u],h=c.quantizedStartStep,f=c.quantizedEndStep;if(c.quantizedStartStep-=o,c.quantizedEndStep-=o,!(c.quantizedStartStep<0))if(c.quantizedEndStep<=t)s.push(c);else{if(c.quantizedStartStep<t){var d=r.a.Note.create(c);d.quantizedEndStep=t,d.startTime=d.endTime=void 0,s.push(d),c.quantizedStartStep=o+t,c.quantizedEndStep=f}else c.quantizedStartStep=h,c.quantizedEndStep=f;if((c.quantizedEndStep>t||c.quantizedStartStep>t)&&(u-=1),0!==s.length){var p=l(n);p.notes=s,p.totalQuantizedSteps=t,i.push(p)}s=[],o+=t}}if(0!==s.length){var m=l(n);m.notes=s,m.totalQuantizedSteps=t,i.push(m)}return i}},function(e,t,n){"use strict";function r(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function a(e,t,n){return Math.max(e,Math.min(t,n))}function i(e){return e%2==0?e:e+1}function o(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function s(e,t){var n=Math.random();return t*n+(1-n)*e}function u(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n}function c(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";c(m(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function h(e){c(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||R(e)&&!n)for(var r=0;r<e.length;++r)f(e[r],t,n);else t.push(e);return t}function d(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function p(e){return 0===e.length}function m(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function v(e){return e%1==0}function g(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function y(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function _(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return r(t),t}function b(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function k(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise((function(r,a){var i=0;!function o(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}}()}))}function w(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function x(e,t){var n=t.length;return c((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ")+e})),c(e.every((function(e){return v(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function C(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:x(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function S(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function T(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function A(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function E(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function I(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function R(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function O(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function N(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function D(e){return"string"==typeof e||e instanceof String}function P(e){return"boolean"==typeof e}function F(e){return"number"==typeof e}function M(e){return Array.isArray(e)?M(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":F(e)?"float32":D(e)?"string":P(e)?"bool":"float32"}function L(e){return!!(e&&e.constructor&&e.call&&e.apply)}function z(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function B(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function j(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length,"."));return function e(t,n,r){var a=new Array;if(1===n.length)for(var i=n[0],o=0;o<i;o++)a[o]=r[t+o];else for(var s=n[0],u=n.slice(1),c=u.reduce((function(e,t){return e*t})),l=0;l<s;l++)a[l]=e(t+l*c,u,r);return a}(0,e,t)}function V(e,t){for(var n=q(e,t),r=0;r<n.length;r++)n[r]=1;return n}function q(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function U(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return j(e,new Float32Array(n));if("int32"===t)return j(e,new Int32Array(n));if("bool"===t)return j(e,new Uint8Array(n));throw new Error("Unknown data type "+t)}function W(e){e.forEach((function(t){c(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")}))}))}function G(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function H(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function K(e){return e&&e.then&&"function"==typeof e.then}n.d(t,"M",(function(){return r})),n.d(t,"i",(function(){return a})),n.d(t,"H",(function(){return i})),n.d(t,"Q",(function(){return o})),n.d(t,"J",(function(){return s})),n.d(t,"l",(function(){return u})),n.d(t,"b",(function(){return c})),n.d(t,"e",(function(){return l})),n.d(t,"d",(function(){return h})),n.d(t,"m",(function(){return f})),n.d(t,"N",(function(){return d})),n.d(t,"y",(function(){return p})),n.d(t,"a",(function(){return m})),n.d(t,"v",(function(){return v})),n.d(t,"R",(function(){return g})),n.d(t,"O",(function(){return y})),n.d(t,"k",(function(){return _})),n.d(t,"L",(function(){return b})),n.d(t,"K",(function(){return k})),n.d(t,"s",(function(){return w})),n.d(t,"I",(function(){return x})),n.d(t,"P",(function(){return C})),n.d(t,"o",(function(){return S})),n.d(t,"n",(function(){return T})),n.d(t,"h",(function(){return A})),n.d(t,"B",(function(){return E})),n.d(t,"p",(function(){return I})),n.d(t,"A",(function(){return R})),n.d(t,"g",(function(){return O})),n.d(t,"f",(function(){return N})),n.d(t,"z",(function(){return D})),n.d(t,"t",(function(){return P})),n.d(t,"w",(function(){return F})),n.d(t,"r",(function(){return M})),n.d(t,"u",(function(){return L})),n.d(t,"G",(function(){return z})),n.d(t,"j",(function(){return B})),n.d(t,"S",(function(){return j})),n.d(t,"D",(function(){return V})),n.d(t,"F",(function(){return q})),n.d(t,"E",(function(){return U})),n.d(t,"c",(function(){return W})),n.d(t,"C",(function(){return G})),n.d(t,"q",(function(){return H})),n.d(t,"x",(function(){return K}))},function(e,t,n){"use strict";(function(e){n.d(t,"f",(function(){return s})),n.d(t,"e",(function(){return c})),n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return p})),n.d(t,"d",(function(){return m})),n.d(t,"c",(function(){return v})),n.d(t,"g",(function(){return g}));var r=n(19),a=n(23),i=n(16),o=n(40);function s(e,t){return u.apply(this,arguments)}function u(){return(u=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=function(e){var o=i[e],s=Array.isArray(t)?t[e].tensor:t[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(s.dtype));var u={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){var c=new Promise(function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+4*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)u=n[o],c=new Uint8Array(new Uint32Array([u.length]).buffer),a.set(c,i),i+=4,a.set(u,i),i+=u.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());a.push(c)}else a.push(s.data());null!=n&&(u.group=n),r.push(u)},s=0;s<i.length;++s)o(s);return e.t0=l,e.next=6,Promise.all(a);case 6:return e.t1=e.sent,e.t2=(0,e.t0)(e.t1),e.t3=r,e.abrupt("return",{data:e.t2,specs:e.t3});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(e,t){var n,s,u={},c=0,l=_createForOfIteratorHelper(t);try{for(l.s();!(s=l.n()).done;){var h=s.value,f=h.name,d=h.dtype,p=h.shape,m=Object(i.N)(p),v=void 0;if("quantization"in h){var g=h.quantization;if("uint8"===g.dtype||"uint16"===g.dtype){if(!("min"in g&&"scale"in g))throw new Error("Weight ".concat(h.name," with quantization ").concat(g.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==g.dtype)throw new Error("Weight ".concat(h.name," has unknown quantization dtype ").concat(g.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==d)throw new Error("Weight ".concat(h.name," is quantized with ").concat(g.dtype," which only supports weights of type float32 not ").concat(d,"."))}var _=o.a[g.dtype],b=e.slice(c,c+m*_),k="uint8"===g.dtype?new Uint8Array(b):new Uint16Array(b);if("float32"===d)if("uint8"===g.dtype||"uint16"===g.dtype){v=new Float32Array(k.length);for(var w=0;w<k.length;w++)v[w]=k[w]*g.scale+g.min}else{if("float16"!==g.dtype)throw new Error("Unsupported quantization type ".concat(g.dtype," for weight type float32."));void 0===n&&(n=y()),v=n(k)}else{if("int32"!==d)throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(d));if("uint8"!==g.dtype&&"uint16"!==g.dtype)throw new Error("Unsupported quantization type ".concat(g.dtype," for weight type int32."));v=new Int32Array(k.length);for(var x=0;x<k.length;x++)v[x]=Math.round(k[x]*g.scale+g.min)}c+=m*_}else if("string"===d){var C=Object(i.N)(h.shape);v=[];for(var S=0;S<C;S++){var T=new Uint32Array(e.slice(c,c+4))[0];c+=4;var A=new Uint8Array(e.slice(c,c+T));v.push(A),c+=T}}else{var E=o.a[d],I=e.slice(c,c+m*E);if("float32"===d)v=new Float32Array(I);else if("int32"===d)v=new Int32Array(I);else if("bool"===d)v=new Uint8Array(I);else{if("complex64"!==d)throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(d));v=new Float32Array(I);for(var R=new Float32Array(v.length/2),O=new Float32Array(v.length/2),N=0;N<R.length;N++)R[N]=v[2*N],O[N]=v[2*N+1];var D=Object(a.a)(R,p,"float32"),P=Object(a.a)(O,p,"float32");u[f]=Object(r.a)(D,P),D.dispose(),P.dispose()}c+=m*E}"complex64"!==d&&(u[f]=Object(a.a)(v,p,d))}}catch(F){l.e(F)}finally{l.f()}return u}function l(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var h=void 0!==e&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function f(t){return h?e.byteLength(t):new Blob([t]).size}function d(t){if(h)return e.from(t).toString("base64");for(var n=new Uint8Array(t),r="",a=0,i=n.length;a<i;a++)r+=String.fromCharCode(n[a]);return btoa(r)}function p(t){if(h){var n=e.from(t,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}for(var r=atob(t),a=new Uint8Array(r.length),i=0;i<r.length;++i)a.set([r.charCodeAt(i)],i);return a.buffer}function m(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function v(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function g(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:f(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:f(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function y(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0==(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|(n+=947912704)},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o];i[o]=e[n[s>>10]+(1023&s)]+t[s>>10]}return new Float32Array(a)}}}).call(this,n(64).Buffer)},function(e,t,n){"use strict";(function(e){var r=t;function a(e,t,n){for(var r=Object.keys(t),a=0;a<r.length;++a)void 0!==e[r[a]]&&n||(e[r[a]]=t[r[a]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&a(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}r.asPromise=n(50),r.base64=n(51),r.EventEmitter=n(52),r.float=n(53),r.inquire=n(54),r.utf8=n(55),r.pool=n(56),r.LongBits=n(57),r.isNode=Boolean(void 0!==e&&e&&e.process&&e.process.versions&&e.process.versions.node),r.global=r.isNode&&e||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isObject=function(e){return e&&"object"==typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"==typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=a,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=i,r.ProtocolError=i("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&null!=this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}}).call(this,n(21))},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(6),a=n(1),i=n(3),o=n(16),s=n(4),u=Object(s.a)({complex_:function(e,t){var n=Object(i.a)(e,"real","complex"),s=Object(i.a)(t,"imag","complex");return o.e(n.shape,s.shape,"real and imag shapes, ".concat(n.shape," and ").concat(s.shape,", must match in call to tf.complex().")),r.a.runKernelFunc((function(e){return e.complex(n,s)}),{real:n,imag:s},null,a.y)}})},function(e,t,n){"use strict";n.d(t,"e",(function(){return l})),n.d(t,"d",(function(){return f})),n.d(t,"f",(function(){return p})),n.d(t,"i",(function(){return m})),n.d(t,"j",(function(){return g})),n.d(t,"a",(function(){return b})),n.d(t,"h",(function(){return k})),n.d(t,"b",(function(){return C})),n.d(t,"g",(function(){return T})),n.d(t,"c",(function(){return A}));var r=n(2),a=n(43),i=n(30),o=n(71),s=n(14),u=n(13),c=Object(s.b)(16e3);function l(e){return h.apply(this,arguments)}function h(){return(h=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(s.a)(t).then((function(e){return e.arrayBuffer()})).then((function(e){return c.decodeAudioData(e)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return d.apply(this,arguments)}function d(){return(d=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new FileReader,e.abrupt("return",new Promise((function(e,r){n.onerror=function(){n.abort(),r(new DOMException("Something went wrong reading that file."))},n.onload=function(){e(n.result)},n.readAsArrayBuffer(t)})).then((function(e){return c.decodeAudioData(e)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t){t.power||(t.power=2);var n=_slicedToArray2(function(e,t){return[e.map((function(e){return function(e,t){return e.map((function(e){return Math.pow(e,t)}))}(function(e){for(var t=new Float32Array(e.length/2),n=0;n<e.length/2;n++)t[n]=Math.sqrt(e[2*n]*e[2*n]+e[2*n+1]*e[2*n+1]);return t}(e),t)})),e[0].length-1]}(function(e,t){var n=t.nFft||2048,r=t.winLength||n,a=t.hopLength||Math.floor(r/4),i=C(r);i=k(i,n);for(var o=function(e,t,n){for(var r=Math.floor((e.length-t)/n)+1,a=Array.from({length:r},(function(e,n){return new Float32Array(t)})),i=0;i<r;i++){var o=i*n,s=e.slice(o,o+t);a[i].set(s)}return a}(e=function(e,t){for(var n=w(e,t),r=0;r<t;r++)n[r]=n[2*t-r],n[n.length-r-1]=n[n.length-2*t+r-1];return n}(e,Math.floor(n/2)),n,a),s=[],u=o.length,c=n+2,l=0;l<u;l++){var h=new Float32Array(c);s[l]=h}for(var f=0;f<u;f++){var d=x(b(o[f],i));s[f].set(d.slice(0,c))}return s}(e,t),t.power),2),r=n[0],a=n[1];return t.nFft=a,function(e,t){for(var n=[],r=0;r<e.length;r++)n[r]=_(e[r],t);return n}(r,function(e){for(var t=e.fMin||0,n=e.fMax||e.sampleRate/2,r=e.nMels||128,a=function(e,t){return S(0,e/2,Math.floor(1+t/2))}(e.sampleRate,e.nFft||2048),i=function(e,t,n){return S(I(t),I(n),e).map((function(e){return function(e){return 700*(Math.exp(e/1125)-1)}(e)}))}(r+2,t,n),o=function(e){for(var t=new Float32Array(e.length-1),n=0;n<e.length;n++)t[n]=e[n+1]-e[n];return t}(i),s=function(e,t){for(var n=[],r=0;r<e.length;r++)n[r]=new Float32Array(t.length);for(var a=0;a<e.length;a++)for(var i=0;i<t.length;i++)n[a][i]=e[a]-t[i];return n}(i,a),u=s[0].length,c=[],l=0;l<r;l++){c[l]=new Float32Array(u);for(var h=0;h<s[l].length;h++){var f=Math.max(0,Math.min(-s[l][h]/o[l],s[l+2][h]/o[l+1]));c[l][h]=f}}for(var d=function(e){var t=2/(i[2+e]-i[e]);c[e]=c[e].map((function(e){return e*t}))},p=0;p<c.length;p++)d(p);return c}(t))}function m(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:80,r=e.length,a=e[0].length,i=[],o=0;o<r;o++)i[o]=new Float32Array(a);for(var s=0;s<r;s++)for(var u=0;u<a;u++)i[s][u]=10*Math.log10(Math.max(t,e[s][u]));if(n){if(n<0)throw new Error("topDb must be non-negative.");for(var c=0;c<r;c++)for(var l=i[c].reduce((function(e,t){return Math.max(e,t)})),h=0;h<a;h++)i[c][h]=Math.max(i[c][h],l-n)}return i}function v(e){if(1===e.numberOfChannels)return e.getChannelData(0);if(2!==e.numberOfChannels)throw Error(e.numberOfChannels+" channel audio is not supported.");for(var t=e.getChannelData(0),n=e.getChannelData(1),r=new Float32Array(e.length),a=0;a<e.length;++a)r[a]=(t[a]+n[a])/2;return r}function g(e){return y.apply(this,arguments)}function y(){return(y=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,c,l,h,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.length>1&&void 0!==f[1]?f[1]:16e3,t.sampleRate!==n){e.next=3;break}return e.abrupt("return",v(t));case 3:if(r=t.length*n/t.sampleRate,!s.c){e.next=8;break}return u.log("Safari does not support WebAudio resampling, so this may be slow.","O&F",5),a=v(t),c=new Float32Array(r),e.abrupt("return",(o(i(c,[r]),i(a,[a.length])),c));case 8:return l=new OfflineAudioContext(t.numberOfChannels,t.duration*n,n),h=l.createBufferSource(),e.abrupt("return",(h.buffer=t,h.connect(l.destination),h.start(),l.startRendering().then((function(e){return e.getChannelData(0)}))));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t){if(e.length!==t[0].length)throw new Error("Each entry in filterbank should have dimensions matching FFT. |mags| = ".concat(e.length,", |filterbank[0]| = ").concat(t[0].length,"."));for(var n=new Float32Array(t.length),r=0;r<t.length;r++){var a=b(e,t[r]);n[r]=a.reduce((function(e,t){return e+t}))}return n}function b(e,t){if(e.length!==t.length)return console.error("Buffer length ".concat(e.length," != window length ").concat(t.length,".")),null;for(var n=new Float32Array(e.length),r=0;r<e.length;r++)n[r]=t[r]*e[r];return n}function k(e,t){if(e.length>t)throw new Error("Data is longer than length.");var n=Math.floor((t-e.length)/2);return w(e,[n,t-e.length-n])}function w(e,t){var n,r,a;"object"==typeof t?(r=(n=_slicedToArray2(t,2))[0],a=n[1]):r=a=t;var i=new Float32Array(e.length+r+a);return i.set(e,r),i}function x(e){var t=new a(e.length),n=t.createComplexArray(),r=t.toComplexArray(e);return t.transform(n,r),n}function C(e){for(var t=new Float32Array(e),n=0;n<e;n++)t[n]=.5*(1-Math.cos(2*Math.PI*n/(e-1)));return t}function S(e,t,n){for(var r=(t-e)/(n-1),a=new Float32Array(n),i=0;i<n;i++)a[i]=e+r*i;return a}function T(e){var t=r.sub(e,69);return t=r.div(t,12),t=r.pow(2,t),t=r.mul(440,t)}function A(e){return E.apply(this,arguments)}function E(){return(E=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.sub(r.div(r.log(t),r.log(2)),r.div(r.log(440),r.log(2))),n=r.mul(12,n),n=r.add(n,69),e.next=5,n.array();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return 1125*Math.log(1+e/700)}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(3),a=n(28);function i(e,t,n){var i=Object(r.c)(e,n);return Object(a.a)(e,t,i,n)}},function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"f",(function(){return c})),n.d(t,"d",(function(){return l})),n.d(t,"a",(function(){return h})),n.d(t,"h",(function(){return f})),n.d(t,"g",(function(){return p}));var r=n(2),a=n(20),i=n(41),o=16e3,s=250,u=25.58,c=63.07,l=.002,h=.7;function f(e){return d.apply(this,arguments)}function d(){return(d=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.loadGraphModel(t,{fromTFHub:!0});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t,n){return m.apply(this,arguments)}function m(){return(m=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,u){var c,l,h,f,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("webgl"===r.getBackend()){e.next=2;break}throw new Error("Device does not support webgl.");case 2:return e.next=4,Object(a.j)(t,o);case 4:return c=e.sent,l=c.length,e.next=8,function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i,u,c,l,h,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Math.floor(o/s),a=r.tensor1d(t,"float32"),i=t.length,null!==a){e.next=3;break}return e.abrupt("return",[]);case 3:return u=a.mul(a).reshape([i,1]),c=r.conv1d(u,r.ones([1024,1,1]).div(1024),n,"same").sqrt().squeeze(),l=r.mul(r.log(r.maximum(1e-20,c)).div(r.log(10)),20),h=l.sub(20.7),f=r.maximum(h,-120),e.next=10,f.array();case 10:return d=e.sent,e.abrupt("return",(a.dispose(),u.dispose(),c.dispose(),l.dispose(),h.dispose(),f.dispose(),d));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(c);case 8:return h=e.sent,e.next=11,Object(i.a)(n,c,u);case 11:return f=e.sent,d=f.pitches,p=f.confidences,e.abrupt("return",{f0_hz:d,loudness_db:h,confidences:p,originalRecordedBufferLength:l});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return c})),n.d(t,"e",(function(){return l})),n.d(t,"d",(function(){return h}));var r=n(11),a=n(39),i=Object(a.a)("kernelRegistry",(function(){return new Map})),o=Object(a.a)("gradRegistry",(function(){return new Map}));function s(e,t){var n=f(e,t);return i.get(n)}function u(e){return o.get(e)}function c(e){for(var t=i.entries(),n=[];;){var r=t.next(),a=r.done,o=r.value;if(a)break;var s=_slicedToArray2(o,2),u=s[0],c=s[1];_slicedToArray2(u.split("_"),1)[0]===e&&n.push(c)}return n}function l(e){var t=e.kernelName,n=e.backendName,r=f(t,n);i.has(r)&&console.warn("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),i.set(r,e)}function h(e){var t=e.kernelName;o.has(t)&&Object(r.b)().getBool("DEBUG")&&console.warn("Overriding the gradient for '".concat(t,"'")),o.set(t,e)}function f(e,t){return"".concat(t,"_").concat(e)}},function(e,t,n){"use strict";n.r(t),n.d(t,"NO_EVENT",(function(){return o})),n.d(t,"NOTE_OFF",(function(){return s})),n.d(t,"Melody",(function(){return u})),n.d(t,"MelodyRhythm",(function(){return c})),n.d(t,"MelodyShape",(function(){return l})),n.d(t,"MelodyRegister",(function(){return h}));var r=n(2),a=n(9),i=n(15),o=0,s=1,u=function(){function e(t,n,r){_classCallCheck2(this,e),this.events=t,this.minPitch=n,this.maxPitch=r}return _createClass2(e,[{key:"toNoteSequence",value:function(e,t){for(var n=i.createQuantizedNoteSequence(e,t),r=null,u=0;u<this.events.length;++u){var c=this.events[u];switch(c){case o:break;case s:r&&(r.quantizedEndStep=u,n.notes.push(r),r=null);break;default:r&&(r.quantizedEndStep=u,n.notes.push(r)),r=a.a.Note.create({pitch:c-2+this.minPitch,quantizedStartStep:u})}}return r&&(r.quantizedEndStep=this.events.length,n.notes.push(r)),n.totalQuantizedSteps=this.events.length,n}}],[{key:"fromNoteSequence",value:function(t,n,r){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4?arguments[4]:void 0;i.assertIsQuantizedSequence(t);var u=t.notes.sort((function(e,t){return e.quantizedStartStep===t.quantizedStartStep?t.pitch-e.pitch:e.quantizedStartStep-t.quantizedStartStep})),c=new Int32Array(o||t.totalQuantizedSteps),l=-1;return u.forEach((function(e){if(e.quantizedStartStep===l){if(a)return;throw new Error("`NoteSequence` is not monophonic.")}if(e.pitch<n||e.pitch>r)throw Error("`NoteSequence` has a pitch outside of the valid range: "+e.pitch);c[e.quantizedStartStep]=e.pitch-n+2,c[e.quantizedEndStep]=s,l=e.quantizedStartStep})),new e(c,n,r)}}]),e}(),c=function(){function e(){_classCallCheck2(this,e),this.depth=1}return _createClass2(e,[{key:"extract",value:function(e){for(var t=e.events.length,n=r.buffer([t,1]),a=0;a<t;++a)n.set(e.events[a]>=2?1:0,a,0);return n.toTensor().as2D(t,1)}}]),e}(),l=function(){function e(){_classCallCheck2(this,e),this.depth=3}return _createClass2(e,[{key:"extract",value:function(e){for(var t=e.events.length,n=r.buffer([t,3]),a=null,i=null,o=0;o<t;++o)if(e.events[o]>=2){if(null!==a){var s;0===n.get(a,0)&&0===n.get(a,1)&&0===n.get(a,2)&&(a=-1),s=e.events[o]<i?0:e.events[o]>i?2:1;for(var u=o;u>a;--u)n.set(1,u,s)}a=o,i=e.events[o]}if(a!==t-1)if(null===a||0===n.get(a,0)&&0===n.get(a,1)&&0===n.get(a,2))for(var c=0;c<t;++c)n.set(1,c,1);else for(var l=t-1;l>a;--l)for(var h=0;h<3;h++)n.set(n.get(a,h),l,h);return n.toTensor().as2D(t,3)}}]),e}(),h=function(){function e(t){_classCallCheck2(this,e),this.boundaryPitches=t,this.depth=t.length+1}return _createClass2(e,[{key:"meanMelodyPitch",value:function(e){for(var t=0,n=0,r=null,a=0;a<e.events.length;++a)e.events[a]===s?r=null:e.events[a]>=2&&(r=e.minPitch+e.events[a]-2),null!==r&&(t+=r,n+=1);return n?t/n:null}},{key:"extract",value:function(e){var t=e.events.length,n=this.meanMelodyPitch(e);if(null===n)return r.zeros([t,this.depth]);for(var a=0;a<this.boundaryPitches.length&&n>=this.boundaryPitches[a];)a++;for(var i=r.buffer([t,this.depth]),o=0;o<t;++o)i.set(1,o,a);return i.toTensor().as2D(t,this.depth)}}]),e}()},function(e,t,n){"use strict";var r,a,i,o,s;n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return l})),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(r||(r={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(a||(a={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(i||(i={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(o||(o={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(s||(s={}));var u={float32:o,int32:a,bool:i,complex64:s};function c(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return u[e][t]}function l(e){return c(e,"int32")}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(6),a=n(16),i=n(7);function o(e,t,n,o){if(null==o&&(o=Object(a.r)(e)),"complex64"===o)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Object(a.A)(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Object(a.c)(t);var s=Object(a.N)(t),u=Object(a.N)(n);Object(a.b)(s===u,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(s," values but has ").concat(u)}));for(var c=0;c<n.length;++c){var l=n[c],h=c!==n.length-1||l!==Object(a.N)(t.slice(c));Object(a.b)(n[c]===t[c]||!h,(function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")}))}}return Object(a.A)(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==o?Object(i.toTypedArray)(e,o):Object(a.m)(e,[],!0),r.a.makeTensor(e,t,o)}},function(e,t,n){"use strict";n.r(t),n.d(t,"DEFAULT_DRUM_PITCH_CLASSES",(function(){return l})),n.d(t,"converterFromSpec",(function(){return h})),n.d(t,"DataConverter",(function(){return f})),n.d(t,"DrumsConverter",(function(){return d})),n.d(t,"DrumRollConverter",(function(){return p})),n.d(t,"DrumsOneHotConverter",(function(){return m})),n.d(t,"MelodyConverter",(function(){return v})),n.d(t,"MelodyRhythmConverter",(function(){return y})),n.d(t,"MelodyShapeConverter",(function(){return _})),n.d(t,"TrioConverter",(function(){return b})),n.d(t,"TrioRhythmConverter",(function(){return k})),n.d(t,"MultitrackConverter",(function(){return w})),n.d(t,"GrooveConverter",(function(){return x}));var r=n(2),a=n(9),i=n(8),o=n(13),s=n(26),u=n(33),c=n(15),l=[[36,35],[38,27,28,31,32,33,34,37,39,40,56,65,66,75,85],[42,44,54,68,69,70,71,73,78,80],[46,67,72,74,79,81],[45,29,41,61,64,84],[48,47,60,63,77,86,87],[50,30,43,62,76,83],[49,55,57,58],[51,52,53,59,82]];function h(e){switch(e.type){case"MelodyConverter":return new v(e.args);case"MelodyRhythmConverter":return new y(e.args);case"MelodyShapeConverter":return new _(e.args);case"DrumsConverter":return new d(e.args);case"DrumRollConverter":return new p(e.args);case"TrioConverter":return new b(e.args);case"TrioRhythmConverter":return new k(e.args);case"DrumsOneHotConverter":return new m(e.args);case"MultitrackConverter":return new w(e.args);case"GrooveConverter":return new x(e.args);default:throw new Error("Unknown DataConverter type: "+e)}}var f=function(){function e(t){_classCallCheck2(this,e),this.NUM_SPLITS=0,this.SEGMENTED_BY_TRACK=!1,this.numSteps=t.numSteps,this.numSegments=t.numSegments}return _createClass2(e,[{key:"tensorSteps",value:function(e){return r.scalar(e.shape[0],"int32")}}]),e}(),d=function(e){_inherits(i,e);var t,n=_createSuper(i);function i(e){var t;_classCallCheck2(this,i),(t=n.call(this,e)).pitchClasses=e.pitchClasses||l,t.pitchToClass=new Map;for(var r=function(e){t.pitchClasses[e].forEach((function(n){t.pitchToClass.set(n,e)}))},a=0;a<t.pitchClasses.length;++a)r(a);return t.depth=t.pitchClasses.length+1,t}return _createClass2(i,[{key:"toTensor",value:function(e){var t=this;c.assertIsQuantizedSequence(e);for(var n=this.numSteps||e.totalQuantizedSteps,a=r.buffer([n,this.pitchClasses.length+1],"int32"),i=0;i<n;++i)a.set(1,i,-1);return e.notes.forEach((function(e){a.set(1,e.quantizedStartStep,t.pitchToClass.get(e.pitch)),a.set(0,e.quantizedStartStep,-1)})),a.toTensor()}},{key:"toNoteSequence",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var i,o,s,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.createQuantizedNoteSequence(n,r),o=t.argMax(1),e.next=4,o.data();case 4:for(s=e.sent,o.dispose(),u=0;u<s.length;++u)for(l=0;l<this.pitchClasses.length;l++)s[u]>>l&1&&i.notes.push(a.a.Note.create({pitch:this.pitchClasses[l][0],quantizedStartStep:u,quantizedEndStep:u+1,isDrum:!0}));return e.abrupt("return",(i.totalQuantizedSteps=s.length,i));case 8:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),i}(f),p=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(){return _classCallCheck2(this,r),n.apply(this,arguments)}return _createClass2(r,[{key:"toNoteSequence",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var i,o,s,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.createQuantizedNoteSequence(n,r),e.next=3,t.data();case 3:for(o=e.sent,s=0;s<t.shape[0];++s)for(u=o.slice(s*this.pitchClasses.length,(s+1)*this.pitchClasses.length),l=0;l<u.length;++l)u[l]&&i.notes.push(a.a.Note.create({pitch:this.pitchClasses[l][0],quantizedStartStep:s,quantizedEndStep:s+1,isDrum:!0}));return e.abrupt("return",(i.totalQuantizedSteps=t.shape[0],i));case 6:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),r}(d),m=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).depth=Math.pow(2,r.pitchClasses.length),r}return _createClass2(n,[{key:"toTensor",value:function(e){var t=this;c.assertIsRelativeQuantizedSequence(e);var n,a=Array(this.numSteps||e.totalQuantizedSteps).fill(0),i=_createForOfIteratorHelper(e.notes);try{for(i.s();!(n=i.n()).done;){var o=n.value,s=o.pitch,u=o.quantizedStartStep;a[u]+=Math.pow(2,this.pitchToClass.get(s))}}catch(l){i.e(l)}finally{i.f()}return r.tidy((function(){return r.oneHot(r.tensor1d(a,"int32"),t.depth)}))}}]),n}(d),v=function(e){_inherits(a,e);var t,n=_createSuper(a);function a(e){var t;return _classCallCheck2(this,a),(t=n.call(this,e)).NOTE_OFF=1,t.FIRST_PITCH=2,t.minPitch=e.minPitch,t.maxPitch=e.maxPitch,t.ignorePolyphony=e.ignorePolyphony,t.depth=e.maxPitch-e.minPitch+1+t.FIRST_PITCH,t}return _createClass2(a,[{key:"toTensor",value:function(e){var t=this,n=s.Melody.fromNoteSequence(e,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return r.tidy((function(){return r.oneHot(r.tensor(n.events,[n.events.length],"int32"),t.depth)}))}},{key:"toNoteSequence",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.argMax(1),e.next=3,a.data();case 3:return i=e.sent,e.abrupt("return",(a.dispose(),new s.Melody(i,this.minPitch,this.maxPitch).toNoteSequence(n,r)));case 5:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),a}(f),g=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e)).minPitch=e.minPitch,a.maxPitch=e.maxPitch,a.ignorePolyphony=e.ignorePolyphony,a.melodyControl=r,a.depth=r.depth,a}return _createClass2(n,[{key:"toTensor",value:function(e){var t=s.Melody.fromNoteSequence(e,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return this.melodyControl.extract(t)}}]),n}(f),y=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){return _classCallCheck2(this,r),n.call(this,e,new s.MelodyRhythm)}return _createClass2(r,[{key:"toNoteSequence",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.createQuantizedNoteSequence(n,r),e.next=3,t.data();case 3:for(o=e.sent,s=0;s<o.length;++s)o[s]&&i.notes.push(a.a.Note.create({pitch:l[1][0],quantizedStartStep:s,quantizedEndStep:s+1,isDrum:!0}));return e.abrupt("return",(i.totalQuantizedSteps=o.length,i));case 6:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),r}(g),_=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){return _classCallCheck2(this,r),n.call(this,e,new s.MelodyShape)}return _createClass2(r,[{key:"toNoteSequence",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var i,s,u,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.createQuantizedNoteSequence(n,r),s=t.argMax(1),e.next=4,s.data();case 4:u=e.sent,s.dispose(),l=Math.round((this.maxPitch+this.minPitch)/2),h=0;case 8:if(!(h<u.length)){e.next=19;break}e.t0=u[h],e.next=0===e.t0?12:2===e.t0?14:15;break;case 12:return(l-=1)<this.minPitch&&(l=this.minPitch,o.log("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter")),e.abrupt("break",15);case 14:(l+=1)>this.maxPitch&&(l=this.maxPitch,o.log("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter"));case 15:i.notes.push(a.a.Note.create({pitch:l,quantizedStartStep:h,quantizedEndStep:h+1}));case 16:++h,e.next=8;break;case 19:return e.abrupt("return",(i.totalQuantizedSteps=u.length,i));case 20:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),r}(g),b=function(e){_inherits(a,e);var t,n=_createSuper(a);function a(e){var t;return _classCallCheck2(this,a),(t=n.call(this,e)).NUM_SPLITS=3,t.MEL_PROG_RANGE=[0,31],t.BASS_PROG_RANGE=[32,39],e.melArgs.numSteps=e.numSteps,e.bassArgs.numSteps=e.numSteps,e.drumsArgs.numSteps=e.numSteps,t.melConverter=new v(e.melArgs),t.bassConverter=new v(e.bassArgs),t.drumsConverter=new m(e.drumsArgs),t.depth=t.melConverter.depth+t.bassConverter.depth+t.drumsConverter.depth,t}return _createClass2(a,[{key:"toTensor",value:function(e){var t=this;c.assertIsQuantizedSequence(e);var n=c.clone(e),a=c.clone(e),i=c.clone(e);return n.notes=e.notes.filter((function(e){return!e.isDrum&&e.program>=t.MEL_PROG_RANGE[0]&&e.program<=t.MEL_PROG_RANGE[1]})),a.notes=e.notes.filter((function(e){return!e.isDrum&&e.program>=t.BASS_PROG_RANGE[0]&&e.program<=t.BASS_PROG_RANGE[1]})),i.notes=e.notes.filter((function(e){return e.isDrum})),r.tidy((function(){return r.concat([t.melConverter.toTensor(n),t.bassConverter.toTensor(a),t.drumsConverter.toTensor(i)],-1)}))}},{key:"toNoteSequence",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a){var i,o,s,u,c,l,h=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.split(t,[this.melConverter.depth,this.bassConverter.depth,this.drumsConverter.depth],-1),e.next=3,this.melConverter.toNoteSequence(s[0],n,a);case 3:return(u=e.sent).notes.forEach((function(e){e.instrument=0,e.program=0})),e.next=7,this.bassConverter.toNoteSequence(s[1],n,a);case 7:return c=e.sent,(i=u.notes).push.apply(i,_toConsumableArray(c.notes.map((function(e){return e.instrument=1,e.program=h.BASS_PROG_RANGE[0],e})))),e.next=11,this.drumsConverter.toNoteSequence(s[2],n,a);case 11:return l=e.sent,e.abrupt("return",((o=u.notes).push.apply(o,_toConsumableArray(l.notes.map((function(e){return e.instrument=2,e})))),s.forEach((function(e){return e.dispose()})),u));case 13:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),a}(f),k=function(e){_inherits(i,e);var t,n=_createSuper(i);function i(e){var t;return _classCallCheck2(this,i),(t=n.call(this,e)).NUM_SPLITS=3,t.trioConverter=new b(e),t.depth=3,t}return _createClass2(i,[{key:"toTensor",value:function(e){var t=this;return r.tidy((function(){var n=t.trioConverter.toTensor(e),a=r.split(n,[t.trioConverter.melConverter.depth,t.trioConverter.bassConverter.depth,t.trioConverter.drumsConverter.depth],1),i=r.argMax(a[0],1),o=r.argMax(a[1],1),s=r.argMax(a[2],1),u=r.greater(i,1),c=r.greater(o,1),l=r.greater(s,0);return r.stack([u,c,l],1)}))}},{key:"toNoteSequence",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,i){var o,s,u,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.split(t,3,1),e.next=3,Promise.all(o.map((function(e){return e.data()})));case 3:for(s=e.sent,u=c.createQuantizedNoteSequence(n,i),h=0;h<this.numSteps;++h)s[0][h]&&u.notes.push(a.a.Note.create({pitch:72,quantizedStartStep:h,quantizedEndStep:h+1,instrument:0,program:0})),s[1][h]&&u.notes.push(a.a.Note.create({pitch:36,quantizedStartStep:h,quantizedEndStep:h+1,instrument:1,program:32})),s[2][h]&&u.notes.push(a.a.Note.create({pitch:l[1][0],quantizedStartStep:h,quantizedEndStep:h+1,instrument:2,isDrum:!0}));return e.abrupt("return",(u.totalQuantizedSteps=this.numSteps,u));case 7:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),i}(f),w=function(e){_inherits(a,e);var t,n=_createSuper(a);function a(e){var t;return _classCallCheck2(this,a),(t=n.call(this,e)).SEGMENTED_BY_TRACK=!0,t.stepsPerQuarter=e.stepsPerQuarter,t.totalSteps=e.totalSteps,t.numVelocityBins=e.numVelocityBins,t.minPitch=e.minPitch?e.minPitch:i.MIN_MIDI_PITCH,t.maxPitch=e.maxPitch?e.maxPitch:i.MAX_MIDI_PITCH,t.numPitches=t.maxPitch-t.minPitch+1,t.performanceEventDepth=2*t.numPitches+t.totalSteps+t.numVelocityBins,t.numPrograms=i.MAX_MIDI_PROGRAM-i.MIN_MIDI_PROGRAM+2,t.endToken=t.performanceEventDepth+t.numPrograms,t.depth=t.endToken+1,t.endTensor=r.tidy((function(){return r.oneHot(r.tensor1d([t.endToken],"int32"),t.depth).as1D()})),t}return _createClass2(a,[{key:"trackToTensor",value:function(e){var t=this,n=this.numSteps/this.numSegments,a=void 0;if(e){for(;e.events.length>n-2;)e.events.pop();(a=r.buffer([e.events.length+2],"int32")).set(this.performanceEventDepth+(e.isDrum?this.numPrograms-1:e.program),0),e.events.forEach((function(e,n){switch(e.type){case"note-on":a.set(e.pitch-t.minPitch,n+1);break;case"note-off":a.set(t.numPitches+e.pitch-t.minPitch,n+1);break;case"time-shift":a.set(2*t.numPitches+e.steps-1,n+1);break;case"velocity-change":a.set(2*t.numPitches+t.totalSteps+e.velocityBin-1,n+1);break;default:throw new Error("Unrecognized performance event: "+e)}})),a.set(this.endToken,e.events.length+1)}else a=r.buffer([1],"int32",new Int32Array([this.endToken]));return r.tidy((function(){var e=r.oneHot(a.toTensor(),t.depth);return e.pad([[0,n-e.shape[0]],[0,0]])}))}},{key:"toTensor",value:function(e){var t=this;if(c.assertIsRelativeQuantizedSequence(e),e.quantizationInfo.stepsPerQuarter!==this.stepsPerQuarter)throw new Error("Steps per quarter note mismatch: ".concat(e.quantizationInfo.stepsPerQuarter," != ").concat(this.stepsPerQuarter));var n=c.clone(e);n.notes=e.notes.filter((function(e){return e.pitch>=t.minPitch&&e.pitch<=t.maxPitch}));for(var a=new Set(n.notes.map((function(e){return e.instrument}))),i=Array.from(a).map((function(e){return u.Performance.fromNoteSequence(n,t.totalSteps,t.numVelocityBins,e)})).sort((function(e,t){return t.isDrum?-1:e.isDrum?1:e.program-t.program}));i.length>this.numSegments;)i.pop();for(i.forEach((function(e){return e.setNumSteps(t.totalSteps)}));i.length<this.numSegments;)i.push(void 0);return r.tidy((function(){return r.concat(i.map((function(e){return t.trackToTensor(e)})),0)}))}},{key:"tokensToTrack",value:function(e){var t=this,n=e.indexOf(this.endToken),r=e.slice(0,n>=0?n:e.length),a=r.filter((function(e){return e<t.performanceEventDepth})),i=r.filter((function(e){return e>=t.performanceEventDepth})),o=_slicedToArray2(i.length?i[0]-this.performanceEventDepth<this.numPrograms-1?[i[0]-this.performanceEventDepth,!1]:[0,!0]:[0,!1],2),s=o[0],c=o[1],l=Array.from(a).map((function(e){if(e<t.numPitches)return{type:"note-on",pitch:t.minPitch+e};if(e<2*t.numPitches)return{type:"note-off",pitch:t.minPitch+e-t.numPitches};if(e<2*t.numPitches+t.totalSteps)return{type:"time-shift",steps:e-2*t.numPitches+1};if(e<2*t.numPitches+t.totalSteps+t.numVelocityBins)return{type:"velocity-change",velocityBin:e-2*t.numPitches-t.totalSteps+1};throw new Error("Invalid performance event token: "+e)}));return new u.Performance(l,this.totalSteps,this.numVelocityBins,s,c)}},{key:"toNoteSequence",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i,o,s=this,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:this.stepsPerQuarter,a=u.length>2?u[2]:void 0,(i=c.createQuantizedNoteSequence(n,a)).totalQuantizedSteps=this.totalSteps,o=r.tidy((function(){return r.split(t.argMax(1),s.numSegments)})),e.next=7,Promise.all(o.map(function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.data();case 2:return n=e.sent,r=s.tokensToTrack(n),e.abrupt("return",(t.dispose(),r));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:return e.sent.forEach((function(e,t){var n;e.setNumSteps(s.totalSteps),(n=i.notes).push.apply(n,_toConsumableArray(e.toNoteSequence(t).notes))})),e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(f),x=function(e){_inherits(o,e);var t,n=_createSuper(o);function o(e){var t;_classCallCheck2(this,o),(t=n.call(this,e)).TAPIFY_CHANNEL=3,t.stepsPerQuarter=e.stepsPerQuarter||i.DEFAULT_STEPS_PER_QUARTER,t.pitchClasses=e.pitchClasses||l,t.pitchToClass=new Map;for(var r=function(e){t.pitchClasses[e].forEach((function(n){t.pitchToClass.set(n,e)}))},a=0;a<t.pitchClasses.length;++a)r(a);return t.humanize=e.humanize||!1,t.tapify=e.tapify||!1,t.splitInstruments=e.splitInstruments||!1,t.depth=3,t}return _createClass2(o,[{key:"toTensor",value:function(e){for(var t=this,n=c.isRelativeQuantizedSequence(e)?e:c.quantizeNoteSequence(e,this.stepsPerQuarter),a=this.numSteps,o=n.tempos&&n.tempos.length?n.tempos[0].qpm:i.DEFAULT_QUARTERS_PER_MINUTE,s=60/o/this.stepsPerQuarter,u=[],l=0;l<a;++l)u.push(new Map);n.notes.forEach((function(e){if(t.tapify||t.pitchToClass.has(e.pitch)){var n=e.quantizedStartStep;if(n>=u.length)throw Error("Model does not support sequences with more than ".concat(a," steps (").concat(a*s," seconds at qpm ").concat(o,")."));var r=t.tapify?t.TAPIFY_CHANNEL:t.pitchToClass.get(e.pitch);(!u[n].has(r)||u[n].get(r).velocity<e.velocity)&&u[n].set(r,e)}}));var h=this.pitchClasses.length,f=r.buffer([a,h]),d=r.buffer([a,h]),p=r.buffer([a,h]);function m(e){return void 0===e.startTime?0:2*(e.quantizedStartStep*s-e.startTime)/s}for(var v=0;v<a;++v)for(var g=0;g<h;++g){var y=u[v].get(g);f.set(y?1:0,v,g),this.humanize||this.tapify||d.set(y?y.velocity/i.MAX_MIDI_VELOCITY:0,v,g),this.humanize||p.set(y?m(y):0,v,g)}return r.tidy((function(){var e=f.toTensor(),n=d.toTensor(),i=p.toTensor(),o=t.splitInstruments?a*h:a;return r.concat([e.as2D(o,-1),n.as2D(o,-1),i.as2D(o,-1)],1)}))}},{key:"toNoteSequence",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,o,s,u,c,l,h,f,d,p,m,v,g,y,_=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=function(e,t,n){return Math.min(Math.max(e,t),n)},r=_.length>2&&void 0!==_[2]?_[2]:i.DEFAULT_QUARTERS_PER_MINUTE,!n||n===this.stepsPerQuarter){e.next=4;break}throw Error("`stepsPerQuarter` is set by the model.");case 4:return n=this.stepsPerQuarter,o=this.splitInstruments?t.shape[0]/this.pitchClasses.length:t.shape[0],s=60/r/this.stepsPerQuarter,u=a.a.create({totalTime:o*s,tempos:[{qpm:r}]}),e.next=10,t.data();case 10:for(c=e.sent,h=this.pitchClasses.length,f=0;f<o;++f)for(d=c.slice(f*h*this.depth,(f+1)*h*this.depth),p=0;p<h;++p)m=d[this.splitInstruments?p*this.depth+1:h+p],v=d[this.splitInstruments?p*this.depth+2:2*h+p],d[this.splitInstruments?p*this.depth:p]>.5&&(g=l(Math.round(m*i.MAX_MIDI_VELOCITY),i.MIN_MIDI_VELOCITY,i.MAX_MIDI_VELOCITY),y=l(v/2,-.5,.5),u.notes.push(a.a.Note.create({pitch:this.pitchClasses[p][0],startTime:(f-y)*s,endTime:(f-y+1)*s,velocity:g,isDrum:!0})));return e.abrupt("return",u);case 14:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),o}(f)},function(e,t,n){var r=n(78),a=n(79),i="undefined"!=typeof Float64Array;function o(e,t){return e[0]-t[0]}function s(){var e,t=this.stride,n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=[Math.abs(t[e]),e];n.sort(o);var r=new Array(n.length);for(e=0;e<r.length;++e)r[e]=n[e][1];return r}function u(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var a="generic"===e;if(-1===t){var i="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(i)()}if(0===t)return i="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(a?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(a?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}",new Function("TrivialArray",i)(c[e][0]);i=["'use strict'"];var o=r(t),u=o.map((function(e){return"i"+e})),l="this.offset+"+o.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),h=o.map((function(e){return"b"+e})).join(","),f=o.map((function(e){return"c"+e})).join(",");i.push("function "+n+"(a,"+h+","+f+",d){this.data=a","this.shape=["+h+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),i.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+o.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),t<4?(i.push("function "+n+"_order(){"),2===t?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+n+"_set("+u.join(",")+",v){"),i.push(a?"return this.data.set("+l+",v)}":"return this.data["+l+"]=v}"),i.push("proto.get=function "+n+"_get("+u.join(",")+"){"),i.push(a?"return this.data.get("+l+")}":"return this.data["+l+"]}"),i.push("proto.index=function "+n+"_index(",u.join(),"){return "+l+"}"),i.push("proto.hi=function "+n+"_hi("+u.join(",")+"){return new "+n+"(this.data,"+o.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+o.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var d=o.map((function(e){return"a"+e+"=this.shape["+e+"]"})),p=o.map((function(e){return"c"+e+"=this.stride["+e+"]"}));i.push("proto.lo=function "+n+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+p.join(","));for(var m=0;m<t;++m)i.push("if(typeof i"+m+"==='number'&&i"+m+">=0){d=i"+m+"|0;b+=c"+m+"*d;a"+m+"-=d}");for(i.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"c"+e})).join(",")+",b)}"),i.push("proto.step=function "+n+"_step("+u.join(",")+"){var "+o.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+o.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),m=0;m<t;++m)i.push("if(typeof i"+m+"==='number'){d=i"+m+"|0;if(d<0){c+=b"+m+"*(a"+m+"-1);a"+m+"=ceil(-a"+m+"/d)}else{a"+m+"=ceil(a"+m+"/d)}b"+m+"*=d}");i.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"b"+e})).join(",")+",c)}");var v=new Array(t),g=new Array(t);for(m=0;m<t;++m)v[m]="a[i"+m+"]",g[m]="b[i"+m+"]";for(i.push("proto.transpose=function "+n+"_transpose("+u+"){"+u.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+v.join(",")+","+g.join(",")+",this.offset)}"),i.push("proto.pick=function "+n+"_pick("+u+"){var a=[],b=[],c=this.offset"),m=0;m<t;++m)i.push("if(typeof i"+m+"==='number'&&i"+m+">=0){c=(c+this.stride["+m+"]*i"+m+")|0}else{a.push(this.shape["+m+"]);b.push(this.stride["+m+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+o.map((function(e){return"shape["+e+"]"})).join(",")+","+o.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(c[e],s)}var c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,n,r){if(void 0===e)return(0,c.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var o=t.length;if(void 0===n){n=new Array(o);for(var s=o-1,l=1;s>=0;--s)n[s]=l,l*=t[s]}if(void 0===r)for(r=0,s=0;s<o;++s)n[s]<0&&(r-=(t[s]-1)*n[s]);for(var h=function(e){if(a(e))return"buffer";if(i)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),f=c[h];f.length<=o+1;)f.push(u(h,f.length-1));return(0,f[o+1])(e,t,n,r)}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,n){"use strict";n.r(t),n.d(t,"Performance",(function(){return s}));var r=n(9),a=n(8),i=n(15),o=n(13),s=function(){function e(t,n,r,a,i){_classCallCheck2(this,e),this.events=t,this.maxShiftSteps=n,this.numVelocityBins=r,this.program=a,this.isDrum=i}return _createClass2(e,[{key:"getNumSteps",value:function(){return this.events.filter((function(e){return"time-shift"===e.type})).map((function(e){return e.steps})).reduce((function(e,t){return e+t}),0)}},{key:"setNumSteps",value:function(e){var t=this.getNumSteps();if(t<e){if(this.events.length){var n=this.events[this.events.length-1];if("time-shift"===n.type){var r=Math.min(e-t,this.maxShiftSteps-n.steps);n.steps+=r,t+=r}}for(;t<e;)t+this.maxShiftSteps>e?(this.events.push({type:"time-shift",steps:e-t}),t=e):(this.events.push({type:"time-shift",steps:this.maxShiftSteps}),t+=this.maxShiftSteps)}else if(t>e)for(;this.events.length&&t>e;){var a=this.events[this.events.length-1];"time-shift"===a.type?t-a.steps<e?(a.steps-=t-e,t=e):(this.events.pop(),t-=a.steps):this.events.pop()}}},{key:"toNoteSequence",value:function(e){for(var t=this,n=this.numVelocityBins?Math.ceil((a.MIDI_VELOCITIES-1)/this.numVelocityBins):void 0,i=r.a.create(),s=0,u=void 0,c=new Map,l=a.MIN_MIDI_PITCH;l<=a.MAX_MIDI_PITCH;++l)c.set(l,[]);var h,f=_createForOfIteratorHelper(this.events);try{for(f.s();!(h=f.n()).done;){var d=h.value;switch(d.type){case"note-on":c.get(d.pitch).push([s,u]);break;case"note-off":var p=c.get(d.pitch);if(p.length){var m=_slicedToArray2(p.shift(),2),v=m[0],g=m[1];s>v?i.notes.push(r.a.Note.create({pitch:d.pitch,velocity:g,instrument:e,quantizedStartStep:v,quantizedEndStep:s,program:this.program,isDrum:this.isDrum})):o.log("Ignoring zero-length note: (pitch = ".concat(d.pitch,", step = ").concat(s,")"),"Performance")}else o.log("Ignoring note-off with no previous note-on:(pitch = ".concat(d.pitch,", step = ").concat(s,")"),"Performance");break;case"time-shift":s+=d.steps;break;case"velocity-change":if(!n)throw new Error("Unexpected velocity change event: "+d);u=a.MIN_MIDI_VELOCITY+(d.velocityBin-1)*n+1;break;default:throw new Error("Unrecognized performance event: "+d)}}}catch(y){f.e(y)}finally{f.f()}return c.forEach((function(n,a){var u,c=_createForOfIteratorHelper(n);try{for(c.s();!(u=c.n()).done;){var l=_slicedToArray2(u.value,2),h=l[0],f=l[1];s>h?i.notes.push(r.a.Note.create({pitch:a,velocity:f,instrument:e,quantizedStartStep:h,quantizedEndStep:s,program:t.program,isDrum:t.isDrum})):o.log("Ignoring zero-length note: (pitch = ".concat(a,", step = ").concat(s,")"),"Performance")}}catch(y){c.e(y)}finally{c.f()}})),i.totalQuantizedSteps=s,i}}],[{key:"fromNoteSequence",value:function(t,n,r,o){i.assertIsQuantizedSequence(t);var s,u=t.notes.filter((function(e,t){return void 0===o||e.instrument===o})),c=u.sort((function(e,t){return e.startTime===t.startTime?e.pitch-t.pitch:e.startTime-t.startTime})),l=c.map((function(e,t){return{step:e.quantizedStartStep,index:t,isOffset:0}})),h=c.map((function(e,t){return{step:e.quantizedEndStep,index:t,isOffset:1}})),f=l.concat(h).sort((function(e,t){return e.step===t.step?e.index===t.index?e.isOffset-t.isOffset:e.index-t.index:e.step-t.step})),d=r?Math.ceil((a.MIDI_VELOCITIES-1)/r):void 0,p=[],m=0,v=r,g=_createForOfIteratorHelper(f);try{for(g.s();!(s=g.n()).done;){var y=s.value;if(y.step>m){for(;y.step>m+n;)p.push({type:"time-shift",steps:n}),m+=n;p.push({type:"time-shift",steps:y.step-m}),m=y.step}if(y.isOffset)p.push({type:"note-off",pitch:c[y.index].pitch});else{if(d){var _=Math.floor((c[y.index].velocity-a.MIN_MIDI_VELOCITY-1)/d)+1;_!==v&&(p.push({type:"velocity-change",velocityBin:_}),v=_)}p.push({type:"note-on",pitch:c[y.index].pitch})}}}catch(x){g.e(x)}finally{g.f()}var b=!!u.some((function(e){return e.isDrum}))&&(!u.some((function(e){return!e.isDrum}))||void 0),k=Array.from(new Set(u.map((function(e){return e.program})))),w=new e(p,n,r,b||1!==k.length?void 0:k[0],b);return w.setNumSteps(t.totalQuantizedSteps),w}}]),e}()},function(e,t,n){"use strict";(function(e){var t=n(46),r=n(11),a=Object(r.b)();a.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),a.registerFlag("IS_BROWSER",(function(){return t.isBrowser()})),a.registerFlag("IS_NODE",(function(){return void 0!==e&&void 0!==e.versions&&void 0!==e.versions.node})),a.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),a.registerFlag("PROD",(function(){return!1})),a.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return a.getBool("DEBUG")})),a.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),a.registerFlag("IS_TEST",(function(){return!1}))}).call(this,n(44))},function(e,t,n){"use strict";e.exports=h;var r,a=n(18),i=a.LongBits,o=a.base64,s=a.utf8;function u(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function c(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new u(c,0,0),this.tail=this.head,this.states=null}var f=function(){return a.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function d(e,t,n){t[n]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function v(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=f(),h.alloc=function(e){return new a.Array(e)},a.Array!==Array&&(h.alloc=a.pool(h.alloc,a.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new u(e,t,n),this.len+=t,this},(p.prototype=Object.create(u.prototype)).fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(m,10,i.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.int64=h.prototype.uint64=function(e){var t=i.from(e);return this._push(m,t.length(),t)},h.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(m,t.length(),t)},h.prototype.bool=function(e){return this._push(d,1,e?1:0)},h.prototype.sfixed32=h.prototype.fixed32=function(e){return this._push(v,4,e>>>0)},h.prototype.sfixed64=h.prototype.fixed64=function(e){var t=i.from(e);return this._push(v,4,t.lo)._push(v,4,t.hi)},h.prototype.float=function(e){return this._push(a.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(a.float.writeDoubleLE,8,e)};var g=a.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(d,1,0);if(a.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(g,t,e)},h.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t)._push(s.write,t,e):this._push(d,1,0)},h.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new u(c,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(c,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=f(),r._configure()}},function(e,t,n){"use strict";e.exports=u;var r,a=n(18),i=a.LongBits,o=a.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var c,l="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")},h=function(){return a.Buffer?function(e){return(u.create=function(e){return a.Buffer.isBuffer(e)?new r(e):l(e)})(e)}:l};function f(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw s(this,8);return new i(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}u.create=h(),u.prototype._slice=a.Array.prototype.subarray||a.Array.prototype.slice,u.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return c;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return c}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return d(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|d(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=a.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=a.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw s(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},u.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},u.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){r=e,u.create=h(),r._configure();var t=a.Long?"toLong":"toNumber";a.merge(u.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));var r=function(){function e(t,n){_classCallCheck2(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return _createClass2(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),a=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"time",value:function(e){return i("time")}},{key:"read",value:function(e){return i("read")}},{key:"readSync",value:function(e){return i("readSync")}},{key:"numDataIds",value:function(){return i("numDataIds")}},{key:"disposeData",value:function(e){return i("disposeData")}},{key:"write",value:function(e,t,n){return i("write")}},{key:"move",value:function(e,t,n,r){return i("move")}},{key:"memory",value:function(){return i("memory")}},{key:"floatPrecision",value:function(){return i("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"batchMatMul",value:function(e,t,n,r){return i("batchMatMul")}},{key:"fusedBatchMatMul",value:function(e){return _objectDestructuringEmpty(e),i("fusedBatchMatMul")}},{key:"slice",value:function(e,t,n){return i("slice")}},{key:"stridedSlice",value:function(e,t,n,r){return i("stridedSlice")}},{key:"unstack",value:function(e,t){return i("unstack")}},{key:"reverse",value:function(e,t){return i("reverse")}},{key:"concat",value:function(e,t){return i("concat")}},{key:"neg",value:function(e){return i("neg")}},{key:"add",value:function(e,t){return i("add")}},{key:"addN",value:function(e){return i("addN")}},{key:"subtract",value:function(e,t){return i("subtract")}},{key:"multiply",value:function(e,t){return i("multiply")}},{key:"realDivide",value:function(e,t){return i("realDivide")}},{key:"floorDiv",value:function(e,t){return i("floorDiv")}},{key:"sum",value:function(e,t){return i("sum")}},{key:"prod",value:function(e,t){return i("prod")}},{key:"unsortedSegmentSum",value:function(e,t,n){return i("unsortedSegmentSum")}},{key:"argMin",value:function(e,t){return i("argMin")}},{key:"argMax",value:function(e,t){return i("argMax")}},{key:"equal",value:function(e,t){return i("equal")}},{key:"notEqual",value:function(e,t){return i("notEqual")}},{key:"less",value:function(e,t){return i("less")}},{key:"lessEqual",value:function(e,t){return i("lessEqual")}},{key:"greater",value:function(e,t){return i("greater")}},{key:"greaterEqual",value:function(e,t){return i("greaterEqual")}},{key:"logicalNot",value:function(e){return i("logicalNot")}},{key:"logicalAnd",value:function(e,t){return i("logicalAnd")}},{key:"logicalOr",value:function(e,t){return i("logicalOr")}},{key:"where",value:function(e){return i("where")}},{key:"select",value:function(e,t,n){return i("select")}},{key:"topk",value:function(e,t,n){return i("topk")}},{key:"min",value:function(e,t){return i("min")}},{key:"minimum",value:function(e,t){return i("minimum")}},{key:"mod",value:function(e,t){return i("mod")}},{key:"max",value:function(e,t){return i("max")}},{key:"maximum",value:function(e,t){return i("maximum")}},{key:"all",value:function(e,t){return i("all")}},{key:"any",value:function(e,t){return i("any")}},{key:"squaredDifference",value:function(e,t){return i("squaredDifference")}},{key:"ceil",value:function(e){return i("ceil")}},{key:"floor",value:function(e){return i("floor")}},{key:"round",value:function(e){return i("round")}},{key:"sign",value:function(e){return i("sign")}},{key:"isNaN",value:function(e){return i("isNaN")}},{key:"isInf",value:function(e){return i("isInf")}},{key:"isFinite",value:function(e){return i("isFinite")}},{key:"pow",value:function(e,t){return i("pow")}},{key:"exp",value:function(e){return i("exp")}},{key:"expm1",value:function(e){return i("expm1")}},{key:"softmax",value:function(e,t){return i("softmax")}},{key:"log",value:function(e){return i("log")}},{key:"log1p",value:function(e){return i("log1p")}},{key:"sqrt",value:function(e){return i("sqrt")}},{key:"rsqrt",value:function(e){return i("rsqrt")}},{key:"square",value:function(e){return i("square")}},{key:"reciprocal",value:function(e){return i("reciprocal")}},{key:"relu",value:function(e){return i("relu")}},{key:"relu6",value:function(e){return i("relu6")}},{key:"prelu",value:function(e,t){return i("prelu")}},{key:"elu",value:function(e){return i("elu")}},{key:"eluDer",value:function(e,t){return i("eluDer")}},{key:"selu",value:function(e){return i("selu")}},{key:"int",value:function(e){return i("int")}},{key:"clip",value:function(e,t,n){return i("clip")}},{key:"abs",value:function(e){return i("abs")}},{key:"complexAbs",value:function(e){return i("complexAbs")}},{key:"sigmoid",value:function(e){return i("sigmoid")}},{key:"softplus",value:function(e){return i("softplus")}},{key:"sin",value:function(e){return i("sin")}},{key:"cos",value:function(e){return i("cos")}},{key:"tan",value:function(e){return i("tan")}},{key:"asin",value:function(e){return i("asin")}},{key:"acos",value:function(e){return i("acos")}},{key:"atan",value:function(e){return i("atan")}},{key:"atan2",value:function(e,t){return i("atan2")}},{key:"sinh",value:function(e){return i("sinh")}},{key:"cosh",value:function(e){return i("cosh")}},{key:"tanh",value:function(e){return i("tanh")}},{key:"asinh",value:function(e){return i("asinh")}},{key:"acosh",value:function(e){return i("acosh")}},{key:"atanh",value:function(e){return i("atanh")}},{key:"erf",value:function(e){return i("erf")}},{key:"step",value:function(e,t){return i("step")}},{key:"fusedConv2d",value:function(e){return _objectDestructuringEmpty(e),i("fusedConv2d")}},{key:"conv2d",value:function(e,t,n){return i("conv2d")}},{key:"conv2dDerInput",value:function(e,t,n){return i("conv2dDerInput")}},{key:"conv2dDerFilter",value:function(e,t,n){return i("conv2dDerFilter")}},{key:"fusedDepthwiseConv2D",value:function(e){return _objectDestructuringEmpty(e),i("fusedDepthwiseConv2D")}},{key:"depthwiseConv2D",value:function(e,t,n){return i("depthwiseConv2D")}},{key:"depthwiseConv2DDerInput",value:function(e,t,n){return i("depthwiseConv2DDerInput")}},{key:"depthwiseConv2DDerFilter",value:function(e,t,n){return i("depthwiseConv2DDerFilter")}},{key:"conv3d",value:function(e,t,n){return i("conv3d")}},{key:"conv3dDerInput",value:function(e,t,n){return i("conv3dDerInput")}},{key:"conv3dDerFilter",value:function(e,t,n){return i("conv3dDerFilter")}},{key:"maxPool",value:function(e,t){return i("maxPool")}},{key:"maxPoolBackprop",value:function(e,t,n,r){return i("maxPoolBackprop")}},{key:"avgPool",value:function(e,t){return i("avgPool")}},{key:"avgPoolBackprop",value:function(e,t,n){return i("avgPoolBackprop")}},{key:"avgPool3d",value:function(e,t){return i("avgPool3d")}},{key:"avgPool3dBackprop",value:function(e,t,n){return i("avgPool3dBackprop")}},{key:"maxPool3d",value:function(e,t){return i("maxPool3d")}},{key:"maxPool3dBackprop",value:function(e,t,n,r){return i("maxPool3dBackprop")}},{key:"reshape",value:function(e,t){return i("reshape")}},{key:"cast",value:function(e,t){return i("cast")}},{key:"tile",value:function(e,t){return i("tile")}},{key:"pad",value:function(e,t,n){return i("pad")}},{key:"transpose",value:function(e,t){return i("transpose")}},{key:"gather",value:function(e,t,n){return i("gather")}},{key:"gatherND",value:function(e,t){return i("gatherND")}},{key:"scatterND",value:function(e,t,n){return i("scatterND")}},{key:"batchToSpaceND",value:function(e,t,n){return i("batchToSpaceND")}},{key:"spaceToBatchND",value:function(e,t,n){return i("spaceToBatchND")}},{key:"resizeBilinear",value:function(e,t,n,r){return i("resizeBilinear")}},{key:"resizeBilinearBackprop",value:function(e,t,n){return i("resizeBilinearBackprop")}},{key:"resizeNearestNeighbor",value:function(e,t,n,r){return i("resizeNearestNeighbor")}},{key:"resizeNearestNeighborBackprop",value:function(e,t,n){return i("resizeNearestNeighborBackprop")}},{key:"batchNorm",value:function(e,t,n,r,a,o){return i("batchNorm")}},{key:"localResponseNormalization4D",value:function(e,t,n,r,a){return i("localResponseNormalization4D")}},{key:"LRNGrad",value:function(e,t,n,r,a,o,s){return i("LRNGrad")}},{key:"multinomial",value:function(e,t,n,r){return i("multinomial")}},{key:"oneHot",value:function(e,t,n,r){return i("oneHot")}},{key:"cumsum",value:function(e,t,n,r){return i("cumsum")}},{key:"nonMaxSuppression",value:function(e,t,n,r,a){return i("nonMaxSuppression")}},{key:"fft",value:function(e){return i("fft")}},{key:"ifft",value:function(e){return i("ifft")}},{key:"complex",value:function(e,t){return i("complex")}},{key:"real",value:function(e){return i("real")}},{key:"imag",value:function(e){return i("imag")}},{key:"cropAndResize",value:function(e,t,n,r,a,o){return i("cropAndResize")}},{key:"depthToSpace",value:function(e,t,n){return i("depthToSpace")}},{key:"split",value:function(e,t,n){return i("split")}},{key:"sparseToDense",value:function(e,t,n,r){return i("sparseToDense")}},{key:"diag",value:function(e){return i("diag")}},{key:"fill",value:function(e,t,n){return i("fill")}},{key:"onesLike",value:function(e){return i("onesLike")}},{key:"zerosLike",value:function(e){return i("zerosLike")}},{key:"linspace",value:function(e,t,n){return i("linspace")}},{key:"dispose",value:function(){return i("dispose")}}]),e}();function i(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}},function(e,t,n){"use strict";var r,a,i=n(48),o=i.Reader,s=i.Writer,u=i.util,c=i.roots.default||(i.roots.default={});c.tensorflow=((a={}).magenta=((r={}).NoteSequence=function(){function e(e){if(this.timeSignatures=[],this.keySignatures=[],this.tempos=[],this.notes=[],this.pitchBends=[],this.controlChanges=[],this.partInfos=[],this.textAnnotations=[],this.sectionAnnotations=[],this.sectionGroups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t,n;return e.prototype.id="",e.prototype.filename="",e.prototype.referenceNumber=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.collectionName="",e.prototype.ticksPerQuarter=0,e.prototype.timeSignatures=u.emptyArray,e.prototype.keySignatures=u.emptyArray,e.prototype.tempos=u.emptyArray,e.prototype.notes=u.emptyArray,e.prototype.totalTime=0,e.prototype.totalQuantizedSteps=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.pitchBends=u.emptyArray,e.prototype.controlChanges=u.emptyArray,e.prototype.partInfos=u.emptyArray,e.prototype.sourceInfo=null,e.prototype.textAnnotations=u.emptyArray,e.prototype.sectionAnnotations=u.emptyArray,e.prototype.sectionGroups=u.emptyArray,e.prototype.quantizationInfo=null,e.prototype.subsequenceInfo=null,e.prototype.sequenceMetadata=null,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(10).string(e.id),null!=e.filename&&e.hasOwnProperty("filename")&&t.uint32(18).string(e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&t.uint32(26).string(e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&t.uint32(32).int32(e.ticksPerQuarter),null!=e.timeSignatures&&e.timeSignatures.length)for(var n=0;n<e.timeSignatures.length;++n)c.tensorflow.magenta.NoteSequence.TimeSignature.encode(e.timeSignatures[n],t.uint32(42).fork()).ldelim();if(null!=e.keySignatures&&e.keySignatures.length)for(n=0;n<e.keySignatures.length;++n)c.tensorflow.magenta.NoteSequence.KeySignature.encode(e.keySignatures[n],t.uint32(50).fork()).ldelim();if(null!=e.tempos&&e.tempos.length)for(n=0;n<e.tempos.length;++n)c.tensorflow.magenta.NoteSequence.Tempo.encode(e.tempos[n],t.uint32(58).fork()).ldelim();if(null!=e.notes&&e.notes.length)for(n=0;n<e.notes.length;++n)c.tensorflow.magenta.NoteSequence.Note.encode(e.notes[n],t.uint32(66).fork()).ldelim();if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&t.uint32(73).double(e.totalTime),null!=e.pitchBends&&e.pitchBends.length)for(n=0;n<e.pitchBends.length;++n)c.tensorflow.magenta.NoteSequence.PitchBend.encode(e.pitchBends[n],t.uint32(82).fork()).ldelim();if(null!=e.controlChanges&&e.controlChanges.length)for(n=0;n<e.controlChanges.length;++n)c.tensorflow.magenta.NoteSequence.ControlChange.encode(e.controlChanges[n],t.uint32(90).fork()).ldelim();if(null!=e.partInfos&&e.partInfos.length)for(n=0;n<e.partInfos.length;++n)c.tensorflow.magenta.NoteSequence.PartInfo.encode(e.partInfos[n],t.uint32(98).fork()).ldelim();if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&c.tensorflow.magenta.NoteSequence.SourceInfo.encode(e.sourceInfo,t.uint32(106).fork()).ldelim(),null!=e.textAnnotations&&e.textAnnotations.length)for(n=0;n<e.textAnnotations.length;++n)c.tensorflow.magenta.NoteSequence.TextAnnotation.encode(e.textAnnotations[n],t.uint32(114).fork()).ldelim();if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&c.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(e.quantizationInfo,t.uint32(122).fork()).ldelim(),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&t.uint32(128).int64(e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&c.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(e.subsequenceInfo,t.uint32(138).fork()).ldelim(),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&t.uint32(144).int64(e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&c.tensorflow.magenta.SequenceMetadata.encode(e.sequenceMetadata,t.uint32(154).fork()).ldelim(),null!=e.sectionAnnotations&&e.sectionAnnotations.length)for(n=0;n<e.sectionAnnotations.length;++n)c.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(e.sectionAnnotations[n],t.uint32(162).fork()).ldelim();if(null!=e.sectionGroups&&e.sectionGroups.length)for(n=0;n<e.sectionGroups.length;++n)c.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroups[n],t.uint32(170).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.id=e.string();break;case 2:r.filename=e.string();break;case 18:r.referenceNumber=u.Long?e.int64().toNumber():e.int64();break;case 3:r.collectionName=e.string();break;case 4:r.ticksPerQuarter=e.int32();break;case 5:r.timeSignatures&&r.timeSignatures.length||(r.timeSignatures=[]),r.timeSignatures.push(c.tensorflow.magenta.NoteSequence.TimeSignature.decode(e,e.uint32()));break;case 6:r.keySignatures&&r.keySignatures.length||(r.keySignatures=[]),r.keySignatures.push(c.tensorflow.magenta.NoteSequence.KeySignature.decode(e,e.uint32()));break;case 7:r.tempos&&r.tempos.length||(r.tempos=[]),r.tempos.push(c.tensorflow.magenta.NoteSequence.Tempo.decode(e,e.uint32()));break;case 8:r.notes&&r.notes.length||(r.notes=[]),r.notes.push(c.tensorflow.magenta.NoteSequence.Note.decode(e,e.uint32()));break;case 9:r.totalTime=e.double();break;case 16:r.totalQuantizedSteps=u.Long?e.int64().toNumber():e.int64();break;case 10:r.pitchBends&&r.pitchBends.length||(r.pitchBends=[]),r.pitchBends.push(c.tensorflow.magenta.NoteSequence.PitchBend.decode(e,e.uint32()));break;case 11:r.controlChanges&&r.controlChanges.length||(r.controlChanges=[]),r.controlChanges.push(c.tensorflow.magenta.NoteSequence.ControlChange.decode(e,e.uint32()));break;case 12:r.partInfos&&r.partInfos.length||(r.partInfos=[]),r.partInfos.push(c.tensorflow.magenta.NoteSequence.PartInfo.decode(e,e.uint32()));break;case 13:r.sourceInfo=c.tensorflow.magenta.NoteSequence.SourceInfo.decode(e,e.uint32());break;case 14:r.textAnnotations&&r.textAnnotations.length||(r.textAnnotations=[]),r.textAnnotations.push(c.tensorflow.magenta.NoteSequence.TextAnnotation.decode(e,e.uint32()));break;case 20:r.sectionAnnotations&&r.sectionAnnotations.length||(r.sectionAnnotations=[]),r.sectionAnnotations.push(c.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(e,e.uint32()));break;case 21:r.sectionGroups&&r.sectionGroups.length||(r.sectionGroups=[]),r.sectionGroups.push(c.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32()));break;case 15:r.quantizationInfo=c.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(e,e.uint32());break;case 17:r.subsequenceInfo=c.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(e,e.uint32());break;case 19:r.sequenceMetadata=c.tensorflow.magenta.SequenceMetadata.decode(e,e.uint32());break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!u.isString(e.id))return"id: string expected";if(null!=e.filename&&e.hasOwnProperty("filename")&&!u.isString(e.filename))return"filename: string expected";if(null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&!(u.isInteger(e.referenceNumber)||e.referenceNumber&&u.isInteger(e.referenceNumber.low)&&u.isInteger(e.referenceNumber.high)))return"referenceNumber: integer|Long expected";if(null!=e.collectionName&&e.hasOwnProperty("collectionName")&&!u.isString(e.collectionName))return"collectionName: string expected";if(null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&!u.isInteger(e.ticksPerQuarter))return"ticksPerQuarter: integer expected";if(null!=e.timeSignatures&&e.hasOwnProperty("timeSignatures")){if(!Array.isArray(e.timeSignatures))return"timeSignatures: array expected";for(var t=0;t<e.timeSignatures.length;++t)if(n=c.tensorflow.magenta.NoteSequence.TimeSignature.verify(e.timeSignatures[t]))return"timeSignatures."+n}if(null!=e.keySignatures&&e.hasOwnProperty("keySignatures")){if(!Array.isArray(e.keySignatures))return"keySignatures: array expected";for(t=0;t<e.keySignatures.length;++t)if(n=c.tensorflow.magenta.NoteSequence.KeySignature.verify(e.keySignatures[t]))return"keySignatures."+n}if(null!=e.tempos&&e.hasOwnProperty("tempos")){if(!Array.isArray(e.tempos))return"tempos: array expected";for(t=0;t<e.tempos.length;++t)if(n=c.tensorflow.magenta.NoteSequence.Tempo.verify(e.tempos[t]))return"tempos."+n}if(null!=e.notes&&e.hasOwnProperty("notes")){if(!Array.isArray(e.notes))return"notes: array expected";for(t=0;t<e.notes.length;++t)if(n=c.tensorflow.magenta.NoteSequence.Note.verify(e.notes[t]))return"notes."+n}if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&"number"!=typeof e.totalTime)return"totalTime: number expected";if(null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&!(u.isInteger(e.totalQuantizedSteps)||e.totalQuantizedSteps&&u.isInteger(e.totalQuantizedSteps.low)&&u.isInteger(e.totalQuantizedSteps.high)))return"totalQuantizedSteps: integer|Long expected";if(null!=e.pitchBends&&e.hasOwnProperty("pitchBends")){if(!Array.isArray(e.pitchBends))return"pitchBends: array expected";for(t=0;t<e.pitchBends.length;++t)if(n=c.tensorflow.magenta.NoteSequence.PitchBend.verify(e.pitchBends[t]))return"pitchBends."+n}if(null!=e.controlChanges&&e.hasOwnProperty("controlChanges")){if(!Array.isArray(e.controlChanges))return"controlChanges: array expected";for(t=0;t<e.controlChanges.length;++t)if(n=c.tensorflow.magenta.NoteSequence.ControlChange.verify(e.controlChanges[t]))return"controlChanges."+n}if(null!=e.partInfos&&e.hasOwnProperty("partInfos")){if(!Array.isArray(e.partInfos))return"partInfos: array expected";for(t=0;t<e.partInfos.length;++t)if(n=c.tensorflow.magenta.NoteSequence.PartInfo.verify(e.partInfos[t]))return"partInfos."+n}if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n=c.tensorflow.magenta.NoteSequence.SourceInfo.verify(e.sourceInfo)))return"sourceInfo."+n;if(null!=e.textAnnotations&&e.hasOwnProperty("textAnnotations")){if(!Array.isArray(e.textAnnotations))return"textAnnotations: array expected";for(t=0;t<e.textAnnotations.length;++t)if(n=c.tensorflow.magenta.NoteSequence.TextAnnotation.verify(e.textAnnotations[t]))return"textAnnotations."+n}if(null!=e.sectionAnnotations&&e.hasOwnProperty("sectionAnnotations")){if(!Array.isArray(e.sectionAnnotations))return"sectionAnnotations: array expected";for(t=0;t<e.sectionAnnotations.length;++t)if(n=c.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(e.sectionAnnotations[t]))return"sectionAnnotations."+n}if(null!=e.sectionGroups&&e.hasOwnProperty("sectionGroups")){if(!Array.isArray(e.sectionGroups))return"sectionGroups: array expected";for(t=0;t<e.sectionGroups.length;++t){var n;if(n=c.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroups[t]))return"sectionGroups."+n}}return null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n=c.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(e.quantizationInfo))?"quantizationInfo."+n:null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n=c.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(e.subsequenceInfo))?"subsequenceInfo."+n:null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n=c.tensorflow.magenta.SequenceMetadata.verify(e.sequenceMetadata))?"sequenceMetadata."+n:null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence)return e;var t=new c.tensorflow.magenta.NoteSequence;if(null!=e.id&&(t.id=String(e.id)),null!=e.filename&&(t.filename=String(e.filename)),null!=e.referenceNumber&&(u.Long?(t.referenceNumber=u.Long.fromValue(e.referenceNumber)).unsigned=!1:"string"==typeof e.referenceNumber?t.referenceNumber=parseInt(e.referenceNumber,10):"number"==typeof e.referenceNumber?t.referenceNumber=e.referenceNumber:"object"==typeof e.referenceNumber&&(t.referenceNumber=new u.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber())),null!=e.collectionName&&(t.collectionName=String(e.collectionName)),null!=e.ticksPerQuarter&&(t.ticksPerQuarter=0|e.ticksPerQuarter),e.timeSignatures){if(!Array.isArray(e.timeSignatures))throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: array expected");t.timeSignatures=[];for(var n=0;n<e.timeSignatures.length;++n){if("object"!=typeof e.timeSignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: object expected");t.timeSignatures[n]=c.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(e.timeSignatures[n])}}if(e.keySignatures){if(!Array.isArray(e.keySignatures))throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: array expected");for(t.keySignatures=[],n=0;n<e.keySignatures.length;++n){if("object"!=typeof e.keySignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: object expected");t.keySignatures[n]=c.tensorflow.magenta.NoteSequence.KeySignature.fromObject(e.keySignatures[n])}}if(e.tempos){if(!Array.isArray(e.tempos))throw TypeError(".tensorflow.magenta.NoteSequence.tempos: array expected");for(t.tempos=[],n=0;n<e.tempos.length;++n){if("object"!=typeof e.tempos[n])throw TypeError(".tensorflow.magenta.NoteSequence.tempos: object expected");t.tempos[n]=c.tensorflow.magenta.NoteSequence.Tempo.fromObject(e.tempos[n])}}if(e.notes){if(!Array.isArray(e.notes))throw TypeError(".tensorflow.magenta.NoteSequence.notes: array expected");for(t.notes=[],n=0;n<e.notes.length;++n){if("object"!=typeof e.notes[n])throw TypeError(".tensorflow.magenta.NoteSequence.notes: object expected");t.notes[n]=c.tensorflow.magenta.NoteSequence.Note.fromObject(e.notes[n])}}if(null!=e.totalTime&&(t.totalTime=Number(e.totalTime)),null!=e.totalQuantizedSteps&&(u.Long?(t.totalQuantizedSteps=u.Long.fromValue(e.totalQuantizedSteps)).unsigned=!1:"string"==typeof e.totalQuantizedSteps?t.totalQuantizedSteps=parseInt(e.totalQuantizedSteps,10):"number"==typeof e.totalQuantizedSteps?t.totalQuantizedSteps=e.totalQuantizedSteps:"object"==typeof e.totalQuantizedSteps&&(t.totalQuantizedSteps=new u.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber())),e.pitchBends){if(!Array.isArray(e.pitchBends))throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: array expected");for(t.pitchBends=[],n=0;n<e.pitchBends.length;++n){if("object"!=typeof e.pitchBends[n])throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: object expected");t.pitchBends[n]=c.tensorflow.magenta.NoteSequence.PitchBend.fromObject(e.pitchBends[n])}}if(e.controlChanges){if(!Array.isArray(e.controlChanges))throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: array expected");for(t.controlChanges=[],n=0;n<e.controlChanges.length;++n){if("object"!=typeof e.controlChanges[n])throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: object expected");t.controlChanges[n]=c.tensorflow.magenta.NoteSequence.ControlChange.fromObject(e.controlChanges[n])}}if(e.partInfos){if(!Array.isArray(e.partInfos))throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: array expected");for(t.partInfos=[],n=0;n<e.partInfos.length;++n){if("object"!=typeof e.partInfos[n])throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: object expected");t.partInfos[n]=c.tensorflow.magenta.NoteSequence.PartInfo.fromObject(e.partInfos[n])}}if(null!=e.sourceInfo){if("object"!=typeof e.sourceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.sourceInfo: object expected");t.sourceInfo=c.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(e.sourceInfo)}if(e.textAnnotations){if(!Array.isArray(e.textAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: array expected");for(t.textAnnotations=[],n=0;n<e.textAnnotations.length;++n){if("object"!=typeof e.textAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: object expected");t.textAnnotations[n]=c.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(e.textAnnotations[n])}}if(e.sectionAnnotations){if(!Array.isArray(e.sectionAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected");for(t.sectionAnnotations=[],n=0;n<e.sectionAnnotations.length;++n){if("object"!=typeof e.sectionAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected");t.sectionAnnotations[n]=c.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(e.sectionAnnotations[n])}}if(e.sectionGroups){if(!Array.isArray(e.sectionGroups))throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: array expected");for(t.sectionGroups=[],n=0;n<e.sectionGroups.length;++n){if("object"!=typeof e.sectionGroups[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: object expected");t.sectionGroups[n]=c.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroups[n])}}if(null!=e.quantizationInfo){if("object"!=typeof e.quantizationInfo)throw TypeError(".tensorflow.magenta.NoteSequence.quantizationInfo: object expected");t.quantizationInfo=c.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(e.quantizationInfo)}if(null!=e.subsequenceInfo){if("object"!=typeof e.subsequenceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected");t.subsequenceInfo=c.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(e.subsequenceInfo)}if(null!=e.sequenceMetadata){if("object"!=typeof e.sequenceMetadata)throw TypeError(".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected");t.sequenceMetadata=c.tensorflow.magenta.SequenceMetadata.fromObject(e.sequenceMetadata)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.timeSignatures=[],n.keySignatures=[],n.tempos=[],n.notes=[],n.pitchBends=[],n.controlChanges=[],n.partInfos=[],n.textAnnotations=[],n.sectionAnnotations=[],n.sectionGroups=[]),t.defaults){if(n.id="",n.filename="",n.collectionName="",n.ticksPerQuarter=0,n.totalTime=0,n.sourceInfo=null,n.quantizationInfo=null,u.Long){var r=new u.Long(0,0,!1);n.totalQuantizedSteps=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.totalQuantizedSteps=t.longs===String?"0":0;n.subsequenceInfo=null,u.Long?(r=new u.Long(0,0,!1),n.referenceNumber=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.referenceNumber=t.longs===String?"0":0,n.sequenceMetadata=null}if(null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.filename&&e.hasOwnProperty("filename")&&(n.filename=e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&(n.collectionName=e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&(n.ticksPerQuarter=e.ticksPerQuarter),e.timeSignatures&&e.timeSignatures.length){n.timeSignatures=[];for(var a=0;a<e.timeSignatures.length;++a)n.timeSignatures[a]=c.tensorflow.magenta.NoteSequence.TimeSignature.toObject(e.timeSignatures[a],t)}if(e.keySignatures&&e.keySignatures.length)for(n.keySignatures=[],a=0;a<e.keySignatures.length;++a)n.keySignatures[a]=c.tensorflow.magenta.NoteSequence.KeySignature.toObject(e.keySignatures[a],t);if(e.tempos&&e.tempos.length)for(n.tempos=[],a=0;a<e.tempos.length;++a)n.tempos[a]=c.tensorflow.magenta.NoteSequence.Tempo.toObject(e.tempos[a],t);if(e.notes&&e.notes.length)for(n.notes=[],a=0;a<e.notes.length;++a)n.notes[a]=c.tensorflow.magenta.NoteSequence.Note.toObject(e.notes[a],t);if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&(n.totalTime=t.json&&!isFinite(e.totalTime)?String(e.totalTime):e.totalTime),e.pitchBends&&e.pitchBends.length)for(n.pitchBends=[],a=0;a<e.pitchBends.length;++a)n.pitchBends[a]=c.tensorflow.magenta.NoteSequence.PitchBend.toObject(e.pitchBends[a],t);if(e.controlChanges&&e.controlChanges.length)for(n.controlChanges=[],a=0;a<e.controlChanges.length;++a)n.controlChanges[a]=c.tensorflow.magenta.NoteSequence.ControlChange.toObject(e.controlChanges[a],t);if(e.partInfos&&e.partInfos.length)for(n.partInfos=[],a=0;a<e.partInfos.length;++a)n.partInfos[a]=c.tensorflow.magenta.NoteSequence.PartInfo.toObject(e.partInfos[a],t);if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n.sourceInfo=c.tensorflow.magenta.NoteSequence.SourceInfo.toObject(e.sourceInfo,t)),e.textAnnotations&&e.textAnnotations.length)for(n.textAnnotations=[],a=0;a<e.textAnnotations.length;++a)n.textAnnotations[a]=c.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(e.textAnnotations[a],t);if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n.quantizationInfo=c.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(e.quantizationInfo,t)),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&(n.totalQuantizedSteps="number"==typeof e.totalQuantizedSteps?t.longs===String?String(e.totalQuantizedSteps):e.totalQuantizedSteps:t.longs===String?u.Long.prototype.toString.call(e.totalQuantizedSteps):t.longs===Number?new u.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber():e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n.subsequenceInfo=c.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(e.subsequenceInfo,t)),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&(n.referenceNumber="number"==typeof e.referenceNumber?t.longs===String?String(e.referenceNumber):e.referenceNumber:t.longs===String?u.Long.prototype.toString.call(e.referenceNumber):t.longs===Number?new u.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber():e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n.sequenceMetadata=c.tensorflow.magenta.SequenceMetadata.toObject(e.sequenceMetadata,t)),e.sectionAnnotations&&e.sectionAnnotations.length)for(n.sectionAnnotations=[],a=0;a<e.sectionAnnotations.length;++a)n.sectionAnnotations[a]=c.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(e.sectionAnnotations[a],t);if(e.sectionGroups&&e.sectionGroups.length)for(n.sectionGroups=[],a=0;a<e.sectionGroups.length;++a)n.sectionGroups[a]=c.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroups[a],t);return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e.Note=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.pitch=0,e.prototype.pitchName=0,e.prototype.velocity=0,e.prototype.startTime=0,e.prototype.quantizedStartStep=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.endTime=0,e.prototype.quantizedEndStep=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.numerator=0,e.prototype.denominator=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.prototype.part=0,e.prototype.voice=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.pitch&&e.hasOwnProperty("pitch")&&t.uint32(8).int32(e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&t.uint32(16).int32(e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&t.uint32(25).double(e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&t.uint32(33).double(e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(40).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(48).int32(e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(56).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(64).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(72).bool(e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(80).int32(e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&t.uint32(88).int32(e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&t.uint32(96).int32(e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&t.uint32(104).int64(e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&t.uint32(112).int64(e.quantizedEndStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.Note;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.pitch=e.int32();break;case 11:r.pitchName=e.int32();break;case 2:r.velocity=e.int32();break;case 3:r.startTime=e.double();break;case 13:r.quantizedStartStep=u.Long?e.int64().toNumber():e.int64();break;case 4:r.endTime=e.double();break;case 14:r.quantizedEndStep=u.Long?e.int64().toNumber():e.int64();break;case 5:r.numerator=e.int32();break;case 6:r.denominator=e.int32();break;case 7:r.instrument=e.int32();break;case 8:r.program=e.int32();break;case 9:r.isDrum=e.bool();break;case 10:r.part=e.int32();break;case 12:r.voice=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.pitch&&e.hasOwnProperty("pitch")&&!u.isInteger(e.pitch))return"pitch: integer expected";if(null!=e.pitchName&&e.hasOwnProperty("pitchName"))switch(e.pitchName){default:return"pitchName: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:}return null!=e.velocity&&e.hasOwnProperty("velocity")&&!u.isInteger(e.velocity)?"velocity: integer expected":null!=e.startTime&&e.hasOwnProperty("startTime")&&"number"!=typeof e.startTime?"startTime: number expected":null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&!(u.isInteger(e.quantizedStartStep)||e.quantizedStartStep&&u.isInteger(e.quantizedStartStep.low)&&u.isInteger(e.quantizedStartStep.high))?"quantizedStartStep: integer|Long expected":null!=e.endTime&&e.hasOwnProperty("endTime")&&"number"!=typeof e.endTime?"endTime: number expected":null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&!(u.isInteger(e.quantizedEndStep)||e.quantizedEndStep&&u.isInteger(e.quantizedEndStep.low)&&u.isInteger(e.quantizedEndStep.high))?"quantizedEndStep: integer|Long expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!u.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!u.isInteger(e.denominator)?"denominator: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!u.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!u.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null!=e.part&&e.hasOwnProperty("part")&&!u.isInteger(e.part)?"part: integer expected":null!=e.voice&&e.hasOwnProperty("voice")&&!u.isInteger(e.voice)?"voice: integer expected":null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.Note)return e;var t=new c.tensorflow.magenta.NoteSequence.Note;switch(null!=e.pitch&&(t.pitch=0|e.pitch),e.pitchName){case"UNKNOWN_PITCH_NAME":case 0:t.pitchName=0;break;case"F_FLAT_FLAT":case 1:t.pitchName=1;break;case"C_FLAT_FLAT":case 2:t.pitchName=2;break;case"G_FLAT_FLAT":case 3:t.pitchName=3;break;case"D_FLAT_FLAT":case 4:t.pitchName=4;break;case"A_FLAT_FLAT":case 5:t.pitchName=5;break;case"E_FLAT_FLAT":case 6:t.pitchName=6;break;case"B_FLAT_FLAT":case 7:t.pitchName=7;break;case"F_FLAT":case 8:t.pitchName=8;break;case"C_FLAT":case 9:t.pitchName=9;break;case"G_FLAT":case 10:t.pitchName=10;break;case"D_FLAT":case 11:t.pitchName=11;break;case"A_FLAT":case 12:t.pitchName=12;break;case"E_FLAT":case 13:t.pitchName=13;break;case"B_FLAT":case 14:t.pitchName=14;break;case"F":case 15:t.pitchName=15;break;case"C":case 16:t.pitchName=16;break;case"G":case 17:t.pitchName=17;break;case"D":case 18:t.pitchName=18;break;case"A":case 19:t.pitchName=19;break;case"E":case 20:t.pitchName=20;break;case"B":case 21:t.pitchName=21;break;case"F_SHARP":case 22:t.pitchName=22;break;case"C_SHARP":case 23:t.pitchName=23;break;case"G_SHARP":case 24:t.pitchName=24;break;case"D_SHARP":case 25:t.pitchName=25;break;case"A_SHARP":case 26:t.pitchName=26;break;case"E_SHARP":case 27:t.pitchName=27;break;case"B_SHARP":case 28:t.pitchName=28;break;case"F_SHARP_SHARP":case 29:t.pitchName=29;break;case"C_SHARP_SHARP":case 30:t.pitchName=30;break;case"G_SHARP_SHARP":case 31:t.pitchName=31;break;case"D_SHARP_SHARP":case 32:t.pitchName=32;break;case"A_SHARP_SHARP":case 33:t.pitchName=33;break;case"E_SHARP_SHARP":case 34:t.pitchName=34;break;case"B_SHARP_SHARP":case 35:t.pitchName=35}return null!=e.velocity&&(t.velocity=0|e.velocity),null!=e.startTime&&(t.startTime=Number(e.startTime)),null!=e.quantizedStartStep&&(u.Long?(t.quantizedStartStep=u.Long.fromValue(e.quantizedStartStep)).unsigned=!1:"string"==typeof e.quantizedStartStep?t.quantizedStartStep=parseInt(e.quantizedStartStep,10):"number"==typeof e.quantizedStartStep?t.quantizedStartStep=e.quantizedStartStep:"object"==typeof e.quantizedStartStep&&(t.quantizedStartStep=new u.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber())),null!=e.endTime&&(t.endTime=Number(e.endTime)),null!=e.quantizedEndStep&&(u.Long?(t.quantizedEndStep=u.Long.fromValue(e.quantizedEndStep)).unsigned=!1:"string"==typeof e.quantizedEndStep?t.quantizedEndStep=parseInt(e.quantizedEndStep,10):"number"==typeof e.quantizedEndStep?t.quantizedEndStep=e.quantizedEndStep:"object"==typeof e.quantizedEndStep&&(t.quantizedEndStep=new u.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber())),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),null!=e.part&&(t.part=0|e.part),null!=e.voice&&(t.voice=0|e.voice),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.pitch=0,n.velocity=0,n.startTime=0,n.endTime=0,n.numerator=0,n.denominator=0,n.instrument=0,n.program=0,n.isDrum=!1,n.part=0,n.pitchName=t.enums===String?"UNKNOWN_PITCH_NAME":0,n.voice=0,u.Long){var r=new u.Long(0,0,!1);n.quantizedStartStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStartStep=t.longs===String?"0":0;u.Long?(r=new u.Long(0,0,!1),n.quantizedEndStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.quantizedEndStep=t.longs===String?"0":0}return null!=e.pitch&&e.hasOwnProperty("pitch")&&(n.pitch=e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&(n.velocity=e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&(n.startTime=t.json&&!isFinite(e.startTime)?String(e.startTime):e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&(n.endTime=t.json&&!isFinite(e.endTime)?String(e.endTime):e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&(n.pitchName=t.enums===String?c.tensorflow.magenta.NoteSequence.PitchName[e.pitchName]:e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&(n.voice=e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&(n.quantizedStartStep="number"==typeof e.quantizedStartStep?t.longs===String?String(e.quantizedStartStep):e.quantizedStartStep:t.longs===String?u.Long.prototype.toString.call(e.quantizedStartStep):t.longs===Number?new u.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber():e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&(n.quantizedEndStep="number"==typeof e.quantizedEndStep?t.longs===String?String(e.quantizedEndStep):e.quantizedEndStep:t.longs===String?u.Long.prototype.toString.call(e.quantizedEndStep):t.longs===Number?new u.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber():e.quantizedEndStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.PitchName=(t={},(n=Object.create(t))[t[0]="UNKNOWN_PITCH_NAME"]=0,n[t[1]="F_FLAT_FLAT"]=1,n[t[2]="C_FLAT_FLAT"]=2,n[t[3]="G_FLAT_FLAT"]=3,n[t[4]="D_FLAT_FLAT"]=4,n[t[5]="A_FLAT_FLAT"]=5,n[t[6]="E_FLAT_FLAT"]=6,n[t[7]="B_FLAT_FLAT"]=7,n[t[8]="F_FLAT"]=8,n[t[9]="C_FLAT"]=9,n[t[10]="G_FLAT"]=10,n[t[11]="D_FLAT"]=11,n[t[12]="A_FLAT"]=12,n[t[13]="E_FLAT"]=13,n[t[14]="B_FLAT"]=14,n[t[15]="F"]=15,n[t[16]="C"]=16,n[t[17]="G"]=17,n[t[18]="D"]=18,n[t[19]="A"]=19,n[t[20]="E"]=20,n[t[21]="B"]=21,n[t[22]="F_SHARP"]=22,n[t[23]="C_SHARP"]=23,n[t[24]="G_SHARP"]=24,n[t[25]="D_SHARP"]=25,n[t[26]="A_SHARP"]=26,n[t[27]="E_SHARP"]=27,n[t[28]="B_SHARP"]=28,n[t[29]="F_SHARP_SHARP"]=29,n[t[30]="C_SHARP_SHARP"]=30,n[t[31]="G_SHARP_SHARP"]=31,n[t[32]="D_SHARP_SHARP"]=32,n[t[33]="A_SHARP_SHARP"]=33,n[t[34]="E_SHARP_SHARP"]=34,n[t[35]="B_SHARP_SHARP"]=35,n),e.TimeSignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.numerator=0,e.prototype.denominator=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(16).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(24).int32(e.denominator),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.TimeSignature;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 2:r.numerator=e.int32();break;case 3:r.denominator=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!u.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!u.isInteger(e.denominator)?"denominator: integer expected":null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.TimeSignature)return e;var t=new c.tensorflow.magenta.NoteSequence.TimeSignature;return null!=e.time&&(t.time=Number(e.time)),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.numerator=0,n.denominator=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.KeySignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.key=0,e.prototype.mode=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.key&&e.hasOwnProperty("key")&&t.uint32(16).int32(e.key),null!=e.mode&&e.hasOwnProperty("mode")&&t.uint32(24).int32(e.mode),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.KeySignature;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 2:r.key=e.int32();break;case 3:r.mode=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time)return"time: number expected";if(null!=e.key&&e.hasOwnProperty("key"))switch(e.key){default:return"key: enum value expected";case 0:case 1:case 1:case 2:case 3:case 3:case 4:case 5:case 6:case 6:case 7:case 8:case 8:case 9:case 10:case 10:case 11:}if(null!=e.mode&&e.hasOwnProperty("mode"))switch(e.mode){default:return"mode: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:}return null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.KeySignature)return e;var t=new c.tensorflow.magenta.NoteSequence.KeySignature;switch(null!=e.time&&(t.time=Number(e.time)),e.key){case"C":case 0:t.key=0;break;case"C_SHARP":case 1:t.key=1;break;case"D_FLAT":case 1:t.key=1;break;case"D":case 2:t.key=2;break;case"D_SHARP":case 3:t.key=3;break;case"E_FLAT":case 3:t.key=3;break;case"E":case 4:t.key=4;break;case"F":case 5:t.key=5;break;case"F_SHARP":case 6:t.key=6;break;case"G_FLAT":case 6:t.key=6;break;case"G":case 7:t.key=7;break;case"G_SHARP":case 8:t.key=8;break;case"A_FLAT":case 8:t.key=8;break;case"A":case 9:t.key=9;break;case"A_SHARP":case 10:t.key=10;break;case"B_FLAT":case 10:t.key=10;break;case"B":case 11:t.key=11}switch(e.mode){case"MAJOR":case 0:t.mode=0;break;case"MINOR":case 1:t.mode=1;break;case"NOT_SPECIFIED":case 2:t.mode=2;break;case"MIXOLYDIAN":case 3:t.mode=3;break;case"DORIAN":case 4:t.mode=4;break;case"PHRYGIAN":case 5:t.mode=5;break;case"LYDIAN":case 6:t.mode=6;break;case"LOCRIAN":case 7:t.mode=7}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.key=t.enums===String?"C":0,n.mode=t.enums===String?"MAJOR":0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.key&&e.hasOwnProperty("key")&&(n.key=t.enums===String?c.tensorflow.magenta.NoteSequence.KeySignature.Key[e.key]:e.key),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=t.enums===String?c.tensorflow.magenta.NoteSequence.KeySignature.Mode[e.mode]:e.mode),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e.Key=function(){var e={},t=Object.create(e);return t[e[0]="C"]=0,t[e[1]="C_SHARP"]=1,t.D_FLAT=1,t[e[2]="D"]=2,t[e[3]="D_SHARP"]=3,t.E_FLAT=3,t[e[4]="E"]=4,t[e[5]="F"]=5,t[e[6]="F_SHARP"]=6,t.G_FLAT=6,t[e[7]="G"]=7,t[e[8]="G_SHARP"]=8,t.A_FLAT=8,t[e[9]="A"]=9,t[e[10]="A_SHARP"]=10,t.B_FLAT=10,t[e[11]="B"]=11,t}(),e.Mode=function(){var e={},t=Object.create(e);return t[e[0]="MAJOR"]=0,t[e[1]="MINOR"]=1,t[e[2]="NOT_SPECIFIED"]=2,t[e[3]="MIXOLYDIAN"]=3,t[e[4]="DORIAN"]=4,t[e[5]="PHRYGIAN"]=5,t[e[6]="LYDIAN"]=6,t[e[7]="LOCRIAN"]=7,t}(),e}(),e.Tempo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.qpm=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&t.uint32(17).double(e.qpm),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.Tempo;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 2:r.qpm=e.double();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.qpm&&e.hasOwnProperty("qpm")&&"number"!=typeof e.qpm?"qpm: number expected":null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.Tempo)return e;var t=new c.tensorflow.magenta.NoteSequence.Tempo;return null!=e.time&&(t.time=Number(e.time)),null!=e.qpm&&(t.qpm=Number(e.qpm)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.qpm=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&(n.qpm=t.json&&!isFinite(e.qpm)?String(e.qpm):e.qpm),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.PitchBend=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.bend=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.bend&&e.hasOwnProperty("bend")&&t.uint32(16).int32(e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(24).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(32).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(40).bool(e.isDrum),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.PitchBend;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 2:r.bend=e.int32();break;case 3:r.instrument=e.int32();break;case 4:r.program=e.int32();break;case 5:r.isDrum=e.bool();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.bend&&e.hasOwnProperty("bend")&&!u.isInteger(e.bend)?"bend: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!u.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!u.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.PitchBend)return e;var t=new c.tensorflow.magenta.NoteSequence.PitchBend;return null!=e.time&&(t.time=Number(e.time)),null!=e.bend&&(t.bend=0|e.bend),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.bend=0,n.instrument=0,n.program=0,n.isDrum=!1),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.bend&&e.hasOwnProperty("bend")&&(n.bend=e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.ControlChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.controlNumber=0,e.prototype.controlValue=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&t.uint32(16).int32(e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&t.uint32(24).int32(e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(32).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(40).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(48).bool(e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(56).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.ControlChange;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 7:r.quantizedStep=u.Long?e.int64().toNumber():e.int64();break;case 2:r.controlNumber=e.int32();break;case 3:r.controlValue=e.int32();break;case 4:r.instrument=e.int32();break;case 5:r.program=e.int32();break;case 6:r.isDrum=e.bool();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!(u.isInteger(e.quantizedStep)||e.quantizedStep&&u.isInteger(e.quantizedStep.low)&&u.isInteger(e.quantizedStep.high))?"quantizedStep: integer|Long expected":null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&!u.isInteger(e.controlNumber)?"controlNumber: integer expected":null!=e.controlValue&&e.hasOwnProperty("controlValue")&&!u.isInteger(e.controlValue)?"controlValue: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!u.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!u.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.ControlChange)return e;var t=new c.tensorflow.magenta.NoteSequence.ControlChange;return null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(u.Long?(t.quantizedStep=u.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"==typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"==typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"==typeof e.quantizedStep&&(t.quantizedStep=new u.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.controlNumber&&(t.controlNumber=0|e.controlNumber),null!=e.controlValue&&(t.controlValue=0|e.controlValue),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.controlNumber=0,n.controlValue=0,n.instrument=0,n.program=0,n.isDrum=!1,u.Long){var r=new u.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&(n.controlNumber=e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&(n.controlValue=e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&(n.quantizedStep="number"==typeof e.quantizedStep?t.longs===String?String(e.quantizedStep):e.quantizedStep:t.longs===String?u.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new u.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.PartInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.part=0,e.prototype.name="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(8).int32(e.part),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(18).string(e.name),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.PartInfo;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.part=e.int32();break;case 2:r.name=e.string();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.part&&e.hasOwnProperty("part")&&!u.isInteger(e.part)?"part: integer expected":null!=e.name&&e.hasOwnProperty("name")&&!u.isString(e.name)?"name: string expected":null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.PartInfo)return e;var t=new c.tensorflow.magenta.NoteSequence.PartInfo;return null!=e.part&&(t.part=0|e.part),null!=e.name&&(t.name=String(e.name)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.part=0,n.name=""),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.SourceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sourceType=0,e.prototype.encodingType=0,e.prototype.parser=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&t.uint32(8).int32(e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&t.uint32(16).int32(e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&t.uint32(24).int32(e.parser),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.SourceInfo;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.sourceType=e.int32();break;case 2:r.encodingType=e.int32();break;case 3:r.parser=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sourceType&&e.hasOwnProperty("sourceType"))switch(e.sourceType){default:return"sourceType: enum value expected";case 0:case 1:case 2:}if(null!=e.encodingType&&e.hasOwnProperty("encodingType"))switch(e.encodingType){default:return"encodingType: enum value expected";case 0:case 1:case 2:case 3:case 4:}if(null!=e.parser&&e.hasOwnProperty("parser"))switch(e.parser){default:return"parser: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:}return null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.SourceInfo)return e;var t=new c.tensorflow.magenta.NoteSequence.SourceInfo;switch(e.sourceType){case"UNKNOWN_SOURCE_TYPE":case 0:t.sourceType=0;break;case"SCORE_BASED":case 1:t.sourceType=1;break;case"PERFORMANCE_BASED":case 2:t.sourceType=2}switch(e.encodingType){case"UNKNOWN_ENCODING_TYPE":case 0:t.encodingType=0;break;case"MUSIC_XML":case 1:t.encodingType=1;break;case"ABC":case 2:t.encodingType=2;break;case"MIDI":case 3:t.encodingType=3;break;case"MUSICNET":case 4:t.encodingType=4}switch(e.parser){case"UNKNOWN_PARSER":case 0:t.parser=0;break;case"MUSIC21":case 1:t.parser=1;break;case"PRETTY_MIDI":case 2:t.parser=2;break;case"MAGENTA_MUSIC_XML":case 3:t.parser=3;break;case"MAGENTA_MUSICNET":case 4:t.parser=4;break;case"MAGENTA_ABC":case 5:t.parser=5;break;case"TONEJS_MIDI_CONVERT":case 6:t.parser=6}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.sourceType=t.enums===String?"UNKNOWN_SOURCE_TYPE":0,n.encodingType=t.enums===String?"UNKNOWN_ENCODING_TYPE":0,n.parser=t.enums===String?"UNKNOWN_PARSER":0),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&(n.sourceType=t.enums===String?c.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[e.sourceType]:e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&(n.encodingType=t.enums===String?c.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[e.encodingType]:e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&(n.parser=t.enums===String?c.tensorflow.magenta.NoteSequence.SourceInfo.Parser[e.parser]:e.parser),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e.SourceType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_SOURCE_TYPE"]=0,t[e[1]="SCORE_BASED"]=1,t[e[2]="PERFORMANCE_BASED"]=2,t}(),e.EncodingType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_ENCODING_TYPE"]=0,t[e[1]="MUSIC_XML"]=1,t[e[2]="ABC"]=2,t[e[3]="MIDI"]=3,t[e[4]="MUSICNET"]=4,t}(),e.Parser=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_PARSER"]=0,t[e[1]="MUSIC21"]=1,t[e[2]="PRETTY_MIDI"]=2,t[e[3]="MAGENTA_MUSIC_XML"]=3,t[e[4]="MAGENTA_MUSICNET"]=4,t[e[5]="MAGENTA_ABC"]=5,t[e[6]="TONEJS_MIDI_CONVERT"]=6,t}(),e}(),e.TextAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.text="",e.prototype.annotationType=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.text&&e.hasOwnProperty("text")&&t.uint32(18).string(e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&t.uint32(24).int32(e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(32).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.TextAnnotation;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 4:r.quantizedStep=u.Long?e.int64().toNumber():e.int64();break;case 2:r.text=e.string();break;case 3:r.annotationType=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time)return"time: number expected";if(null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!(u.isInteger(e.quantizedStep)||e.quantizedStep&&u.isInteger(e.quantizedStep.low)&&u.isInteger(e.quantizedStep.high)))return"quantizedStep: integer|Long expected";if(null!=e.text&&e.hasOwnProperty("text")&&!u.isString(e.text))return"text: string expected";if(null!=e.annotationType&&e.hasOwnProperty("annotationType"))switch(e.annotationType){default:return"annotationType: enum value expected";case 0:case 1:case 2:}return null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.TextAnnotation)return e;var t=new c.tensorflow.magenta.NoteSequence.TextAnnotation;switch(null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(u.Long?(t.quantizedStep=u.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"==typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"==typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"==typeof e.quantizedStep&&(t.quantizedStep=new u.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.text&&(t.text=String(e.text)),e.annotationType){case"UNKNOWN":case 0:t.annotationType=0;break;case"CHORD_SYMBOL":case 1:t.annotationType=1;break;case"BEAT":case 2:t.annotationType=2}return t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.text="",n.annotationType=t.enums===String?"UNKNOWN":0,u.Long){var r=new u.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.text&&e.hasOwnProperty("text")&&(n.text=e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&(n.annotationType=t.enums===String?c.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[e.annotationType]:e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&(n.quantizedStep="number"==typeof e.quantizedStep?t.longs===String?String(e.quantizedStep):e.quantizedStep:t.longs===String?u.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new u.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e.TextAnnotationType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN"]=0,t[e[1]="CHORD_SYMBOL"]=1,t[e[2]="BEAT"]=2,t}(),e}(),e.QuantizationInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.stepsPerQuarter=0,e.prototype.stepsPerSecond=0,Object.defineProperty(e.prototype,"resolution",{get:u.oneOfGetter(t=["stepsPerQuarter","stepsPerSecond"]),set:u.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&t.uint32(8).int32(e.stepsPerQuarter),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&t.uint32(16).int32(e.stepsPerSecond),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.QuantizationInfo;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.stepsPerQuarter=e.int32();break;case 2:r.stepsPerSecond=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(t.resolution=1,!u.isInteger(e.stepsPerQuarter)))return"stepsPerQuarter: integer expected";if(null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")){if(1===t.resolution)return"resolution: multiple values";if(t.resolution=1,!u.isInteger(e.stepsPerSecond))return"stepsPerSecond: integer expected"}return null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.QuantizationInfo)return e;var t=new c.tensorflow.magenta.NoteSequence.QuantizationInfo;return null!=e.stepsPerQuarter&&(t.stepsPerQuarter=0|e.stepsPerQuarter),null!=e.stepsPerSecond&&(t.stepsPerSecond=0|e.stepsPerSecond),t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(n.stepsPerQuarter=e.stepsPerQuarter,t.oneofs&&(n.resolution="stepsPerQuarter")),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&(n.stepsPerSecond=e.stepsPerSecond,t.oneofs&&(n.resolution="stepsPerSecond")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.SubsequenceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.startTimeOffset=0,e.prototype.endTimeOffset=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&t.uint32(9).double(e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&t.uint32(17).double(e.endTimeOffset),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.SubsequenceInfo;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.startTimeOffset=e.double();break;case 2:r.endTimeOffset=e.double();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&"number"!=typeof e.startTimeOffset?"startTimeOffset: number expected":null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&"number"!=typeof e.endTimeOffset?"endTimeOffset: number expected":null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.SubsequenceInfo)return e;var t=new c.tensorflow.magenta.NoteSequence.SubsequenceInfo;return null!=e.startTimeOffset&&(t.startTimeOffset=Number(e.startTimeOffset)),null!=e.endTimeOffset&&(t.endTimeOffset=Number(e.endTimeOffset)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.startTimeOffset=0,n.endTimeOffset=0),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&(n.startTimeOffset=t.json&&!isFinite(e.startTimeOffset)?String(e.startTimeOffset):e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&(n.endTimeOffset=t.json&&!isFinite(e.endTimeOffset)?String(e.endTimeOffset):e.endTimeOffset),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.SectionAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.sectionId=u.Long?u.Long.fromBits(0,0,!1):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(32).int64(e.sectionId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.SectionAnnotation;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.time=e.double();break;case 4:r.sectionId=u.Long?e.int64().toNumber():e.int64();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.sectionId&&e.hasOwnProperty("sectionId")&&!(u.isInteger(e.sectionId)||e.sectionId&&u.isInteger(e.sectionId.low)&&u.isInteger(e.sectionId.high))?"sectionId: integer|Long expected":null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.SectionAnnotation)return e;var t=new c.tensorflow.magenta.NoteSequence.SectionAnnotation;return null!=e.time&&(t.time=Number(e.time)),null!=e.sectionId&&(u.Long?(t.sectionId=u.Long.fromValue(e.sectionId)).unsigned=!1:"string"==typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"==typeof e.sectionId?t.sectionId=e.sectionId:"object"==typeof e.sectionId&&(t.sectionId=new u.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,u.Long){var r=new u.Long(0,0,!1);n.sectionId=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.sectionId=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&(n.sectionId="number"==typeof e.sectionId?t.longs===String?String(e.sectionId):e.sectionId:t.longs===String?u.Long.prototype.toString.call(e.sectionId):t.longs===Number?new u.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.Section=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.sectionId=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.sectionGroup=null,Object.defineProperty(e.prototype,"sectionType",{get:u.oneOfGetter(t=["sectionId","sectionGroup"]),set:u.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(8).int64(e.sectionId),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&c.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroup,t.uint32(18).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.Section;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.sectionId=u.Long?e.int64().toNumber():e.int64();break;case 2:r.sectionGroup=c.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32());break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.sectionId&&e.hasOwnProperty("sectionId")&&(t.sectionType=1,!(u.isInteger(e.sectionId)||e.sectionId&&u.isInteger(e.sectionId.low)&&u.isInteger(e.sectionId.high))))return"sectionId: integer|Long expected";if(null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")){if(1===t.sectionType)return"sectionType: multiple values";t.sectionType=1;var n=c.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroup);if(n)return"sectionGroup."+n}return null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.Section)return e;var t=new c.tensorflow.magenta.NoteSequence.Section;if(null!=e.sectionId&&(u.Long?(t.sectionId=u.Long.fromValue(e.sectionId)).unsigned=!1:"string"==typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"==typeof e.sectionId?t.sectionId=e.sectionId:"object"==typeof e.sectionId&&(t.sectionId=new u.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),null!=e.sectionGroup){if("object"!=typeof e.sectionGroup)throw TypeError(".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected");t.sectionGroup=c.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroup)}return t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.sectionId&&e.hasOwnProperty("sectionId")&&(n.sectionId="number"==typeof e.sectionId?t.longs===String?String(e.sectionId):e.sectionId:t.longs===String?u.Long.prototype.toString.call(e.sectionId):t.longs===Number?new u.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId,t.oneofs&&(n.sectionType="sectionId")),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&(n.sectionGroup=c.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroup,t),t.oneofs&&(n.sectionType="sectionGroup")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.SectionGroup=function(){function e(e){if(this.sections=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sections=u.emptyArray,e.prototype.numTimes=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.sections&&e.sections.length)for(var n=0;n<e.sections.length;++n)c.tensorflow.magenta.NoteSequence.Section.encode(e.sections[n],t.uint32(10).fork()).ldelim();return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&t.uint32(16).int32(e.numTimes),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.NoteSequence.SectionGroup;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.sections&&r.sections.length||(r.sections=[]),r.sections.push(c.tensorflow.magenta.NoteSequence.Section.decode(e,e.uint32()));break;case 2:r.numTimes=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sections&&e.hasOwnProperty("sections")){if(!Array.isArray(e.sections))return"sections: array expected";for(var t=0;t<e.sections.length;++t){var n=c.tensorflow.magenta.NoteSequence.Section.verify(e.sections[t]);if(n)return"sections."+n}}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&!u.isInteger(e.numTimes)?"numTimes: integer expected":null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.NoteSequence.SectionGroup)return e;var t=new c.tensorflow.magenta.NoteSequence.SectionGroup;if(e.sections){if(!Array.isArray(e.sections))throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected");t.sections=[];for(var n=0;n<e.sections.length;++n){if("object"!=typeof e.sections[n])throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected");t.sections[n]=c.tensorflow.magenta.NoteSequence.Section.fromObject(e.sections[n])}}return null!=e.numTimes&&(t.numTimes=0|e.numTimes),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.sections=[]),t.defaults&&(n.numTimes=0),e.sections&&e.sections.length){n.sections=[];for(var r=0;r<e.sections.length;++r)n.sections[r]=c.tensorflow.magenta.NoteSequence.Section.toObject(e.sections[r],t)}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&(n.numTimes=e.numTimes),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e}(),r.SequenceMetadata=function(){function e(e){if(this.genre=[],this.composers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.title="",e.prototype.artist="",e.prototype.genre=u.emptyArray,e.prototype.composers=u.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.title&&e.hasOwnProperty("title")&&t.uint32(10).string(e.title),null!=e.artist&&e.hasOwnProperty("artist")&&t.uint32(18).string(e.artist),null!=e.genre&&e.genre.length)for(var n=0;n<e.genre.length;++n)t.uint32(26).string(e.genre[n]);if(null!=e.composers&&e.composers.length)for(n=0;n<e.composers.length;++n)t.uint32(34).string(e.composers[n]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.SequenceMetadata;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.title=e.string();break;case 2:r.artist=e.string();break;case 3:r.genre&&r.genre.length||(r.genre=[]),r.genre.push(e.string());break;case 4:r.composers&&r.composers.length||(r.composers=[]),r.composers.push(e.string());break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.title&&e.hasOwnProperty("title")&&!u.isString(e.title))return"title: string expected";if(null!=e.artist&&e.hasOwnProperty("artist")&&!u.isString(e.artist))return"artist: string expected";if(null!=e.genre&&e.hasOwnProperty("genre")){if(!Array.isArray(e.genre))return"genre: array expected";for(var t=0;t<e.genre.length;++t)if(!u.isString(e.genre[t]))return"genre: string[] expected"}if(null!=e.composers&&e.hasOwnProperty("composers")){if(!Array.isArray(e.composers))return"composers: array expected";for(t=0;t<e.composers.length;++t)if(!u.isString(e.composers[t]))return"composers: string[] expected"}return null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.SequenceMetadata)return e;var t=new c.tensorflow.magenta.SequenceMetadata;if(null!=e.title&&(t.title=String(e.title)),null!=e.artist&&(t.artist=String(e.artist)),e.genre){if(!Array.isArray(e.genre))throw TypeError(".tensorflow.magenta.SequenceMetadata.genre: array expected");t.genre=[];for(var n=0;n<e.genre.length;++n)t.genre[n]=String(e.genre[n])}if(e.composers){if(!Array.isArray(e.composers))throw TypeError(".tensorflow.magenta.SequenceMetadata.composers: array expected");for(t.composers=[],n=0;n<e.composers.length;++n)t.composers[n]=String(e.composers[n])}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.genre=[],n.composers=[]),t.defaults&&(n.title="",n.artist=""),null!=e.title&&e.hasOwnProperty("title")&&(n.title=e.title),null!=e.artist&&e.hasOwnProperty("artist")&&(n.artist=e.artist),e.genre&&e.genre.length){n.genre=[];for(var r=0;r<e.genre.length;++r)n.genre[r]=e.genre[r]}if(e.composers&&e.composers.length)for(n.composers=[],r=0;r<e.composers.length;++r)n.composers[r]=e.composers[r];return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),r.VelocityRange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.min=0,e.prototype.max=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.min&&e.hasOwnProperty("min")&&t.uint32(8).int32(e.min),null!=e.max&&e.hasOwnProperty("max")&&t.uint32(16).int32(e.max),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof o||(e=o.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new c.tensorflow.magenta.VelocityRange;e.pos<n;){var a=e.uint32();switch(a>>>3){case 1:r.min=e.int32();break;case 2:r.max=e.int32();break;default:e.skipType(7&a)}}return r},e.decodeDelimited=function(e){return e instanceof o||(e=new o(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.min&&e.hasOwnProperty("min")&&!u.isInteger(e.min)?"min: integer expected":null!=e.max&&e.hasOwnProperty("max")&&!u.isInteger(e.max)?"max: integer expected":null},e.fromObject=function(e){if(e instanceof c.tensorflow.magenta.VelocityRange)return e;var t=new c.tensorflow.magenta.VelocityRange;return null!=e.min&&(t.min=0|e.min),null!=e.max&&(t.max=0|e.max),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.min=0,n.max=0),null!=e.min&&e.hasOwnProperty("min")&&(n.min=e.min),null!=e.max&&e.hasOwnProperty("max")&&(n.max=e.max),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),r),a),e.exports=c},function(e,t,n){"use strict";(function(e,r){var a;function i(){if(null==a){var t;if("undefined"!=typeof window)t=window;else if(void 0!==e)t=e;else if(void 0!==r)t=r;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}a=t}return a}function o(e,t){var n=function(){var e=i();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}))}).call(this,n(21),n(44))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8}},function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s}));var r=n(2),a=n(20),i=n(24);function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r.tidy((function(){var n=r.mul(e,r.pow(2,t));return n=n.clipByValue(0,Object(a.g)(110).dataSync()[0])}))}function s(e,t,n){return e.splice(n),function(e,t){for(var n=[],r=Math.floor(t/e.length),a=t%e.length,i=0;i<e.length;i++){n.push(e[i]);for(var o=1;o<r;o++)n.push(-1);i<a&&n.push(-1)}for(var s=-1,u=0;u<n.length;u++)if(-1!==n[u]){var c=n[u],l=s>=0?n[s]:0;-1!==s&&(c-=n[s]);for(var h=s+1;h<u;h++)n[h]=l+c*(h-s)/(u-s);s=u}for(var f=s+1;f<n.length;f++)n[f]=s>=0?n[f-1]:0;return n}(e,t)}function u(e){return 10*Math.pow(2,1*(e*i.f+i.e)/12)}function c(e,t){return l.apply(this,arguments)}function l(){return(l=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a,o,s,c,l,h,f,d,p,m,v,g,y,_,b,k,w,x,C,S,T,A,E,I,R,O,N,D,P,F=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=F.length>2&&void 0!==F[2]?F[2]:i.a,o=[],s=[],c=n.length,l=r.tensor(n),h=512*Math.ceil(c/512),f=l.pad([[0,h-c]]),d=f.size/16e3,e.next=10,t.execute({input_audio_samples:f});case 10:return p=e.sent,e.next=13,p[0].data();case 13:return m=e.sent,e.next=16,p[1].data();case 16:if(32*((v=e.sent).length-1)/1e3!==d){e.next=37;break}g=20,y=0;case 20:if(!(y<v.length)){e.next=35;break}if(_=1-m[y],s.push(_),!(_>=i.a)){e.next=26;break}g=u(v[y]),o.push(g),e.next=32;break;case 26:return b=r.truncatedNormal([1],0,i.d),e.next=29,b.array();case 29:e.t0=e.sent,k=1-e.t0,o.push(g*k),b.dispose();case 32:++y,e.next=20;break;case 35:e.next=73;break;case 37:w=h/512+1,x=new Float32Array(w),m=new Float32Array(w),C=0;case 40:if(!(C<h)){e.next=56;break}return S=f.slice([C],[h/4]),e.next=44,t.execute({input_audio_samples:S});case 44:return T=e.sent,e.next=47,T[0].data();case 47:return A=e.sent,e.next=50,T[1].data();case 50:E=e.sent,I=Math.floor(C/512),m.set(A,I),x.set(E,I),S.dispose(),T[0].dispose(),T[1].dispose();case 53:C+=h/4,e.next=40;break;case 56:R=20,O=0;case 58:if(!(O<x.length)){e.next=73;break}if(N=1-m[O],s.push(N),!(N>=a)){e.next=64;break}R=u(x[O]),o.push(R),e.next=70;break;case 64:return D=r.truncatedNormal([1],0,i.d),e.next=67,D.array();case 67:e.t1=e.sent,P=1-e.t1,o.push(R*P),D.dispose();case 70:++O,e.next=58;break;case 73:return e.abrupt("return",(p[0].dispose(),p[1].dispose(),l.dispose(),f.dispose(),{pitches:o,confidences:s}));case 74:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},function(e,t,n){"use strict";n.r(t),n.d(t,"ChordQuality",(function(){return le})),n.d(t,"ChordSymbolException",(function(){return de})),n.d(t,"ChordEncodingException",(function(){return pe})),n.d(t,"ChordSymbols",(function(){return me})),n.d(t,"ChordEncoder",(function(){return ve})),n.d(t,"chordEncoderFromType",(function(){return ge})),n.d(t,"MajorMinorChordEncoder",(function(){return ye})),n.d(t,"TriadChordEncoder",(function(){return _e})),n.d(t,"PitchChordEncoder",(function(){return be}));var r={};n.r(r),n.d(r,"names",(function(){return s})),n.d(r,"tokenize",(function(){return h})),n.d(r,"props",(function(){return p})),n.d(r,"name",(function(){return m})),n.d(r,"pc",(function(){return v})),n.d(r,"midi",(function(){return g})),n.d(r,"midiToFreq",(function(){return y})),n.d(r,"freq",(function(){return _})),n.d(r,"freqToMidi",(function(){return w})),n.d(r,"chroma",(function(){return x})),n.d(r,"oct",(function(){return C})),n.d(r,"stepToLetter",(function(){return S})),n.d(r,"altToAcc",(function(){return A})),n.d(r,"from",(function(){return E})),n.d(r,"build",(function(){return I})),n.d(r,"fromMidi",(function(){return R})),n.d(r,"simplify",(function(){return O})),n.d(r,"enharmonic",(function(){return N}));var a={};n.r(a),n.d(a,"names",(function(){return ee})),n.d(a,"props",(function(){return ne})),n.d(a,"intervals",(function(){return re})),n.d(a,"notes",(function(){return ae})),n.d(a,"exists",(function(){return ie})),n.d(a,"supersets",(function(){return oe})),n.d(a,"subsets",(function(){return se})),n.d(a,"tokenize",(function(){return ce}));var i=n(2),o="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),s=function(e){return"string"!=typeof e?o.slice():o.filter((function(t){return-1!==e.indexOf(t[1]||" ")}))},u=s(" #"),c=s(" b"),l=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function h(e){"string"!=typeof e&&(e="");var t=l.exec(e);return[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]}var f=Object.freeze({pc:null,name:null,step:null,alt:null,oct:null,octStr:null,chroma:null,midi:null,freq:null}),d=[0,2,4,5,7,9,11],p=function(e,t){return void 0===t&&(t={}),function(e){return t[e]||(t[e]=function(e){var t=h(e);if(""===t[0]||""!==t[3])return f;var n=t[0],r=t[1],a=t[2],i={letter:n,acc:r,octStr:a,pc:n+r,name:n+r+a,step:(n.charCodeAt(0)+3)%7,alt:"b"===r[0]?-r.length:r.length,oct:a.length?+a:null,chroma:0,midi:null,freq:null};return i.chroma=(d[i.step]+i.alt+120)%12,i.midi=null!==i.oct?d[i.step]+i.alt+12*(i.oct+1):null,i.freq=y(i.midi),Object.freeze(i)}(e))}}(),m=function(e){return p(e).name},v=function(e){return p(e).pc},g=function(e){if("number"!=typeof e&&"string"!=typeof e)return null;var t,n=p(e).midi,r=n||0===n?n:+e;return(t=r)>=0&&t<=127?r:null},y=function(e,t){return void 0===t&&(t=440),"number"==typeof e?Math.pow(2,(e-69)/12)*t:null},_=function(e){return p(e).freq||y(e)},b=Math.log(2),k=Math.log(440),w=function(e){var t=12*(Math.log(e)-k)/b+69;return Math.round(100*t)/100},x=function(e){return p(e).chroma},C=function(e){return p(e).oct},S=function(e){return"CDEFGAB"[e]},T=function(e,t){return Array(t+1).join(e)},A=function(e){return function(e,t){return"number"!=typeof e?"":function(e){return e<0?T("b",-e):T("#",e)}(e)}(e)},E=function(e,t){void 0===e&&(e={}),void 0===t&&(t=null);var n=t?Object.assign({},p(t),e):e,r=n.step,a=n.alt,i=n.oct;if("number"!=typeof r)return null;var o=S(r);if(!o)return null;var s=o+A(a);return i||0===i?s+i:s},I=E;function R(e,t){return void 0===t&&(t=!1),e=Math.round(e),(!0===t?u:c)[e%12]+(Math.floor(e/12)-1)}var O=function(e,t){void 0===t&&(t=!0);var n=p(e),r=n.alt,a=n.chroma,i=n.midi;if(null===a)return null;var o=!1===t?r<0:r>0;return null===i?v(R(a,o)):R(i,o)},N=function(e){return O(e,!1)},D=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$"),P=[0,2,4,5,7,9,11],F=("1P 2m 2M 3m 3M 4P 5P 6m 6M 7m 7M 8P".split(" "),Object.freeze({name:null,num:null,q:null,step:null,alt:null,dir:null,type:null,simple:null,semitones:null,chroma:null,oct:null})),M={};function L(e){return"string"!=typeof e?F:M[e]||(M[e]=function(e){var t=function(e){var t=D.exec(""+e);return null===t?null:t[1]?[t[1],t[2]]:[t[4],t[3]]}(e);if(null===t)return F;var n,r,a={num:0,q:"d",name:"",type:"M",step:0,dir:-1,simple:1,alt:0,oct:0,semitones:0,chroma:0,ic:0};return a.num=+t[0],a.q=t[1],a.step=function(e){return(Math.abs(e)-1)%7}(a.num),a.type="PMMPPMM"[a.step],"M"===a.type&&"P"===a.q?F:(a.name=""+a.num+a.q,a.dir=a.num<0?-1:1,a.simple=8===a.num||-8===a.num?a.num:a.dir*(a.step+1),a.alt=(n=a.type,"M"===(r=a.q)&&"M"===n||"P"===r&&"P"===n?0:"m"===r&&"M"===n?-1:/^A+$/.test(r)?r.length:/^d+$/.test(r)?"P"===n?-r.length:-r.length-1:null),a.oct=Math.floor((Math.abs(a.num)-1)/7),a.semitones=a.dir*(P[a.step]+a.alt+12*a.oct),a.chroma=(a.dir*(P[a.step]+a.alt)%12+12)%12,Object.freeze(a))}(e))}"P m M m M P d P m M m M".split(" ");var z=[0,2,4,-1,1,3,5],B=z.map((function(e){return Math.floor(7*e/12)})),j=[3,0,4,1,5,2,6],V=function(e,t,n){var r=j[function(e){var t=(e+1)%7;return t<0?7+t:t}(e)],a=Math.floor((e+1)/7);return void 0===t?{step:r,alt:a,dir:n}:{step:r,alt:a,oct:t+4*a+B[r],dir:n}},q=function(e){return function(e,t){return void 0===t&&(t={}),function(n){return t[n]||(t[n]=e(n))}}((function(t){var n=e(t);return null===n.name?null:function(e){var t=e.step,n=e.alt,r=e.oct,a=e.dir;void 0===a&&(a=1);var i=z[t]+7*n;return null===r?[a*i]:[a*i,a*(r-B[t]-4*n)]}(n)}))},U=q(p),W=q(L);function G(e,t){if(1===arguments.length)return function(t){return G(e,t)};var n=U(e),r=W(t);if(null===n||null===r)return null;var a=1===n.length?[n[0]+r[0]]:[n[0]+r[0],n[1]+r[1]];return I(V(a[0],a[1]))}var H=n(69),K=n(70),X=function(e){return x(e)||function(e){return L(e).chroma}(e)||0},Q=function(e){return parseInt(Y(e),2)};function Y(e){if(function(e){return Z.test(e)}(e))return e;if(!Array.isArray(e))return"";var t=[0,0,0,0,0,0,0,0,0,0,0,0];return e.map(X).forEach((function(e){t[e]=1})),t.join("")}var Z=/^[01]{12}$/;"1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");var J=function(e){var t=Object.keys(e).sort(),n=[],r=[],a=function(e,t,a){n[e]=t,r[a]=r[a]||[],r[a].push(e)};t.forEach((function(t){var n=e[t][0].split(" "),r=e[t][1],i=Y(n);a(t,n,i),r&&r.forEach((function(e){return a(e,n,i)}))}));var i=Object.keys(n).sort(),o=function(e){return n[e]};return o.names=function(e){return"string"==typeof e?(r[e]||[]).slice():(!0===e?i:t).slice()},o},$=(J(H),J(K)),ee=(Object.freeze({name:null,intervals:[],names:[],chroma:null,setnum:null}),$.names),te=Object.freeze({name:null,names:[],intervals:[],chroma:null,setnum:null}),ne=function(e,t){return void 0===t&&(t={}),function(e){return t[e]||(t[e]=function(e){var t=$(e);if(!t)return te;var n={intervals:t,name:e};return n.chroma=Y(t),n.setnum=parseInt(n.chroma,2),n.names=$.names(n.chroma),n}(e))}}(),re=function(e){return ne(ce(e)[1]).intervals};function ae(e,t){if(t)return ne(t).intervals.map(G(e));var n=ce(e),r=n[0];return ne(n[1]).intervals.map(G(r))}var ie=function(e){return void 0!==$(ce(e)[1])},oe=function(e){if(!re(e).length)return[];var t=function e(t,n){return arguments.length>1?e(t)(n):(t=Q(t),function(e){return(e=Q(e))!==t&&(e|t)===e})}(re(e));return $.names().filter((function(e){return t($(e))}))},se=function(e){var t=function e(t,n){return arguments.length>1?e(t)(n):(t=Q(t),function(e){return(e=Q(e))!==t&&(e&t)===e})}(re(e));return $.names().filter((function(e){return t($(e))}))},ue=/^(6|64|7|9|11|13)$/;function ce(e){var t=h(e);return""===t[0]?["",e]:"A"===t[0]&&"ug"===t[3]?["","aug"]:ue.test(t[2])?[t[0]+t[1],t[2]+t[3]]:[t[0]+t[1]+t[2],t[3]]}var le,he=n(8),fe=[["1P","3M","5P"],["1P","3m","5P"],["1P","3M","5A"],["1P","3m","5d"]];!function(e){e[e.Major=0]="Major",e[e.Minor=1]="Minor",e[e.Augmented=2]="Augmented",e[e.Diminished=3]="Diminished",e[e.Other=4]="Other"}(le||(le={}));var de=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),(this instanceof n?this.constructor:void 0).prototype),r}return n}(),pe=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),(this instanceof n?this.constructor:void 0).prototype),r}return n}(),me=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,null,[{key:"pitches",value:function(e){if(!a.tokenize(e)[0]||!a.exists(e))throw new de("Unrecognized chord symbol: "+e);return a.notes(e).map(r.chroma)}},{key:"root",value:function(e){var t=a.tokenize(e)[0];if(!t)throw new de("Chord symbol has unknown root: "+e);return r.chroma(t)}},{key:"quality",value:function(e){if(!a.exists(e))throw new de("Unrecognized chord symbol: "+e);var t=a.intervals(e),n=fe.map((function(e){return e.every((function(e){return t.includes(e)}))})),r=n.indexOf(!0),i=n.lastIndexOf(!0);return r>=0&&r===i?r:le.Other}}]),e}(),ve=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"encodeProgression",value:function(e,t){var n=this,r=e.map((function(e){return n.encode(e)})),a=Array.from(Array(t).keys()).map((function(e){return Math.floor(e*r.length/t)}));return i.stack(a.map((function(e){return r[e]})))}}]),e}();function ge(e){switch(e){case"MajorMinorChordEncoder":return new ye;case"TriadChordEncoder":return new _e;case"PitchChordEncoder":return new be;default:throw new Error("Unknown chord encoder type: "+e)}}var ye=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).depth=1+2*he.NUM_PITCH_CLASSES,e}return _createClass2(n,[{key:"index",value:function(e){if(e===he.NO_CHORD)return 0;var t=me.root(e),n=1+me.quality(e)*he.NUM_PITCH_CLASSES+t;if(n>=this.depth)throw new pe("Chord is neither major nor minor: "+e);return n}},{key:"encode",value:function(e){var t=this;return i.tidy((function(){return i.oneHot(i.tensor1d([t.index(e)],"int32"),t.depth).as1D()}))}}]),n}(ve),_e=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).depth=1+4*he.NUM_PITCH_CLASSES,e}return _createClass2(n,[{key:"index",value:function(e){if(e===he.NO_CHORD)return 0;var t=me.root(e),n=1+me.quality(e)*he.NUM_PITCH_CLASSES+t;if(n>=this.depth)throw new pe("Chord is not a standard triad: "+e);return n}},{key:"encode",value:function(e){var t=this;return i.tidy((function(){return i.oneHot(i.tensor1d([t.index(e)],"int32"),t.depth).as1D()}))}}]),n}(ve),be=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).depth=1+3*he.NUM_PITCH_CLASSES,e}return _createClass2(n,[{key:"encode",value:function(e){var t=this;return i.tidy((function(){if(e===he.NO_CHORD)return i.oneHot(i.tensor1d([0],"int32"),t.depth).as1D();var n=me.root(e),r=i.oneHot(i.tensor1d([n],"int32"),he.NUM_PITCH_CLASSES).as1D(),a=i.buffer([he.NUM_PITCH_CLASSES]);me.pitches(e).forEach((function(e){return a.set(1,e)}));var o=a.toTensor().as1D(),s=r;return i.concat1d([i.tensor1d([0]),r,o,s])}))}}]),n}(ve)},function(e,t,n){"use strict";function r(e){if(this.size=0|e,this.size<=1||0!=(this.size&this.size-1))throw new Error("FFT size must be a power of two and bigger than 1");this._csize=e<<1;for(var t=new Array(2*this.size),n=0;n<t.length;n+=2){var r=Math.PI*n/this.size;t[n]=Math.cos(r),t[n+1]=-Math.sin(r)}this.table=t;for(var a=0,i=1;this.size>i;i<<=1)a++;this._width=a%2==0?a-1:a,this._bitrev=new Array(1<<this._width);for(var o=0;o<this._bitrev.length;o++){this._bitrev[o]=0;for(var s=0;s<this._width;s+=2)this._bitrev[o]|=(o>>>s&3)<<this._width-s-2}this._out=null,this._data=null,this._inv=0}e.exports=r,r.prototype.fromComplexArray=function(e,t){for(var n=t||new Array(e.length>>>1),r=0;r<e.length;r+=2)n[r>>>1]=e[r];return n},r.prototype.createComplexArray=function(){for(var e=new Array(this._csize),t=0;t<e.length;t++)e[t]=0;return e},r.prototype.toComplexArray=function(e,t){for(var n=t||this.createComplexArray(),r=0;r<n.length;r+=2)n[r]=e[r>>>1],n[r+1]=0;return n},r.prototype.completeSpectrum=function(e){for(var t=this._csize,n=t>>>1,r=2;r<n;r+=2)e[t-r]=e[r],e[t-r+1]=-e[r+1]},r.prototype.transform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._transform4(),this._out=null,this._data=null},r.prototype.realTransform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._realTransform4(),this._out=null,this._data=null},r.prototype.inverseTransform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=1,this._transform4();for(var n=0;n<e.length;n++)e[n]/=this.size;this._out=null,this._data=null},r.prototype._transform4=function(){var e,t,n=this._out,r=this._csize,a=1<<this._width,i=r/a<<1,o=this._bitrev;if(4===i)for(e=0,t=0;e<r;e+=i,t++)this._singleTransform2(e,o[t],a);else for(e=0,t=0;e<r;e+=i,t++)this._singleTransform4(e,o[t],a);var s=this._inv?-1:1,u=this.table;for(a>>=2;a>=2;a>>=2){var c=(i=r/a<<1)>>>2;for(e=0;e<r;e+=i)for(var l=e+c,h=e,f=0;h<l;h+=2,f+=a){var d=h,p=d+c,m=p+c,v=m+c,g=n[d],y=n[d+1],_=n[p],b=n[p+1],k=n[m],w=n[m+1],x=n[v],C=n[v+1],S=u[f],T=s*u[f+1],A=_*S-b*T,E=_*T+b*S,I=u[2*f],R=s*u[2*f+1],O=k*I-w*R,N=k*R+w*I,D=u[3*f],P=s*u[3*f+1],F=x*D-C*P,M=x*P+C*D,L=g+O,z=y+N,B=g-O,j=y-N,V=A+F,q=E+M,U=s*(A-F),W=s*(E-M),G=z+q,H=L-V,K=z-q,X=B+W,Q=j-U,Y=B-W,Z=j+U;n[d]=L+V,n[d+1]=G,n[p]=X,n[p+1]=Q,n[m]=H,n[m+1]=K,n[v]=Y,n[v+1]=Z}}},r.prototype._singleTransform2=function(e,t,n){var r=this._out,a=this._data,i=a[t],o=a[t+1],s=a[t+n],u=a[t+n+1],c=o+u,l=i-s,h=o-u;r[e]=i+s,r[e+1]=c,r[e+2]=l,r[e+3]=h},r.prototype._singleTransform4=function(e,t,n){var r=this._out,a=this._data,i=this._inv?-1:1,o=2*n,s=3*n,u=a[t],c=a[t+1],l=a[t+n],h=a[t+n+1],f=a[t+o],d=a[t+o+1],p=a[t+s],m=a[t+s+1],v=u+f,g=c+d,y=u-f,_=c-d,b=l+p,k=h+m,w=i*(l-p),x=i*(h-m),C=g+k,S=y+x,T=_-w,A=v-b,E=g-k,I=y-x,R=_+w;r[e]=v+b,r[e+1]=C,r[e+2]=S,r[e+3]=T,r[e+4]=A,r[e+5]=E,r[e+6]=I,r[e+7]=R},r.prototype._realTransform4=function(){var e,t,n=this._out,r=this._csize,a=1<<this._width,i=r/a<<1,o=this._bitrev;if(4===i)for(e=0,t=0;e<r;e+=i,t++)this._singleRealTransform2(e,o[t]>>>1,a>>>1);else for(e=0,t=0;e<r;e+=i,t++)this._singleRealTransform4(e,o[t]>>>1,a>>>1);var s=this._inv?-1:1,u=this.table;for(a>>=2;a>=2;a>>=2){var c=(i=r/a<<1)>>>1,l=c>>>1,h=l>>>1;for(e=0;e<r;e+=i)for(var f=0,d=0;f<=h;f+=2,d+=a){var p=e+f,m=p+l,v=m+l,g=v+l,y=n[p],_=n[p+1],b=n[m],k=n[m+1],w=n[v],x=n[v+1],C=n[g],S=n[g+1],T=u[d],A=s*u[d+1],E=b*T-k*A,I=b*A+k*T,R=u[2*d],O=s*u[2*d+1],N=w*R-x*O,D=w*O+x*R,P=u[3*d],F=s*u[3*d+1],M=C*P-S*F,L=C*F+S*P,z=y+N,B=_+D,j=y-N,V=_-D,q=E+M,U=I+L,W=s*(E-M),G=s*(I-L),H=B+U,K=j+G,X=V-W;if(n[p]=z+q,n[p+1]=H,n[m]=K,n[m+1]=X,0!==f){if(f!==h){var Q=-s*W-V,Y=z+-s*q,Z=-B- -s*U,J=e+l-f,$=e+c-f;n[J]=j+-s*G,n[J+1]=Q,n[$]=Y,n[$+1]=Z}}else{var ee=B-U;n[v]=z-q,n[v+1]=ee}}}},r.prototype._singleRealTransform2=function(e,t,n){var r=this._out,a=this._data,i=a[t],o=a[t+n],s=i-o;r[e]=i+o,r[e+1]=0,r[e+2]=s,r[e+3]=0},r.prototype._singleRealTransform4=function(e,t,n){var r=this._out,a=this._data,i=a[t],o=a[t+n],s=a[t+2*n],u=a[t+3*n],c=i+s,l=i-s,h=o+u,f=(this._inv?-1:1)*(o-u),d=l,p=-f,m=c-h,v=l,g=f;r[e]=c+h,r[e+1]=0,r[e+2]=d,r[e+3]=p,r[e+4]=m,r[e+5]=0,r[e+6]=v,r[e+7]=g}},function(e,t){var n,r,a=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,c=[],l=!1,h=-1;function f(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&d())}function d(){if(!l){var e=s(f);l=!0;for(var t=c.length;t;){for(u=c,c=[];++h<t;)u&&u[h].run();h=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||l||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=m,a.addListener=m,a.once=m,a.off=m,a.removeListener=m,a.removeAllListeners=m,a.emit=m,a.prependListener=m,a.prependOnceListener=m,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,n){"use strict";var r=n(65),a={body:"",args:[],thisVars:[],localVars:[]};function i(e){if(!e)return a;for(var t=0;t<e.args.length;++t){var n=e.args[t];e.args[t]=0===t?{name:n,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:n,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function o(e){for(var t=[],n=0;n<e.args.length;++n)t.push("a"+n);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return r({args:e.args,pre:i(e.pre),body:i(e.body),post:i(e.proc),funcName:e.funcName})}(e))}var s={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in s){var n=s[e];t[e]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:e}),t[e+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a"+n+"=b"},rvalue:!0,funcName:e+"eq"}),t[e+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:e+"s"}),t[e+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a"+n+"=s"},rvalue:!0,funcName:e+"seq"})}}();var u={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in u){var n=u[e];t[e]=o({args:["array","array"],body:{args:["a","b"],body:"a="+n+"b"},funcName:e}),t[e+"eq"]=o({args:["array"],body:{args:["a"],body:"a="+n+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var c={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in c){var n=c[e];t[e]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:e}),t[e+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:e+"s"}),t[e+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a=a"+n+"b"},rvalue:!0,count:2,funcName:e+"eq"}),t[e+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+n+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var l=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<l.length;++e){var n=l[e];t[n]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:n}),t[n+"eq"]=o({args:["array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"})}}();var h=["max","min","atan2","pow"];!function(){for(var e=0;e<h.length;++e){var n=h[e];t[n]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n}),t[n+"s"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n+"s"}),t[n+"eq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"}),t[n+"seq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"seq"})}}();var f=["atan2","pow"];!function(){for(var e=0;e<f.length;++e){var n=f[e];t[n+"op"]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"op"}),t[n+"ops"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"ops"}),t[n+"opeq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opeq"}),t[n+"opseq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opseq"})}}(),t.any=r({args:["array"],pre:a,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=r({args:["array"],pre:a,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=r({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=r({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=r({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=r({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=o({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=o({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=o({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=r({args:["array","array"],pre:a,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},function(e,t,n){"use strict";function r(){if("undefined"!=typeof navigator&&null!=navigator){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function a(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}n.r(t),n.d(t,"isMobile",(function(){return r})),n.d(t,"isBrowser",(function(){return a}))},function(e,t,n){var r=n(161),a=n(162),i=n(163),o=n(164),s=n(165),u=n(166),c=n(167);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},function(e,t,n){"use strict";e.exports=n(49)},function(e,t,n){"use strict";var r=t;function a(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(35),r.BufferWriter=n(58),r.Reader=n(36),r.BufferReader=n(59),r.util=n(18),r.rpc=n(60),r.roots=n(62),r.configure=a,a()},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=new Array(arguments.length-1),r=0,a=2,i=!0;a<arguments.length;)n[r++]=arguments[a++];return new Promise((function(a,o){n[r]=function(e){if(i)if(i=!1,e)o(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];a.apply(null,t)}};try{e.apply(t||null,n)}catch(e){i&&(i=!1,o(e))}}))}},function(e,t,n){"use strict";var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var a=new Array(64),i=new Array(123),o=0;o<64;)i[a[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;r.encode=function(e,t,n){for(var r,i=null,o=[],s=0,u=0;t<n;){var c=e[t++];switch(u){case 0:o[s++]=a[c>>2],r=(3&c)<<4,u=1;break;case 1:o[s++]=a[r|c>>4],r=(15&c)<<2,u=2;break;case 2:o[s++]=a[r|c>>6],o[s++]=a[63&c],u=0}s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0)}return u&&(o[s++]=a[r],o[s++]=61,1===u&&(o[s++]=61)),i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},r.decode=function(e,t,n){for(var r,a=n,o=0,s=0;s<e.length;){var u=e.charCodeAt(s++);if(61===u&&o>1)break;if(void 0===(u=i[u]))throw Error("invalid encoding");switch(o){case 0:r=u,o=1;break;case 1:t[n++]=r<<2|(48&u)>>4,r=u,o=2;break;case 2:t[n++]=(15&r)<<4|(60&u)>>2,r=u,o=3;break;case 3:t[n++]=(3&r)<<6|u,o=0}}if(1===o)throw Error("invalid encoding");return n-a},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,n){"use strict";function r(){this._listeners={}}e.exports=r,r.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},r.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},r.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},function(e,t,n){"use strict";function r(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function a(e,r,a){t[0]=e,r[a]=n[0],r[a+1]=n[1],r[a+2]=n[2],r[a+3]=n[3]}function i(e,r,a){t[0]=e,r[a]=n[3],r[a+1]=n[2],r[a+2]=n[1],r[a+3]=n[0]}function o(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function s(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?a:i,e.writeFloatBE=r?i:a,e.readFloatLE=r?o:s,e.readFloatBE=r?s:o}():function(){function t(e,t,n,r){var a=t<0?1:0;if(a&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((a<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((a<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var i=Math.floor(Math.log(t)/Math.LN2);e((a<<31|i+127<<23|8388607&Math.round(t*Math.pow(2,-i)*8388608))>>>0,n,r)}}function n(e,t,n){var r=e(t,n),a=2*(r>>31)+1,i=r>>>23&255,o=8388607&r;return 255===i?o?NaN:a*(1/0):0===i?1401298464324817e-60*a*o:a*Math.pow(2,i-150)*(o+8388608)}e.writeFloatLE=t.bind(null,a),e.writeFloatBE=t.bind(null,i),e.readFloatLE=n.bind(null,o),e.readFloatBE=n.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function a(e,r,a){t[0]=e,r[a]=n[0],r[a+1]=n[1],r[a+2]=n[2],r[a+3]=n[3],r[a+4]=n[4],r[a+5]=n[5],r[a+6]=n[6],r[a+7]=n[7]}function i(e,r,a){t[0]=e,r[a]=n[7],r[a+1]=n[6],r[a+2]=n[5],r[a+3]=n[4],r[a+4]=n[3],r[a+5]=n[2],r[a+6]=n[1],r[a+7]=n[0]}function o(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function s(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?a:i,e.writeDoubleBE=r?i:a,e.readDoubleLE=r?o:s,e.readDoubleBE=r?s:o}():function(){function t(e,t,n,r,a,i){var o=r<0?1:0;if(o&&(r=-r),0===r)e(0,a,i+t),e(1/r>0?0:2147483648,a,i+n);else if(isNaN(r))e(0,a,i+t),e(2146959360,a,i+n);else if(r>17976931348623157e292)e(0,a,i+t),e((o<<31|2146435072)>>>0,a,i+n);else{var s;if(r<22250738585072014e-324)e((s=r/5e-324)>>>0,a,i+t),e((o<<31|s/4294967296)>>>0,a,i+n);else{var u=Math.floor(Math.log(r)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(s=r*Math.pow(2,-u))>>>0,a,i+t),e((o<<31|u+1023<<20|1048576*s&1048575)>>>0,a,i+n)}}}function n(e,t,n,r,a){var i=e(r,a+t),o=e(r,a+n),s=2*(o>>31)+1,u=o>>>20&2047,c=4294967296*(1048575&o)+i;return 2047===u?c?NaN:s*(1/0):0===u?5e-324*s*c:s*Math.pow(2,u-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,a,0,4),e.writeDoubleBE=t.bind(null,i,4,0),e.readDoubleLE=n.bind(null,o,0,4),e.readDoubleBE=n.bind(null,s,4,0)}(),e}function a(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function i(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=r(r)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire},function(e,t,n){"use strict";var r=t;r.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},r.read=function(e,t,n){if(n-t<1)return"";for(var r,a=null,i=[],o=0;t<n;)(r=e[t++])<128?i[o++]=r:r>191&&r<224?i[o++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,i[o++]=55296+(r>>10),i[o++]=56320+(1023&r)):i[o++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,i)),o=0);return a?(o&&a.push(String.fromCharCode.apply(String,i.slice(0,o))),a.join("")):String.fromCharCode.apply(String,i.slice(0,o))},r.write=function(e,t,n){for(var r,a,i=n,o=0;o<e.length;++o)(r=e.charCodeAt(o))<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(a=e.charCodeAt(o+1)))?(++o,t[n++]=(r=65536+((1023&r)<<10)+(1023&a))>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-i}},function(e,t,n){"use strict";e.exports=function(e,t,n){var r=n||8192,a=r>>>1,i=null,o=r;return function(n){if(n<1||n>a)return e(n);o+n>r&&(i=e(r),o=0);var s=t.call(i,o,o+=n);return 7&o&&(o=1+(7|o)),s}}},function(e,t,n){"use strict";e.exports=a;var r=n(18);function a(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=a.zero=new a(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=a.zeroHash="\0\0\0\0\0\0\0\0";a.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new a(n,r)},a.from=function(e){if("number"==typeof e)return a.fromNumber(e);if(r.isString(e)){if(!r.Long)return a.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new a(e.low>>>0,e.high>>>0):i},a.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},a.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var s=String.prototype.charCodeAt;a.fromHash=function(e){return e===o?i:new a((s.call(e,0)|s.call(e,1)<<8|s.call(e,2)<<16|s.call(e,3)<<24)>>>0,(s.call(e,4)|s.call(e,5)<<8|s.call(e,6)<<16|s.call(e,7)<<24)>>>0)},a.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},a.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},a.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},a.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},function(e,t,n){"use strict";e.exports=i;var r=n(35);(i.prototype=Object.create(r.prototype)).constructor=i;var a=n(18);function i(){r.call(this)}function o(e,t,n){e.length<40?a.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}i._configure=function(){i.alloc=a._Buffer_allocUnsafe,i.writeBytesBuffer=a.Buffer&&a.Buffer.prototype instanceof Uint8Array&&"set"===a.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},i.prototype.bytes=function(e){a.isString(e)&&(e=a._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=a.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},function(e,t,n){"use strict";e.exports=i;var r=n(36);(i.prototype=Object.create(r.prototype)).constructor=i;var a=n(18);function i(e){r.call(this,e)}i._configure=function(){a.Buffer&&(i.prototype._slice=a.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},function(e,t,n){"use strict";t.Service=n(61)},function(e,t,n){"use strict";e.exports=a;var r=n(18);function a(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(a.prototype=Object.create(r.EventEmitter.prototype)).constructor=a,a.prototype.rpcCall=function e(t,n,a,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return r.asPromise(e,s,t,n,a,i);if(s.rpcImpl)try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return s.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof a))try{n=a[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return s.emit("error",e,t),o(e)}return s.emit("data",n,t),o(null,n)}s.end(!0)}))}catch(e){return s.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},a.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,n){"use strict";e.exports={}},function(e,t,n){"use strict";n.r(t),n.d(t,"auxiliaryInputFromSpec",(function(){return a})),n.d(t,"AuxiliaryInput",(function(){return i})),n.d(t,"BinaryCounter",(function(){return o}));var r=n(2);function a(e){switch(e.type){case"BinaryCounter":return new o(e.args);default:throw new Error("Unknown auxiliary input: "+e)}}var i=function e(t){_classCallCheck2(this,e),this.depth=t},o=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e.numBits)}return _createClass2(n,[{key:"getTensors",value:function(e){for(var t=r.buffer([e,this.depth]),n=0;n<e;++n)for(var a=0;a<this.depth;++a)t.set(Math.floor((n+1)/Math.pow(2,a))%2?1:-1,n,a);return t.toTensor().as2D(e,this.depth)}}]),n}(i)},function(e,t,n){"use strict";(function(e){var r=n(72),a=n(73),i=n(74);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),a=(e=s(e,r)).write(t,n);return a!==r&&(e=e.slice(0,a)),e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|d(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?s(e,0):f(e,t);if("Buffer"===t.type&&i(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=s(e,t<0?0:0|d(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|d(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function d(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return V(e).length;default:if(r)return j(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return E(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,a){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,a);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,a){var i,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(a){var l=-1;for(i=n;i<s;i++)if(c(e,i)===c(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===u)return l*o}else-1!==l&&(i-=i-l),l=-1}else for(n+u>s&&(n=s-u),i=n;i>=0;i--){for(var h=!0,f=0;f<u;f++)if(c(e,i+f)!==c(t,f)){h=!1;break}if(h)return i}return-1}function _(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function b(e,t,n,r){return q(j(t,e.length-n),e,n,r)}function k(e,t,n,r){return q(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function w(e,t,n,r){return k(e,t,n,r)}function x(e,t,n,r){return q(V(t),e,n,r)}function C(e,t,n,r){return q(function(e,t){for(var n,r,a=[],i=0;i<e.length&&!((t-=2)<0);++i)r=(n=e.charCodeAt(i))>>8,a.push(n%256),a.push(r);return a}(t,e.length-n),e,n,r)}function S(e,t,n){return r.fromByteArray(0===t&&n===e.length?e:e.slice(t,n))}function T(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var i,o,s,u,c=e[a],l=null,h=c>239?4:c>223?3:c>191?2:1;if(a+h<=n)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(i=e[a+1]))&&(u=(31&c)<<6|63&i)>127&&(l=u);break;case 3:o=e[a+2],128==(192&(i=e[a+1]))&&128==(192&o)&&(u=(15&c)<<12|(63&i)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[a+2],s=e[a+3],128==(192&(i=e[a+1]))&&128==(192&o)&&128==(192&s)&&(u=(15&c)<<18|(63&i)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(r.push((l-=65536)>>>10&1023|55296),l=56320|1023&l),r.push(l),a+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}function A(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function I(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",i=t;i<n;++i)a+=B(e[i]);return a}function R(e,t,n){for(var r=e.slice(t,n),a="",i=0;i<r.length;i+=2)a+=String.fromCharCode(r[i]+256*r[i+1]);return a}function O(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,n,r,a,i){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function D(e,t,n,r){t<0&&(t=65535+t+1);for(var a=0,i=Math.min(e.length-n,2);a<i;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function P(e,t,n,r){t<0&&(t=4294967295+t+1);for(var a=0,i=Math.min(e.length-n,4);a<i;++a)e[n+a]=t>>>8*(r?a:3-a)&255}function F(e,t,n,r,a,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(e,t,n,r,i){return i||F(e,0,n,4),a.write(e,t,n,r,23,4),n+4}function L(e,t,n,r,i){return i||F(e,0,n,8),a.write(e,t,n,r,52,8),n+8}t.Buffer=u,t.SlowBuffer=function(e){return+e!=e&&(e=0),u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"==typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return h(null,e)},u.allocUnsafeSlow=function(e){return h(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,i=Math.min(n,r);a<i;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var o=e[n];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,a),a+=o.length}return r},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?T(this,0,e):m.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,a){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(a>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(i,o),c=this.slice(r,a),l=e.slice(t,n),h=0;h<s;++h)if(c[h]!==l[h]){i=c[h],o=l[h];break}return i<o?-1:o<i?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return _(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return k(this,e,t,n);case"latin1":case"binary":return w(this,e,t,n);case"base64":return x(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var a=t-e;n=new u(a,void 0);for(var i=0;i<a;++i)n[i]=this[i+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},u.prototype.readUInt8=function(e,t){return t||O(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||O(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||O(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=t,a=1,i=this[e+--r];r>0&&(a*=256);)i+=this[e+--r]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},u.prototype.readInt8=function(e,t){return t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||O(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||O(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||O(e,4,this.length),a.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||O(e,4,this.length),a.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||O(e,8,this.length),a.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||O(e,8,this.length),a.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||N(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,i=0;for(this[t]=255&e;++i<n&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||N(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,i=1;for(this[t+a]=255&e;--a>=0&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):P(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);N(this,e,t,n,a-1,-a)}var i=0,o=1,s=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);N(this,e,t,n,a-1,-a)}var i=n-1,o=1,s=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):P(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):P(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return M(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return M(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return L(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return L(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a,i=r-n;if(this===e&&n<t&&t<r)for(a=i-1;a>=0;--a)e[a+t]=this[a+n];else if(i<1e3||!u.TYPED_ARRAY_SUPPORT)for(a=0;a<i;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},u.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var o=u.isBuffer(e)?e:j(new u(e,r).toString()),s=o.length;for(i=0;i<n-t;++i)this[i+t]=o[i%s]}return this};var z=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function j(e,t){var n;t=t||1/0;for(var r=e.length,a=null,i=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function V(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(z,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}}).call(this,n(21))},function(e,t,n){"use strict";var r=n(81);function a(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}e.exports=function(e){var t=new a;t.pre=e.pre,t.body=e.body,t.post=e.post;var n=e.args.slice(0);t.argTypes=n;for(var i=0;i<n.length;++i){var o=n[i];if("array"===o||"object"==typeof o&&o.blockIndices){if(t.argTypes[i]="array",t.arrayArgs.push(i),t.arrayBlockIndices.push(o.blockIndices?o.blockIndices:0),t.shimArgs.push("array"+i),i<t.pre.args.length&&t.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array args");if(i<t.post.args.length&&t.post.args[i].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===o)t.scalarArgs.push(i),t.shimArgs.push("scalar"+i);else if("index"===o){if(t.indexArgs.push(i),i<t.pre.args.length&&t.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array index");if(i<t.body.args.length&&t.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array index");if(i<t.post.args.length&&t.post.args[i].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===o){if(t.shapeArgs.push(i),i<t.pre.args.length&&t.pre.args[i].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(i<t.body.args.length&&t.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array shape");if(i<t.post.args.length&&t.post.args[i].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof o||!o.offset)throw new Error("cwise: Unknown argument type "+n[i]);t.argTypes[i]="offset",t.offsetArgs.push({array:o.array,offset:o.offset}),t.offsetArgIndex.push(i)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>n.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>n.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>n.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,r(t)}},function(e,t,n){"use strict";e.exports=function(e,t,n){return 0===e.length?e:t?(n||e.sort(t),function(e,t){for(var n=1,r=e.length,a=e[0],i=e[0],o=1;o<r;++o)if(i=a,t(a=e[o],i)){if(o===n){n++;continue}e[n++]=a}return e.length=n,e}(e,t)):(n||e.sort(),function(e){for(var t=1,n=e.length,r=e[0],a=e[0],i=1;i<n;++i,a=r)if(a=r,(r=e[i])!==a){if(i===t){t++;continue}e[t++]=r}return e.length=t,e}(e))}},function(e,t,n){"use strict";(function(e){var r=n(68),a=n(83),i=n(64).Buffer;e.__TYPEDARRAY_POOL||(e.__TYPEDARRAY_POOL={UINT8:a([32,0]),UINT16:a([32,0]),UINT32:a([32,0]),BIGUINT64:a([32,0]),INT8:a([32,0]),INT16:a([32,0]),INT32:a([32,0]),BIGINT64:a([32,0]),FLOAT:a([32,0]),DOUBLE:a([32,0]),DATA:a([32,0]),UINT8C:a([32,0]),BUFFER:a([32,0])});var o="undefined"!=typeof Uint8ClampedArray,s="undefined"!=typeof BigUint64Array,u="undefined"!=typeof BigInt64Array,c=e.__TYPEDARRAY_POOL;c.UINT8C||(c.UINT8C=a([32,0])),c.BIGUINT64||(c.BIGUINT64=a([32,0])),c.BIGINT64||(c.BIGINT64=a([32,0])),c.BUFFER||(c.BUFFER=a([32,0]));var l=c.DATA,h=c.BUFFER;function f(e){if(e){var t=r.log2(e.length||e.byteLength);l[t].push(e)}}function d(e){e=r.nextPow2(e);var t=r.log2(e),n=l[t];return n.length>0?n.pop():new ArrayBuffer(e)}function p(e){return new Uint8Array(d(e),0,e)}function m(e){return new Uint16Array(d(2*e),0,e)}function v(e){return new Uint32Array(d(4*e),0,e)}function g(e){return new Int8Array(d(e),0,e)}function y(e){return new Int16Array(d(2*e),0,e)}function _(e){return new Int32Array(d(4*e),0,e)}function b(e){return new Float32Array(d(4*e),0,e)}function k(e){return new Float64Array(d(8*e),0,e)}function w(e){return o?new Uint8ClampedArray(d(e),0,e):p(e)}function x(e){return s?new BigUint64Array(d(8*e),0,e):null}function C(e){return u?new BigInt64Array(d(8*e),0,e):null}function S(e){return new DataView(d(e),0,e)}function T(e){e=r.nextPow2(e);var t=r.log2(e),n=h[t];return n.length>0?n.pop():new i(e)}t.free=function(e){if(i.isBuffer(e))h[r.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=0|r.log2(e.length||e.byteLength);l[t].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeBigUint64=t.freeInt8=t.freeInt16=t.freeInt32=t.freeBigInt64=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){f(e.buffer)},t.freeArrayBuffer=f,t.freeBuffer=function(e){h[r.log2(e.length)].push(e)},t.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return d(e);switch(t){case"uint8":return p(e);case"uint16":return m(e);case"uint32":return v(e);case"int8":return g(e);case"int16":return y(e);case"int32":return _(e);case"float":case"float32":return b(e);case"double":case"float64":return k(e);case"uint8_clamped":return w(e);case"bigint64":return C(e);case"biguint64":return x(e);case"buffer":return T(e);case"data":case"dataview":return S(e);default:return null}return null},t.mallocArrayBuffer=d,t.mallocUint8=p,t.mallocUint16=m,t.mallocUint32=v,t.mallocInt8=g,t.mallocInt16=y,t.mallocInt32=_,t.mallocFloat32=t.mallocFloat=b,t.mallocFloat64=t.mallocDouble=k,t.mallocUint8Clamped=w,t.mallocBigUint64=x,t.mallocBigInt64=C,t.mallocDataView=S,t.mallocBuffer=T,t.clearCache=function(){for(var e=0;e<32;++e)c.UINT8[e].length=0,c.UINT16[e].length=0,c.UINT32[e].length=0,c.INT8[e].length=0,c.INT16[e].length=0,c.INT32[e].length=0,c.FLOAT[e].length=0,c.DOUBLE[e].length=0,c.BIGUINT64[e].length=0,c.BIGINT64[e].length=0,c.UINT8C[e].length=0,l[e].length=0,h[e].length=0}}).call(this,n(21))},function(e,t,n){"use strict";function r(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(e){return(e>0)-(e<0)},t.abs=function(e){var t=e>>31;return(e^t)-t},t.min=function(e,t){return t^(e^t)&-(e<t)},t.max=function(e,t){return e^(e^t)&-(e<t)},t.isPow2=function(e){return!(e&e-1||!e)},t.log2=function(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1},t.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},t.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},t.countTrailingZeros=r,t.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,1+((e|=e>>>8)|e>>>16)},t.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var a=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,r=t,a=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--a;e[t]=r<<a&255}}(a),t.reverse=function(e){return a[255&e]<<24|a[e>>>8&255]<<16|a[e>>>16&255]<<8|a[e>>>24&255]},t.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},t.interleave3=function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},t.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},t.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>r(e)+1}},function(e){e.exports=JSON.parse('{"chromatic":["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],"lydian":["1P 2M 3M 4A 5P 6M 7M"],"major":["1P 2M 3M 4P 5P 6M 7M",["ionian"]],"mixolydian":["1P 2M 3M 4P 5P 6M 7m",["dominant"]],"dorian":["1P 2M 3m 4P 5P 6M 7m"],"aeolian":["1P 2M 3m 4P 5P 6m 7m",["minor"]],"phrygian":["1P 2m 3m 4P 5P 6m 7m"],"locrian":["1P 2m 3m 4P 5d 6m 7m"],"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m",["half-diminished"]],"altered":["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"phrygian dominant":["1P 2m 3M 4P 5P 6m 7m",["spanish","phrygian major"]],"half-whole diminished":["1P 2m 3m 3M 4A 5P 6M 7m",["dominant diminished"]],"diminished":["1P 2M 3m 4P 5d 6m 6M 7M",["whole-half diminished"]],"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],"iwato":["1P 2m 4P 5d 7m"],"hirajoshi":["1P 2M 3m 5P 6m"],"kumoijoshi":["1P 2m 4P 5P 6m"],"pelog":["1P 2m 3m 5P 6m"],"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],"prometheus":["1P 2M 3M 4A 6M 7m"],"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],"ritusen":["1P 2M 4P 5P 6M"],"scriabin":["1P 2m 3M 5P 6M"],"piongio":["1P 2M 4P 5P 6M 7m"],"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],"augmented":["1P 2A 3M 5P 5A 7M"],"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],"neopolitan":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],"egyptian":["1P 2M 4P 5P 7m"],"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],"oriental":["1P 2m 3M 4P 5d 6M 7m"],"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],"flamenco":["1P 2m 3m 3M 4A 5P 7m"],"balinese":["1P 2m 3m 4P 5P 6m 7M"],"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],"persian":["1P 2m 3M 4P 5d 6m 7M"],"bebop":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],"enigmatic":["1P 2m 3M 5d 6m 7m 7M"],"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],"ichikosucho":["1P 2M 3M 4P 5d 5P 6M 7M"],"six tone symmetric":["1P 2m 3M 4P 5A 6M"]}')},function(e){e.exports=JSON.parse('{"4":["1P 4P 7m 10m",["quartal"]],"5":["1P 5P"],"7":["1P 3M 5P 7m",["Dominant","Dom"]],"9":["1P 3M 5P 7m 9M",["79"]],"11":["1P 5P 7m 9M 11P"],"13":["1P 3M 5P 7m 9M 13M",["13_"]],"64":["5P 8P 10M"],"M":["1P 3M 5P",["Major",""]],"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],"M13":["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],"M6":["1P 3M 5P 13M",["6"]],"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],"M69":["1P 3M 5P 6M 9M",["69"]],"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],"M7add13":["1P 3M 5P 6M 7M 9M"],"M7b5":["1P 3M 5d 7M"],"M7b6":["1P 3M 6m 7M"],"M7b9":["1P 3M 5P 7M 9m"],"M7sus4":["1P 4P 5P 7M"],"M9":["1P 3M 5P 7M 9M",["maj9","Maj9"]],"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],"M9b5":["1P 3M 5d 7M 9M"],"M9sus4":["1P 4P 5P 7M 9M"],"Madd9":["1P 3M 5P 9M",["2","add9","add2"]],"Maj7":["1P 3M 5P 7M",["maj7","M7"]],"Mb5":["1P 3M 5d"],"Mb6":["1P 3M 13m"],"Msus2":["1P 2M 5P",["add9no3","sus2"]],"Msus4":["1P 4P 5P",["sus","sus4"]],"Maddb9":["1P 3M 5P 9m"],"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],"m":["1P 3m 5P"],"m#5":["1P 3m 5A",["m+","mb6"]],"m11":["1P 3m 5P 7m 9M 11P",["_11"]],"m11A 5":["1P 3m 6m 7m 9M 11P"],"m11b5":["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],"m13":["1P 3m 5P 7m 9M 11P 13M",["_13"]],"m6":["1P 3m 4P 5P 13M",["_6"]],"m69":["1P 3m 5P 6M 9M",["_69"]],"m7":["1P 3m 5P 7m",["minor7","_","_7"]],"m7#5":["1P 3m 6m 7m"],"m7add11":["1P 3m 5P 7m 11P",["m7add4"]],"m7b5":["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],"m9":["1P 3m 5P 7m 9M",["_9"]],"m9#5":["1P 3m 6m 7m 9M"],"m9b5":["1P 3m 7m 12d 2M",["h9","-9b5"]],"mMaj7":["1P 3m 5P 7M",["mM7","_M7"]],"mMaj7b6":["1P 3m 5P 6m 7M",["mM7b6"]],"mM9":["1P 3m 5P 7M 9M",["mMaj9","-M9"]],"mM9b6":["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],"mb6M7":["1P 3m 6m 7M"],"mb6b9":["1P 3m 6m 9m"],"o":["1P 3m 5d",["mb5","dim"]],"o7":["1P 3m 5d 13M",["diminished","m6b5","dim7"]],"o7M7":["1P 3m 5d 6M 7M"],"oM7":["1P 3m 5d 7M"],"sus24":["1P 2M 4P 5P",["sus4add9"]],"+add#9":["1P 3M 5A 9A"],"madd4":["1P 3m 4P 5P"],"madd9":["1P 3m 5P 9M"]}')},function(e,t,n){"use strict";var r=n(80),a=n(85),i=n(45),o=n(86)({args:["array","array","scalar","scalar","scalar"],body:function(e,t,n,r,a){var i=t*n;i<r&&(i=r),i>a&&(i=a)}});e.exports=function(e,t,n,s){void 0===n&&(n=-1/0),void 0===s&&(s=1/0);var u=t.shape,c=e.shape;if(t.shape.length!==e.shape.length)throw new Error("ndarray-resample: input and output arrays should have the same dimensions");var l,h=u.map((function(){return 0}));if(1===e.size)return(l=i.sum(t)/t.size)<n&&(l=n),l>s&&(l=s),void e.set.apply(e,h.concat(l));if(1===t.size)return(l=t.get.apply(t,h))<n&&(l=n),l>s&&(l=s),void i.assigns(e,l);for(var f=u.length,d=new Array(f),p=!1,m=0;m<f;m++)d[m]=Math.min(c[m],u[m]),c[m]>u[m]&&(p=!0);var v=a.malloc(u),g=a.malloc(u);i.assign(v,t),i.assigns(g,0),r(1,v,g);var y=v.lo,_=v.hi,b=a.malloc(c),k=a.malloc(c);p&&(i.assigns(b,0),i.assigns(k,0));var w=new Array(f),x=new Array(f),C=new Array(f),S=new Array(f);for(m=0;m<1<<f;++m){for(var T=0;T<f;++T)if(m&1<<T){if(w[T]=d[T]-(d[T]+1>>>1),0===w[T])continue;x[T]=c[T]-w[T],C[T]=u[T]-w[T],S[T]=1&d[T]?0:1}else w[T]=d[T]+1>>>1,x[T]=0,C[T]=0,S[T]=0;i.assign(_.apply(y.apply(b,x),w),_.apply(y.apply(v,C),w)),i.assign(y.apply(_.apply(y.apply(k,x),w),S),y.apply(_.apply(y.apply(g,C),w),S)),i.assigns(_.apply(_.apply(y.apply(k,x),w),S),0)}r(-1,b,k),o(e,b,e.size/t.size,n,s),a.free(v),a.free(g),a.free(b),a.free(k)}},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[1];return 3*(t[0]+n)/4-n},t.toByteArray=function(e){var t,n,r=c(e),o=r[0],s=r[1],u=new i(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,h=s>0?o-4:o;for(n=0;n<h;n+=4)t=a[e.charCodeAt(n)]<<18|a[e.charCodeAt(n+1)]<<12|a[e.charCodeAt(n+2)]<<6|a[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;return 2===s&&(t=a[e.charCodeAt(n)]<<2|a[e.charCodeAt(n+1)]>>4,u[l++]=255&t),1===s&&(t=a[e.charCodeAt(n)]<<10|a[e.charCodeAt(n+1)]<<4|a[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,a=n%3,i=[],o=0,s=n-a;o<s;o+=16383)i.push(l(e,o,o+16383>s?s:o+16383));return 1===a?i.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===a&&i.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),i.join("")};for(var r=[],a=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)r[s]=o[s],a[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var a,i=[],o=t;o<n;o+=3)i.push(r[(a=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]))>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return i.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,a){var i,o,s=8*a-r-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?a-1:0,f=n?-1:1,d=e[t+h];for(h+=f,i=d&(1<<-l)-1,d>>=-l,l+=s;l>0;i=256*i+e[t+h],h+=f,l-=8);for(o=i&(1<<-l)-1,i>>=-l,l+=r;l>0;o=256*o+e[t+h],h+=f,l-=8);if(0===i)i=1-c;else{if(i===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),i-=c}return(d?-1:1)*o*Math.pow(2,i-r)},t.write=function(e,t,n,r,a,i){var o,s,u,c=8*i-a-1,l=(1<<c)-1,h=l>>1,f=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:i-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=l?(s=0,o=l):o+h>=1?(s=(t*u-1)*Math.pow(2,a),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,a),o=0));a>=8;e[n+d]=255&s,d+=p,s/=256,a-=8);for(o=o<<a|s,c+=a;c>0;e[n+d]=255&o,d+=p,o/=256,c-=8);e[n+d-p]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var r="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:void 0!==e?e:function(e){return e()};function a(){return new Promise((function(e){return r((function(){return e()}))}))}}).call(this,n(169).setImmediate)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(90),a=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var i=function(){function e(e){var n=this;this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",a.set(this,480),e&&(a.set(this,e.header.ticksPerBeat),e.tracks.forEach((function(e){return e.forEach((function(e){e.meta&&("timeSignature"===e.type?n.timeSignatures.push({ticks:e.absoluteTime,timeSignature:[e.numerator,e.denominator]}):"setTempo"===e.type?n.tempos.push({bpm:6e7/e.microsecondsPerBeat,ticks:e.absoluteTime}):"keySignature"===e.type&&n.keySignatures.push({key:t.keySignatureKeys[e.key+7],scale:0===e.scale?"major":"minor",ticks:e.absoluteTime}))}))})),e.tracks[0].forEach((function(e){e.meta&&("trackName"===e.type?n.name=e.text:"text"!==e.type&&"cuePoint"!==e.type&&"marker"!==e.type&&"lyrics"!==e.type||n.meta.push({text:e.text,ticks:e.absoluteTime,type:e.type}))})),this.update())}return e.prototype.update=function(){var e=this,t=0,n=0;this.tempos.sort((function(e,t){return e.ticks-t.ticks})),this.tempos.forEach((function(r,a){var i=r.ticks/e.ppq-n;r.time=60/(a>0?e.tempos[a-1].bpm:e.tempos[0].bpm)*i+t,t=r.time,n+=i})),this.timeSignatures.sort((function(e,t){return e.ticks-t.ticks})),this.timeSignatures.forEach((function(t,n){var r=n>0?e.timeSignatures[n-1]:e.timeSignatures[0],a=(t.ticks-r.ticks)/e.ppq/r.timeSignature[0]/(r.timeSignature[1]/4);r.measures=r.measures||0,t.measures=a+r.measures}))},e.prototype.ticksToSeconds=function(e){var t=r.search(this.tempos,e);if(-1!==t){var n=this.tempos[t];return n.time+60/n.bpm*((e-n.ticks)/this.ppq)}return e/this.ppq*.5},e.prototype.ticksToMeasures=function(e){var t=r.search(this.timeSignatures,e);if(-1!==t){var n=this.timeSignatures[t];return n.measures+(e-n.ticks)/this.ppq/(n.timeSignature[0]/n.timeSignature[1])/4}return e/this.ppq/4},Object.defineProperty(e.prototype,"ppq",{get:function(){return a.get(this)},enumerable:!0,configurable:!0}),e.prototype.secondsToTicks=function(e){var t=r.search(this.tempos,e,"time");if(-1!==t){var n=this.tempos[t];return Math.round(n.ticks+(e-n.time)/(60/n.bpm)*this.ppq)}return Math.round(e/.5*this.ppq)},e.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map((function(e){return{bpm:e.bpm,ticks:e.ticks}})),timeSignatures:this.timeSignatures}},e.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map((function(e){return Object.assign({},e)})),this.timeSignatures=e.timeSignatures.map((function(e){return Object.assign({},e)})),this.keySignatures=e.keySignatures.map((function(e){return Object.assign({},e)})),this.meta=e.meta.map((function(e){return Object.assign({},e)})),a.set(this,e.ppq),this.update()},e.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},e}();t.Header=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(89),o=n(183),s=n(76),u=n(91),c=function(){function e(e){var t=this,n=null;e&&(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(n=i.parseMidi(e)).tracks.forEach((function(e){var t=0;e.forEach((function(e){e.absoluteTime=t+=e.deltaTime}))})),n.tracks=function(e){for(var t=[],n=0;n<e.length;n++)for(var r=t.length,a=new Map,i=Array(16).fill(0),o=0,s=e[n];o<s.length;o++){var u=s[o],c=r,l=u.channel;if(void 0!==l){"programChange"===u.type&&(i[l]=u.programNumber);var h=i[l]+" "+l;a.has(h)?c=a.get(h):a.set(h,c=r+a.size)}t[c]||t.push([]),t[c].push(u)}return t}(n.tracks)),this.header=new s.Header(n),this.tracks=[],e&&(this.tracks=n.tracks.map((function(e){return new u.Track(e,t.header)})),1===n.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return e.fromUrl=function(t){return r(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,fetch(t)];case 1:return(n=r.sent()).ok?[4,n.arrayBuffer()]:[3,3];case 2:return[2,new e(r.sent())];case 3:throw new Error("could not load "+t)}}))}))},Object.defineProperty(e.prototype,"name",{get:function(){return this.header.name},set:function(e){this.header.name=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=this.tracks.map((function(e){return e.duration}));return Math.max.apply(Math,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var e=this.tracks.map((function(e){return e.durationTicks}));return Math.max.apply(Math,e)},enumerable:!0,configurable:!0}),e.prototype.addTrack=function(){var e=new u.Track(void 0,this.header);return this.tracks.push(e),e},e.prototype.toArray=function(){return o.encode(this)},e.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map((function(e){return e.toJSON()}))}},e.prototype.fromJSON=function(e){var t=this;this.header=new s.Header,this.header.fromJSON(e.header),this.tracks=e.tracks.map((function(e){var n=new u.Track(void 0,t.header);return n.fromJSON(e),n}))},e.prototype.clone=function(){var t=new e;return t.fromJSON(this.toJSON()),t},e}();t.Midi=c;var l=n(91);t.Track=l.Track;var h=n(76);t.Header=h.Header},function(e,t,n){"use strict";e.exports=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t}},function(e,t){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,n){"use strict";var r=n(45),a=n(30),i=n(67),o=n(84);e.exports=function(e,t,n){var s,u,c=t.shape,l=c.length,h=1,f=new Array(l),d=0;for(s=l-1;s>=0;--s)if(f[s]=h,h*=c[s],d=Math.max(d,o.scratchMemory(c[s])),t.shape[s]!==n.shape[s])throw new Error("Shape mismatch, real and imaginary arrays must have same size");var p,m=4*h+d;p="array"===t.dtype||"float64"===t.dtype||"custom"===t.dtype?i.mallocDouble(m):i.mallocFloat(m);var v,g,y,_,b=a(p,c.slice(0),f,0),k=a(p,c.slice(0),f.slice(0),h),w=a(p,c.slice(0),f.slice(0),2*h),x=a(p,c.slice(0),f.slice(0),3*h),C=4*h;for(r.assign(b,t),r.assign(k,n),s=l-1;s>=0&&(o(e,h/c[s],c[s],p,b.offset,k.offset,C),0!==s);--s){for(g=1,y=w.stride,_=x.stride,u=s-1;u<l;++u)_[u]=y[u]=g,g*=c[u];for(u=s-2;u>=0;--u)_[u]=y[u]=g,g*=c[u];r.assign(w,b),r.assign(x,k),v=b,b=w,w=v,v=k,k=x,x=v}r.assign(t,b),r.assign(n,k),i.free(p)}},function(e,t,n){"use strict";var r=n(82);e.exports=function(e){var t=["'use strict'","var CACHED={}"],n=[];t.push(["return function ",e.funcName+"_cwise_thunk","(",e.shimArgs.join(","),"){"].join(""));for(var a=[],i=[],o=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],s=[],u=[],c=0;c<e.arrayArgs.length;++c){var l=e.arrayArgs[c];n.push(["t",l,"=array",l,".dtype,","r",l,"=array",l,".order"].join("")),a.push("t"+l),a.push("r"+l),i.push("t"+l),i.push("r"+l+".join()"),o.push("array"+l+".data"),o.push("array"+l+".stride"),o.push("array"+l+".offset|0"),c>0&&(s.push("array"+e.arrayArgs[0]+".shape.length===array"+l+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[c]))),u.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+l+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[c])+"]"))}for(e.arrayArgs.length>1&&(t.push("if (!("+s.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),c=0;c<e.scalarArgs.length;++c)o.push("scalar"+e.scalarArgs[c]);return n.push(["type=[",i.join(","),"].join()"].join("")),n.push("proc=CACHED[type]"),t.push("var "+n.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",a.join(","),"])}","return proc(",o.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(r.bind(void 0,e))}},function(e,t,n){"use strict";var r=n(66);function a(e,t,n){var r,a,i=e.length,o=t.arrayArgs.length,s=t.indexArgs.length>0,u=[],c=[],l=0,h=0;for(r=0;r<i;++r)c.push(["i",r,"=0"].join(""));for(a=0;a<o;++a)for(r=0;r<i;++r)h=l,l=e[r],c.push(0===r?["d",a,"s",r,"=t",a,"p",l].join(""):["d",a,"s",r,"=(t",a,"p",l,"-s",h,"*t",a,"p",h,")"].join(""));for(c.length>0&&u.push("var "+c.join(",")),r=i-1;r>=0;--r)u.push(["for(i",r,"=0;i",r,"<s",l=e[r],";++i",r,"){"].join(""));for(u.push(n),r=0;r<i;++r){for(h=l,l=e[r],a=0;a<o;++a)u.push(["p",a,"+=d",a,"s",r].join(""));s&&(r>0&&u.push(["index[",h,"]-=s",h].join("")),u.push(["++index[",l,"]"].join(""))),u.push("}")}return u.join("\n")}function i(e,t,n){for(var r=e.body,a=[],i=[],o=0;o<e.args.length;++o){var s=e.args[o];if(!(s.count<=0)){var u=new RegExp(s.name,"g"),c="",l=t.arrayArgs.indexOf(o);switch(t.argTypes[o]){case"offset":var h=t.offsetArgIndex.indexOf(o);l=t.offsetArgs[h].array,c="+q"+h;case"array":c="p"+l+c;var f="l"+o,d="a"+l;if(0===t.arrayBlockIndices[l])1===s.count?"generic"===n[l]?s.lvalue?(a.push(["var ",f,"=",d,".get(",c,")"].join("")),r=r.replace(u,f),i.push([d,".set(",c,",",f,")"].join(""))):r=r.replace(u,[d,".get(",c,")"].join("")):r=r.replace(u,[d,"[",c,"]"].join("")):"generic"===n[l]?(a.push(["var ",f,"=",d,".get(",c,")"].join("")),r=r.replace(u,f),s.lvalue&&i.push([d,".set(",c,",",f,")"].join(""))):(a.push(["var ",f,"=",d,"[",c,"]"].join("")),r=r.replace(u,f),s.lvalue&&i.push([d,"[",c,"]=",f].join("")));else{for(var p=[s.name],m=[c],v=0;v<Math.abs(t.arrayBlockIndices[l]);v++)p.push("\\s*\\[([^\\]]+)\\]"),m.push("$"+(v+1)+"*t"+l+"b"+v);if(u=new RegExp(p.join(""),"g"),c=m.join("+"),"generic"===n[l])throw new Error("cwise: Generic arrays not supported in combination with blocks!");r=r.replace(u,[d,"[",c,"]"].join(""))}break;case"scalar":r=r.replace(u,"Y"+t.scalarArgs.indexOf(o));break;case"index":r=r.replace(u,"index");break;case"shape":r=r.replace(u,"shape")}}}return[a.join("\n"),r,i.join("\n")].join("\n").trim()}function o(e){for(var t=new Array(e.length),n=!0,r=0;r<e.length;++r){var a=e[r],i=a.match(/\d+/);i=i?i[0]:"",t[r]=0===a.charAt(0)?"u"+a.charAt(1)+i:a.charAt(0)+i,r>0&&(n=n&&t[r]===t[r-1])}return n?t[0]:t.join("")}e.exports=function(e,t){for(var n=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,s=new Array(e.arrayArgs.length),u=new Array(e.arrayArgs.length),c=0;c<e.arrayArgs.length;++c)u[c]=t[2*c],s[c]=t[2*c+1];var l=[],h=[],f=[],d=[],p=[];for(c=0;c<e.arrayArgs.length;++c){e.arrayBlockIndices[c]<0?(f.push(0),d.push(n),l.push(n),h.push(n+e.arrayBlockIndices[c])):(f.push(e.arrayBlockIndices[c]),d.push(e.arrayBlockIndices[c]+n),l.push(0),h.push(e.arrayBlockIndices[c]));for(var m=[],v=0;v<s[c].length;v++)f[c]<=s[c][v]&&s[c][v]<d[c]&&m.push(s[c][v]-f[c]);p.push(m)}var g=["SS"],y=["'use strict'"],_=[];for(v=0;v<n;++v)_.push(["s",v,"=SS[",v,"]"].join(""));for(c=0;c<e.arrayArgs.length;++c){for(g.push("a"+c),g.push("t"+c),g.push("p"+c),v=0;v<n;++v)_.push(["t",c,"p",v,"=t",c,"[",f[c]+v,"]"].join(""));for(v=0;v<Math.abs(e.arrayBlockIndices[c]);++v)_.push(["t",c,"b",v,"=t",c,"[",l[c]+v,"]"].join(""))}for(c=0;c<e.scalarArgs.length;++c)g.push("Y"+c);if(e.shapeArgs.length>0&&_.push("shape=SS.slice(0)"),e.indexArgs.length>0){var b=new Array(n);for(c=0;c<n;++c)b[c]="0";_.push(["index=[",b.join(","),"]"].join(""))}for(c=0;c<e.offsetArgs.length;++c){var k=e.offsetArgs[c],w=[];for(v=0;v<k.offset.length;++v)0!==k.offset[v]&&w.push(1===k.offset[v]?["t",k.array,"p",v].join(""):[k.offset[v],"*t",k.array,"p",v].join(""));_.push(0===w.length?"q"+c+"=0":["q",c,"=",w.join("+")].join(""))}var x=r([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((_=_.concat(x)).length>0&&y.push("var "+_.join(",")),c=0;c<e.arrayArgs.length;++c)y.push("p"+c+"|=0");e.pre.body.length>3&&y.push(i(e.pre,e,u));var C=i(e.body,e,u),S=function(e){for(var t=0,n=e[0].length;t<n;){for(var r=1;r<e.length;++r)if(e[r][t]!==e[0][t])return t;++t}return t}(p);y.push(S<n?function(e,t,n,r){for(var i=t.length,o=n.arrayArgs.length,s=n.blockSize,u=n.indexArgs.length>0,c=[],l=0;l<o;++l)c.push(["var offset",l,"=p",l].join(""));for(l=e;l<i;++l)c.push(["for(var j"+l+"=SS[",t[l],"]|0;j",l,">0;){"].join("")),c.push(["if(j",l,"<",s,"){"].join("")),c.push(["s",t[l],"=j",l].join("")),c.push(["j",l,"=0"].join("")),c.push(["}else{s",t[l],"=",s].join("")),c.push(["j",l,"-=",s,"}"].join("")),u&&c.push(["index[",t[l],"]=j",l].join(""));for(l=0;l<o;++l){for(var h=["offset"+l],f=e;f<i;++f)h.push(["j",f,"*t",l,"p",t[f]].join(""));c.push(["p",l,"=(",h.join("+"),")"].join(""))}for(c.push(a(t,n,r)),l=e;l<i;++l)c.push("}");return c.join("\n")}(S,p[0],e,C):a(p[0],e,C)),e.post.body.length>3&&y.push(i(e.post,e,u)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+y.join("\n")+"\n----------");var T=[e.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",S,o(u)].join("");return new Function(["function ",T,"(",g.join(","),"){",y.join("\n"),"} return ",T].join(""))()}},function(e,t,n){"use strict";e.exports=function(e,t){switch(void 0===t&&(t=0),typeof e){case"number":if(e>0)return function(e,t){var n,r;for(n=new Array(e),r=0;r<e;++r)n[r]=t;return n}(0|e,t);break;case"object":if("number"==typeof e.length)return function e(t,n,r){var a=0|t[r];if(a<=0)return[];var i,o=new Array(a);if(r===t.length-1)for(i=0;i<a;++i)o[i]=n;else for(i=0;i<a;++i)o[i]=e(t,n,r+1);return o}(e,t,0)}return[]}},function(e,t,n){var r=n(68);function a(e,t,n,a,i,o){var s,u,c,l,h,f,d,p,m,v,g,y,_,b,k,w,x,C,S,T,A,E,I;for(e|=0,t|=0,i|=0,o|=0,s=n|=0,u=r.log2(s),C=0;C<t;++C){for(d=s>>1,h=0,c=0;c<s-1;c++){for(c<h&&(_=a[i+c],a[i+c]=a[i+h],a[i+h]=_,_=a[o+c],a[o+c]=a[o+h],a[o+h]=_),f=d;f<=h;)h-=f,f>>=1;h+=f}for(g=-1,y=0,v=1,p=0;p<u;p++){for(m=v,v<<=1,w=1,x=0,h=0;h<m;h++){for(c=h;c<s;c+=v)S=a[i+(l=c+m)],A=a[o+c],b=(E=w*(S+(T=a[o+l])))-T*(w+x),k=E+(I=S*(x-w)),a[i+l]=a[i+c]-b,a[o+l]=A-k,a[i+c]+=b,a[o+c]+=k;I=w*(y-g),w=(E=g*(w+x))-x*(g+y),x=E+I}y=Math.sqrt((1-g)/2),e<0&&(y=-y),g=Math.sqrt((1+g)/2)}if(e<0){var R=1/s;for(c=0;c<s;c++)a[i+c]*=R,a[o+c]*=R}i+=n,o+=n}}e.exports=function(e,t,n,i,o,s,u){e|=0,t|=0,o|=0,s|=0,r.isPow2(n|=0)?a(e,t,n,i,o,s):function(e,t,n,i,o,s,u){e|=0,t|=0,o|=0,s|=0,u|=0;var c,l,h,f,d,p,m,v,g=r.nextPow2(2*(n|=0)+1),y=u,_=y+n,b=_+n,k=b+g,w=k+g,x=w+g,C=-e*Math.PI/n;for(v=0;v<n;++v)l=C*(v*v%(2*n)),f=Math.cos(l),d=Math.sin(l),i[w+(g-v)]=i[w+v]=i[y+v]=f,i[x+(g-v)]=i[x+v]=i[_+v]=d;for(v=n;v<=g-n;++v)i[w+v]=0;for(v=n;v<=g-n;++v)i[x+v]=0;for(a(1,1,g,i,w,x),C=e<0?1/n:1,c=0;c<t;++c){for(v=0;v<n;++v)m=(l=i[o+v])*((d=-i[_+v])-(f=i[y+v])),i[b+v]=(p=f*(l+(h=i[s+v])))-h*(f+d),i[k+v]=p+m;for(v=n;v<g;++v)i[b+v]=0;for(v=n;v<g;++v)i[k+v]=0;for(a(1,1,g,i,b,k),v=0;v<g;++v)m=(l=i[b+v])*((d=i[x+v])-(f=i[w+v])),i[b+v]=(p=f*(l+(h=i[k+v])))-h*(f+d),i[k+v]=p+m;for(a(-1,1,g,i,b,k),v=0;v<n;++v)m=(l=i[b+v])*((d=-i[_+v])-(f=i[y+v])),i[o+v]=C*((p=f*(l+(h=i[k+v])))-h*(f+d)),i[s+v]=C*(p+m);o+=n,s+=n}}(e,t,n,i,o,s,u)},e.exports.scratchMemory=function(e){return r.isPow2(e)?0:2*e+4*r.nextPow2(2*e+1)}},function(e,t,n){"use strict";var r=n(30),a=n(45),i=n(67);t.clone=function(e){var t=e.dtype;"generic"!==t&&"array"!==t||(t="double");var n=i.malloc(e.size,t),o=r(n,e.shape);return a.assign(o,e),o},t.malloc=function(e,t){t||(t="double");for(var n=1,a=new Array(e.length),o=e.length-1;o>=0;--o)a[o]=n,n*=e[o];return r(i.malloc(n,t),e,a,0)},t.free=function(e){"generic"!==e.dtype&&"array"!==e.dtype&&i.free(e.data)},t.zeros=function(e,t){t||(t="double");for(var n=1,a=new Array(e.length),o=e.length-1;o>=0;--o)a[o]=n,n*=e[o];var s=i.malloc(n,t);for(o=0;o<n;++o)s[o]=0;return r(s,e,a,0)},t.ones=function(e,t){t||(t="double");for(var n=1,a=new Array(e.length),o=e.length-1;o>=0;--o)a[o]=n,n*=e[o];var s=i.malloc(n,t);for(o=0;o<n;++o)s[o]=1;return r(s,e,a,0)},t.eye=function(e,t){var n,a;t||(t="double");var o=1,s=new Array(e.length);for(n=e.length-1;n>=0;--n)s[n]=o,o*=e[n];var u=i.malloc(o,t);for(n=0;n<o;++n)u[n]=0;var c=1/0,l=0;for(n=e.length-1;n>=0;n--)l+=s[n],c=Math.min(c,e[n]);for(n=0,a=0;n<c;n++,a+=l)u[a]=1;return r(u,e,s,0)}},function(e,t,n){"use strict";var r=n(87),a=n(65),i=["args","body"],o=["pre","post","printCode","funcName","blockSize"];e.exports=function(e){for(var t in e)i.indexOf(t)<0&&o.indexOf(t)<0&&console.warn("cwise: Unknown argument '"+t+"' passed to expression compiler");for(var n=0;n<i.length;++n)if(!e[i[n]])throw new Error("cwise: Missing argument: "+i[n]);return a({args:e.args,pre:r(e.pre||function(){}),body:r(e.body),post:r(e.post||function(){}),debug:!!e.printCode,funcName:e.funcName||e.body.name||"cwise",blockSize:e.blockSize||64})}},function(e,t,n){"use strict";(function(t){var r=n(88),a=n(66),i=0;function o(e,t,n){this.name=e,this.lvalue=t,this.rvalue=n,this.count=0}function s(e,t,n,r){this.body=e,this.args=t,this.thisVars=n,this.localVars=r}e.exports=function(e){for(var n=["(",e,")()"].join(""),u=r.parse(n,{range:!0}),c="_inline_"+i+++"_",l=function(e){for(var t=e.body[0].expression.callee.params,n=new Array(t.length),r=0;r<t.length;++r)n[r]=t[r].name;return n}(u),h=new Array(l.length),f=0;f<l.length;++f)h[f]=new o([c,"arg",f,"_"].join(""),!1,!1);for(var d=new Array(n.length),p=(f=0,n.length);f<p;++f)d[f]=n.charAt(f);var m,v=[],g=[];function y(e,t){for(var n=e.range[0],r=e.range[1],a=n+1;a<r;++a)d[a]="";d[n]=t}return function e(n,r){if(n.parent=r,"MemberExpression"===n.type)n.computed?(e(n.object,n),e(n.property,n)):"ThisExpression"===n.object.type?y(n,(_="this_"+n.property.name.replace(/\_/g,"__"),g.push(_),_)):e(n.object,n);else{if("ThisExpression"===n.type)throw new Error("cwise-parser: Computed this is not allowed");if("Identifier"===n.type){var a=n.name,i=l.indexOf(a);if(i>=0){var o=h[i],s=function(e){return"AssignmentExpression"===e.parent.type&&e.parent.left===e?"="===e.parent.operator?1:3:"UpdateExpression"===e.parent.type?3:2}(n);1&s&&(o.lvalue=!0),2&s&&(o.rvalue=!0),++o.count,y(n,o.name)}else(function(e){if("eval"===e)throw new Error("cwise-parser: eval() not allowed");return"undefined"!=typeof window?e in window:void 0!==t?e in t:"undefined"!=typeof self&&e in self})(a)||y(n,function(e){var t=c+e.replace(/\_/g,"__");return v.push(t),t}(a))}else if("Literal"===n.type)"string"==typeof n.value&&y(n,"'"+n.value.replace(/\_/g,"\\_").replace(/\'/g,"'")+"'");else{if("WithStatement"===n.type)throw new Error("cwise-parser: with() statements not allowed");for(var u=Object.keys(n),f=0,d=u.length;f<d;++f)if("parent"!==u[f]){var p=n[u[f]];if(p)if(p instanceof Array)for(var m=0;m<p.length;++m)p[m]&&"string"==typeof p[m].type&&e(p[m],n);else"string"==typeof p.type&&e(p,n)}}}var _}(u.body[0].expression.callee.body,void 0),a(v),a(g),new s(d.slice((m=u.body[0].expression.callee.body).range[0],m.range[1]).join(""),h,g,v)}}).call(this,n(21))},function(e,t,n){var r,a,i;!function(n,o){"use strict";a=[t],void 0===(i="function"==typeof(r=function(e){var t,n,r,a,i,o,s,u,c,l,h,f,d,p,m,v,g,y;function _(e,t){if(!e)throw new Error("ASSERT: "+t)}function b(e){return e>=48&&e<=57}function k(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function w(e){return"01234567".indexOf(e)>=0}function x(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function C(e){return 10===e||13===e||8232===e||8233===e}function S(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&s.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function T(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&s.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function A(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function E(e){return"eval"===e||"arguments"===e}function I(e,t,n,r,a){var i;_("number"==typeof n,"Comment must have valid position"),g.lastCommentStart>=n||(g.lastCommentStart=n,i={type:e,value:t},y.range&&(i.range=[n,r]),y.loc&&(i.loc=a),y.comments.push(i),y.attachComment&&(y.leadingComments.push(i),y.trailingComments.push(i)))}function R(e){var t,n,r,a;for(t=h-e,n={start:{line:f,column:h-d-e}};h<p;)if(r=c.charCodeAt(h),++h,C(r))return y.comments&&(a=c.slice(t+e,h-1),n.end={line:f,column:h-d-1},I("Line",a,t,h-1,n)),13===r&&10===c.charCodeAt(h)&&++h,++f,void(d=h);y.comments&&(a=c.slice(t+e,h),n.end={line:f,column:h-d},I("Line",a,t,h,n))}function O(){var e,t,n,r;for(y.comments&&(e=h-2,t={start:{line:f,column:h-d-2}});h<p;)if(C(n=c.charCodeAt(h)))13===n&&10===c.charCodeAt(h+1)&&++h,++f,++h,d=h,h>=p&&H({},o.UnexpectedToken,"ILLEGAL");else if(42===n){if(47===c.charCodeAt(h+1))return++h,++h,void(y.comments&&(r=c.slice(e+2,h-2),t.end={line:f,column:h-d},I("Block",r,e,h,t)));++h}else++h;H({},o.UnexpectedToken,"ILLEGAL")}function N(){var e,t;for(t=0===h;h<p;)if(x(e=c.charCodeAt(h)))++h;else if(C(e))++h,13===e&&10===c.charCodeAt(h)&&++h,++f,d=h,t=!0;else if(47===e)if(47===(e=c.charCodeAt(h+1)))++h,++h,R(2),t=!0;else{if(42!==e)break;++h,++h,O()}else if(t&&45===e){if(45!==c.charCodeAt(h+1)||62!==c.charCodeAt(h+2))break;h+=3,R(3)}else{if(60!==e)break;if("!--"!==c.slice(h+1,h+4))break;++h,++h,++h,++h,R(4)}}function D(e){var t,n,r,a=0;for(n="u"===e?4:2,t=0;t<n;++t){if(!(h<p&&k(c[h])))return"";r=c[h++],a=16*a+"0123456789abcdef".indexOf(r.toLowerCase())}return String.fromCharCode(a)}function P(){var e,t;for(e=c.charCodeAt(h++),t=String.fromCharCode(e),92===e&&(117!==c.charCodeAt(h)&&H({},o.UnexpectedToken,"ILLEGAL"),++h,(e=D("u"))&&"\\"!==e&&S(e.charCodeAt(0))||H({},o.UnexpectedToken,"ILLEGAL"),t=e);h<p&&T(e=c.charCodeAt(h));)++h,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==c.charCodeAt(h)&&H({},o.UnexpectedToken,"ILLEGAL"),++h,(e=D("u"))&&"\\"!==e&&T(e.charCodeAt(0))||H({},o.UnexpectedToken,"ILLEGAL"),t+=e);return t}function F(){var e,n,r,a,i=h,s=c.charCodeAt(h),u=c[h];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++h,y.tokenize&&(40===s?y.openParenToken=y.tokens.length:123===s&&(y.openCurlyToken=y.tokens.length)),{type:t.Punctuator,value:String.fromCharCode(s),lineNumber:f,lineStart:d,start:i,end:h};default:if(61===(e=c.charCodeAt(h+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return h+=2,{type:t.Punctuator,value:String.fromCharCode(s)+String.fromCharCode(e),lineNumber:f,lineStart:d,start:i,end:h};case 33:case 61:return 61===c.charCodeAt(h+=2)&&++h,{type:t.Punctuator,value:c.slice(i,h),lineNumber:f,lineStart:d,start:i,end:h}}}return">>>="===(a=c.substr(h,4))?{type:t.Punctuator,value:a,lineNumber:f,lineStart:d,start:i,end:h+=4}:">>>"===(r=a.substr(0,3))||"<<="===r||">>="===r?{type:t.Punctuator,value:r,lineNumber:f,lineStart:d,start:i,end:h+=3}:u===(n=r.substr(0,2))[1]&&"+-<>&|".indexOf(u)>=0||"=>"===n?{type:t.Punctuator,value:n,lineNumber:f,lineStart:d,start:i,end:h+=2}:"<>=!+-*%&|^/".indexOf(u)>=0?(++h,{type:t.Punctuator,value:u,lineNumber:f,lineStart:d,start:i,end:h}):void H({},o.UnexpectedToken,"ILLEGAL")}function M(){var e,n,r;if(_(b((r=c[h]).charCodeAt(0))||"."===r,"Numeric literal must start with a decimal digit or a decimal point"),n=h,e="","."!==r){if(e=c[h++],r=c[h],"0"===e){if("x"===r||"X"===r)return++h,function(e){for(var n="";h<p&&k(c[h]);)n+=c[h++];return 0===n.length&&H({},o.UnexpectedToken,"ILLEGAL"),S(c.charCodeAt(h))&&H({},o.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt("0x"+n,16),lineNumber:f,lineStart:d,start:e,end:h}}(n);if(w(r)&&function(){var e,t;for(e=h+1;e<p;++e){if("8"===(t=c[e])||"9"===t)return!1;if(!w(t))return!0}return!0}())return function(e){for(var n="0"+c[h++];h<p&&w(c[h]);)n+=c[h++];return(S(c.charCodeAt(h))||b(c.charCodeAt(h)))&&H({},o.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:f,lineStart:d,start:e,end:h}}(n)}for(;b(c.charCodeAt(h));)e+=c[h++];r=c[h]}if("."===r){for(e+=c[h++];b(c.charCodeAt(h));)e+=c[h++];r=c[h]}if("e"===r||"E"===r)if(e+=c[h++],"+"!==(r=c[h])&&"-"!==r||(e+=c[h++]),b(c.charCodeAt(h)))for(;b(c.charCodeAt(h));)e+=c[h++];else H({},o.UnexpectedToken,"ILLEGAL");return S(c.charCodeAt(h))&&H({},o.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseFloat(e),lineNumber:f,lineStart:d,start:n,end:h}}function L(){var e,n,r,a;return v=null,N(),e=h,n=function(){var e,t,n,r;for(_("/"===(e=c[h]),"Regular expression literal must start with a slash"),t=c[h++],n=!1,r=!1;h<p;)if(t+=e=c[h++],"\\"===e)C((e=c[h++]).charCodeAt(0))&&H({},o.UnterminatedRegExp),t+=e;else if(C(e.charCodeAt(0)))H({},o.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||H({},o.UnterminatedRegExp),{value:t.substr(1,t.length-2),literal:t}}(),r=function(){var e,t,n,r;for(t="",n="";h<p&&T((e=c[h]).charCodeAt(0));)if(++h,"\\"===e&&h<p)if("u"===(e=c[h])){if(r=++h,e=D("u"))for(n+=e,t+="\\u";r<h;++r)t+=c[r];else h=r,n+="u",t+="\\u";K({},o.UnexpectedToken,"ILLEGAL")}else t+="\\",K({},o.UnexpectedToken,"ILLEGAL");else n+=e,t+=e;return{value:n,literal:t}}(),a=function(e,t){var n;try{n=new RegExp(e,t)}catch(e){H({},o.InvalidRegExp)}return n}(n.value,r.value),y.tokenize?{type:t.RegularExpression,value:a,lineNumber:f,lineStart:d,start:e,end:h}:{literal:n.literal+r.literal,value:a,start:e,end:h}}function z(){var e,t,n,r;return N(),e=h,t={start:{line:f,column:h-d}},n=L(),t.end={line:f,column:h-d},y.tokenize||(y.tokens.length>0&&(r=y.tokens[y.tokens.length-1]).range[0]===e&&"Punctuator"===r.type&&("/"!==r.value&&"/="!==r.value||y.tokens.pop()),y.tokens.push({type:"RegularExpression",value:n.literal,range:[e,h],loc:t})),n}function B(){var e;return N(),h>=p?{type:t.EOF,lineNumber:f,lineStart:d,start:h,end:h}:S(e=c.charCodeAt(h))?function(){var e,n;return e=h,{type:1===(n=92===c.charCodeAt(h)?P():function(){var e,t;for(e=h++;h<p;){if(92===(t=c.charCodeAt(h)))return h=e,P();if(!T(t))break;++h}return c.slice(e,h)}()).length?t.Identifier:function(e){if(l&&A(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}(n)?t.Keyword:"null"===n?t.NullLiteral:"true"===n||"false"===n?t.BooleanLiteral:t.Identifier,value:n,lineNumber:f,lineStart:d,start:e,end:h}}():40===e||41===e||59===e?F():39===e||34===e?function(){var e,n,r,a,i,s,u,l,m="",v=!1;for(u=f,l=d,_("'"===(e=c[h])||'"'===e,"String literal must starts with a quote"),n=h,++h;h<p;){if((r=c[h++])===e){e="";break}if("\\"===r)if((r=c[h++])&&C(r.charCodeAt(0)))++f,"\r"===r&&"\n"===c[h]&&++h,d=h;else switch(r){case"u":case"x":s=h,(i=D(r))?m+=i:(h=s,m+=r);break;case"n":m+="\n";break;case"r":m+="\r";break;case"t":m+="\t";break;case"b":m+="\b";break;case"f":m+="\f";break;case"v":m+="\v";break;default:w(r)?(0!==(a="01234567".indexOf(r))&&(v=!0),h<p&&w(c[h])&&(v=!0,a=8*a+"01234567".indexOf(c[h++]),"0123".indexOf(r)>=0&&h<p&&w(c[h])&&(a=8*a+"01234567".indexOf(c[h++]))),m+=String.fromCharCode(a)):m+=r}else{if(C(r.charCodeAt(0)))break;m+=r}}return""!==e&&H({},o.UnexpectedToken,"ILLEGAL"),{type:t.StringLiteral,value:m,octal:v,startLineNumber:u,startLineStart:l,lineNumber:f,lineStart:d,start:n,end:h}}():46===e?b(c.charCodeAt(h+1))?M():F():b(e)?M():y.tokenize&&47===e?function(){var e,t;if(!(e=y.tokens[y.tokens.length-1]))return z();if("Punctuator"===e.type){if("]"===e.value)return F();if(")"===e.value)return!(t=y.tokens[y.openParenToken-1])||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?F():z();if("}"===e.value){if(y.tokens[y.openCurlyToken-3]&&"Keyword"===y.tokens[y.openCurlyToken-3].type){if(!(t=y.tokens[y.openCurlyToken-4]))return F()}else{if(!y.tokens[y.openCurlyToken-4]||"Keyword"!==y.tokens[y.openCurlyToken-4].type)return F();if(!(t=y.tokens[y.openCurlyToken-5]))return z()}return r.indexOf(t.value)>=0?F():z()}return z()}return"Keyword"===e.type&&"this"!==e.value?z():F()}():F()}function j(){var e,r,a;return N(),e={start:{line:f,column:h-d}},r=B(),e.end={line:f,column:h-d},r.type!==t.EOF&&(a=c.slice(r.start,r.end),y.tokens.push({type:n[r.type],value:a,range:[r.start,r.end],loc:e})),r}function V(){var e;return h=(e=v).end,f=e.lineNumber,d=e.lineStart,v=void 0!==y.tokens?j():B(),h=e.end,f=e.lineNumber,d=e.lineStart,e}function q(){var e,t,n;e=h,t=f,n=d,v=void 0!==y.tokens?j():B(),h=e,f=t,d=n}function U(e,t){this.line=e,this.column=t}function W(e,t,n,r){this.start=new U(e,t),this.end=new U(n,r)}function G(){var e,t,n,r;return e=h,t=f,n=d,N(),r=f!==t,h=e,f=t,d=n,r}function H(e,t){var n,r=Array.prototype.slice.call(arguments,2),a=t.replace(/%(\d)/g,(function(e,t){return _(t<r.length,"Message reference must be in range"),r[t]}));throw"number"==typeof e.lineNumber?((n=new Error("Line "+e.lineNumber+": "+a)).index=e.start,n.lineNumber=e.lineNumber,n.column=e.start-d+1):((n=new Error("Line "+f+": "+a)).index=h,n.lineNumber=f,n.column=h-d+1),n.description=a,n}function K(){try{H.apply(null,arguments)}catch(e){if(!y.errors)throw e;y.errors.push(e)}}function X(e){if(e.type===t.EOF&&H(e,o.UnexpectedEOS),e.type===t.NumericLiteral&&H(e,o.UnexpectedNumber),e.type===t.StringLiteral&&H(e,o.UnexpectedString),e.type===t.Identifier&&H(e,o.UnexpectedIdentifier),e.type===t.Keyword){if(function(e){switch(e){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}(e.value))H(e,o.UnexpectedReserved);else if(l&&A(e.value))return void K(e,o.StrictReservedWord);H(e,o.UnexpectedToken,e.value)}H(e,o.UnexpectedToken,e.value)}function Q(e){var n=V();n.type===t.Punctuator&&n.value===e||X(n)}function Y(e){var n=V();n.type===t.Keyword&&n.value===e||X(n)}function Z(e){return v.type===t.Punctuator&&v.value===e}function J(e){return v.type===t.Keyword&&v.value===e}function $(){var e,n=h,r=f,a=d,i=v;if(59===c.charCodeAt(h)||Z(";"))V();else{if(e=f,N(),f!==e)return h=n,f=r,d=a,void(v=i);v.type===t.EOF||Z("}")||X(v)}}function ee(e){return e.type===a.Identifier||e.type===a.MemberExpression}function te(e,t){var n,r,a;return n=l,a=v,r=_e(),t&&l&&E(e[0].name)&&K(t,o.StrictParamName),l=n,m.markEnd(m.createFunctionExpression(null,e,[],r),a)}function ne(){var e,n;return n=v,(e=V()).type===t.StringLiteral||e.type===t.NumericLiteral?(l&&e.octal&&K(e,o.StrictOctalLiteral),m.markEnd(m.createLiteral(e),n)):m.markEnd(m.createIdentifier(e.value),n)}function re(){var e,n,r,a,i,s;return s=v,(e=v).type===t.Identifier?(r=ne(),"get"!==e.value||Z(":")?"set"!==e.value||Z(":")?(Q(":"),a=he(),m.markEnd(m.createProperty("init",r,a),s)):(n=ne(),Q("("),(e=v).type!==t.Identifier?(Q(")"),K(e,o.UnexpectedToken,e.value),a=te([])):(i=[pe()],Q(")"),a=te(i,e)),m.markEnd(m.createProperty("set",n,a),s)):(n=ne(),Q("("),Q(")"),a=te([]),m.markEnd(m.createProperty("get",n,a),s))):e.type!==t.EOF&&e.type!==t.Punctuator?(n=ne(),Q(":"),a=he(),m.markEnd(m.createProperty("init",n,a),s)):void X(e)}function ae(){var e,n,r,s;if(Z("("))return function(){var e;return Q("("),e=fe(),Q(")"),e}();if(Z("["))return function(){var e,t=[];for(e=v,Q("[");!Z("]");)Z(",")?(V(),t.push(null)):(t.push(he()),Z("]")||Q(","));return V(),m.markEnd(m.createArrayExpression(t),e)}();if(Z("{"))return function(){var e,t,n,r,s,u=[],c={},h=String;for(s=v,Q("{");!Z("}");)t=(e=re()).key.type===a.Identifier?e.key.name:h(e.key.value),r="init"===e.kind?i.Data:"get"===e.kind?i.Get:i.Set,n="$"+t,Object.prototype.hasOwnProperty.call(c,n)?(c[n]===i.Data?l&&r===i.Data?K({},o.StrictDuplicateProperty):r!==i.Data&&K({},o.AccessorDataProperty):r===i.Data?K({},o.AccessorDataProperty):c[n]&r&&K({},o.AccessorGetSet),c[n]|=r):c[n]=r,u.push(e),Z("}")||Q(",");return Q("}"),m.markEnd(m.createObjectExpression(u),s)}();if(s=v,(e=v.type)===t.Identifier)r=m.createIdentifier(V().value);else if(e===t.StringLiteral||e===t.NumericLiteral)l&&v.octal&&K(v,o.StrictOctalLiteral),r=m.createLiteral(V());else if(e===t.Keyword){if(J("function"))return function(){var e,t,n,r,a,i,s,u,c,h=null;return c=v,Y("function"),Z("(")||(e=v,h=pe(),l?E(e.value)&&K(e,o.StrictFunctionName):E(e.value)?(n=e,r=o.StrictFunctionName):A(e.value)&&(n=e,r=o.StrictReservedWord)),i=(a=be(n)).params,t=a.stricted,n=a.firstRestricted,a.message&&(r=a.message),u=l,s=_e(),l&&n&&H(n,r),l&&t&&K(t,r),l=u,m.markEnd(m.createFunctionExpression(h,i,[],s),c)}();J("this")?(V(),r=m.createThisExpression()):X(V())}else e===t.BooleanLiteral?((n=V()).value="true"===n.value,r=m.createLiteral(n)):e===t.NullLiteral?((n=V()).value=null,r=m.createLiteral(n)):Z("/")||Z("/=")?(r=m.createLiteral(void 0!==y.tokens?z():L()),q()):X(V());return m.markEnd(r,s)}function ie(){var e=[];if(Q("("),!Z(")"))for(;h<p&&(e.push(he()),!Z(")"));)Q(",");return Q(")"),e}function oe(){return Q("."),function(){var e,n;return n=v,function(e){return e.type===t.Identifier||e.type===t.Keyword||e.type===t.BooleanLiteral||e.type===t.NullLiteral}(e=V())||X(e),m.markEnd(m.createIdentifier(e.value),n)}()}function se(){var e;return Q("["),e=fe(),Q("]"),e}function ue(){var e,n,r=v;return e=function(){var e,t,n,r,a=g.allowIn;for(r=v,g.allowIn=!0,e=J("new")?function e(){var t,n,r;return r=v,Y("new"),t=function(){var t,n,r;for(_(g.allowIn,"callee of new expression always allow in keyword."),r=v,t=J("new")?e():ae();Z(".")||Z("[");)Z("[")?(n=se(),t=m.createMemberExpression("[",t,n)):(n=oe(),t=m.createMemberExpression(".",t,n)),m.markEnd(t,r);return t}(),n=Z("(")?ie():[],m.markEnd(m.createNewExpression(t,n),r)}():ae();;){if(Z("."))n=oe(),e=m.createMemberExpression(".",e,n);else if(Z("("))t=ie(),e=m.createCallExpression(e,t);else{if(!Z("["))break;n=se(),e=m.createMemberExpression("[",e,n)}m.markEnd(e,r)}return g.allowIn=a,e}(),v.type===t.Punctuator&&(!Z("++")&&!Z("--")||G()||(l&&e.type===a.Identifier&&E(e.name)&&K({},o.StrictLHSPostfix),ee(e)||K({},o.InvalidLHSInAssignment),n=V(),e=m.markEnd(m.createPostfixExpression(n.value,e),r))),e}function ce(){var e,n,r;return v.type!==t.Punctuator&&v.type!==t.Keyword?n=ue():Z("++")||Z("--")?(r=v,e=V(),n=ce(),l&&n.type===a.Identifier&&E(n.name)&&K({},o.StrictLHSPrefix),ee(n)||K({},o.InvalidLHSInAssignment),n=m.createUnaryExpression(e.value,n),n=m.markEnd(n,r)):Z("+")||Z("-")||Z("~")||Z("!")?(r=v,e=V(),n=ce(),n=m.createUnaryExpression(e.value,n),n=m.markEnd(n,r)):J("delete")||J("void")||J("typeof")?(r=v,e=V(),n=ce(),n=m.createUnaryExpression(e.value,n),n=m.markEnd(n,r),l&&"delete"===n.operator&&n.argument.type===a.Identifier&&K({},o.StrictDelete)):n=ue(),n}function le(e,n){var r=0;if(e.type!==t.Punctuator&&e.type!==t.Keyword)return 0;switch(e.value){case"||":r=1;break;case"&&":r=2;break;case"|":r=3;break;case"^":r=4;break;case"&":r=5;break;case"==":case"!=":case"===":case"!==":r=6;break;case"<":case">":case"<=":case">=":case"instanceof":r=7;break;case"in":r=n?7:0;break;case"<<":case">>":case">>>":r=8;break;case"+":case"-":r=9;break;case"*":case"/":case"%":r=11}return r}function he(){var e,n,r,i,s,u;return e=v,s=v,i=n=function(){var e,t,n,r,a;return a=v,e=function(){var e,t,n,r,a,i,o,s,u,c;if(e=v,u=ce(),0===(a=le(r=v,g.allowIn)))return u;for(r.prec=a,V(),t=[e,v],i=[u,r,o=ce()];(a=le(v,g.allowIn))>0;){for(;i.length>2&&a<=i[i.length-2].prec;)o=i.pop(),s=i.pop().value,u=i.pop(),n=m.createBinaryExpression(s,u,o),t.pop(),m.markEnd(n,e=t[t.length-1]),i.push(n);(r=V()).prec=a,i.push(r),t.push(v),n=ce(),i.push(n)}for(n=i[c=i.length-1],t.pop();c>1;)n=m.createBinaryExpression(i[c-1].value,i[c-2],n),c-=2,e=t.pop(),m.markEnd(n,e);return n}(),Z("?")&&(V(),t=g.allowIn,g.allowIn=!0,n=he(),g.allowIn=t,Q(":"),r=he(),e=m.createConditionalExpression(e,n,r),m.markEnd(e,a)),e}(),v.type!==t.Punctuator||"="!==(u=v.value)&&"*="!==u&&"/="!==u&&"%="!==u&&"+="!==u&&"-="!==u&&"<<="!==u&&">>="!==u&&">>>="!==u&&"&="!==u&&"^="!==u&&"|="!==u||(ee(n)||K({},o.InvalidLHSInAssignment),l&&n.type===a.Identifier&&E(n.name)&&K(e,o.StrictLHSAssignment),e=V(),r=he(),i=m.markEnd(m.createAssignmentExpression(e.value,n,r),s)),i}function fe(){var e,t=v;if(e=he(),Z(",")){for(e=m.createSequenceExpression([e]);h<p&&Z(",");)V(),e.expressions.push(he());m.markEnd(e,t)}return e}function de(){var e,t;return t=v,Q("{"),e=function(){for(var e,t=[];h<p&&!Z("}")&&void 0!==(e=we());)t.push(e);return t}(),Q("}"),m.markEnd(m.createBlockStatement(e),t)}function pe(){var e,n;return n=v,(e=V()).type!==t.Identifier&&X(e),m.markEnd(m.createIdentifier(e.value),n)}function me(e){var t,n,r=null;return n=v,t=pe(),l&&E(t.name)&&K({},o.StrictVarName),"const"===e?(Q("="),r=he()):Z("=")&&(V(),r=he()),m.markEnd(m.createVariableDeclarator(t,r),n)}function ve(e){var t=[];do{if(t.push(me(e)),!Z(","))break;V()}while(h<p);return t}function ge(){var e,t,n,r=[];for(n=v,J("default")?(V(),e=null):(Y("case"),e=fe()),Q(":");h<p&&!(Z("}")||J("default")||J("case"));)t=ye(),r.push(t);return m.markEnd(m.createSwitchCase(e,r),n)}function ye(){var e,n,r,i,s,u,f,d,y,_=v.type;if(_===t.EOF&&X(v),_===t.Punctuator&&"{"===v.value)return de();if(i=v,_===t.Punctuator)switch(v.value){case";":return m.markEnd((Q(";"),m.createEmptyStatement()),i);case"(":return m.markEnd(function(){var e=fe();return $(),m.createExpressionStatement(e)}(),i)}if(_===t.Keyword)switch(v.value){case"break":return m.markEnd(function(){var e,n=null;return Y("break"),59===c.charCodeAt(h)?(V(),g.inIteration||g.inSwitch||H({},o.IllegalBreak),m.createBreakStatement(null)):G()?(g.inIteration||g.inSwitch||H({},o.IllegalBreak),m.createBreakStatement(null)):(v.type===t.Identifier&&(e="$"+(n=pe()).name,Object.prototype.hasOwnProperty.call(g.labelSet,e)||H({},o.UnknownLabel,n.name)),$(),null!==n||g.inIteration||g.inSwitch||H({},o.IllegalBreak),m.createBreakStatement(n))}(),i);case"continue":return m.markEnd(function(){var e,n=null;return Y("continue"),59===c.charCodeAt(h)?(V(),g.inIteration||H({},o.IllegalContinue),m.createContinueStatement(null)):G()?(g.inIteration||H({},o.IllegalContinue),m.createContinueStatement(null)):(v.type===t.Identifier&&(e="$"+(n=pe()).name,Object.prototype.hasOwnProperty.call(g.labelSet,e)||H({},o.UnknownLabel,n.name)),$(),null!==n||g.inIteration||H({},o.IllegalContinue),m.createContinueStatement(n))}(),i);case"debugger":return m.markEnd((Y("debugger"),$(),m.createDebuggerStatement()),i);case"do":return m.markEnd((Y("do"),y=g.inIteration,g.inIteration=!0,f=ye(),g.inIteration=y,Y("while"),Q("("),d=fe(),Q(")"),Z(";")&&V(),m.createDoWhileStatement(f,d)),i);case"for":return m.markEnd(function(){var e,t,n,r,a,i,s,u,c,l,h=g.allowIn;return e=t=n=null,Y("for"),Q("("),Z(";")?V():(J("var")||J("let")?(g.allowIn=!1,l=v,u=V(),c=ve(),e=m.markEnd(m.createVariableDeclaration(c,u.value),l),g.allowIn=h,1===e.declarations.length&&J("in")&&(V(),r=e,a=fe(),e=null)):(g.allowIn=!1,e=fe(),g.allowIn=h,J("in")&&(ee(e)||K({},o.InvalidLHSInForIn),V(),r=e,a=fe(),e=null)),void 0===r&&Q(";")),void 0===r&&(Z(";")||(t=fe()),Q(";"),Z(")")||(n=fe())),Q(")"),s=g.inIteration,g.inIteration=!0,i=ye(),g.inIteration=s,void 0===r?m.createForStatement(e,t,n,i):m.createForInStatement(r,a,i)}(),i);case"function":return m.markEnd(ke(),i);case"if":return m.markEnd(function(){var e,t,n;return Y("if"),Q("("),e=fe(),Q(")"),t=ye(),J("else")?(V(),n=ye()):n=null,m.createIfStatement(e,t,n)}(),i);case"return":return m.markEnd((u=null,Y("return"),g.inFunctionBody||K({},o.IllegalReturn),32===c.charCodeAt(h)&&S(c.charCodeAt(h+1))?(u=fe(),$(),m.createReturnStatement(u)):G()?m.createReturnStatement(null):(Z(";")||Z("}")||v.type===t.EOF||(u=fe()),$(),m.createReturnStatement(u))),i);case"switch":return m.markEnd(function(){var e,t,n,r,a;if(Y("switch"),Q("("),e=fe(),Q(")"),Q("{"),t=[],Z("}"))return V(),m.createSwitchStatement(e,t);for(r=g.inSwitch,g.inSwitch=!0,a=!1;h<p&&!Z("}");)null===(n=ge()).test&&(a&&H({},o.MultipleDefaultsInSwitch),a=!0),t.push(n);return g.inSwitch=r,Q("}"),m.createSwitchStatement(e,t)}(),i);case"throw":return m.markEnd(function(){var e;return Y("throw"),G()&&H({},o.NewlineAfterThrow),e=fe(),$(),m.createThrowStatement(e)}(),i);case"try":return m.markEnd(function(){var e,t,n,r,a=[],i=null;return Y("try"),e=de(),J("catch")&&a.push((r=v,Y("catch"),Q("("),Z(")")&&X(v),t=pe(),l&&E(t.name)&&K({},o.StrictCatchVariable),Q(")"),n=de(),m.markEnd(m.createCatchClause(t,n),r))),J("finally")&&(V(),i=de()),0!==a.length||i||H({},o.NoCatchOrFinally),m.createTryStatement(e,[],a,i)}(),i);case"var":return m.markEnd((Y("var"),s=ve(),$(),m.createVariableDeclaration(s,"var")),i);case"while":return m.markEnd(function(){var e,t,n;return Y("while"),Q("("),e=fe(),Q(")"),n=g.inIteration,g.inIteration=!0,t=ye(),g.inIteration=n,m.createWhileStatement(e,t)}(),i);case"with":return m.markEnd(function(){var e,t;return l&&(N(),K({},o.StrictModeWith)),Y("with"),Q("("),e=fe(),Q(")"),t=ye(),m.createWithStatement(e,t)}(),i)}return(e=fe()).type===a.Identifier&&Z(":")?(V(),r="$"+e.name,Object.prototype.hasOwnProperty.call(g.labelSet,r)&&H({},o.Redeclaration,"Label",e.name),g.labelSet[r]=!0,n=ye(),delete g.labelSet[r],m.markEnd(m.createLabeledStatement(e,n),i)):($(),m.markEnd(m.createExpressionStatement(e),i))}function _e(){var e,n,r,i,s,u,f,d,y=[];for(d=v,Q("{");h<p&&v.type===t.StringLiteral&&(n=v,e=we(),y.push(e),e.expression.type===a.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(l=!0,r&&K(r,o.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(i=g.labelSet,s=g.inIteration,u=g.inSwitch,f=g.inFunctionBody,g.labelSet={},g.inIteration=!1,g.inSwitch=!1,g.inFunctionBody=!0;h<p&&!Z("}")&&void 0!==(e=we());)y.push(e);return Q("}"),g.labelSet=i,g.inIteration=s,g.inSwitch=u,g.inFunctionBody=f,m.markEnd(m.createBlockStatement(y),d)}function be(e){var t,n,r,a,i,s,u=[];if(Q("("),!Z(")"))for(a={};h<p&&(n=v,t=pe(),i="$"+n.value,l?(E(n.value)&&(r=n,s=o.StrictParamName),Object.prototype.hasOwnProperty.call(a,i)&&(r=n,s=o.StrictParamDupe)):e||(E(n.value)?(e=n,s=o.StrictParamName):A(n.value)?(e=n,s=o.StrictReservedWord):Object.prototype.hasOwnProperty.call(a,i)&&(e=n,s=o.StrictParamDupe)),u.push(t),a[i]=!0,!Z(")"));)Q(",");return Q(")"),{params:u,stricted:r,firstRestricted:e,message:s}}function ke(){var e,t,n,r,a,i,s,u,c,h;return h=v,Y("function"),r=v,e=pe(),l?E(r.value)&&K(r,o.StrictFunctionName):E(r.value)?(s=r,u=o.StrictFunctionName):A(r.value)&&(s=r,u=o.StrictReservedWord),t=(i=be(s)).params,a=i.stricted,s=i.firstRestricted,i.message&&(u=i.message),c=l,n=_e(),l&&s&&H(s,u),l&&a&&K(a,u),l=c,m.markEnd(m.createFunctionDeclaration(e,t,[],n),h)}function we(){if(v.type===t.Keyword)switch(v.value){case"const":case"let":return r=v,Y(e=v.value),n=ve(e),$(),m.markEnd(m.createVariableDeclaration(n,e),r);case"function":return ke();default:return ye()}var e,n,r;if(v.type!==t.EOF)return ye()}function xe(){var e,n;return N(),q(),n=v,l=!1,e=function(){for(var e,n,r,i=[];h<p&&(n=v).type===t.StringLiteral&&(e=we(),i.push(e),e.expression.type===a.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(l=!0,r&&K(r,o.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(;h<p&&void 0!==(e=we());)i.push(e);return i}(),m.markEnd(m.createProgram(e),n)}function Ce(){var e,t,n,r=[];for(e=0;e<y.tokens.length;++e)n={type:(t=y.tokens[e]).type,value:t.value},y.range&&(n.range=t.range),y.loc&&(n.loc=t.loc),r.push(n);y.tokens=r}(n={})[(t={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9}).BooleanLiteral]="Boolean",n[t.EOF]="<end>",n[t.Identifier]="Identifier",n[t.Keyword]="Keyword",n[t.NullLiteral]="Null",n[t.NumericLiteral]="Numeric",n[t.Punctuator]="Punctuator",n[t.StringLiteral]="String",n[t.RegularExpression]="RegularExpression",r=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],a={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},i={Data:1,Get:2,Set:4},o={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},s={NonAsciiIdentifierStart:new RegExp("[\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]"),NonAsciiIdentifierPart:new RegExp("[\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0300-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u0483-\u0487\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u05d0-\u05ea\u05f0-\u05f2\u0610-\u061a\u0620-\u0669\u066e-\u06d3\u06d5-\u06dc\u06df-\u06e8\u06ea-\u06fc\u06ff\u0710-\u074a\u074d-\u07b1\u07c0-\u07f5\u07fa\u0800-\u082d\u0840-\u085b\u08a0\u08a2-\u08ac\u08e4-\u08fe\u0900-\u0963\u0966-\u096f\u0971-\u0977\u0979-\u097f\u0981-\u0983\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bc-\u09c4\u09c7\u09c8\u09cb-\u09ce\u09d7\u09dc\u09dd\u09df-\u09e3\u09e6-\u09f1\u0a01-\u0a03\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a59-\u0a5c\u0a5e\u0a66-\u0a75\u0a81-\u0a83\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abc-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ad0\u0ae0-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3c-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5c\u0b5d\u0b5f-\u0b63\u0b66-\u0b6f\u0b71\u0b82\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd0\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c58\u0c59\u0c60-\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbc-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0cde\u0ce0-\u0ce3\u0ce6-\u0cef\u0cf1\u0cf2\u0d02\u0d03\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d-\u0d44\u0d46-\u0d48\u0d4a-\u0d4e\u0d57\u0d60-\u0d63\u0d66-\u0d6f\u0d7a-\u0d7f\u0d82\u0d83\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e01-\u0e3a\u0e40-\u0e4e\u0e50-\u0e59\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb9\u0ebb-\u0ebd\u0ec0-\u0ec4\u0ec6\u0ec8-\u0ecd\u0ed0-\u0ed9\u0edc-\u0edf\u0f00\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e-\u0f47\u0f49-\u0f6c\u0f71-\u0f84\u0f86-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1049\u1050-\u109d\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u135d-\u135f\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176c\u176e-\u1770\u1772\u1773\u1780-\u17d3\u17d7\u17dc\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1820-\u1877\u1880-\u18aa\u18b0-\u18f5\u1900-\u191c\u1920-\u192b\u1930-\u193b\u1946-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u19d0-\u19d9\u1a00-\u1a1b\u1a20-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1aa7\u1b00-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1bf3\u1c00-\u1c37\u1c40-\u1c49\u1c4d-\u1c7d\u1cd0-\u1cd2\u1cd4-\u1cf6\u1d00-\u1de6\u1dfc-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u200c\u200d\u203f\u2040\u2054\u2071\u207f\u2090-\u209c\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d7f-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2de0-\u2dff\u2e2f\u3005-\u3007\u3021-\u302f\u3031-\u3035\u3038-\u303c\u3041-\u3096\u3099\u309a\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua62b\ua640-\ua66f\ua674-\ua67d\ua67f-\ua697\ua69f-\ua6f1\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua827\ua840-\ua873\ua880-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f7\ua8fb\ua900-\ua92d\ua930-\ua953\ua960-\ua97c\ua980-\ua9c0\ua9cf-\ua9d9\uaa00-\uaa36\uaa40-\uaa4d\uaa50-\uaa59\uaa60-\uaa76\uaa7a\uaa7b\uaa80-\uaac2\uaadb-\uaadd\uaae0-\uaaef\uaaf2-\uaaf6\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabea\uabec\uabed\uabf0-\uabf9\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff3f\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]")},u={name:"SyntaxTree",processComment:function(e){var t,n;if(!(e.type===a.Program&&e.body.length>0)){for(y.trailingComments.length>0?y.trailingComments[0].range[0]>=e.range[1]?(n=y.trailingComments,y.trailingComments=[]):y.trailingComments.length=0:y.bottomRightStack.length>0&&y.bottomRightStack[y.bottomRightStack.length-1].trailingComments&&y.bottomRightStack[y.bottomRightStack.length-1].trailingComments[0].range[0]>=e.range[1]&&(n=y.bottomRightStack[y.bottomRightStack.length-1].trailingComments,delete y.bottomRightStack[y.bottomRightStack.length-1].trailingComments);y.bottomRightStack.length>0&&y.bottomRightStack[y.bottomRightStack.length-1].range[0]>=e.range[0];)t=y.bottomRightStack.pop();t?t.leadingComments&&t.leadingComments[t.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=t.leadingComments,delete t.leadingComments):y.leadingComments.length>0&&y.leadingComments[y.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=y.leadingComments,y.leadingComments=[]),n&&(e.trailingComments=n),y.bottomRightStack.push(e)}},markEnd:function(e,t){return y.range&&(e.range=[t.start,h]),y.loc&&(e.loc=new W(void 0===t.startLineNumber?t.lineNumber:t.startLineNumber,t.start-(void 0===t.startLineStart?t.lineStart:t.startLineStart),f,h-d),this.postProcess(e)),y.attachComment&&this.processComment(e),e},postProcess:function(e){return y.source&&(e.loc.source=y.source),e},createArrayExpression:function(e){return{type:a.ArrayExpression,elements:e}},createAssignmentExpression:function(e,t,n){return{type:a.AssignmentExpression,operator:e,left:t,right:n}},createBinaryExpression:function(e,t,n){return{type:"||"===e||"&&"===e?a.LogicalExpression:a.BinaryExpression,operator:e,left:t,right:n}},createBlockStatement:function(e){return{type:a.BlockStatement,body:e}},createBreakStatement:function(e){return{type:a.BreakStatement,label:e}},createCallExpression:function(e,t){return{type:a.CallExpression,callee:e,arguments:t}},createCatchClause:function(e,t){return{type:a.CatchClause,param:e,body:t}},createConditionalExpression:function(e,t,n){return{type:a.ConditionalExpression,test:e,consequent:t,alternate:n}},createContinueStatement:function(e){return{type:a.ContinueStatement,label:e}},createDebuggerStatement:function(){return{type:a.DebuggerStatement}},createDoWhileStatement:function(e,t){return{type:a.DoWhileStatement,body:e,test:t}},createEmptyStatement:function(){return{type:a.EmptyStatement}},createExpressionStatement:function(e){return{type:a.ExpressionStatement,expression:e}},createForStatement:function(e,t,n,r){return{type:a.ForStatement,init:e,test:t,update:n,body:r}},createForInStatement:function(e,t,n){return{type:a.ForInStatement,left:e,right:t,body:n,each:!1}},createFunctionDeclaration:function(e,t,n,r){return{type:a.FunctionDeclaration,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createFunctionExpression:function(e,t,n,r){return{type:a.FunctionExpression,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(e){return{type:a.Identifier,name:e}},createIfStatement:function(e,t,n){return{type:a.IfStatement,test:e,consequent:t,alternate:n}},createLabeledStatement:function(e,t){return{type:a.LabeledStatement,label:e,body:t}},createLiteral:function(e){return{type:a.Literal,value:e.value,raw:c.slice(e.start,e.end)}},createMemberExpression:function(e,t,n){return{type:a.MemberExpression,computed:"["===e,object:t,property:n}},createNewExpression:function(e,t){return{type:a.NewExpression,callee:e,arguments:t}},createObjectExpression:function(e){return{type:a.ObjectExpression,properties:e}},createPostfixExpression:function(e,t){return{type:a.UpdateExpression,operator:e,argument:t,prefix:!1}},createProgram:function(e){return{type:a.Program,body:e}},createProperty:function(e,t,n){return{type:a.Property,key:t,value:n,kind:e}},createReturnStatement:function(e){return{type:a.ReturnStatement,argument:e}},createSequenceExpression:function(e){return{type:a.SequenceExpression,expressions:e}},createSwitchCase:function(e,t){return{type:a.SwitchCase,test:e,consequent:t}},createSwitchStatement:function(e,t){return{type:a.SwitchStatement,discriminant:e,cases:t}},createThisExpression:function(){return{type:a.ThisExpression}},createThrowStatement:function(e){return{type:a.ThrowStatement,argument:e}},createTryStatement:function(e,t,n,r){return{type:a.TryStatement,block:e,guardedHandlers:t,handlers:n,finalizer:r}},createUnaryExpression:function(e,t){return"++"===e||"--"===e?{type:a.UpdateExpression,operator:e,argument:t,prefix:!0}:{type:a.UnaryExpression,operator:e,argument:t,prefix:!0}},createVariableDeclaration:function(e,t){return{type:a.VariableDeclaration,declarations:e,kind:t}},createVariableDeclarator:function(e,t){return{type:a.VariableDeclarator,id:e,init:t}},createWhileStatement:function(e,t){return{type:a.WhileStatement,test:e,body:t}},createWithStatement:function(e,t){return{type:a.WithStatement,object:e,body:t}}},e.version="1.2.5",e.tokenize=function(e,n){var r;"string"==typeof e||e instanceof String||(e=String(e)),m=u,h=0,f=(c=e).length>0?1:0,d=0,p=c.length,v=null,g={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},y={},(n=n||{}).tokens=!0,y.tokens=[],y.tokenize=!0,y.openParenToken=-1,y.openCurlyToken=-1,y.range="boolean"==typeof n.range&&n.range,y.loc="boolean"==typeof n.loc&&n.loc,"boolean"==typeof n.comment&&n.comment&&(y.comments=[]),"boolean"==typeof n.tolerant&&n.tolerant&&(y.errors=[]);try{if(q(),v.type===t.EOF)return y.tokens;for(V();v.type!==t.EOF;)try{V()}catch(e){if(y.errors){y.errors.push(e);break}throw e}Ce(),r=y.tokens,void 0!==y.comments&&(r.comments=y.comments),void 0!==y.errors&&(r.errors=y.errors)}catch(e){throw e}finally{y={}}return r},e.parse=function(e,t){var n,r;r=String,"string"==typeof e||e instanceof String||(e=r(e)),m=u,h=0,f=(c=e).length>0?1:0,d=0,p=c.length,v=null,g={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},y={},void 0!==t&&(y.range="boolean"==typeof t.range&&t.range,y.loc="boolean"==typeof t.loc&&t.loc,y.attachComment="boolean"==typeof t.attachComment&&t.attachComment,y.loc&&null!=t.source&&(y.source=r(t.source)),"boolean"==typeof t.tokens&&t.tokens&&(y.tokens=[]),"boolean"==typeof t.comment&&t.comment&&(y.comments=[]),"boolean"==typeof t.tolerant&&t.tolerant&&(y.errors=[]),y.attachComment&&(y.range=!0,y.comments=[],y.bottomRightStack=[],y.trailingComments=[],y.leadingComments=[]));try{n=xe(),void 0!==y.comments&&(n.comments=y.comments),void 0!==y.tokens&&(Ce(),n.tokens=y.tokens),void 0!==y.errors&&(n.errors=y.errors)}catch(e){throw e}finally{y={}}return n},e.Syntax=function(){var e,t={};for(e in"function"==typeof Object.create&&(t=Object.create(null)),a)a.hasOwnProperty(e)&&(t[e]=a[e]);return"function"==typeof Object.freeze&&Object.freeze(t),t}()})?r.apply(t,a):r)||(e.exports=i)}()},function(e,t,n){t.parseMidi=n(181),t.writeMidi=n(182)},function(e,t,n){"use strict";function r(e,t,n){void 0===n&&(n="ticks");var r=0,a=e.length,i=a;if(a>0&&e[a-1][n]<=t)return a-1;for(;r<i;){var o=Math.floor(r+(i-r)/2),s=e[o],u=e[o+1];if(s[n]===t){for(var c=o;c<e.length;c++)e[c][n]===t&&(o=c);return o}if(s[n]<t&&u[n]>t)return o;s[n]>t?i=o:s[n]<t&&(r=o+1)}return-1}Object.defineProperty(t,"__esModule",{value:!0}),t.search=r,t.insert=function(e,t,n){if(void 0===n&&(n="ticks"),e.length){var a=r(e,t[n],n);e.splice(a+1,0,t)}else e.push(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(90),a=n(92),i=n(185),o=n(186),s=n(187),u=n(189),c=new WeakMap,l=function(){function e(e,t){var n=this;if(this.name="",this.notes=[],this.controlChanges=i.createControlChanges(),this.pitchBends=[],c.set(this,t),e){var r=e.find((function(e){return"trackName"===e.type}));this.name=r?r.text:""}if(this.instrument=new s.Instrument(e,this),this.channel=0,e){for(var a=e.filter((function(e){return"noteOn"===e.type})),o=e.filter((function(e){return"noteOff"===e.type})),u=function(){var e=a.shift();l.channel=e.channel;var t=o.findIndex((function(t){return t.noteNumber===e.noteNumber&&t.absoluteTime>=e.absoluteTime}));if(-1!==t){var n=o.splice(t,1)[0];l.addNote({durationTicks:n.absoluteTime-e.absoluteTime,midi:e.noteNumber,noteOffVelocity:n.velocity/127,ticks:e.absoluteTime,velocity:e.velocity/127})}},l=this;a.length;)u();e.filter((function(e){return"controller"===e.type})).forEach((function(e){n.addCC({number:e.controllerType,ticks:e.absoluteTime,value:e.value/127})})),e.filter((function(e){return"pitchBend"===e.type})).forEach((function(e){n.addPitchBend({ticks:e.absoluteTime,value:e.value/Math.pow(2,13)})}))}}return e.prototype.addNote=function(e){var t=c.get(this),n=new u.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},t);return Object.assign(n,e),r.insert(this.notes,n,"ticks"),this},e.prototype.addCC=function(e){var t=c.get(this),n=new a.ControlChange({controllerType:e.number},t);return delete e.number,Object.assign(n,e),Array.isArray(this.controlChanges[n.number])||(this.controlChanges[n.number]=[]),r.insert(this.controlChanges[n.number],n,"ticks"),this},e.prototype.addPitchBend=function(e){var t=c.get(this),n=new o.PitchBend({},t);return Object.assign(n,e),r.insert(this.pitchBends,n,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,t=0;t<this.notes.length-1;t++){var n=this.notes[t].time+this.notes[t].duration;e<n&&(e=n)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,t=0;t<this.notes.length-1;t++){var n=this.notes[t].ticks+this.notes[t].durationTicks;e<n&&(e=n)}return e},enumerable:!0,configurable:!0}),e.prototype.fromJSON=function(e){var t=this;for(var n in this.name=e.name,this.channel=e.channel,this.instrument=new s.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),e.controlChanges)e.controlChanges[n]&&e.controlChanges[n].forEach((function(e){t.addCC({number:e.number,ticks:e.ticks,value:e.value})}));e.notes.forEach((function(e){t.addNote({durationTicks:e.durationTicks,midi:e.midi,ticks:e.ticks,velocity:e.velocity})}))},e.prototype.toJSON=function(){for(var e={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(e[t]=this.controlChanges[t].map((function(e){return e.toJSON()})));return{channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map((function(e){return e.toJSON()})),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map((function(e){return e.toJSON()}))}},e}();t.Track=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce((function(e,n){return e[t.controlChangeNames[n]]=n,e}),{});var r=new WeakMap,a=new WeakMap,i=function(){function e(e,t){r.set(this,t),a.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(e.prototype,"number",{get:function(){return a.get(this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return r.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=r.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},e}();t.ControlChange=i},function(e,t,n){self,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,(function(t){return e[t]}).bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";n.r(t),n.d(t,"SVGNS",(function(){return r})),n.d(t,"drawSVGPath",(function(){return a})),n.d(t,"drawSVGText",(function(){return i})),n.d(t,"createSVGGroupChild",(function(){return o})),n.d(t,"setFade",(function(){return s}));var r="http://www.w3.org/2000/svg";function a(e,t,n,a,i,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,u=document.createElementNS(r,"path");return u.setAttributeNS(null,"d",t),u.setAttributeNS(null,"transform","translate(".concat(n,", ").concat(a,") scale(").concat(i,", ").concat(o,")")),u.setAttributeNS(null,"opacity",""+s),e.appendChild(u),u}function i(e,t,n,a,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,c=document.createElementNS(r,"text");c.setAttributeNS(null,"font-family","Times"),c.setAttributeNS(null,"font-size",i),o&&c.setAttributeNS(null,"font-weight","bold"),c.setAttributeNS(null,"transform","translate(".concat(n,", ").concat(a,") scale(").concat(s,", ").concat(u,")"));var l=document.createTextNode(t);return c.appendChild(l),e.appendChild(c),c}function o(e,t){var n=document.createElementNS(r,"g");return n.setAttribute("data-id",t),e.appendChild(n),n}function s(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=e.querySelector("animate");if(!i){(i=document.createElementNS(r,"animate")).setAttributeNS(null,"attributeName","opacity"),i.setAttributeNS(null,"dur","4s"),i.setAttributeNS(null,"fill","freeze"),i.setAttributeNS(null,"keyTimes","0; 0.25; 0.5; 0.75; 1");var o=(n+3*a)/4;i.setAttributeNS(null,"values","".concat(n,"; ").concat(o,"; ").concat(a,"; ").concat(o,"; ").concat(n))}return i.setAttributeNS(null,"repeatCount",t?"indefinite":"1"),e.appendChild(i),e}},function(e,t,n){"use strict";n.r(t),n.d(t,"PATH_SCALE",(function(){return r})),n.d(t,"staffLinePath",(function(){return i})),n.d(t,"extraLinePath",(function(){return o})),n.d(t,"barPath",(function(){return s})),n.d(t,"stemPath",(function(){return u})),n.d(t,"singleFlagPath",(function(){return c})),n.d(t,"multiFlagPath",(function(){return l})),n.d(t,"tiePath",(function(){return h})),n.d(t,"dotPath",(function(){return f})),n.d(t,"NOTE_PATHS",(function(){return d})),n.d(t,"REST_PATHS",(function(){return p})),n.d(t,"CLEF_PATHS",(function(){return m})),n.d(t,"ACCIDENTAL_PATHS",(function(){return v}));var r=100,a="M 0,10 C 0,-15 35,-50 80,-50 110,-50 125,-35 125,-10 \n125,15 90,50 45,50 15,50 0,35 0,10 Z",i="m 0,0 h 100",o="m -25,0 h 175",s="m 0,-200 v 400",u="m 0,0 v 100 h 15 v -100 z",c="M0,0 h 12 c 7,100 175,156 62,314 79,-177 -49,\n-193 -61,-200 l -13,-5 z",l="m 0,0 h 10 c 6,72 173,64 84,227 44,-120 -44,\n-123 -94,-167 z",h="M 0,25 C 10,46 30,67 50,67 69,67 90,47 100,25 94,\n65 73,89 50,89 26,89 5,63 0,25 Z",f="M 5 -20 a 20 20 0 1 0 0.00001 0 z",d={4:{path:"m 0,0 c 0,-37 49,-51 79,-51 31,0 83,13 83,51 0,39 \n-55,51 -84,51 C 49,51 0,37 0,0 Z m 111,31 c 13,-19 0,-58 -22,-68 -33,-15 \n-53,10 -39,49 9,27 48,39 61,19 z",width:150,stemVSteps:0,stemAnchor:0,flags:0},2:{path:"m 0,10 c 0,-25 35,-60 80,-60 15,0 45,4 45,40 C 125,16 \n89,50 45,50 17,50 0,36 0,10 Z m 71,7 c 17,-11 45,-34 38,-45 -7,-10 -39,1 \n-57,12 -19,11 -42,31 -36,42 6,10 37,2 55,-9 z",width:125,stemVSteps:7,stemAnchor:-10,flags:0},1:{path:a,width:125,stemVSteps:7,stemAnchor:-10,flags:0},.5:{path:a,width:125,stemVSteps:7,stemAnchor:-10,flags:1},.25:{path:a,width:125,stemVSteps:9,stemAnchor:-10,flags:2},.125:{path:a,width:125,stemVSteps:11,stemAnchor:-10,flags:3},.0625:{path:a,width:125,stemVSteps:13,stemAnchor:-10,flags:4}},p={4:"m 0,-50 h 125 v -50 H 0 Z",2:"M 0,0 H 125 V -50 H 0 Z",1:"m 0,-25 c 39,-39 37,-75 8,-120 l 6,-5 61,103 C \n40,-13 31,4 73,71 l -5,5 C 14,52 16,125 67,144 l -4,6 C -37,102 -1,22 59,60 Z",.5:"m 52,-47 c 26,-2 42,-21 48,-42 l 12,4 L 64,83 52,79 \n88,-49 c 0,0 -17,22 -57,22 -16,0 -31,-13 -31,-27 0,-18 10,-31 27,-31 17,0 \n33,15 25,38 z",.25:"m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 \nc -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 \n31,27 40,0 57,-22 57,-22 l -36,128 12,4 77,-270 z",.125:"m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 \nc -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 \n31,27 40,0 57,-22 57,-22 L 68,20 C 61,37 46,51 24,52 32,29 16,14 -1,14 c \n-17,0 -27,13 -27,31 0,14 15,27 31,27 38,0 55,-20 57,-22 l -36,128 12,4 \n105,-369 z",.0625:"m 158,-292 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -17,61 \nv 0 c -6,21 -22,40 -48,42 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 \n15,27 31,27 40,0 57,-22 57,-22 l -20,69 c -7,18 -22,33 -45,35 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 L 68,20 C \n61,37 46,51 24,52 32,29 16,14 -1,14 c -17,0 -27,13 -27,31 0,14 15,27 31,27 \n38,0 55,-20 57,-22 l -36,128 12,4 134,-469 z"},m={50:{path:"m 101,-199 c -49,0 -100,28 -100,83 0,39 58,57 82,26 15,-20 \n-4,-47 -32,-47 -23,1 -25,0 -25,-8 0,-22 40,-46 71,-41 91,16 67,208 -105,302 \n75,-27 198,-94 211,-201 6,-66 -42,-114 -102,-114 z m 143,33 c -13,0 -23,11 \n-23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 z m 2,83 c \n-13,0 -23,11 -23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 \nz",upper:-4,lower:3},71:{path:"M 139,48 C 102,57 76,120 131,151 41,128 64,24 129,2 L \n117,-57 C -32,47 26,217 166,182 Z m 12,-1 27,131 C 242,153 216,46 151,47 \nZ m -35,-177 c 34,-23 82,-117 50,-140 -23,-17 -71,33 -50,140 z m -10,10 c \n-23,-77 -20,-200 48,-213 19,-4 89,171 -26,266 l 13,66 c 120,-6 137,155 \n39,191 l 12,58 c 30,131 -137,145 -138,47 0,-29 37,-59 63,-37 21,18 25,71 \n-25,70 32,42 103,0 91,-65 L 167,193 C 56,232 -112,63 106,-120 Z",upper:-7,lower:8}},v=[null,"m -49,-121 v 52 l -29,9 v -48 h -8 v 51 l -20,6 v 29 l \n20,-6 v 70 l -20,6 v 30 l 20,-6 v 51 h 8 V 69 l 30,-8 v 50 h 8 V 58 l 20,-6 \nV 23 l -20,6 v -71 l 20,-6 v -29 l -20,6 v -50 z m 1,82 v 71 l -29,9 v -71 z","M -106,-166 V 67 c 52,-42 85,-56 85,-94 0,-47 -46,-51 \n-73,-22 v -117 z m 31,120 c 20,0 42,46 -20,91 V -7 c 0,-28 10,-39 20,-39 z","m -81,-58 v -48 H -92 V 73 l 60,-13 v 50 h 11 V -72 Z m \n50,24 v 58 l -50,11 v -58 z"]},function(e,t,n){"use strict";n.r(t),n.d(t,"MIN_RESOLUTION",(function(){return r})),n.d(t,"STEM_WIDTH",(function(){return a})),n.d(t,"LINE_STROKE",(function(){return i})),n.d(t,"COMPACT_SPACING",(function(){return o}));var r=.0625,a=15,i=1,o=150},function(e,t,n){"use strict";n.r(t),n.d(t,"MAX_QUARTER_DIVISION",(function(){return c})),n.d(t,"ScrollType",(function(){return r})),n.d(t,"StaffSVGRender",(function(){return l}));var r,a=n(2),i=n(0),o=n(1),s=[{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[0,1,0,1,0,0,1,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,0,3,0,3,0,0,3,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,0,1,0,3,0,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,0,3,0,2,0,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,3,0,0,3,0,3,0,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,2,0,0,2,0,2,0,0,3]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-7],accidental:[3,0,3,0,3,0,0,3,0,3,0,0]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[0,1,0,1,0,3,0,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,0,3,0,3,0,2,0,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,0,1,0,3,0,3,0,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,0,3,0,2,0,2,0,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,3,0,0,3,0,3,0,3,0,0]}],u=[{accidental:1,pitches:[]},{accidental:2,pitches:[70,75,68,73,66]},{accidental:1,pitches:[78,73]},{accidental:2,pitches:[70,75,68]},{accidental:1,pitches:[78,73,80,75]},{accidental:2,pitches:[70]},{accidental:2,pitches:[70,75,68,73,66,71]},{accidental:1,pitches:[78]},{accidental:2,pitches:[70,75,68,73]},{accidental:1,pitches:[78,73,80]},{accidental:2,pitches:[70,75]},{accidental:1,pitches:[78,73,80,75,70]}],c=16;!function(e){e[e.PAGE=0]="PAGE",e[e.NOTE=1]="NOTE",e[e.BAR=2]="BAR"}(r||(r={}));var l=function(){function e(t,n,i){var s=this;_classCallCheck2(this,e),this.handleScrollEvent=function(e){s.lastKnownScrollLeft=s.parentElement.scrollLeft,s.ticking||window.requestAnimationFrame((function(){s.changeAndDrawSignaturesIfNeeded(s.lastKnownScrollLeft),s.ticking=!1})),s.ticking=!0},this.scoreInfo=t,this.config={noteHeight:n.noteHeight||6,noteSpacing:n.noteSpacing||1,pixelsPerTimeStep:n.pixelsPerTimeStep||30,noteRGB:n.noteRGB||"8, 41, 64",activeNoteRGB:n.activeNoteRGB||"240, 84, 119"},this.div=i,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.key=n.defaultKey||0,this.scrollType=n.scrollType||r.PAGE,this.scale=this.config.noteHeight/o.PATH_SCALE,(void 0===n.pixelsPerTimeStep||n.pixelsPerTimeStep<=0)&&(this.config.pixelsPerTimeStep=0,this.config.noteSpacing=a.COMPACT_SPACING*this.scale),this.clear(),this.redraw()}return _createClass2(e,[{key:"clear",value:function(){for(;this.div.lastChild;)this.div.removeChild(this.div.lastChild);this.div.style.overflow="visible",this.div.style.position="relative",this.overlaySVG=document.createElementNS(i.SVGNS,"svg"),this.overlaySVG.style.position="absolute",this.div.appendChild(this.overlaySVG),this.overlayG=Object(i.createSVGGroupChild)(this.overlaySVG,"overlay"),this.signaturesBlinking=!1,this.signaturesQuarters=0,this.parentElement=document.createElement("div"),this.parentElement.style.overflow="auto",this.div.appendChild(this.parentElement),this.ticking=!1,this.lastKnownScrollLeft=0,this.parentElement.addEventListener("scroll",this.handleScrollEvent),this.staffSVG=document.createElementNS(i.SVGNS,"svg"),this.parentElement.appendChild(this.staffSVG),this.staffG=Object(i.createSVGGroupChild)(this.staffSVG,"staff"),this.linesG=Object(i.createSVGGroupChild)(this.staffSVG,"lines"),this.setStroke(this.linesG),this.staffG.appendChild(this.linesG),this.musicG=Object(i.createSVGGroupChild)(this.staffSVG,"music"),this.setFill(this.musicG),this.setStroke(this.musicG,0),this.staffG.appendChild(this.musicG),this.signaturesG=Object(i.createSVGGroupChild)(this.staffSVG,"signatures"),this.staffG.appendChild(this.signaturesG);var e=0,t=0;this.scoreInfo.notes.forEach((function(n){e+=n.pitch,++t})),this.clef=e/t<60?50:71,this.signaturesList=[{x:0,q:0}],this.signatureCurrent=0,this.signatureNext=0,this.changeKeySignatureIfNeeded(0),this.changeTimeSignatureIfNeeded(0),this.vStepSize=this.config.noteHeight/2,this.hStepSize=this.config.pixelsPerTimeStep,this.staffOffset=0,this.height=0,this.width=0,this.musicBlockMap=new Map,this.playingNotes=[],this.lastBar=0,this.barAccidentals={},this.lastQ=-1}},{key:"isPaintingActiveNote",value:function(e,t){return e.start===t.start||e.start<=t.start&&e.start+e.length>=t.start+t.length}},{key:"redraw",value:function(e,t){var n=this,a=-1,o=0===this.config.pixelsPerTimeStep;if(e){var s=[];this.playingNotes.forEach((function(t){n.isPaintingActiveNote(t,e)?s.push(t):n.highlightElement(n.getGroup(t),!1)})),this.playingNotes=s;var u=this.getGroup(e);if(u){this.playingNotes.push(e),this.highlightElement(u,!0),a=u.getBoundingClientRect().left-this.staffSVG.getBoundingClientRect().left;var c=e.start,l=u.getAttribute("data-is-bar-beginning");(this.scrollType!==r.BAR||l)&&this.scrollIntoViewIfNeeded(t,a),!o&&this.signaturesBlinking&&c>=this.signaturesQuarters&&(this.signaturesBlinking=!1,Object(i.setFade)(this.overlayG,this.signaturesBlinking))}}else{this.setDetails();var h=0,f=0;-1===this.lastQ?(f=this.drawSignatures(this.overlayG,h,!0,!0,!0),o&&(this.width=0,f+=this.config.noteSpacing),f+=this.drawRests(this.initialRest,h+f)):h=this.width,this.musicBlockMap.forEach((function(e,t){o||(h=n.quartersToTime(t)*n.hStepSize),t>n.lastQ?(f+=n.drawMusicBlock(e,h+f),n.lastQ=t):t===n.lastQ&&(f+=n.drawRests(e,h+f))}));var d=this.staffSVG.getBoundingClientRect(),p=this.musicG.getBoundingClientRect();if(this.updateVerticalBoundaries(p.top-d.top,p.bottom-d.top),o)this.width+=f;else{var m=this.musicBlockMap.get(this.lastQ),v=this.quartersToTime(this.lastQ+m.notes[0].length);this.width=v*this.config.pixelsPerTimeStep}this.staffSVG.setAttributeNS(null,"width",""+this.width),this.redrawStaff(this.linesG,0,this.width)}return a}},{key:"drawMusicBlock",value:function(e,t){var n=this,r=e.notes[0].start,s=this.drawBarIfNeeded(r,t);s+=this.drawSignaturesIfNeeded(r,t+s);for(var u=0,c=4;c>=a.MIN_RESOLUTION&&!u;c/=2)c<=e.notes[0].length&&(u=c);0===u&&(console.warn(" StaffRender ","background:orange; color:white","StaffRender does not handle notes shorther than 1/".concat(4/a.MIN_RESOLUTION,"th, and this score tries to draw a 1/").concat(0===e.notes[0].length?"[infinite]":""+4/e.notes[0].length,"th. Shortest possible note will be drawn instead.")),u=a.MIN_RESOLUTION);var l,h=o.NOTE_PATHS[u];if(h.stemAnchor&&(l=Object(i.createSVGGroupChild)(this.musicG,"stem")),e.notes.forEach((function(r){for(var a=r.vSteps*n.vStepSize,c=2*(r.vSteps>0?Math.floor(r.vSteps/2):Math.ceil(r.vSteps/2)),l=r.vSteps>0?-2:2,f=c;Math.abs(f)>4;f+=l)Object(i.drawSVGPath)(n.linesG,o.extraLinePath,t+s,f*n.vStepSize,n.scale,1);if(r.g=r.tiedFrom?r.tiedFrom.g:Object(i.createSVGGroupChild)(n.musicG,"".concat(r.start,"-").concat(r.pitch)),e.isBarBeginning&&r.g.setAttribute("data-is-bar-beginning","true"),r.tiedFrom){var d=t+s-r.tiedFrom.xHeadRight;Object(i.drawSVGPath)(r.g,o.tiePath,r.tiedFrom.xHeadRight,a,d/o.PATH_SCALE,n.scale*(r.vSteps<0?-1:1),r.opacity)}Object(i.drawSVGPath)(r.g,h.path,t+s,a,n.scale,n.scale,r.opacity),r.xHeadRight=t+s+h.width*n.scale,1.5*u<=r.length&&Object(i.drawSVGPath)(r.g,o.dotPath,t+s+h.width*n.scale+n.vStepSize/2,a-n.vStepSize/2,n.scale,n.scale,r.opacity),0!==r.accidental&&Object(i.drawSVGPath)(r.g,o.ACCIDENTAL_PATHS[r.accidental],t+s,a,n.scale,n.scale,r.opacity)})),h.stemAnchor){var f,d,p=t+s,m=h.stemAnchor*this.scale,v=e.minVStep+e.maxVStep<0,g=h.flags>2?2*(h.flags-2):0;if(v?(f=e.maxVStep*this.vStepSize-m,d=(e.minVStep+7+g)*this.vStepSize):(p+=(h.width-a.STEM_WIDTH)*this.scale,f=e.minVStep*this.vStepSize+m,d=(e.maxVStep-7-g)*this.vStepSize),Object(i.drawSVGPath)(l,o.stemPath,p,f,this.scale,(d-f)/o.PATH_SCALE),1===h.flags)Object(i.drawSVGPath)(l,o.singleFlagPath,p,d,this.scale,this.scale*(v?-1:1),1);else if(h.flags>1)for(var y=0;y<h.flags;++y)Object(i.drawSVGPath)(l,o.multiFlagPath,p,d,this.scale,this.scale*(v?-1:1),1),d+=(v?-2:2)*this.vStepSize}return 0===this.config.pixelsPerTimeStep&&(s+=h.width*this.scale,l&&(s+=l.getBoundingClientRect().width),s+=this.config.noteSpacing),s+=this.drawRests(e,t+s)}},{key:"drawBarIfNeeded",value:function(e,t){var n=0,r=this.lastBar+this.getBarLength();return 0!==e&&e>=r&&(this.config.pixelsPerTimeStep>0?t-=this.config.noteSpacing:n=this.config.noteSpacing,Object(i.drawSVGPath)(this.linesG,o.barPath,t,0,1,this.scale),this.lastBar=r),n}},{key:"drawRests",value:function(e,t){var n=0,r=e.restToNextLength;if(r){this.config.pixelsPerTimeStep>0&&(t+=this.quartersToTime(e.notes[0].length)*this.hStepSize);var s,u=e.notes[0].start+e.notes[0].length,c=0,l=this.lastBar+this.getBarLength()-u;for(r>l&&(c=r-l,r=l),s=4;s>this.getBarLength()&&s>=a.MIN_RESOLUTION;s/=2);for(var h=s;(r||c)&&h>=a.MIN_RESOLUTION;){if(h<=r){n+=this.drawBarIfNeeded(u,t+n),n+=this.drawSignaturesIfNeeded(u,t+n);var f=Object(i.drawSVGPath)(this.musicG,o.REST_PATHS[h],t+n,0,this.scale,this.scale);this.config.pixelsPerTimeStep>0?t+=this.quartersToTime(h)*this.hStepSize:(n+=f.getBoundingClientRect().width,n+=this.config.noteSpacing),u+=h,r-=h}if(c&&r<=0){var d=this.getBarLength();for(c>d?(r=d,c-=d):(r=c,c=0),s=4;s>this.getBarLength()&&s>=a.MIN_RESOLUTION;s/=2);h=s}r<h&&(h/=2)}}return n}},{key:"redrawStaff",value:function(e,t,n){var r=e.querySelector('g[data-id="staff-five-lines"]');if(r)r.setAttributeNS(null,"transform","scale(".concat(n/o.PATH_SCALE,", 1)"));else{r=Object(i.createSVGGroupChild)(e,"staff-five-lines");for(var a=-4;a<=4;a+=2)Object(i.drawSVGPath)(r,o.staffLinePath,t,0+a*this.vStepSize,n/o.PATH_SCALE,1)}return r}},{key:"clearSignatureOverlay",value:function(){for(;this.overlayG.lastChild;)this.overlayG.removeChild(this.overlayG.lastChild)}},{key:"drawSignaturesIfNeeded",value:function(e,t){var n=0,r=this.changeKeySignatureIfNeeded(e),o=this.changeTimeSignatureIfNeeded(e);if(r||o){this.signaturesList.push({x:t-a.COMPACT_SPACING*this.scale*(this.config.pixelsPerTimeStep>0?3:2),q:e}),null===this.signatureNext&&(this.signatureNext=t);var s=e>0?Object(i.createSVGGroupChild)(this.signaturesG,"signatures"):this.overlayG;n+=this.drawSignatures(s,t+n,!1,r,o)}return 0===this.config.pixelsPerTimeStep?n:0}},{key:"drawSignatures",value:function(e,t,n,r,s){var c,l=this,h=a.COMPACT_SPACING*this.scale,f=h,d=e===this.overlayG||this.config.pixelsPerTimeStep>0;if(d){(c=document.createElementNS(i.SVGNS,"rect")).setAttributeNS(null,"x",""+t),c.setAttributeNS(null,"y","0"),c.setAttributeNS(null,"width","1"),c.setAttributeNS(null,"height","1"),c.setAttribute("data-id","background"),e.appendChild(c);var p=document.defaultView.getComputedStyle(this.div.parentElement);c.setAttributeNS(null,"fill",p.getPropertyValue("background-color"))}if(n){var m=Object(i.drawSVGPath)(e,o.CLEF_PATHS[this.clef].path,t+f,0,this.scale,this.scale);this.setFill(m),f+=3*h}if(r){var v=u[this.key].accidental,g=71===this.clef?0:14;u[this.key].pitches.forEach((function(n){var r=l.getPitchDetails(n).vSteps,a=Object(i.drawSVGPath)(e,o.ACCIDENTAL_PATHS[v],t+f,(g+r)*l.vStepSize,l.scale,l.scale);l.setFill(a),f+=a.getBoundingClientRect().width}))}if(s){var y=Object(i.createSVGGroupChild)(e,"time-key"),_=2.85*this.config.noteHeight+"px";Object(i.drawSVGText)(y,""+this.timeSignatureNumerator,t+f,-.5,_,!0),Object(i.drawSVGText)(y,""+this.timeSignatureDenominator,t+f,4*this.vStepSize-.5,_,!0),this.setFill(y),f+=y.getBoundingClientRect().width+h}var b=this.redrawStaff(e,t,f);this.setStroke(b);var k=this.div.getBoundingClientRect(),w=e.getBoundingClientRect();if(this.updateVerticalBoundaries(w.top-k.top,w.bottom-k.top),d&&(c.setAttributeNS(null,"y",""+-this.staffOffset),c.setAttributeNS(null,"height",""+this.height),c.setAttributeNS(null,"width",""+f)),e===this.overlayG){this.overlaySVG.setAttributeNS(null,"width",""+(f+5));for(var x=0;x<5;++x){var C=Object(i.drawSVGPath)(e,o.stemPath,f+x,x*x-this.staffOffset,1/a.STEM_WIDTH,(this.height-2*x*x)/o.PATH_SCALE,(x-5)*(x-5)*2/o.PATH_SCALE);this.setFill(C)}}if(this.config.pixelsPerTimeStep>0){var S=0===this.signaturesQuarters;return S&&(this.signaturesQuarters=this.timeToQuarters(f/this.hStepSize)),(S||t>0)&&(this.signaturesBlinking=!0,Object(i.setFade)(e,this.signaturesBlinking)),0}return f}},{key:"changeKeySignatureIfNeeded",value:function(e){if(this.scoreInfo.keySignatures){for(var t=this.key,n=0;n<this.scoreInfo.keySignatures.length&&this.scoreInfo.keySignatures[n].start<=e;++n)t=this.scoreInfo.keySignatures[n].key;if(t!==this.key)return this.key=t,!0}return!1}},{key:"changeTimeSignatureIfNeeded",value:function(e){if(this.scoreInfo.timeSignatures){for(var t=this.timeSignatureNumerator,n=this.timeSignatureDenominator,r=0;r<this.scoreInfo.timeSignatures.length&&this.scoreInfo.timeSignatures[r].start<=e;++r)t=this.scoreInfo.timeSignatures[r].numerator,n=this.scoreInfo.timeSignatures[r].denominator;if(t!==this.timeSignatureNumerator||n!==this.timeSignatureDenominator)return this.timeSignatureNumerator=t,this.timeSignatureDenominator=n,!0}return!1}},{key:"changeAndDrawSignaturesIfNeeded",value:function(e){var t;if(e<this.signatureCurrent||null!==this.signatureNext&&this.signatureNext<=e){t=this.signaturesList[0].q,this.signatureNext=null;for(var n=0;n<this.signaturesList.length;++n){if(e<this.signaturesList[n].x){this.signatureNext=this.signaturesList[n].x;break}this.signatureCurrent=this.signaturesList[n].x,t=this.signaturesList[n].q}}if(void 0!==t){var r=this.key,a=this.timeSignatureNumerator,o=this.timeSignatureDenominator;this.changeKeySignatureIfNeeded(t),this.changeTimeSignatureIfNeeded(t),this.clearSignatureOverlay(),this.drawSignatures(this.overlayG,0,!0,!0,!0),this.key=r,this.timeSignatureNumerator=a,this.timeSignatureDenominator=o}this.config.pixelsPerTimeStep>0&&0===e&&(this.signatureNext=0,this.signaturesBlinking=!0,Object(i.setFade)(this.overlayG,this.signaturesBlinking))}},{key:"getBarLength",value:function(){return 4*this.timeSignatureNumerator/this.timeSignatureDenominator}},{key:"scrollIntoViewIfNeeded",value:function(e,t){if(e)if(this.scrollType===r.PAGE){var n=this.parentElement.getBoundingClientRect().width;t>this.parentElement.scrollLeft+n&&(this.parentElement.scrollLeft=t-20)}else{var a=this.parentElement.getBoundingClientRect().width;this.parentElement.scrollLeft=t-.5*a}}},{key:"updateVerticalBoundaries",value:function(e,t){var n=0;if(e<0){this.staffOffset-=e;var r="translate(0, ".concat(this.staffOffset,")");this.overlayG.setAttributeNS(null,"transform",r),this.staffG.setAttributeNS(null,"transform",r),n=this.height-e}if((n=Math.max(n,t-e))>this.height){this.height=n,this.overlaySVG.setAttributeNS(null,"height",""+this.height),this.staffSVG.setAttributeNS(null,"height",""+this.height);for(var a=this.div.querySelectorAll('rect[data-id="background"]'),i=0;i<a.length;++i){var o=a[i];o.setAttributeNS(null,"y",""+-this.staffOffset),o.setAttributeNS(null,"height",""+this.height)}}}},{key:"setFill",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.setAttributeNS(null,"fill",this.getColor(t))}},{key:"setStroke",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.LINE_STROKE,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.setAttributeNS(null,"stroke",this.getColor(n)),e.setAttributeNS(null,"stroke-width",""+t)}},{key:"getColor",value:function(e){return"rgb(".concat(e?this.config.activeNoteRGB:this.config.noteRGB,")")}},{key:"getOpacity",value:function(e){return e?e/127*.8+.2:1}},{key:"getGroup",value:function(e){return this.staffSVG.querySelector('g[data-id="'.concat(e.start,"-").concat(e.pitch,'"]'))}},{key:"highlightElement",value:function(e,t){e.setAttribute("fill",this.getColor(t)),e.setAttribute("stroke",this.getColor(t))}},{key:"getBarBeginnings",value:function(){var e=new Set,t=0;this.scoreInfo.notes.forEach((function(e){e.start+e.length>t&&(t=e.start+e.length)}));var n=this.scoreInfo.timeSignatures?this.scoreInfo.timeSignatures.slice(0):[{start:0,numerator:4,denominator:4}];n.sort((function(e,t){return e.start-t.start}));for(var r=0,a=0;a<n.length;++a)for(var i=a===n.length-1?t:n[a].start,o=4*n[a].numerator/n[a].denominator;r<i;r+=o)e.add(r);return e}},{key:"quartersToTime",value:function(e){return e/this.scoreInfo.tempos[0].qpm*60}},{key:"timeToQuarters",value:function(e){return e*this.scoreInfo.tempos[0].qpm/60}},{key:"setDetails",value:function(){var e=this,t=new Map,n=this.getBarBeginnings(),r=new Set(n);this.scoreInfo.notes.slice().sort((function(e,t){return e.start-t.start})).forEach((function(n){var a=e.getQNote(n);r.add(a.start),r.add(a.start+a.length),t.has(a.start)?t.get(a.start).push(a):t.set(a.start,[a])})),Array.from(r).sort((function(e,t){return e-t})).forEach((function(n){var r=[];t.forEach((function(t){t.forEach((function(t){var a=e.splitQNote(t,n);a&&r.push(a)}))})),r.forEach((function(e){t.has(e.start)?t.get(e.start).push(e):t.set(e.start,[e])}))})),t=new Map(Array.from(t).sort((function(e,t){return e[0]-t[0]})));var a=this.key,i=null,o=0,s=n[Symbol.iterator](),u=s.next();t.forEach((function(t,n){var r={maxVStep:Number.MAX_SAFE_INTEGER,minVStep:Number.MIN_SAFE_INTEGER,restToNextLength:0,isBarBeginning:!1,notes:[]};e.changeKeySignatureIfNeeded(n);var a=u.value+e.getBarLength();!u.done&&n>=a&&(u=s.next(),e.barAccidentals={},r.isBarBeginning=!0),t.forEach((function(t){e.analyzePitch(t,n),r.minVStep=Math.max(t.vSteps,r.minVStep),r.maxVStep=Math.min(t.vSteps,r.maxVStep),r.notes.push(t)})),i&&(i.restToNextLength=n-o),e.musicBlockMap.set(n,r),i=r,o=n+r.notes[0].length})),this.initialRest={maxVStep:0,minVStep:0,restToNextLength:this.musicBlockMap.values().next().value.notes[0].start,isBarBeginning:!0,notes:[{start:0,length:0,vSteps:0,accidental:0,opacity:0,pitch:0,xHeadRight:0}]},this.key=a}},{key:"getQNote",value:function(e){return{start:e.start,length:e.length,vSteps:0,accidental:0,opacity:this.getOpacity(e.intensity),pitch:e.pitch,xHeadRight:0}}},{key:"splitQNote",value:function(e,t){var n=e.start+e.length-t;return t>e.start&&n>0?(e.length-=n,{start:t,length:n,vSteps:e.vSteps,accidental:e.accidental,opacity:e.opacity,pitch:e.pitch,xHeadRight:0,tiedFrom:e}):null}},{key:"analyzePitch",value:function(e,t){var n=this.getPitchDetails(e.pitch);n.vSteps in this.barAccidentals?n.accidental===this.barAccidentals[n.vSteps]?n.accidental=0:(3===this.barAccidentals[n.vSteps]?n.accidental=n.keyAccidental:0===n.accidental&&(n.accidental=3),this.barAccidentals[n.vSteps]=n.accidental):(e.tiedFrom&&(n.accidental=0),this.barAccidentals[n.vSteps]=n.accidental),e.vSteps=n.vSteps,e.accidental=n.accidental}},{key:"getPitchDetails",value:function(e){var t=e-60,n=Math.floor(t/12),r=t-12*n;return{vSteps:(71===this.clef?6:-6)-7*n+s[this.key].steps[r],accidental:s[this.key].accidental[r],keyAccidental:u[this.key].pitches.indexOf(1===u[this.key].accidental?69+(r+3)%12:64+(r+8)%12)>-1?u[this.key].accidental:0}}}]),e}()},function(e,t,n){"use strict";n.r(t);var r=n(3);n.d(t,"MAX_QUARTER_DIVISION",(function(){return r.MAX_QUARTER_DIVISION})),n.d(t,"ScrollType",(function(){return r.ScrollType})),n.d(t,"StaffSVGRender",(function(){return r.StaffSVGRender}))}])},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";(function(e){var t,r=n(11),a=function(){return n(159)};Object(r.b)().get("IS_NODE")&&Object(r.b)().setPlatform("node",new(function(){function i(){_classCallCheck2(this,i),this.util=n(160),this.textEncoder=new this.util.TextEncoder}return _createClass2(i,[{key:"fetch",value:function(e,n){return null!=Object(r.b)().global.fetch?Object(r.b)().global.fetch(e,n):(null==t&&(t=a()),t(e,n))}},{key:"now",value:function(){var t=e.hrtime();return 1e3*t[0]+t[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),i}()))}).call(this,n(44))},function(e,t){},function(e,t){},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(22)&&n(32)?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e,n(22))}).call(this,n(31)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(22)&&n(32)?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e,n(22))}).call(this,n(31)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(22)&&n(32)?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e,n(22))}).call(this,n(31)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(22)&&n(32)?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e,n(22))}).call(this,n(31)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n=a[i]=(n^=n>>>15)^(e^=e>>>12),t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(a=0==(n=s[127&i]^=r+(o=o+1640531527|0))?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,s[a]=(r^=r>>>15)^(n^=n>>>12);e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(22)&&n(32)?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e,n(22))}).call(this,n(31)(e))},function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n(22)&&n(32)?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e,n(22))}).call(this,n(31)(e))},function(e,t,n){var r;!function(a,i){var o,s=this,u=i.pow(256,6),c=i.pow(2,52),l=2*c;function h(e,t,n){var r=[],h=p(function e(t,n){var r,a=[],i=typeof t;if(n&&"object"==i)for(r in t)try{a.push(e(t[r],n-1))}catch(e){}return a.length?a:"string"==i?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,m(a)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(256):(e=new Uint8Array(256),(s.crypto||s.msCrypto).getRandomValues(e)),m(e)}catch(e){var t=s.navigator,n=t&&t.plugins;return[+new Date,s,n,s.screen,m(a)]}}():e,3),r),v=new f(r),g=function(){for(var e=v.g(6),t=u,n=0;e<c;)e=256*(e+n),t*=256,n=v.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return g.int32=function(){return 0|v.g(4)},g.quick=function(){return v.g(4)/4294967296},g.double=g,p(m(v.S),a),(t.pass||n||function(e,t,n,r){return r&&(r.S&&d(r,v),e.state=function(){return d(v,{})}),n?(i.random=e,t):e})(g,h,"global"in t?t.global:this==i,t.state)}function f(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<256;)o[a]=a++;for(a=0;a<256;a++)o[a]=o[i=255&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=255&a+1],n=256*n+o[255&(o[a]=o[i=255&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(256)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function p(e,t){for(var n,r=e+"",a=0;a<r.length;)t[255&a]=255&(n^=19*t[255&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(i.seedrandom=h,p(i.random(),a),e.exports){e.exports=h;try{o=n(168)}catch(e){}}else void 0===(r=(function(){return h}).call(t,n,t,e))||(e.exports=r)}([],Math)},function(e,t){},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,a=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(a.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new i(a.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(170),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(21))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,a,i,o,s,u=1,c={},l=!1,h=e.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(e);f=f&&f.setTimeout?f:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){p(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?(o="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(o)&&p(+t.data.slice(o.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(o+t,"*")}):e.MessageChannel?((i=new MessageChannel).port1.onmessage=function(e){p(e.data)},r=function(e){i.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(a=h.documentElement,r=function(e){var t=h.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,a.removeChild(t),t=null},a.appendChild(t)}):r=function(e){setTimeout(p,0,e)},f.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var a={callback:e,args:t};return c[u]=a,r(u),u++},f.clearImmediate=d}function d(e){delete c[e]}function p(e){if(l)setTimeout(p,0,e);else{var t=c[e];if(t){l=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{d(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(21),n(44))},function(e,t,n){"use strict";n.r(t);var r=n(9);n.d(t,"NoteSequence",(function(){return r.a}))},function(e,t,n){"use strict";n.r(t),n.d(t,"DDSP",(function(){return ya}));var r={};n.r(r),n.d(r,"simpleAbsImpl",(function(){return z})),n.d(r,"addImpl",(function(){return H})),n.d(r,"ceilImpl",(function(){return Y})),n.d(r,"expImpl",(function(){return Z})),n.d(r,"expm1Impl",(function(){return J})),n.d(r,"floorImpl",(function(){return $})),n.d(r,"logImpl",(function(){return ee})),n.d(r,"maxImpl",(function(){return te})),n.d(r,"multiplyImpl",(function(){return ne})),n.d(r,"notEqualImpl",(function(){return ae})),n.d(r,"rsqrtImpl",(function(){return ie})),n.d(r,"sliceImpl",(function(){return oe})),n.d(r,"squaredDifferenceImpl",(function(){return se})),n.d(r,"subImpl",(function(){return ue})),n.d(r,"transposeImpl",(function(){return le})),n.d(r,"uniqueImpl",(function(){return he}));var a,i,o,s=n(0),u={},c={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function l(e){if(!(e in u)){var t=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete u[e]}),!1),1===e?t.getContext("webgl",c)||t.getContext("experimental-webgl",c):t.getContext("webgl2",c)}(e);if(null===t)return console.log("Could not get context for WebGL version",e),null;u[e]=t}var n=u[e];return n.isContextLost()?(delete u[e],l(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),u[e])}function h(e,t){return[t,e]}function f(e){var t=s.Lb.sizeFromShape(e),n=Math.ceil(t/4);return s.Lb.sizeToSquarishShape(n)}function d(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function p(e,t){var n,r,a,i,o,u,c,l,h,f=e;return 2===Object(s.jb)().getNumber("WEBGL_VERSION")?(n=f.R32F,r=f.R16F,a=f.RGBA16F,i=f.RGBA32F,o=f.RED,u=4,c=1,l=f.HALF_FLOAT,h=f.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=f.RGBA,o=e.RGBA,u=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,h=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:h}}function m(e,t){var n=t();return Object(s.jb)().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}(e,t))}(e),n}function v(e){return!!(Object(s.jb)().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function g(e,t){return A(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function y(e,t){var n=A(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(m(e,(function(){return e.shaderSource(n,t)})),m(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){var n=k.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return s.Lb.rightPad((t+1).toString(),i)+e})),u=0,c=0;c<o.length;c++)u=Math.max(o[c].length,u);var l=o.slice(0,r-1),h=o.slice(r-1,r),f=o.slice(r);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+s.Lb.rightPad(h[0],u),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(a||(a={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(i||(i={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(o||(o={}));var _,b,k=/ERROR: [0-9]+:([0-9]+):/g;function w(e,t){if(m(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function x(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(m(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),m(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),m(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function C(e,t,n){m(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),m(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function S(e,t){m(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),m(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function T(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}(e,t))}function A(e,t,n){var r=m(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return s.Lb.sizeFromShape(e.slice(0,e.length-t))}function I(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function R(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[E(e)].concat(_toConsumableArray(I(e)))),t}function O(e){return e%2==0}function N(e,t){if(e=e.slice(-2),t=t.slice(-2),s.Lb.arraysEqual(e,t))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(O(n)&&O(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&O(e[0])&&O(t[0])}function D(e,t){return null!=e.getExtension(t)}function P(e){try{if(null!=l(e))return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function F(e){var t=p(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function M(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&s.Lb.assert("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors in the WebGL backend."}))}))}var L=Object(s.jb)();function z(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}function B(e){return function(t,n,r,a,i){var o=s.X.assertAndGetBroadcastShape(t,n),u=o.length,c=s.Lb.computeStrides(o),l=s.Lb.sizeFromShape(o),h=s.Lb.getTypedArrayFromDType(i,l),f=t.length,d=n.length,p=s.Lb.computeStrides(t),m=s.Lb.computeStrides(n),v=s.X.getBroadcastDims(t,o),g=s.X.getBroadcastDims(n,o);if(v.length+g.length===0)for(var y=0;y<h.length;++y)h[y]=e(r[y%r.length],a[y%a.length]);else for(var _=function(t){var n=s.Lb.indexToLoc(t,u,c),i=n.slice(-f);v.forEach((function(e){return i[e]=0}));var o=s.Lb.locToIndex(i,f,p),l=n.slice(-d);g.forEach((function(e){return l[e]=0}));var y=s.Lb.locToIndex(l,d,m);h[t]=e(r[o],a[y])},b=0;b<h.length;++b)_(b);return[h,o]}}function j(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&s.Lb.assert("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors in the CPU backend."}))}))}function V(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}function q(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function U(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return q({inputs:{x:a},backend:n});var o=s.Nb(a.shape),u=U({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),c=V({inputs:{real:u,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(u),c}if("complex64"===a.dtype){var l=function(e){var t=e.backend,n=e.inputs.input,r=t.data.get(n.dataId).complexTensorInfos.real,a=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,a)}({inputs:{input:a},backend:n}),h=U({inputs:{x:l},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(l),h}if(!s.Lb.hasEncodingLoss(a.dtype,i)){var f=q({inputs:{x:a},backend:n});return{dataId:f.dataId,shape:f.shape,dtype:i}}if("int32"===i){var d=n.data.get(a.dataId).values,p=Int32Array.from(d);return n.makeTensorInfo(a.shape,"int32",p)}if("bool"===i){var m=n.data.get(a.dataId).values,v=s.Lb.toTypedArray([0],a.dtype),g=_slicedToArray2(B((function(e,t){return e!==t?1:0}))(a.shape,[],m,v,"bool"),2),y=g[0],_=g[1];return n.makeTensorInfo(_,"bool",y)}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(i))}function W(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;j([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,h=r||o.dtype,f=_slicedToArray2(t(o.shape,s.shape,c,l,h),2),d=f[0],p=f[1];return u.makeTensorInfo(p,h,d)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=U({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),l=u.data.get(c.dataId),h=l.complexTensorInfos.imag,f=u.data.get(l.complexTensorInfos.real.dataId).values,d=u.data.get(h.dataId).values,p=U({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),m=u.data.get(p.dataId),v=m.complexTensorInfos.imag,g=u.data.get(m.complexTensorInfos.real.dataId).values,y=u.data.get(v.dataId).values,_=_slicedToArray2(n(o.shape,s.shape,f,d,g,y),3),b=_[0],k=_[1],w=_[2],x=u.makeTensorInfo(w,"float32",b),C=u.makeTensorInfo(w,"float32",k),S=V({inputs:{real:x,imag:C},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(p),u.disposeIntermediateTensorInfo(x),u.disposeIntermediateTensorInfo(C),S}var T=u.data.get(o.dataId).values,A=u.data.get(s.dataId).values,E=r||o.dtype,I=_slicedToArray2(t(o.shape,s.shape,T,A,E),2),R=I[0],O=I[1];return u.makeTensorInfo(O,E,R)}}function G(e){return function(t,n,r,a,i,o){var u=s.X.assertAndGetBroadcastShape(t,n),c=s.Lb.sizeFromShape(u),l=u.length,h=s.Lb.computeStrides(u),f=s.Lb.getTypedArrayFromDType("float32",c),d=s.Lb.getTypedArrayFromDType("float32",c),p=s.X.getBroadcastDims(t,u),m=s.X.getBroadcastDims(n,u),v=s.X.mergeRealAndImagArrays(r,a),g=s.X.mergeRealAndImagArrays(i,o),y=t.length,_=s.Lb.computeStrides(t),b=n.length,k=s.Lb.computeStrides(n);if(p.length+m.length===0)for(var w=0;w<f.length;w++){var x=w%v.length,C=w%g.length,S=e(v[2*x],v[2*x+1],g[2*C],g[2*C+1]);f[w]=S.real,d[w]=S.imag}else for(var T=function(t){var n=s.Lb.indexToLoc(t,l,h),r=n.slice(-y);p.forEach((function(e){return r[e]=0}));var a=s.Lb.locToIndex(r,y,_),i=n.slice(-b);m.forEach((function(e){return i[e]=0}));var o=s.Lb.locToIndex(i,b,k),u=e(v[2*a],v[2*a+1],g[2*o],g[2*o+1]);f[t]=u.real,d[t]=u.imag},A=0;A<f.length;A++)T(A);return[f,d,u]}}L.registerFlag("HAS_WEBGL",(function(){return L.getNumber("WEBGL_VERSION")>0})),L.registerFlag("WEBGL_VERSION",(function(){return P(2)?2:P(1)?1:0})),L.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),L.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===L.get("WEBGL_VERSION")})),L.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),L.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),L.registerFlag("WEBGL_PACK",(function(){return L.getBool("HAS_WEBGL")})),L.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return L.getBool("WEBGL_PACK")})),L.registerFlag("WEBGL_PACK_CLIP",(function(){return L.getBool("WEBGL_PACK")})),L.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),L.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return L.getBool("WEBGL_PACK")})),L.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return L.getBool("WEBGL_PACK")})),L.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return L.getBool("WEBGL_PACK")})),L.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return L.getBool("WEBGL_PACK")})),L.registerFlag("WEBGL_PACK_REDUCE",(function(){return L.getBool("WEBGL_PACK")})),L.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return L.getBool("WEBGL_PACK")})),L.registerFlag("WEBGL_CONV_IM2COL",(function(){return L.getBool("WEBGL_PACK")})),L.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==_){var t=l(e);_=t.getParameter(t.MAX_TEXTURE_SIZE)}return _}(L.getNumber("WEBGL_VERSION"))})),L.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==b){var t=l(e);b=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,b)}(L.getNumber("WEBGL_VERSION"))})),L.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=L.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=l(e);return D(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:D(t,"EXT_disjoint_timer_query")?1:0}(e)})),L.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return L.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!s.fb.isMobile()})),L.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=l(e);if(1===e){if(!D(t,"OES_texture_float"))return!1}else if(!D(t,"EXT_color_buffer_float"))return!1;return F(t)}(L.getNumber("WEBGL_VERSION"))})),L.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!L.getBool("WEBGL_FORCE_F16_TEXTURES")&&L.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),L.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return function(e){if(0===e)return!1;var t=l(e);if(1!==e){if(D(t,"EXT_color_buffer_float"))return F(t);var n="EXT_color_buffer_half_float";if(D(t,n)){var r=t.getExtension(n);return function(e,t){var n=p(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}(t,r)}return!1}return!!D(t,"OES_texture_float")&&!!D(t,"WEBGL_color_buffer_float")&&F(t)}(L.getNumber("WEBGL_VERSION"))})),L.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=L.getNumber("WEBGL_VERSION"))&&null!=l(e).fenceSync;var e})),L.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return L.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),L.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))}));var H=B((function(e,t){return e+t})),K=G((function(e,t,n,r){return{real:e+n,imag:t+r}}));function X(e){return function(t,n,r){for(var a=s.Lb.getTypedArrayFromDType(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function Q(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(j(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,h=t(c,l,i);return u.makeTensorInfo(s.shape,l,h)}}W(s.b,H,K);var Y=X((function(e){return Math.ceil(e)})),Z=(Q(s.g,Y),X((function(e){return Math.exp(e)}))),J=(Q(s.m,Z),X((function(e){return Math.expm1(e)}))),$=(Q(s.n,J),X((function(e){return Math.floor(e)}))),ee=(Q(s.q,$),X((function(e){return Math.log(e)})));function te(e,t,n,r){for(var a=s.Lb.getTypedArrayFromDType(r,s.Lb.sizeFromShape(n)),i=0;i<a.length;++i){for(var o=i*t,u=e[o],c=0;c<t;++c){var l=e[o+c];l>u&&(u=l)}a[i]=u}return a}Q(s.x,ee);var ne=B((function(e,t){return e*t})),re=G((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),ae=(W(s.E,ne,re),B((function(e,t){return e!==t?1:0}))),ie=(W(s.I,ae,null,"bool"),X((function(e){return 1/Math.sqrt(e)})));function oe(e,t,n,r,a){var i=s.Ab.isSliceContinous(r,t,n),o=s.Lb.sizeFromShape(n),u=s.Lb.computeStrides(r);if(i){var c=s.Ab.computeFlatOffset(t,u);return e.subarray(c,c+o)}for(var l=s.Lb.getTypedArrayFromDType(a,o),h=0;h<o;++h){var f=n.length,d=s.Lb.computeStrides(n),p=s.Lb.indexToLoc(h,f,d).map((function(e,n){return e+t[n]})),m=s.Lb.locToIndex(p,r.length,u);l[h]=e[m]}return l}Q(s.M,ie);var se=B((function(e,t){var n=e-t;return n*n})),ue=(W(s.Q,se),B((function(e,t){return e-t}))),ce=G((function(e,t,n,r){return{real:e-n,imag:t-r}}));function le(e,t,n,r,a){for(var i=t.length,o=s.Lb.sizeFromShape(t),u=s.Lb.computeStrides(t),c=s.Lb.computeStrides(a),l=s.Lb.getTypedArrayFromDType(n,s.Lb.sizeFromShape(a)),h=0;h<o;++h){for(var f=s.Lb.indexToLoc(h,i,u),d=new Array(f.length),p=0;p<d.length;p++)d[p]=f[r[p]];l[s.Lb.locToIndex(d,i,c)]=e[h]}return l}function he(e,t,n,r){for(var a=s.Lb.parseAxisParam(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var u=a+1;u<n.length;u++)i[2]*=n[u];for(var c={},l=new Int32Array(n[a]),h=new s.T(i,r,e),f=[],d=1===i[0]&&1===i[2],p=0;p<n[a];p++){var m=void 0;if(d)m=e[p].toString();else{for(var v=[],g=0;g<i[0];g++)for(var y=0;y<i[2];y++)v.push(h.get(g,p,y));m=v.join(",")}if(void 0!==c[m])l[p]=c[m];else{var _=Object.keys(c).length;c[m]=_,l[p]=_,f.push(p)}}var b=i.slice();b[1]=Object.keys(c).length;var k=new s.T(b,r);f.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)k.set(h.get(n,e,r),n,t,r)}));var w=n.slice();return w[a]=b[1],{outputValues:k.values,outputShape:w,indices:l}}W(s.R,ue,ce);var fe=r.simpleAbsImpl,de=r.addImpl,pe=r.ceilImpl,me=r.expImpl,ve=r.expm1Impl,ge=r.floorImpl,ye=r.logImpl,_e=r.maxImpl,be=r.multiplyImpl,ke=r.rsqrtImpl,we=r.sliceImpl,xe=r.subImpl,Ce=r.transposeImpl,Se=r.uniqueImpl,Te=function e(t,n){_classCallCheck2(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T"+t}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")},Ae=function e(t,n){_classCallCheck2(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T"+t}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")},Ee=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));",";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat("max"===n?">":"<"," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")};function Ie(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function Re(e,t){return 1===t?[e]:Ie(e,t)}function Oe(){var e,t,n,r,a,i,o,u,c,l;return 2===Object(s.jb)().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",u="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",c="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",u="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:u,defineSpecialInf:c,defineRound:l}}function Ne(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=s.Lb.computeStrides(t);return r.map((function(t,a){return"int ".concat(e[a]," = ").concat(n," / ").concat(t,"; ").concat(a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t),";")})).join("")}function De(e){var t=s.Lb.computeStrides(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}var Pe="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",Fe=s.X.getBroadcastDims;function Me(e){return"offset"+e}function Le(e){var t=e.name,n=s.Lb.sizeFromShape(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function ze(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function Be(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function je(e,t){return t.map((function(t){return e[t]})).join(", ")}var Ve=function e(t,n,r,a){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,s.Lb.assert(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=Math.ceil(t[t.length-1]/n);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),a||this.variableNames.push("bestIndicesA");var o,u,c=this.outputShape,l=c.length,h=ze(l),f=Re("coords",l);if(1===i){var d=ze(u=l+1);o="\n        ".concat(d," sourceLocR = ").concat(d,"(").concat(f.join(),", 0);\n        ++").concat(f[l-1],";\n        ").concat(d," sourceLocG = ").concat(d,"(").concat(f.join(),", 0);\n        ++").concat(f[l-2],";\n        ").concat(d," sourceLocA = ").concat(d,"(").concat(f.join(),", 0);\n        --").concat(f[l-1],";\n        ").concat(d," sourceLocB = ").concat(d,"(").concat(f.join(),", 0);\n        --").concat(f[l-2],";")}else u=l,o="\n        ".concat(h," sourceLocR = coords;\n        ++").concat(f[l-1],";\n        ").concat(h," sourceLocG = coords;\n        ++").concat(f[l-2],";\n        ").concat(h," sourceLocA = coords;\n        --").concat(f[l-1],";\n        ").concat(h," sourceLocB = coords;\n        --").concat(f[l-2],";");var p=["x","y","z","w","u","v"].slice(0,u),m="."+p[u-1],v=p.map((function(e){return"int "+e})),g=Re("sourceLocR",u-1).concat("inIdx.r"),y=Re("sourceLocG",u-1).concat("inIdx.g"),_=Re("sourceLocB",u-1).concat("inIdx.b"),b=Re("sourceLocA",u-1).concat("inIdx.a"),k="max"===r?"greaterThan":"lessThan",w=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(_.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),")));"),x="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(_.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(b.join(),") : 0.)"),C=a?"":"\n      float getBestIndicesAChannel(".concat(v.join(),") {\n        return getChannel(getBestIndicesA(").concat(p.join(),"),\n                                          vec2(").concat(p.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(v.join(),") {\n        return getChannel(getA(").concat(p.join(),"),\n                               vec2(").concat(p.slice(-2).join(),"));\n      }\n      ").concat(C,"\n      void main() {\n        ").concat(h," coords = getOutputCoords();\n        bool hasNextCol = ").concat(f[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(f[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(o,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(m,", sourceLocG").concat(m,",\n          sourceLocB").concat(m,", sourceLocA").concat(m,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(x,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(x,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(k,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")},qe=function e(t){_classCallCheck2(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n      const float avgMultiplier = float(").concat(1/(t.filterHeight*t.filterWidth),");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,";\n            wR += ").concat(t.dilationHeight,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(r,";\n            wC+= ").concat(t.dilationWidth,") {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Ue=function e(t){_classCallCheck2(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.effectiveFilterDepth,r=t.effectiveFilterHeight,a=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n      const float avgMultiplier = float(").concat(1/(t.filterDepth*t.filterHeight*t.filterWidth),");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(n,";\n            wD += ").concat(t.dilationDepth,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t.strideDepth,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(r,";\n              wR += ").concat(t.dilationHeight,") {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(a,";\n                wC += ").concat(t.dilationWidth,") {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},We="return (a < 0.) ? b * a : a;",Ge=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["A","B"],this.outputShape=s.X.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")},He="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Ke=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck2(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s.X.assertAndGetBroadcastShape(n,r);var i=this.outputShape.length,o="";if(a)if(0===i||1===s.Lb.sizeFromShape(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          ".concat(ze(i)," coords = getOutputCoords();\n        "),1===i)o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var u=Re("coords",i);o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")},Xe=function(){function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}(),Qe=function(){function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}(),Ye=function e(t){_classCallCheck2(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Ze=function e(t){_classCallCheck2(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat("channelsLast"===t.dataFormat,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Je=function e(t){_classCallCheck2(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a="channelsLast"===t.dataFormat;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(a?3:1,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(a?1:2,"], coords[").concat(a?2:3,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(a,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},$e=function e(t){_classCallCheck2(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t.strideDepth," - ").concat(t.padInfo.front,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},et=function e(t){_classCallCheck2(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(t.strideDepth,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},tt=function e(t){_classCallCheck2(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(t.outChannels/t.inChannels," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},nt=function e(t){_classCallCheck2(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(a,"; dm++) {\n              int d2 = d1 * ").concat(a," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},rt=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck2(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.padInfo.top,o=t.padInfo.left,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterHeight,f=t.filterWidth,d=4*Math.floor(t.inChannels/4),p=t.inChannels%4,m="channelsLast"===t.dataFormat,v=m?1:2,g=m?2:3,y=m?3:1,_="",b="";r&&(_=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),b="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      ".concat(_,"\n\n      const ivec2 strides = ivec2(").concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(y,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(v,"], coords[").concat(g,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(c,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(d,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(m,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===p,") {\n\n              if (").concat(m,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(d,") *\n                    getW(wR, wC, ").concat(d,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(d,", xR, xC) *\n                    getW(wR, wC, ").concat(d,", d2);\n              }\n\n            } else if (").concat(2===p,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(d,", d2),\n                getW(wR, wC, ").concat(d," + 1, d2)\n              );\n\n              if (").concat(m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(d,"),\n                  getX(batch, xR, xC, ").concat(d," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(d,", xR, xC),\n                  getX(batch, ").concat(d," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===p,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(d,", d2),\n                getW(wR, wC, ").concat(d," + 1, d2),\n                getW(wR, wC, ").concat(d," + 2, d2)\n              );\n\n              if (").concat(m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(d,"),\n                  getX(batch, xR, xC, ").concat(d," + 1),\n                  getX(batch, xR, xC, ").concat(d," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(d,", xR, xC),\n                  getX(batch, ").concat(d," + 1, xR, xC),\n                  getX(batch, ").concat(d," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(k,"\n        ").concat(b,"\n        setOutput(result);\n      }\n    ")},at=function e(t){_classCallCheck2(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterDepth,f=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(h,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(p,") *\n                  getW(wF, wR, wC, ").concat(p,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1),\n                  getX(batch, xF, xR, xC, ").concat(p," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2),\n                  getW(wF, wR, wC, ").concat(p," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},it=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck2(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.inHeight,o=t.inWidth,s=t.padInfo.top,u=t.padInfo.left,c=t.strideHeight,l=t.strideWidth,h=t.dilationHeight,f=t.dilationWidth,d=t.filterHeight,p=t.filterWidth,m=t.outChannels/t.inChannels,v="",g="";r&&(v=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),g="result = activation(result);");var y=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      ".concat(v,"\n\n      const ivec2 strides = ivec2(").concat(c,", ").concat(l,");\n      const ivec2 pads = ivec2(").concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(m,";\n        int q = d2 - d1 * ").concat(m,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(d,"; wR++) {\n          int xR = xRCorner + wR * ").concat(h,";\n\n          if (xR < 0 || xR >= ").concat(i,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(p,"; wC++) {\n            int xC = xCCorner + wC * ").concat(f,";\n\n            if (xC < 0 || xC >= ").concat(o,") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(y,"\n        ").concat(g,"\n        setOutput(result);\n      }\n    ")},ot=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck2(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var i=t.inHeight,o=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,l=t.strideHeight,h=t.strideWidth,f=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,m=t.filterWidth,v=m,g="int xR; int xC; int xCOffset;",y=0;y<p;y++)for(var _=0;_<m;_++)g+="\n          vec4 xTexelR".concat(y,"C").concat(2*_," = vec4(0.);\n          vec4 wR").concat(y,"C").concat(_," = vec4(0.);\n          vec4 xR").concat(y,"C").concat(_," = vec4(0.);");for(var b=0;b<p;b++)for(var k=0;k<v;k++){var w=2*k;if(g+="\n          xR = xRCorner + ".concat(b*f,";\n          xC = xCCorner + ").concat(w*d,";\n        "),1===h){if(w<m&&(g+=c%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ".concat(i," && xCOffset >= 0 && xCOffset < ").concat(o,") {\n                  xTexelR").concat(b,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(o,") {\n                    xTexelR").concat(b,"C").concat(w,".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR").concat(b,"C").concat(w," = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ").concat(i," && xCOffset >= 0 && xCOffset < ").concat(o,") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(o,") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR").concat(b,"C").concat(w," = vec4(previous.zw, xTexelR").concat(b,"C").concat(w,".xy);\n                } else {\n                  xR").concat(b,"C").concat(w," = vec4(0, 0, xTexelR").concat(b,"C").concat(w,".xy);\n                }\n              "):"\n                if(xR >= 0 && xR < ".concat(i," && xC >= 0 && xC < ").concat(o,") {\n                  xTexelR").concat(b,"C").concat(w," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(b,"C").concat(w," = vec4(0.);\n                }\n\n                xR").concat(b,"C").concat(w," = xTexelR").concat(b,"C").concat(w,";\n              "),w+1<m)){var x=c%2==0?s.Lb.nearestLargerEven(d):d;d%2==0&&c%2==1||d%2!=0&&c%2!=1?(g+="\n                  xCOffset = xC + ".concat(c%2," + ").concat(x,";\n\n                  if(xR >= 0 && xR < ").concat(i," &&\n                    xCOffset >= 0 && xCOffset < ").concat(o,") {\n                    xTexelR").concat(b,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                  }\n                "),d>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ".concat(i," &&\n                      xCOffset >= 0 && xCOffset < ").concat(o,") {\n                      xTexelR").concat(b,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR").concat(b,"C").concat(w," = vec4(0.);\n                    }\n                  ")),g+="\n                  xR".concat(b,"C").concat(w+1," = vec4(\n                    xTexelR").concat(b,"C").concat(w,".zw, xTexelR").concat(b,"C").concat(w+2,".xy);\n                ")):g+="\n                  xCOffset = xC + ".concat(x,";\n\n                  if(xR >= 0 && xR < ").concat(i," &&\n                    xCOffset >= 0 && xCOffset < ").concat(o,") {\n                    xTexelR").concat(b,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR").concat(b,"C").concat(w+1," = xTexelR").concat(b,"C").concat(w+2,";\n                ")}}else w<m&&(g+="\n              if(xR >= 0 && xR < ".concat(i,") {\n            "),c%2==1?(g+="\n                xCOffset = xC + 1 - ".concat(h,";\n                if(xCOffset >= 0 && xCOffset < ").concat(o,") {\n                  xTexelR").concat(b,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(b,"C").concat(w," = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ").concat(o,") {\n                  xTexelR").concat(b,"C").concat(w+2," = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR").concat(b,"C").concat(w+2," = vec4(0.);\n                }\n\n                xR").concat(b,"C").concat(w," = vec4(\n                  xTexelR").concat(b,"C").concat(w,".zw, xTexelR").concat(b,"C").concat(w+2,".zw);\n              "),w+1<m&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ".concat(h,";\n                  if(xCOffset >= 0 && xCOffset < ").concat(o,") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR").concat(b,"C").concat(w+1," = vec4(xTexelR").concat(b,"C").concat(w+2,".xy, final.xy);\n                "))):(g+="\n                if(xC >= 0 && xC < ".concat(o,") {\n                  xTexelR").concat(b,"C").concat(w," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(b,"C").concat(w," = vec4(0.);\n                }\n\n                xCOffset = xC + ").concat(h,";\n                if(xCOffset >= 0 && xCOffset < ").concat(o,") {\n                  xTexelR").concat(b,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(b,"C").concat(w+2," = vec4(0.);\n                }\n\n                xR").concat(b,"C").concat(w," = vec4(\n                  xTexelR").concat(b,"C").concat(w,".xy, xTexelR").concat(b,"C").concat(w+2,".xy);\n              "),w+1<m&&(g+="\n                  xR".concat(b,"C").concat(w+1," = vec4(\n                    xTexelR").concat(b,"C").concat(w,".zw, xTexelR").concat(b,"C").concat(w+2,".zw);\n                "))),g+="}");w<m&&(g+="\n            vec4 wTexelR".concat(b,"C").concat(w," = getW(").concat(b,", ").concat(w,", d1, q);\n            wR").concat(b,"C").concat(w," = vec4(wTexelR").concat(b,"C").concat(w,".xz, wTexelR").concat(b,"C").concat(w,".xz);\n          "),w+1<m&&(g+="\n              vec4 wTexelR".concat(b,"C").concat(w+1," = getW(").concat(b,", ").concat(w+1,", d1, q);\n              wR").concat(b,"C").concat(w+1," =\n                vec4(wTexelR").concat(b,"C").concat(w+1,".xz, wTexelR").concat(b,"C").concat(w+1,".xz);")))}for(var C=0;C<p;C++)for(var S=0;S<m;S++)g+="dotProd += xR".concat(C,"C").concat(S," * wR").concat(C,"C").concat(S,";");var T="",A="";r&&(T=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),A="result = activation(result);");var E=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      ".concat(T,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(h,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(c,");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ").concat(g,"\n\n        vec4 result = dotProd;\n        ").concat(E,"\n        ").concat(A,"\n        setOutput(result);\n      }\n    ")},st=function e(t,n,r,a,i){_classCallCheck2(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=_slicedToArray2(t,4),s=o[0],u=o[1],c=o[2],l=o[3],h=_slicedToArray2(n,1)[0],f=_slicedToArray2(r,2),d=f[0],p=f[1];this.outputShape=[h,d,p,l];var m="bilinear"===a?1:0,v=u-1+".0",g=c-1+".0",y=_slicedToArray2(d>1?[""+(u-1)/(d-1),"(y2-y1) * height_ratio","y1*".concat(v," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * "+v],3),_=y[0],b=y[1],k=y[2],w=_slicedToArray2(p>1?[""+(c-1)/(p-1),"(x2-x1) * width_ratio","x1*".concat(g," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * "+g],3),x=w[0],C=w[1],S=w[2];this.userCode="\n      const float height_ratio = float(".concat(_,");\n      const float width_ratio = float(").concat(x,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(b,";\n        float width_scale = ").concat(C,";\n\n        float in_y = ").concat(k,";\n        if( in_y < 0.0 || in_y > ").concat(v," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(S,";\n        if( in_x < 0.0 || in_x > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(m," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")},ut=function(){function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=t;var a=t.length,i=n?"0.0":"getX(".concat(ct(a,"coords"),")"),o=t[t.length-1],s="",u="";n?(s=r?"end != "+(o-1):"end != 0",u=r?"end + 1":"end - 1"):(s=r?"end + pow2 < "+o:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode="\n      uniform float index;\n      void main() {\n        ".concat(ze(a)," coords = getOutputCoords();\n        int end = ").concat(lt(a,"coords"),";\n        float val = ").concat(i,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(s,") {\n          int idx = ").concat(u,";\n          ").concat(lt(a,"coords")," = idx;\n          val += getX(").concat(ct(a,"coords"),");\n        }\n        setOutput(val);\n      }\n    ")}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.index&&(t.index=n.getUniformLocation(r,"index")),n.gl.uniform1f(t.index,e)}}}]),e}();function ct(e,t){if(1===e)return""+t;if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}function lt(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}var ht=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=a.DENSE;var n=f(t),r=Oe();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(Ne(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")},ft=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=a.DENSE;var n=f(t),r=Oe();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(Ne(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")},dt=function(){function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return _createClass2(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}(),pt=function e(t){_classCallCheck2(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},mt=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.outTexUsage=i.DOWNLOAD;var n=Oe();this.outputShape=t,this.userCode="\n      ".concat(Pe,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},vt=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=i.DOWNLOAD;var n=Oe();this.outputShape=t,this.userCode="\n      ".concat(Pe,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},gt=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck2(this,e),this.variableNames=["A"];var a=Oe(),i=_slicedToArray2(n,2),o=i[0],s=i[1];this.outputShape=t;var u="result";r&&(u="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(De(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ").concat(s,";\n        int c = imod(flatIndex, ").concat(s,");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n        vec4 values = ").concat(a.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(a.output," = vec4(").concat(u,", 0., 0., 0.);\n      }\n    ")},yt=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var a=Oe(),i=_slicedToArray2(n,2),o=i[0],s=i[1];this.outputShape=t;var u="",c="result";r&&(c="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var h=0;h<=1;h++){var f=2*l+h;u+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(h," < ").concat(t[2],") {\n            localCoords[2] += ").concat(h,";\n            if(localCoords[1] + ").concat(l," < ").concat(t[1],") {\n              localCoords[1] += ").concat(l,";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ").concat(s,";\n              c = imod(flatIndex, ").concat(s,");\n              uv = (vec2(c, r) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n              values = ").concat(a.texture2D,"(A, uv);\n\n              if(offset == 0) {\n                result[").concat(f,"] = values[0];\n              } else if(offset == 1) {\n                result[").concat(f,"] = values[1];\n              } else if(offset == 2) {\n                result[").concat(f,"] = values[2];\n              } else {\n                result[").concat(f,"] = values[3];\n              }\n            }\n          }\n        ")}this.userCode="\n      ".concat(De(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ").concat(u,"\n\n        ").concat(a.output," = ").concat(c,";\n      }\n    ")},_t=function(){function e(t,n){_classCallCheck2(this,e),this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}}}]),e}(),bt=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["A","indices"];var a=t.slice();a[r]=n,this.outputShape=a,this.rank=a.length;var i=ze(this.rank),o=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank ".concat(n," is not yet supported"));if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],i=0;i<e.length;i++)a.push(i===t?"int(getIndices(".concat(r[i],"))"):""+r[i]);return a.join()}(t,r);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")},kt=function e(t,n,r){_classCallCheck2(this,e),this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=r;var a=ze(n.length),i=ze(r.length);this.userCode="\n        ".concat(a," strides = ").concat(a,"(").concat(this.strides,");\n         void main() {\n          ").concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ").concat(this.sliceDim>1?"strides[j]":"strides",";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      ")};function wt(e,t,n,r,a,i){!function(e,t){var n=Object(s.jb)().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] is invalid."));if(e>n||t>n)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] greater than WebGL maximum on this browser / GPU [").concat(n,"x").concat(n,"]."))}(t,n);var o=function(e){return A(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),u=e.TEXTURE_2D;return m(e,(function(){return e.bindTexture(u,o)})),m(e,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),m(e,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),m(e,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),m(e,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),m(e,(function(){return e.texImage2D(u,0,r,t,n,0,a,i,null)})),m(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),o}function xt(e){return e.internalFormatFloat}function Ct(e){return e.internalFormatHalfFloat}function St(e){return e.downloadTextureFormat}function Tt(e){return e.internalFormatPackedFloat}function At(e){return e.internalFormatPackedHalfFloat}var Et=function(){function e(t){_classCallCheck2(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=Object(s.jb)().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(e,t){u[e]=t}(n,t)):this.gl=l(n);var r="WEBGL_color_buffer_float";if(1===Object(s.jb)().getNumber("WEBGL_VERSION")){var a="OES_texture_half_float";if(this.textureFloatExtension=g(this.gl,"OES_texture_float"),D(this.gl,a))this.textureHalfFloatExtension=g(this.gl,a);else if(Object(s.jb)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),D(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=g(this.gl,"EXT_color_buffer_half_float");else if(Object(s.jb)().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",D(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!D(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=function(e){return function(e,t){var n=A(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return m(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),m(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(e){return function(e,t){var n=A(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return m(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),m(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(e){return A(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=p(this.gl,this.textureHalfFloatExtension)}var t;return _createClass2(e,[{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;m(t,(function(){return t.finish()})),m(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),m(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),m(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),m(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),m(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray2(h(t,n),2);return wt(e,a[0],a[1],xt(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray2(h(t,n),2);return wt(e,a[0],a[1],Ct(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray2(h(t,n),2);return wt(e,a[0],a[1],St(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){m(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?m(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):m(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),m(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;m(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),m(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),m(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray2(d(t,n),2);return wt(e,a[0],a[1],At(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray2(d(t,n),2);return wt(e,a[0],a[1],Tt(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(S(this.gl,this.framebuffer),this.outputTexture=null),m(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=_slicedToArray2(h(t,n),2),i=a[0],o=a[1],s=new Uint8Array(t*n*4);return m(e,(function(){return e.readPixels(0,0,i,o,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)})),new Float32Array(s.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return function(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=_slicedToArray2(d(e,t),2);return n[0]*n[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}(this.gl,e,0,0,0,a,i)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();m(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return m(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),m(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),m(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(Object(s.jb)().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else Object(s.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,Object(s.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return m(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){this.throwIfDisposed();var t=this.gl,n=y(t,e),r=function(e){var t=Oe();return function(e,t){var n=A(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(m(e,(function(){return e.shaderSource(n,t)})),m(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}(t),a=function(e){return A(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(t);return m(t,(function(){return t.attachShader(a,r)})),m(t,(function(){return t.attachShader(a,n)})),function(e,t){if(m(e,(function(){return e.linkProgram(t)})),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,a),this.debug&&w(t,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=function(e,t,n){return m(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),x(e,t,"clipSpacePos",n,3,20,0)&&x(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),a}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&m(this.gl,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&w(this.gl,this.program),m(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return A(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),m(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r){m(e,(function(){return function(e,t,n){(function(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE".concat(n,"]."))})(e,n),m(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),m(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),m(e,(function(){return e.uniform1i(n,r)}))}(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=_slicedToArray2(d(t,n),2),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&w(this.gl,this.program),T(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),m(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),m(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=g(this.gl,2===Object(s.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===Object(s.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==Object(s.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.Lb.repeatedTry((function(){return n.disposed||n.isQueryAvailable(t,Object(s.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,Object(s.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||s.Lb.repeatedTry((function(){return n.pollItems(),0===n.itemsToPoll.length}))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),C(this.gl,e,this.framebuffer),this.debug&&T(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(C(this.gl,this.outputTexture,this.framebuffer),this.debug&&T(this.gl)):S(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;C(r,e,this.framebuffer),this.debug&&T(r),this.outputTexture=e,m(r,(function(){return r.viewport(0,0,t,n)})),m(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),m(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}},{key:"debug",get:function(){return Object(s.jb)().getBool("DEBUG")}}]),e}();function It(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!s.Lb.arraysEqual(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,u=a.isUniform?null:a.texData.texShape;if(!s.Lb.arraysEqual(o,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(o," and ").concat(u," must match"))}}))}var Rt=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var a=r.filterWidth,i=r.inChannels,o=r.strideWidth,s=r.strideHeight,u=r.padInfo,c=r.outWidth,l=r.dilationWidth,h=r.dilationHeight,f=r.dataFormat,d=u.left,p=u.top,m=i*a,v=Oe(),g="channelsLast"===f,y=g?0:1,_=g?1:2,b="",k=0;k<=1;k++)for(var w=0;w<=1;w++)b+="\n          blockIndex = rc.y + ".concat(w,";\n          pos = rc.x + ").concat(k,";\n\n          if(blockIndex < ").concat(t[1]," && pos < ").concat(t[0],") {\n            offsetY = int(blockIndex / (").concat(c,")) * ").concat(s," - ").concat(p,";\n            d0 = offsetY + ").concat(h," * (pos / ").concat(m,");\n\n            if(d0 < ").concat(n[y]," && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ").concat(c,".) * ").concat(o,". - ").concat(d,".);\n              d1 = offsetX + ").concat(l," * (int(mod(float(pos), ").concat(m,".) / ").concat(i,".));\n\n              if(d1 < ").concat(n[_]," && d1 >= 0) {\n\n                ch = int(mod(float(pos), ").concat(i,".));\n\n                if (").concat(g,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*k+w,"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*k+w,"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(b,"\n\n        ").concat(v.output," = result;\n      }\n    ")},Ot=function e(t,n,r,a,i){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")},Nt=function e(t,n,r,a,i){_classCallCheck2(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")},Dt=function e(t,n,r,a,i){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")},Pt=function e(t){_classCallCheck2(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,";\n          wR += ").concat(t.dilationHeight,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(n*r-1," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(r," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Ft=function e(t){_classCallCheck2(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.effectiveFilterDepth,r=t.effectiveFilterHeight,a=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(n,";\n           wD += ").concat(t.dilationDepth,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t.strideDepth,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(r,";\n              wR += ").concat(t.dilationHeight,") {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(a,";\n                wC += ").concat(t.dilationWidth,") {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(n*r*a-1," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(r," * ").concat(a," +\n                  wR * ").concat(a," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},Mt=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7];_classCallCheck2(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;var c=Math.ceil((a?t[1]:t[2])/2),l=a?"i * 2, rc.y":"rc.y, i * 2",h=i?"rc.z, i * 2":"i * 2, rc.z",f=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",m="";s&&(p=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),m="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights");var g="rc.x",y="rc.x";t[0]<n[0]?g="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(y="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(p,"\n\n      const float sharedDimension = ").concat(c,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(c,"; i++) {\n          int batchA = ").concat(g,";\n          int batchB = ").concat(y,";\n          vec4 a = getMatrixA(batchA, ").concat(l,");\n          vec4 b = getMatrixB(batchB, ").concat(h,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(f[0]," * ").concat(d[0],");\n          result += (").concat(f[1]," * ").concat(d[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(v,"\n\n        ").concat(m,"\n\n        setOutput(result);\n      }\n    ")},Lt=function(){function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["probs"],this.outputShape=[t,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}}}]),e}(),zt=function e(t,n,r,a){_classCallCheck2(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")},Bt=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var n=t.length;if(0===n)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var r=Re("rc",n),a=ze(n),i=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",a=e-2;a<e;a++)r+="".concat(n[a]," >= ").concat(t[a]),a<e-1&&(r+="||");return r}(n,t,r),o=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = ".concat(a[0],";\n    int c = ").concat(a[1],";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ").concat(t,";\n    bool rEdge = rp1 >= ").concat(n,";\n  ")}(n,t[t.length-1],t[t.length-2],r),s=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i="".concat(0===r?"r":"rp1",", ").concat(0===a?"c":"cp1"),o=2;o<e;o++)i=t[t.length-1-o]+","+i;n.push(i)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= ".concat(e[0]," ? 0. : getA(rc + 1),\n            0, 0"):"getA(".concat(r[0],"),\n          cEdge ? 0. : getA(").concat(r[1],"),\n          rEdge ? 0. : getA(").concat(r[2],"),\n          rEdge || cEdge ? 0. : getA(").concat(r[3],")")}(t,r);this.userCode="\n        void main() {\n          ".concat(a," rc = getOutputCoords();\n\n          if(").concat(i,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(o,"\n\n            setOutput(vec4(").concat(s,"));\n          }\n        }\n      ")}},jt=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=ze(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float(").concat(r,"));\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float(").concat(r,"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")},Vt=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=ze(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=Re("rc",a),c=Re("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),f=[i+" rc = outputLoc;","".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],d=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",m=0,v=1===a?2:4;m<v;m++)p+="\n        ".concat(f[m],"\n        if (").concat(d,") {\n          result[").concat(m,"] = float(").concat(r,");\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ");p+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")},qt=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck2(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="0.0";if(m||(v="-1.0 / 1e-20"),r)this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?"((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"):"(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"):"wR * ".concat(f," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ");else{var g="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(g="avgValue / count");var y=4*Math.floor(o/4),_=o%4,b="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n      const float initializationValue = ").concat(v,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(v,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(y,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(b,"\n          }\n\n          int xC = xCCorner + ").concat(y,";\n          if (").concat(1===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(b,"\n          } else if (").concat(2===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(b,"\n          } else if (").concat(3===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(b,"\n          }\n        }\n        setOutput(").concat(g,");\n      }\n    ")}},Ut=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck2(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,h=t.dilationHeight,f=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,m=t.effectiveFilterWidth,v=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var _="avg"===n,b="0.0";if(_||(b="-1.0 / 1e-20"),r)this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(p,";\n                wR += ").concat(h,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(f,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(p," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ");else{var k="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(k="avgValue / count");var w=4*Math.floor(o/4),x=o%4,C="\n      if (".concat(_,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(b,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(b,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(h,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(f,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(f,", ch)\n              );\n\n              ").concat(C,"\n            }\n\n            int xC = xCCorner + ").concat(w,";\n            if (").concat(1===x,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(C,"\n            } else if (").concat(2===x,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(C,"\n            } else if (").concat(3===x,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                initializationValue\n              );\n\n              ").concat(C,"\n            }\n          }\n          setOutput(").concat(k,");\n        }\n      }\n    ")}},Wt=function e(t,n){_classCallCheck2(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),h=r%4,f="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n      }\n    "),d="vec4";"all"===n?(s="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===n&&(s="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(f,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(2===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(3===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(f,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")},Gt=function e(t,n){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r,a="",i=0;i<4;i++){var o="thisRC = rc;";i%2==1&&(o+="thisRC.z += 1;"),i>1&&(o+="thisRC.y += 1;"),a+="\n        ".concat(o,"\n        ").concat(i>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(i,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(i>0?"}":"","\n      ")}this.userCode="\n      ".concat((r=n,"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(Ne(["r","c","d"],r),"\n      return ivec3(r, c, d);\n    }\n  ")),"\n      ").concat(De(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(t[1],";\n        int cols = ").concat(t[2],";\n\n        ").concat(a,"\n\n        setOutput(result);\n      }\n    ")},Ht=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var a=_slicedToArray2(n.shape,3),i=a[1],o=a[2],s=_slicedToArray2(t.shape,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],f=l[0]/h[0],d=l[1]/h[1],p=1/f,m=1/d,v=2*Math.ceil(p)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(p,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},Kt=function e(t,n,r,a){_classCallCheck2(this,e),this.variableNames=["A"],this.outputShape=[];var i=_slicedToArray2(t,4),o=i[0],s=i[1],u=i[2],c=i[3];this.outputShape=[o,n,r,c];var l=[a&&n>1?s-1:s,a&&r>1?u-1:u],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/h[0],",\n          ").concat(l[1]/h[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(u,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")},Xt=function e(t,n,r,a){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=_slicedToArray2(t,4),o=i[0],s=i[1],u=i[2],c=i[3];this.outputShape=[o,n,r,c];var l=[a&&n>1?s-1:s,a&&r>1?u-1:u],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(l[0]/h[0],",\n          ").concat(l[1]/h[1],",\n          ").concat(l[1]/h[1],");\n      const vec3 inputShapeRC = vec3(").concat(s,".0, ").concat(u,".0,\n                                     ").concat(u,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(c-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")},Qt=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var a=_slicedToArray2(n.shape,3),i=a[1],o=a[2],s=_slicedToArray2(t.shape,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],f=l[0]/h[0],d=l[1]/h[1],p=1/f,m=1/d,v=2*Math.ceil(p)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(p,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(h[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(h[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},Yt=function e(t,n,r,a){_classCallCheck2(this,e),this.variableNames=["A"],this.outputShape=[];var i=_slicedToArray2(t,4),o=i[0],s=i[1],u=i[2],c=i[3];this.outputShape=[o,n,r,c];var l=[a&&n>1?s-1:s,a&&r>1?u-1:u],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/h[0],",\n          ").concat(l[1]/h[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(u,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(a?"0.5":"0.0",")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")},Zt=function e(t,n){_classCallCheck2(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=ze(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")},Jt=function e(t,n){_classCallCheck2(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=Re("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=ze(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):""+r[e]}(a,e)}));return"getChannel(getX(".concat(r.join(","),"), vec2(").concat(r.slice(-2).join(","),"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")},$t=function e(t,n,r,a,i,o){!(arguments.length>6&&void 0!==arguments[6])||arguments[6];_classCallCheck2(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=ze(i.length),u=ze(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="";1===a?l="i":2===a&&(l="i, coords[1]"),this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(getIndices(").concat(c,"));\n              flattenedIndex += index * ").concat(n>1?"strides[j]":"strides",";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates(").concat(l,");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")},en=function e(t,n){_classCallCheck2(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ".concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(f,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")},tn=function e(t,n,r){var a,i;if(_classCallCheck2(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push(""+o[c]),c<t&&s.push(""+o[c]);a=s.join(),i=u.join()}var l=ze(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")},nn=function(){function e(t){_classCallCheck2(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=ze(this.rank),a="uniform int start[".concat(this.rank,"];"),i=function(e){if(1===e)return"sourceLoc";if(e<=6)return rn.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);n="\n        ".concat(r," sourceLoc;\n        ").concat(r," coords = getOutputCoords();\n        ").concat(t.map((function(e,t){return"sourceLoc.".concat(rn[t]," = start[").concat(t,"] + coords.").concat(rn[t],";")})).join("\n"),"\n      "),this.userCode="\n      ".concat(a,"\n      void main() {\n        ").concat(n,"\n        setOutput(getSource(").concat(i,"));\n      }\n    ")}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the length of start (").concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}(),rn=["x","y","z","w","u","v"],an=function(){function e(t){_classCallCheck2(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=ze(this.rank),r=Re("coords",this.rank),a=Re("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      uniform int start[".concat(this.rank,"];\n      void main() {\n        ").concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the length of start (").concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}(),on=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=ze(r.length),o=ze(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")},sn=function(){function e(t){_classCallCheck2(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return _createClass2(e,[{key:"acquireTexture",value:function(e,t,n){var r=cn(t,n),a=ln(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,s=un(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();var u=this.freeTextures[a].shift();return this.usedTextures[a].push(u),u}return r===o.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===o.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===o.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===o.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===o.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=cn(n,r),i=ln(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=un(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),u=Object(s.jb)().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==u&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var c=this.usedTextures[i],l=c.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(l,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(this.numFreeTextures+this.numUsedTextures,")"));var e=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: "+this._numBytesAllocated),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*e),"%)"))}}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}}]),e}();function un(e,t,n,r,a){var i,s=function(e,t){switch(e){case o.PACKED_2X2_FLOAT32:return Tt(t);case o.PACKED_2X2_FLOAT16:return At(t);case o.UNPACKED_FLOAT32:return xt(t);case o.UNPACKED_FLOAT16:return Ct(t);case o.PACKED_4X1_UNSIGNED_BYTE:return St(t);default:throw new Error("Unknown physical texture type "+e)}}(t,r);if(a){var u=_slicedToArray2(d(e[0],e[1]),2);i=u[0]*u[1]}else{var c=_slicedToArray2(h(e[0],e[1]),2);i=c[0]*c[1]}return i*function(e,t){if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===e.RGBA16F)return 8;throw new Error("Unknown internal format "+t)}(n,s)}function cn(e,t){if(e===i.UPLOAD)return o.PACKED_2X2_FLOAT32;if(e===i.RENDER||null==e)return function(e){return Object(s.jb)().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?o.PACKED_2X2_FLOAT32:o.UNPACKED_FLOAT32:e?o.PACKED_2X2_FLOAT16:o.UNPACKED_FLOAT16}(t);if(e===i.DOWNLOAD||e===i.PIXELS)return o.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function ln(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var hn=function e(t,n){_classCallCheck2(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=ze(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")},fn=function e(t,n){_classCallCheck2(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},dn="return abs(x);",pn="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",mn="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",vn="return (x >= 0.0) ? x : (exp(x) - 1.0);",gn="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(s.X.SELU_SCALEALPHA,";\n  float scale = ").concat(s.X.SELU_SCALE,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n"),yn="return -x;",_n="return ceil(x);",bn="return floor(x);",kn="return exp(x);",wn="return exp(x) - 1.0;",xn='\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(s.X.ERF_P,";\n  float a1 = ").concat(s.X.ERF_A1,";\n  float a2 = ").concat(s.X.ERF_A2,";\n  float a3 = ").concat(s.X.ERF_A3,";\n  float a4 = ").concat(s.X.ERF_A4,";\n  float a5 = ").concat(s.X.ERF_A5,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n"),Cn="return x;",Sn="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Tn="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",An="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",En=function e(t,n){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},In=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var n=t.length,r=Re("rc",n),a=ze(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")},Rn=s.X.segment_util,On=s.lb.split,Nn=s.lb.tile,Dn=s.lb.topkImpl,Pn=s.lb.whereImpl,Fn={};function Mn(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?Sn:pn;if("elu"===e)return t?An:vn;if("relu6"===e)return t?Tn:mn;if("prelu"===e)return t?He:We;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var Ln=function(e){_inherits(u,e);var t,n,r,o=_createSuper(u);function u(e){var t,n;if(_classCallCheck2(this,u),(t=o.call(this)).pendingRead=new WeakMap,t.pendingDisposal=new WeakSet,t.dataRefCount=new WeakMap,t.numBytesInGPU=0,t.uploadWaitMs=0,t.downloadWaitMs=0,t.warnedAboutMemory=!1,t.warnedAboutCPUBackend=!1,t.pendingDeletes=0,t.disposed=!1,!Object(s.jb)().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var r=l(Object(s.jb)().getNumber("WEBGL_VERSION"));t.binaryCache=((n=Object(s.jb)().getNumber("WEBGL_VERSION"))in Fn||(Fn[n]={}),Fn[n]),t.gpgpu=new Et(r),t.canvas=r.canvas,t.gpgpuCreatedLocally=!0}else t.gpgpu=e,t.binaryCache={},t.gpgpuCreatedLocally=!1,t.canvas=e.gl.canvas;return t.textureManager=new sn(t.gpgpu),t.numMBBeforeWarning=null==Object(s.jb)().global.screen?1024:Object(s.jb)().global.screen.height*Object(s.jb)().global.screen.width*window.devicePixelRatio*600/1024/1024,t.texData=new s.k(_assertThisInitialized(t),Object(s.ib)()),_possibleConstructorReturn(t)}return _createClass2(u,[{key:"numDataIds",value:function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}},{key:"write",value:function(e,t,n){if((Object(s.jb)().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Object(s.jb)().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:i.UPLOAD,refCount:1,complexParentRefCount:0}),r}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r){if(Object(s.jb)().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:i.UPLOAD,refCount:1,complexParentRefCount:0})}},{key:"disposeIntermediateTensorInfo",value:function(e){var t=e.dataId;if(this.texData.has(t)){var n=this.texData.get(t);n.refCount--,n.refCount<1&&this.disposeData(t)}}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,u=t.isPacked;if(null!=i){var c;c=u?new En(o,Cn):new fn(o,Cn);var l=this.runWebGLProgram(c,[{dataId:e,shape:o,dtype:r}],r),h=this.readSync(l.dataId);return this.disposeIntermediateTensorInfo(l),h}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var f,d,p=null!=this.activeTimers;if(p&&(f=s.Lb.now()),"complex64"===r){var m=this.readSync(a.real.dataId),v=this.readSync(a.imag.dataId);d=s.X.mergeRealAndImagArrays(m,v)}else d=this.getValuesFromTexture(e);return p&&(this.downloadWaitMs+=s.Lb.now()-f),this.convertAndCacheOnCPU(e,d)}},{key:"read",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,u,c,l,h,d,p,m,v,g,y,_,b,k,w,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,u=r.dtype,c=r.complexTensorInfos,l=r.isPacked,null==o){e.next=8;break}return h=l?new En(i,Cn):new fn(i,Cn),d=this.runWebGLProgram(h,[{dataId:t,shape:i,dtype:u}],u),p=this.read(d.dataId),e.abrupt("return",(this.disposeIntermediateTensorInfo(d),p));case 8:if(null==a){e.next=10;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 10:if(Object(s.jb)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==Object(s.jb)().getNumber("WEBGL_VERSION")){e.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(g=null,"complex64"!==u&&Object(s.jb)().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),_=this.texData.get(m.dataId),g=(y=this.gpgpu).createBufferFromTexture.apply(y,[_.texture].concat(_toConsumableArray(f(i))))),this.pendingRead.set(t,[]),e.t0="complex64"!==u,!e.t0){e.next=19;break}return e.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==u){e.next=26;break}return e.next=22,Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)]);case 22:b=e.sent,v=s.X.mergeRealAndImagArrays(b[0],b[1]),e.next=27;break;case 26:null==g?v=this.getValuesFromTexture(t):(k=s.Lb.sizeFromShape(i),v=this.gpgpu.downloadFloat32MatrixFromBuffer(g,k));case 27:return null!=m&&this.disposeIntermediateTensorInfo(m),w=this.convertAndCacheOnCPU(t,v),x=this.pendingRead.get(t),e.abrupt("return",(this.pendingRead.delete(t),x.forEach((function(e){return e(w)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),w));case 30:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!v(n)){if(Object(s.jb)().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"));throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=s.Lb.sizeFromShape(n);if(Object(s.jb)().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,u=this.decode(e),c=this.texData.get(u.dataId),l=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[c.texture].concat(_toConsumableArray(f(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(u),l}var h=Object(s.jb)().getBool("WEBGL_PACK")&&!0===a,d=h?R(n):n,p=h?new vt(d):new mt(d),m=this.runWebGLProgram(p,[{shape:d,dtype:r,dataId:e}],"float32"),v=this.texData.get(m.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(m),g}},{key:"time",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.activeTimers,r=[],a=!1,null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,t(),i=s.Lb.flatten(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=s.Lb.flatten(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=n,a&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},!(Object(s.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=13;break}return e.next=9,Promise.all(i);case 9:c=e.sent,u.kernelMs=s.Lb.sum(c),u.getExtraProfileInfo=function(){return c.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=14;break;case 13:u.kernelMs={error:"WebGL query timers are not supported in this environment."};case 14:return e.abrupt("return",(this.uploadWaitMs=0,this.downloadWaitMs=0,u));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return Object(s.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:s.Lb.now(),endMs:null}}},{key:"endTimer",value:function(e){return Object(s.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=s.Lb.now(),e)}},{key:"getQueryTime",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(s.jb)().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.waitForQueryAndGetTime(t):t.endMs-t.startMs);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"disposeData",value:function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e))if(this.texData.get(e).complexParentRefCount>0)this.texData.get(e).refCount--;else{this.releaseGPUData(e);var t=this.texData.get(e).complexTensorInfos;null!=t&&(this.texData.get(t.real.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.real),this.texData.get(t.imag.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.imag)),this.texData.delete(e)}}}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"getCPUBackend",value:function(){return Object(s.jb)().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Object(s.ib)().findBackend("cpu")),this.cpuBackend):null}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128,r=this.getCPUBackend();return this.warnedAboutCPUBackend||null!=r||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=r&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&s.Lb.sizeFromShape(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"slice",value:function(e,t,n){if(this.shouldExecuteOnCPU([e])){var r=we(this.texData.get(e.dataId).values,t,n,e.shape,e.dtype);return this.makeOutput(n,e.dtype,r)}if(0===s.Lb.sizeFromShape(n))return Object(s.Gb)([],n,e.dtype);var a=this.texData.get(e.dataId).isPacked,i=s.Ab.isSliceContinous(e.shape,t,n);if(a||!i){var o=Object(s.jb)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new an(n):new nn(n),u=o.getCustomSetupFunc(t);return this.compileAndRun(o,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)}},{key:"shallowSlice",value:function(e,t,n){var r=this.texData.get(e.dataId),a=this.makeOutput(n,e.dtype),i=this.texData.get(a.dataId);Object.assign(i,r),i.shape=n,i.dtype=e.dtype;var o=s.Ab.computeFlatOffset(t,e.strides);r.slice&&(o+=r.slice.flatOffset),i.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};var u=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,u+1),a}},{key:"stridedSlice",value:function(e,t,n,r){var a=this,i=this.tryRunOnCpuOrThrow([e],(function(){return a.cpuBackend.stridedSlice(e,t,n,r)}));if(i)return i;var o=s.Ab.computeOutShape(t,n,r);if(o.some((function(e){return 0===e})))return Object(s.Gb)([],o);var u=new on(t,r,o);return this.compileAndRun(u,[e])}},{key:"reverse",value:function(e,t){var n=Object(s.jb)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Jt(e.shape,t):new Zt(e.shape,t);return this.compileAndRun(n,[e])}},{key:"neg",value:function(e){var t=this,n=this.tryRunOnCpuOrThrow([e],(function(){return t.cpuBackend.neg(e)}));if(n)return n;if(Object(s.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,yn,e.dtype);var r=new fn(e.shape,yn);return this.compileAndRun(r,[e])}},{key:"batchMatMul",value:function(e,t,n,r){var a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],u=Math.max(e.shape[0],t.shape[0]);if((1===a||1===i)&&o>1e3){n&&(e=Object(s.Jb)(e,[0,2,1])),r&&(t=Object(s.Jb)(t,[0,2,1]));var c=1===i?e:e.as3D(u,o,1),l=1===i?2:1,h=1===i?t.as3D(u,1,o):t;return s.pb(c,h).sum(l,!0)}var f=Object(s.Kb)(e.dtype,t.dtype),d=new Mt(e.shape,t.shape,[u,a,i],n,r);return this.compileAndRun(d,[e,t],f)}},{key:"fusedBatchMatMul",value:function(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.bias,o=e.activation,u=e.preluActivationWeights,c=r?t.shape[2]:t.shape[1],l=a?n.shape[1]:n.shape[2],h=Math.max(t.shape[0],n.shape[0]),f=Object(s.Kb)(t.dtype,n.dtype),d=null!=i,p=null!=u,m=o?Mn(o,!0):null,v=new Mt(t.shape,n.shape,[h,c,l],r,a,d,m,p),g=[t,n];return i&&g.push(i),u&&g.push(u),this.compileAndRun(v,g,f)}},{key:"localResponseNormalization4D",value:function(e,t,n,r,a){var i=Object(s.jb)().getBool("WEBGL_PACK_NORMALIZATION")?new Dt(e.shape,t,n,r,a):new Ot(e.shape,t,n,r,a);return this.compileAndRun(i,[e])}},{key:"LRNGrad",value:function(e,t,n,r,a,i,o){var s=new Nt(t.shape,r,a,i,o);return this.compileAndRun(s,[t,n,e])}},{key:"tile",value:function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return s.Lb.decodeString(e)})),r=Object(s.Z)(e.shape,e.dtype,n);return Nn(r,t)}var a=new hn(e.shape,t);return this.compileAndRun(a,[e])}},{key:"pad",value:function(e,t,n){var r=Object(s.jb)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Vt(e.shape,t,n):new jt(e.shape,t,n);return this.compileAndRun(r,[e])}},{key:"gather",value:function(e,t,n){var r=this,a=this.tryRunOnCpuOrThrow([e,t],(function(){return r.cpuBackend.gather(e,t,n)}));if(a)return a;var i=new bt(e.shape,t.size,n);return this.compileAndRun(i,[e,t])}},{key:"batchToSpaceND",value:function(e,t,n){s.Lb.assert(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),a=s.X.getReshaped(e.shape,t,r),i=s.X.getPermuted(a.length,t.length),o=s.X.getReshapedPermuted(e.shape,t,r),u=s.X.getSliceBeginCoords(n,t.length),c=s.X.getSliceSize(o,n,t.length);return Object(s.Jb)(e.reshape(a),i).reshape(o).slice(u,c)}},{key:"spaceToBatchND",value:function(e,t,n){s.Lb.assert(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),a=[[0,0]];a.push.apply(a,_toConsumableArray(n));for(var i=1+t.length;i<e.shape.length;++i)a.push([0,0]);var o=e.pad(a),u=s.X.getReshaped(o.shape,t,r,!1),c=s.X.getPermuted(u.length,t.length,!1),l=s.X.getReshapedPermuted(o.shape,t,r,!1),h=Object(s.Jb)(o.reshape(u),c);return Object(s.xb)(h,l)}},{key:"reduce",value:function(e,t,n){var r=e.shape[0],a=e.shape[1],i=s.X.computeOptimalWindowSize(a),o=Math.ceil(a/i),u=new Wt({windowSize:i,inSize:a,batchSize:r,outSize:o},t),c=this.compileAndRun(u,[e],n);return 1===c.shape[1]?c:this.reduce(c,t,n)}},{key:"argReduce",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=e.shape[0],a=e.shape[1];null!=n&&(r=n.shape[0],a=n.shape[1]);var i=s.X.computeOptimalWindowSize(a),o={windowSize:i,inSize:a,batchSize:r,outSize:Math.ceil(a/i)},u=new Ee(o,t,null==n),c=[e];null!=n&&c.push(n);var l=this.compileAndRun(u,c,"int32");return 1===l.shape[1]?l:this.argReduce(e,t,l)}},{key:"argReducePacked",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=null!=n?n.shape:e.shape,a=s.X.computeOptimalWindowSize(r[r.length-1]),i=new Ve(r,a,t,null==n),o=this.compileAndRun(i,null==n?[e]:[e,n],"int32");return o.rank===e.rank?this.argReducePacked(e,t,o):o}},{key:"sum",value:function(e,t){s.X.assertAxesAreInnerMostDims("sum",t,e.rank);var n=_slicedToArray2(s.X.computeOutAndReduceShapes(e.shape,t),2),r=n[0],a=n[1],i=s.Lb.sizeFromShape(a),o=e.as2D(-1,i),u=s.Fb(e.dtype);return this.reduce(o,"sum",u).reshape(r)}},{key:"prod",value:function(e,t){var n=this,r=this.tryRunOnCpuOrThrow([e],(function(){return n.cpuBackend.prod(e,t)}));if(r)return r;var a=_slicedToArray2(s.X.computeOutAndReduceShapes(e.shape,t),2),i=a[0],o=a[1],u=s.Lb.sizeFromShape(o),c=e.as2D(-1,u),l=s.Fb(e.dtype);return this.reduce(c,"prod",l).reshape(i)}},{key:"unsortedSegmentSum",value:function(e,t,n){var r=0,a=s.X.getAxesPermutation([r],e.rank),i=e;null!=a&&(i=Object(s.Jb)(e,a),r=s.X.getInnerMostAxes(1,e.rank)[0]);var o=Rn.computeOutShape(i.shape,r,n),u=s.Lb.sizeFromShape([i.shape[r]]),c=i.as2D(-1,u),l=s.Fb(e.dtype),h=this.segOpCompute(c,"unsortedSegmentSum",t,l,n).reshape(o);return null!=a&&(h=Object(s.Jb)(h,s.X.getUndoAxesPermutation(a))),h}},{key:"segOpCompute",value:function(e,t,n,r,a){var i=e.shape[0],o=e.shape[1],u=Rn.segOpComputeOptimalWindowSize(o,a),c=new en({windowSize:u,inSize:o,batchSize:i,numSegments:a},t),l=this.compileAndRun(c,[e,n],r);return l.shape[1]===a?l:(n=Object(s.ub)(0,a).tile([o/u]),this.segOpCompute(l,t,n,r,a))}},{key:"argMinMaxReduce",value:function(e,t,n){var r=[t];if(s.X.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!Object(s.jb)().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var a=_slicedToArray2(s.X.computeOutAndReduceShapes(e.shape,r),2),i=a[0],o=a[1],u=s.Lb.sizeFromShape(o),c=e.as2D(-1,u);return this.argReduce(c,n).reshape(i)}return this.argReducePacked(e,n)}},{key:"argMin",value:function(e,t){return this.argMinMaxReduce(e,t,"min")}},{key:"argMax",value:function(e,t){return this.argMinMaxReduce(e,t,"max")}},{key:"cumsum",value:function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis=".concat(e.rank-1," but got axis=")+t);for(var a=e.shape[t],i=e,o=0;o<=Math.ceil(Math.log2(a))-1;o++){var s=new ut(e.shape,!1,r),u=s.getCustomSetupFunc(o),c=i;i=this.compileAndRun(s,[i],i.dtype,u),c.dispose()}if(n){var l=new ut(e.shape,n,r),h=i;i=this.compileAndRun(l,[i]),h.dispose()}return i}},{key:"equal",value:function(e,t){if(Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new Ge("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"less",value:function(e,t){var n=this,r=this.tryRunOnCpuOrThrow([e,t],(function(){return n.cpuBackend.less(e,t)}));if(r)return r;if(Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var a=new Ge("return float(a < b);",e.shape,t.shape);return this.compileAndRun(a,[e,t],"bool")}},{key:"lessEqual",value:function(e,t){if(Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Ge("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"greater",value:function(e,t){var n=this,r=this.tryRunOnCpuOrThrow([e,t],(function(){return n.cpuBackend.greater(e,t)}));if(r)return r;if(Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var a=new Ge("return float(a > b);",e.shape,t.shape);return this.compileAndRun(a,[e,t],"bool")}},{key:"greaterEqual",value:function(e,t){if(Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Ge("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"logicalNot",value:function(e){var t=new fn(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])}},{key:"logicalAnd",value:function(e,t){if(Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Ge("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"logicalOr",value:function(e,t){if(Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Ge("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"select",value:function(e,t,n){var r=new tn(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],Object(s.Kb)(t.dtype,n.dtype))}},{key:"where",value:function(e){s.X.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Pn(e.shape,t)}},{key:"topk",value:function(e,t,n){var r=e.dataSync();return Dn(r,e.shape,e.dtype,t,n)}},{key:"min",value:function(e,t){s.X.assertAxesAreInnerMostDims("min",t,e.rank);var n=_slicedToArray2(s.X.computeOutAndReduceShapes(e.shape,t),2),r=n[0],a=n[1],i=s.Lb.sizeFromShape(a),o=e.as2D(-1,i);return this.reduce(o,"min",o.dtype).reshape(r)}},{key:"minimum",value:function(e,t){var n=this,r=this.tryRunOnCpuOrThrow([e,t],(function(){return n.cpuBackend.minimum(e,t)}));if(r)return r;var a=Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ke("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ge("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(a,[e,t])}},{key:"mod",value:function(e,t){var n=Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ke("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ge("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])}},{key:"maximum",value:function(e,t){var n=this,r=this.tryRunOnCpuOrThrow([e,t],(function(){return n.cpuBackend.maximum(e,t)}));if(r)return r;var a=Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ke("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ge("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(a,[e,t])}},{key:"all",value:function(e,t){s.X.assertAxesAreInnerMostDims("all",t,e.rank);var n=_slicedToArray2(s.X.computeOutAndReduceShapes(e.shape,t),2),r=n[0],a=n[1],i=s.Lb.sizeFromShape(a),o=e.as2D(-1,i);return this.reduce(o,"all",o.dtype).reshape(r)}},{key:"any",value:function(e,t){s.X.assertAxesAreInnerMostDims("any",t,e.rank);var n=_slicedToArray2(s.X.computeOutAndReduceShapes(e.shape,t),2),r=n[0],a=n[1],i=s.Lb.sizeFromShape(a),o=e.as2D(-1,i);return this.reduce(o,"any",o.dtype).reshape(r)}},{key:"floorDiv",value:function(e,t){if(Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new Ge("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")}},{key:"packedUnaryOp",value:function(e,t,n){var r=new En(e.shape,t);return this.compileAndRun(r,[e],n)}},{key:"packedBinaryOp",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=new Ke(n,e.shape,t.shape,a);return this.compileAndRun(i,[e,t],r)}},{key:"makeComplexComponentTensorInfo",value:function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}},{key:"addN",value:function(e){if(1===e.length)return e[0];if(e.length>Object(s.jb)().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var a=e.map((function(e){return e.dtype})).reduce((function(e,t){return Object(s.Kb)(e,t)})),i=e.map((function(e){return e.shape})),o=Object(s.jb)().getBool("WEBGL_PACK")?new Ae(e[0].shape,i):new Te(e[0].shape,i);return this.compileAndRun(o,e,a)}},{key:"pow",value:function(e,t){var n=Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ke("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Ge("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=Object(s.Kb)(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)}},{key:"ceil",value:function(e){if(this.shouldExecuteOnCPU([e])){var t=pe(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(Object(s.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,_n,e.dtype);var n=new fn(e.shape,_n);return this.compileAndRun(n,[e])}},{key:"floor",value:function(e){if(this.shouldExecuteOnCPU([e])){var t=ge(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(Object(s.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,bn,e.dtype);var n=new fn(e.shape,bn);return this.compileAndRun(n,[e])}},{key:"sign",value:function(e){var t=new fn(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])}},{key:"isNaN",value:function(e){var t=new fn(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")}},{key:"isInf",value:function(e){var t=new fn(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")}},{key:"isFinite",value:function(e){var t=new fn(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")}},{key:"round",value:function(e){var t=new fn(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])}},{key:"exp",value:function(e){if(this.shouldExecuteOnCPU([e])){var t=me(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(Object(s.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,kn,e.dtype);var n=new fn(e.shape,kn);return this.compileAndRun(n,[e])}},{key:"expm1",value:function(e){if(this.shouldExecuteOnCPU([e])){var t=ve(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(Object(s.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,wn,e.dtype);var n=new fn(e.shape,wn);return this.compileAndRun(n,[e])}},{key:"softmax",value:function(e,t){var n=s.Lb.parseAxisParam([t],e.shape),r=Object(s.nb)(e,n),a=s.X.expandShapeToKeepDim(r.shape,n),i=s.Eb(e,r.reshape(a)),o=this.exp(i),u=this.sum(o,n).reshape(a);return Object(s.hb)(o,u)}},{key:"log",value:function(e){if(this.shouldExecuteOnCPU([e])){var t=ye(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(Object(s.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var n=new fn(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(n,[e])}},{key:"log1p",value:function(e){var t=new fn(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])}},{key:"sqrt",value:function(e){var t=new fn(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])}},{key:"rsqrt",value:function(e){if(this.shouldExecuteOnCPU([e])){var t=ke(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}var n=new fn(e.shape,"return inversesqrt(x);");return this.compileAndRun(n,[e])}},{key:"reciprocal",value:function(e){var t=new fn(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])}},{key:"relu",value:function(e){var t;return t=Object(s.jb)().getBool("WEBGL_PACK")?new En(e.shape,Sn):new fn(e.shape,pn),this.compileAndRun(t,[e])}},{key:"relu6",value:function(e){var t;return t=Object(s.jb)().getBool("WEBGL_PACK")?new En(e.shape,Tn):new fn(e.shape,mn),this.compileAndRun(t,[e])}},{key:"prelu",value:function(e,t){var n=Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ke(He,e.shape,t.shape):new Ge(We,e.shape,t.shape);return this.compileAndRun(n,[e,t])}},{key:"elu",value:function(e){if(Object(s.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,An,e.dtype);var t=new fn(e.shape,vn);return this.compileAndRun(t,[e])}},{key:"eluDer",value:function(e,t){var n=Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ke("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new Ge("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])}},{key:"selu",value:function(e){var t=new fn(e.shape,gn);return this.compileAndRun(t,[e])}},{key:"clip",value:function(e,t,n){var r,a=(r=Object(s.jb)().getBool("WEBGL_PACK_CLIP")?new Qe(e.shape):new Xe(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=fe(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Object(s.jb)().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,dn,e.dtype);var n=new fn(e.shape,dn);return this.compileAndRun(n,[e])}},{key:"complexAbs",value:function(e){var t=this.texData.get(e.dataId),n=new Ye(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensorInfos.real),this.makeComplexComponentTensorInfo(e,t.complexTensorInfos.imag)];return this.compileAndRun(n,r)}},{key:"sigmoid",value:function(e){var t=new fn(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])}},{key:"softplus",value:function(e){var t=new fn(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])}},{key:"asin",value:function(e){var t=new fn(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(t,[e])}},{key:"acos",value:function(e){var t=new fn(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(t,[e])}},{key:"atan",value:function(e){var t=new fn(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(t,[e])}},{key:"sinh",value:function(e){var t=new fn(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])}},{key:"cosh",value:function(e){var t=new fn(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])}},{key:"tanh",value:function(e){var t=new fn(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])}},{key:"asinh",value:function(e){var t=new fn(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])}},{key:"acosh",value:function(e){var t=new fn(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(t,[e])}},{key:"atanh",value:function(e){var t=new fn(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(t,[e])}},{key:"erf",value:function(e){var t=new fn(e.shape,xn);return this.compileAndRun(t,[e])}},{key:"step",value:function(e,t){var n=new fn(e.shape,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(".concat(e,");\n  ")}(t));return this.compileAndRun(n,[e])}},{key:"conv2dByMatMul",value:function(e,t,n,r,a,i){var o=e.shape,u=this.texData.get(e.dataId),c="channelsLast"===n.dataFormat,l=o[2]%2!=0&&!!u.isPacked;if((1==o[0]*o[1]*o[2]||1===n.outChannels)&&n.inChannels>1e3||!Object(s.jb)().getBool("WEBGL_LAZILY_UNPACK")||!Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!l){var h=c?o[0]*o[1]*o[2]:o[0]*o[2]*o[3],f=Object(s.xb)(e,[1,h,n.inChannels]),d=Object(s.xb)(t,[1,n.inChannels,n.outChannels]),p=this.fusedBatchMatMul({a:f,b:d,transposeA:!1,transposeB:!1,bias:r,activation:a,preluActivationWeights:i});return Object(s.xb)(p,n.outShape)}var m={dataId:e.dataId,shape:[1,c?o[0]*o[1]*(o[2]+1):o[0]*o[2]*(o[3]+1),n.inChannels],dtype:e.dtype},v=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,s.Lb.assert(N(u.shape,m.shape),(function(){return"packed reshape ".concat(u.shape," to ").concat(m.shape," isn't free")}));var g=Object(s.xb)(t,[1,n.inChannels,n.outChannels]),y=this.fusedBatchMatMul({a:m,b:g,transposeA:!1,transposeB:!1,bias:r,activation:a,preluActivationWeights:i}),_=this.texData.get(y.dataId);return s.Lb.assert(_.isPacked,(function(){return"batchMatMul result is expected to be packed"})),u.shape=v,_.shape=n.outShape,Object(s.ib)().makeTensorFromDataId(y.dataId,n.outShape,y.dtype)}},{key:"conv2dWithIm2Row",value:function(e,t,n,r,a,i){var o=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,h="channelsLast"===n.dataFormat,f=o*s*u,d=l*c,p=[f,d],m=e.squeeze([0]),v=t.reshape([1,f,-1]),g=new Rt(p,m.shape,n),y=this.compileAndRun(g,[m]).reshape([1,p[0],p[1]]),_=null!=r,b=null!=i,k=a?Mn(a,!0):null,w=new Mt(y.shape,v.shape,[1,d,n.outChannels],!0,!1,_,k,b),x=[y,v];return r&&x.push(r),b&&x.push(i),this.compileAndRun(w,x).reshape(h?[1,l,c,n.outChannels]:[1,n.outChannels,l,c])}},{key:"fusedConv2d",value:function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,a,i,o);if(Object(s.jb)().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,a,i,o);var u=null!=a,c=null!=o,l=i?Mn(i,!1):null,h=new rt(r,u,l,c),f=[t,n];return a&&f.push(a),o&&f.push(o),this.compileAndRun(h,f)}},{key:"conv2d",value:function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(Object(s.jb)().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new rt(n);return this.compileAndRun(r,[e,t])}},{key:"conv2dDerInput",value:function(e,t,n){var r=new Je(n);return this.compileAndRun(r,[e,t])}},{key:"conv2dDerFilter",value:function(e,t,n){var r=new Ze(n);return this.compileAndRun(r,[e,t])}},{key:"fusedDepthwiseConv2D",value:function(e){var t,n=e.input,r=e.filter,a=e.convInfo,i=e.bias,o=e.activation,u=e.preluActivationWeights,c=Object(s.jb)().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,l=o?Mn(o,c):null,h=[n,r],f=null!=i,d=null!=u;return f&&h.push(i),d&&h.push(u),c?(t=new ot(a,f,l,d),this.compileAndRun(t,h)):(t=new it(a,f,l,d),this.compileAndRun(t,h))}},{key:"depthwiseConv2D",value:function(e,t,n){var r;return Object(s.jb)().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new ot(n),this.compileAndRun(r,[e,t])):(r=new it(n),this.compileAndRun(r,[e,t]))}},{key:"depthwiseConv2DDerInput",value:function(e,t,n){var r=new nt(n);return this.compileAndRun(r,[e,t])}},{key:"depthwiseConv2DDerFilter",value:function(e,t,n){var r=new tt(n);return this.compileAndRun(r,[e,t])}},{key:"conv3d",value:function(e,t,n){var r=new at(n);return this.compileAndRun(r,[e,t])}},{key:"conv3dDerInput",value:function(e,t,n){var r=new et(n);return this.compileAndRun(r,[e,t])}},{key:"conv3dDerFilter",value:function(e,t,n){var r=new $e(n);return this.compileAndRun(r,[e,t])}},{key:"unstack",value:function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;for(var u=new Array(n),c=0;c<u.length;c++)o[t]=c,u[c]=this.slice(e,o,s).reshape(r);return u}},{key:"avgPool3d",value:function(e,t){var n=new Ut(t,"avg",!1);return this.compileAndRun(n,[e],"float32")}},{key:"avgPool3dBackprop",value:function(e,t,n){var r=new Ue(n);return this.compileAndRun(r,[e],t.dtype)}},{key:"maxPool3d",value:function(e,t){var n=new Ut(t,"max",!1);return this.compileAndRun(n,[e],"float32")}},{key:"maxPool3dBackprop",value:function(e,t,n,r){var a=new Ut(r,"max",!0),i=this.compileAndRun(a,[t]),o=new Ft(r),s=this.compileAndRun(o,[e,i],t.dtype);return i.dispose(),s}},{key:"resizeBilinear",value:function(e,t,n,r){var a=Object(s.jb)().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Xt(e.shape,t,n,r):new Kt(e.shape,t,n,r);return this.compileAndRun(a,[e],"float32")}},{key:"resizeBilinearBackprop",value:function(e,t,n){var r=new Ht(e,t,n);return this.compileAndRun(r,[e])}},{key:"resizeNearestNeighbor",value:function(e,t,n,r){var a=new Yt(e.shape,t,n,r);return this.compileAndRun(a,[e])}},{key:"resizeNearestNeighborBackprop",value:function(e,t,n){var r=new Qt(e,t,n);return this.compileAndRun(r,[e])}},{key:"multinomial",value:function(e,t,n,r){var a=t?e:Object(s.Bb)(e),i=new Lt(a.shape[0],a.shape[1],n),o=i.getCustomSetupFunc(r);return this.compileAndRun(i,[a],"int32",o)}},{key:"oneHot",value:function(e,t,n,r){var a=new zt(e.size,t,n,r);return this.compileAndRun(a,[e])}},{key:"diag",value:function(e){var t=new pt(e.size);return this.compileAndRun(t,[e])}},{key:"cropAndResize",value:function(e,t,n,r,a,i){var o=new st(e.shape,t.shape,r,a,i);return this.compileAndRun(o,[e,t,n],"float32")}},{key:"depthToSpace",value:function(e,t,n){s.Lb.assert(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var r=e.shape[0],a=("NHWC"===n?e.shape[1]:e.shape[2])*t,i=("NHWC"===n?e.shape[2]:e.shape[3])*t,o=("NHWC"===n?e.shape[3]:e.shape[1])/(t*t),u=new dt("NHWC"===n?[r,a,i,o]:[r,o,a,i],t,n);return this.compileAndRun(u,[e])}},{key:"split",value:function(e,t,n){return On(e,t,n)}},{key:"scatterND",value:function(e,t,n){var r=s.X.calculateShapes(t,e,n),a=r.sliceRank,i=r.numUpdates,o=r.sliceSize,u=r.strides,c=r.outputSize,l=[c/o,o],h=e.reshape([i,a]),f=t.reshape([i,o]);if(0===c)return s.X.reshapeTensor(Object(s.Gb)([]),n);var d=Object(s.yb)(0),p=new $t(i,a,h.rank,f.rank,u,l);return this.compileAndRun(p,[f,h,d]).reshape(n)}},{key:"sparseToDense",value:function(e,t,n,r){var a=s.X.calculateShapes(t,e,n),i=a.sliceRank,o=a.numUpdates,u=a.strides,c=a.outputSize,l=new $t(o,i,e.rank,t.rank,u,[c,1],!1);return this.compileAndRun(l,[t,e,r]).reshape(n)}},{key:"gatherND",value:function(e,t){var n=t.shape,r=n[n.length-1],a=_slicedToArray2(s.X.prepareAndValidate(e,t),4),i=a[0],o=a[1],u=a[2],c=a[3],l=t.reshape([o,r]),h=e.reshape([e.size/u,u]),f=new kt(r,c,[o,u]);return this.compileAndRun(f,[h,l]).reshape(i)}},{key:"fill",value:function(e,t,n){if("string"===(n=n||s.Lb.inferDtype(t))){var r=s.Lb.getArrayFromDType(n,s.Lb.sizeFromShape(e));return r.fill(t),Object(s.ib)().makeTensor(r,e,n,this)}var a=new _t(e,t),i=a.getCustomSetupFunc(t);return this.compileAndRun(a,[],n,i)}},{key:"onesLike",value:function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)}},{key:"zerosLike",value:function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)}},{key:"linspace",value:function(e,t,n){return s.X.linspaceImpl(e,t,n)}},{key:"makeTensorInfo",value:function(e,t,n){var r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){var r=this.makeTensorInfo(e,t,n).dataId;return Object(s.ib)().makeTensorFromDataId(r,e,t,this)}},{key:"unpackTensor",value:function(e){var t=new In(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new Bt(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[E(e.shape)].concat(_toConsumableArray(I(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[E(t)].concat(_toConsumableArray(I(t))),i=new Gt(a,n),o=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}},{key:"decode",value:function(e){var t,n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype,o=R(a);return t=r?new ft(o):new ht(o),{dtype:i,shape:a,dataId:this.runWebGLProgram(t,[{shape:o,dtype:i,dataId:e}],i,null,!0).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var i=this,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=this.makeTensorInfo(e.outputShape,n),c=this.texData.get(u.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===a.DENSE){var l=f(e.outputShape);c.texShape=l.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(c.usage=e.outTexUsage),0===s.Lb.sizeFromShape(u.shape))return c.values=s.Lb.getTypedArrayFromDType(u.dtype,0),u;var h=[],d=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&s.Lb.sizeFromShape(t.shape)<=Object(s.jb)().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?i.unpackTensor(t):i.packTensor(t),h.push(t),n=i.texData.get(t.dataId);else if(n.isPacked&&!N(n.shape,t.shape)){var r=t,a=t.shape;t.shape=n.shape,t=i.packedReshape(t,a),h.push(t),n=i.texData.get(t.dataId),r.shape=a}return i.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(u.dataId);var p,m={shape:u.shape,texData:c,isUniform:!1},v=function(e,t,n){var r="";t.concat(n).forEach((function(e){r+="".concat(e.shape,"_").concat(e.isUniform?"uniform":e.texData.texShape,"_").concat(null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0)}));var a=e.constructor.name;return a+="_"+r+"_"+e.userCode}(e,d,m),g=this.getAndSaveBinary(v,(function(){return function(e,t,n,r){var a=t.userCode,i=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=i.map((function(e){return e.shapeInfo})),u={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},c=function(e,t,n,r){var a=[];e.forEach((function(e){var t=s.Lb.sizeFromShape(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?a.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(a.push("uniform sampler2D ".concat(e.name,";")),a.push("uniform int offset".concat(e.name,";")))}));var i,o,u=a.join("\n"),c=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="";return r+=n?function e(t){switch(t.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name;return"\n    vec4 ".concat("get"+t.charAt(0).toUpperCase()+t.slice(1),"() {\n      return ").concat(Oe().texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(t);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=Oe();return"\n    vec4 ".concat(n,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(a[0],", ").concat(a[1],", index);\n      return ").concat(i.texture2D,"(").concat(t,", uv);\n    }\n  ")}(t);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=a[0],o=a[1],u=Oe();if(null!=a&&s.Lb.arraysEqual(t,a))return"\n      vec4 ".concat(r,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o,".0, ").concat(i,".0);\n\n        return ").concat(u.texture2D,"(").concat(n,", uv);\n      }\n    ");var c=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(Math.ceil(t[1]/2),", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(n,", uv);\n    }\n  ")}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=Be(t,n.slice(1));return"\n        ".concat(e(s),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(je(["b","row","col"],[1,2]),");\n        }\n      ")}var u=o[0],c=o[1],l=Math.ceil(n[2]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(u,", ").concat(c,", ").concat(l*Math.ceil(n[1]/2),", ").concat(l,", b, row, col);\n      return ").concat(Oe().texture2D,"(").concat(r,", uv);\n    }\n  ")}(t);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=o[0],u=o[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),h="int b, int row, int col",f="b * ".concat(l," + (row / 2) * ").concat(c," + (col / 2)"),d=2;d<n-1;d++)h="int b".concat(d,", ")+h,l*=t[n-d-1],f="b".concat(d," * ").concat(l," + ")+f;return"\n    vec4 ".concat(a,"(").concat(h,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(s,");\n      return ").concat(Oe().texture2D,"(").concat(r,", uv);\n    }\n  ")}(t)}}(e):function e(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");var r=_slicedToArray2(e.shapeInfo.texShape,2),a=r[0],i=r[1];if(1===a&&1===i)return"\n      float ".concat(n,"() {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=_slicedToArray2(e.shapeInfo.texShape,2),s=o[0],u=o[1];return"\n    float ".concat(n,"() {\n      vec2 uv = uvFromFlat(").concat(s,", ").concat(u,", ").concat(Me(t),");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(t);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(n,"(int index) {\n        ").concat(Le(e),"\n      }\n    ");var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===i&&1===a)return"\n      float ".concat(n,"(int index) {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=Me(t);return 1===i?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / ").concat(a,".0);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):1===a?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / ").concat(i,".0, 0.5);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):"\n    float ".concat(n,"(int index) {\n      vec2 uv = uvFromFlat(").concat(a,", ").concat(i,", index + ").concat(o,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(t);case 2:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape;if(null!=i&&s.Lb.arraysEqual(n,i))return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(i[1],".0, ").concat(i[0],".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var o=s.Lb.squeezeShape(n),u=o.newShape,c=o.keptDims;if(u.length<n.length){var l=Be(t,u);return"\n      ".concat(e(l),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(je(["row","col"],c),");\n      }\n    ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(Le(t),"\n      }\n    ");var h=i[0],f=i[1],d=Me(r);return 1===f?"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(d,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(h,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):1===h?"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(d,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(f,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(d,";\n    vec2 uv = uvFromFlat(").concat(h,", ").concat(f,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],u=s.Lb.squeezeShape(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var h=Be(t,c);return"\n        ".concat(e(h),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(je(["row","col","depth"],l),");\n        }\n      ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(Le(t),"\n      }\n    ");var f=t.shapeInfo.texShape,d=f[0],p=f[1],m=t.shapeInfo.flatOffset;return p===i&&null==m?"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(p,".0, ").concat(d,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      "):p===o&&null==m?"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(p,".0, ").concat(d,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(Me(r),";\n        vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(t);case 4:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,u=n[1]*o,c=s.Lb.squeezeShape(n),l=c.newShape,h=c.keptDims;if(l.length<n.length){var f=Be(t,l);return"\n      ".concat(e(f),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(je(["row","col","depth","depth2"],h),");\n      }\n    ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(u,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(Le(t),"\n      }\n    ");var d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,m=p[0],v=p[1];return v===u&&null==d?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):v===i&&null==d?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(u," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index + ").concat(Me(r),");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(t);case 5:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[4],o=n[3]*i,u=n[2]*o,c=n[1]*u,l=s.Lb.squeezeShape(n),h=l.newShape,f=l.keptDims;if(h.length<n.length){var d=Be(t,h);return"\n      ".concat(e(d),"\n      float ").concat(a,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(a,"(").concat(je(["row","col","depth","depth2","depth3"],f),");\n      }\n    ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(c,", ").concat(u,", ").concat(o,", ").concat(i,")) +\n          depth3;\n        ").concat(Le(t),"\n      }\n    ");var p=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,v=m[0],g=m[1];return g===c&&null==p?"\n      float ".concat(a,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(u,", ").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):g===i&&null==p?"\n      float ".concat(a,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(n[1]*n[2]*n[3],",\n               ").concat(n[2]*n[3],", ").concat(n[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(c," + col * ").concat(u," + depth * ").concat(o," +\n          depth2 * ").concat(i," + depth3 + ").concat(Me(r),";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(g,", index);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(t);case 6:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=s.Lb.squeezeShape(n),o=i.newShape,u=i.keptDims;if(o.length<n.length){var c=Be(t,o);return"\n      ".concat(e(c),"\n      float ").concat(a,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(a,"(").concat(je(["row","col","depth","depth2","depth3","depth4"],u),");\n      }\n    ")}var l=n[5],h=n[4]*l,f=n[3]*h,d=n[2]*f,p=n[1]*d;if(t.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(p,", ").concat(d,", ").concat(f,", ").concat(h,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(l,", 1)));\n        ").concat(Le(t),"\n      }\n    ");var m=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,g=v[0],y=v[1];return y===p&&null==m?"\n      float ".concat(a,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(d,", ").concat(f,", ").concat(h,", ").concat(l,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(y,".0, ").concat(g,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):y===l&&null==m?"\n      float ".concat(a,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(n[1]*n[2]*n[3]*n[4],",\n               ").concat(n[2]*n[3]*n[4],",\n               ").concat(n[3]*n[4],",\n               ").concat(n[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(y,".0, ").concat(g,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(p," + col * ").concat(d," + depth * ").concat(f," +\n          depth2 * ").concat(h," + depth3 * ").concat(l," + depth4 + ").concat(Me(r),";\n      vec2 uv = uvFromFlat(").concat(g,", ").concat(y,", index);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(e),e.shapeInfo.logicalShape.length<=t.logicalShape.length&&(r+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,c=Fe(e.shapeInfo.logicalShape,t.logicalShape),l=ze(u),h=u-o,f=["x","y","z","w","u","v"];n=0===o?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords.".concat(f[e+h]," = 0;")})).join("\n");var d;d=u<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+f[t+h]})).join(", ");var p="return outputValue;",m=1===s.Lb.sizeFromShape(e.shapeInfo.logicalShape),v=1===s.Lb.sizeFromShape(t.logicalShape);if(1!==o||m||v){if(m&&!v)p=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var g=o-2,y=o-1;c.indexOf(g)>-1&&c.indexOf(y)>-1?p="return vec4(outputValue.x);":c.indexOf(g)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(y)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(d,");\n      ").concat(p,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=e.shapeInfo.logicalShape.length,o=t.logicalShape.length;if(!e.shapeInfo.isUniform&&i===o&&null==e.shapeInfo.flatOffset&&s.Lb.arraysEqual(e.shapeInfo.texShape,t.texShape))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var u,c=ze(o),l=Fe(e.shapeInfo.logicalShape,t.logicalShape),h=o-i,f=["x","y","z","w","u","v"];u=0===i?"":o<2&&l.length>=1?"coords = 0;":l.map((function(e){return"coords.".concat(f[e+h]," = 0;")})).join("\n");var d;return d=o<2&&i>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+f[t+h]})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(u,"\n      return get").concat(r,"(").concat(d,");\n    }\n  ")}(e,t)),r}(e,t,r)})).join("\n"),l=t.texShape,h=Oe(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(h),d=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    \nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  ")}(h);return t.isPacked?(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(n[1],".0);\n      }\n    "):1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(n[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      return 2 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n    }\n  ")}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(s.Lb.arraysEqual(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(n[0],", ").concat(n[1],"));\n      }\n    ");var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),a=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t);default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),i=a,o="",s="b, r, c",u=2;u<e.length-1;u++)i*=e[e.length-u-1],o="\n      int b".concat(u," = index / ").concat(i,";\n      index -= b").concat(u," * ").concat(i,";\n    ")+o,s="b".concat(u,", ")+s;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      ").concat(o,"\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec").concat(e.length,"(").concat(s,");\n    }\n  ")}(e,t)}}(t.logicalShape,l),o=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(h)):(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    "):1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t);case 2:return function(e,t){return s.Lb.arraysEqual(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=Ne(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t);case 4:return function(e,t){var n=Ne(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t);case 5:return function(e,t){var n=Ne(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=Ne(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}}(t.logicalShape,l),o=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(h)),r&&(d+="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n"),[d,f,o,u,i,c,n].join("\n")}(i,u,a,t.packedInputs),l=e.createProgram(c),h=null,f=e.getUniformLocation(l,"NAN",!1);1===Object(s.jb)().getNumber("WEBGL_VERSION")&&(h=e.getUniformLocation(l,"INFINITY",!1));for(var d={},p=0;p<t.variableNames.length;p++){var m=t.variableNames[p];d[m]=e.getUniformLocation(l,m,!1),d["offset"+m]=e.getUniformLocation(l,"offset"+m,!1)}return{program:t,source:c,webGLProgram:l,uniformLocations:d,inShapeInfos:o,outShapeInfo:u,infLoc:h,nanLoc:f}}(i.gpgpu,e,d,m)})),y=null!=this.activeTimers;if(y&&(p=this.startTimer()),function(e,t,n,r,a){It(t.inShapeInfos,n),It([t.outShapeInfo],[r]);var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i,o[0],o[1]):e.setOutputMatrixTexture(i,o[0],o[1]),e.setProgram(t.webGLProgram),1===Object(s.jb)().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset"+a];if(null!=i)if(n.isUniform)if(s.Lb.sizeFromShape(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var u=n.uniformValues;u instanceof Float32Array||(u=new Float32Array(u)),e.gl.uniform1fv(i,u)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,i,r)})),null!=a&&a(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,g,d,m,r),h.forEach((function(e){return i.disposeIntermediateTensorInfo(e)})),y&&(p=this.endTimer(p),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(p)})),!Object(s.jb)().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&!1===o){var _=this.unpackTensor(u);return this.disposeIntermediateTensorInfo(u),_}return u}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=this.runWebGLProgram(e,t,n=n||t[0].dtype,r,a);return Object(s.ib)().makeTensorFromDataId(i.dataId,i.shape,i.dtype)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;this.disposed||(Object(s.jb)().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Object(s.Hb)((function(){if(!Object(s.jb)().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=Object(s.jb)().getBool("DEBUG");Object(s.jb)().set("DEBUG",!1);var n=e.abs(Object(s.yb)(1e-8)).dataSync()[0];if(Object(s.jb)().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,o=t.texture,u=t.usage,c=t.isPacked;if(null==o){var l,h=null!=this.activeTimers;h&&(l=s.Lb.now());var f=t.texShape;if(null==f&&(f=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(s.jb)().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map((function(t,n){return n>=e.length-2?s.Lb.nearestLargerEven(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var r=s.Lb.squeezeShape(e);e=r.newShape}var a=s.Lb.sizeFromShape(e);if(e.length<=1&&a<=n)return[1,a];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){var i,o=E(e),u=2,c=2;return e.length&&(u=(i=_slicedToArray2(I(e),2))[0],c=i[1]),a=o*(u/2)*(c/2),s.Lb.sizeToSquarishShape(a).map((function(e){return 2*e}))}return s.Lb.sizeToSquarishShape(a)}(n,c),t.texShape=f),null!=a){var p,m,v=R(n),g=f[1],y=f[0],_=a instanceof Uint8Array;c?(g=(p=_slicedToArray2(d(f[0],f[1]),2))[0],y=p[1],m=new yt(v,[y,g],_)):m=new gt(v,[y,g],_);var b=this.makeTensorInfo([y,g],r);this.texData.get(b.dataId).usage=_?i.PIXELS:i.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),g,y,a);var k=this.runWebGLProgram(m,[b],r,null,!0),w=this.texData.get(k.dataId);t.texture=w.texture,t.texShape=w.texShape,t.isPacked=w.isPacked,t.usage=w.usage,this.disposeIntermediateTensorInfo(b),this.texData.delete(k.dataId),t.values=null,h&&(this.uploadWaitMs+=s.Lb.now()-l)}else{var x=this.acquireTexture(f,u,r,c);t.texture=x}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*s.Lb.bytesPerElement(t)}},{key:"tryRunOnCpuOrThrow",value:function(e,t){if(this.shouldExecuteOnCPU(e))try{return t()}catch(e){if(Object(s.jb)().getBool("IS_TEST"))throw new Error("CPU forwarding failed")}return null}}]),u}(s.w);function zn(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}s.fb.isBrowser()&&Object(s.vb)("webgl",(function(){return new Ln}),2);var Bn={kernelName:s.u,backendName:"webgl",kernelFunc:zn};function jn(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=zn({inputs:{x:r},backend:n});n.texData.get(s.dataId).complexParentRefCount++;var u=zn({inputs:{x:a},backend:n});return n.texData.get(u.dataId).complexParentRefCount++,o.complexTensorInfos={real:s,imag:u},i}var Vn={kernelName:s.h,backendName:"webgl",kernelFunc:jn};function qn(e){return function(t){var n=t.inputs,r=t.backend,a=n.x,i=r,o=new fn(a.shape,e);return i.runWebGLProgram(o,[a],a.dtype)}}function Un(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,u=e.cpuKernelImpl,c=e.dtype;return function(e){var r=e.inputs,i=e.backend,l=r.a,h=r.b,f=i;if(o&&"complex64"===l.dtype){var d=f.texData.get(l.dataId),p=f.texData.get(h.dataId),m=[[d.complexTensorInfos.real,p.complexTensorInfos.real],[d.complexTensorInfos.imag,p.complexTensorInfos.imag]].map((function(e){var n=_slicedToArray2(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:l.shape},o={dataId:a.dataId,dtype:a.dtype,shape:h.shape},u=new Ge(t,l.shape,h.shape);return f.runWebGLProgram(u,[i,o],Object(s.Kb)(r.dtype,a.dtype))})),v=_slicedToArray2(m,2),g=v[0],y=v[1],_=jn({inputs:{real:g,imag:y},backend:f});return f.disposeIntermediateTensorInfo(g),f.disposeIntermediateTensorInfo(y),_}var b,k=c||Object(s.Kb)(l.dtype,h.dtype);if(f.shouldExecuteOnCPU([l,h])&&null!=u){var w=f.texData.get(l.dataId),x=f.texData.get(h.dataId),C=_slicedToArray2(u(l.shape,h.shape,w.values,x.values,k),2),S=C[0],T=C[1],A=f.makeTensorInfo(T,k);return f.texData.get(A.dataId).values=S,A}return b=Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new Ke(n,l.shape,h.shape,a):new Ge(t,l.shape,h.shape),f.runWebGLProgram(b,[l,h],k)}}var Wn="return a + b;",Gn=Un({opSnippet:Wn,packedOpSnippet:Wn,supportsComplex:!0,cpuKernelImpl:de}),Hn={kernelName:s.b,backendName:"webgl",kernelFunc:Gn},Kn=Un({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),Xn={kernelName:s.c,backendName:"webgl",kernelFunc:Kn},Qn={kernelName:s.d,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;M(a,"avgPool");var i=r.filterSize,o=r.strides,u=r.pad,c=r.dimRoundingMode;s.Lb.assert(s.X.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '1'")}));var l=s.X.computePool2DInfo(a.shape,i,o,1,u,c);if(1===l.filterWidth&&1===l.filterHeight&&s.Lb.arraysEqual(l.inShape,l.outShape))return zn({inputs:{x:a},backend:n});var h=new qt(l,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}},Yn={kernelName:s.e,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;M([a,i],"avgPoolBackprop");var u=r.filterSize,c=r.strides,l=r.pad,h=s.X.computePool2DInfo(o.shape,u,c,1,l),f=new qe(h);return n.runWebGLProgram(f,[a],o.dtype)}},Zn=function e(t,n,r,a,i,o){_classCallCheck2(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],s.X.assertAndGetBroadcastShape(t,n),s.X.assertAndGetBroadcastShape(t,r);var u="0.0";null!=a&&(s.X.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),u="getOffsetAtOutCoords()");var c="1.0";null!=i&&(s.X.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(u,";\n        float scale = ").concat(c,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")},Jn=function e(t,n,r,a,i,o){_classCallCheck2(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],s.X.assertAndGetBroadcastShape(t,n),s.X.assertAndGetBroadcastShape(t,r);var u="vec4(0.0)";null!=a&&(s.X.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),u="getOffsetAtOutCoords()");var c="vec4(1.0)";null!=i&&(s.X.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(u,";\n        vec4 scale = ").concat(c,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")},$n={kernelName:s.s,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,u=t.offset,c=t.scale;s.Lb.assert(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),s.Lb.assert(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),s.Lb.assert(null==c||i.shape.length===c.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var l=r.varianceEpsilon;null==l&&(l=.001);var h=[a,i,o],f=null;null!=u&&(f=u.shape,h.push(u));var d=null;null!=c&&(d=c.shape,h.push(c));var p=Object(s.jb)().getBool("WEBGL_PACK_NORMALIZATION")?new Jn(a.shape,i.shape,o.shape,f,d,l):new Zn(a.shape,i.shape,o.shape,f,d,l);return n.runWebGLProgram(p,h,h[0].dtype)}},er=Un({opSnippet:"return float(a != b);",dtype:"bool"}),tr={kernelName:s.I,backendName:"webgl",kernelFunc:er};function nr(e){var t=e.inputs,n=e.backend,r=t.input;return zn({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var rr={kernelName:s.J,backendName:"webgl",kernelFunc:nr},ar={kernelName:s.f,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return zn({inputs:{x:i},backend:r});var u=s.Nb(i.shape),c=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),l=jn({inputs:{real:c,imag:u},backend:r});return u.dispose(),r.disposeIntermediateTensorInfo(c),l}if("complex64"===i.dtype){var h=nr({inputs:{input:i},backend:r}),f=e({inputs:{x:h},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(h),f}if(!s.Lb.hasEncodingLoss(i.dtype,o)){var d=zn({inputs:{x:i},backend:r});return{dataId:d.dataId,shape:d.shape,dtype:o}}if("int32"===o)return function(e,t){var n=new fn(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var p=r.makeTensorInfo([],"bool",s.Lb.getTypedArrayFromDType("bool",1)),m=er({inputs:{a:i,b:p},backend:r});return r.disposeIntermediateTensorInfo(p),m}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},ir=function e(t){_classCallCheck2(this,e),this.outputShape=[],this.outputShape=s.X.computeOutShape(t,1),this.variableNames=t.map((function(e,t){return"T"+t}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++)a.push("else if (yC < ".concat(n[i],") setOutput(getT").concat(i,"(yR, yC-").concat(n[i-1],"));"));a.push("else setOutput(getT".concat(n.length,"(yR, yC-").concat(n[n.length-1],"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")},or=function e(t,n){_classCallCheck2(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=s.X.computeOutShape(t,n);var r=this.outputShape,a=r.length,i=ze(a),o=Re("coords",a),u=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T"+t}));var c=new Array(t.length-1);c[0]=t[0][n];for(var l=1;l<c.length;l++)c[l]=c[l-1]+t[l][n];for(var h=u[n],f=u.slice(-2),d=u.join(),p="if (".concat(h," < ").concat(c[0],") {\n        return getChannel(\n            getT0(").concat(d,"), vec2(").concat(f.join(),"));\n        }"),m=1;m<c.length;m++){var v=c[m-1];p+="\n        if (".concat(h," < ").concat(c[m],"  && ").concat(h," >= ").concat(c[m-1],") {\n          return getChannel(\n            getT").concat(m,"(").concat(sr(u,h,v),"),\n            vec2(").concat(sr(f,h,v),"));\n        }")}var g=c[c.length-1];p+="\n        return getChannel(\n          getT".concat(c.length,"(").concat(sr(u,h,g),"),\n          vec2(").concat(sr(f,h,g),"));"),this.userCode="\n      float getValue(".concat(u.map((function(e){return"int "+e})),") {\n        ").concat(p,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")};function sr(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function ur(e){var t=e.inputs,n=e.backend,r=t.input;return zn({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var cr={kernelName:s.v,backendName:"webgl",kernelFunc:ur};function lr(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,u=s.Lb.sizeFromShape(a.shape),c=s.Lb.inferFromImplicitShape(i,u),l=s.Lb.sizeFromShape(c);s.Lb.assert(u===l,(function(){return"The new shape (".concat(c,") has ").concat(l," elements and the old shape (").concat(a.shape,") has ").concat(u," elements. The new shape and old shape must have the same number of elements.")}));var h=o.texData.get(a.dataId);return!h.isPacked||N(a.shape,c)||null!==h.texture&&N(h.shape,c)?(o.incRef(a.dataId),{dataId:a.dataId,shape:c,dtype:a.dtype}):function(e,t,n){var r=[E(e.shape)].concat(_toConsumableArray(I(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[E(t)].concat(_toConsumableArray(I(t))),o=new Gt(i,r),s=n.runWebGLProgram(o,[a],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}(a,c,o)}var hr={kernelName:s.K,backendName:"webgl",kernelFunc:lr},fr={kernelName:s.i,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=s.Lb.parseAxisParam(r,t[0].shape)[0],i=s.X.computeOutShape(t.map((function(e){return e.shape})),a);if(0===s.Lb.sizeFromShape(i))return n.makeTensorInfo(i,t[0].dtype,[]);var o=t.filter((function(e){return s.Lb.sizeFromShape(e.shape)>0}));if(1===o.length)return o[0];var u=o.map((function(e){return e.shape}));return s.X.assertParamsConsistent(u,a),function e(t,n,r){var a=t[0].dtype;if("complex64"===a){var i=t.map((function(e){return nr({inputs:{input:e},backend:r})})),o=t.map((function(e){return ur({inputs:{input:e},backend:r})})),u=e(i,n,r),c=e(o,n,r),l=jn({inputs:{real:u,imag:c},backend:r});return i.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),o.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),r.disposeIntermediateTensorInfo(u),r.disposeIntermediateTensorInfo(c),l}if(t.length>Object(s.jb)().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var h=Math.floor(t.length/2),f=e(t.slice(0,h),n,r),d=e(t.slice(h),n,r),p=e([f,d],n,r);return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),p}if(Object(s.jb)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){var m=new or(t.map((function(e){return e.shape})),n);return r.runWebGLProgram(m,t,a)}var v=s.X.computeOutShape(t.map((function(e){return e.shape})),n),g=t.map((function(e){return lr({inputs:{x:e},attrs:{shape:[-1,s.Lb.sizeFromShape(e.shape.slice(n))]},backend:r})})),y=new ir(g.map((function(e){return e.shape}))),_=r.runWebGLProgram(y,g,a);g.forEach((function(e){return r.disposeIntermediateTensorInfo(e)}));var b=lr({inputs:{x:_},attrs:{shape:v},backend:r});return r.disposeIntermediateTensorInfo(_),b}(o,a,n)}},dr=qn("if (isnan(x)) return x;\n  return cos(x);\n"),pr={kernelName:s.j,backendName:"webgl",kernelFunc:dr},mr=Un({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),vr={kernelName:s.l,backendName:"webgl",kernelFunc:mr},gr=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,s=r?a+".0":"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")};function yr(e,t,n){var r=n.texData.get(e.dataId),a=s.Lb.sizeFromShape(e.shape),i=e.shape[e.shape.length-1],o=lr({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}).shape,u=new gr("real",o,t),c=new gr("imag",o,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:o},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:o}],h=n.runWebGLProgram(u,l,"float32"),f=n.runWebGLProgram(c,l,"float32"),d=jn({inputs:{real:h,imag:f},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f);var p=lr({inputs:{x:d},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(p),p}var _r,br={kernelName:s.o,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return yr(t.input,!1,n)}},kr=function e(t){_classCallCheck2(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},wr={kernelName:s.p,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new kr(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},xr=function e(t){_classCallCheck2(this,e),this.variableNames=["A"];var n=Oe(),r=_slicedToArray2(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")},Cr=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Oe(),r=_slicedToArray2(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},Sr={kernelName:s.r,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,o=r.numChannels,u="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,c="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,l=_slicedToArray2(u?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),h=l[0],f=l[1],d=[f,h],p=[f,h,o];(c||u)&&(null==_r&&(_r=document.createElement("canvas").getContext("2d")),_r.canvas.width=h,_r.canvas.height=f,_r.drawImage(a,0,0,h,f),a=_r.canvas);var m=n.makeTensorInfo(d,"int32");n.texData.get(m.dataId).usage=i.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(m.dataId),a);var v=Object(s.jb)().getBool("WEBGL_PACK")?new Cr(p):new xr(p),g=n.runWebGLProgram(v,[m],"int32");return n.disposeData(m.dataId),g}},Tr={kernelName:s.t,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return yr(t.input,!0,n)}},Ar=function e(t,n){_classCallCheck2(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var u=4*Math.floor(r/4),c=r%4,l="sumValue += dot(values, ones);";if(null!=n){var h=1/n;l="sumValue += dot(values * ".concat(s.Lb.isInt(h)?h.toPrecision(2):h,", ones);")}var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(f,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")};function Er(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=s.X.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var u,c,l=a[o],h=l.inSize,f=l.windowSize,d=l.outSize;u="mean"===n?0===o?new Ar({windowSize:f,inSize:h,batchSize:e.shape[0],outSize:d},h):new Ar({windowSize:f,inSize:h,batchSize:e.shape[0],outSize:d}):new Wt({windowSize:f,inSize:h,batchSize:e.shape[0],outSize:d},n),c=i,i=r.runWebGLProgram(u,[i],t),c.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(c)}return i}var Ir=function e(t,n){_classCallCheck2(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=ze(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")},Rr=function e(t,n){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=ze(this.rank),o=Ie("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),h="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(h,";\n      if(").concat(l,") {\n        result[1] = ").concat(h,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(h,";\n        if(").concat(l,") {\n          result[3] = ").concat(h,";\n        }\n      }\n      setOutput(result);\n    }\n    ")};function Or(e,t,n){var r=Object(s.jb)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Rr(e.shape,t):new Ir(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}for(var Nr={kernelName:s.y,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.reductionIndices,o=n.keepDims,u=r,c=a.shape.length,l=s.Lb.parseAxisParam(i,a.shape),h=l,f=s.X.getAxesPermutation(h,c),d=null!=f,p=u.shouldExecuteOnCPU([a]),m=a;if(d){if(p){for(var v=u.texData.get(m.dataId).values,g=new Array(c),y=0;y<g.length;y++)g[y]=a.shape[f[y]];var _=Ce(v,a.shape,a.dtype,f,g);m=u.makeTensorInfo(g,a.dtype),u.texData.get(m.dataId).values=_}else m=Or(a,f,u);h=s.X.getInnerMostAxes(h.length,c)}s.X.assertAxesAreInnerMostDims("max",h,c);var b,k=_slicedToArray2(s.X.computeOutAndReduceShapes(m.shape,h),2),w=k[0],x=k[1],C=w;if(o&&(C=s.X.expandShapeToKeepDim(w,l)),p){var S=u.texData.get(m.dataId).values,T=_e(S,s.Lb.sizeFromShape(x),C,a.dtype);b=u.makeTensorInfo(C,a.dtype),u.texData.get(b.dataId).values=T}else b=function(e,t,n,r){var a=s.Lb.sizeFromShape(t),i=lr({inputs:{x:e},attrs:{shape:[s.Lb.sizeFromShape(e.shape)/a,a]},backend:r}),o=Er(i,e.dtype,"max",r),u=lr({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),u}(m,x,C,u);return d&&u.disposeIntermediateTensorInfo(m),b}},Dr={kernelName:s.z,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;M(a,"maxPool");var i=r.filterSize,o=r.strides,u=r.pad,c=r.dimRoundingMode;s.Lb.assert(s.X.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '1'")}));var l=s.X.computePool2DInfo(a.shape,i,o,1,u,c);if(1===l.filterWidth&&1===l.filterHeight&&s.Lb.arraysEqual(l.inShape,l.outShape))return zn({inputs:{x:a},backend:n});var h=new qt(l,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}},Pr={kernelName:s.A,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;M([i,t.output],"maxPoolBackprop");var u=r.filterSize,c=r.strides,l=r.pad,h=r.dimRoundingMode,f=s.X.computePool2DInfo(o.shape,u,c,1,l,h),d=new qt(f,"max",!0),p=n.runWebGLProgram(d,[o],o.dtype),m=new Pt(f),v=n.runWebGLProgram(m,[a,p],o.dtype);return n.disposeIntermediateTensorInfo(p),v}},Fr={kernelName:s.B,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,u=n.pad,c=n.includeBatchInIndex,l=r;s.Lb.assert(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var h=[1,1];s.Lb.assert(s.X.eitherStridesOrDilationsAreOne(o,h),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(h,"'")}));var f=s.X.computePool2DInfo(a.shape,i,o,h,u),d=_slicedToArray2(function(e,t,n,r){var a=new qt(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new qt(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,c,f,l),2);return[d[0],d[1]]}},Mr={kernelName:s.C,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,u=r,c=a.shape.length,l=s.Lb.parseAxisParam(o,a.shape),h=l,f=s.X.getAxesPermutation(h,c),d=null!=f,p=u.shouldExecuteOnCPU([a]),m=[],v=a;if(d){if(p){for(var g=u.texData.get(v.dataId).values,y=new Array(c),_=0;_<y.length;_++)y[_]=a.shape[f[_]];var b=Ce(g,a.shape,a.dtype,f,y);v=u.makeTensorInfo(y,a.dtype),u.texData.get(v.dataId).values=b}else v=Or(a,f,u);m.push(v),h=s.X.getInnerMostAxes(h.length,c)}s.X.assertAxesAreInnerMostDims("sum",h,c);var k=_slicedToArray2(s.X.computeOutAndReduceShapes(v.shape,h),2),w=k[0],x=k[1],C=w;i&&(C=s.X.expandShapeToKeepDim(w,l));for(var S=function(e,t,n,r){var a=s.Lb.sizeFromShape(t),i=lr({inputs:{x:e},attrs:{shape:[s.Lb.sizeFromShape(e.shape)/a,a]},backend:r}),o=Er(i,"float32","mean",r),u=lr({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),u}(v,x,C,u),T=0,A=m;T<A.length;T++){var E=A[T];u.disposeIntermediateTensorInfo(E)}return S}},Lr=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=ze(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")},zr=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=ze(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=Re("rc",a),c=Re("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),f="reflect"===r?0:1,d="";if(1===a){var p="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(f,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(f,";\n        }\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(p,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(p,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(f,") +\n                gte * ((end - 1) * 2 - source + ").concat(f,");\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")},Br={kernelName:s.D,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,u=Object(s.jb)().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zr(a.shape,i,o):new Lr(a.shape,i,o);return n.runWebGLProgram(u,[a],a.dtype)}},jr=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=s.X.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")},Vr="return a * b;",qr={kernelName:s.E,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=s.X.upcastType(a.dtype,i.dtype);if("complex64"===a.dtype){var u=r.texData.get(a.dataId),c=r.texData.get(i.dataId),l=new jr("return areal * breal - aimag * bimag;",a.shape,i.shape),h=new jr("return areal * bimag + aimag * breal;",a.shape,i.shape),f=[{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:a.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:i.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:i.shape}],d=r.runWebGLProgram(l,f,"float32"),p=r.runWebGLProgram(h,f,"float32"),m=jn({inputs:{real:d,imag:p},backend:r});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(p),m}if(r.shouldExecuteOnCPU([a,i])){var v=r.texData.get(a.dataId),g=r.texData.get(i.dataId),y=_slicedToArray2(be(a.shape,i.shape,v.values,g.values,o),2),_=y[0],b=y[1],k=r.makeTensorInfo(b,o);return r.texData.get(k.dataId).values=_,k}return t=Object(s.jb)().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ke(Vr,a.shape,i.shape):new Ge(Vr,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}},Ur={kernelName:s.F,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;s.X.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t.boxes,i=t.scores,o=r.maxOutputSize,u=r.iouThreshold,c=r.scoreThreshold,l=n,h=l.readSync(a.dataId),f=l.readSync(i.dataId);return s.lb.nonMaxSuppressionV3Impl(h,f,o,u,c)}},Wr=s.lb.nonMaxSuppressionV4Impl,Gr={kernelName:s.G,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;s.X.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t.boxes,i=t.scores,o=r.maxOutputSize,u=r.iouThreshold,c=r.scoreThreshold,l=r.padToMaxOutputSize,h=n,f=h.readSync(a.dataId),d=h.readSync(i.dataId),p=Wr(f,d,o,u,c,l);return[p.selectedIndices,p.validOutputs]}},Hr=s.lb.nonMaxSuppressionV5Impl,Kr={kernelName:s.H,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;s.X.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t.boxes,i=t.scores,o=r.maxOutputSize,u=r.iouThreshold,c=r.scoreThreshold,l=r.softNmsSigma,h=n,f=h.readSync(a.dataId),d=h.readSync(i.dataId),p=Hr(f,d,o,u,c,l);return[p.selectedIndices,p.selectedScores]}},Xr=function e(t,n,r,a){_classCallCheck2(this,e),this.variableNames=["Image"],this.outputShape=[];var i=t[1],o=t[2],u=Math.sin(n).toFixed(3),c=Math.cos(n).toFixed(3);this.outputShape=t;var l,h=_slicedToArray2(s.X.getImageCenter(a,i,o),2),f=h[0],d=h[1],p=f.toFixed(3),m=d.toFixed(3);l="number"==typeof r?"float outputValue = ".concat(r.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(r.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - ".concat(p,") * ").concat(c," - (float(y) - ").concat(m,") * ").concat(u,";\n          float coordYFloat = (float(x) - ").concat(p,") * ").concat(u," + (float(y) - ").concat(m,") * ").concat(c,";\n          int coordX = int(round(coordXFloat + ").concat(p,"));\n          int coordY = int(round(coordYFloat + ").concat(m,"));\n          ").concat(l,"\n          if(coordX >= 0 && coordX < ").concat(o," && coordY >= 0 && coordY < ").concat(i,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},Qr={kernelName:s.L,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new Xr(a.shape,i,o,s);return u.runWebGLProgram(c,[a],a.dtype)}},Yr=qn("if (isnan(x)) return x;\n  return sin(x);\n"),Zr={kernelName:s.N,backendName:"webgl",kernelFunc:Yr},Jr=qn("return x * x;"),$r={kernelName:s.P,backendName:"webgl",kernelFunc:Jr},ea=Un({opSnippet:"return (a - b) * (a - b);",packedOpSnippet:"return (a - b) * (a - b);"}),ta={kernelName:s.Q,backendName:"webgl",kernelFunc:ea},na="return a - b;",ra=Un({opSnippet:na,packedOpSnippet:na,supportsComplex:!0,cpuKernelImpl:xe}),aa={kernelName:s.R,backendName:"webgl",kernelFunc:ra},ia=qn("return tan(x);"),oa=0,sa=[Hn,Xn,Qn,Yn,$n,ar,Vn,fr,pr,vr,br,wr,Sr,Bn,Tr,cr,Nr,Dr,Pr,Fr,Mr,Br,qr,Ur,Gr,Kr,tr,rr,hr,Qr,Zr,$r,aa,ta,{kernelName:s.S,backendName:"webgl",kernelFunc:ia},{kernelName:s.U,backendName:"webgl",kernelFunc:function(e){for(var t,n=e.inputs,r=e.attrs,a=e.backend,i=n.x,o=r.perm,s=a,u=new Array(i.shape.length),c=0;c<u.length;c++)u[c]=i.shape[o[c]];if(s.shouldExecuteOnCPU([i])){var l=s.texData.get(i.dataId).values,h=Ce(l,i.shape,i.dtype,o,u);t=s.makeTensorInfo(u,i.dtype),s.texData.get(t.dataId).values=h}else t=Or(i,o,s);return t}},{kernelName:s.V,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;M(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=Se(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}}];oa<sa.length;oa++){var ua=sa[oa];Object(s.wb)(ua)}var ca=n(2),la=n(10),ha=n(20),fa=n(41),da=n(24),pa=function(e,t,n){var r=e.createBuffer(1,t.length,n);return r.copyToChannel(t,0),r};function ma(e,t,n,r,a){return new Promise((function(i){for(var o={loudness_db:[0],f0_hz:[0]},s=0,u=t;u<n;u++)r&&u>=a?(o.loudness_db[s]=-120,o.f0_hz[s]=-1):(o.loudness_db[s]=e.loudness_db[u],o.f0_hz[s]=e.f0_hz[u]),s+=1;i(o)}))}function va(e){return e*da.b}function ga(e){return e/da.b}var ya=function(){function e(t,n){_classCallCheck2(this,e),this.checkpointUrl=t,n&&(this.settings=n)}var t,n,r;return _createClass2(e,[{key:"initialize",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ca.registerOp("Roll",(function(e){var t=ca.split(e.inputs[0],2,2),n=ca.concat([t[1],t[0]],2);return t.forEach((function(e){return e.dispose()})),n})),ca.env().set("WEBGL_PACK",!1),ca.env().set("WEBGL_CONV_IM2COL",!1),ca.env().set("WEBGL_DELETE_TEXTURE_THRESHOLD",104857600),e.next=6,function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ca.loadGraphModel(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(this.checkpointUrl+"/model.json");case 6:return this.model=e.sent,e.prev=7,e.next=10,fetch(this.checkpointUrl+"/settings.json").then((function(e){return e.json()}));case 10:t=e.sent;case 11:if(e.prev=11,null!==this.settings){e.next=14;break}throw new Error("Passing settings is required if you do not have a settings.json file.");case 14:return e.finish(11);case 15:this.settings=_objectSpread(_objectSpread({},t),this.settings),this.initialized=!0;case 16:case"end":return e.stop()}}),e,this,[[7,,11,15]])}))),function(){return r.apply(this,arguments)})},{key:"dispose",value:function(){this.initialized&&(this.model.dispose(),this.checkpointUrl=null,this.initialized=!1)}},{key:"isInitialized",value:function(){return this.initialized}},{key:"memCheck",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.screen.availWidth*window.screen.availHeight,n=window.devicePixelRatio,r=Math.round(t*n*600/1048576),isNaN(r)||!(r<50)){e.next=3;break}throw new Error("Insufficient memory! Your device has ".concat(r," and recommended memory is 50"));case 3:return e.prev=3,e.next=6,ca.ready();case 6:if("webgl"===ca.getBackend()){e.next=8;break}throw new Error("It looks like your browser does not support webgl.");case 8:e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(3),new Error("insufficient memory - "+e.t0);case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e,null,[[3,10]])})))();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"synthesize",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f,d,p,m,v,g,y,_,b,k,w,x,C,S,T,A,E,I,R,O,N=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!==n&&(this.settings=_objectSpread(_objectSpread({},this.settings),n)),r=t.f0_hz,a=t.loudness_db,i=t.confidences,o=Object(fa.c)(r,a.length,this.settings.modelMaxFrameLength),s=Object(fa.c)(i,a.length,this.settings.modelMaxFrameLength),e.next=8,function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f,d,p,m,v,g,y,_,b,k,w,x,C,S,T,A,E;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.averageMaxLoudness,a=n.meanLoudness,i=n.loudnessThreshold,o=n.meanPitch,u=[],!(t.loudness_db.length>0)){e.next=28;break}return c=ca.tidy((function(){var e=ca.tensor1d(t.loudness_db,"float32"),n=e.max(),a=ca.sub(r,n),i=ca.add(e,a);return e.dispose(),n.dispose(),a.dispose(),i})),l=c.greater(i),e.next=7,ca.booleanMaskAsync(c,l);case 7:return h=e.sent,e.next=10,h.array();case 10:return f=e.sent,d=ca.tidy((function(){var e=f>0?h.mean():c.mean(),t=ca.sub(a,e),n=c.add(t).add(0).clipByValue(-120,r),i=n.min(),o=e.sub(i);return n.sub(i).div(o).mul(a- -120).add(-120)})),p=ca.reshape(t.confidences,[-1,1,1]),m=ca.pool(p,[100,1],"avg","same"),v=m.reshape([-1]),g=ca.lessEqual(v,.7),s=ca.tidy((function(){var e=g.mul(-25),t=d.add(e),n=ca.maximum(t,-120);return e.dispose(),t.dispose(),n})),e.next=19,s.array();case 19:u=e.sent,l.dispose(),c.dispose(),d.dispose(),h.dispose(),m.dispose(),v.dispose(),p.dispose(),g.dispose();case 28:if(y=[],!(t.f0_hz.length>0)){e.next=59;break}return e.next=32,Object(ha.c)(t.f0_hz);case 32:return _=e.sent,b=ca.tidy((function(){for(var e=0,t=_.length;e<t;++e)_[e]===-1/0&&(_[e]=0);return _})),k=ca.lessEqual(t.confidences,.7),w=s.greater(i),x=ca.logicalOr(k,w),e.next=39,ca.booleanMaskAsync(b,x);case 39:return C=e.sent,S=C.mean(),e.next=43,ca.sub(o,S);case 43:return T=e.sent,e.next=46,T.array();case 46:return A=e.sent,E=ca.tidy((function(){var e=A/12;return e=Math.round(e),Object(fa.b)(t.f0_hz,e)})),e.next=50,E.array();case 50:y=e.sent,s.dispose(),S.dispose(),C.dispose(),T.dispose(),E.dispose(),w.dispose(),x.dispose(),k.dispose();case 59:return e.abrupt("return",{f0_hz:y,loudness_db:u});case 60:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()({f0_hz:o,loudness_db:a,confidences:s},this.settings);case 8:u=e.sent,c=[],l=u.loudness_db.length,h=ga(l),f=!1,d=ga(this.settings.modelMaxFrameLength),m=1*da.c,v=0;case 16:if(!(v<h)){e.next=36;break}return g=Math.floor(va(v)),(y=va(v+d))>l&&(f=!0),e.next=21,ma(u,g,y,f,l);case 21:return _=e.sent,b=_.f0_hz,k=_.loudness_db,w=ca.tensor1d(b,"float32"),x=ca.tensor1d(k,"float32"),e.next=28,this.model.predict({f0_hz:w,loudness_db:x});case 28:return C=e.sent,e.next=31,C.data();case 31:S=e.sent,c.push(S),C.dispose(),w.dispose(),x.dispose();case 33:v+=d-1,e.next=16;break;case 36:if(h<=d)p=c[0];else{for(T=[],A=0;A<c.length;A++)T.push(c[A]);p=function(e,t){for(var n,r=e.reduce((function(e,t){return e+t.length}),0),a=new Float32Array(r),i=0,o=0;o<e.length;o++){var s=e[o],u=o<e.length-1;if(0===o&&(a.set(s,i),i+=s.length),u){for(var c=e[o+1],l=i-t,h=l,f=0,d=s.length-t;h<i&&f<c.length;h++,f++,d++)a[h]=s[d]*(1-(n=(h-l)/(i-l)))+c[f]*n;a.set(c.slice(t),i),i+=c.slice(t).length}}return a}(T,m)}return E=p.slice(0,t.originalRecordedBufferLength).map((function(e){return e*(N.settings.postGain||1)})),I=new la.Context,R=pa(I,E,da.c),e.next=42,Object(ha.j)(R,48e3);case 42:return O=e.sent,e.next=45,function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.audioCtx,r=t.arrayBuffer,a=t.sampleRate,la.setContext(n),o=pa(n,r,a),s=la.Offline((function(){var e=new la.Compressor({attack:.001,release:.001,threshold:-6}).toDestination(),t=new la.Reverb({wet:.3,decay:3}).connect(e),n=new la.Filter(8e3,"lowpass",-24).connect(t);return new la.Player({url:o}).connect(n).start(),t.ready}),r.length/a),e.next=6,s;case 6:return i=e.sent,u=i.getChannelData(0),e.abrupt("return",(o=null,i.dispose(),i=null,u));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()({audioCtx:I,arrayBuffer:O,sampleRate:48e3});case 45:return e.abrupt("return",e.sent);case 46:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"aux_inputs",(function(){return r})),n.d(t,"chords",(function(){return a})),n.d(t,"constants",(function(){return i})),n.d(t,"data",(function(){return o})),n.d(t,"logging",(function(){return s})),n.d(t,"melodies",(function(){return u})),n.d(t,"performance",(function(){return c})),n.d(t,"sequences",(function(){return l})),n.d(t,"MetronomeCallbackObject",(function(){return f})),n.d(t,"Metronome",(function(){return d})),n.d(t,"MidiConversionError",(function(){return g})),n.d(t,"midiToSequenceProto",(function(){return y})),n.d(t,"sequenceProtoToMidi",(function(){return _})),n.d(t,"urlToBlob",(function(){return b})),n.d(t,"blobToNoteSequence",(function(){return k})),n.d(t,"urlToNoteSequence",(function(){return w})),n.d(t,"BasePlayerCallback",(function(){return T})),n.d(t,"BasePlayer",(function(){return A})),n.d(t,"Player",(function(){return I})),n.d(t,"SoundFontPlayer",(function(){return O})),n.d(t,"PlayerWithClick",(function(){return N})),n.d(t,"MIDIPlayer",(function(){return D})),n.d(t,"BaseRecorderCallback",(function(){return P})),n.d(t,"Recorder",(function(){return F})),n.d(t,"BaseVisualizer",(function(){return L})),n.d(t,"PianoRollCanvasVisualizer",(function(){return z})),n.d(t,"Visualizer",(function(){return B})),n.d(t,"BaseSVGVisualizer",(function(){return j})),n.d(t,"PianoRollSVGVisualizer",(function(){return V})),n.d(t,"WaterfallSVGVisualizer",(function(){return q})),n.d(t,"ScrollType",(function(){return R})),n.d(t,"StaffSVGVisualizer",(function(){return U}));var r=n(63),a=n(42),i=n(8),o=n(29),s=n(13),u=n(26),c=n(33),l=n(15),h=n(10),f=function e(){_classCallCheck2(this,e)},d=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;_classCallCheck2(this,e),this.clicksPerQuarter=1,this.muted=!1,this.loClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.loClickNote="c5",this.hiClickNote="g5",this.ticking=!1,this.startedAt=null,this.step=-1,this.reset(),this.callbackObject=t,this.clicksPerQuarter=n}return _createClass2(e,[{key:"isTicking",value:function(){return this.ticking}},{key:"getStartedAt",value:function(){return this.startedAt}},{key:"getOffsetTime",value:function(){return h.immediate()-this.startedAt}},{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:120;this.reset(),this.ticking=!0,this.callbackObject.click||(this.callbackObject.click=function(){}),this.callbackObject.quarter||(this.callbackObject.quarter=function(){}),this.callbackObject.bar||(this.callbackObject.bar=function(){});var n=0,r=4*this.clicksPerQuarter;h.Transport.scheduleRepeat((function(t){e.startedAt||(e.startedAt=t);var a=t-e.startedAt;e.step++;var i=e.step%r,o=Math.floor(i/e.clicksPerQuarter),s=i%e.clicksPerQuarter;e.callbackObject.click(a,i),0===s&&e.callbackObject.quarter(a,o),e.muted||(0===i?e.hiClick.triggerAttack(e.hiClickNote,t,.1):e.loClick.triggerAttack(e.loClickNote,t,.1)),0===i&&(e.callbackObject.bar(a,n),n++)}),r+"n"),h.Transport.bpm.value=t,h.Transport.start()}},{key:"stop",value:function(){this.ticking=!1,h.Transport.cancel(),h.Transport.stop()}},{key:"reset",value:function(){this.muted=!1,this.ticking=!1,this.step=-1,this.startedAt=null}}]),e}(),p=n(77),m=n(14),v=n(9),g=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),(this instanceof n?this.constructor:void 0).prototype),r}return n}();function y(e){var t=new p.Midi(e),n=v.a.create();n.ticksPerQuarter=t.header.ppq,n.sourceInfo=v.a.SourceInfo.create({parser:v.a.SourceInfo.Parser.TONEJS_MIDI_CONVERT,encodingType:v.a.SourceInfo.EncodingType.MIDI});var r,a=_createForOfIteratorHelper(t.header.timeSignatures);try{for(a.s();!(r=a.n()).done;){var o=r.value;n.timeSignatures.push(v.a.TimeSignature.create({time:t.header.ticksToSeconds(o.ticks),numerator:o.timeSignature[0],denominator:o.timeSignature[1]}))}}catch(k){a.e(k)}finally{a.f()}n.timeSignatures.length||n.timeSignatures.push(v.a.TimeSignature.create({time:0,numerator:4,denominator:4}));var s,u=_createForOfIteratorHelper(t.header.tempos);try{for(u.s();!(s=u.n()).done;){var c=s.value;n.tempos.push(v.a.Tempo.create({time:c.time,qpm:c.bpm}))}}catch(k){u.e(k)}finally{u.f()}var l,h=-1,f=_createForOfIteratorHelper(t.tracks);try{for(f.s();!(l=f.n()).done;){var d=l.value;d.notes.length>0&&(h+=1);var m,g=_createForOfIteratorHelper(d.notes);try{for(g.s();!(m=g.n()).done;){var y=m.value,_=y.time,b=_+y.duration;n.notes.push(v.a.Note.create({instrument:h,program:d.instrument.number,startTime:_,endTime:b,pitch:y.midi,velocity:Math.floor(y.velocity*i.MIDI_VELOCITIES),isDrum:d.instrument.percussion})),b>n.totalTime&&(n.totalTime=b)}}catch(k){g.e(k)}finally{g.f()}}}catch(k){f.e(k)}finally{f.f()}return n}function _(e){l.isQuantizedSequence(e)&&(e=l.unquantizeSequence(e));var t=new p.Midi;t.fromJSON({header:{name:"",ppq:e.ticksPerQuarter||i.DEFAULT_TICKS_PER_QUARTER,tempos:[],timeSignatures:[],keySignatures:[],meta:[]},tracks:[]});var n=Array.from(e.tempos||[]);0===n.length&&n.push({time:0,qpm:i.DEFAULT_QUARTERS_PER_MINUTE}),n.sort((function(e,t){return e.time-t.time}));for(var r=0,a=n;r<a.length;r++){var o=a[r];t.header.tempos.push({ticks:t.header.secondsToTicks(o.time),bpm:o.qpm}),t.header.update()}if(e.timeSignatures&&0!==e.timeSignatures.length){var s,u=_createForOfIteratorHelper(e.timeSignatures);try{for(u.s();!(s=u.n()).done;){var c=s.value;t.header.timeSignatures.push({ticks:t.header.secondsToTicks(c.time),timeSignature:[c.numerator,c.denominator]})}}catch(g){u.e(g)}finally{u.f()}}else t.header.timeSignatures.push({ticks:0,timeSignature:[4,4]});t.header.update();var h,f=new Map,d=_createForOfIteratorHelper(e.notes);try{for(d.s();!(h=d.n()).done;){var m=h.value,v=JSON.stringify([m.instrument?m.instrument:0,void 0===m.program?i.DEFAULT_PROGRAM:m.program,!!m.isDrum]);f.has(v)||f.set(v,[]),f.get(v).push(m)}}catch(g){d.e(g)}finally{d.f()}return f.forEach((function(e,n){var r=_slicedToArray2(JSON.parse(n).slice(1),2),a=r[0],o=r[1],s=t.addTrack();s.channel=o?i.DRUM_CHANNEL:i.NON_DRUM_CHANNELS[(t.tracks.length-1)%i.NON_DRUM_CHANNELS.length],s.instrument.number=a;var u,c=_createForOfIteratorHelper(e);try{for(c.s();!(u=c.n()).done;){var l=u.value;s.addNote({midi:l.pitch,time:l.startTime,duration:l.endTime-l.startTime,velocity:((void 0===l.velocity?i.DEFAULT_VELOCITY:l.velocity)+1)/i.MIDI_VELOCITIES})}}catch(g){c.e(g)}finally{c.f()}})),t.toArray()}function b(e){return new Promise((function(t,n){Object(m.a)(e).then((function(e){return e.blob()})).then((function(e){t(e)})).catch((function(e){return n(e)}))}))}function k(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(e){try{var a=y(r.result);t(a)}catch(e){n(e)}},r.onerror=function(e){return n(e)},r.readAsArrayBuffer(e)}))}function w(e){return b(e).then(k)}var x=function(){function e(t){_classCallCheck2(this,e),this.FADE_SECONDS=.1,this.baseURL=t,this.buffers=new h.ToneAudioBuffers,this.sourceMap=new Map,this.initialized=!1}var t,n;return _createClass2(e,[{key:"initialize",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.a)(this.baseURL+"/instrument.json").then((function(e){return e.json()})).then((function(e){t.name=e.name,t.minPitch=e.minPitch,t.maxPitch=e.maxPitch,t.durationSeconds=e.durationSeconds,t.releaseSeconds=e.releaseSeconds,t.percussive=e.percussive,t.velocities=e.velocities,t.initialized=!0}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"sampleInfoToName",value:function(e){return this.velocities?"p".concat(e.pitch,"_v").concat(e.velocity):"p"+e.pitch}},{key:"sampleNameToURL",value:function(e){return"".concat(this.baseURL,"/").concat(e,".mp3")}},{key:"nearestVelocity",value:function(e){if(!this.velocities)return e;e||(e=i.DEFAULT_VELOCITY);var t=void 0,n=i.MIDI_VELOCITIES;return this.velocities.forEach((function(r){var a=Math.abs(r-e);a<n&&(t=r,n=a)})),t}},{key:"loadSamples",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.initialized,e.t0){e.next=4;break}return e.next=4,this.initialize();case 4:if(n=t.filter((function(e){return!(e.pitch<a.minPitch||e.pitch>a.maxPitch)||(s.log("Pitch ".concat(e.pitch," is outside the valid range for ").concat(a.name,", ignoring."),"SoundFont"),!1)})).map((function(e){return a.sampleInfoToName({pitch:e.pitch,velocity:a.nearestVelocity(e.velocity)})})),r=Array.from(new Set(n)).filter((function(e){return!a.buffers.has(e)})).map((function(e){return{name:e,url:a.sampleNameToURL(e)}})),e.t1=r.length>0,!e.t1){e.next=11;break}return r.forEach((function(e){return a.buffers.add(e.name,e.url)})),e.next=10,h.loaded();case 10:s.log("Loaded samples for ".concat(this.name,"."),"SoundFont");case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"playNote",value:function(e,t,n,r,a){var i=this.getBuffer(e,t);r>this.durationSeconds&&s.log("Requested note duration longer than sample duration: ".concat(r," > ").concat(this.durationSeconds),"SoundFont");var o=new h.ToneBufferSource({url:i,fadeOut:this.FADE_SECONDS}).connect(a);if(o.start(n,0,void 0,1),!this.percussive&&r<this.durationSeconds){var u=new h.ToneBufferSource({url:i,fadeOut:this.FADE_SECONDS}).connect(a);o.stop(n+r+this.FADE_SECONDS),u.start(n+r,this.durationSeconds,void 0,1)}}},{key:"playNoteDown",value:function(e,t,n){var r=this.getBuffer(e,t),a=new h.ToneBufferSource(r).connect(n);a.start(0,0,void 0,1),this.sourceMap.has(e)&&this.sourceMap.get(e).stop(h.now()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.set(e,a)}},{key:"playNoteUp",value:function(e,t,n){if(this.sourceMap.has(e)){var r=this.getBuffer(e,t);new h.ToneBufferSource({url:r,fadeOut:this.FADE_SECONDS}).connect(n).start(0,this.durationSeconds,void 0,1),this.sourceMap.get(e).stop(h.now()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.delete(e)}}},{key:"getBuffer",value:function(e,t){if(!this.initialized)throw new Error("Instrument is not initialized.");if(!(e<this.minPitch||e>this.maxPitch)){var n=this.sampleInfoToName({pitch:e,velocity:this.nearestVelocity(t)});if(!this.buffers.has(n))throw new Error("Buffer not found for ".concat(this.name,": ").concat(n));var r=this.buffers.get(n);if(!r.loaded)throw new Error("Buffer not loaded for ".concat(this.name,": ").concat(n));return r}s.log("Pitch ".concat(e," is outside the valid range for ").concat(this.name," (").concat(this.minPitch,"-").concat(this.maxPitch,")"),"SoundFont")}}]),e}(),C=function(){function e(t){_classCallCheck2(this,e),this.baseURL=t,this.instruments=new Map,this.initialized=!1}var t,n;return _createClass2(e,[{key:"initialize",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.a)(this.baseURL+"/soundfont.json").then((function(e){return e.json()})).then((function(e){for(var n in t.name=e.name,e.instruments){var r="".concat(t.baseURL,"/").concat(e.instruments[n]);t.instruments.set("drums"===n?"drums":+n,new x(r))}t.initialized=!0}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadSamples",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.initialized,e.t0){e.next=4;break}return e.next=4,this.initialize();case 4:return n=new Map,t.forEach((function(e){e.isDrum=e.isDrum||!1,e.program=e.program||0;var t=e.isDrum?"drums":e.program,a={pitch:e.pitch,velocity:e.velocity};n.has(t)?n.get(t).push(a):r.instruments.has(t)?n.set(t,[a]):s.log("No instrument in ".concat(r.name," for: program=").concat(e.program,", isDrum=").concat(e.isDrum),"SoundFont")})),e.next=8,Promise.all(Array.from(n.keys()).map((function(e){return r.instruments.get(e).loadSamples(n.get(e))})));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"playNote",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6?arguments[6]:void 0,u=i?"drums":a;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(u)?this.instruments.get(u).playNote(e,t,n,r,o):s.log("No instrument in ".concat(this.name," for: program=").concat(a,", isDrum=").concat(i),"SoundFont")}},{key:"playNoteDown",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=r?"drums":n;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(i)?this.instruments.get(i).playNoteDown(e,t,a):s.log("No instrument in ".concat(this.name," for: program=").concat(n,", isDrum=").concat(r),"SoundFont")}},{key:"playNoteUp",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=r?"drums":n;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(i)?this.instruments.get(i).playNoteUp(e,t,a):s.log("No instrument in ".concat(this.name," for: program=").concat(n,", isDrum=").concat(r),"SoundFont")}}]),e}();function S(e,t){return e.quantizedStartStep<t.quantizedStartStep?-1:e.quantizedStartStep>t.quantizedStartStep?1:e.pitch<t.pitch?-1:1}var T=function e(){_classCallCheck2(this,e)},A=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;_classCallCheck2(this,e),this.playClick=t,this.callbackObject=n,this.desiredQPM=void 0}return _createClass2(e,[{key:"setTempo",value:function(e){this.desiredQPM=e,"started"===h.Transport.state&&(h.Transport.bpm.value=e)}},{key:"makeClickSequence",value:function(e){for(var t=l.clone(e),n=t.notes.map((function(e){return e.quantizedEndStep})),r=Math.max.apply(Math,_toConsumableArray(n)),a=0;a<r;a+=4)t.notes.push({pitch:a%16==0?i.LO_CLICK_PITCH:i.HI_CLICK_PITCH,quantizedStartStep:a,isDrum:!0,quantizedEndStep:a+1});return t.notes.sort(S),t}},{key:"resumeContext",value:function(){h.context.resume()}},{key:"start",value:function(e,t){var n=this;if("started"===this.getPlayState())throw new Error("Cannot start playback; player is already playing.");if("paused"===this.getPlayState())throw new Error("Cannot `start()` a paused player; use `resume()`.");if("stopped"!==h.Transport.state)throw new Error("Cannot start playback while `Tone.Transport` is in use.");this.resumeContext();var r=l.isQuantizedSequence(e);if(this.playClick&&r&&(e=this.makeClickSequence(e)),h.Transport.bpm.value=t||(e.tempos&&e.tempos.length>0&&e.tempos[0].qpm>0?e.tempos[0].qpm:i.DEFAULT_QUARTERS_PER_MINUTE),r)e=l.unquantizeSequence(e,t);else if(t)throw new Error("Cannot specify a `qpm` for a non-quantized sequence.");var a=new h.Part((function(e,t){n.currentPart===a&&((n.playClick||t.pitch!==i.LO_CLICK_PITCH&&t.pitch!==i.HI_CLICK_PITCH)&&n.playNote(e,t),n.callbackObject&&h.Draw.schedule((function(){n.callbackObject.run(t,e)}),e))}),e.notes.map((function(e){return[e.startTime,e]})));return this.currentPart=a,this.desiredQPM&&(h.Transport.bpm.value=this.desiredQPM),this.currentPart.start(),"started"!==h.Transport.state&&h.Transport.start(),new Promise((function(t){n.scheduledStop=h.Transport.schedule((function(){n.stop(),t(),n.callbackObject&&n.callbackObject.stop()}),"+"+e.totalTime)}))}},{key:"stop",value:function(){this.isPlaying()&&(this.currentPart.stop(),h.Transport.stop(),this.currentPart=null),h.Transport.clear(this.scheduledStop),this.scheduledStop=void 0,this.desiredQPM=void 0}},{key:"pause",value:function(){if(!this.isPlaying())throw new Error("Cannot pause playback while the player is stopped.");h.Transport.pause()}},{key:"resume",value:function(){if("paused"!==this.getPlayState())throw new Error('Cannot resume playback while "'.concat(this.getPlayState(),'".'));h.Transport.start()}},{key:"seekTo",value:function(e){if(!this.isPlaying())throw new Error("Cannot seek while the player is stopped.");h.Transport.seconds=e}},{key:"isPlaying",value:function(){return!!this.currentPart}},{key:"getPlayState",value:function(){return this.isPlaying()?h.Transport.state:"stopped"}}]),e}(),E=function(){function e(){var t=this;_classCallCheck2(this,e),this.DRUM_PITCH_TO_CLASS=new Map,this.kick=(new h.MembraneSynth).toDestination(),this.tomLow=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomMid=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomHigh=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.closedHihat=new h.MetalSynth({frequency:400,envelope:{attack:.001,decay:.1,release:.8},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.openHihat=new h.MetalSynth({frequency:400,envelope:{attack:.001,decay:.5,release:.8,sustain:1},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.ride=(new h.MetalSynth).toDestination(),this.crash=new h.MetalSynth({frequency:300,envelope:{attack:.001,decay:1,release:3},harmonicity:5.1,modulationIndex:64,resonance:4e3,octaves:1.5}).toDestination(),this.snare=new h.NoiseSynth({noise:{type:"white"},envelope:{attack:.005,decay:.05,sustain:.1,release:.4}}).toDestination(),this.loClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.pitchPlayers=[function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.kick.triggerAttackRelease("C2","8n",e,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.snare.triggerAttackRelease("16n",e,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.closedHihat.triggerAttack(e,.3,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.openHihat.triggerAttack(e,.3,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t.tomLow.triggerAttack("G3",e,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t.tomMid.triggerAttack("C4",e,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t.tomHigh.triggerAttack("F4",e,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.crash.triggerAttack(e,1,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.ride.triggerAttack(e,.5,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t.loClick.triggerAttack("G5",e,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t.hiClick.triggerAttack("C6",e,n)}];for(var n=function(e){o.DEFAULT_DRUM_PITCH_CLASSES[e].forEach((function(n){t.DRUM_PITCH_TO_CLASS.set(n,e)}))},r=0;r<o.DEFAULT_DRUM_PITCH_CLASSES.length;++r)n(r);this.DRUM_PITCH_TO_CLASS.set(i.LO_CLICK_PITCH,i.LO_CLICK_CLASS),this.DRUM_PITCH_TO_CLASS.set(i.HI_CLICK_PITCH,i.HI_CLICK_CLASS)}return _createClass2(e,[{key:"playNote",value:function(e,t,n){this.pitchPlayers[this.DRUM_PITCH_TO_CLASS.get(e)](t,n)}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),I=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).drumKit=E.getInstance(),e.bassSynth=new h.Synth({volume:5,oscillator:{type:"triangle"}}).toDestination(),e.polySynth=(new h.PolySynth).toDestination(),e}return _createClass2(n,[{key:"playNote",value:function(e,t){var n=t.hasOwnProperty("velocity")?t.velocity/i.MAX_MIDI_VELOCITY:void 0;if(t.isDrum)this.drumKit.playNote(t.pitch,e,n);else{var r=h.Frequency(t.pitch,"midi").toFrequency(),a=t.endTime-t.startTime;this.getSynth(t.instrument,t.program).triggerAttackRelease(r,a,e,n)}}},{key:"getSynth",value:function(e,t){return void 0!==t&&t>=32&&t<=39?this.bassSynth:this.polySynth}}]),n}(A);I.tone=h;var R,O=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.Master,i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return _classCallCheck2(this,a),(t=r.call(this,!1,s)).soundFont=new C(e),t.output=n,t.programOutputs=i,t.drumOutputs=o,t}return _createClass2(a,[{key:"loadSamples",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.soundFont.loadSamples(t.notes.map((function(e){return{pitch:e.pitch,velocity:e.velocity,program:e.program||0,isDrum:e.isDrum||!1}})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"loadAllSamples",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,o,s,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=u.length>0&&void 0!==u[0]?u[0]:0,n=u.length>1&&void 0!==u[1]&&u[1],r=v.a.create(),a=n?i.MAX_DRUM_PITCH:i.MAX_PIANO_PITCH,o=n?i.MIN_DRUM_PITCH:i.MIN_PIANO_PITCH;o<=a;o++)for(s=i.MIN_MIDI_VELOCITY;s<i.MAX_MIDI_VELOCITY;s++)r.notes.push({pitch:o,velocity:s,program:t,isDrum:n});return e.abrupt("return",this.loadSamples(r));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"resumeContext",value:function(){h.context.resume()}},{key:"start",value:function(e,t){var n=this;return this.resumeContext(),this.loadSamples(e).then((function(){return _get(_getPrototypeOf(a.prototype),"start",n).call(n,e,t)}))}},{key:"playNote",value:function(e,t){this.soundFont.playNote(t.pitch,t.velocity,e,t.endTime-t.startTime,t.program,t.isDrum,this.getAudioNodeOutput(t))}},{key:"playNoteDown",value:function(e){this.soundFont.playNoteDown(e.pitch,e.velocity,e.program,e.isDrum,this.getAudioNodeOutput(e))}},{key:"playNoteUp",value:function(e){this.soundFont.playNoteUp(e.pitch,e.velocity,e.program,e.isDrum,this.getAudioNodeOutput(e))}},{key:"getAudioNodeOutput",value:function(e){var t=this.output;return this.programOutputs&&!e.isDrum?this.programOutputs.has(e.program)&&(t=this.programOutputs.get(e.program)):this.drumOutputs&&e.isDrum&&this.drumOutputs.has(e.pitch)&&(t=this.drumOutputs.get(e.pitch)),t}}]),a}(A),N=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,!0,e)}return n}(I),D=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t;return _classCallCheck2(this,r),(t=n.call(this,!1,e)).outputs=[],t.outputChannel=0,t.availableOutputs=[],t.NOTE_ON=144,t.NOTE_OFF=128,t}return _createClass2(r,[{key:"requestMIDIAccess",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",navigator.requestMIDIAccess?new Promise((function(e,n){navigator.requestMIDIAccess().then((function(n){n.addEventListener("statechange",(function(e){return t.initOutputs(n)})),e(t.initOutputs(n))}),(function(e){return console.log("Something went wrong",n(e))}))})):null);case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"initOutputs",value:function(e){for(var t=e.outputs.values(),n=t.next();n&&!n.done;n=t.next())this.availableOutputs.push(n.value);return this.availableOutputs}},{key:"playNote",value:function(e,t){for(var n=t.velocity||100,r=1e3*(t.endTime-t.startTime),a=[this.NOTE_ON+this.outputChannel,t.pitch,n],i=[this.NOTE_OFF+this.outputChannel,t.pitch,n],o=this.outputs?this.outputs:this.availableOutputs,s=0;s<o.length;s++)this.sendMessageToOutput(o[s],a),this.sendMessageToOutput(o[s],i,m.d.now()+r)}},{key:"sendMessageToOutput",value:function(e,t,n){e&&e.send(t,n)}},{key:"playNoteDown",value:function(e){for(var t=[this.NOTE_ON,e.pitch,e.velocity],n=this.outputs?this.outputs:this.availableOutputs,r=0;r<n.length;r++)this.sendMessageToOutput(n[r],t)}},{key:"playNoteUp",value:function(e){for(var t=[this.NOTE_OFF,e.pitch,e.velocity],n=this.outputs?this.outputs:this.availableOutputs,r=0;r<n.length;r++)this.sendMessageToOutput(n[r],t,e.endTime-e.startTime)}}]),r}(A),P=function e(){_classCallCheck2(this,e)},F=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;_classCallCheck2(this,e),this.notes=[],this.midiInputs=[],this.loClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.config={playClick:t.playClick,qpm:t.qpm||i.DEFAULT_QUARTERS_PER_MINUTE,playCountIn:t.playCountIn,startRecordingAtFirstNote:t.startRecordingAtFirstNote||!1},this.callbackObject=n,this.recording=!1,this.onNotes=new Map}var t;return _createClass2(e,[{key:"initialize",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.requestMIDIAccess().then((function(e){return t.midiReady(e)}),(function(e){return console.log("Something went wrong",e)}));case 2:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"midiReady",value:function(e){s.log("Initialized Recorder","Recorder");for(var t=e.inputs.values(),n=t.next();n&&!n.done;n=t.next())this.midiInputs.push(n.value)}},{key:"isRecording",value:function(){return this.recording}},{key:"setTempo",value:function(e){this.config.qpm=e,"started"===h.Transport.state&&(h.Transport.bpm.value=e)}},{key:"enablePlayClick",value:function(e){this.config.playClick=e}},{key:"enablePlayCountIn",value:function(e){this.config.playCountIn=e}},{key:"initClickLoop",value:function(){var e=this,t=0;this.clickLoop=new h.Loop((function(n){t%4==0?e.loClick.triggerAttack("G5",n):e.hiClick.triggerAttack("C6",n),t++,e.config.playCountIn&&4===t&&(h.Transport.stop(),e.clickLoop.stop())}),"4n")}},{key:"getMIDIInputs",value:function(){return this.midiInputs}},{key:"start",value:function(e){var t,n=this,r=_createForOfIteratorHelper(e||this.midiInputs);try{for(r.s();!(t=r.n()).done;){t.value.onmidimessage=function(e){n.midiMessageReceived(e)}}}catch(i){r.e(i)}finally{r.f()}if(this.config.playClick||this.config.playCountIn?(this.initClickLoop(),h.Transport.bpm.value=this.config.qpm,h.Transport.start(),this.clickLoop.start()):this.clickLoop=null,this.recording=!0,this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map,!this.startRecordingAtFirstNote){var a=Date.now();this.firstNoteTimestamp=a}}},{key:"stop",value:function(){var e=this;this.recording=!1;var t=Date.now();this.onNotes.forEach((function(n,r){e.noteOff(r,t)}));var n,r=_createForOfIteratorHelper(this.midiInputs);try{for(r.s();!(n=r.n()).done;){n.value.onmidimessage=null}}catch(a){r.e(a)}finally{r.f()}return this.clickLoop&&(h.Transport.stop(),this.clickLoop.stop()),0===this.notes.length?null:this.getNoteSequence()}},{key:"getNoteSequence",value:function(){return 0===this.notes.length?null:v.a.create({notes:this.notes,totalTime:this.notes[this.notes.length-1].endTime})}},{key:"reset",value:function(){var e=this.stop();return this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map,e}},{key:"midiMessageReceived",value:function(e){if(this.recording){var t=(void 0!==e.timeStamp&&0!==e.timeStamp?e.timeStamp:m.d.now())+m.d.timing.navigationStart;void 0===this.firstNoteTimestamp&&(this.firstNoteTimestamp=t);var n=e.data[0]>>4,r=e.data[1],a=e.data.length>2?e.data[2]:1,i=e.srcElement;8===n||9===n&&0===a?(this.callbackObject&&this.callbackObject.noteOff&&this.callbackObject.noteOff(r,a,i),this.noteOff(r,t),this.callbackObject&&this.callbackObject.run&&this.callbackObject.run(this.getNoteSequence())):9===n&&(this.callbackObject&&this.callbackObject.noteOn&&this.callbackObject.noteOn(r,a,i),this.noteOn(r,a,t))}}},{key:"noteOn",value:function(e,t,n){var r=new v.a.Note;r.pitch=e,r.startTime=(n-this.firstNoteTimestamp)/1e3,r.velocity=t,this.onNotes.set(e,r)}},{key:"noteOff",value:function(e,t){var n=this.onNotes.get(e);n&&(n.endTime=(t-this.firstNoteTimestamp)/1e3,this.notes.push(n)),this.onNotes.delete(e)}}]),e}(),M=n(93),L=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck2(this,e),this.noteSequence=t,this.sequenceIsQuantized=l.isQuantizedSequence(this.noteSequence),this.config={noteHeight:n.noteHeight||6,noteSpacing:n.noteSpacing||1,pixelsPerTimeStep:n.pixelsPerTimeStep||30,noteRGB:n.noteRGB||"8, 41, 64",activeNoteRGB:n.activeNoteRGB||"240, 84, 119",minPitch:n.minPitch,maxPitch:n.maxPitch},this.sequenceIsQuantized){var r=t.quantizationInfo.stepsPerQuarter;this.config.pixelsPerTimeStep=r?this.config.pixelsPerTimeStep/r:7}var a=this.getSize();this.width=a.width,this.height=a.height}return _createClass2(e,[{key:"updateMinMaxPitches",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.config.minPitch||!this.config.maxPitch){void 0===this.config.minPitch&&(this.config.minPitch=i.MAX_MIDI_PITCH),void 0===this.config.maxPitch&&(this.config.maxPitch=i.MIN_MIDI_PITCH);var t,n=_createForOfIteratorHelper(this.noteSequence.notes);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.config.minPitch=Math.min(r.pitch,this.config.minPitch),this.config.maxPitch=Math.max(r.pitch,this.config.maxPitch)}}catch(a){n.e(a)}finally{n.f()}e||(this.config.minPitch-=2,this.config.maxPitch+=2)}}},{key:"getSize",value:function(){this.updateMinMaxPitches();var e=(this.config.maxPitch-this.config.minPitch)*this.config.noteHeight,t=this.sequenceIsQuantized?this.noteSequence.totalQuantizedSteps:this.noteSequence.totalTime;if(!t)throw new Error("The sequence you are using with the visualizer does not have a "+(this.sequenceIsQuantized?"totalQuantizedSteps":"totalTime")+" field set, so the visualizer can't be horizontally sized correctly.");return{width:t*this.config.pixelsPerTimeStep,height:e}}},{key:"getNotePosition",value:function(e,t){var n=this.getNoteEndTime(e)-this.getNoteStartTime(e),r=this.getNoteStartTime(e)*this.config.pixelsPerTimeStep,a=Math.max(this.config.pixelsPerTimeStep*n-this.config.noteSpacing,1);return{x:r,y:this.height-(e.pitch-this.config.minPitch)*this.config.noteHeight,w:a,h:this.config.noteHeight}}},{key:"scrollIntoViewIfNeeded",value:function(e,t){if(e&&this.parentElement){var n=this.parentElement.getBoundingClientRect().width;t>this.parentElement.scrollLeft+n&&(this.parentElement.scrollLeft=t-20)}}},{key:"getNoteStartTime",value:function(e){return this.sequenceIsQuantized?e.quantizedStartStep:Math.round(1e8*e.startTime)/1e8}},{key:"getNoteEndTime",value:function(e){return this.sequenceIsQuantized?e.quantizedEndStep:Math.round(1e8*e.endTime)/1e8}},{key:"isPaintingActiveNote",value:function(e,t){var n=this.getNoteStartTime(e)===this.getNoteStartTime(t),r=this.getNoteStartTime(e)<=this.getNoteStartTime(t)&&this.getNoteEndTime(e)>=this.getNoteEndTime(t);return n||r}}]),e}(),z=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck2(this,n),(a=t.call(this,e,i)).ctx=r.getContext("2d"),a.parentElement=r.parentElement;var o=window.devicePixelRatio||1;return a.ctx&&(a.ctx.canvas.width=o*a.width,a.ctx.canvas.height=o*a.height,r.style.width=a.width+"px",r.style.height=a.height+"px",a.ctx.scale(o,o)),a.redraw(),a}return _createClass2(n,[{key:"redraw",value:function(e,t){var n;this.clear();for(var r=0;r<this.noteSequence.notes.length;r++){var a=this.noteSequence.notes[r],i=this.getNotePosition(a,r),o=a.velocity?a.velocity/100+.2:1,s=e&&this.isPaintingActiveNote(a,e);this.redrawNote(i.x,i.y,i.w,i.h,"rgba(".concat(s?this.config.activeNoteRGB:this.config.noteRGB,",\n  ").concat(o,")")),s&&a===e&&(n=i.x)}return this.scrollIntoViewIfNeeded(t,n),n}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}},{key:"clearActiveNotes",value:function(){this.redraw()}},{key:"redrawNote",value:function(e,t,n,r,a){this.ctx.fillStyle=a,this.ctx.fillRect(Math.round(e),Math.round(t),Math.round(n),Math.round(r))}}]),n}(L),B=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck2(this,n),a=t.call(this,e,r,i),s.log("mm.Visualizer is deprecated, and will be removed in a future          version. Please use mm.PianoRollCanvasVisualizer instead","mm.Visualizer",5),a}return n}(z),j=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck2(this,n),(r=t.call(this,e,a)).drawn=!1,r}return _createClass2(n,[{key:"redraw",value:function(e,t){if(this.drawn||this.draw(),!e)return null;var n;this.unfillActiveRect(this.svg);for(var r=0;r<this.noteSequence.notes.length;r++){var a=this.noteSequence.notes[r];if(e&&this.isPaintingActiveNote(a,e)){var i=this.svg.querySelector('rect[data-index="'.concat(r,'"]'));this.fillActiveRect(i,a),a===e&&(n=parseFloat(i.getAttribute("x")))}}return this.scrollIntoViewIfNeeded(t,n),n}},{key:"fillActiveRect",value:function(e,t){e.setAttribute("fill",this.getNoteFillColor(t,!0)),e.classList.add("active")}},{key:"unfillActiveRect",value:function(e){for(var t=e.querySelectorAll("rect.active"),n=0;n<t.length;++n){var r=t[n],a=this.getNoteFillColor(this.noteSequence.notes[parseInt(r.getAttribute("data-index"),10)],!1);r.setAttribute("fill",a),r.classList.remove("active")}}},{key:"draw",value:function(){for(var e=0;e<this.noteSequence.notes.length;e++){var t=this.noteSequence.notes[e],n=this.getNotePosition(t,e),r=this.getNoteFillColor(t,!1),a=[["index",e],["instrument",t.instrument],["program",t.program],["isDrum",!0===t.isDrum],["pitch",t.pitch]],i=[["--midi-velocity",String(void 0!==t.velocity?t.velocity:127)]];this.drawNote(n.x,n.y,n.w,n.h,r,a,i)}this.drawn=!0}},{key:"getNoteFillColor",value:function(e,t){return"rgba(".concat(t?this.config.activeNoteRGB:this.config.noteRGB,",\n  ").concat(e.velocity?e.velocity/100+.2:1,")")}},{key:"drawNote",value:function(e,t,n,r,a,i,o){if(this.svg){var s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.classList.add("note"),s.setAttribute("fill",a),s.setAttribute("x",""+Math.round(e)),s.setAttribute("y",""+Math.round(t)),s.setAttribute("width",""+Math.round(n)),s.setAttribute("height",""+Math.round(r)),i.forEach((function(e){var t=_slicedToArray2(e,2),n=t[0],r=t[1];void 0!==r&&(s.dataset[n]=""+r)})),o.forEach((function(e){var t=_slicedToArray2(e,2),n=t[0],r=t[1];s.style.setProperty(n,r)})),this.svg.appendChild(s)}}},{key:"clear",value:function(){this.svg.innerHTML="",this.drawn=!1}},{key:"clearActiveNotes",value:function(){this.unfillActiveRect(this.svg)}}]),n}(L),V=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(_classCallCheck2(this,n),a=t.call(this,e,i),!(r instanceof SVGSVGElement))throw new Error("This visualizer requires an <svg> element to display the visualization");a.svg=r,a.parentElement=r.parentElement;var o=a.getSize();return a.width=o.width,a.height=o.height,a.svg.style.width=a.width+"px",a.svg.style.height=a.height+"px",a.clear(),a.draw(),_possibleConstructorReturn(a)}return n}(j),q=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(_classCallCheck2(this,n),(a=t.call(this,e,i)).NOTES_PER_OCTAVE=12,a.WHITE_NOTES_PER_OCTAVE=7,a.LOW_C=24,a.firstDrawnOctave=0,a.lastDrawnOctave=6,!(r instanceof HTMLDivElement))throw new Error("This visualizer requires a <div> element to display the visualization");a.config.whiteNoteWidth=i.whiteNoteWidth||20,a.config.blackNoteWidth=i.blackNoteWidth||2*a.config.whiteNoteWidth/3,a.config.whiteNoteHeight=i.whiteNoteHeight||70,a.config.blackNoteHeight=i.blackNoteHeight||140/3,a.config.showOnlyOctavesUsed=i.showOnlyOctavesUsed,a.setupDOM(r);var o=a.getSize();return a.width=o.width,a.height=o.height,a.svg.style.width=a.width+"px",a.svg.style.height=a.height+"px",a.svgPiano.style.width=a.width+"px",a.svgPiano.style.height=a.config.whiteNoteHeight+"px",a.parentElement.style.width=a.width+a.config.whiteNoteWidth+"px",a.parentElement.scrollTop=a.parentElement.scrollHeight,a.clear(),a.drawPiano(),a.draw(),_possibleConstructorReturn(a)}return _createClass2(n,[{key:"setupDOM",value:function(e){this.parentElement=document.createElement("div"),this.parentElement.classList.add("waterfall-notes-container");var t=Math.max(e.getBoundingClientRect().height,200);this.parentElement.style.paddingTop=t-this.config.whiteNoteHeight+"px",this.parentElement.style.height=t-this.config.whiteNoteHeight+"px",this.parentElement.style.boxSizing="border-box",this.parentElement.style.overflowX="hidden",this.parentElement.style.overflowY="auto",this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgPiano=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.classList.add("waterfall-notes"),this.svgPiano.classList.add("waterfall-piano"),this.parentElement.appendChild(this.svg),e.innerHTML="",e.appendChild(this.parentElement),e.appendChild(this.svgPiano)}},{key:"redraw",value:function(e,t){if(this.drawn||this.draw(),!e)return null;this.clearActiveNotes(),this.parentElement.style.paddingTop=this.parentElement.style.height;for(var n=0;n<this.noteSequence.notes.length;n++){var r=this.noteSequence.notes[n];if(e&&this.isPaintingActiveNote(r,e)){var a=this.svg.querySelector('rect[data-index="'.concat(n,'"]'));this.fillActiveRect(a,r);var i=this.svgPiano.querySelector('rect[data-pitch="'.concat(r.pitch,'"]'));if(this.fillActiveRect(i,r),r===e){var o=parseFloat(a.getAttribute("y")),s=parseFloat(a.getAttribute("height"));return o<this.parentElement.scrollTop-s&&(this.parentElement.scrollTop=o+s),o}}}return null}},{key:"getSize",value:function(){this.updateMinMaxPitches(!0);var e=52;if(this.config.showOnlyOctavesUsed){for(var t=!1,n=!1,r=1;r<7;r++){var a=this.LOW_C+this.NOTES_PER_OCTAVE*r;!t&&a>this.config.minPitch&&(this.firstDrawnOctave=r-1,t=!0),!n&&a>this.config.maxPitch&&(this.lastDrawnOctave=r-1,n=!0)}e=(this.lastDrawnOctave-this.firstDrawnOctave+1)*this.WHITE_NOTES_PER_OCTAVE}var i=e*this.config.whiteNoteWidth,o=this.sequenceIsQuantized?this.noteSequence.totalQuantizedSteps:this.noteSequence.totalTime;if(!o)throw new Error("The sequence you are using with the visualizer does not have a "+(this.sequenceIsQuantized?"totalQuantizedSteps":"totalTime")+" field set, so the visualizer can't be horizontally sized correctly.");return{width:i,height:Math.max(o*this.config.pixelsPerTimeStep,1)}}},{key:"getNotePosition",value:function(e,t){var n=this.svgPiano.querySelector('rect[data-pitch="'.concat(e.pitch,'"]'));if(!n)return null;var r=this.getNoteEndTime(e)-this.getNoteStartTime(e),a=Number(n.getAttribute("x")),i=Number(n.getAttribute("width")),o=Math.max(this.config.pixelsPerTimeStep*r-this.config.noteSpacing,1);return{x:a,y:this.height-this.getNoteStartTime(e)*this.config.pixelsPerTimeStep-o,w:i,h:o}}},{key:"drawPiano",value:function(){this.svgPiano.innerHTML="";var e=this.config.whiteNoteWidth-this.config.blackNoteWidth/2,t=[1,3,6,8,10],n=0,r=0;this.config.showOnlyOctavesUsed?r=this.firstDrawnOctave*this.NOTES_PER_OCTAVE+this.LOW_C:(r=this.LOW_C-3,this.drawWhiteKey(r,n),this.drawWhiteKey(r+2,this.config.whiteNoteWidth),r+=3,n=2*this.config.whiteNoteWidth);for(var a=this.firstDrawnOctave;a<=this.lastDrawnOctave;a++)for(var i=0;i<this.NOTES_PER_OCTAVE;i++)-1===t.indexOf(i)&&(this.drawWhiteKey(r,n),n+=this.config.whiteNoteWidth),r++;this.config.showOnlyOctavesUsed?(r=this.firstDrawnOctave*this.NOTES_PER_OCTAVE+this.LOW_C,n=-this.config.whiteNoteWidth):(this.drawWhiteKey(r,n),r=this.LOW_C-3,this.drawBlackKey(r+1,e),r+=3,n=this.config.whiteNoteWidth);for(var o=this.firstDrawnOctave;o<=this.lastDrawnOctave;o++)for(var s=0;s<this.NOTES_PER_OCTAVE;s++)-1!==t.indexOf(s)?this.drawBlackKey(r,n+e):n+=this.config.whiteNoteWidth,r++}},{key:"drawWhiteKey",value:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","rect");return n.dataset.pitch=String(e),n.setAttribute("x",String(t)),n.setAttribute("y","0"),n.setAttribute("width",String(this.config.whiteNoteWidth)),n.setAttribute("height",String(this.config.whiteNoteHeight)),n.setAttribute("fill","white"),n.setAttribute("original-fill","white"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","3px"),n.classList.add("white"),this.svgPiano.appendChild(n),n}},{key:"drawBlackKey",value:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","rect");return n.dataset.pitch=String(e),n.setAttribute("x",String(t)),n.setAttribute("y","0"),n.setAttribute("width",String(this.config.blackNoteWidth)),n.setAttribute("height",String(this.config.blackNoteHeight)),n.setAttribute("fill","black"),n.setAttribute("original-fill","black"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","3px"),n.classList.add("black"),this.svgPiano.appendChild(n),n}},{key:"clearActiveNotes",value:function(){_get(_getPrototypeOf(n.prototype),"unfillActiveRect",this).call(this,this.svg);for(var e=this.svgPiano.querySelectorAll("rect.active"),t=0;t<e.length;++t){var r=e[t];r.setAttribute("fill",r.getAttribute("original-fill")),r.classList.remove("active")}}}]),n}(j);!function(e){e[e.PAGE=0]="PAGE",e[e.NOTE=1]="NOTE",e[e.BAR=2]="BAR"}(R||(R={}));var U=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck2(this,n),a=t.call(this,e,i),(void 0===i.pixelsPerTimeStep||i.pixelsPerTimeStep<=0)&&(a.config.pixelsPerTimeStep=0),a.instruments=i.instruments||[],a.render=new M.StaffSVGRender(a.getScoreInfo(e),{noteHeight:a.config.noteHeight,noteSpacing:a.config.noteSpacing,pixelsPerTimeStep:a.config.pixelsPerTimeStep,noteRGB:a.config.noteRGB,activeNoteRGB:a.config.activeNoteRGB,defaultKey:i.defaultKey||0,scrollType:i.scrollType||R.PAGE},r),a.drawnNotes=e.notes.length,a.clear(),a.redraw(),a}return _createClass2(n,[{key:"clear",value:function(){this.render.clear()}},{key:"redraw",value:function(e,t){this.drawnNotes!==this.noteSequence.notes.length&&(this.render.scoreInfo=this.getScoreInfo(this.noteSequence));var n=e?this.getNoteInfo(e):void 0;return this.render.redraw(n,t)}},{key:"isNoteInInstruments",value:function(e){return void 0===e.instrument||0===this.instruments.length||this.instruments.indexOf(e.instrument)>=0}},{key:"timeToQuarters",value:function(e){return Math.round(e*this.noteSequence.tempos[0].qpm/60*16)/16}},{key:"quantizedStepsToQuarters",value:function(e){return Math.round(e/this.noteSequence.quantizationInfo.stepsPerQuarter*16)/16}},{key:"getNoteInfo",value:function(e){var t=this.sequenceIsQuantized?this.quantizedStepsToQuarters(e.quantizedStartStep):this.timeToQuarters(e.startTime);return{start:t,length:(this.sequenceIsQuantized?this.quantizedStepsToQuarters(e.quantizedEndStep):this.timeToQuarters(e.endTime))-t,pitch:e.pitch,intensity:e.velocity}}},{key:"getScoreInfo",value:function(e){var t=this,n=[];return e.notes.forEach((function(e){t.isNoteInInstruments(e)&&n.push(t.getNoteInfo(e))})),{notes:n,tempos:e.tempos?e.tempos.map((function(e){return{start:t.timeToQuarters(e.time),qpm:e.qpm}})):[],keySignatures:e.keySignatures?e.keySignatures.map((function(e){return{start:t.timeToQuarters(e.time),key:e.key}})):[],timeSignatures:e.timeSignatures?e.timeSignatures.map((function(e){return{start:t.timeToQuarters(e.time),numerator:e.numerator,denominator:e.denominator}})):[]}}},{key:"clearActiveNotes",value:function(){this.redraw()}}]),n}(L)},function(e,t,n){"use strict";n.r(t),n.d(t,"GANSynth",(function(){return y}));var r=n(2),a=n(13),i=n(14),o=n(43),s=n(20),u=[[1,1,1.0087615084725814],[2,1,.029087889211125567],[2,2,.958243896036208],[3,2,.5326346877272624],[3,3,.45988057223186607],[4,3,1.0072850129664943],[5,4,1.0050894259864507],[6,4,.016233689242197466],[6,5,.9763230964529687],[7,5,.5149287456976357],[7,6,.48299891928441196],[8,6,1.0020339883784544],[9,7,1.0013940582804204],[10,7,.004285414445239434],[10,8,.9936677765505681],[11,8,.4979349533263788],[11,9,.5020647178266697],[12,9,.9896782321684733],[12,10,.006967080931645349],[13,10,1.0022486641537054],[14,11,1.0033233953996759],[15,11,.4782757843614299],[15,12,.5183887055972138],[16,12,.9736767011426267],[16,13,.01804416217807709],[17,13,1.0056329663266226],[18,14,1.00808642668908],[19,14,.4576416347984229],[19,15,.5340800956534676],[20,15,.9582897445862256],[20,16,.028988367857957848],[21,16,1.008754652772106],[22,17,1.0122552436937966],[23,17,.4380796830853842],[23,18,.5491738237632201],[24,18,.9434838949694413],[24,19,.039794474296176746],[25,19,1.0116287566447584],[26,20,1.0158945544322868],[27,20,.41952402212367873],[27,21,.5637020154076856],[28,21,.9292283399303117],[28,22,.05045785324282485],[29,22,1.0142694870195312],[30,23,1.0190617246342517],[31,23,.40191289323704393],[31,24,.5776942788784806],[32,24,.915494649120402],[32,25,.060974426459003916],[33,25,1.016690283888679],[34,26,1.0218076651124588],[35,26,.3851885348435194],[35,27,.5911779611807773],[36,27,.9022565352474414],[36,28,.07134062388959171],[37,28,1.0189038677945517],[38,29,1.0241776077147466],[39,29,.369297000124277],[39,30,.6041783722578726],[40,30,.8894896443111251],[40,31,.08155334505527755],[41,31,1.0209222848386956],[42,32,1.0262117836546005],[43,32,.35418795675261777],[43,33,.6167189821271176],[44,33,.87717137085618],[44,34,.09160992335204851],[45,34,1.0227569476841007],[46,35,1.0279460165329002],[47,35,.3398144781420294],[47,36,.628821594757742],[48,36,.8652806947525041],[48,37,.10150809298528844],[49,37,1.0244186730654867],[50,38,1.029412240942602],[51,38,.32613283297317347],[51,39,.6405065019041107],[52,39,.8537980365619783],[52,40,.11124595830527892],[53,40,1.0259177162406141],[54,41,1.030638956235277],[55,41,.3131022777355948],[55,42,.6517926196031543],[56,42,.8427051290118196],[56,43,.12082196533877268],[57,43,1.0272638027474759],[58,44,1.031651623831845],[59,44,.3006848555240512],[59,45,.6626976096262132],[60,45,.8319849024715039],[60,46,.13023487533380312],[61,46,1.0284661577762764],[62,47,1.0324730153919173],[63,47,.28884520321029805],[63,48,.6732379878311283],[64,48,.821621382643116],[64,49,.1394837401591093],[65,49,1.0295335334192939],[66,50,1.0331235182054521],[67,50,.27755036829985363],[67,51,.68342922107227],[68,51,.8115995989355603],[68,52,.148567879414825],[69,52,1.0304742340231496],[70,53,1.0336214033370148],[71,53,.2667696361817086],[71,54,.6932858140884962],[72,54,.8019055022130549],[72,55,.1574868591255191],[73,55,1.031296139836255],[74,56,1.0339830613212895],[75,56,.2564743680536822],[75,57,.7028213875855097],[76,57,.7925258907912134],[76,58,.16624047189958738],[77,58,1.032006729117501],[78,59,1.0342232095724524],[79,59,.24663784949713183],[79,60,.7120487485622758],[80,60,.7834483437084975],[80,61,.17482871845079165],[81,61,1.032613098850059],[82,62,1.0343550751159198],[83,62,.2372351494674972],[83,63,.7209799537859948],[84,63,.7746611604312031],[84,64,.18325179038711914],[85,64,1.0331219841851924],[86,65,1.0343905557724016],[87,65,.22824298931879333],[87,66,.7296263672031092],[88,66,.7661533062642226],[88,67,.19151005417692718],[89,67,1.0335397767254908],[90,68,1.0343403625078313],[91,68,.21963962139622123],[91,69,.7379987119645334],[92,69,.7579143628308538],[92,70,.19960403621540457],[93,70,1.0338725417430177],[94,71,1.0342141453043734],[95,71,.21140471667072153],[95,72,.746107117663542],[96,72,.7499344830670268],[96,73,.20753440891552338],[97,73,1.0341260344172454],[98,74,1.034020604597683],[99,74,.20351926086574523],[99,75,.7539611633021215],[100,75,.7422043502477234],[100,76,.2153019777561019],[101,76,1.0343057151671131],[102,77,1.0337675900563705],[103,77,.19596545852169872],[103,78,.7615699164421695],[104,78,.734715140616724],[104,79,.22290766922455862],[105,79,1.034416764143981],[106,80,1.03346218824938],[107,80,.1887266444456389],[107,81,.7689419689404797],[108,81,.7274584892496355],[108,82,.23035251959385997],[109,82,1.0344640949448594],[110,83,1.0331108005456808],[111,83,.18178720201436843],[111,84,.7760854696185804],[112,84,.7204264588178948],[112,85,.23763766448199494],[113,85,1.0344523675990727],[114,86,1.032719212418228],[115,86,.1751324878193402],[115,87,.7830081541774375],[116,87,.7136115109646374],[116,88,.2447643291417676],[117,88,1.0343860008764458],[118,89,1.0322926551739824],[119,89,.16874876216974247],[119,90,.789717372631832],[120,90,.7070064800338803],[120,91,.2517338194331562],[121,91,1.0342691839607763],[122,92,1.0318358610025598],[123,92,.16262312499771858],[123,93,.7962201145052664],[124,93,.7006045489251309],[124,94,.25854751343650967],[125,94,1.0341058875275075],[126,95,1.0313531121234998],[127,95,.15674345673841866],[127,96,.8025230320033012],[128,96,.6943992268713032],[128,97,.2652068536620191],[129,97,1.033899874262366],[130,98,1.030848284714744],[131,98,.1510983637896712],[131,99,.8086324613545763],[132,99,.6883843289574696],[132,100,.2717133398209474],[133,100,1.033654708853177],[134,101,1.0303248882205327],[135,101,.14567712818173575],[135,102,.8145544424922615],[136,102,.6825539572209546],[136,103,.2780685221191216],[137,103,1.033373767485838],[138,104,1.0297861005632643],[139,104,.14046966111762169],[139,105,.8202947372282664],[140,105,.6769024831869065],[140,106,.28427399504058354],[141,106,1.0330602468722847],[142,107,1.029234799720434],[143,107,.13546646006984392],[143,108,.8258588460540109],[144,108,.671424531713726],[144,109,.290331391589362],[145,109,1.0327171728357682],[146,110,1.0286735920712562],[147,110,.13065856914309196],[147,111,.8312520236957351],[148,111,.6661149660273628],[148,112,.2962423779602388],[149,112,1.03234740847843],[150,113,1.0281048378703825],[151,113,.12603754244145],[151,114,.8364792935255917],[152,114,.6609688738465388],[152,115,.30200864860954885],[153,115,1.0319536619522978],[154,116,1.0275306741623285],[155,116,.12159541018943322],[155,117,.8415454609370665],[156,117,.655981554500098],[156,118,.3076319217011811],[157,118,1.031538493855763],[158,119,1.0269530354146845],[159,119,.11732464738966399],[159,120,.846455125764718],[160,120,.6511485069565366],[160,121,.3131139349019227],[161,121,1.0311043242739946],[162,122,1.0263736721146446],[163,122,.11321814480714538],[163,123,.851212693834753],[164,123,.6464654186857061],[164,124,.3184564415055735],[165,124,1.0306534394819706],[166,125,1.0257941675461106],[167,125,.10926918209624069],[167,126,.8558223877141483],[168,126,.6419281552876014],[168,127,.32366120686047056],[169,127,1.0301879983273805],[170,128,1.0252159529388847],[171,128,.10547140289367021],[171,129,.8602882567276612],[172,129,.6375327508240597],[172,130,.32873000508360367],[173,130,1.0297100383091813],[174,131,1.0246403211604227],[175,131,.10181879172477112],[175,132,.8646141862987496],[176,132,.6332753987956673],[176,133,.33366461604209907],[177,133,1.0292214813668379],[178,134,1.0240684391009978],[179,134,.09830565257411007],[179,135,.8688039066707689],[180,135,.6291524437169539],[180,136,.3384668225808326],[181,136,1.0287241393952773],[182,137,1.0235013588866442],[183,137,.0949265889928822],[183,138,.8728610010546515],[184,138,.6251603732380943],[184,139,.3431384079843332],[185,139,1.0282197194980238],[186,140,1.0229400280388043],[187,140,.09167648561647405],[187,141,.8767889132518744],[188,141,.6212958107744541],[188,142,.3476811536535296],[189,142,1.0277098289923983],[190,143,1.0223852986877378],[191,143,.08855049098843445],[191,144,.8805909547856343],[192,144,.6175555086043407],[192,145,.35209683698566024],[193,145,1.0271959801772084],[194,146,1.021837935933431],[195,146,.08554400158179727],[195,147,.8842703115872171],[196,147,.6139363413989273],[196,148,.35638722943949186],[197,148,1.026679594876984],[198,149,1.0212986254395027],[199,149,.082652646931321],[199,150,.8878300502607867],[200,150,.6104353001536761],[200,151,.3605540947783916],[201,151,1.0261620087703698],[202,152,1.020767980334856],[203,152,.07987227578640096],[203,153,.8912731239662092],[204,153,.6070494864912312],[204,154,.364599187472458],[205,154,1.025644475516362],[206,155,1.0202465474911722],[207,155,.07719894321045902],[207,156,.8946023779404728],[208,156,.6037761073076129],[208,157,.36852425125748506],[209,157,1.0251281706842847],[210,158,1.0197348132361097],[211,158,.07462889855138014],[211,159,.8978205546916732],[212,159,.6006124697383151],[212,160,.3723310178292769],[213,160,1.0246141955013988],[214,161,1.0192332085569418],[215,161,.07215857422040488],[215,162,.9009302988805],[216,162,.5975559764226185],[216,163,.37602120567284064],[217,163,1.024103580422386],[218,164,1.018742113842709],[219,164,.06978457521665815],[219,165,.9039341619174114],[220,165,.5946041210439893],[220,166,.3795965190111676],[221,166,1.0235972885322195],[222,167,1.0182618632088625],[223,167,.0675036693443592],[223,168,.9068346062921914],[224,168,.5917544841265701],[224,169,.3830586468674795],[225,169,1.0230962187892327],[226,170,1.0177927484431766],[227,170,.06531277806896706],[227,171,.9096340096561174],[228,171,.5890047290713193],[228,172,.38640926223293437],[229,172,1.0226012091159231],[230,173,1.017335022608167],[231,173,.0632089679653424],[231,174,.9123346686734497],[232,174,.586352598418078],[232,175,.3896500213288084],[233,175,1.0221130393455482],[234,176,1.0168889033326205],[235,176,.06118944272087777],[235,177,.914938802652698],[236,177,.5837959103122896],[236,178,.39278256296329067],[237,178,1.0216324340290364],[238,179,1.0164545758191],[239,179,.05925153564332089],[239,180,.9174485569826359],[240,180,.5813325551691159],[240,181,.3958085079669357],[241,181,1.0211600651125134],[242,182,1.01603219559476],[243,182,.05739270264601734],[243,183,.919866006375456],[244,183,.578960492519135],[244,184,.39872945870775167],[245,184,1.020696554488055],[246,185,1.0156218910279706],[247,185,.055610515672866775],[247,186,.9221931579354511],[248,186,.5766777480237313],[248,187,.4015469986761612],[249,187,1.0202424764259312],[250,188,1.0152237656316911],[251,188,.05390265653168126],[251,189,.9244319540637365],[252,189,.5744824106486663],[252,190,.4042626921377848],[253,190,1.0197983598926021],[254,191,1.0148379001729047],[255,191,.052266911108559244],[255,192,.9265842752073952],[256,192,.5723726299899468],[256,193,.40687808384383367],[257,193,1.0193646907609162],[258,194,1.0144643546050645],[259,194,.05070116393653833],[259,195,.9286519424651887],[260,195,.5703466137364466],[260,196,.4093946987997115],[261,196,1.0189419139168765],[262,197,1.014103169839173],[263,197,.04920339309393266],[263,198,.9306367200572258],[264,198,.5684026252644323],[264,199,.41181404208517797],[265,199,1.0185304352678317],[266,200,1.0137543693675302],[267,200,.04777166540942449],[267,201,.9325403176671191],[268,201,.5665389813575877],[268,202,.4141375987198434],[269,202,1.0181306236573189],[270,203,1.0134179607527265],[271,203,.04640413195303674],[271,204,.934364392667829],[272,204,.5647540500383554],[272,205,.4163668335733731],[273,205,1.017742812691386],[274,206,1.0130939369942324],[275,206,.04509902379599986],[275,207,.9361105522297561],[276,207,.5630462485124229],[276,208,.4185031913161667],[277,208,1.0173673024779883],[278,209,1.0127822777820206],[279,209,.043854648017688035],[279,210,.9377803553285139],[280,210,.5614140412123577],[280,211,.42054809640522234],[281,211,1.0170043612872055],[282,212,1.0124829506474082],[283,212,.042669383945431606],[283,213,.9393753146522579],[284,213,.5598559379382144],[284,214,.42250295310432634],[285,214,1.016654227133528],[286,215,1.0121959120202477],[287,215,.04154167961383383],[287,216,.9408968984130733],[288,216,.5583704920894111],[288,217,.42436914553372207],[289,217,1.0163171092845467],[290,218,1.0119211081990869],[291,218,.04047004842376173],[291,219,.9423465320743504],[292,219,.5569562989809166],[292,220,.4261480377490578],[293,220,1.0159931896995795],[294,221,1.0116584762427925],[295,221,.03945306599345366],[295,222,.9437255999933521],[296,222,.5556119942410062],[296,223,.4278409738424421],[297,223,1.0156826244024533],[298,224,1.0114079447897668],[299,224,.038489367187566605],[299,225,.9450354469842541],[300,225,.5543362522836106],[300,226,.42944927807097044],[301,226,1.015385544788648],[302,227,1.0111694348102989],[303,227,.03757764331096192],[303,228,.9462773798108762],[304,228,.5531277848528364],[304,229,.4309742550012965],[305,229,1.0151020588742643],[306,230,1.010942860298229],[307,230,.036716639459590646],[307,231,.9474526686068676],[308,231,.5519853396352962],[308,232,.4324171896758833],[309,232,1.0148322524854105],[310,233,1.0107281289063446],[311,233,.03590515201636021],[311,234,.9485625482321702],[312,234,.5509076989367998],[312,235,.43377934779319954],[313,235,1.0145761903940136],[314,236,1.0105251425307091],[315,236,.03514202628559325],[315,237,.9496082195647421],[316,237,.5498936784177629],[316,238,.4350619759070698],[317,238,1.014333917399279],[318,239,1.0103337978471305],[319,239,.03442615425358563],[319,240,.9505908507379167],[320,240,.5489421258861396],[320,241,.43626630163460317],[321,241,1.0141054593619083],[322,242,1.01015398680447],[323,242,.03375647247069698],[323,243,.9515115783174108],[324,243,.5480519201477565],[324,244,.43739353387882146],[325,244,1.0138908241879996],[326,245,1.0099855970782285],[327,245,.033131960048180864],[327,246,.9523715084281075],[328,246,.5472219699015581],[328,247,.438444863061944],[329,247,1.013690002769195],[330,248,1.009828512486449],[331,248,.0325516367573507],[331,249,.9531717178331495],[332,249,.5464512126887197],[332,250,.43942146136466664],[333,250,1.0135029698801676],[334,251,1.0096826133725936],[335,251,.03201456123217285],[335,252,.9539132549610332],[336,252,.5457386138858732],[336,253,.4403244829779182],[337,253,1.0133296850325435],[338,254,1.009547776957031],[339,254,.03151982926510845],[339,255,.9545971408911784],[340,255,.5450831657405287],[340,256,.44115506435778573],[341,256,1.0131700932920482],[342,257,1.0094238776594737],[343,257,.031066572189892106],[343,258,.9552243702967873],[344,258,.5444838864501296],[344,259,.44191432448690826],[345,259,1.013024126057376],[346,260,1.0093107873949636],[347,260,.030653955347715485],[347,261,.9557959123477745],[348,261,.5439398192781751],[348,262,.44260336514265247],[349,262,1.01289170180302],[350,263,1.0092083758457435],[351,263,.03028117663272106],[351,264,.956312711573757],[352,264,.5434500317097861],[352,265,.44322327116676213],[353,265,1.012772726788603],[354,266,1.0091165107105933],[355,266,.029947465111254432],[355,267,.9567756886915669],[356,267,.5430136146404813],[356,268,.443775110739594],[357,268,1.0126670957357586],[358,269,1.0090350579329337],[359,269,.02965207970869547],[359,270,.9571857414000476],[360,270,.5426296815994802],[360,271,.44425993565630856],[361,271,1.012574692474406],[362,272,1.0089638819102829],[363,272,.029394307963707546],[363,273,.9575437451393404],[364,273,.5422973680058967],[364,274,.4446787816043237],[365,274,1.0124953905592755],[366,275,1.0089028456858484],[367,275,.029173464843693937],[367,276,.9578505538209541],[368,276,.5420158304528419],[368,277,.44503266844280676],[369,277,1.0124290538587923],[370,278,1.0088518111235036],[371,278,.028988891617224174],[371,279,.9581070005279474],[372,279,.5417842460227992],[372,280,.4453226004830567],[373,280,1.012375537116488],[374,281,1.0088106390682976],[375,281,.028839954783933083],[375,282,.9583138981860433],[376,282,.5416018116287169],[376,283,.4455495667668758],[377,283,1.0123346864882432],[378,284,1.008779189492711],[379,284,.02872604505481853],[379,285,.9584720402070429],[380,285,.5414677433849261],[380,286,.44571454134485444],[381,286,1.0123063400541175],[382,287,1.008757321629678],[383,287,.028646576380597488],[383,288,.9585822011116006],[384,288,.5413812759956369],[384,289,.4458184835568685],[385,289,1.0122903283078832],[386,290,1.0087448940943453],[387,290,.028600985028178233],[387,291,.9586451371206854],[388,291,.541341662177547],[388,292,.44586233830592226],[389,292,1.0122864746237836],[390,293,1.0087417649949195],[391,293,.028588728701898054],[391,294,.9586615867284015],[392,294,.5413481720936798],[392,295,.44584703633543826],[393,295,1.0122945957030358],[394,296,1.0087477920325896],[395,296,.028609285702619672],[395,297,.958632271251788],[396,297,.5414000928186515],[396,298,.44577349450072723],[397,298,1.0123145019997328],[398,299,1.0087628325926643],[399,299,.028662154128659946],[399,300,.9585578953591529],[400,300,.5414967278190544],[400,301,.4456426160405528],[401,301,1.0123459981276965],[402,302,1.0087867438270437],[403,302,.028746851113718195],[403,303,.9584391475775814],[404,303,.5416373964555454],[404,304,.4454552908447334],[405,304,1.0123888832492127],[406,305,1.0088193827286074],[407,305,.02886291209986826],[407,306,.9582767007831089],[408,306,.541821433501071],[408,307,.44521239571891796],[409,307,1.0124429514472502],[410,308,1.0088606061980132],[411,308,.029009890142771087],[411,309,.9580712126699451],[412,309,.5420481886827784],[412,310,.4449147946460895],[413,310,1.01250799207953],[414,311,1.0089102711038211],[415,311,.029187355249536997],[415,312,.9578233262044412],[416,312,.5423170262339921],[416,313,.44456333904778883],[417,313,1.0125837901172945],[418,314,1.0089682343360202],[419,314,.02939489374516595],[419,315,.9575336700623188],[420,315,.5426273244683578],[420,316,.4441588680360723],[421,316,1.0126701264704934],[422,317,1.0090343528545804],[423,317,.029632107670909735],[423,318,.9572028590461733],[424,318,.5429784753662162],[424,319,.44370220866623333],[425,319,1.0127667782967882],[426,320,1.0091084837312583],[427,320,.02989861420426184],[427,321,.9568314944924141],[428,321,.5433698841780775],[428,322,.44319417618582607],[429,322,1.0128735192969558],[430,323,1.0091904841873789],[431,323,.03019404510848359],[431,324,.9564201646615609],[432,324,.5438009690392793],[432,325,.442635574278337],[433,325,1.0129901199984148],[434,326,1.0092802116265451],[435,326,.030518046204357472],[435,327,.9559694451142186],[436,327,.5442711606026257],[436,328,.4420271953022404],[437,328,1.013116348025554],[438,329,1.0093775236632159],[439,329,.030870276865616747],[439,330,.9554798990737882],[440,330,.5447799016825403],[440,331,.4413698205263152],[441,331,1.0132519683584005],[442,332,1.009482278147551],[443,332,.03125040953717358],[443,333,.9549520777754482],[444,333,.5453266469100869],[444,334,.4406642203630321],[445,334,1.0133967435791398],[446,335,1.009594333186143],[447,335,.031658129272365214],[447,336,.9543865208053518],[448,336,.5459108623998897],[448,337,.43991115459682073],[449,337,1.0135504341086077],[450,338,1.0097135471594447],[451,338,.03209313328990995],[451,339,.9537837564264052],[452,339,.5465320254328632],[452,340,.4391113726049666],[453,340,1.013712798432744],[454,341,1.009839778736762],[455,341,.03255513055252836],[455,342,.9531443018899375],[456,342,.5471896241467579],[456,343,.43826561357805704],[457,343,1.0138835933177033],[458,344,1.0099728868869051],[459,344,.033043841357819334],[459,345,.9524686637453139],[460,345,.5478831572348231],[460,346,.437374606734874],[461,346,1.0140625740178375],[462,347,1.0101127308880269],[463,347,.03355899695286791],[463,348,.9517573381261256],[464,348,.5486121336621822],[464,349,.436439071532636],[465,349,1.0142494944714182],[466,350,1.0102591703335964],[467,350,.03410033916008615],[467,351,.9510108110386514],[468,351,.5493760723833191],[468,352,.4354597178717026],[469,352,1.0144441074918717],[470,353,1.0104120651366326],[471,353,.03466762001996195],[471,354,.9502295586328896],[472,354,.5501745020753853],[472,355,.43443724629963687],[473,355,1.0146461649465606],[474,356,1.0105712755316636],[475,356,.035260601448092795],[475,357,.9494140474694148],[476,357,.5510069608761691],[476,358,.43337234820709825],[477,358,1.0148554179311553],[478,359,1.0107366620751033],[479,359,.035879054907258415],[479,360,.9485647347731454],[480,360,.5518729961339426],[480,361,.4322657060211073],[481,361,1.0150716169344107],[482,362,1.0109080856433987],[483,362,.036522761091017805],[483,363,.9476820686815849],[484,363,.5527721641646695],[484,364,.4311179933933358],[485,364,1.0152945119966836],[486,365,1.011085407429963],[487,365,.037191509621709105],[487,366,.9467664884832998],[488,366,.5537040300164661],[488,367,.42992987538427074],[489,367,1.0155238528614574],[490,368,1.0112684889404733],[491,368,.03788509876006132],[491,369,.945818424848663],[492,369,.5546681672409077],[492,370,.42870200864543534],[493,370,1.015759389119438],[494,371,1.0114571919861517],[495,371,.038603335123549486],[495,372,.9448383000574974],[496,372,.5556641576735553],[496,373,.42743504159139284],[497,373,1.016000870349307],[498,374,1.0116513786769457],[499,374,.03934603342038135],[499,375,.9438265282100843],[500,375,.556691591222498],[500,376,.42612961457530607],[501,376,1.0162480462474877],[502,377,1.011850911412824],[503,377,.0401130161915153],[503,378,.9427835154401112],[504,378,.5577500656591832],[504,379,.42478636005357434],[505,379,1.0165006667574357],[506,380,1.012055652873517],[507,380,.04090411356002747],[507,381,.9417096601187289],[508,381,.5588391864205529],[508,382,.4234059027505881],[509,382,1.016758482190165],[510,383,1.0122654660085202],[511,383,.04171916299559172],[511,384,.940605353048487],[512,384,.5599585664146272],[512,385,.4219888598177451],[513,385,1.0170212433404524],[514,386,1.0124802140252198],[515,386,.04255800908365318],[515,387,.9394709776545362],[516,387,.5611078258344457],[516,388,.42053584098827806],[517,388,1.0172887015980372],[518,389,1.0126997603766286],[519,389,.04342050330548295],[519,390,.9383069101697904],[520,390,.5622865919744513],[520,391,.4190474487280153],[521,391,1.0175606090547666],[522,392,1.0129239687479124],[523,392,.044306503823998804],[523,393,.9371135198133816],[524,393,.5634944990567509],[524,394,.41752427838399275],[525,394,1.017836718605313],[526,395,1.0131527030429122],[527,395,.04521587528078427],[527,396,.9358911689630978],[528,396,.5647311880602439],[528,397,.4159669183258934],[529,397,1.0181167840454461],[530,398,1.013385827369556],[531,398,.04614848859869256],[531,399,.9346402133241121],[532,399,.5659963065530312],[532,400,.41437595008823225],[533,400,1.0184005601646522],[534,401,1.0136232060250132],[535,401,.04710422079259773],[535,402,.9333610020906034],[536,402,.5672895085344858],[536,403,.41275194850334485],[537,403,1.0186878028359048],[538,404,1.0138647034793364],[539,404,.048082954782625906],[539,405,.9320538781067357],[540,405,.5686104542795039],[540,406,.4110954818363832],[541,406,1.0189782691001303],[542,407,1.0141101843606544],[543,407,.04908457922335384],[543,408,.9307191780153855],[544,408,.5699588101870642],[544,409,.40940711191046436],[545,409,1.0192717172488233],[546,410,1.0143595134378742],[547,410,.05010898832967291],[547,411,.9293572324099554],[548,411,.571334248633412],[548,412,.4076873942350095],[549,412,1.0195679069010588],[550,413,1.014612555604275],[551,413,.05115608171422347],[551,414,.9279683659767549],[552,414,.5727364478324755],[552,415,.4059368781231612],[553,415,1.0198665990790994],[554,416,1.0148691758602966],[555,416,.05222576422885553],[555,417,.9265528976348417],[556,417,.5741650916958022],[556,418,.40415610681371494],[557,418,1.0201675562784311],[558,419,1.0151292392959954],[559,419,.05331794581129548],[559,420,.9251111406735011],[560,420,.575619869698764],[560,421,.40234561758289383],[561,421,1.020470542537326],[562,422,1.0153926110734461],[563,422,.05443254133751677],[563,423,.9236434028815992],[564,423,.577100476753225],[564,424,.40050594185671334],[565,424,1.0207753235006762],[566,425,1.0156591564087798],[567,425,.05556947047932675],[567,426,.9221499866777003],[568,426,.5786066130792553],[568,427,.3986376053171075],[569,427,1.021081666483685],[570,428,1.0159287405542117],[571,428,.056728657567230105],[571,429,.9206311892316345],[572,429,.5801379840824749],[572,430,.3967411280111777],[573,430,1.0213893405291132],[574,431,1.016201228779567],[575,431,.057910031456259455],[575,432,.9190873025878152],[576,432,.5816943002369833],[576,433,.39481702444623007],[577,433,1.021698116466727],[578,434,1.0164764863538518],[579,434,.05911352539724152],[579,435,.9175186137811212],[580,435,.5832752769689779],[580,436,.3928658036922941],[581,436,1.0220077669657777],[582,437,1.0167543785266802],[583,437,.06033907691219022],[583,438,.9159254049505173],[584,438,.5848806345442068],[584,439,.3908879694785636],[585,439,1.022318066586335],[586,440,1.017034770509633],[587,440,.061586627674206584],[587,441,.914307953451257],[588,441,.58651009795775],[588,442,.3888840202832941],[589,442,1.0226287918300547],[590,443,1.017317527457434],[591,443,.06285612338957339],[591,444,.9126665319603182],[592,444,.5881633968320044],[592,445,.3868544494242516],[593,445,1.0229397211858324],[594,446,1.0176025144493452],[595,446,.06414751368695158],[595,447,.9110014085827639],[596,447,.5898402653081352],[596,448,.3847997451452973],[597,448,1.0232506351759092],[598,449,1.0178895964699735],[599,449,.06546075200505637],[599,450,.9093128469516464],[600,450,.5915404419502857],[600,451,.38272039070347513],[601,451,1.0235613163962847],[602,452,1.018178638390636],[603,452,.06679579548876291],[603,453,.9076011063291527],[604,453,.5932636696450677],[604,454,.3806168644453139],[605,454,1.0238715495601471],[606,455,1.0184695049504477],[607,455,.06815260488510425],[607,456,.9058664416991429],[608,456,.5950096955107654],[608,457,.37848963988927037],[609,457,1.024181121533852],[610,458,1.0187620607370533],[611,458,.06953114444294146],[611,459,.9041091038666588],[612,459,.5967782707982764],[612,460,.3763391858013562],[613,460,1.0244898213757605],[614,461,1.0190561701684775],[615,461,.07093138181829654],[615,462,.9023293395404434],[616,462,.5985691508103589],[616,463,.37416596626748977],[617,463,1.0247974403689852],[618,464,1.0193516974735164],[619,464,.07235328797779521],[619,465,.9005273914292568],[620,465,.6003820948062436],[620,466,.37197044076689306],[621,466,1.0251037720559506],[622,467,1.0196485066733956],[623,467,.07379683710904351],[623,468,.8987034983230944],[624,468,.6022168659211814],[624,469,.3697530642404009],[625,469,1.025408612268551],[626,470,1.01994646156273],[627,470,.07526200653052777],[627,471,.8968578951803935],[628,471,.6040732310832857],[628,472,.36751428715382667],[629,472,1.0257117591594511],[630,473,1.0202454256910738],[631,473,.07674877660715493],[631,474,.8949908132065928],[632,474,.6059509609308075],[632,475,.3652545555682938],[633,475,1.0260130132278693],[634,476,1.0205452623441595],[635,476,.07825713066499564],[635,477,.8931024799348216],[636,477,.6078498297369068],[636,478,.36297431119783957],[637,478,1.026312177347325],[638,479,1.0208458345252258],[639,479,.07978705490923481],[639,480,.8911931193041005],[640,480,.6097696153313106],[640,481,.360673991471839],[641,481,1.0266090567901067],[642,482,1.021147004936792],[643,482,.08133853834681559],[643,483,.8892629517341233],[644,483,.6117100990244927],[644,484,.3583540295921792],[645,484,1.0269034592511874],[646,485,1.0214486359623245],[647,485,.08291157270803175],[647,486,.8873121941972261],[648,486,.6136710655396947],[648,487,.35601485458732646],[649,487,1.0271951948700204],[650,488,1.0217505896477503],[651,488,.08450615237016054],[651,489,.885341060291742],[652,489,.6156523029400911],[652,490,.3536568913681695],[653,490,1.0274840762511013],[654,491,1.022052727683594],[655,491,.08612227428601159],[655,492,.8833497603088218],[656,492,.6176536025590085],[656,493,.3512805607832744],[657,493,1.02776991848203],[658,494,1.0223549113867765],[659,494,.08775993791161714],[659,495,.8813385013049766],[660,495,.6196747589336273],[660,496,.34888627966024516],[661,496,1.028052539155018],[662,497,1.0226570016825074],[663,497,.08941914513388247],[663,498,.8793074871648813],[664,498,.621715569739104],[664,499,.346474460866357],[665,499,1.0283317583791294],[666,500,1.0229588590871557],[667,500,.09109990020637701],[667,501,.8772569186645972],[668,501,.6237758357289777],[668,502,.34404551334349676],[669,502,1.0286073987990987],[670,503,1.023260343690056],[671,503,.09280220968027517],[671,504,.8751869935378795],[672,504,.6258553606671395],[672,505,.3415998421603758],[673,505,1.0288792856085094],[674,506,1.0235613151361742],[675,506,.09452608233896752],[675,507,.8730979065358732],[676,507,.6279539512706841],[676,508,.33913784855416224],[677,508,1.0291472465628844],[678,509,1.0238616326091752],[679,509,.09627152913686766],[679,510,.8709898494841083],[680,510,.6300714171530707],[680,511,.3366599299694516],[681,511,1.0294111119920568],[682,512,1.0241611548135297],[683,512,.09803856313307117],[683,513,.8688630113461538],[684,513,.6322075707612916],[684,514,.3341664801038121],[685,514,1.0296707148107829],[686,515,1.0244597399582411],[687,515,.09982719943517422],[687,516,.8667175782751595],[688,516,.6343622273238361],[688,517,.33165788894132453],[689,517,1.029925890529174],[690,518,1.024757245739534],[691,518,.10163745513498708],[691,519,.864553733672022],[692,519,.6365352047963319],[692,520,.32913454279236454],[693,520,1.0301764772610114],[694,521,1.0250535293244536],[695,521,.10346934925456013],[695,522,.8623716582378126],[696,522,.6387263238040831],[696,523,.32659682433041565],[697,523,1.0304223157317631],[698,524,1.0253484473338592],[699,524,.10532290268142636],[699,525,.8601715300305955],[700,525,.6409354075949926],[700,526,.32404511262442137],[701,526,1.0306632492858765],[702,527,1.0256418558269649],[703,527,.10719813812199533],[703,528,.8579535245094766],[704,528,.6431622819855923],[704,529,.3214797831731655],[705,529,1.0308991238920382],[706,530,1.0259336102845216],[707,530,.10909508003982304],[707,531,.855717814591042],[708,531,.6454067753119441],[708,532,.3189012079363341],[709,532,1.03112978814904],[710,533,1.0262235655929648],[711,533,.11101375459950885],[711,534,.8534645706974212],[712,534,.6476687183847731],[712,535,.31630975536452444],[713,535,1.0313550932895121],[714,536,1.0265115760290215],[715,536,.11295418962138112],[715,537,.8511939607995829],[716,537,.6499479444348513],[716,538,.3137057904341974],[717,538,1.0315748931821125],[718,539,1.0267974952437684],[719,539,.11491641452111552],[719,540,.8489061504692988],[720,540,.6522442890739327],[720,541,.3110896746693046],[721,541,1.0317890443354898],[722,542,1.027081176247435],[723,542,.11690046026072583],[723,543,.8466013029223681],[724,543,.6545575902471419],[724,544,.3084617661720711],[725,544,1.0319974058989068],[726,545,1.0273624713942857],[727,545,.11890635929917114],[727,546,.8442795790631381],[728,546,.6568876881880987],[728,547,.3058224196480645],[729,547,1.0321998396634169],[730,548,1.0276412323675237],[731,548,.12093414553884717],[731,549,.8419411375296247],[732,549,.6592344253774453],[732,550,.3031719864317822],[733,550,1.0323962100616533],[734,551,1.027917310164898],[735,551,.12298385427920393],[735,552,.8395861347312832],[736,552,.661597646501151],[736,553,.30051081451364153],[737,553,1.0325863841657408],[738,554,1.028190555083932],[739,554,.12505552216817234],[739,555,.8372147248951822],[740,555,.6639771984076539],[740,556,.2978392485576317],[741,556,1.0327702316879357],[742,557,1.0284608167076257],[743,557,.12714918714905468],[743,558,.8348270601054527],[744,558,.6663729300704698],[744,559,.2951576299293991],[745,559,1.0329476249762861],[746,560,1.0287279438905246],[747,560,.12926488841857217],[747,561,.8324232903405301],[748,561,.6687846925454237],[748,562,.2924662967182933],[749,562,1.0331184390116956],[750,563,1.0289917847447467],[751,563,.13140266637549056],[751,564,.8300035635173267],[752,564,.6712123389365675],[752,565,.28976558374944045],[753,565,1.033282551406384],[754,566,1.0292521866268258],[755,566,.13356256257828694],[755,567,.8275680255195722],[756,567,.6736557243576808],[756,568,.28705582261488644],[757,568,1.0334398423957492],[758,569,1.0295089961237516],[759,569,.1357446196959754],[759,570,.8251168202441111],[760,570,.6761147058925864],[760,571,.2843373416864493],[761,571,1.0335901948361186],[762,572,1.0297620590403478],[763,572,.13794888146102224],[763,573,.822650089632257],[764,573,.6785891425651428],[764,574,.2816104661359854],[765,574,1.0337334941973482],[766,575,1.0300112203862977],[767,575,.1401753926301894],[767,576,.8201679737037143],[768,576,.6810788952992894],[768,577,.278875517953921],[769,577,1.0338696285566522],[770,578,1.0302563243634062],[771,578,.14242419893016717],[771,579,.8176706105975015],[772,579,.6835838268889712],[772,580,.2761328159639002],[773,580,1.0339984885922306],[774,581,1.0304972143534852],[775,581,.14469534702456693],[775,582,.8151581365963325],[776,582,.6861038019600981],[776,583,.2733826758448351],[777,583,1.0341199675739228],[778,584,1.0307337329063364],[779,584,.14698888445850505],[779,585,.8126306861670012],[780,585,.6886386869453004],[780,586,.2706254101402667],[781,586,1.0342339613562985],[782,587,1.0309657217274584],[783,587,.14930485962229872],[783,588,.810088391991206],[784,588,.6911883500416512],[784,589,.267861328280309],[785,589,1.0343403683692496],[786,590,1.0311930216672842],[787,590,.1516433217043255],[787,591,.80753138499415],[788,591,.6937526611907388],[788,592,.2650907365900638],[789,592,1.0344390896084676],[790,593,1.0314154727094134],[791,593,.1540043206504027],[791,594,.8049597943767033],[792,594,.6963314920402311],[792,595,.2623139383094437],[793,595,1.034530028625162],[794,596,1.0316329139598897],[795,596,.1563879071152346],[795,597,.8023737476471726],[796,597,.6989247159176777],[796,598,.25953123360660696],[797,598,1.0346130915153564],[798,599,1.0318451836365417],[799,599,.15879413242528773],[799,600,.799773370648628],[800,600,.7015322078013413],[800,601,.256742919587031],[801,601,1.0346881869094755],[802,602,1.0320521190584917],[803,602,.16122304853347555],[803,603,.7971587875884961],[804,603,.7041538442893039],[804,604,.2539492903120581],[805,604,1.0347552259598483],[806,605,1.032253556636297],[807,605,.16367470797552194],[807,606,.7945301210672343],[808,606,.7067895035746306],[808,607,.2511506368077842],[809,607,1.0348141223290412],[810,608,1.0324493318619021],[811,608,.16614916382632547],[811,609,.7918874921076472],[812,609,.709439065413448],[812,610,.24834724708249672],[813,610,1.0348647921767888],[814,611,1.032639279299876],[815,611,.1686464696616927],[815,612,.7892310201754584],[816,612,.7121024111062217],[816,613,.24553940613187852],[817,613,1.0349071541468273],[818,614,1.0328232325774014],[819,614,.17116667951302045],[819,615,.7865608232133336],[820,615,.7147794234616441],[820,616,.24272739595679857],[821,616,1.0349411293537],[822,617,1.0330010243763053],[823,617,.17370984782335191],[823,618,.7838770176637189],[824,618,.7174699867799718],[824,619,.23991149556876706],[825,619,1.0349666413686411],[826,620,1.033172486424039],[827,620,.17627602940857415],[827,621,.7811797184924586],[828,621,.720173986819918],[828,622,.23709198101021747],[829,622,1.0349836162040225],[830,623,1.0333374494861536],[831,623,.1788652794118951],[831,624,.7784690392157592],[832,624,.7228913107823544],[832,625,.234269125354749],[833,625,1.0349919822996723],[834,626,1.0334957433581187],[835,626,.18147765326305537],[835,627,.7757450919251534],[836,627,.7256218472813651],[836,628,.23144319872166874],[837,628,1.0349916705072433],[838,629,1.033647196858036],[839,629,.1841132066386375],[839,630,.773007987305413],[840,630,.7283654863202004],[840,631,.22861446829229304],[841,631,1.0349826140730403],[842,632,1.033791637819688],[843,632,.1867719954109858],[843,633,.7702578346682248],[844,633,.7311221192693971],[844,634,.2257831983137577],[845,634,1.0349647486235953],[846,635,1.0339288930859631],[847,635,.18945407561392777],[847,636,.7674947419659374],[848,636,.7338916388459672],[848,637,.22294965011006523],[849,637,1.0349380121480094],[850,638,1.0342420464149167],[851,638,.1924281237940313],[851,639,.5378425839134362],[852,639,.5202524171708031],[852,640,.4568109772775498],[852,641,.05199677850209752],[853,640,.24351254102567055],[853,641,.5225687624093359],[853,642,.2921493228893563],[854,642,.25538328243481595],[854,643,.5241438210153896],[854,644,.23257172527298814],[855,643,.011987787701546808],[855,644,.3172219958151092],[855,645,.4868674616302827],[855,646,.176468024136203],[856,645,.07357769424953754],[856,646,.38294232266815553],[856,647,.4259205416014665],[856,648,.11753224171517974],[857,647,.13246196705929972],[857,648,.4398303708699065],[857,649,.36708371923835004],[857,650,.06067586883292038],[858,649,.18926719214302565],[858,650,.4946697651421086],[858,651,.3040061179704405],[858,652,.005602736230038195],[859,651,.23906249586178907],[859,652,.5231149368578739],[859,653,.2495840468006932],[860,653,.2897970473112013],[860,654,.5026442283960142],[860,655,.20274559579570214],[861,654,.04664315619110009],[861,655,.3473240465998149],[861,656,.4526192727121032],[861,657,.1523595035438806],[862,656,.09766699822939251],[862,657,.3969699779916487],[862,658,.40188113292822186],[862,659,.1034820659161816],[863,658,.14649823031506354],[863,659,.44395391725661004],[863,660,.3530826952522148],[863,661,.056517279244449437],[864,660,.193417537810633],[864,661,.48905272813711814],[864,662,.30196784607077015],[864,663,.011088189502860925],[865,662,.235165441654809],[865,663,.5161755064939912],[865,664,.25593745749264785],[866,664,.27598857145168865],[866,665,.5055165820237347],[866,666,.21733399798014585],[867,665,.03142691535889764],[867,666,.321995701601107],[867,667,.4677769922252197],[867,668,.17692400337387545],[868,667,.07312870986769164],[868,668,.3630952451007391],[868,669,.4264378437134144],[868,670,.13731285791147696],[869,669,.11270032695167025],[869,670,.4009509624326517],[869,671,.38688927555227676],[869,672,.09946833663506985],[870,671,.15050630725355646],[870,672,.43706477714430675],[870,673,.34910378546507886],[870,674,.06336347754327785],[871,673,.1865736616624162],[871,674,.4714631653468664],[871,675,.3125696686315781],[871,676,.028869775846049314],[872,675,.22058655357283705],[872,676,.502393455771382],[872,677,.27458473006488804],[873,677,.24983886475629993],[873,678,.5137748593109537],[873,679,.24315322539257223],[874,678,.0036240101488931717],[874,679,.2812413419420975],[874,680,.49584386088869215],[874,681,.2153614227018543],[875,680,.034735500335029305],[875,681,.3144060917430617],[875,682,.46485314373790926],[875,683,.18595981453922283],[876,682,.0641063484572785],[876,683,.34219859962945964],[876,684,.43549740951782173],[876,685,.15817234633893226],[877,684,.091864261548934],[877,685,.3683988258245694],[877,686,.407752916631107],[877,687,.13197572785525458],[878,686,.11803256264694018],[878,687,.3930296465168421],[878,688,.3815964769154389],[878,689,.10734720976073055],[879,688,.1426340315995158],[879,689,.4161134070872291],[879,690,.35700543857338174],[879,691,.08426456699687354],[880,690,.16569092182506315],[880,691,.43767193845249674],[880,692,.33395766972405766],[880,693,.06270608273067858],[881,692,.1872249764612122],[881,693,.457726572814142],[881,694,.3124315425508366],[881,695,.04265053289025597],[882,694,.20725744392861123],[882,695,.47629815883858434],[882,696,.29240591801936916],[882,697,.024077171256560802],[883,696,.22580909293436022],[883,697,.49340707629100294],[883,698,.272739666255128],[883,699,.006906252371233933],[884,698,.24190643067177103],[884,699,.5047275543873398],[884,700,.2549459812508028],[885,700,.2567100539467806],[885,701,.5031577036963546],[885,702,.24065881914660317],[886,701,.008634717813202674],[886,702,.27224949572145724],[886,703,.49094674236787206],[886,704,.22719544196570912],[887,703,.02292373131969297],[887,704,.28597629401801355],[887,705,.47672398599653515],[887,706,.2143533208320832],[888,705,.035751602096786475],[888,706,.29743237559552355],[888,707,.46390276826706217],[888,708,.20289630196958544],[889,707,.04719579903029385],[889,708,.3075210742305127],[889,709,.45246460115847775],[889,710,.19280622955805915],[890,709,.057274491299496445],[890,710,.3162602301176305],[890,711,.4423913913890736],[890,712,.18406533389761395],[891,711,.0660054606502899],[891,712,.3236673045470217],[891,713,.43366542899845073],[891,714,.17665622026124392],[892,713,.07340611260620647],[892,714,.3297593908476435],[892,715,.4262693763198494],[892,716,.17056185812791913],[893,715,.07949348729590157],[893,716,.33455322495703466],[893,717,.42018625732795906],[893,718,.16576557078065143],[894,717,.0842842699121286],[894,718,.3380651956328206],[894,719,.41539944734620887],[894,720,.16225102525634236],[895,719,.0877948008176482],[895,720,.3403113543186734],[895,721,.41189266310148215],[895,722,.1600022226324315],[896,721,.09004108530992379],[896,722,.3413074246800344],[896,723,.4096499531105413],[896,724,.15900348863810745],[897,723,.0910388030604564],[897,724,.341068811820455],[897,725,.4086556883871424],[897,726,.15923946457791555],[898,725,.09080331723824445],[898,726,.33961061119156805],[898,727,.40889455345709996],[898,728,.16069509855546693],[899,727,.08934968333179105],[899,728,.33694761720865024],[899,729,.41035153766953336],[899,730,.1633556369851302],[900,729,.08669265767999552],[900,730,.33309433158306806],[900,731,.41301192679237225],[900,732,.16720661638248935],[901,731,.08284670572359325],[901,732,.32806497138102175],[901,733,.41686129488304347],[901,734,.17223385542154263],[902,733,.0778260099865808],[902,734,.3218734768206457],[902,735,.421885496422382],[902,736,.17842344724960524],[903,735,.07164447779930824],[903,736,.31453351881588426],[903,737,.42807065870301164],[903,738,.185761752049803],[904,737,.06431574877136567],[904,738,.3060585062772846],[904,739,.435403174462235],[904,740,.19423538984244326],[905,739,.05585320202451507],[905,740,.29646159317816856],[905,741,.4438696947508069],[905,742,.20383123351642937],[906,741,.04626996319383157],[906,742,.2857556853951481],[906,743,.4534571220289279],[906,744,.21453640208174513],[907,743,.03557891120608933],[907,744,.27395344733160587],[907,745,.4640838862781736],[907,746,.2259711147745072],[908,745,.02378916236694485],[908,746,.26064383557298154],[908,747,.4744097020055178],[908,748,.23741469023048611],[908,749,.0029874664482454345],[909,747,.010888485342882084],[909,748,.24524012825579347],[909,749,.47705262348683797],[909,750,.25146343127990345],[909,751,.018030374036361534],[910,750,.23051594568994063],[910,751,.4659638155007443],[910,752,.26789265476733026],[910,753,.034103962104678205],[911,752,.2157780537828917],[911,753,.4490488012027463],[911,754,.28394240197843773],[911,755,.051207169174446954],[912,754,.19869680451466967],[912,755,.4309201309554197],[912,756,.3010279740476113],[912,757,.06933596927309439],[913,756,.18059146729117878],[913,757,.4117775174928008],[913,758,.3191380672559441],[913,759,.08847923890660256],[914,758,.16147315955443303],[914,759,.3916318997027402],[914,760,.33826157637971177],[914,761,.10862604895508292],[915,760,.14135280401108383],[915,761,.37049402581791996],[915,762,.35838758963377015],[915,763,.12976565972904766],[916,762,.12024113359574008],[916,763,.34837445826725],[916,764,.3795053837685538],[916,765,.15188751617588445],[917,764,.0981486962833266],[917,765,.32528357838026745],[917,766,.40160441931520835],[917,767,.17498124323033803],[918,766,.07508585975635881],[918,767,.30123159095005636],[918,768,.42467433597326765],[918,769,.19903664130457108],[919,768,.05106281593203439],[919,769,.2762285286588279],[919,770,.4480441892579001],[919,771,.22091817857346802],[920,770,.02605116606412028],[920,771,.24679268601046497],[920,772,.4613333588465915],[920,773,.24636316696152993],[920,774,.026661594315488448],[921,772,.00017143112777602207],[921,773,.22016507993495968],[921,774,.4450006731455823],[921,775,.27654268563105877],[921,776,.05450703342817279],[922,775,.19537707282293476],[922,776,.4169980825615683],[922,777,.3043455873211709],[922,778,.08322496813649063],[923,777,.16671893224886847],[923,778,.3873911007134449],[923,779,.333032487802997],[923,780,.11284587069811512],[924,779,.1371380798307044],[924,780,.3568813039463011],[924,781,.36262258254682433],[924,782,.14336176762117853],[925,781,.10666365535341012],[925,782,.32548606626333626],[925,783,.39310680323983005],[925,784,.17476372572452537],[926,783,.07530458232966944],[926,784,.2932141772790525],[926,785,.4235343782302751],[926,786,.20429957725699868],[927,785,.04297407877416276],[927,786,.2566282342451322],[927,787,.44609730979381396],[927,788,.23600300007995265],[927,789,.023774697332874434],[928,787,.00973561058609779],[928,788,.22213324067090034],[928,789,.4366882593279592],[928,790,.27231575108916795],[928,791,.058813271383982776],[929,790,.1899112794795718],[929,791,.4051174305988943],[929,792,.3087329260703045],[929,793,.09459113946159277],[930,792,.15536737862587172],[930,793,.36909687837539557],[930,794,.3443998634306182],[930,795,.13113054742980831],[931,794,.11887833690004168],[931,795,.3317399346424034],[931,796,.3809015150071346],[931,797,.1684974582828263],[932,796,.08156315084174257],[932,797,.29356399783457987],[932,798,.4168389957384664],[932,799,.2027189344423823],[933,798,.043285265762028874],[933,799,.2496929999720567],[933,800,.44089395742648096],[933,801,.24052352812737388],[933,802,.03507425254057242],[934,800,.0043335535351657515],[934,801,.21027601904641954],[934,802,.42143856683278325],[934,803,.2844016743443022],[934,804,.07585590645285804],[935,803,.17353832434253885],[935,804,.38262846297038483],[935,805,.3257498632562316],[935,806,.11730189433403454],[936,805,.13268775789077444],[936,806,.3407519309130924],[936,807,.3670972990020704],[936,808,.15947396875496164],[937,807,.09057464650490143],[937,808,.2978183751219168],[937,809,.40749895190525254],[937,810,.19795010289674397],[938,809,.0474866463063797],[938,810,.24850494279526708],[938,811,.4346436181876547],[938,812,.2403211224239381],[938,813,.04014881320170647],[939,811,.003878639500178961],[939,812,.2047038150773143],[939,813,.41157455841171137],[939,814,.28957529821809164],[939,815,.08560320920592149],[940,814,.16385621221760913],[940,815,.36828320787286745],[940,816,.33550406688664397],[940,817,.13164677712134118],[941,816,.11836297424309958],[941,817,.32185871977911545],[941,818,.3799973298161782],[941,819,.17581896778117206],[942,818,.07143918326167292],[942,819,.2705029465809176],[942,820,.4180894904987747],[942,821,.22040151023922497],[942,822,.023261093492508676],[943,820,.023754358875460287],[943,821,.22082957274806367],[943,822,.41735892037093947],[943,823,.26975946681527463],[943,824,.07244459405934162],[944,823,.17462856886910824],[944,824,.376380003235797],[944,825,.32258384746152186],[944,826,.12234695850241085],[945,825,.12764964491952732],[945,826,.32754202842781277],[945,827,.3705351976091778],[945,828,.17002290467196218],[946,827,.07705703864783364],[946,828,.27228373423426855],[946,829,.4119493110954956],[946,830,.21796235075295245],[946,831,.024608216085607083],[947,829,.025780053026113373],[947,830,.2190518649272109],[947,831,.41169318411556594],[947,832,.27077590916361477],[947,833,.07732052594065236],[948,832,.1695115580680664],[948,833,.36773423672329814],[948,834,.3275311475162098],[948,835,.13077893984001213],[949,834,.11922966876699366],[949,835,.31565346594837984],[949,836,.37813100062036553],[949,837,.17991281790206778],[950,836,.06510103041600655],[950,837,.25463712967072577],[950,838,.4162975451493948],[950,839,.23222690463246418],[950,840,.043347365043106205],[951,838,.010682336294089382],[951,839,.20025854636251755],[951,840,.3947874901107556],[951,841,.2917173663646273],[951,842,.09950708368621437],[952,841,.14911244770443477],[952,842,.3431424199239878],[952,843,.3480530442639449],[952,844,.15411315971947762],[953,843,.0934299055238343],[953,844,.2830893937829872],[953,845,.3971235804951196],[953,846,.20716078374370134],[953,847,.020137203526012115],[954,845,.036025540013401365],[954,846,.22261124110739972],[954,847,.40630997808531094],[954,848,.2648205963423913],[954,849,.07872881878459281],[955,848,.16692727676480973],[955,849,.35954874836594064],[955,850,.328443108696204],[955,851,.13751082396144756],[956,850,.11152248261980105],[956,851,.3006327942159715],[956,852,.3829521945790107],[956,853,.1916328343080391],[956,854,.0076262937092498664],[957,852,.0514953905500914],[957,853,.2343500090068106],[957,854,.41021535649217705],[957,855,.25030428726128284],[957,856,.06835964516566889],[958,855,.17563114080501685],[958,856,.3667504924135684],[958,857,.31835263030310357],[958,858,.1299663000321827],[959,857,.11940718803292909],[959,858,.3065438045294419],[959,859,.37569491987401304],[959,860,.18605528589059708],[959,861,.004834820768368334],[960,859,.05684866493974193],[960,860,.2366688077210537],[960,861,.4085057240274029],[960,862,.24678375999468344],[960,863,.06783571840441664],[961,862,.17558642045742334],[961,863,.36451985113857055],[961,864,.3173137388508224],[961,865,.13129392160626782],[962,864,.11725721455632943],[962,865,.3008194332920608],[962,866,.37580301677160466],[962,867,.19024874552861262],[962,868,.011245575393110812],[963,866,.05231298976932004],[963,867,.23017401181136463],[963,868,.40175554736854613],[963,869,.2536595659979476],[963,870,.07679940668774121],[964,869,.16706057585212106],[964,870,.35303258747063304],[964,871,.3251768586309606],[964,872,.14116418004635392],[965,871,.10550294433561781],[965,872,.28424844668945237],[965,873,.38249269088982873],[965,874,.2036626805762719],[965,875,.02684871916582402],[966,873,.03836058116912999],[966,874,.21480488879977247],[966,875,.389260042863657],[966,876,.27095452974310497],[966,877,.09504101254228686],[967,876,.1502807743955375],[967,877,.3328577086192332],[967,878,.3421239629983485],[967,879,.15918522100542254],[968,878,.08474515454977341],[968,879,.25820758590913884],[968,880,.3938397310124852],[968,881,.22523159171338067],[968,882,.05190695217080459],[969,880,.015820211753405387],[969,881,.19007905592596833],[969,882,.36921246833932636],[969,883,.2980889913883655],[969,884,.12132017371569158],[970,883,.1247775639085626],[970,884,.3015570552958629],[970,885,.36552163552482225],[970,886,.18684713857492927],[970,887,.014284415706242481],[971,885,.055013622481818666],[971,886,.2263705108609403],[971,887,.39186593267986564],[971,888,.2561333080985603],[971,889,.08592049273991473],[972,888,.1575841200944441],[972,889,.3370827060887002],[972,890,.33284859953655166],[972,891,.15390042438231766],[973,890,.08972988049108406],[973,891,.2590326783958039],[973,892,.38812639016604245],[973,893,.22348813860080616],[973,894,.054161074977768404],[974,892,.017081968749935856],[974,893,.18740927170107446],[974,894,.3625874079443392],[974,895,.2990263270079478],[974,896,.12613079428882987],[975,895,.11819045745461297],[975,896,.28905735771716573],[975,897,.36789499357104777],[975,898,.19628130377264577],[975,899,.02735424128922767],[976,897,.04494375361325131],[976,898,.21330043570426716],[976,899,.37902147922066165],[976,900,.2697531768133337],[976,901,.10241904377888808],[977,900,.14130067843136315],[977,901,.3150246804904708],[977,902,.3480110183643501],[977,903,.1725701388645175],[977,904,.005966983373903607],[978,902,.06884101502859519],[978,903,.23351128359258333],[978,904,.3898863909020141],[978,905,.24593198700119934],[978,906,.08224765045066],[979,905,.1597942440306211],[979,906,.3346851109670727],[979,907,.3285973743088808],[979,908,.15444027476874822],[980,907,.08792661347585409],[980,908,.2508895640647832],[980,909,.38533070676895603],[980,910,.22893712756876922],[980,911,.06583953763953361],[981,909,.01060737785460527],[981,910,.17530908392596897],[981,911,.34707093920704996],[981,912,.3101853041457825],[981,913,.1404924603408273],[982,912,.1016482122325276],[982,913,.2640331008343238],[982,914,.3757885914855772],[982,915,.21658719088481612],[982,916,.05379076081392352],[983,914,.023321537452804155],[983,915,.1869789080592518],[983,916,.35433193126746176],[983,917,.2960976478285003],[983,918,.13047091456929613],[984,917,.11086010315035294],[984,918,.272590889791831],[984,919,.3683410258652817],[984,920,.20801518542415245],[984,921,.04616290894518408],[985,919,.03202626907959427],[985,920,.1942489952348069],[985,921,.35801621736570555],[985,922,.2871844809716754],[985,923,.12448425960359358],[986,922,.11614980664040801],[986,923,.2769245860037902],[986,924,.3634503371272694],[986,925,.20337777894188264],[986,926,.04278533591281287],[987,924,.036633170664026604],[987,925,.19735437260885233],[987,926,.3585975660673821],[987,927,.28298312203941667],[987,928,.12237172260813765],[988,927,.11761764880185657],[988,928,.2769347836061358],[988,929,.3613222869658947],[988,930,.20269252495682932],[988,931,.04352084243134597],[989,929,.03715658569409518],[989,930,.19646584076452728],[989,931,.3563193376763676],[989,932,.28325914825402143],[989,933,.12401877287718965],[990,932,.11535841088563661],[990,933,.2726772185957825],[990,934,.36193002492598775],[990,935,.2058724789923987],[990,936,.04828585408934835],[991,934,.03368059076582972],[991,935,.19166681871807822],[991,936,.35120102320155516],[991,937,.2879669101334489],[991,938,.12934311950798513],[992,937,.10947528483272252],[992,938,.2643619456949593],[992,939,.36503164238003943],[992,940,.21273290367631378],[992,941,.05704255868679827],[993,939,.026351338857843194],[993,940,.18296002570453515],[993,941,.3430562989307297],[993,942,.29724916938947604],[993,943,.13830626997954892],[994,942,.10006782116457263],[994,943,.2523219642979947],[994,944,.3701807952606593],[994,945,.22297333198451888],[994,946,.06976592160365215],[995,944,.015392306252147629],[995,945,.17030051412165803],[995,946,.33152253946088156],[995,947,.31147369956054877],[995,948,.1509473916728322],[996,947,.087196881644584],[996,948,.2369586950063475],[996,949,.376718339613223],[996,950,.2345765114615184],[996,951,.08521591343298078],[997,949,.0011357385555340561],[997,950,.15263475001807864],[997,951,.311827742306229],[997,952,.32860504822914505],[997,953,.16942021655341175],[997,954,.016626147439510436],[998,952,.07024774813594223],[998,953,.2212622403680772],[998,954,.36621398307130515],[998,955,.2523140266095425],[998,956,.10329850546808812],[999,955,.13345393361930616],[999,956,.2868146645965228],[999,957,.3438149621043634],[999,958,.19052159754051476],[999,959,.038598535306774456],[1e3,957,.04874340776161587],[1e3,958,.20027433884645776],[1e3,959,.35045072214288214],[1e3,960,.2752172040116266],[1e3,961,.1246081801436533],[1001,960,.11153410463061227],[1001,961,.25968030157128735],[1001,962,.3589611456155988],[1001,963,.21376355164890676],[1001,964,.06462574300561937],[1002,962,.024112239164856285],[1002,963,.1744379670887302],[1002,964,.32884307142135794],[1002,965,.3038963549633426],[1002,966,.14989396525089382],[1002,967,.002787631885767016],[1003,965,.08652179776851913],[1003,966,.23158274748299973],[1003,967,.37014802862444746],[1003,968,.23660182809114255],[1003,969,.09233857620429504],[1004,968,.14320871996140178],[1004,969,.2949268298641504],[1004,970,.33370967770704096],[1004,971,.1821563205430922],[1004,972,.03341416685633306],[1005,970,.05691996613850173],[1005,971,.2048164607341282],[1005,972,.34996958396767003],[1005,973,.26846185022737096],[1005,974,.12203613352843197],[1006,973,.11270360292617912],[1006,974,.2573174820670815],[1006,975,.35551075517876596],[1006,976,.21342439841857963],[1006,977,.06808655521031844],[1007,975,.02300584415020569],[1007,976,.1693741701851818],[1007,977,.31909197071849676],[1007,978,.3064750144925845],[1007,979,.1569666027177789],[1007,980,.01237576860780718],[1008,978,.07918600624195261],[1008,979,.22224585329482],[1008,980,.36060022658704466],[1008,981,.24542280629144228],[1008,982,.10372340547250797],[1009,981,.13025049048804305],[1009,982,.2755544084078468],[1009,983,.34173289952302016],[1009,984,.19757209548510224],[1009,985,.052414383405106256],[1010,983,.04055057399599624],[1010,984,.18602861646793578],[1010,985,.3325126760154172],[1010,986,.28836807114447566],[1010,987,.1417402962688462],[1010,988,.0007268068329768394],[1011,986,.0921230324039655],[1011,987,.23132424535108578],[1011,988,.3651955312519228],[1011,989,.23251096307120944],[1011,990,.09383068210249161],[1012,989,.1395300348660987],[1012,990,.2846106560560243],[1012,991,.33325384799782276],[1012,992,.18901293891606955],[1012,993,.045352651706964286],[1013,991,.0492531143811913],[1013,992,.19272260635298227],[1013,993,.33561458168523745],[1013,994,.27986377343343843],[1013,995,.13637852619084528],[1014,994,.09650852938196901],[1014,995,.2338020594070448],[1014,996,.36193613166585775],[1014,997,.22898317334607854],[1014,998,.09193468643195023],[1015,996,.002457496874436509],[1015,997,.14093777570167637],[1015,998,.28368384860268375],[1015,999,.33027760738271117],[1015,1e3,.1884400273628213],[1015,1001,.046968846655108074],[1016,999,.04899295849310335],[1016,1e3,.19034003312195327],[1016,1001,.3313219755276299],[1016,1002,.28105052006571385],[1016,1003,.13948843868730657],[1016,1004,.0023949943264103815],[1017,1002,.09296476581718328],[1017,1003,.22852898102309294],[1017,1004,.35981389159869226],[1017,1005,.23289594529521537],[1017,1006,.09793041579114306],[1018,1005,.13381394889325862],[1018,1006,.27358691892030107],[1018,1007,.33460745416509985],[1018,1008,.1955825556102765],[1018,1009,.05665143264068217],[1019,1007,.040361378819567154],[1019,1008,.17925977203170015],[1019,1009,.31806447498945245],[1019,1010,.2909077306146313],[1019,1011,.1516962543781077],[1019,1012,.01525050343287846],[1020,1010,.08150854362929537],[1020,1011,.21698349128246774],[1020,1012,.3497669475500838],[1020,1013,.24583808157633427],[1020,1014,.11136370502634059],[1021,1013,.1194990282921764],[1021,1014,.25479878825131264],[1021,1015,.34346022054644576],[1021,1016,.20933239464254857],[1021,1017,.07400664151417581],[1022,1015,.023670383811016393],[1022,1016,.1594303860158249],[1022,1017,.29640289279632487],[1022,1018,.3088876485347881],[1022,1019,.17249814489158258],[1022,1020,.03643709112995095],[1023,1018,.062217701784737935],[1023,1019,.19815982330648652],[1023,1020,.3337745723213922],[1023,1021,.3700921432339217],[1023,1022,.3700921432339217]];function c(){for(var e=r.buffer([1024,1024]),t=0;t<u.length;t++){var n=u[t];e.set(n[2],n[0],n[1])}return e.toTensor()}function l(e,t,n){return r.div(r.sub(e,n),t)}function h(e){var t=new o(e.length/2),n=t.createComplexArray();return t.inverseTransform(n,e),t.fromComplexArray(n)}function f(e,t){if(e.length!==t.length)return console.error("Array lengths must be equal to add: ".concat(e.length,", ").concat(e.length)),null;for(var n=new Float32Array(e.length),r=0;r<e.length;r++)n[r]=e[r]+t[r];return n}var d=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e-8,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck2(this,n),(e=t.call(this,a)).epsilon=r,e.layerConfig=a,e.supportsMasking=!0,e}return _createClass2(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[1],e[2],e[3]]}},{key:"call",value:function(e){var t=this;return r.tidy((function(){var n=e;Array.isArray(n)&&(n=n[0]);var a=r.mean(r.square(n),[3],!0);return r.mul(n,r.rsqrt(r.add(a,t.epsilon)))}))}},{key:"getClassName",value:function(){return"PixelNorm"}}]),n}(r.layers.Layer);function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e-8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new d(e,t)}var m=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return _classCallCheck2(this,n),(e=t.call(this,i)).kernelH=r,e.kernelW=a,e.layerConfig=i,e.supportsMasking=!0,e}return _createClass2(n,[{key:"computeOutputShape",value:function(e){return[e[0],2*(this.kernelH-1)+e[1],2*(this.kernelW-1)+e[2],e[3]]}},{key:"call",value:function(e){var t=e;Array.isArray(t)&&(t=t[0]);var n=this.kernelH-1,a=this.kernelW-1;return r.pad(t,[[0,0],[n,n],[a,a],[0,0]])}},{key:"getClassName",value:function(){return"InitialPad"}}]),n}(r.layers.Layer),v=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return _classCallCheck2(this,n),(e=t.call(this,{})).scale=r,e.supportsMasking=!0,e}return _createClass2(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.scale*e[1],this.scale*e[2],e[3]]}},{key:"call",value:function(e){var t=this;return r.tidy((function(){var n=e;Array.isArray(n)&&(n=n[0]);var a=r.tile(n,[Math.pow(t.scale,2),1,1,1]);return r.batchToSpaceND(a,[t.scale,t.scale],[[0,0],[0,0]])}))}},{key:"getClassName",value:function(){return"BoxUpscale"}}]),n}(r.layers.Layer);function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return new v(e)}var y=function(){function e(t){_classCallCheck2(this,e),this.nn=r.sequential(),this.nLatents=256,this.nPitches=61,this.minMidiPitch=24,this.maxMidiPitch=84,this.midiPitches=this.maxMidiPitch-this.minMidiPitch+1,this.checkpointURL=t}var t;return _createClass2(e,[{key:"initialize",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.d.now(),e.next=3,Object(i.a)(this.checkpointURL+"/weights_manifest.json").then((function(e){return e.json()})).then((function(e){return r.io.loadWeights(e,o.checkpointURL)}));case 3:n=e.sent,r.tidy((function(){for(var e in n)if(e.includes("kernel")){var i=n[e];n[e]=r.mul(i,r.sqrt(2/(n[e].shape[0]*n[e].shape[1]*n[e].shape[2]))),i.dispose()}o.build(n),o.initialized=!0,a.logWithDuration("Initialized model",t,"GANSynth")})),Object.keys(n).map((function(e){return n[e].dispose()}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"dispose",value:function(){this.initialized&&(this.nn.dispose(),this.initialized=!1)}},{key:"isInitialized",value:function(){return this.initialized}},{key:"build",value:function(e){var t=this;r.tidy((function(){var n={filters:256,kernelSize:[2,16],strides:[1,1],activation:"linear",useBias:!0,padding:"valid",dilationRate:[1,1],trainable:!1};t.nn.add(p(1e-8,{inputShape:[1,1,t.nLatents+t.nPitches]})),t.nn.add(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new m(e,t,n)}(2,16)),t.nn.add(r.layers.conv2d(n)),t.nn.add(r.layers.leakyReLU({alpha:.2})),t.nn.add(p()),n.padding="same",n.kernelSize=[3,3],t.nn.add(r.layers.conv2d(n)),t.nn.add(r.layers.leakyReLU({alpha:.2})),t.nn.add(p());for(var a=[256,256,256,128,64,32],i=0;i<a.length;i++)t.nn.add(g(2)),n.filters=a[i],t.nn.add(r.layers.conv2d(n)),t.nn.add(r.layers.leakyReLU({alpha:.2})),t.nn.add(p()),t.nn.add(r.layers.conv2d(n)),t.nn.add(r.layers.leakyReLU({alpha:.2})),t.nn.add(p());n.filters=2,n.kernelSize=[1,1],n.activation="tanh",t.nn.add(r.layers.conv2d(n)),t.setWeights(e)}))}},{key:"setWeights",value:function(e){function t(t){var n=e[t];if(void 0===n)throw Error("Variable not found: "+t);return n}var n="Generator/progressive_gan_generator/progressive_gan_block_",r=[t(n+"1/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"1/conv0/bias/ExponentialMovingAverage"),t(n+"1/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"1/conv1/bias/ExponentialMovingAverage"),t(n+"2/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"2/conv0/bias/ExponentialMovingAverage"),t(n+"2/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"2/conv1/bias/ExponentialMovingAverage"),t(n+"3/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"3/conv0/bias/ExponentialMovingAverage"),t(n+"3/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"3/conv1/bias/ExponentialMovingAverage"),t(n+"4/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"4/conv0/bias/ExponentialMovingAverage"),t(n+"4/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"4/conv1/bias/ExponentialMovingAverage"),t(n+"5/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"5/conv0/bias/ExponentialMovingAverage"),t(n+"5/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"5/conv1/bias/ExponentialMovingAverage"),t(n+"6/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"6/conv0/bias/ExponentialMovingAverage"),t(n+"6/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"6/conv1/bias/ExponentialMovingAverage"),t(n+"7/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"7/conv0/bias/ExponentialMovingAverage"),t(n+"7/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"7/conv1/bias/ExponentialMovingAverage"),t(n+"7/to_rgb/conv2d/kernel/ExponentialMovingAverage"),t(n+"7/to_rgb/bias/ExponentialMovingAverage")];this.nn.setWeights(r)}},{key:"predict",value:function(e,t){return this.nn.predict(e,{batchSize:t})}},{key:"randomSample",value:function(e){var t=this;return r.tidy((function(){var n=r.randomNormal([1,t.nLatents],0,1,"float32"),a=r.tensor1d([e-t.minMidiPitch],"int32"),i=r.oneHot(a,t.midiPitches),o=r.concat([n,i],1).expandDims(1).expandDims(1);return t.predict(o,1)}))}},{key:"specgramsToAudio",value:function(e){return(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.tidy((function(){var e,n=r.slice(t,[0,0,0,0],[1,-1,-1,1]).reshape([1,128,1024]),a=(e=n,r.tidy((function(){var t=c().expandDims(0),n=l(e,.0661371661726,.113718730221),a=r.exp(n),i=r.matMul(a,t);return r.sqrt(i)}))),i=function(e){return r.tidy((function(){var t=c().expandDims(0),n=l(e,.8,0),a=r.cumsum(r.mul(n,Math.PI),1);return r.matMul(a,t)}))}(r.slice(t,[0,0,0,1],[1,-1,-1,1]).reshape([1,128,1024])),o=a.mul(r.cos(i)),s=r.reverse(o.slice([0,0,0],[1,128,1023]),2);o=r.concat([o,s],2);var u=a.mul(r.sin(i)),h=r.reverse(u.slice([0,0,0],[1,128,1023]),2);return[o,u=r.concat([u,r.mul(h,-1)],2)]})),e.next=3,function(e,t){for(var n=r.tidy((function(){var n=r.concat([e,t],0).expandDims(3);return n=r.pad(n,[[0,0],[0,0],[1,0],[0,0]]),r.batchToSpaceND(n,[1,2],[[0,0],[0,0]]).reshape([128,4096])})),a=n.dataSync(),i=[],o=0;o<128;o++)i[o]=a.slice(4096*o,4096*(o+1));return n.dispose(),i}(n[0],n[1]);case 3:return a=e.sent,e.next=6,function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(e,t){for(var n=e.length,r=e[0].length/2,a=t.winLength||r,i=t.hopLength||Math.floor(a/4),o=t.center||!1,u=Object(s.b)(a),c=0;c<u.length;c++)u[c]=u[c]/1.5;u=Object(s.h)(u,r);for(var l=r+i*(n-1),d=new Float32Array(l),p=0;p<n;p++){var m=p*i,v=h(e[p]);v=f(v=Object(s.a)(v,u),d.slice(m,m+r)),d.set(v,m)}var g=0,y=l;return o?(g=r/2,y=d.length-r/2):(g=l-64e3,y=d.length-g),d.slice(g,y)}(t,{nFFt:2048,winLength:2048,hopLength:512,sampleRate:16e3,center:!1}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(a);case 6:return i=e.sent,e.abrupt("return",(n.forEach((function(e){return e.dispose()})),i));case 8:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})(e);var t}}]),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"OnsetsAndFrames",(function(){return c}));var r=n(2),a=n(20),i=n(13),o=n(14),s=n(9);function u(e,t,n){return 1===e.shape[0]?e:r.tidy((function(){var a=e.slice([0,0],[1,t]),i=n%t;i<=3&&(i+=t);var o=e.slice([e.shape[0]-1,e.shape[1]-i],[-1,-1]),s=[a,o];if(e.shape[0]>2){var u=e.shape[0]-2;s=[a,e.slice([1,3],[u,t]).as3D(1,u*t,-1),o]}return r.concat(s,1)}))}var c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;_classCallCheck2(this,e),this.checkpointURL=t,this.chunkLength=n}var t,n,c,f,d;return _createClass2(e,[{key:"initialize",value:(d=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dispose(),t=o.d.now(),e.next=4,Object(o.a)(this.checkpointURL+"/weights_manifest.json").then((function(e){return e.json()})).then((function(e){return r.io.loadWeights(e,a.checkpointURL)}));case 4:n=e.sent,this.build(n),Object.keys(n).map((function(e){return n[e].dispose()})),this.initialized=!0,i.logWithDuration("Initialized model",t,"O&F");case 6:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"dispose",value:function(){this.initialized&&(this.onsetsCnn.dispose(),this.onsetsRnn.dispose(),this.activationCnn.dispose(),this.frameRnn.dispose(),this.velocityCnn.dispose(),this.initialized=!1)}},{key:"isInitialized",value:function(){return this.initialized}},{key:"transcribeFromMelSpec",value:(f=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,u,c,l,h,f,d,p=this,m=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=m.length>1&&void 0!==m[1]?m[1]:4,this.isInitialized()||this.initialize(),a=o.d.now(),i.log("Computing onsets, frames, and velocities...","O&F",20),u=r.tidy((function(){var e=function(e,t){var n=Math.ceil(e.length/t),a=e.length%t,i=0;if(n>1&&a>0&&a<=3&&(n-=1,i=a,a=0),1===n)return r.tensor2d(e).expandDims(0);var o,s=t+6,u=r.tensor2d(e.slice(0,s)).expandDims(0),c=r.tensor2d(e.slice(e.length-s)).expandDims(0);if(2===n)return r.concat([u,c],0);o=a?r.tensor2d(e).pad([[0,t-a],[0,0]]).as3D(n,t,-1):r.tensor2d(e.slice(0,e.length-i)).as3D(n,t,-1);var l=r.slice(o,[0,t-3],[n-2,-1]),h=r.slice(o,[2,0],[-1,3]),f=r.concat([l,o.slice(1,n-2),h],1);return r.concat([u,f,c],0)}(t,p.chunkLength);return p.processBatches(e,p.chunkLength,t.length,n)})),c=_slicedToArray2(u,3),l=c[0],h=c[1],f=c[2],i.log("Converting to NoteSequence...","O&F",20),d=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a){var i,o,u,c,l,h,f,d,p,m,v,g,y,_,b,k,w,x,C=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=function(e,t,n){c[e]?h[e]||(f(e,t),c[e]=t+1,l[e]=n):(c[e]=t+1,l[e]=n)},f=function(e,t){u.notes.push(s.a.Note.create({pitch:e+21,startTime:.032*(c[e]-1),endTime:.032*t,velocity:l[e]})),c[e]=0},i=C.length>3&&void 0!==C[3]?C[3]:.5,o=C.length>4&&void 0!==C[4]?C[4]:.5,u=s.a.create(),c=new Uint32Array(88),l=new Uint8Array(88),h=new Uint8Array(88),p=r.tidy((function(){var e=r.greater(n,i),s=r.greater(t,o);return e=e.pad([[0,1],[0,0]]),s=s.pad([[0,1],[0,0]]),a=a.pad([[0,1],[0,0]]),[s=r.logicalOr(s,e),e,a]})),e.next=9,Promise.all(p.map((function(e){return e.data()})));case 9:for(m=e.sent,v=_slicedToArray2(m,3),g=v[0],y=v[1],_=v[2],p.forEach((function(e){return e.dispose()})),b=t.shape[0],k=0;k<b+1;++k){for(w=0;w<88;++w)y[x=88*k+w]?d(w,k,_[x]):!g[x]&&c[w]&&f(w,k);h=y.slice(88*k,88*(k+1))}return e.abrupt("return",(u.totalTime=.032*b,u));case 18:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()(l,h,f),e.abrupt("return",(d.then((function(){l.dispose(),h.dispose(),f.dispose(),i.logWithDuration("Transcribed from mel spec",a,"O&F")})),d));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"transcribeFromAudioBuffer",value:(c=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,s,u=this,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:4,r=o.d.now(),s=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(a.j)(t);case 2:return n=e.sent,e.abrupt("return",Object(a.i)(Object(a.f)(n,{sampleRate:16e3,hopLength:512,nMels:229,nFft:2048,fMin:30})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(t),e.abrupt("return",(s.then((function(){return i.logWithDuration("Converted audio to mel spec",r,"O&F",20)})),s.then((function(e){return u.transcribeFromMelSpec(e.map((function(e){return Array.from(e)}),n))}))));case 3:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"transcribeFromAudioFile",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(a.d)(t);case 2:return n=e.sent,e.abrupt("return",this.transcribeFromAudioBuffer(n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"transcribeFromAudioURL",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(a.e)(t);case 2:return n=e.sent,e.abrupt("return",this.transcribeFromAudioBuffer(n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"processBatches",value:function(e,t,n,a){var i,o,s,c=this,l=function(e){return[c.onsetsCnn.predict(e,a),c.activationCnn.predict(e,a),c.velocityCnn.predict(e,a)]};if(1===e.shape[0]){var h=_slicedToArray2(l(e.expandDims(-1)),3);i=h[0],o=h[1],s=h[2]}else{for(var f=l(e.expandDims(-1)),d=[],p=0;p<3;++p)d.push(u(f[p],t,n));i=d[0],o=d[1],s=d[2]}var m=this.onsetsRnn.predict(i,this.chunkLength);i.dispose();var v=r.concat3d([m,o],-1);o.dispose();var g=this.frameRnn.predict(v,this.chunkLength),y=r.clipByValue(s,0,1).mul(r.scalar(80)).add(r.scalar(10)).toInt();return s.dispose(),[g.squeeze(),m.squeeze(),y.squeeze()]}},{key:"build",value:function(e){var t=this;r.tidy((function(){t.onsetsCnn=new l,t.onsetsCnn.setWeights(e,"onsets"),t.onsetsRnn=new h([null,t.onsetsCnn.outputShape[2]]),t.onsetsRnn.setWeights(e,"onsets","onset_probs"),t.activationCnn=new l("sigmoid"),t.activationCnn.setWeights(e,"frame","activation_probs"),t.frameRnn=new h([null,176]),t.frameRnn.setWeights(e,"frame","frame_probs"),t.velocityCnn=new l("linear"),t.velocityCnn.setWeights(e,"velocity","onset_velocities")}))}}]),e}(),l=function(){function e(t){_classCallCheck2(this,e),this.nn=r.sequential();var n={filters:48,kernelSize:[3,3],activation:"linear",useBias:!1,padding:"same",dilationRate:[1,1],inputShape:[null,229,1],trainable:!1},a={scale:!1,trainable:!1};this.nn.add(r.layers.conv2d(n)),this.nn.add(r.layers.batchNormalization(a)),this.nn.add(r.layers.activation({activation:"relu"})),n.inputShape=null,this.nn.add(r.layers.conv2d(n)),this.nn.add(r.layers.batchNormalization(a)),this.nn.add(r.layers.activation({activation:"relu"})),this.nn.add(r.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]})),n.filters=96,this.nn.add(r.layers.conv2d(n)),this.nn.add(r.layers.batchNormalization(a)),this.nn.add(r.layers.activation({activation:"relu"})),this.nn.add(r.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]}));var i=this.nn.outputShape;this.nn.add(r.layers.reshape({targetShape:[i[1],i[2]*i[3]]})),this.nn.add(r.layers.dense({units:768,activation:"relu",trainable:!1})),t&&this.nn.add(r.layers.dense({units:88,activation:t,trainable:!1})),this.outputShape=this.nn.outputShape}return _createClass2(e,[{key:"dispose",value:function(){this.nn.dispose()}},{key:"predict",value:function(e,t){return this.nn.predict(e,{batchSize:t})}},{key:"setWeights",value:function(e,t,n){function r(t){var n=e[t];if(void 0===n)throw Error("Variable not found: "+t);return n}var a=[r(t+"/conv0/weights"),r(t+"/conv0/BatchNorm/beta"),r(t+"/conv0/BatchNorm/moving_mean"),r(t+"/conv0/BatchNorm/moving_variance"),r(t+"/conv1/weights"),r(t+"/conv1/BatchNorm/beta"),r(t+"/conv1/BatchNorm/moving_mean"),r(t+"/conv1/BatchNorm/moving_variance"),r(t+"/conv2/weights"),r(t+"/conv2/BatchNorm/beta"),r(t+"/conv2/BatchNorm/moving_mean"),r(t+"/conv2/BatchNorm/moving_variance"),r(t+"/fc_end/weights"),r(t+"/fc_end/biases")];n&&(a=a.concat([r("".concat(t,"/").concat(n,"/weights")),r("".concat(t,"/").concat(n,"/biases"))])),this.nn.setWeights(a)}}]),e}(),h=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:384;_classCallCheck2(this,e),this.dense=r.sequential(),this.units=n,this.lstm=function(){var e=r.layers.lstm({inputShape:t,units:n,returnSequences:!0,recurrentActivation:"sigmoid",returnState:!0,kernelInitializer:"zeros",recurrentInitializer:"zeros",biasInitializer:"zeros",trainable:!1}),a=[r.input({shape:t}),r.input({shape:[n]}),r.input({shape:[n]})],i=e.apply(a);return r.model({inputs:a,outputs:i})}(),this.dense.add(r.layers.dense({inputShape:[null,n],units:88,activation:"sigmoid",trainable:!1}))}return _createClass2(e,[{key:"dispose",value:function(){this.lstm.dispose(),this.dense.dispose()}},{key:"setWeights",value:function(e,t,n){var a=this;function i(t){var n=e[t];if(void 0===n)throw Error("Variable not found: "+t);return n}var o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=r.split(e,4,-1),a=_slicedToArray2(n,4),i=a[0],o=a[1],s=a[2],u=a[3];return r.concat([i,s.add(r.scalar(t)),o,u],-1)},s="cudnn_lstm/rnn/multi_rnn_cell/cell_0/cudnn_compatible_lstm_cell";this.lstm.setWeights(function(e){return r.split(o(e),[e.shape[0]-a.units,a.units])}(i("".concat(t,"/").concat(s,"/kernel"))).concat(o(i("".concat(t,"/").concat(s,"/bias")),1))),this.dense.setWeights([i("".concat(t,"/").concat(n,"/weights")),i("".concat(t,"/").concat(n,"/biases"))])}},{key:"predict",value:function(e,t){var n=this;return r.tidy((function(){return n.predictImpl(e,t)}))}},{key:"predictImpl",value:function(e,t){for(var n=Math.ceil(e.shape[1]/t),a=[r.zeros([1,this.units]),r.zeros([1,this.units])],i=[],o=0;o<n;++o){var s=e.slice([0,o*t],[-1,o<n-1?t:-1]),u=this.lstm.predict([s,a[0],a[1]]);i.push(this.dense.predict(u[0])),a=u.slice(1)}return 1===i.length?i[0]:r.concat3d(i,1)}}]),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"Coconet",(function(){return h}));var r=n(0),a=n(14),i=n(13),o=n(15),s=n(9),u=/iPad|iPhone|iPod/.test(navigator.userAgent),c={useSoftmaxLoss:!0,batchNormVarianceEpsilon:1e-7,numInstruments:4,numFilters:128,numLayers:33,numRegularConvLayers:0,dilation:[[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32]],layers:null,interleaveSplitEveryNLayers:16,numPointwiseSplits:4},l=function(){function e(t,n){_classCallCheck2(this,e),this.residualPeriod=2,this.outputForResidual=null,this.residualCounter=-1,this.rawVars=null,this.spec=t,this.rawVars=n}return _createClass2(e,[{key:"dispose",value:function(){null!==this.rawVars&&r.gb(this.rawVars),this.outputForResidual&&this.outputForResidual.dispose()}},{key:"predictFromPianoroll",value:function(e,t){var n=this;return r.Hb((function(){for(var r=n.getConvnetInput(e,t),a=n.spec.layers.length,i=0;i<a;i++){n.residualCounter+=1,n.residualSave(r);var o=null;n.spec.interleaveSplitEveryNLayers&&i>0&&i<a-2&&i%(n.spec.interleaveSplitEveryNLayers+1)==0&&(o=n.spec.numPointwiseSplits),r=n.applyConvolution(r,n.spec.layers[i],i,i>=n.spec.numRegularConvLayers,o),r=n.applyResidual(r,0===i,i===a-1,i),r=n.applyActivation(r,n.spec.layers[i],i),r=n.applyPooling(r,n.spec.layers[i],i)}return n.computePredictions(r)}))}},{key:"computePredictions",value:function(e){return this.spec.useSoftmaxLoss?e.transpose([0,1,3,2]).softmax().transpose([0,1,3,2]):e.sigmoid()}},{key:"residualReset",value:function(){this.outputForResidual=null,this.residualCounter=0}},{key:"residualSave",value:function(e){this.residualCounter%this.residualPeriod==1&&(this.outputForResidual=e)}},{key:"applyResidual",value:function(e,t,n,r){return null==this.outputForResidual?e:this.outputForResidual.shape[this.outputForResidual.shape.length-1]!==e.shape[e.shape.length-1]?(this.residualReset(),e):(this.residualCounter%this.residualPeriod==0&&(t||n||(e=e.add(this.outputForResidual))),e)}},{key:"getVar",value:function(e,t){return this.rawVars["model/conv".concat(t,"/").concat(e)]}},{key:"getSepConvVar",value:function(e,t){return this.rawVars["model/conv".concat(t,"/SeparableConv2d/").concat(e)]}},{key:"getPointwiseSplitVar",value:function(e,t,n){return this.rawVars["model/conv".concat(t,"/split_").concat(t,"_").concat(n,"/").concat(e)]}},{key:"applyConvolution",value:function(e,t,n,a,i){if(null==t.filters)return e;var o=t.filters,s=t.convStride||1,u=t.convPad?t.convPad.toLowerCase():"same",c=null;if(a){var l=this.getSepConvVar("depthwise_weights",n);if(i){c=r.eb(e,l,[s,s],u,"NHWC",t.dilation);for(var h=r.Cb(c,i,c.rank-1),f=[],d=0;d<i;d++){var p=o[3]/i,m=this.getPointwiseSplitVar("kernel",n,d),v=this.getPointwiseSplitVar("bias",n,d),g=r.mb(h[d].reshape([-1,p]),m,!1,!1),y=r.W(g,v);f.push(y.reshape([h[d].shape[0],h[d].shape[1],h[d].shape[2],p]))}c=r.bb(f,c.rank-1)}else{var _=this.getSepConvVar("pointwise_weights",n),b=this.getSepConvVar("biases",n);c=r.zb(e,l,_,[s,s],u,t.dilation,"NHWC").add(b)}}else{var k=this.getVar("weights",n),w=t.convStride||1,x=t.convPad?t.convPad.toLowerCase():"same";c=r.cb(e,k,[w,w],x,"NHWC",[1,1])}return this.applyBatchnorm(c,n)}},{key:"applyBatchnorm",value:function(e,t){var n=this,a=this.getVar("gamma",t),i=this.getVar("beta",t),o=this.getVar("popmean",t),s=this.getVar("popvariance",t);if(u){var c=s.arraySync()[0][0][0],l=r.Gb(c.map((function(e){return Math.sqrt(e+n.spec.batchNormVarianceEpsilon)})));return e.sub(o).mul(a.div(l)).add(i)}return r.Y(e,r.Db(o),r.Db(s),r.Db(i),r.Db(a),this.spec.batchNormVarianceEpsilon)}},{key:"applyActivation",value:function(e,t,n){return"identity"===t.activation?e:e.relu()}},{key:"applyPooling",value:function(e,t,n){if(null==t.pooling)return e;var a=t.pooling,i=t.poolPad?t.poolPad.toLowerCase():"same";return r.ob(e,[a[0],a[1]],[a[0],a[1]],i)}},{key:"getConvnetInput",value:function(e,t){return e=r.yb(1,"float32").sub(t).mul(e),t=r.yb(1,"float32").sub(t),e.concat(t,3)}}]),e}(),h=function(){function e(t){_classCallCheck2(this,e),this.spec=null,this.initialized=!1,this.checkpointURL=t,this.spec=c}var t,n,u,h;return _createClass2(e,[{key:"initialize",value:(h=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.dispose(),t=a.d.now(),this.instantiateFromSpec(),e.next=5,Object(a.a)(this.checkpointURL+"/weights_manifest.json").then((function(e){return e.json()})).then((function(e){return r.kb.loadWeights(e,o.checkpointURL)}));case 5:n=e.sent,this.convnet=new l(this.spec,n),this.initialized=!0,i.logWithDuration("Initialized model",t,"Coconet");case 7:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"dispose",value:function(){this.convnet&&this.convnet.dispose(),this.initialized=!1}},{key:"isInitialized",value:function(){return this.initialized}},{key:"instantiateFromSpec",value:function(){this.spec.layers=[],this.spec.layers.push({filters:[3,3,2*this.spec.numInstruments,this.spec.numFilters]});for(var e=0;e<this.spec.numLayers-3;e++)this.spec.layers.push({filters:[3,3,this.spec.numFilters,this.spec.numFilters],dilation:this.spec.dilation?this.spec.dilation[e]:null});this.spec.layers.push({filters:[2,2,this.spec.numFilters,this.spec.numFilters]}),this.spec.layers.push({filters:[2,2,this.spec.numFilters,this.spec.numInstruments],activation:"identity"})}},{key:"infill",value:(u=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a,u,c,l,h,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.assertIsRelativeQuantizedSequence(t),0!==t.notes.length){e.next=2;break}throw new Error("NoteSequence ".concat(t.id," does not have any notes to infill."));case 2:return a=t.totalQuantizedSteps||t.notes[t.notes.length-1].quantizedEndStep,u=function(e,t){var n=r.Hb((function(){return r.Nb([t,46,4]).arraySync()}));return e.notes.forEach((function(r){var a=r.pitch-36,o=r.quantizedStartStep,s=r.quantizedEndStep-r.quantizedStartStep,u=r.instrument;if(u<0||u>=4)i.log("Found invalid voice ".concat(u,". Skipping."),"Coconet",5);else{if(o+s>t)throw new Error("NoteSequence ".concat(e.id," has notes that are longer than the sequence's\n          totalQuantizedSteps."));for(var c=o;c<o+s;c++)n[c][a][u]=1}})),r.Gb([n])}(t,a),l=.99,h=96,n?(h=n.numIterations||h,l=n.temperature||l,c=this.getCompletionMaskFromInput(n.infillMask,u)):c=this.getCompletionMask(u),e.next=7,this.run(u,h,l,c);case 7:return f=e.sent,d=function(e,t){for(var n=r.Hb((function(){return e.reshape([t,46,4]).arraySync()})),a=s.a.create(),i=[],o=0;o<t;o++)for(var u=0;u<46;u++)for(var c=0;c<4;c++)if(1===n[o][u][c]){var l=s.a.Note.create({pitch:u+36,instrument:c,quantizedStartStep:o,quantizedEndStep:o+1});i.push(l)}return a.notes=i,a.totalQuantizedSteps=i[i.length-1].quantizedEndStep,a.quantizationInfo={stepsPerQuarter:4},a}(f,a),e.abrupt("return",(u.dispose(),f.dispose(),c.dispose(),d));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"run",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.gibbs(t,n,r,a));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a){return n.apply(this,arguments)})},{key:"getCompletionMaskFromInput",value:function(e,t){if(e){for(var n=r.Z([t.shape[1],4]),a=0;a<e.length;a++)n.set(1,e[a].step,e[a].voice);return r.Hb((function(){return n.toTensor().expandDims(1).tile([1,46,1]).expandDims(0)}))}return this.getCompletionMask(t)}},{key:"getCompletionMask",value:function(e){return r.Hb((function(){var t=e.sum(2,!0).equal(r.yb(0,"float32"));return r.ab(t,"float32").add(r.Ob(e))}))}},{key:"gibbs",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a,i){var o,s,u,c,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=r.yb(n,"float32"),s=t.clone(),u=regeneratorRuntime.mark((function e(t){var n,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.yaoSchedule(t,o),u=l.bernoulliMask(s.shape,n,i),e.next=3,r.qb();case 3:return c=r.Hb((function(){return l.convnet.predictFromPianoroll(s,u)})),e.next=6,r.qb();case 6:return s=r.Hb((function(){var e=l.samplePredictions(c,a),t=r.Mb(r.ab(u,"bool"),e,s);return s.dispose(),c.dispose(),u.dispose(),n.dispose(),t})),e.next=9,r.qb();case 9:case"end":return e.stop()}}),e)})),c=0;case 4:if(!(c<n)){e.next=9;break}return e.delegateYield(u(c),"t0",6);case 6:c++,e.next=4;break;case 9:return e.abrupt("return",(o.dispose(),s));case 10:case"end":return e.stop()}}),e)}))),function(e,n,r,a){return t.apply(this,arguments)})},{key:"yaoSchedule",value:function(e,t){return r.Hb((function(){var n=r.yb(.1,"float32"),a=r.yb(.9,"float32"),i=r.yb(.7,"float32"),o=a.sub(n).mul(r.yb(e,"float32")).div(t),s=a.sub(o).div(i);return n.reshape([1]).concat(s.reshape([1])).max()}))}},{key:"bernoulliMask",value:function(e,t,n){return r.Hb((function(){var a=_slicedToArray2(e,4),i=a[0],o=a[1],s=a[2],u=a[3],c=r.Ib(r.tb([i,o,1,u],0,1,"float32"),[1,1,s,1]).less(t);return r.ab(c,"float32").mul(n)}))}},{key:"samplePredictions",value:function(e,t){return r.Hb((function(){e=r.sb(e,r.yb(1/t,"float32"));var n=r.db(e,2,!1,!1),a=n.slice([0,0,n.shape[2]-1,0],[n.shape[0],n.shape[1],1,n.shape[3]]),i=r.tb(a.shape,0,1,"float32").mul(a).less(n).argMax(2);return r.rb(i.flatten(),e.shape[2],1,0).reshape([e.shape[0],e.shape[1],e.shape[3],e.shape[2]]).transpose([0,1,3,2])}))}}]),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"MusicRNN",(function(){return h}));var r=n(2),a=n(63),i=n(42),o=n(29),s=n(14),u=n(13),c=n(15),l=function(){function e(t,n,r){_classCallCheck2(this,e),this.cells=t,this.attnLength=n,this.attnSize=r}return _createClass2(e,[{key:"initialize",value:function(e){var t="rnn/attention_cell_wrapper/";this.attnInputMatrix=e[t+"kernel"],this.attnInputBias=e[t+"bias"],this.attnW=e[t+"attention/attn_w"],this.attnV=e[t+"attention/attn_v"],this.attnMatrix=e[t+"attention/kernel"],this.attnBias=e[t+"attention/bias"],this.attnOutputMatrix=e[t+"attention_output_projection/kernel"],this.attnOutputBias=e[t+"attention_output_projection/bias"]}},{key:"initState",value:function(){return{attention:r.zeros([this.attnSize]),attentionState:r.zeros([1,this.attnSize*this.attnLength])}}},{key:"call",value:function(e,t,n,a){var i=r.concat([e,a.attention.as2D(1,-1)],1),o=r.add(r.matMul(i,this.attnInputMatrix),this.attnInputBias.as2D(1,-1)),s=_slicedToArray2(r.multiRNNCell(this.cells,o,t,n),2);t=s[0],n=s[1];for(var u=r.reshape(a.attentionState,[-1,this.attnLength,1,this.attnSize]),c=r.conv2d(u,this.attnW,[1,1],"same"),l=[],h=0;h<t.length;h++)l.push(t[h]),l.push(n[h]);var f=r.concat(l,1),d=r.matMul(f,this.attnMatrix).reshape([-1,1,1,this.attnSize]),p=r.sum(r.mul(this.attnV,r.tanh(r.add(c,d))),[2,3]),m=r.softmax(p),v=r.sum(r.mul(r.reshape(m,[-1,this.attnLength,1,1]),u),[1,2]).reshape([-1,this.attnSize]),g=a.attentionState.reshape([-1,this.attnLength,this.attnSize]),y=r.slice(g,[0,1,0],[g.shape[0],g.shape[1]-1,g.shape[2]]),_=r.add(r.matMul(r.concat([n[2],v],1),this.attnOutputMatrix),this.attnOutputBias),b=v.flatten(),k=r.concat([y,_.as3D(_.shape[0],1,_.shape[1])],1).reshape([-1,this.attnLength*this.attnSize]);return{output:_,c:t,h:n,attentionState:{attention:b,attentionState:k}}}}],[{key:"isWrapped",value:function(e){return"rnn/attention_cell_wrapper/kernel"in e}}]),e}(),h=function(){function e(t,n){_classCallCheck2(this,e),this.checkpointURL=t,this.spec=n,this.initialized=!1,this.rawVars={},this.biasShapes=[],this.lstmCells=[]}var t,n,h,f;return _createClass2(e,[{key:"isInitialized",value:function(){return this.initialized}},{key:"instantiateFromSpec",value:function(){this.dataConverter=o.converterFromSpec(this.spec.dataConverter),this.attentionLength=this.spec.attentionLength,this.chordEncoder=this.spec.chordEncoder?i.chordEncoderFromType(this.spec.chordEncoder):void 0,this.auxInputs=this.spec.auxInputs?this.spec.auxInputs.map((function(e){return a.auxiliaryInputFromSpec(e)})):void 0}},{key:"initialize",value:(f=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,a,i,o,c,h=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dispose(),t=s.d.now(),e.t0=this.spec,e.t0){e.next=6;break}return e.next=6,Object(s.a)(this.checkpointURL+"/config.json").then((function(e){return e.json()})).then((function(e){if("MusicRNN"!==e.type)throw new Error("Attempted to instantiate MusicRNN model with incorrect type:\n                  "+e.type);h.spec=e}));case 6:return this.instantiateFromSpec(),e.next=9,Object(s.a)(this.checkpointURL+"/weights_manifest.json").then((function(e){return e.json()})).then((function(e){return r.io.loadWeights(e,h.checkpointURL)}));case 9:n=e.sent,a=l.isWrapped(n),i=a?"rnn/attention_cell_wrapper/":"rnn/",this.forgetBias=r.scalar(1),this.lstmCells.length=0,this.biasShapes.length=0,o=0,c=function(){var e=i+"multi_rnn_cell/cell_%d/basic_lstm_cell/".replace("%d",o.toString());if(!(e+"kernel"in n))return"break";h.lstmCells.push((function(t,a,i){return r.basicLSTMCell(h.forgetBias,n[e+"kernel"],n[e+"bias"],t,a,i)})),h.biasShapes.push(n[e+"bias"].shape[0]),++o};case 15:if("break"!==c()){e.next=18;break}return e.abrupt("break",20);case 18:e.next=15;break;case 20:this.lstmFcW=n["fully_connected/weights"],this.lstmFcB=n["fully_connected/biases"],a&&(this.attentionWrapper=new l(this.lstmCells,this.attentionLength,this.biasShapes[0]/4),this.attentionWrapper.initialize(n)),this.rawVars=n,this.initialized=!0,u.logWithDuration("Initialized model",t,"MusicRNN");case 21:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"dispose",value:function(){var e=this;Object.keys(this.rawVars).forEach((function(t){return e.rawVars[t].dispose()})),this.rawVars={},this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1}},{key:"continueSequence",value:(h=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.continueSequenceImpl(t,n,r,a,!1);case 2:return e.abrupt("return",e.sent.sequence);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return h.apply(this,arguments)})},{key:"continueSequenceAndReturnProbabilities",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.continueSequenceImpl(t,n,r,a,!0));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a){return n.apply(this,arguments)})},{key:"continueSequenceImpl",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a,i,o){var l,h,f,d,p,m,v=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.assertIsRelativeQuantizedSequence(t),!this.chordEncoder||i){e.next=2;break}throw new Error("Chord progression expected but not provided.");case 2:if(this.chordEncoder||!i){e.next=4;break}throw new Error("Unexpected chord progression provided.");case 4:if(e.t0=this.initialized,e.t0){e.next=8;break}return e.next=8,this.initialize();case 8:return l=s.d.now(),h=r.tidy((function(){var e=v.dataConverter.toTensor(t),s=e.shape[0],u=e.shape[1],c=v.chordEncoder?v.chordEncoder.encodeProgression(i,s+n):void 0,l=v.auxInputs?r.concat(v.auxInputs.map((function(e){return e.getTensors(s+n)})),1):void 0,h=v.sampleRnn(e,n,a,c,l,o),f=h.samples;return{samples:r.stack(f).as2D(f.length,u),probs:h.probs}})),e.next=12,h;case 12:if(f=e.sent,d=this.dataConverter.toNoteSequence(f.samples,t.quantizationInfo.stepsPerQuarter),p=[],!o){e.next=27;break}m=0;case 17:if(!(m<f.probs.length)){e.next=27;break}return e.t1=p,e.next=21,f.probs[m].data();case 21:e.t2=e.sent,e.t1.push.call(e.t1,e.t2),f.probs[m].dispose();case 24:m++,e.next=17;break;case 27:return e.abrupt("return",(h.samples.dispose(),d.then((function(){return u.logWithDuration("Continuation completed",l,"MusicRNN",20)})),{sequence:d,probs:p}));case 28:case"end":return e.stop()}}),e,this)}))),function(e,n,r,a,i){return t.apply(this,arguments)})},{key:"sampleRnn",value:function(e,t,n,a,i,o){for(var s=e.shape[0],u=e.shape[1],c=[],l=[],h=0;h<this.biasShapes.length;h++)c.push(r.zeros([1,this.biasShapes[h]/4])),l.push(r.zeros([1,this.biasShapes[h]/4]));var f,d=this.attentionWrapper?this.attentionWrapper.initState():null;e=e.toFloat();for(var p=[],m=[],v=r.split(e.toFloat(),s),g=a?r.split(a,a.shape[0]):void 0,y=i?r.split(i,i.shape[0]):void 0,_=0;_<s+t;_++){var b,k=void 0;if(_<s)k=v[_];else{var w=void 0,x=f.matMul(this.lstmFcW).add(this.lstmFcB).as1D();n?(x=x.div(r.scalar(n)),w=r.multinomial(x,1).as1D()):w=x.argMax().as1D(),o&&m.push(r.softmax(x)),k=r.oneHot(w,u).toFloat(),p.push(k.as1D())}if(_===s+t-1)break;var C=[];if(g&&C.push(g[_+1]),C.push(k),y&&C.push(y[_]),k=r.concat(C,1),this.attentionWrapper){var S=this.attentionWrapper.call(k,c,l,d);c=S.c,l=S.h,d=S.attentionState,f=S.output}else c=(b=_slicedToArray2(r.multiRNNCell(this.lstmCells,k,c,l),2))[0],f=(l=b[1])[l.length-1]}return{samples:p,probs:m}}}]),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"MidiMe",(function(){return s})),n.d(t,"Decoder",(function(){return y})),n.d(t,"Encoder",(function(){return d})),n.d(t,"MusicVAE",(function(){return A}));var r=n(2),a=n(13),i=n(14),o=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.call(this,{})}return _createClass2(n,[{key:"computeOutputShape",value:function(e){return e[0]}},{key:"call",value:function(e){return r.tidy((function(){var t=_slicedToArray2(e,2),n=t[0],a=t[1];return r.add(r.mul(r.randomNormal(a.shape),a),n)}))}},{key:"getClassName",value:function(){return"SamplingLayer"}}]),n}(r.layers.Layer),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck2(this,e),this.trained=!1,this.initialized=!1,this.config={encoder_layers:t.encoder_layers||[1024,256,64],decoder_layers:t.decoder_layers||[64,256,1024],input_size:t.input_size||256,latent_size:t.latent_size||4,beta:t.beta||1,epochs:t.epochs||10}}var t,n,s,u;return _createClass2(e,[{key:"dispose",value:function(){this.initialized&&(this.encoder.dispose(),this.decoder.dispose(),this.vae.dispose(),this.initialized=!1)}},{key:"initialize",value:function(){this.dispose();var e=i.d.now(),t=r.input({shape:[this.config.input_size]});this.encoder=this.getEncoder(t);var n=_slicedToArray2(this.encoder.apply(t),2)[0];this.decoder=this.getDecoder(n.shape.slice(1));var o=this.decoder.apply(n);this.vae=r.model({inputs:t,outputs:o,name:"vae"}),this.initialized=!0,a.logWithDuration("Initialized model",e,"MidiMe")}},{key:"train",value:(u=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var o,s,u,c,l,h=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=i.d.now(),this.trained=!1,s=.001,!1===r.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")&&!1===r.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&1===r.ENV.get("WEBGL_VERSION")&&(s=5e-5),u=r.train.adam(s),c=regeneratorRuntime.mark((function e(a){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.nextFrame();case 2:return e.next=4,u.minimize((function(){return r.tidy((function(){var e=_slicedToArray2(h.encoder.predict(t),3),r=e[1],i=e[2],o=h.vae.predict(t),s=h.loss(r,i,o,t);return n&&n(a,{y:o,total:s.totalLoss.arraySync(),losses:[s.reconLoss.arraySync(),s.latentLoss.arraySync()]}),s.totalLoss}))}));case 4:return e.next=6,r.nextFrame();case 6:case"end":return e.stop()}}),e)})),l=0;case 7:if(!(l<this.config.epochs)){e.next=12;break}return e.delegateYield(c(l),"t0",9);case 9:l++,e.next=7;break;case 12:a.logWithDuration("Training finished",o,"MidiMe"),this.trained=!0,u.dispose();case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"sample",value:(s=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n=this,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:1,e.t0=this.initialized,e.t0){e.next=5;break}return e.next=5,this.initialize();case 5:return e.abrupt("return",r.tidy((function(){var e=r.randomNormal([t,n.config.latent_size]);return n.decoder.predict(e)})));case 6:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"decode",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.initialized,e.t0){e.next=4;break}return e.next=4,this.initialize();case 4:return e.abrupt("return",this.decoder.predict(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"encode",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.initialized,e.t0){e.next=4;break}return e.next=4,this.initialize();case 4:return n=this.encoder.predict(t),r=_slicedToArray2(n,2),a=r[0],e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"predict",value:function(e){return this.vae.predict(e)}},{key:"getEncoder",value:function(e){for(var t=e,n=0;n<this.config.encoder_layers.length;n++)t=r.layers.dense({units:this.config.encoder_layers[n],activation:"relu"}).apply(t);var a=this.getAffineLayers(t,this.config.latent_size,e,!1),i=this.getAffineLayers(t,this.config.latent_size,e,!0),s=(new o).apply([a,i]);return r.model({inputs:e,outputs:[s,a,i],name:"encoder"})}},{key:"getDecoder",value:function(e){for(var t=r.input({shape:e}),n=t,a=0;a<this.config.decoder_layers.length;a++)n=r.layers.dense({units:this.config.decoder_layers[a],activation:"relu"}).apply(n);var i=this.getAffineLayers(n,this.config.input_size,t,!1);return r.model({inputs:t,outputs:i,name:"decoder"})}},{key:"loss",value:function(e,t,n,a){var i=this;return r.tidy((function(){var o=i.klLoss(e,t),s=i.reconstructionLoss(a,n);return{latentLoss:o,reconLoss:s,totalLoss:r.add(s,r.mul(o,i.config.beta))}}))}},{key:"reconstructionLoss",value:function(e,t){return r.tidy((function(){var n=r.pow(r.sub(e,t),2),a=r.div(n,r.mul(2,r.pow(r.ones([1]),2)));return r.mean(r.sum(a,-1))}))}},{key:"klLoss",value:function(e,t){return r.tidy((function(){var n=r.pow(e,2),a=r.pow(t,2),i=r.add(1,r.log(a)),o=r.add(n,a),s=r.sub(i,o),u=r.div(r.mean(r.sum(s,-1)),2);return r.mul(-1,u)}))}},{key:"getAffineLayers",value:function(e,t,n,a){var i=r.layers.dense({units:t}).apply(e);return a?r.layers.activation({activation:"softplus"}).apply(i):i}}]),e}(),u=n(42),c=n(8),l=n(29),h=function e(t,n){if(_classCallCheck2(this,e),void 0===t)throw Error("`kernel` is undefined.");if(void 0===n)throw Error("`bias` is undefined.");this.kernel=t,this.bias=n};function f(e,t){return t.matMul(e.kernel).add(e.bias)}var d=function e(){_classCallCheck2(this,e)},p=function(){function e(t,n){_classCallCheck2(this,e),this.lstmFwVars=t,this.lstmBwVars=n}return _createClass2(e,[{key:"process",value:function(e){var t=this;return r.tidy((function(){return[t.singleDirection(e,!0),t.singleDirection(e,!1)]}))}},{key:"singleDirection",value:function(e,t){var n,a=e.shape[0],i=e.shape[1],o=t?this.lstmFwVars:this.lstmBwVars,s=[r.zeros([a,o.bias.shape[0]/4]),r.zeros([a,o.bias.shape[0]/4])],u=r.scalar(1),c=function(e,t){return r.basicLSTMCell(u,o.kernel,o.bias,e,t[0],t[1])},l=r.split(e.toFloat(),i,1),h=[],f=_createForOfIteratorHelper(t?l:l.reverse());try{for(f.s();!(n=f.n()).done;){s=c(n.value.squeeze([1]),s),h.push(s[1])}}catch(d){f.e(d)}finally{f.f()}return t?h:h.reverse()}}]),e}(),m=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this)).bidirectionalLstm=new p(e,r),i.muVars=a,i.zDims=a?i.muVars.bias.shape[0]:null,i}return _createClass2(n,[{key:"encode",value:function(e,t){var n=this;if(t)throw new Error("Variable-length segments not supported in flat encoder");return r.tidy((function(){var t=_slicedToArray2(n.bidirectionalLstm.process(e),2),a=t[0],i=t[1],o=r.concat([a[a.length-1],i[0]],1);return n.muVars?f(n.muVars,o):o}))}}]),n}(d),v=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this)).baseEncoders=e,i.numSteps=r,i.muVars=a,i.zDims=i.muVars.bias.shape[0],i}return _createClass2(n,[{key:"encode",value:function(e,t){var n=this;if(t){if(1!==e.shape[0])throw new Error("When using variable-length segments, batch size must be 1.");if(t.length!==this.numSteps[0])throw new Error("Must provide length for all variable-length segments.")}return r.tidy((function(){for(var a=e,i=0;i<n.baseEncoders.length;++i){for(var o=n.numSteps[i],s=r.split(a,o,1),u=[],c=0;c<o;++c)u.push(n.baseEncoders[i].encode(0===i&&t?r.slice3d(s[c],[0,0,0],[1,t[c],-1]):s[c]));a=r.stack(u,1)}return f(n.muVars,a.squeeze([1]))}))}}]),n}(d);function g(e,t,n){for(var a=[],i=[],o=[],s=r.split(f(n,e).tanh(),2*t.length,1),u=function(e){var n=t[e],u=r.scalar(1);a.push((function(e,t,a){return r.basicLSTMCell(u,n.kernel,n.bias,e,t,a)})),i.push(s[2*e]),o.push(s[2*e+1])},c=0;c<t.length;++c)u(c);return{cell:a,c:i,h:o}}var y=function e(){_classCallCheck2(this,e)},_=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o,s){var u;return _classCallCheck2(this,n),(u=t.call(this)).lstmCellVars=e,u.zToInitStateVars=r,u.outputProjectVars=a,u.zDims=u.zToInitStateVars.kernel.shape[0],u.outputDims=i||a.bias.shape[0],o&&s&&(u.controlBidirectionalLstm=new p(o,s)),u}return _createClass2(n,[{key:"decode",value:function(e,t,n,a,i){var o=this,s=e.shape[0];return r.tidy((function(){var u=g(e,o.lstmCellVars,o.zToInitStateVars),c=i?r.expandDims(i,0):void 0,l=[],h=n||r.zeros([s,o.outputDims]);if(o.controlBidirectionalLstm){var d=_slicedToArray2(o.controlBidirectionalLstm.process(c),2),p=d[0],m=d[1];c=r.concat([r.stack(p,1),r.stack(m,1)],2)}for(var v=c?r.split(r.tile(c,[s,1,1]),i.shape[0],1):void 0,y=0;y<t;++y){var _=v?[h,e,r.squeeze(v[y],[1])]:[h,e],b=_slicedToArray2(r.multiRNNCell(u.cell,r.concat(_,1),u.c,u.h),2);u.c=b[0],u.h=b[1];var k=f(o.outputProjectVars,u.h[u.h.length-1]);h=o.sample(k,a),l.push(h)}return r.stack(l,1)}))}}]),n}(y),b=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"sample",value:function(e,t){var n=e;return(t?r.greaterEqual(r.sigmoid(n.div(r.scalar(t))),r.randomUniform(n.shape)):r.greaterEqual(n,0)).toFloat()}}]),n}(_),k=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"sample",value:function(e,t){var n=e,a=t?r.multinomial(n.div(r.scalar(t)),1).as1D():n.argMax(1).as1D();return r.oneHot(a,this.outputDims).toFloat()}}]),n}(_),w=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o,s){var u;return _classCallCheck2(this,n),(u=t.call(this,e,r,a,i.numDims,o,s)).nade=i,u}return _createClass2(n,[{key:"sample",value:function(e,t){var n=_slicedToArray2(r.split(e,[this.nade.numHidden,this.nade.numDims],1),2),a=n[0],i=n[1];return this.nade.sample(a,i)}}]),n}(_),x=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"sample",value:function(e,t){var n=_slicedToArray2(r.split(e,3,1),3),a=n[0],i=n[1],o=n[2];if(i=r.sigmoid(i),o=r.tanh(o),t){a=r.sigmoid(a.div(r.scalar(t)));var s=r.randomUniform(a.shape,0,1);a=r.greater(a,s).toFloat()}else a=r.greater(r.sigmoid(a),.5).toFloat();return r.concat([a,i,o],1)}}]),n}(_),C=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this)).coreDecoders=e,r.numDecoders=r.coreDecoders.length,r.zDims=r.coreDecoders[0].zDims,r.outputDims=r.coreDecoders.reduce((function(e,t){return e+t.outputDims}),0),r}return _createClass2(n,[{key:"decodeSeparately",value:function(e,t,n,r,a){for(var i=[],o=0;o<this.coreDecoders.length;++o)i.push(this.coreDecoders[o].decode(e,t,n[o],r,a));return i}},{key:"decode",value:function(e,t,n,a,i){var o=this;return r.tidy((function(){var s=o.decodeSeparately(e,t,o.coreDecoders.map((function(e){return n})),a,i);return r.concat(s,-1)}))}}]),n}(y),S=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this)).splitDecoder=new C(e),o.lstmCellVars=r,o.zToInitStateVars=a,o.numSteps=i,o.zDims=o.zToInitStateVars.kernel.shape[0],o.outputDims=o.splitDecoder.outputDims,o}return _createClass2(n,[{key:"decode",value:function(e,t,n,a,i){var o=this,s=e.shape[0];return r.tidy((function(){for(var n=g(e,o.lstmCellVars,o.zToInitStateVars),u=[],c=new Array(o.splitDecoder.numDecoders).fill(void 0),l=r.zeros([s,1]),h=i?r.split(i,o.numSteps):void 0,f=0;f<o.numSteps;++f){var d=_slicedToArray2(r.multiRNNCell(n.cell,l,n.c,n.h),2);n.c=d[0],n.h=d[1];var p=o.splitDecoder.decodeSeparately(n.h[n.h.length-1],t/o.numSteps,c,a,h?h[f]:void 0);u.push(r.concat(p,-1)),c=p.map((function(e){return e.slice([0,e.shape[1]-1,0],[s,1,e.shape[e.rank-1]]).squeeze([1]).toFloat()}))}return r.concat(u,1)}))}}]),n}(y),T=function(){function e(t,n){_classCallCheck2(this,e),this.numDims=t.shape[0],this.numHidden=t.shape[2],this.encWeights=t.as2D(this.numDims,this.numHidden),this.decWeightsT=n.as2D(this.numDims,this.numHidden)}return _createClass2(e,[{key:"sample",value:function(e,t){var n=this,a=e.shape[0];return r.tidy((function(){for(var i=[],o=e.clone(),s=0;s<n.numDims;s++){var u=r.sigmoid(o),c=n.encWeights.slice([s,0],[1,n.numHidden]).as1D(),l=n.decWeightsT.slice([s,0],[1,n.numHidden]),h=t.slice([0,s],[a,1]).add(r.matMul(u,l,!1,!0)).sigmoid().greaterEqual(r.scalar(.5)).toFloat().as1D();s<n.numDims-1&&(o=o.add(r.outerProduct(h.toFloat(),c))),i.push(h)}return r.stack(i,1)}))}}]),e}(),A=function(){function e(t,n){_classCallCheck2(this,e),this.initialized=!1,this.checkpointURL=t,this.spec=n}var t,n,o,s,f,d,p,g,y,_,A,E;return _createClass2(e,[{key:"instantiateFromSpec",value:function(){this.dataConverter=l.converterFromSpec(this.spec.dataConverter),this.chordEncoder=this.spec.chordEncoder?u.chordEncoderFromType(this.spec.chordEncoder):void 0}},{key:"dispose",value:function(){var e=this;void 0!==this.rawVars&&Object.keys(this.rawVars).forEach((function(t){return e.rawVars[t].dispose()})),this.encoder=void 0,this.decoder=void 0,this.initialized=!1}},{key:"getLstmLayers",value:function(e,t){for(var n=[],r=0;;){var a=e.replace("%d",r.toString());if(!(a+"kernel"in t))break;n.push(new h(t[a+"kernel"],t[a+"bias"])),++r}return n}},{key:"initialize",value:(E=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,o,s,u,c,l,f,d,p,g,y,_,A,E,I,R,O,N,D,P,F=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dispose(),t=i.d.now(),e.t0=this.spec,e.t0){e.next=6;break}return e.next=6,Object(i.a)(this.checkpointURL+"/config.json").then((function(e){return e.json()})).then((function(e){if("MusicVAE"!==e.type)throw new Error("Attempted to instantiate MusicVAE model with incorrect type:\n                  "+e.type);F.spec=e}));case 6:return this.instantiateFromSpec(),o="encoder/"+(n="cell_%d/bidirectional_rnn/%s/multi_rnn_cell/cell_0/lstm_cell/"),s="encoder/hierarchical_level_%d/"+n.replace("%d","0"),u="control_preprocessing/"+n,e.next=13,Object(i.a)(this.checkpointURL+"/weights_manifest.json").then((function(e){return e.json()})).then((function(e){return r.io.loadWeights(e,F.checkpointURL)}));case 13:if(c=e.sent,this.rawVars=c,l=new h(c["encoder/mu/kernel"],c["encoder/mu/bias"]),!this.dataConverter.numSegments){e.next=24;break}if(f=this.getLstmLayers(s.replace("%s","fw"),c),d=this.getLstmLayers(s.replace("%s","bw"),c),f.length===d.length&&2===f.length){e.next=20;break}throw Error("Only 2 hierarchical encoder levels are supported. Got ".concat(f.length," forward and ").concat(d.length," backward."));case 20:p=[0,1].map((function(e){return new m(f[e],d[e])})),this.encoder=new v(p,[this.dataConverter.numSegments,1],l),e.next=28;break;case 24:if(g=this.getLstmLayers(o.replace("%s","fw"),c),y=this.getLstmLayers(o.replace("%s","bw"),c),g.length===y.length&&1===g.length){e.next=27;break}throw Error("Only single-layer bidirectional encoders are supported. Got ".concat(g.length," forward and ").concat(y.length," backward."));case 27:this.encoder=new m(g[0],y[0],l);case 28:if(_=u.replace("%s","fw").replace("%d","0")+"kernel"in c,A=this.dataConverter.numSegments?"core_decoder/":"",E=[],this.dataConverter.NUM_SPLITS)for(I=0;I<this.dataConverter.NUM_SPLITS;++I)E.push("".concat(A,"core_decoder_").concat(I,"/decoder/"));else E.push(A+"decoder/");if(R=[null],O=[null],!_||(R=this.getLstmLayers(u.replace("%s","fw"),c),O=this.getLstmLayers(u.replace("%s","bw"),c),R.length===O.length&&1===R.length)){e.next=33;break}throw Error("Only single-layer bidirectional control preprocessing is supported. Got ".concat(R.length," forward and ").concat(O.length," backward."));case 33:N=E.map((function(e){var t=F.getLstmLayers(e+"multi_rnn_cell/cell_%d/lstm_cell/",c),n=new h(c[e+"z_to_initial_state/kernel"],c[e+"z_to_initial_state/bias"]),r=new h(c[e+"output_projection/kernel"],c[e+"output_projection/bias"]);return e+"nade/w_enc"in c?new w(t,n,r,new T(c[e+"nade/w_enc"],c[e+"nade/w_dec_t"]),R[0],O[0]):"GrooveConverter"===F.spec.dataConverter.type?new x(t,n,r,void 0,R[0],O[0]):F.spec.useBooleanDecoder?new b(t,n,r,void 0,R[0],O[0]):new k(t,n,r,void 0,R[0],O[0])})),this.dataConverter.numSegments?(D=this.getLstmLayers("decoder/hierarchical_level_0/cell_%d/lstm_cell/",c),P=new h(c["decoder/hierarchical_level_0/initial_state/kernel"],c["decoder/hierarchical_level_0/initial_state/bias"]),this.decoder=new S(N,D,P,this.dataConverter.numSegments)):this.decoder=1===N.length?N[0]:new C(N),this.zDims=this.decoder.zDims,this.initialized=!0,a.logWithDuration("Initialized model",t,"MusicVAE");case 36:case"end":return e.stop()}}),e,this)}))),function(){return E.apply(this,arguments)})},{key:"isInitialized",value:function(){return this.initialized}},{key:"checkControlArgs",value:function(e){var t=(e=e||{}).extraControls||{};if(this.chordEncoder&&!e.chordProgression)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&e.chordProgression)throw new Error("Unexpected chord progression provided.");if(this.chordEncoder&&this.dataConverter.endTensor&&e.chordProgression.length>1)throw new Error("Multiple chords not supported when using variable-length segments.");if(this.spec.conditionOnKey&&null==e.key)throw new Error("Key expected but not provided.");if(!this.spec.conditionOnKey&&null!=e.key)throw new Error("Unexpected key provided.");if(this.spec.extraControls){var n,r=_createForOfIteratorHelper(this.spec.extraControls);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!(i.name in t))throw new Error("Missing control signal: "+i.name);if(t[i.name].shape[1]!==i.depth)throw new Error("Control signal ".concat(i.name," has invalid depth: ").concat(t[i.name].shape[1]," != ").concat(i.depth))}}catch(u){r.e(u)}finally{r.f()}}var o=this.spec.extraControls?new Set(this.spec.extraControls.map((function(e){return e.name}))):new Set;for(var s in t)o.has(s)||a.log("Unspecified control signal provided: "+s,"MusicVAE",5)}},{key:"controlArgsToTensor",value:function(e){var t=this;return e=e||{},r.tidy((function(){var n=[];if(e.chordProgression){var a=t.encodeChordProgression(e.chordProgression);n.push(a)}if(null!=e.key){var i=r.oneHot(r.fill([t.dataConverter.numSteps],e.key,"int32"),12);n.push(i)}if(e.extraControls){var o,s=_createForOfIteratorHelper(t.spec.extraControls);try{for(s.s();!(o=s.n()).done;){var u=o.value;n.push(e.extraControls[u.name])}}catch(c){s.e(c)}finally{s.f()}}return n.length?r.concat2d(n,1):void 0}))}},{key:"interpolateTensors",value:(A=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a,i){var o,s,u,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.initialized,e.t0){e.next=4;break}return e.next=4,this.initialize();case 4:return e.next=6,this.encodeTensors(t,i);case 6:return o=e.sent,s=r.tidy((function(){return c.getInterpolatedZs(o,n)})),o.dispose(),e.next=11,this.decodeTensors(s,a,i);case 11:return u=e.sent,e.abrupt("return",(s.dispose(),u));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return A.apply(this,arguments)})},{key:"interpolate",value:(_=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,i,o){var s,u,c,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkControlArgs(o),e.t0=this.initialized,e.t0){e.next=5;break}return e.next=5,this.initialize();case 5:return e.next=7,this.encode(t,o);case 7:return s=e.sent,u=r.tidy((function(){return l.getInterpolatedZs(s,n)})),s.dispose(),c=this.decode(u,i,o),e.abrupt("return",(u.dispose(),c.then((function(){return a.logWithDuration("Interpolation completed",0,"MusicVAE",20)})),c));case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return _.apply(this,arguments)})},{key:"getSegmentLengths",value:(y=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,u,c,l,h=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.shape[0]>1)){e.next=2;break}throw new Error("Variable-length segments not supported for batch size > 1.");case 2:return n=this.dataConverter.numSteps,a=this.dataConverter.numSegments,i=r.tidy((function(){return r.min(r.equal(t.squeeze([0]),h.dataConverter.endTensor.expandDims(0)),1)})),e.next=7,i.data();case 7:for(o=e.sent,i.dispose(),s=n/a,u=[],c=0,l=o.indexOf(1);-1!==l;)u.push(l-c+1),c+=s,l=o.indexOf(1,c);if(u.length===a){e.next=14;break}throw new Error("Incorrect number of segments: ".concat(u.length," != ").concat(a));case 14:return e.abrupt("return",u);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"encodeChordProgression",value:function(e){var t=this.dataConverter.numSteps,n=this.dataConverter.numSegments,a=this.dataConverter.SEGMENTED_BY_TRACK?t/n:t,i=this.dataConverter.SEGMENTED_BY_TRACK?r.concat2d([this.chordEncoder.encode(c.NO_CHORD).expandDims(0),this.chordEncoder.encodeProgression(e,a-1)],0):this.chordEncoder.encodeProgression(e,a);return this.dataConverter.SEGMENTED_BY_TRACK?r.tile(i,[n,1]):i}},{key:"encodeTensors",value:(g=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkControlArgs(n),e.t0=this.initialized,e.t0){e.next=5;break}return e.next=5,this.initialize();case 5:if(!this.dataConverter.endTensor){e.next=11;break}return e.next=8,this.getSegmentLengths(t);case 8:e.t1=e.sent,e.next=12;break;case 11:e.t1=void 0;case 12:return a=e.t1,e.abrupt("return",r.tidy((function(){var e=i.controlArgsToTensor(n),o=[t];if(e){var s=r.tile(r.expandDims(e,0),[t.shape[0],1,1]);o.push(s)}var u=r.concat3d(o,2);return i.encoder.encode(u,a)})));case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"encode",value:(p=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var o,s,u,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.initialized,e.t0){e.next=4;break}return e.next=4,this.initialize();case 4:return o=i.d.now(),s=r.tidy((function(){return r.stack(t.map((function(e){return c.dataConverter.toTensor(e)})))})),e.next=8,this.encodeTensors(s,n);case 8:return u=e.sent,e.abrupt("return",(s.dispose(),a.logWithDuration("Encoding completed",o,"MusicVAE",20),u));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"decodeTensors",value:(d=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a){var i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkControlArgs(a),e.t0=this.initialized,e.t0){e.next=5;break}return e.next=5,this.initialize();case 5:return e.abrupt("return",r.tidy((function(){var e=i.controlArgsToTensor(a);return i.decoder.decode(t,i.dataConverter.numSteps,void 0,n,e)})));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"decode",value:(f=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,o){var s,u,l,h,f,d,p,m,v,g=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=g.length>3&&void 0!==g[3]?g[3]:c.DEFAULT_STEPS_PER_QUARTER,u=g.length>4&&void 0!==g[4]?g[4]:c.DEFAULT_QUARTERS_PER_MINUTE,e.t0=this.initialized,e.t0){e.next=6;break}return e.next=6,this.initialize();case 6:return l=i.d.now(),e.next=9,this.decodeTensors(t,n,o);case 9:h=e.sent,f=r.tidy((function(){return r.split(h,h.shape[0]).map((function(e){return e.squeeze([0])}))})),d=[],p=_createForOfIteratorHelper(f),e.prev=13,p.s();case 15:if((m=p.n()).done){e.next=25;break}return v=m.value,e.t1=d,e.next=20,this.dataConverter.toNoteSequence(v,s,u);case 20:e.t2=e.sent,e.t1.push.call(e.t1,e.t2),v.dispose();case 23:e.next=15;break;case 25:e.next=30;break;case 27:e.prev=27,e.t3=e.catch(13),p.e(e.t3);case 30:return e.prev=30,p.f(),e.finish(30);case 33:return e.abrupt("return",(h.dispose(),a.logWithDuration("Decoding completed",l,"MusicVAE",20),d));case 34:case"end":return e.stop()}}),e,this,[[13,27,30,33]])}))),function(e,t,n){return f.apply(this,arguments)})},{key:"getInterpolatedZs",value:function(e,t){if("number"==typeof t&&(t=[t]),2!==e.shape[0]&&4!==e.shape[0])throw new Error("Invalid number of input sequences. Requires length 2, or 4");if(1!==t.length&&2!==t.length)throw new Error("Invalid number of dimensions. Requires length 1, or 2.");var n=t[0],a=2===t.length?t[1]:n;return r.tidy((function(){var t=r.linspace(0,1,n),i=e.slice([0,0],[1,e.shape[1]]).as1D(),o=e.slice([1,0],[1,e.shape[1]]).as1D();if(2===e.shape[0]){var s=o.sub(i);return r.outerProduct(t,s).add(i)}if(4===e.shape[0]){var u=r.linspace(0,1,a),c=e.slice([2,0],[1,e.shape[1]]).as1D(),l=e.slice([3,0],[1,e.shape[1]]).as1D(),h=r.scalar(1).sub(t),f=r.scalar(1).sub(u),d=i.mul(r.outerProduct(f,h).as3D(a,n,1));return d=r.addStrict(d,o.mul(r.outerProduct(u,h).as3D(a,n,1))),d=r.addStrict(d,c.mul(r.outerProduct(f,t).as3D(a,n,1))),(d=r.addStrict(d,l.mul(r.outerProduct(u,t).as3D(a,n,1)))).as2D(n*a,e.shape[1])}throw new Error("Invalid number of note sequences. Requires length 2, or 4")}))}},{key:"sampleTensors",value:(s=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i,o,s=this,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:.5,a=u.length>2?u[2]:void 0,this.checkControlArgs(a),e.t0=this.initialized,e.t0){e.next=7;break}return e.next=7,this.initialize();case 7:return i=r.tidy((function(){return r.randomNormal([t,s.decoder.zDims])})),e.next=10,this.decodeTensors(i,n,a);case 10:return o=e.sent,e.abrupt("return",(i.dispose(),o));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"sample",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,o,s,u,l,h,f,d=this,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p.length>1&&void 0!==p[1]?p[1]:.5,o=p.length>2?p[2]:void 0,s=p.length>3&&void 0!==p[3]?p[3]:c.DEFAULT_STEPS_PER_QUARTER,u=p.length>4&&void 0!==p[4]?p[4]:c.DEFAULT_QUARTERS_PER_MINUTE,this.checkControlArgs(o),e.t0=this.initialized,e.t0){e.next=9;break}return e.next=9,this.initialize();case 9:return l=i.d.now(),h=r.tidy((function(){return r.randomNormal([t,d.decoder.zDims])})),f=this.decode(h,n,o,s,u),e.abrupt("return",(h.dispose(),f.then((function(){return a.logWithDuration("Sampling completed",l,"MusicVAE",20)})),f));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"similarTensors",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a,i,o){var s,u,c,l,h=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a<0||a>1)){e.next=2;break}throw new Error("Similarity must be between 0 and 1.");case 2:if(e.t0=this.initialized,e.t0){e.next=6;break}return e.next=6,this.initialize();case 6:return s=r.expandDims(t,0),e.next=9,this.encodeTensors(s,o);case 9:return u=e.sent,s.dispose(),c=r.tidy((function(){var e=r.randomNormal([n,h.decoder.zDims]);return r.add(u.mul(a),e.mul(1-a))})),u.dispose(),e.next=15,this.decodeTensors(c,i,o);case 15:return l=e.sent,e.abrupt("return",(c.dispose(),l));case 17:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a,i){return n.apply(this,arguments)})},{key:"similar",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,i,o,s){var u,c,l,h=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkControlArgs(s),!(i<0||i>1)){e.next=2;break}throw new Error("Similarity must be between 0 and 1.");case 2:if(e.t0=this.initialized,e.t0){e.next=6;break}return e.next=6,this.initialize();case 6:return e.next=8,this.encode([t],s);case 8:return u=e.sent,c=r.tidy((function(){var e=r.randomNormal([n,h.decoder.zDims]);return r.add(u.mul(i),e.mul(1-i))})),u.dispose(),l=this.decode(c,o,s),e.abrupt("return",(c.dispose(),l.then((function(){return a.logWithDuration("Similar sequence generation completed",0,"MusicVAE",20)})),l));case 13:case"end":return e.stop()}}),e,this)}))),function(e,n,r,a,i){return t.apply(this,arguments)})}]),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"PianoGenie",(function(){return p})),n.d(t,"PianoGenieKeysig",(function(){return v})),n.d(t,"PianoGenieChord",(function(){return m})),n.d(t,"PianoGenieKeysigChordFamily",(function(){return y})),n.d(t,"PianoGenieKeysigChord",(function(){return g}));var r,a,i=n(2),o=n(14);function s(e){for(var t=0;t<2;++t)e.c[t].dispose(),e.h[t].dispose()}function u(e,t,n){if((t=void 0!==t?t:1)<0||t>1)throw new Error("Invalid temperature specified");var r;if(0===t)r=i.argMax(e,0);else{t<1&&(e=i.div(e,i.scalar(t,"float32")));var a=i.reshape(i.softmax(e,0),[1,-1]),o=i.multinomial(a,1,n,!0);r=i.reshape(o,[])}return r}var c=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"getRnnInputFeats",value:function(){var e=this;return i.tidy((function(){var t,n=[_get(_getPrototypeOf(u.prototype),"getRnnInputFeats",e).call(e)],r=e.lastOutput,a=e.lastTime,o=e.time;void 0===e.deltaTimeOverride?t=(o.getTime()-a.getTime())/1e3:(t=e.deltaTimeOverride,e.deltaTimeOverride=void 0);var s=i.scalar(r,"int32"),u=i.addStrict(s,i.scalar(1,"int32")),c=i.cast(i.oneHot(u,89),"float32");n.push(c);var l=i.scalar(t,"float32"),h=i.round(i.mul(l,31.25)),f=i.minimum(h,32),d=i.cast(i.add(f,1e-4),"int32"),p=i.oneHot(d,33),m=i.cast(p,"float32");return n.push(m),e.lastTime=o,i.concat1d(n)}))}},{key:"nextWithCustomSamplingFunction",value:function(e,t){this.time=new Date;var r=_get(_getPrototypeOf(n.prototype),"nextWithCustomSamplingFunction",this).call(this,e,t);return this.lastOutput=r,this.lastTime=this.time,r}},{key:"overrideLastOutput",value:function(e){this.lastOutput=e}},{key:"overrideDeltaTime",value:function(e){this.deltaTimeOverride=e}},{key:"resetState",value:function(){_get(_getPrototypeOf(n.prototype),"resetState",this).call(this),this.lastOutput=-1,this.lastTime=new Date,this.lastTime.setSeconds(this.lastTime.getSeconds()-1e5),this.time=new Date}}]),n}(function(){function e(t){_classCallCheck2(this,e),this.checkpointURL=t,this.initialized=!1}var t;return _createClass2(e,[{key:"isInitialized",value:function(){return this.initialized}},{key:"initialize",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialized&&this.dispose(),void 0!==this.checkpointURL||void 0!==t){e.next=2;break}throw new Error("Need to specify either URI or static variables");case 2:if(void 0!==t){e.next=9;break}return e.next=5,Object(o.a)(this.checkpointURL+"/weights_manifest.json").then((function(e){return e.json()})).then((function(e){return i.io.loadWeights(e,s.checkpointURL)}));case 5:n=e.sent,this.modelVars=n,e.next=10;break;case 9:this.modelVars=t;case 10:for(this.decLSTMCells=[],this.decForgetBias=i.scalar(1,"float32"),r=function(e){var t="phero_model/decoder/rnn/rnn/multi_rnn_cell/cell_".concat(e,"/lstm_cell/");s.decLSTMCells.push((function(e,n,r){return i.basicLSTMCell(s.decForgetBias,s.modelVars[t+"kernel"],s.modelVars[t+"bias"],e,n,r)}))},a=0;a<2;++a)r(a);this.resetState(),this.initialized=!0,this.next(0),this.resetState();case 14:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getRnnInputFeats",value:function(){var e=this;return i.tidy((function(){var t=i.tensor1d([e.button],"float32");return i.sub(i.mul(2,i.div(t,7)),1).as1D()}))}},{key:"next",value:function(e,t,n){return this.nextWithCustomSamplingFunction(e,(function(e){return u(e,t,n)}))}},{key:"nextFromKeyWhitelist",value:function(e,t,n,r){return this.nextWithCustomSamplingFunction(e,(function(e){var a=i.tensor1d(t,"int32"),o=u(e=i.gather(e,a),n,r),s=i.gather(a,i.reshape(o,[1]));return o=i.reshape(s,[])}))}},{key:"nextWithCustomSamplingFunction",value:function(e,t){var n=this.lastState;this.button=e;var r=this.getRnnInputFeats(),a=_slicedToArray2(this.evaluateModelAndSample(r,n,t),2),i=a[0],o=a[1];return r.dispose(),s(this.lastState),this.lastState=i,o}},{key:"evaluateModelAndSample",value:function(e,t,n){var r=this;if(!this.initialized)throw new Error("Model is not initialized.");var a=i.tidy((function(){var a=i.matMul(i.expandDims(e,0),r.modelVars["phero_model/decoder/rnn_input/dense/kernel"]);a=i.add(a,r.modelVars["phero_model/decoder/rnn_input/dense/bias"]);var o=_slicedToArray2(i.multiRNNCell(r.decLSTMCells,a,t.c,t.h),2),s=o[0],u=o[1],c={c:s,h:u},l=i.matMul(u[1],r.modelVars["phero_model/decoder/pitches/dense/kernel"]);l=i.add(l,r.modelVars["phero_model/decoder/pitches/dense/bias"]);var h=i.reshape(l,[88]);return[c,n(h).dataSync()[0]]})),o=_slicedToArray2(a,2);return[o[0],o[1]]}},{key:"resetState",value:function(){void 0!==this.lastState&&s(this.lastState),this.lastState=function(){for(var e={c:[],h:[]},t=0;t<2;++t)e.c.push(i.zeros([1,128],"float32")),e.h.push(i.zeros([1,128],"float32"));return e}()}},{key:"dispose",value:function(){var e=this;this.initialized&&(Object.keys(this.modelVars).forEach((function(t){return e.modelVars[t].dispose()})),this.decForgetBias.dispose(),s(this.lastState),this.initialized=!1)}}]),e}());!function(e){e[e.None=0]="None",e[e.C=1]="C",e[e.Cs=2]="Cs",e[e.D=3]="D",e[e.Eb=4]="Eb",e[e.E=5]="E",e[e.F=6]="F",e[e.Fs=7]="Fs",e[e.G=8]="G",e[e.Ab=9]="Ab",e[e.A=10]="A",e[e.Bb=11]="Bb",e[e.B=12]="B"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Maj=1]="Maj",e[e.Min=2]="Min",e[e.Aug=3]="Aug",e[e.Dim=4]="Dim",e[e.Seven=5]="Seven",e[e.Maj7=6]="Maj7",e[e.Min7=7]="Min7",e[e.Min7b5=8]="Min7b5"}(a||(a={}));var l=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"getRnnInputFeats",value:function(){var e=this;return i.tidy((function(){var t=[_get(_getPrototypeOf(n.prototype),"getRnnInputFeats",e).call(e)],r=i.scalar(e.chordRoot,"int32"),a=i.subStrict(r,i.scalar(1,"int32")),o=i.cast(i.oneHot(a,12),"float32");t.push(o);var s=i.scalar(e.chordFamily,"int32"),u=i.subStrict(s,i.scalar(1,"int32")),c=i.cast(i.oneHot(u,8),"float32");return t.push(c),i.concat1d(t)}))}},{key:"setChordRoot",value:function(e){this.chordRoot=e}},{key:"setChordFamily",value:function(e){this.chordFamily=e}},{key:"resetState",value:function(){_get(_getPrototypeOf(n.prototype),"resetState",this).call(this),this.chordRoot=r.None,this.chordFamily=a.None}}]),n}(c),h=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"getRnnInputFeats",value:function(){var e=this;return i.tidy((function(){var t=[_get(_getPrototypeOf(n.prototype),"getRnnInputFeats",e).call(e)],r=i.scalar(e.keySignature,"int32"),a=i.subStrict(r,i.scalar(1,"int32")),o=i.cast(i.oneHot(a,12),"float32");return t.push(o),i.concat1d(t)}))}},{key:"setKeySignature",value:function(e){this.keySignature=e}},{key:"resetState",value:function(){_get(_getPrototypeOf(n.prototype),"resetState",this).call(this),this.keySignature=r.None}}]),n}(c),f=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"getRnnInputFeats",value:function(){var e=this;return i.tidy((function(){var t=[_get(_getPrototypeOf(n.prototype),"getRnnInputFeats",e).call(e)],r=i.scalar(e.chordRoot,"int32"),a=i.subStrict(r,i.scalar(1,"int32")),o=i.cast(i.oneHot(a,12),"float32");t.push(o);var s=i.scalar(e.chordFamily,"int32"),u=i.subStrict(s,i.scalar(1,"int32")),c=i.cast(i.oneHot(u,8),"float32");return t.push(c),i.concat1d(t)}))}},{key:"setChordRoot",value:function(e){this.chordRoot=e}},{key:"setChordFamily",value:function(e){this.chordFamily=e}},{key:"resetState",value:function(){_get(_getPrototypeOf(n.prototype),"resetState",this).call(this),this.chordRoot=r.None,this.chordFamily=a.None}}]),n}(h),d=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"getRnnInputFeats",value:function(){var e=this;return i.tidy((function(){var t=[_get(_getPrototypeOf(n.prototype),"getRnnInputFeats",e).call(e)],r=i.scalar(e.chordFamily,"int32"),a=i.subStrict(r,i.scalar(1,"int32")),o=i.cast(i.oneHot(a,8),"float32");return t.push(o),i.concat1d(t)}))}},{key:"setChordFamily",value:function(e){this.chordFamily=e}},{key:"resetState",value:function(){_get(_getPrototypeOf(n.prototype),"resetState",this).call(this),this.chordFamily=a.None}}]),n}(h),p=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return n}(c),m=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return n}(l),v=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return n}(h),g=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return n}(f),y=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return n}(d)},,function(e,t){function n(e){for(var t,n=new r(e),a=[];!n.eof();){var i=o();a.push(i)}return a;function o(){var e={};e.deltaTime=n.readVarInt();var r=n.readUInt8();if(240==(240&r)){if(255!==r){if(240==r)return e.type="sysEx",i=n.readVarInt(),e.data=n.readBytes(i),e;if(247==r)return e.type="endSysEx",i=n.readVarInt(),e.data=n.readBytes(i),e;throw"Unrecognised MIDI event type byte: "+r}e.meta=!0;var a=n.readUInt8(),i=n.readVarInt();switch(a){case 0:if(e.type="sequenceNumber",2!==i)throw"Expected length for sequenceNumber event is 2, got "+i;return e.number=n.readUInt16(),e;case 1:return e.type="text",e.text=n.readString(i),e;case 2:return e.type="copyrightNotice",e.text=n.readString(i),e;case 3:return e.type="trackName",e.text=n.readString(i),e;case 4:return e.type="instrumentName",e.text=n.readString(i),e;case 5:return e.type="lyrics",e.text=n.readString(i),e;case 6:return e.type="marker",e.text=n.readString(i),e;case 7:return e.type="cuePoint",e.text=n.readString(i),e;case 32:if(e.type="channelPrefix",1!=i)throw"Expected length for channelPrefix event is 1, got "+i;return e.channel=n.readUInt8(),e;case 33:if(e.type="portPrefix",1!=i)throw"Expected length for portPrefix event is 1, got "+i;return e.port=n.readUInt8(),e;case 47:if(e.type="endOfTrack",0!=i)throw"Expected length for endOfTrack event is 0, got "+i;return e;case 81:if(e.type="setTempo",3!=i)throw"Expected length for setTempo event is 3, got "+i;return e.microsecondsPerBeat=n.readUInt24(),e;case 84:if(e.type="smpteOffset",5!=i)throw"Expected length for smpteOffset event is 5, got "+i;var o=n.readUInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&o],e.hour=31&o,e.min=n.readUInt8(),e.sec=n.readUInt8(),e.frame=n.readUInt8(),e.subFrame=n.readUInt8(),e;case 88:if(e.type="timeSignature",4!=i)throw"Expected length for timeSignature event is 4, got "+i;return e.numerator=n.readUInt8(),e.denominator=1<<n.readUInt8(),e.metronome=n.readUInt8(),e.thirtyseconds=n.readUInt8(),e;case 89:if(e.type="keySignature",2!=i)throw"Expected length for keySignature event is 2, got "+i;return e.key=n.readInt8(),e.scale=n.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=n.readBytes(i),e;default:return e.type="unknownMeta",e.data=n.readBytes(i),e.metatypeByte=a,e}}else{var s;if(0==(128&r)){if(null===t)throw"Running status byte encountered before status byte";s=r,r=t,e.running=!0}else s=n.readUInt8(),t=r;var u=r>>4;switch(e.channel=15&r,u){case 8:return e.type="noteOff",e.noteNumber=s,e.velocity=n.readUInt8(),e;case 9:var c=n.readUInt8();return e.type=0===c?"noteOff":"noteOn",e.noteNumber=s,e.velocity=c,0===c&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=s,e.amount=n.readUInt8(),e;case 11:return e.type="controller",e.controllerType=s,e.value=n.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=s,e;case 13:return e.type="channelAftertouch",e.amount=s,e;case 14:return e.type="pitchBend",e.value=s+(n.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+u}}}}function r(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}r.prototype.eof=function(){return this.pos>=this.bufferLen},r.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e},r.prototype.readInt8=function(){var e=this.readUInt8();return 128&e?e-256:e},r.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},r.prototype.readInt16=function(){var e=this.readUInt16();return 32768&e?e-65536:e},r.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},r.prototype.readInt24=function(){var e=this.readUInt24();return 8388608&e?e-16777216:e},r.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},r.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t},r.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)},r.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(!(128&t))return e+t;e+=127&t,e<<=7}return e},r.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32();return{id:e,length:t,data:this.readBytes(t)}},e.exports=function(e){var t=new r(e),a=t.readChunk();if("MThd"!=a.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+a.id+"'";for(var i=function(e){var t=new r(e),n={format:t.readUInt16(),numTracks:t.readUInt16()},a=t.readUInt16();return 32768&a?(n.framesPerSecond=256-(a>>8),n.ticksPerFrame=255&a):n.ticksPerBeat=a,n}(a.data),o=[],s=0;!t.eof()&&s<i.numTracks;s++){var u=t.readChunk();if("MTrk"!=u.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+u.id+"'";var c=n(u.data);o.push(c)}return{header:i,tracks:o}}},function(e,t){function n(e,t,n){var i,o=new a,s=t.length,u=null;for(i=0;i<s;i++)!1!==n.running&&(n.running||t[i].running)||(u=null),u=r(o,t[i],u,n.useByte9ForNoteOff);e.writeChunk("MTrk",o.buffer)}function r(e,t,n,r){var a=t.type,i=t.text||"",o=t.data||[],s=null;switch(e.writeVarInt(t.deltaTime),a){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(i.length),e.writeString(i);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(i.length),e.writeString(i);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(i.length),e.writeString(i);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(i.length),e.writeString(i);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(i.length),e.writeString(i);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(i.length),e.writeString(i);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(i.length),e.writeString(i);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5),e.writeUInt8(31&t.hour|{24:0,25:32,29:64,30:96}[t.frameRate]),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var u=255&Math.floor(Math.log(t.denominator)/Math.LN2);e.writeUInt8(u),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(o.length),e.writeBytes(o);break;case"unknownMeta":null!=t.metatypeByte&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(o.length),e.writeBytes(o));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(o.length),e.writeBytes(o);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(o.length),e.writeBytes(o);break;case"noteOff":(s=(!1!==r&&t.byte9||r&&0==t.velocity?144:128)|t.channel)!==n&&e.writeUInt8(s),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":(s=144|t.channel)!==n&&e.writeUInt8(s),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":(s=160|t.channel)!==n&&e.writeUInt8(s),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":(s=176|t.channel)!==n&&e.writeUInt8(s),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":(s=192|t.channel)!==n&&e.writeUInt8(s),e.writeUInt8(t.programNumber);break;case"channelAftertouch":(s=208|t.channel)!==n&&e.writeUInt8(s),e.writeUInt8(t.amount);break;case"pitchBend":(s=224|t.channel)!==n&&e.writeUInt8(s);var c=8192+t.value,l=c>>7&127;e.writeUInt8(127&c),e.writeUInt8(l);break;default:throw"Unrecognized event type: "+a}return s}function a(){this.buffer=[]}a.prototype.writeInt8=a.prototype.writeUInt8=function(e){this.buffer.push(255&e)},a.prototype.writeInt16=a.prototype.writeUInt16=function(e){var t=255&e;this.writeUInt8(e>>8&255),this.writeUInt8(t)},a.prototype.writeInt24=a.prototype.writeUInt24=function(e){var t=e>>8&255,n=255&e;this.writeUInt8(e>>16&255),this.writeUInt8(t),this.writeUInt8(n)},a.prototype.writeInt32=a.prototype.writeUInt32=function(e){var t=e>>16&255,n=e>>8&255,r=255&e;this.writeUInt8(e>>24&255),this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r)},a.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))},a.prototype.writeString=function(e){var t,n=e.length,r=[];for(t=0;t<n;t++)r.push(e.codePointAt(t));this.writeBytes(r)},a.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(127&t),t>>=7;t;)n.push(127&t|128),t>>=7;this.writeBytes(n.reverse())}},a.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)},e.exports=function(e,t){if("object"!=typeof e)throw"Invalid MIDI data";t=t||{};var r,i=e.header||{},o=e.tracks||[],s=o.length,u=new a;for(function(e,t,n){var r=null==t.format?1:t.format,i=128;t.timeDivision?i=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?i=-(255&t.framesPerSecond)<<8|255&t.ticksPerFrame:t.ticksPerBeat&&(i=32767&t.ticksPerBeat);var o=new a;o.writeUInt16(r),o.writeUInt16(n),o.writeUInt16(i),e.writeChunk("MThd",o.buffer)}(u,i,s),r=0;r<s;r++)n(u,o[r],t);return u.buffer}},function(e,t,n){"use strict";var r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,a++)r[a]=i[o];return r},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(89),o=n(76),s=a(n(184));function u(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:e.value}}function c(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}t.encode=function(e){var t={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:r([r([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map((function(e){return function(e){var t=o.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:"major"===e.scale?0:1,type:"keySignature"}}(e)})),e.header.meta.map((function(e){return{absoluteTime:(t=e).ticks,deltaTime:0,meta:!0,text:t.text,type:t.type};var t})),e.header.tempos.map((function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}(e)})),e.header.timeSignatures.map((function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(e)})))],e.tracks.map((function(e){return r([(t=e.name,{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}),c(e)],function(e){return s.default(e.notes.map((function(t){return function(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(127*e.velocity)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(127*e.noteOffVelocity)}]}(t,e.channel)})))}(e),function(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach((function(n){t.push(u(n,e.channel))}));return t}(e),function(e){var t=[];return e.pitchBends.forEach((function(n){t.push(function(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}(n,e.channel))})),t}(e));var t})))};return t.tracks=t.tracks.map((function(e){e=e.sort((function(e,t){return e.absoluteTime-t.absoluteTime}));var t=0;return e.forEach((function(e){e.deltaTime=e.absoluteTime-t,t=e.absoluteTime,delete e.absoluteTime})),e.push({deltaTime:0,meta:!0,type:"endOfTrack"}),e})),new Uint8Array(i.writeMidi(t))}},function(e,t,n){"use strict";function r(e){return function e(t,n){for(var r=0;r<t.length;r++){var a=t[r];Array.isArray(a)?e(a,n):n.push(a)}return n}(e,[])}function a(e,t){if("number"!=typeof t)throw new TypeError("Expected the depth to be a number");return function e(t,n,r){r--;for(var a=0;a<t.length;a++){var i=t[a];r>-1&&Array.isArray(i)?e(i,n,r):n.push(i)}return n}(e,[],t)}e.exports=function(e){if(!Array.isArray(e))throw new TypeError("Expected value to be an array");return r(e)},e.exports.from=r,e.exports.depth=function(e,t){if(!Array.isArray(e))throw new TypeError("Expected value to be an array");return a(e,t)},e.exports.fromDepth=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(92);t.createControlChanges=function(){return new Proxy({},{get:function(e,t){return e[t]?e[t]:r.controlChangeIds.hasOwnProperty(t)?e[r.controlChangeIds[t]]:void 0},set:function(e,t,n){return r.controlChangeIds.hasOwnProperty(t)?e[r.controlChangeIds[t]]=n:e[t]=n,!0}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new WeakMap,a=function(){function e(e,t){r.set(this,t),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(e.prototype,"time",{get:function(){return r.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=r.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}();t.PitchBend=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(188),a=new WeakMap,i=function(){function e(e,t){if(this.number=0,a.set(this,t),this.number=0,e){var n=e.find((function(e){return"programChange"===e.type}));n&&(this.number=n.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?r.DrumKitByPatchID[this.number]:r.instrumentByPatchID[this.number]},set:function(e){var t=r.instrumentByPatchID.indexOf(e);-1!==t&&(this.number=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":r.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){return 9===a.get(this).channel},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,name:this.name,number:this.number}},e.prototype.fromJSON=function(e){this.number=e.number},e}();t.Instrument=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],t.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],t.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},function(e,t,n){"use strict";function r(e){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}Object.defineProperty(t,"__esModule",{value:!0});var a,i,o=(a=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,i={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},function(e){var t=a.exec(e),n=t[2];return i[t[1].toLowerCase()]+12*(parseInt(n,10)+1)}),s=new WeakMap,u=function(){function e(e,t,n){s.set(this,n),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=t.velocity,this.ticks=e.ticks,this.durationTicks=t.ticks-e.ticks}return Object.defineProperty(e.prototype,"name",{get:function(){return e=this.midi,t=Math.floor(e/12)-1,r(e)+t.toString();var e,t},set:function(e){this.midi=o(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){this.midi+=12*(e-this.octave)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pitch",{get:function(){return r(this.midi)},set:function(e){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=s.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var t=s.get(this).secondsToTicks(this.time+e);this.durationTicks=t-this.ticks},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return s.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=s.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bars",{get:function(){return s.get(this).ticksToMeasures(this.ticks)},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},e}();t.Note=u},function(e,t,n){"use strict";n.r(t),n.d(t,"tf",(function(){return r})),n.d(t,"aux_inputs",(function(){return a.aux_inputs})),n.d(t,"chords",(function(){return a.chords})),n.d(t,"constants",(function(){return a.constants})),n.d(t,"data",(function(){return a.data})),n.d(t,"logging",(function(){return a.logging})),n.d(t,"melodies",(function(){return a.melodies})),n.d(t,"performance",(function(){return a.performance})),n.d(t,"sequences",(function(){return a.sequences})),n.d(t,"MetronomeCallbackObject",(function(){return a.MetronomeCallbackObject})),n.d(t,"Metronome",(function(){return a.Metronome})),n.d(t,"MidiConversionError",(function(){return a.MidiConversionError})),n.d(t,"midiToSequenceProto",(function(){return a.midiToSequenceProto})),n.d(t,"sequenceProtoToMidi",(function(){return a.sequenceProtoToMidi})),n.d(t,"urlToBlob",(function(){return a.urlToBlob})),n.d(t,"blobToNoteSequence",(function(){return a.blobToNoteSequence})),n.d(t,"urlToNoteSequence",(function(){return a.urlToNoteSequence})),n.d(t,"BasePlayerCallback",(function(){return a.BasePlayerCallback})),n.d(t,"BasePlayer",(function(){return a.BasePlayer})),n.d(t,"Player",(function(){return a.Player})),n.d(t,"SoundFontPlayer",(function(){return a.SoundFontPlayer})),n.d(t,"PlayerWithClick",(function(){return a.PlayerWithClick})),n.d(t,"MIDIPlayer",(function(){return a.MIDIPlayer})),n.d(t,"BaseRecorderCallback",(function(){return a.BaseRecorderCallback})),n.d(t,"Recorder",(function(){return a.Recorder})),n.d(t,"BaseVisualizer",(function(){return a.BaseVisualizer})),n.d(t,"PianoRollCanvasVisualizer",(function(){return a.PianoRollCanvasVisualizer})),n.d(t,"Visualizer",(function(){return a.Visualizer})),n.d(t,"BaseSVGVisualizer",(function(){return a.BaseSVGVisualizer})),n.d(t,"PianoRollSVGVisualizer",(function(){return a.PianoRollSVGVisualizer})),n.d(t,"WaterfallSVGVisualizer",(function(){return a.WaterfallSVGVisualizer})),n.d(t,"ScrollType",(function(){return a.ScrollType})),n.d(t,"StaffSVGVisualizer",(function(){return a.StaffSVGVisualizer})),n.d(t,"Coconet",(function(){return i.Coconet})),n.d(t,"MusicRNN",(function(){return o.MusicRNN})),n.d(t,"MidiMe",(function(){return s.MidiMe})),n.d(t,"Decoder",(function(){return s.Decoder})),n.d(t,"Encoder",(function(){return s.Encoder})),n.d(t,"MusicVAE",(function(){return s.MusicVAE})),n.d(t,"PianoGenie",(function(){return u.PianoGenie})),n.d(t,"PianoGenieKeysig",(function(){return u.PianoGenieKeysig})),n.d(t,"PianoGenieChord",(function(){return u.PianoGenieChord})),n.d(t,"PianoGenieKeysigChordFamily",(function(){return u.PianoGenieKeysigChordFamily})),n.d(t,"PianoGenieKeysigChord",(function(){return u.PianoGenieKeysigChord})),n.d(t,"NoteSequence",(function(){return c.NoteSequence})),n.d(t,"OnsetsAndFrames",(function(){return l.OnsetsAndFrames})),n.d(t,"GANSynth",(function(){return h.GANSynth})),n.d(t,"SPICE",(function(){return d})),n.d(t,"DDSP",(function(){return p.DDSP}));var r=n(2),a=n(173),i=n(176),o=n(177),s=n(178),u=n(179),c=n(171),l=n(175),h=n(174),f=n(24),d=function(){function e(t){_classCallCheck2(this,e),this.modelUrl=t||"https://tfhub.dev/google/tfjs-model/spice/2/default/1"}var t,n;return _createClass2(e,[{key:"initialize",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.h)(this.modelUrl);case 2:this.spiceModel=e.sent,this.initialized=!0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getAudioFeatures",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.g)(t,this.spiceModel,n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"dispose",value:function(){this.initialized&&(this.spiceModel.dispose(),this.initialized=!1)}},{key:"isInitialized",value:function(){return this.initialized}}]),e}(),p=n(172)}])},module.exports=e(__webpack_require__("zhpf"),__webpack_require__("XlTo"))},ie1u:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},"pJ3+":function(e,t,n){var r;!function(a,i){var o,s=this,u=i.pow(256,6),c=i.pow(2,52),l=2*c;function h(e,t,n){var r=[],h=p(function e(t,n){var r,a=[],i=typeof t;if(n&&"object"==i)for(r in t)try{a.push(e(t[r],n-1))}catch(o){}return a.length?a:"string"==i?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,m(a)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(256):(e=new Uint8Array(256),(s.crypto||s.msCrypto).getRandomValues(e)),m(e)}catch(r){var t=s.navigator,n=t&&t.plugins;return[+new Date,s,n,s.screen,m(a)]}}():e,3),r),v=new f(r),g=function(){for(var e=v.g(6),t=u,n=0;e<c;)e=256*(e+n),t*=256,n=v.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return g.int32=function(){return 0|v.g(4)},g.quick=function(){return v.g(4)/4294967296},g.double=g,p(m(v.S),a),(t.pass||n||function(e,t,n,r){return r&&(r.S&&d(r,v),e.state=function(){return d(v,{})}),n?(i.random=e,t):e})(g,h,"global"in t?t.global:this==i,t.state)}function f(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<256;)o[a]=a++;for(a=0;a<256;a++)o[a]=o[i=255&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=255&a+1],n=256*n+o[255&(o[a]=o[i=255&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(256)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function p(e,t){for(var n,r=e+"",a=0;a<r.length;)t[255&a]=255&(n^=19*t[255&a])+r.charCodeAt(a++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(i.seedrandom=h,p(i.random(),a),e.exports){e.exports=h;try{o=n(3)}catch(v){}}else void 0===(r=(function(){return h}).call(t,n,t,e))||(e.exports=r)}([],Math)},pJ6O:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},uDiL:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},yLV6:function(e,t,n){var r;!function(a,i,o,s){"use strict";var u,c=["","webkit","Moz","MS","ms","o"],l=i.createElement("div"),h=Math.round,f=Math.abs,d=Date.now;function p(e,t,n){return setTimeout(k(e,n),t)}function m(e,t,n){return!!Array.isArray(e)&&(v(e,n[t],n),!0)}function v(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(void 0!==e.length)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function g(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",i=a.console&&(a.console.warn||a.console.log);return i&&i.call(a.console,r,n),e.apply(this,arguments)}}u="function"!=typeof Object.assign?function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var a in r)r.hasOwnProperty(a)&&(t[a]=r[a])}return t}:Object.assign;var y=g((function(e,t,n){for(var r=Object.keys(t),a=0;a<r.length;)(!n||n&&void 0===e[r[a]])&&(e[r[a]]=t[r[a]]),a++;return e}),"extend","Use `assign`."),_=g((function(e,t){return y(e,t,!0)}),"merge","Use `assign`.");function b(e,t,n){var r,a=t.prototype;(r=e.prototype=Object.create(a)).constructor=e,r._super=a,n&&u(r,n)}function k(e,t){return function(){return e.apply(t,arguments)}}function w(e,t){return"function"==typeof e?e.apply(t&&t[0]||void 0,t):e}function x(e,t){return void 0===e?t:e}function C(e,t,n){v(E(t),(function(t){e.addEventListener(t,n,!1)}))}function S(e,t,n){v(E(t),(function(t){e.removeEventListener(t,n,!1)}))}function T(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function A(e,t){return e.indexOf(t)>-1}function E(e){return e.trim().split(/\s+/g)}function I(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function R(e){return Array.prototype.slice.call(e,0)}function O(e,t,n){for(var r=[],a=[],i=0;i<e.length;){var o=t?e[i][t]:e[i];I(a,o)<0&&r.push(e[i]),a[i]=o,i++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function N(e,t){for(var n,r,a=t[0].toUpperCase()+t.slice(1),i=0;i<c.length;){if((r=(n=c[i])?n+a:t)in e)return r;i++}}var D=1;function P(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||a}var F="ontouchstart"in a,M=void 0!==N(a,"PointerEvent"),L=F&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),z=["x","y"],B=["clientX","clientY"];function j(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){w(e.options.enable,[e])&&n.handler(t)},this.init()}function V(e,t,n){var r=n.pointers.length,a=n.changedPointers.length,i=1&t&&r-a==0,o=12&t&&r-a==0;n.isFirst=!!i,n.isFinal=!!o,i&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,a=r.length;n.firstInput||(n.firstInput=q(t)),a>1&&!n.firstMultiple?n.firstMultiple=q(t):1===a&&(n.firstMultiple=!1);var i=n.firstInput,o=n.firstMultiple,s=o?o.center:i.center,u=t.center=U(r);t.timeStamp=d(),t.deltaTime=t.timeStamp-i.timeStamp,t.angle=K(s,u),t.distance=H(s,u),function(e,t){var n=t.center,r=e.offsetDelta||{},a=e.prevDelta||{},i=e.prevInput||{};1!==t.eventType&&4!==i.eventType||(a=e.prevDelta={x:i.deltaX||0,y:i.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=a.x+(n.x-r.x),t.deltaY=a.y+(n.y-r.y)}(n,t),t.offsetDirection=G(t.deltaX,t.deltaY);var c,l,h=W(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=h.x,t.overallVelocityY=h.y,t.overallVelocity=f(h.x)>f(h.y)?h.x:h.y,t.scale=o?(c=o.pointers,H((l=r)[0],l[1],B)/H(c[0],c[1],B)):1,t.rotation=o?function(e,t){return K(t[1],t[0],B)+K(e[1],e[0],B)}(o.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,a,i,o=e.lastInterval||t,s=t.timeStamp-o.timeStamp;if(8!=t.eventType&&(s>25||void 0===o.velocity)){var u=t.deltaX-o.deltaX,c=t.deltaY-o.deltaY,l=W(s,u,c);r=l.x,a=l.y,n=f(l.x)>f(l.y)?l.x:l.y,i=G(u,c),e.lastInterval=t}else n=o.velocity,r=o.velocityX,a=o.velocityY,i=o.direction;t.velocity=n,t.velocityX=r,t.velocityY=a,t.direction=i}(n,t);var p=e.element;T(t.srcEvent.target,p)&&(p=t.srcEvent.target),t.target=p}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function q(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:h(e.pointers[n].clientX),clientY:h(e.pointers[n].clientY)},n++;return{timeStamp:d(),pointers:t,center:U(t),deltaX:e.deltaX,deltaY:e.deltaY}}function U(e){var t=e.length;if(1===t)return{x:h(e[0].clientX),y:h(e[0].clientY)};for(var n=0,r=0,a=0;a<t;)n+=e[a].clientX,r+=e[a].clientY,a++;return{x:h(n/t),y:h(r/t)}}function W(e,t,n){return{x:t/e||0,y:n/e||0}}function G(e,t){return e===t?1:f(e)>=f(t)?e<0?2:4:t<0?8:16}function H(e,t,n){n||(n=z);var r=t[n[0]]-e[n[0]],a=t[n[1]]-e[n[1]];return Math.sqrt(r*r+a*a)}function K(e,t,n){return n||(n=z),180*Math.atan2(t[n[1]]-e[n[1]],t[n[0]]-e[n[0]])/Math.PI}j.prototype={handler:function(){},init:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(P(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(P(this.element),this.evWin,this.domHandler)}};var X={mousedown:1,mousemove:2,mouseup:4};function Q(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,j.apply(this,arguments)}b(Q,j,{handler:function(e){var t=X[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var Y={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Z={2:"touch",3:"pen",4:"mouse",5:"kinect"},J="pointerdown",$="pointermove pointerup pointercancel";function ee(){this.evEl=J,this.evWin=$,j.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}a.MSPointerEvent&&!a.PointerEvent&&(J="MSPointerDown",$="MSPointerMove MSPointerUp MSPointerCancel"),b(ee,j,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),a=Y[r],i=Z[e.pointerType]||e.pointerType,o="touch"==i,s=I(t,e.pointerId,"pointerId");1&a&&(0===e.button||o)?s<0&&(t.push(e),s=t.length-1):12&a&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,a,{pointers:t,changedPointers:[e],pointerType:i,srcEvent:e}),n&&t.splice(s,1))}});var te={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ne(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,j.apply(this,arguments)}function re(e,t){var n=R(e.touches),r=R(e.changedTouches);return 12&t&&(n=O(n.concat(r),"identifier",!0)),[n,r]}b(ne,j,{handler:function(e){var t=te[e.type];if(1===t&&(this.started=!0),this.started){var n=re.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var ae={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ie(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},j.apply(this,arguments)}function oe(e,t){var n=R(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var a,i,o=R(e.changedTouches),s=[],u=this.target;if(i=n.filter((function(e){return T(e.target,u)})),1===t)for(a=0;a<i.length;)r[i[a].identifier]=!0,a++;for(a=0;a<o.length;)r[o[a].identifier]&&s.push(o[a]),12&t&&delete r[o[a].identifier],a++;return s.length?[O(i.concat(s),"identifier",!0),s]:void 0}function se(){j.apply(this,arguments);var e=k(this.handler,this);this.touch=new ie(this.manager,e),this.mouse=new Q(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function ue(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ce.call(this,t)):12&e&&ce.call(this,t)}function ce(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function le(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var a=this.lastTouches[r],i=Math.abs(t-a.x),o=Math.abs(n-a.y);if(i<=25&&o<=25)return!0}return!1}b(ie,j,{handler:function(e){var t=ae[e.type],n=oe.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}),b(se,j,{handler:function(e,t,n){var r="mouse"==n.pointerType;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if("touch"==n.pointerType)ue.call(this,t,n);else if(r&&le.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var he=N(l.style,"touchAction"),fe=void 0!==he,de=function(){if(!fe)return!1;var e={},t=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||a.CSS.supports("touch-action",n)})),e}();function pe(e,t){this.manager=e,this.set(t)}function me(e){this.options=u({},this.defaults,e||{}),this.id=D++,this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function ve(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function ge(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function ye(e,t){var n=t.manager;return n?n.get(e):e}function _e(){me.apply(this,arguments)}function be(){_e.apply(this,arguments),this.pX=null,this.pY=null}function ke(){_e.apply(this,arguments)}function we(){me.apply(this,arguments),this._timer=null,this._input=null}function xe(){_e.apply(this,arguments)}function Ce(){_e.apply(this,arguments)}function Se(){me.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Te(e,t){return(t=t||{}).recognizers=x(t.recognizers,Te.defaults.preset),new Ae(e,t)}function Ae(e,t){var n;this.options=u({},Te.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(M?ee:L?ie:F?se:Q))(n,V),this.touchAction=new pe(this,this.options.touchAction),Ee(this,!0),v(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function Ee(e,t){var n,r=e.element;r.style&&(v(e.options.cssProps,(function(a,i){n=N(r.style,i),t?(e.oldCssProps[n]=r.style[n],r.style[n]=a):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}pe.prototype={set:function(e){"compute"==e&&(e=this.compute()),fe&&this.manager.element.style&&de[e]&&(this.manager.element.style[he]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return v(this.manager.recognizers,(function(t){w(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(A(e,"none"))return"none";var t=A(e,"pan-x"),n=A(e,"pan-y");return t&&n?"none":t||n?t?"pan-x":"pan-y":A(e,"manipulation")?"manipulation":"auto"}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,a=A(r,"none")&&!de.none,i=A(r,"pan-y")&&!de["pan-y"],o=A(r,"pan-x")&&!de["pan-x"];if(a&&1===e.pointers.length&&e.distance<2&&e.deltaTime<250)return;if(!o||!i)return a||i&&6&n||o&&24&n?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}},me.prototype={defaults:{},set:function(e){return u(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(m(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=ye(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return m(e,"dropRecognizeWith",this)||(e=ye(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(m(e,"requireFailure",this))return this;var t=this.requireFail;return-1===I(t,e=ye(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(m(e,"dropRequireFailure",this))return this;e=ye(e,this);var t=I(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+ve(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+ve(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=u({},e);if(!w(this.options.enable,[this,t]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},b(_e,me,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,a=this.attrTest(e);return r&&(8&n||!a)?16|t:r||a?4&n?8|t:2&t?4|t:2:32}}),b(be,_e,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push("pan-y"),24&e&&t.push("pan-x"),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,a=e.direction,i=e.deltaX,o=e.deltaY;return a&t.direction||(6&t.direction?(a=0===i?1:i<0?2:4,n=i!=this.pX,r=Math.abs(e.deltaX)):(a=0===o?1:o<0?8:16,n=o!=this.pY,r=Math.abs(e.deltaY))),e.direction=a,n&&r>t.threshold&&a&t.direction},attrTest:function(e){return _e.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=ge(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),b(ke,_e,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){1!==e.scale&&(e.additionalEvent=this.options.event+(e.scale<1?"in":"out")),this._super.emit.call(this,e)}}),b(we,me,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,a=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!a)this.reset();else if(1&e.eventType)this.reset(),this._timer=p((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}}),b(xe,_e,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),b(Ce,_e,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return be.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:24&n&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&f(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=ge(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),b(Se,me,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,a=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&a&&n){if(4!=e.eventType)return this.failTimeout();var i=!this.pTime||e.timeStamp-this.pTime<t.interval,o=!this.pCenter||H(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,o&&i?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=p((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return 32},failTimeout:function(){return this._timer=p((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Te.VERSION="2.0.7",Te.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[xe,{enable:!1}],[ke,{enable:!1},["rotate"]],[Ce,{direction:6}],[be,{direction:6},["swipe"]],[Se],[Se,{event:"doubletap",taps:2},["tap"]],[we]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Ae.prototype={set:function(e){return u(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,a=t.curRecognizer;(!a||a&&8&a.state)&&(a=t.curRecognizer=null);for(var i=0;i<r.length;)n=r[i],2===t.stopped||a&&n!=a&&!n.canRecognizeWith(a)?n.reset():n.recognize(e),!a&&14&n.state&&(a=t.curRecognizer=n),i++}},get:function(e){if(e instanceof me)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(m(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(m(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=I(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(void 0!==e&&void 0!==t){var n=this.handlers;return v(E(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(void 0!==e){var n=this.handlers;return v(E(e),(function(e){t?n[e]&&n[e].splice(I(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=i.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&Ee(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},u(Te,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Ae,Input:j,TouchAction:pe,TouchInput:ie,MouseInput:Q,PointerEventInput:ee,TouchMouseInput:se,SingleTouchInput:ne,Recognizer:me,AttrRecognizer:_e,Tap:Se,Pan:be,Swipe:Ce,Pinch:ke,Rotate:xe,Press:we,on:C,off:S,each:v,merge:_,extend:y,assign:u,inherit:b,bindFn:k,prefixed:N}),(void 0!==a?a:"undefined"!=typeof self?self:{}).Hammer=Te,void 0===(r=(function(){return Te}).call(t,n,t,e))||(e.exports=r)}(window,document)},yuCN:function(e,t,n){(function(e){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],r[a]=n^=(e^=e<<13)^e<<9,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n("B9Yq")&&n("PDX0")?void 0===(r=(function(){return u}).call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e,n("B9Yq"))}).call(this,n("YuTi")(e))},zUnb:function(e,t,n){"use strict";function r(e){return"function"==typeof e}n.r(t),n("yLV6");var a=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else a&&console.log("RxJS: Back to a better error behavior. Thank you. <3");a=e},get useDeprecatedSynchronousErrorHandling(){return a}};function o(e){setTimeout((function(){throw e}))}var s={closed:!0,next:function(e){},error:function(e){if(i.useDeprecatedSynchronousErrorHandling)throw e;o(e)},complete:function(){}},u=Array.isArray||function(e){return e&&"number"==typeof e.length};function c(e){return null!==e&&"object"==typeof e}function l(e){return Error.call(this),this.message=e?"".concat(e.length," errors occurred during unsubscription:\n").concat(e.map((function(e,t){return"".concat(t+1,") ").concat(e.toString())})).join("\n  ")):"",this.name="UnsubscriptionError",this.errors=e,this}l.prototype=Object.create(Error.prototype);var h,f=l,d=((h=function(){function e(t){_classCallCheck2(this,e),this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}return _createClass2(e,[{key:"unsubscribe",value:function(){var e,t=!1;if(!this.closed){var n=this._parent,a=this._parents,i=this._unsubscribe,o=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var s=-1,l=a?a.length:0;n;)n.remove(this),n=++s<l&&a[s]||null;if(r(i))try{i.call(this)}catch(d){t=!0,e=d instanceof f?p(d.errors):[d]}if(u(o))for(s=-1,l=o.length;++s<l;){var h=o[s];if(c(h))try{h.unsubscribe()}catch(d){t=!0,e=e||[],d instanceof f?e=e.concat(p(d.errors)):e.push(d)}}if(t)throw new f(e)}}},{key:"add",value:function(t){var n=t;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:if(!t)return e.EMPTY;throw new Error("unrecognized teardown "+t+" added to Subscription.")}if(n._addParent(this)){var a=this._subscriptions;a?a.push(n):this._subscriptions=[n]}return n}},{key:"remove",value:function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}}},{key:"_addParent",value:function(e){var t=this._parent,n=this._parents;return t!==e&&(t?n?-1===n.indexOf(e)&&(n.push(e),!0):(this._parents=[e],!0):(this._parent=e,!0))}}]),e}()).EMPTY=function(e){return e.closed=!0,e}(new h),h);function p(e){return e.reduce((function(e,t){return e.concat(t instanceof f?t.errors:t)}),[])}var m="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),v=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;switch(_classCallCheck2(this,n),(i=t.call(this)).syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=s;break;case 1:if(!e){i.destination=s;break}if("object"==typeof e){e instanceof n?(i.syncErrorThrowable=e.syncErrorThrowable,i.destination=e,e.add(_assertThisInitialized(i))):(i.syncErrorThrowable=!0,i.destination=new g(_assertThisInitialized(i),e));break}default:i.syncErrorThrowable=!0,i.destination=new g(_assertThisInitialized(i),e,r,a)}return i}return _createClass2(n,[{key:m,value:function(){return this}},{key:"next",value:function(e){this.isStopped||this._next(e)}},{key:"error",value:function(e){this.isStopped||(this.isStopped=!0,this._error(e))}},{key:"complete",value:function(){this.isStopped||(this.isStopped=!0,this._complete())}},{key:"unsubscribe",value:function(){this.closed||(this.isStopped=!0,_get(_getPrototypeOf(n.prototype),"unsubscribe",this).call(this))}},{key:"_next",value:function(e){this.destination.next(e)}},{key:"_error",value:function(e){this.destination.error(e),this.unsubscribe()}},{key:"_complete",value:function(){this.destination.complete(),this.unsubscribe()}},{key:"_unsubscribeAndRecycle",value:function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this}}],[{key:"create",value:function(e,t,r){var a=new n(e,t,r);return a.syncErrorThrowable=!1,a}}]),n}(d),g=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a,i,o){var u,c;_classCallCheck2(this,n),(u=t.call(this))._parentSubscriber=e;var l=_assertThisInitialized(u);return r(a)?c=a:a&&(c=a.next,i=a.error,o=a.complete,a!==s&&(r((l=Object.create(a)).unsubscribe)&&u.add(l.unsubscribe.bind(l)),l.unsubscribe=u.unsubscribe.bind(_assertThisInitialized(u)))),u._context=l,u._next=c,u._error=i,u._complete=o,u}return _createClass2(n,[{key:"next",value:function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;i.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}},{key:"error",value:function(e){if(!this.isStopped){var t=this._parentSubscriber,n=i.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):o(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;o(e)}}}},{key:"complete",value:function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};i.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}},{key:"__tryOrUnsub",value:function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),i.useDeprecatedSynchronousErrorHandling)throw n;o(n)}}},{key:"__tryOrSetError",value:function(e,t,n){if(!i.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return i.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(o(r),!0)}return!1}},{key:"_unsubscribe",value:function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}]),n}(v),y="function"==typeof Symbol&&Symbol.observable||"@@observable";function _(){}function b(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return k(t)}function k(e){return e?1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}:_}var w,x=((w=function(){function e(t){_classCallCheck2(this,e),this._isScalar=!1,t&&(this._subscribe=t)}return _createClass2(e,[{key:"lift",value:function(t){var n=new e;return n.source=this,n.operator=t,n}},{key:"subscribe",value:function(e,t,n){var r=this.operator,a=function(e,t,n){if(e){if(e instanceof v)return e;if(e[m])return e[m]()}return e||t||n?new v(e,t,n):new v(s)}(e,t,n);if(a.add(r?r.call(a,this.source):this.source||i.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),i.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a}},{key:"_trySubscribe",value:function(e){try{return this._subscribe(e)}catch(t){i.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,n=t.closed,r=t.destination,a=t.isStopped;if(n||a)return!1;e=r&&r instanceof v?r:null}return!0}(e)?e.error(t):console.warn(t)}}},{key:"forEach",value:function(e,t){var n=this;return new(t=C(t))((function(t,r){var a;a=n.subscribe((function(t){try{e(t)}catch(n){r(n),a&&a.unsubscribe()}}),r,t)}))}},{key:"_subscribe",value:function(e){var t=this.source;return t&&t.subscribe(e)}},{key:y,value:function(){return this}},{key:"pipe",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?this:k(t)(this)}},{key:"toPromise",value:function(e){var t=this;return new(e=C(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))}}]),e}()).create=function(e){return new w(e)},w);function C(e){if(e||(e=i.Promise||Promise),!e)throw new Error("no Promise impl found");return e}function S(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}S.prototype=Object.create(Error.prototype);var T,A=S,E=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this)).subject=e,a.subscriber=r,a.closed=!1,a}return _createClass2(n,[{key:"unsubscribe",value:function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}}}]),n}(d),I=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).destination=e,r}return n}(v),R=((T=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.call(this)).observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return _createClass2(n,[{key:m,value:function(){return new I(this)}},{key:"lift",value:function(e){var t=new O(this,this);return t.operator=e,t}},{key:"next",value:function(e){if(this.closed)throw new A;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),a=0;a<n;a++)r[a].next(e)}},{key:"error",value:function(e){if(this.closed)throw new A;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),a=0;a<n;a++)r[a].error(e);this.observers.length=0}},{key:"complete",value:function(){if(this.closed)throw new A;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0}},{key:"unsubscribe",value:function(){this.isStopped=!0,this.closed=!0,this.observers=null}},{key:"_trySubscribe",value:function(e){if(this.closed)throw new A;return _get(_getPrototypeOf(n.prototype),"_trySubscribe",this).call(this,e)}},{key:"_subscribe",value:function(e){if(this.closed)throw new A;return this.hasError?(e.error(this.thrownError),d.EMPTY):this.isStopped?(e.complete(),d.EMPTY):(this.observers.push(e),new E(this,e))}},{key:"asObservable",value:function(){var e=new x;return e.source=this,e}}]),n}(x)).create=function(e,t){return new O(e,t)},T),O=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this)).destination=e,a.source=r,a}return _createClass2(n,[{key:"next",value:function(e){var t=this.destination;t&&t.next&&t.next(e)}},{key:"error",value:function(e){var t=this.destination;t&&t.error&&this.destination.error(e)}},{key:"complete",value:function(){var e=this.destination;e&&e.complete&&this.destination.complete()}},{key:"_subscribe",value:function(e){return this.source?this.source.subscribe(e):d.EMPTY}}]),n}(R);function N(e){return e&&"function"==typeof e.schedule}var D=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this)).parent=e,i.outerValue=r,i.outerIndex=a,i.index=0,i}return _createClass2(n,[{key:"_next",value:function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}},{key:"_error",value:function(e){this.parent.notifyError(e,this),this.unsubscribe()}},{key:"_complete",value:function(){this.parent.notifyComplete(this),this.unsubscribe()}}]),n}(v),P=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.closed||t.complete()}},F=function(e){return function(t){return e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,o),t}};var M="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",L=function(e){return function(t){for(var n=e[M]();;){var r=n.next();if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t}},z=function(e){return function(t){var n=e[y]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}},B=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function j(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var V=function(e){if(e instanceof x)return function(t){return e._isScalar?(t.next(e.value),void t.complete()):e.subscribe(t)};if(e&&"function"==typeof e[y])return z(e);if(B(e))return P(e);if(j(e))return F(e);if(e&&"function"==typeof e[M])return L(e);var t=c(e)?"an invalid object":"'".concat(e,"'");throw new TypeError("You provided ".concat(t," where a stream was expected. You can provide an Observable, Promise, Array, or Iterable."))};function q(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new D(e,n,r);if(!a.closed)return V(t)(a)}var U=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"notifyNext",value:function(e,t,n,r,a){this.destination.next(t)}},{key:"notifyError",value:function(e,t){this.destination.error(e)}},{key:"notifyComplete",value:function(e){this.destination.complete()}}]),n}(v);function W(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new G(e,t))}}var G=function(){function e(t,n){_classCallCheck2(this,e),this.project=t,this.thisArg=n}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new H(e,this.project,this.thisArg))}}]),e}(),H=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,e)).project=r,i.count=0,i.thisArg=a||_assertThisInitialized(i),i}return _createClass2(n,[{key:"_next",value:function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),n}(v);function K(e,t){return new x(t?function(n){var r=new d,a=0;return r.add(t.schedule((function(){a!==e.length?(n.next(e[a++]),n.closed||r.add(this.schedule())):n.complete()}))),r}:P(e))}function X(e,t){if(!t)return e instanceof x?e:new x(V(e));if(null!=e){if(function(e){return e&&"function"==typeof e[y]}(e))return function(e,t){return new x(t?function(n){var r=new d;return r.add(t.schedule((function(){var a=e[y]();r.add(a.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}:z(e))}(e,t);if(j(e))return function(e,t){return new x(t?function(n){var r=new d;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}:F(e))}(e,t);if(B(e))return K(e,t);if(function(e){return e&&"function"==typeof e[M]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new x(t?function(n){var r,a=new d;return a.add((function(){r&&"function"==typeof r.return&&r.return()})),a.add(t.schedule((function(){r=e[M](),a.add(t.schedule((function(){if(!n.closed){var e,t;try{var a=r.next();e=a.value,t=a.done}catch(i){return void n.error(i)}t?n.complete():(n.next(e),this.schedule())}})))}))),a}:L(e))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}function Q(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"function"==typeof t?function(r){return r.pipe(Q((function(n,r){return X(e(n,r)).pipe(W((function(e,a){return t(n,e,r,a)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new Y(e,n))})}var Y=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY;_classCallCheck2(this,e),this.project=t,this.concurrent=n}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new Z(e,this.project,this.concurrent))}}]),e}(),Z=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return _classCallCheck2(this,n),(a=t.call(this,e)).project=r,a.concurrent=i,a.hasCompleted=!1,a.buffer=[],a.active=0,a.index=0,a}return _createClass2(n,[{key:"_next",value:function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}},{key:"_tryNext",value:function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t,e,n)}},{key:"_innerSub",value:function(e,t,n){var r=new D(this,void 0,void 0);this.destination.add(r),q(this,e,t,n,r)}},{key:"_complete",value:function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}},{key:"notifyNext",value:function(e,t,n,r,a){this.destination.next(t)}},{key:"notifyComplete",value:function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}]),n}(U);function J(e){return e}function $(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;return Q(J,e)}function ee(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Number.POSITIVE_INFINITY,a=null,i=t[t.length-1];return N(i)?(a=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(r=t.pop())):"number"==typeof i&&(r=t.pop()),null===a&&1===t.length&&t[0]instanceof x?t[0]:$(r)(K(t,a))}function te(){return function(e){return e.lift(new ne(e))}}var ne=function(){function e(t){_classCallCheck2(this,e),this.connectable=t}return _createClass2(e,[{key:"call",value:function(e,t){var n=this.connectable;n._refCount++;var r=new re(e,n),a=t.subscribe(r);return r.closed||(r.connection=n.connect()),a}}]),e}(),re=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e)).connectable=r,a}return _createClass2(n,[{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null}}]),n}(v),ae=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this)).source=e,a.subjectFactory=r,a._refCount=0,a._isComplete=!1,a}return _createClass2(n,[{key:"_subscribe",value:function(e){return this.getSubject().subscribe(e)}},{key:"getSubject",value:function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject}},{key:"connect",value:function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new d).add(this.source.subscribe(new oe(this.getSubject(),this))),e.closed?(this._connection=null,e=d.EMPTY):this._connection=e),e}},{key:"refCount",value:function(){return te()(this)}}]),n}(x).prototype,ie={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:ae._subscribe},_isComplete:{value:ae._isComplete,writable:!0},getSubject:{value:ae.getSubject},connect:{value:ae.connect},refCount:{value:ae.refCount}},oe=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e)).connectable=r,a}return _createClass2(n,[{key:"_error",value:function(e){this._unsubscribe(),_get(_getPrototypeOf(n.prototype),"_error",this).call(this,e)}},{key:"_complete",value:function(){this.connectable._isComplete=!0,this._unsubscribe(),_get(_getPrototypeOf(n.prototype),"_complete",this).call(this)}},{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}]),n}(I);function se(){return new R}function ue(){return function(e){return te()((t=se,function(e){var n;n="function"==typeof t?t:function(){return t};var r=Object.create(e,ie);return r.source=e,r.subjectFactory=n,r})(e));var t}}function ce(e,t,n){var r=function(e){return function(){if(e){var t=e.apply(void 0,arguments);for(var n in t)this[n]=t[n]}}}(t);function a(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(this instanceof a)return r.apply(this,t),this;var i=_construct(a,t);return o.annotation=i,o;function o(e,t,n){for(var r=e.hasOwnProperty("__parameters__")?e.__parameters__:Object.defineProperty(e,"__parameters__",{value:[]}).__parameters__;r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(i),e}}return n&&(a.prototype=Object.create(n.prototype)),a.prototype.ngMetadataName=e,a.annotationCls=a,a}var le=ce("Inject",(function(e){return{token:e}})),he=ce("Optional"),fe=ce("Self"),de=ce("SkipSelf"),pe=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}({});function me(e){for(var t in e)if(e[t]===me)return t;throw Error("Could not find renamed property on target object.")}function ve(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function ge(e){var t=e[ye];return t&&t.token===e?t:null}var ye=me({ngInjectableDef:me});function _e(e){if("string"==typeof e)return e;if(e instanceof Array)return"["+e.map(_e).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return""+e.overriddenName;if(e.name)return""+e.name;var t=e.toString();if(null==t)return""+t;var n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}var be=me({__forward_ref__:me});function ke(e){return e.__forward_ref__=ke,e.toString=function(){return _e(this())},e}function we(e){var t=e;return"function"==typeof t&&t.hasOwnProperty(be)&&t.__forward_ref__===ke?t():e}var xe="undefined"!=typeof globalThis&&globalThis,Ce="undefined"!=typeof window&&window,Se="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Te="undefined"!=typeof global&&global,Ae=xe||Te||Ce||Se,Ee=function(){function e(t,n){_classCallCheck2(this,e),this._desc=t,this.ngMetadataName="InjectionToken",this.ngInjectableDef=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.ngInjectableDef=ve({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}return _createClass2(e,[{key:"toString",value:function(){return"InjectionToken "+this._desc}}]),e}(),Ie=new Ee("INJECTOR",-1),Re=new Object,Oe=/\n/gm,Ne=me({provide:String,useValue:me}),De=void 0;function Pe(e){var t=De;return De=e,t}function Fe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pe.Default;return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pe.Default;if(void 0===De)throw new Error("inject() must be called from an injection context");return null===De?function(e,t,n){var r=ge(e);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&pe.Optional)return null;throw new Error("Injector: NOT_FOUND [".concat(_e(e),"]"))}(e,0,t):De.get(e,t&pe.Optional?null:void 0,t)}(e,t)}var Me=Fe,Le=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Re;if(t===Re){var n=new Error("NullInjectorError: No provider for ".concat(_e(e),"!"));throw n.name="NullInjectorError",n}return t}}]),e}();function ze(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;var a=_e(t);if(t instanceof Array)a=t.map(_e).join(" -> ");else if("object"==typeof t){var i=[];for(var o in t)if(t.hasOwnProperty(o)){var s=t[o];i.push(o+":"+("string"==typeof s?JSON.stringify(s):_e(s)))}a="{".concat(i.join(", "),"}")}return"".concat(n).concat(r?"("+r+")":"","[").concat(a,"]: ").concat(e.replace(Oe,"\n  "))}var Be=function e(){_classCallCheck2(this,e)},je=function e(){_classCallCheck2(this,e)};function Ve(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function qe(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}var Ue=function(){var e={Emulated:0,Native:1,None:2,ShadowDom:3};return e[e.Emulated]="Emulated",e[e.Native]="Native",e[e.None]="None",e[e.ShadowDom]="ShadowDom",e}(),We=("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Ae);function Ge(e){return e.ngDebugContext}function He(e){return e.ngOriginalError}function Ke(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e.error.apply(e,n)}var Xe=function(){function e(){_classCallCheck2(this,e),this._console=console}return _createClass2(e,[{key:"handleError",value:function(e){var t=this._findOriginalError(e),n=this._findContext(e),r=function(e){return e.ngErrorLogger||Ke}(e);r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}},{key:"_findContext",value:function(e){return e?Ge(e)?Ge(e):this._findContext(He(e)):null}},{key:"_findOriginalError",value:function(e){for(var t=He(e);t&&He(t);)t=He(t);return t}}]),e}(),Qe=!0,Ye=!1;function Ze(){return Ye=!0,Qe}var Je=function(){function e(t){if(_classCallCheck2(this,e),this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),this.inertBodyElement=this.inertDocument.body,null==this.inertBodyElement){var n=this.inertDocument.createElement("html");this.inertDocument.appendChild(n),this.inertBodyElement=this.inertDocument.createElement("body"),n.appendChild(this.inertBodyElement)}this.inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>',!this.inertBodyElement.querySelector||this.inertBodyElement.querySelector("svg")?(this.inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">',this.getInertBodyElement=this.inertBodyElement.querySelector&&this.inertBodyElement.querySelector("svg img")&&function(){try{return!!window.DOMParser}catch(e){return!1}}()?this.getInertBodyElement_DOMParser:this.getInertBodyElement_InertDocument):this.getInertBodyElement=this.getInertBodyElement_XHR}return _createClass2(e,[{key:"getInertBodyElement_XHR",value:function(e){e="<body><remove></remove>"+e+"</body>";try{e=encodeURI(e)}catch(r){return null}var t=new XMLHttpRequest;t.responseType="document",t.open("GET","data:text/html;charset=utf-8,"+e,!1),t.send(void 0);var n=t.response.body;return n.removeChild(n.firstChild),n}},{key:"getInertBodyElement_DOMParser",value:function(e){e="<body><remove></remove>"+e+"</body>";try{var t=(new window.DOMParser).parseFromString(e,"text/html").body;return t.removeChild(t.firstChild),t}catch(n){return null}}},{key:"getInertBodyElement_InertDocument",value:function(e){var t=this.inertDocument.createElement("template");return"content"in t?(t.innerHTML=e,t):(this.inertBodyElement.innerHTML=e,this.defaultDoc.documentMode&&this.stripCustomNsAttrs(this.inertBodyElement),this.inertBodyElement)}},{key:"stripCustomNsAttrs",value:function(e){for(var t=e.attributes,n=t.length-1;0<n;n--){var r=t.item(n).name;"xmlns:ns1"!==r&&0!==r.indexOf("ns1:")||e.removeAttribute(r)}for(var a=e.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(a),a=a.nextSibling}}]),e}(),$e=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,et=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function tt(e){return(e=String(e)).match($e)||e.match(et)?e:(Ze()&&console.warn("WARNING: sanitizing unsafe URL value ".concat(e," (see http://g.co/ng/security#xss)")),"unsafe:"+e)}function nt(e){var t,n={},r=_createForOfIteratorHelper(e.split(","));try{for(r.s();!(t=r.n()).done;){n[t.value]=!0}}catch(a){r.e(a)}finally{r.f()}return n}function rt(){for(var e={},t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];for(var s in o)o.hasOwnProperty(s)&&(e[s]=!0)}return e}var at,it=nt("area,br,col,hr,img,wbr"),ot=nt("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),st=nt("rp,rt"),ut=rt(st,ot),ct=rt(it,rt(ot,nt("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),rt(st,nt("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),ut),lt=nt("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),ht=nt("srcset"),ft=rt(lt,ht,nt("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),nt("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),dt=nt("script,style,template"),pt=function(){function e(){_classCallCheck2(this,e),this.sanitizedSomething=!1,this.buf=[]}return _createClass2(e,[{key:"sanitizeChildren",value:function(e){for(var t=e.firstChild,n=!0;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);var r=this.checkClobberedElement(t,t.nextSibling);if(r){t=r;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}},{key:"startElement",value:function(e){var t=e.nodeName.toLowerCase();if(!ct.hasOwnProperty(t))return this.sanitizedSomething=!0,!dt.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);for(var n,r=e.attributes,a=0;a<r.length;a++){var i=r.item(a),o=i.name,s=o.toLowerCase();if(ft.hasOwnProperty(s)){var u=i.value;lt[s]&&(u=tt(u)),ht[s]&&(n=u,u=(n=String(n)).split(",").map((function(e){return tt(e.trim())})).join(", ")),this.buf.push(" ",o,'="',gt(u),'"')}else this.sanitizedSomething=!0}return this.buf.push(">"),!0}},{key:"endElement",value:function(e){var t=e.nodeName.toLowerCase();ct.hasOwnProperty(t)&&!it.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}},{key:"chars",value:function(e){this.buf.push(gt(e))}},{key:"checkClobberedElement",value:function(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error("Failed to sanitize html because the element is clobbered: "+e.outerHTML);return t}}]),e}(),mt=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,vt=/([^\#-~ |!])/g;function gt(e){return e.replace(/&/g,"&amp;").replace(mt,(function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"})).replace(vt,(function(e){return"&#"+e.charCodeAt(0)+";"})).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function yt(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var _t=function(){var e={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return e[e.NONE]="NONE",e[e.HTML]="HTML",e[e.STYLE]="STYLE",e[e.SCRIPT]="SCRIPT",e[e.URL]="URL",e[e.RESOURCE_URL]="RESOURCE_URL",e}(),bt=function e(){_classCallCheck2(this,e)},kt=new RegExp("^([-,.\"'%_!# a-zA-Z0-9]+|(?:(?:matrix|translate|scale|rotate|skew|perspective)(?:X|Y|Z|3d)?|(?:rgb|hsl)a?|(?:repeating-)?(?:linear|radial)-gradient|(?:calc|attr))\\([-0-9.%, #a-zA-Z]+\\))$","g"),wt=/^url\(([^)]+)\)$/,xt=/([A-Z])/g;function Ct(e){try{return null!=e?e.toString().slice(0,30):e}catch(t){return"[ERROR] Exception while trying to serialize the value"}}var St=function(){var e=function e(){_classCallCheck2(this,e)};return e.__NG_ELEMENT_ID__=function(){return Tt()},e}(),Tt=function(){},At=new Ee("The presence of this token marks an injector as being the root injector."),Et=function(e,t,n){return new Pt(e,t,n)},It=function(){var e=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,null,[{key:"create",value:function(e,t){return Array.isArray(e)?Et(e,t,""):Et(e.providers,e.parent,e.name||"")}}]),e}();return e.THROW_IF_NOT_FOUND=Re,e.NULL=new Le,e.ngInjectableDef=ve({token:e,providedIn:"any",factory:function(){return Fe(Ie)}}),e.__NG_ELEMENT_ID__=-1,e}(),Rt=function(e){return e},Ot=[],Nt=Rt,Dt=function(){return Array.prototype.slice.call(arguments)},Pt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:It.NULL,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck2(this,e),this.parent=n,this.source=r;var a=this._records=new Map;a.set(It,{token:It,fn:Rt,deps:Ot,value:this,useNew:!1}),a.set(Ie,{token:Ie,fn:Rt,deps:Ot,value:this,useNew:!1}),function e(t,n){if(n)if((n=we(n))instanceof Array)for(var r=0;r<n.length;r++)e(t,n[r]);else{if("function"==typeof n)throw Mt("Function/Class not supported",n);if(!n||"object"!=typeof n||!n.provide)throw Mt("Unexpected provider",n);var a=we(n.provide),i=function(e){var t=function(e){var t=Ot,n=e.deps;if(n&&n.length){t=[];for(var r=0;r<n.length;r++){var a=6,i=we(n[r]);if(i instanceof Array)for(var o=0,s=i;o<s.length;o++){var u=s[o];u instanceof he||u==he?a|=1:u instanceof de||u==de?a&=-3:u instanceof fe||u==fe?a&=-5:i=u instanceof le?u.token:we(u)}t.push({token:i,options:a})}}else if(e.useExisting)t=[{token:we(e.useExisting),options:6}];else if(!(n||Ne in e))throw Mt("'deps' required",e);return t}(e),n=Rt,r=Ot,a=!1,i=we(e.provide);if(Ne in e)r=e.useValue;else if(e.useFactory)n=e.useFactory;else if(e.useExisting);else if(e.useClass)a=!0,n=we(e.useClass);else{if("function"!=typeof i)throw Mt("StaticProvider does not have [useValue|useFactory|useExisting|useClass] or [provide] is not newable",e);a=!0,n=i}return{deps:t,fn:n,useNew:a,value:r}}(n);if(!0===n.multi){var o=t.get(a);if(o){if(o.fn!==Dt)throw Ft(a)}else t.set(a,o={token:n.provide,deps:[],useNew:!1,fn:Dt,value:Ot});a=n,o.deps.push({token:a,options:6})}var s=t.get(a);if(s&&s.fn==Dt)throw Ft(a);t.set(a,i)}}(a,t)}return _createClass2(e,[{key:"get",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:pe.Default,r=this._records.get(e);try{return function e(t,n,r,a,i,o){try{return function(t,n,r,a,i,o){var s;if(!n||o&pe.SkipSelf)o&pe.Self||(s=a.get(t,i,pe.Default));else{if((s=n.value)==Nt)throw Error("\u0275Circular dependency");if(s===Ot){n.value=Nt;var u=n.useNew,c=n.fn,l=n.deps,h=Ot;if(l.length){h=[];for(var f=0;f<l.length;f++){var d=l[f],p=d.options,m=2&p?r.get(d.token):void 0;h.push(e(d.token,m,r,m||4&p?a:It.NULL,1&p?null:It.THROW_IF_NOT_FOUND,pe.Default))}}n.value=s=u?_construct(c,_toConsumableArray(h)):c.apply(void 0,h)}}return s}(t,n,r,a,i,o)}catch(s){throw s instanceof Error||(s=new Error(s)),(s.ngTempTokenPath=s.ngTempTokenPath||[]).unshift(t),n&&n.value==Nt&&(n.value=Ot),s}}(e,r,this._records,this.parent,t,n)}catch(a){return function(e,t,n,r){var a=e.ngTempTokenPath;throw t.__source&&a.unshift(t.__source),e.message=ze("\n"+e.message,a,"StaticInjectorError",r),e.ngTokenPath=a,e.ngTempTokenPath=null,e}(a,e,0,this.source)}}},{key:"toString",value:function(){var e=[];return this._records.forEach((function(t,n){return e.push(_e(n))})),"StaticInjector[".concat(e.join(", "),"]")}}]),e}();function Ft(e){return Mt("Cannot mix multi providers and regular providers",e)}function Mt(e,t){return new Error(ze(e,t,"StaticInjectorError"))}var Lt=new Ee("AnalyzeForEntryComponents"),zt=null;function Bt(){if(!zt){var e=Ae.Symbol;if(e&&e.iterator)zt=e.iterator;else for(var t=Object.getOwnPropertyNames(Map.prototype),n=0;n<t.length;++n){var r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(zt=r)}}return zt}function jt(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}function Vt(e,t){var n=Ut(e),r=Ut(t);return n&&r?function(e,t,n){for(var r=e[Bt()](),a=t[Bt()]();;){var i=r.next(),o=a.next();if(i.done&&o.done)return!0;if(i.done||o.done)return!1;if(!n(i.value,o.value))return!1}}(e,t,Vt):!(n||!(e&&("object"==typeof e||"function"==typeof e))||r||!(t&&("object"==typeof t||"function"==typeof t)))||jt(e,t)}var qt=function(){function e(t){_classCallCheck2(this,e),this.wrapped=t}return _createClass2(e,null,[{key:"wrap",value:function(t){return new e(t)}},{key:"unwrap",value:function(t){return e.isWrapped(t)?t.wrapped:t}},{key:"isWrapped",value:function(t){return t instanceof e}}]),e}();function Ut(e){return!!Wt(e)&&(Array.isArray(e)||!(e instanceof Map)&&Bt()in e)}function Wt(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Gt(e){return!!e&&"function"==typeof e.then}function Ht(e){return!!e&&"function"==typeof e.subscribe}var Kt=function(){function e(t,n,r){_classCallCheck2(this,e),this.previousValue=t,this.currentValue=n,this.firstChange=r}return _createClass2(e,[{key:"isFirstChange",value:function(){return this.firstChange}}]),e}(),Xt=function e(){_classCallCheck2(this,e)};function Qt(e){var t=Error("No component factory found for ".concat(_e(e),". Did you add it to @NgModule.entryComponents?"));return t[Yt]=e,t}var Yt="ngComponent",Zt=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"resolveComponentFactory",value:function(e){throw Qt(e)}}]),e}(),Jt=function(){var e=function e(){_classCallCheck2(this,e)};return e.NULL=new Zt,e}(),$t=function(){function e(t,n,r){_classCallCheck2(this,e),this._parent=n,this._ngModule=r,this._factories=new Map;for(var a=0;a<t.length;a++){var i=t[a];this._factories.set(i.componentType,i)}}return _createClass2(e,[{key:"resolveComponentFactory",value:function(e){var t=this._factories.get(e);if(!t&&this._parent&&(t=this._parent.resolveComponentFactory(e)),!t)throw Qt(e);return new en(t,this._ngModule)}}]),e}(),en=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this)).factory=e,a.ngModule=r,a.selector=e.selector,a.componentType=e.componentType,a.ngContentSelectors=e.ngContentSelectors,a.inputs=e.inputs,a.outputs=e.outputs,a}return _createClass2(n,[{key:"create",value:function(e,t,n,r){return this.factory.create(e,t,n,r||this.ngModule)}}]),n}(Xt);function tn(){}var nn=function(){var e=function e(t){_classCallCheck2(this,e),this.nativeElement=t};return e.__NG_ELEMENT_ID__=function(){return rn(e)},e}(),rn=tn,an=function e(){_classCallCheck2(this,e)},on=function(){var e={Important:1,DashCase:2};return e[e.Important]="Important",e[e.DashCase]="DashCase",e}(),sn=function(){var e=function e(){_classCallCheck2(this,e)};return e.__NG_ELEMENT_ID__=function(){return un()},e}(),un=tn,cn=function e(t){_classCallCheck2(this,e),this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")},ln=new cn("8.2.14"),hn=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"supports",value:function(e){return Ut(e)}},{key:"create",value:function(e){return new dn(e)}}]),e}(),fn=function(e,t){return t},dn=function(){function e(t){_classCallCheck2(this,e),this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||fn}return _createClass2(e,[{key:"forEachItem",value:function(e){var t;for(t=this._itHead;null!==t;t=t._next)e(t)}},{key:"forEachOperation",value:function(e){for(var t=this._itHead,n=this._removalsHead,r=0,a=null;t||n;){var i=!n||t&&t.currentIndex<gn(n,r,a)?t:n,o=gn(i,r,a),s=i.currentIndex;if(i===n)r--,n=n._nextRemoved;else if(t=t._next,null==i.previousIndex)r++;else{a||(a=[]);var u=o-r,c=s-r;if(u!=c){for(var l=0;l<u;l++){var h=l<a.length?a[l]:a[l]=0,f=h+l;c<=f&&f<u&&(a[l]=h+1)}a[i.previousIndex]=c-u}}o!==s&&e(i,o,s)}}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachMovedItem",value:function(e){var t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"forEachIdentityChange",value:function(e){var t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}},{key:"diff",value:function(e){if(null==e&&(e=[]),!Ut(e))throw new Error("Error trying to diff '".concat(_e(e),"'. Only arrays and iterables are allowed"));return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n,r,a,i=this._itHead,o=!1;if(Array.isArray(e)){this.length=e.length;for(var s=0;s<this.length;s++)r=e[s],a=this._trackByFn(s,r),null!==i&&jt(i.trackById,a)?(o&&(i=this._verifyReinsertion(i,r,a,s)),jt(i.item,r)||this._addIdentityChange(i,r)):(i=this._mismatch(i,r,a,s),o=!0),i=i._next}else n=0,function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(e[n]);else for(var r,a=e[Bt()]();!(r=a.next()).done;)t(r.value)}(e,(function(e){a=t._trackByFn(n,e),null!==i&&jt(i.trackById,a)?(o&&(i=t._verifyReinsertion(i,e,a,n)),jt(i.item,e)||t._addIdentityChange(i,e)):(i=t._mismatch(i,e,a,n),o=!0),i=i._next,n++})),this.length=n;return this._truncate(i),this.collection=e,this.isDirty}},{key:"_reset",value:function(){if(this.isDirty){var e,t;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=t)e.previousIndex=e.currentIndex,t=e._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}},{key:"_mismatch",value:function(e,t,n,r){var a;return null===e?a=this._itTail:(a=e._prev,this._remove(e)),null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(jt(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,a,r)):null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(jt(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,a,r)):e=this._addAfter(new pn(t,n),a,r),e}},{key:"_verifyReinsertion",value:function(e,t,n,r){var a=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==a?e=this._reinsertAfter(a,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}},{key:"_truncate",value:function(e){for(;null!==e;){var t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}},{key:"_reinsertAfter",value:function(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);var r=e._prevRemoved,a=e._nextRemoved;return null===r?this._removalsHead=a:r._nextRemoved=a,null===a?this._removalsTail=r:a._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_moveAfter",value:function(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_addAfter",value:function(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}},{key:"_insertAfter",value:function(e,t,n){var r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new vn),this._linkedRecords.put(e),e.currentIndex=n,e}},{key:"_remove",value:function(e){return this._addToRemovals(this._unlink(e))}},{key:"_unlink",value:function(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);var t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}},{key:"_addToMoves",value:function(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}},{key:"_addToRemovals",value:function(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new vn),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}},{key:"_addIdentityChange",value:function(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}}]),e}(),pn=function e(t,n){_classCallCheck2(this,e),this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null},mn=function(){function e(){_classCallCheck2(this,e),this._head=null,this._tail=null}return _createClass2(e,[{key:"add",value:function(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}},{key:"get",value:function(e,t){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&jt(n.trackById,e))return n;return null}},{key:"remove",value:function(e){var t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}]),e}(),vn=function(){function e(){_classCallCheck2(this,e),this.map=new Map}return _createClass2(e,[{key:"put",value:function(e){var t=e.trackById,n=this.map.get(t);n||(n=new mn,this.map.set(t,n)),n.add(e)}},{key:"get",value:function(e,t){var n=this.map.get(e);return n?n.get(e,t):null}},{key:"remove",value:function(e){var t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}},{key:"clear",value:function(){this.map.clear()}},{key:"isEmpty",get:function(){return 0===this.map.size}}]),e}();function gn(e,t,n){var r=e.previousIndex;if(null===r)return r;var a=0;return n&&r<n.length&&(a=n[r]),r+t+a}var yn=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"supports",value:function(e){return e instanceof Map||Wt(e)}},{key:"create",value:function(){return new _n}}]),e}(),_n=function(){function e(){_classCallCheck2(this,e),this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return _createClass2(e,[{key:"forEachItem",value:function(e){var t;for(t=this._mapHead;null!==t;t=t._next)e(t)}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachChangedItem",value:function(e){var t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"diff",value:function(e){if(e){if(!(e instanceof Map||Wt(e)))throw new Error("Error trying to diff '".concat(_e(e),"'. Only maps and objects are allowed"))}else e=new Map;return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(e,(function(e,r){if(n&&n.key===r)t._maybeAddToChanges(n,e),t._appendAfter=n,n=n._next;else{var a=t._getOrCreateRecordForKey(r,e);n=t._insertBeforeOrAppend(n,a)}})),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}},{key:"_insertBeforeOrAppend",value:function(e,t){if(e){var n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}},{key:"_getOrCreateRecordForKey",value:function(e,t){if(this._records.has(e)){var n=this._records.get(e);this._maybeAddToChanges(n,t);var r=n._prev,a=n._next;return r&&(r._next=a),a&&(a._prev=r),n._next=null,n._prev=null,n}var i=new bn(e);return this._records.set(e,i),i.currentValue=t,this._addToAdditions(i),i}},{key:"_reset",value:function(){if(this.isDirty){var e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}},{key:"_maybeAddToChanges",value:function(e,t){jt(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}},{key:"_addToAdditions",value:function(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}},{key:"_addToChanges",value:function(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}},{key:"_forEach",value:function(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach((function(n){return t(e[n],n)}))}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}}]),e}(),bn=function e(t){_classCallCheck2(this,e),this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null},kn=function(){var e=function(){function e(t){_classCallCheck2(this,e),this.factories=t}return _createClass2(e,[{key:"find",value:function(e){var t,n=this.factories.find((function(t){return t.supports(e)}));if(null!=n)return n;throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat((t=e).name||typeof t,"'"))}}],[{key:"create",value:function(t,n){if(null!=n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return e.create(t,n)},deps:[[e,new de,new he]]}}}]),e}();return e.ngInjectableDef=ve({token:e,providedIn:"root",factory:function(){return new e([new hn])}}),e}(),wn=function(){var e=function(){function e(t){_classCallCheck2(this,e),this.factories=t}return _createClass2(e,[{key:"find",value:function(e){var t=this.factories.find((function(t){return t.supports(e)}));if(t)return t;throw new Error("Cannot find a differ supporting object '".concat(e,"'"))}}],[{key:"create",value:function(t,n){if(n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return e.create(t,n)},deps:[[e,new de,new he]]}}}]),e}();return e.ngInjectableDef=ve({token:e,providedIn:"root",factory:function(){return new e([new yn])}}),e}(),xn=[new yn],Cn=new kn([new hn]),Sn=new wn(xn),Tn=function(){var e=function e(){_classCallCheck2(this,e)};return e.__NG_ELEMENT_ID__=function(){return An(e,nn)},e}(),An=tn,En=function(){var e=function e(){_classCallCheck2(this,e)};return e.__NG_ELEMENT_ID__=function(){return In(e,nn)},e}(),In=tn;function Rn(e,t,n,r){var a="ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. Previous value: '".concat(t,"'. Current value: '").concat(n,"'.");return r&&(a+=" It seems like the view has been created after its parent and its children have been dirty checked. Has it been created in a change detection hook ?"),function(e,t){var n=new Error(e);return On(n,t),n}(a,e)}function On(e,t){e.ngDebugContext=t,e.ngErrorLogger=t.logError.bind(t)}function Nn(e){return new Error("ViewDestroyedError: Attempt to use a destroyed view: "+e)}function Dn(e,t,n){var r=e.state,a=1792&r;return a===t?(e.state=-1793&r|n,e.initIndex=-1,!0):a===n}function Pn(e,t,n){return(1792&e.state)===t&&e.initIndex<=n&&(e.initIndex=n+1,!0)}function Fn(e,t){return e.nodes[t]}function Mn(e,t){return e.nodes[t]}function Ln(e,t){return e.nodes[t]}function zn(e,t){return e.nodes[t]}function Bn(e,t){return e.nodes[t]}var jn={setCurrentNode:void 0,createRootView:void 0,createEmbeddedView:void 0,createComponentView:void 0,createNgModuleRef:void 0,overrideProvider:void 0,overrideComponentView:void 0,clearOverrides:void 0,checkAndUpdateView:void 0,checkNoChangesView:void 0,destroyView:void 0,resolveDep:void 0,createDebugContext:void 0,handleEvent:void 0,updateDirectives:void 0,updateRenderer:void 0,dirtyParentQueries:void 0},Vn=function(){},qn=new Map;function Un(e){var t=qn.get(e);return t||(t=_e(e)+"_"+qn.size,qn.set(e,t)),t}function Wn(e){return{id:"$$undefined",styles:e.styles,encapsulation:e.encapsulation,data:e.data}}var Gn=0;function Hn(e,t,n,r){return!(!(2&e.state)&&jt(e.oldValues[t.bindingIndex+n],r))}function Kn(e,t,n,r){return!!Hn(e,t,n,r)&&(e.oldValues[t.bindingIndex+n]=r,!0)}function Xn(e,t,n,r){var a=e.oldValues[t.bindingIndex+n];if(1&e.state||!Vt(a,r)){var i=t.bindings[n].name;throw Rn(jn.createDebugContext(e,t.nodeIndex),"".concat(i,": ").concat(a),"".concat(i,": ").concat(r),0!=(1&e.state))}}function Qn(e){for(var t=e;t;)2&t.def.flags&&(t.state|=8),t=t.viewContainerParent||t.parent}function Yn(e,t){for(var n=e;n&&n!==t;)n.state|=64,n=n.viewContainerParent||n.parent}function Zn(e,t,n,r){try{return Qn(33554432&e.def.nodes[t].flags?Mn(e,t).componentView:e),jn.handleEvent(e,t,n,r)}catch(a){e.root.errorHandler.handleError(a)}}function Jn(e){return e.parent?Mn(e.parent,e.parentNodeDef.nodeIndex):null}function $n(e){return e.parent?e.parentNodeDef.parent:null}function er(e,t){switch(201347067&t.flags){case 1:return Mn(e,t.nodeIndex).renderElement;case 2:return Fn(e,t.nodeIndex).renderText}}function tr(e){return!!e.parent&&!!(32768&e.parentNodeDef.flags)}function nr(e){return!(!e.parent||32768&e.parentNodeDef.flags)}function rr(e){return 1<<e%32}function ar(e){var t={},n=0,r={};return e&&e.forEach((function(e){var a=_slicedToArray2(e,2),i=a[0],o=a[1];"number"==typeof i?(t[i]=o,n|=rr(i)):r[i]=o})),{matchedQueries:t,references:r,matchedQueryIds:n}}function ir(e,t){return e.map((function(e){var n,r,a;return Array.isArray(e)?(a=(n=_slicedToArray2(e,2))[0],r=n[1]):(a=0,r=e),r&&("function"==typeof r||"object"==typeof r)&&t&&Object.defineProperty(r,"__source",{value:t,configurable:!0}),{flags:a,token:r,tokenKey:Un(r)}}))}function or(e,t,n){var r=n.renderParent;return r?0==(1&r.flags)||0==(33554432&r.flags)||r.element.componentRendererType&&r.element.componentRendererType.encapsulation===Ue.Native?Mn(e,n.renderParent.nodeIndex).renderElement:void 0:t}var sr=new WeakMap;function ur(e){var t=sr.get(e);return t||((t=e((function(){return Vn}))).factory=e,sr.set(e,t)),t}function cr(e,t,n,r,a){3===t&&(n=e.renderer.parentNode(er(e,e.def.lastRenderRootNode))),lr(e,t,0,e.def.nodes.length-1,n,r,a)}function lr(e,t,n,r,a,i,o){for(var s=n;s<=r;s++){var u=e.def.nodes[s];11&u.flags&&fr(e,u,t,a,i,o),s+=u.childCount}}function hr(e,t,n,r,a,i){for(var o=e;o&&!tr(o);)o=o.parent;for(var s=o.parent,u=$n(o),c=u.nodeIndex+u.childCount,l=u.nodeIndex+1;l<=c;l++){var h=s.def.nodes[l];h.ngContentIndex===t&&fr(s,h,n,r,a,i),l+=h.childCount}if(!s.parent){var f=e.root.projectableNodes[t];if(f)for(var d=0;d<f.length;d++)dr(e,f[d],n,r,a,i)}}function fr(e,t,n,r,a,i){if(8&t.flags)hr(e,t.ngContent.index,n,r,a,i);else{var o=er(e,t);if(3===n&&33554432&t.flags&&48&t.bindingFlags?(16&t.bindingFlags&&dr(e,o,n,r,a,i),32&t.bindingFlags&&dr(Mn(e,t.nodeIndex).componentView,o,n,r,a,i)):dr(e,o,n,r,a,i),16777216&t.flags)for(var s=Mn(e,t.nodeIndex).viewContainer._embeddedViews,u=0;u<s.length;u++)cr(s[u],n,r,a,i);1&t.flags&&!t.element.name&&lr(e,n,t.nodeIndex+1,t.nodeIndex+t.childCount,r,a,i)}}function dr(e,t,n,r,a,i){var o=e.renderer;switch(n){case 1:o.appendChild(r,t);break;case 2:o.insertBefore(r,t,a);break;case 3:o.removeChild(r,t);break;case 0:i.push(t)}}var pr=/^:([^:]+):(.+)$/;function mr(e){if(":"===e[0]){var t=e.match(pr);return[t[1],t[2]]}return["",e]}function vr(e){for(var t=0,n=0;n<e.length;n++)t|=e[n].flags;return t}function gr(e,t,n,r,a,i,o,s,u,c,l,h,f,d,p,m,v,g,y,_){switch(e){case 1:return t+yr(n)+r;case 2:return t+yr(n)+r+yr(a)+i;case 3:return t+yr(n)+r+yr(a)+i+yr(o)+s;case 4:return t+yr(n)+r+yr(a)+i+yr(o)+s+yr(u)+c;case 5:return t+yr(n)+r+yr(a)+i+yr(o)+s+yr(u)+c+yr(l)+h;case 6:return t+yr(n)+r+yr(a)+i+yr(o)+s+yr(u)+c+yr(l)+h+yr(f)+d;case 7:return t+yr(n)+r+yr(a)+i+yr(o)+s+yr(u)+c+yr(l)+h+yr(f)+d+yr(p)+m;case 8:return t+yr(n)+r+yr(a)+i+yr(o)+s+yr(u)+c+yr(l)+h+yr(f)+d+yr(p)+m+yr(v)+g;case 9:return t+yr(n)+r+yr(a)+i+yr(o)+s+yr(u)+c+yr(l)+h+yr(f)+d+yr(p)+m+yr(v)+g+yr(y)+_;default:throw new Error("Does not support more than 9 expressions")}}function yr(e){return null!=e?e.toString():""}var _r=new Object,br=Un(It),kr=Un(Ie),wr=Un(Be);function xr(e,t,n,r){return n=we(n),{index:-1,deps:ir(r,_e(t)),flags:e,token:t,value:n}}function Cr(e,t){var n,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:It.THROW_IF_NOT_FOUND,i=Pe(e);try{if(8&t.flags)return t.token;if(2&t.flags&&(a=null),1&t.flags)return e._parent.get(t.token,a);var o=t.tokenKey;switch(o){case br:case kr:case wr:return e}var s,u=e._def.providersByKey[o];if(u){var c=e._providers[u.index];return void 0===c&&(c=e._providers[u.index]=Sr(e,u)),c===_r?void 0:c}if((s=ge(t.token))&&(n=e,null!=(r=s).providedIn&&(function(e,t){return e._def.modules.indexOf(t)>-1}(n,r.providedIn)||"root"===r.providedIn&&n._def.isRoot))){var l=e._providers.length;return e._def.providers[l]=e._def.providersByKey[t.tokenKey]={flags:5120,value:s.factory,deps:[],index:l,token:t.token},e._providers[l]=_r,e._providers[l]=Sr(e,e._def.providersByKey[t.tokenKey])}return 4&t.flags?a:e._parent.get(t.token,a)}finally{Pe(i)}}function Sr(e,t){var n;switch(201347067&t.flags){case 512:n=function(e,t,n){var r=n.length;switch(r){case 0:return new t;case 1:return new t(Cr(e,n[0]));case 2:return new t(Cr(e,n[0]),Cr(e,n[1]));case 3:return new t(Cr(e,n[0]),Cr(e,n[1]),Cr(e,n[2]));default:for(var a=new Array(r),i=0;i<r;i++)a[i]=Cr(e,n[i]);return _construct(t,a)}}(e,t.value,t.deps);break;case 1024:n=function(e,t,n){var r=n.length;switch(r){case 0:return t();case 1:return t(Cr(e,n[0]));case 2:return t(Cr(e,n[0]),Cr(e,n[1]));case 3:return t(Cr(e,n[0]),Cr(e,n[1]),Cr(e,n[2]));default:for(var a=Array(r),i=0;i<r;i++)a[i]=Cr(e,n[i]);return t.apply(void 0,a)}}(e,t.value,t.deps);break;case 2048:n=Cr(e,t.deps[0]);break;case 256:n=t.value}return n===_r||null===n||"object"!=typeof n||131072&t.flags||"function"!=typeof n.ngOnDestroy||(t.flags|=131072),void 0===n?_r:n}function Tr(e,t){var n=e.viewContainer._embeddedViews;if((null==t||t>=n.length)&&(t=n.length-1),t<0)return null;var r=n[t];return r.viewContainerParent=null,qe(n,t),jn.dirtyParentQueries(r),Er(r),r}function Ar(e,t,n){var r=t?er(t,t.def.lastRenderRootNode):e.renderElement,a=n.renderer.parentNode(r),i=n.renderer.nextSibling(r);cr(n,2,a,i,void 0)}function Er(e){cr(e,3,null,null,void 0)}var Ir=new Object;function Rr(e,t,n,r,a,i){return new Or(e,t,n,r,a,i)}var Or=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o,s){var u;return _classCallCheck2(this,n),(u=t.call(this)).selector=e,u.componentType=r,u._inputs=i,u._outputs=o,u.ngContentSelectors=s,u.viewDefFactory=a,u}return _createClass2(n,[{key:"create",value:function(e,t,n,r){if(!r)throw new Error("ngModule should be provided");var a=ur(this.viewDefFactory),i=a.nodes[0].element.componentProvider.nodeIndex,o=jn.createRootView(e,t||[],n,a,r,Ir),s=Ln(o,i).instance;return n&&o.renderer.setAttribute(Mn(o,0).renderElement,"ng-version",ln.full),new Nr(o,new Mr(o),s)}},{key:"inputs",get:function(){var e=[],t=this._inputs;for(var n in t)e.push({propName:n,templateName:t[n]});return e}},{key:"outputs",get:function(){var e=[];for(var t in this._outputs)e.push({propName:t,templateName:this._outputs[t]});return e}}]),n}(Xt),Nr=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this))._view=e,i._viewRef=r,i._component=a,i._elDef=i._view.def.nodes[0],i.hostView=r,i.changeDetectorRef=r,i.instance=a,i}return _createClass2(n,[{key:"destroy",value:function(){this._viewRef.destroy()}},{key:"onDestroy",value:function(e){this._viewRef.onDestroy(e)}},{key:"location",get:function(){return new nn(Mn(this._view,this._elDef.nodeIndex).renderElement)}},{key:"injector",get:function(){return new jr(this._view,this._elDef)}},{key:"componentType",get:function(){return this._component.constructor}}]),n}(function(){return function e(){_classCallCheck2(this,e)}}());function Dr(e,t,n){return new Pr(e,t,n)}var Pr=function(){function e(t,n,r){_classCallCheck2(this,e),this._view=t,this._elDef=n,this._data=r,this._embeddedViews=[]}return _createClass2(e,[{key:"clear",value:function(){for(var e=this._embeddedViews.length-1;e>=0;e--){var t=Tr(this._data,e);jn.destroyView(t)}}},{key:"get",value:function(e){var t=this._embeddedViews[e];if(t){var n=new Mr(t);return n.attachToViewContainerRef(this),n}return null}},{key:"createEmbeddedView",value:function(e,t,n){var r=e.createEmbeddedView(t||{});return this.insert(r,n),r}},{key:"createComponent",value:function(e,t,n,r,a){var i=n||this.parentInjector;a||e instanceof en||(a=i.get(Be));var o=e.create(i,r,void 0,a);return this.insert(o.hostView,t),o}},{key:"insert",value:function(e,t){if(e.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");var n,r,a,i,o,s=e;return n=this._view,r=this._data,a=t,i=s._view,o=r.viewContainer._embeddedViews,null==a&&(a=o.length),i.viewContainerParent=n,Ve(o,a,i),function(e,t){var n=Jn(t);if(n&&n!==e&&!(16&t.state)){t.state|=16;var r=n.template._projectedViews;r||(r=n.template._projectedViews=[]),r.push(t),function(e,t){if(!(4&t.flags)){e.nodeFlags|=4,t.flags|=4;for(var n=t.parent;n;)n.childFlags|=4,n=n.parent}}(t.parent.def,t.parentNodeDef)}}(r,i),jn.dirtyParentQueries(i),Ar(r,a>0?o[a-1]:null,i),s.attachToViewContainerRef(this),e}},{key:"move",value:function(e,t){if(e.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");var n,r,a,i,o,s=this._embeddedViews.indexOf(e._view);return n=this._data,r=s,a=t,i=n.viewContainer._embeddedViews,o=i[r],qe(i,r),null==a&&(a=i.length),Ve(i,a,o),jn.dirtyParentQueries(o),Er(o),Ar(n,a>0?i[a-1]:null,o),e}},{key:"indexOf",value:function(e){return this._embeddedViews.indexOf(e._view)}},{key:"remove",value:function(e){var t=Tr(this._data,e);t&&jn.destroyView(t)}},{key:"detach",value:function(e){var t=Tr(this._data,e);return t?new Mr(t):null}},{key:"element",get:function(){return new nn(this._data.renderElement)}},{key:"injector",get:function(){return new jr(this._view,this._elDef)}},{key:"parentInjector",get:function(){for(var e=this._view,t=this._elDef.parent;!t&&e;)t=$n(e),e=e.parent;return e?new jr(e,t):new jr(this._view,null)}},{key:"length",get:function(){return this._embeddedViews.length}}]),e}();function Fr(e){return new Mr(e)}var Mr=function(){function e(t){_classCallCheck2(this,e),this._view=t,this._viewContainerRef=null,this._appRef=null}return _createClass2(e,[{key:"markForCheck",value:function(){Qn(this._view)}},{key:"detach",value:function(){this._view.state&=-5}},{key:"detectChanges",value:function(){var e=this._view.root.rendererFactory;e.begin&&e.begin();try{jn.checkAndUpdateView(this._view)}finally{e.end&&e.end()}}},{key:"checkNoChanges",value:function(){jn.checkNoChangesView(this._view)}},{key:"reattach",value:function(){this._view.state|=4}},{key:"onDestroy",value:function(e){this._view.disposables||(this._view.disposables=[]),this._view.disposables.push(e)}},{key:"destroy",value:function(){this._appRef?this._appRef.detachView(this):this._viewContainerRef&&this._viewContainerRef.detach(this._viewContainerRef.indexOf(this)),jn.destroyView(this._view)}},{key:"detachFromAppRef",value:function(){this._appRef=null,Er(this._view),jn.dirtyParentQueries(this._view)}},{key:"attachToAppRef",value:function(e){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}},{key:"attachToViewContainerRef",value:function(e){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=e}},{key:"rootNodes",get:function(){return cr(this._view,0,void 0,void 0,e=[]),e;var e}},{key:"context",get:function(){return this._view.context}},{key:"destroyed",get:function(){return 0!=(128&this._view.state)}}]),e}();function Lr(e,t){return new zr(e,t)}var zr=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this))._parentView=e,a._def=r,a}return _createClass2(n,[{key:"createEmbeddedView",value:function(e){return new Mr(jn.createEmbeddedView(this._parentView,this._def,this._def.element.template,e))}},{key:"elementRef",get:function(){return new nn(Mn(this._parentView,this._def.nodeIndex).renderElement)}}]),n}(Tn);function Br(e,t){return new jr(e,t)}var jr=function(){function e(t,n){_classCallCheck2(this,e),this.view=t,this.elDef=n}return _createClass2(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:It.THROW_IF_NOT_FOUND;return jn.resolveDep(this.view,this.elDef,!!this.elDef&&0!=(33554432&this.elDef.flags),{flags:0,token:e,tokenKey:Un(e)},t)}}]),e}();function Vr(e,t){var n=e.def.nodes[t];if(1&n.flags){var r=Mn(e,n.nodeIndex);return n.element.template?r.template:r.renderElement}if(2&n.flags)return Fn(e,n.nodeIndex).renderText;if(20240&n.flags)return Ln(e,n.nodeIndex).instance;throw new Error("Illegal state: read nodeValue for node index "+t)}function qr(e){return new Ur(e.renderer)}var Ur=function(){function e(t){_classCallCheck2(this,e),this.delegate=t}return _createClass2(e,[{key:"selectRootElement",value:function(e){return this.delegate.selectRootElement(e)}},{key:"createElement",value:function(e,t){var n=_slicedToArray2(mr(t),2),r=n[0],a=n[1],i=this.delegate.createElement(a,r);return e&&this.delegate.appendChild(e,i),i}},{key:"createViewRoot",value:function(e){return e}},{key:"createTemplateAnchor",value:function(e){var t=this.delegate.createComment("");return e&&this.delegate.appendChild(e,t),t}},{key:"createText",value:function(e,t){var n=this.delegate.createText(t);return e&&this.delegate.appendChild(e,n),n}},{key:"projectNodes",value:function(e,t){for(var n=0;n<t.length;n++)this.delegate.appendChild(e,t[n])}},{key:"attachViewAfter",value:function(e,t){for(var n=this.delegate.parentNode(e),r=this.delegate.nextSibling(e),a=0;a<t.length;a++)this.delegate.insertBefore(n,t[a],r)}},{key:"detachView",value:function(e){for(var t=0;t<e.length;t++){var n=e[t],r=this.delegate.parentNode(n);this.delegate.removeChild(r,n)}}},{key:"destroyView",value:function(e,t){for(var n=0;n<t.length;n++)this.delegate.destroyNode(t[n])}},{key:"listen",value:function(e,t,n){return this.delegate.listen(e,t,n)}},{key:"listenGlobal",value:function(e,t,n){return this.delegate.listen(e,t,n)}},{key:"setElementProperty",value:function(e,t,n){this.delegate.setProperty(e,t,n)}},{key:"setElementAttribute",value:function(e,t,n){var r=_slicedToArray2(mr(t),2),a=r[0],i=r[1];null!=n?this.delegate.setAttribute(e,i,n,a):this.delegate.removeAttribute(e,i,a)}},{key:"setBindingDebugInfo",value:function(e,t,n){}},{key:"setElementClass",value:function(e,t,n){n?this.delegate.addClass(e,t):this.delegate.removeClass(e,t)}},{key:"setElementStyle",value:function(e,t,n){null!=n?this.delegate.setStyle(e,t,n):this.delegate.removeStyle(e,t)}},{key:"invokeElementMethod",value:function(e,t,n){e[t].apply(e,n)}},{key:"setText",value:function(e,t){this.delegate.setValue(e,t)}},{key:"animate",value:function(){throw new Error("Renderer.animate is no longer supported!")}}]),e}();function Wr(e,t,n,r){return new Gr(e,t,n,r)}var Gr=function(){function e(t,n,r,a){_classCallCheck2(this,e),this._moduleType=t,this._parent=n,this._bootstrapComponents=r,this._def=a,this._destroyListeners=[],this._destroyed=!1,this.injector=this,function(e){for(var t=e._def,n=e._providers=new Array(t.providers.length),r=0;r<t.providers.length;r++){var a=t.providers[r];4096&a.flags||void 0===n[r]&&(n[r]=Sr(e,a))}}(this)}return _createClass2(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:It.THROW_IF_NOT_FOUND,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:pe.Default,r=0;return n&pe.SkipSelf?r|=1:n&pe.Self&&(r|=4),Cr(this,{token:e,tokenKey:Un(e),flags:r},t)}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The ng module ".concat(_e(this.instance.constructor)," has already been destroyed."));this._destroyed=!0,function(e,t){for(var n=e._def,r=new Set,a=0;a<n.providers.length;a++)if(131072&n.providers[a].flags){var i=e._providers[a];if(i&&i!==_r){var o=i.ngOnDestroy;"function"!=typeof o||r.has(i)||(o.apply(i),r.add(i))}}}(this),this._destroyListeners.forEach((function(e){return e()}))}},{key:"onDestroy",value:function(e){this._destroyListeners.push(e)}},{key:"instance",get:function(){return this.get(this._moduleType)}},{key:"componentFactoryResolver",get:function(){return this.get(Jt)}}]),e}(),Hr=Un((function e(){_classCallCheck2(this,e)})),Kr=Un(sn),Xr=Un(nn),Qr=Un(En),Yr=Un(Tn),Zr=Un(St),Jr=Un(It),$r=Un(Ie);function ea(e,t,n,r,a,i,o,s){var u=[];if(o)for(var c in o){var l=_slicedToArray2(o[c],2),h=l[0],f=l[1];u[h]={flags:8,name:c,nonMinifiedName:f,ns:null,securityContext:null,suffix:null}}var d=[];if(s)for(var p in s)d.push({type:1,propName:p,target:null,eventName:s[p]});return na(e,t|=16384,n,r,a,a,i,u,d)}function ta(e,t,n,r,a){return na(-1,e,t,0,n,r,a)}function na(e,t,n,r,a,i,o,s,u){var c=ar(n),l=c.matchedQueries,h=c.references,f=c.matchedQueryIds;u||(u=[]),s||(s=[]),i=we(i);var d=ir(o,_e(a));return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:l,matchedQueryIds:f,references:h,ngContentIndex:-1,childCount:r,bindings:s,bindingFlags:vr(s),outputs:u,element:null,provider:{token:a,value:i,deps:d},text:null,query:null,ngContent:null}}function ra(e,t){return sa(e,t)}function aa(e,t){for(var n=e;n.parent&&!tr(n);)n=n.parent;return ua(n.parent,$n(n),!0,t.provider.value,t.provider.deps)}function ia(e,t){var n=ua(e,t.parent,(32768&t.flags)>0,t.provider.value,t.provider.deps);if(t.outputs.length)for(var r=0;r<t.outputs.length;r++){var a=t.outputs[r],i=n[a.propName];if(!Ht(i))throw new Error("@Output ".concat(a.propName," not initialized in '").concat(n.constructor.name,"'."));var o=i.subscribe(oa(e,t.parent.nodeIndex,a.eventName));e.disposables[t.outputIndex+r]=o.unsubscribe.bind(o)}return n}function oa(e,t,n){return function(r){return Zn(e,t,n,r)}}function sa(e,t){var n=(8192&t.flags)>0,r=t.provider;switch(201347067&t.flags){case 512:return ua(e,t.parent,n,r.value,r.deps);case 1024:return function(e,t,n,r,a){var i=a.length;switch(i){case 0:return r();case 1:return r(la(e,t,n,a[0]));case 2:return r(la(e,t,n,a[0]),la(e,t,n,a[1]));case 3:return r(la(e,t,n,a[0]),la(e,t,n,a[1]),la(e,t,n,a[2]));default:for(var o=Array(i),s=0;s<i;s++)o[s]=la(e,t,n,a[s]);return r.apply(void 0,o)}}(e,t.parent,n,r.value,r.deps);case 2048:return la(e,t.parent,n,r.deps[0]);case 256:return r.value}}function ua(e,t,n,r,a){var i=a.length;switch(i){case 0:return new r;case 1:return new r(la(e,t,n,a[0]));case 2:return new r(la(e,t,n,a[0]),la(e,t,n,a[1]));case 3:return new r(la(e,t,n,a[0]),la(e,t,n,a[1]),la(e,t,n,a[2]));default:for(var o=new Array(i),s=0;s<i;s++)o[s]=la(e,t,n,a[s]);return _construct(r,o)}}var ca={};function la(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:It.THROW_IF_NOT_FOUND;if(8&r.flags)return r.token;var i=e;2&r.flags&&(a=null);var o=r.tokenKey;o===Zr&&(n=!(!t||!t.element.componentView)),t&&1&r.flags&&(n=!1,t=t.parent);for(var s=e;s;){if(t)switch(o){case Hr:return qr(ha(s,t,n));case Kr:return ha(s,t,n).renderer;case Xr:return new nn(Mn(s,t.nodeIndex).renderElement);case Qr:return Mn(s,t.nodeIndex).viewContainer;case Yr:if(t.element.template)return Mn(s,t.nodeIndex).template;break;case Zr:return Fr(ha(s,t,n));case Jr:case $r:return Br(s,t);default:var u=(n?t.element.allProviders:t.element.publicProviders)[o];if(u){var c=Ln(s,u.nodeIndex);return c||(c={instance:sa(s,u)},s.nodes[u.nodeIndex]=c),c.instance}}n=tr(s),t=$n(s),s=s.parent,4&r.flags&&(s=null)}var l=i.root.injector.get(r.token,ca);return l!==ca||a===ca?l:i.root.ngModule.injector.get(r.token,a)}function ha(e,t,n){var r;if(n)r=Mn(e,t.nodeIndex).componentView;else for(r=e;r.parent&&!tr(r);)r=r.parent;return r}function fa(e,t,n,r,a,i){if(32768&n.flags){var o=Mn(e,n.parent.nodeIndex).componentView;2&o.def.flags&&(o.state|=8)}if(t.instance[n.bindings[r].name]=a,524288&n.flags){i=i||{};var s=qt.unwrap(e.oldValues[n.bindingIndex+r]);i[n.bindings[r].nonMinifiedName]=new Kt(s,a,0!=(2&e.state))}return e.oldValues[n.bindingIndex+r]=a,i}function da(e,t){if(e.def.nodeFlags&t)for(var n=e.def.nodes,r=0,a=0;a<n.length;a++){var i=n[a],o=i.parent;for(!o&&i.flags&t&&ma(e,a,i.flags&t,r++),0==(i.childFlags&t)&&(a+=i.childCount);o&&1&o.flags&&a===o.nodeIndex+o.childCount;)o.directChildFlags&t&&(r=pa(e,o,t,r)),o=o.parent}}function pa(e,t,n,r){for(var a=t.nodeIndex+1;a<=t.nodeIndex+t.childCount;a++){var i=e.def.nodes[a];i.flags&n&&ma(e,a,i.flags&n,r++),a+=i.childCount}return r}function ma(e,t,n,r){var a=Ln(e,t);if(a){var i=a.instance;i&&(jn.setCurrentNode(e,t),1048576&n&&Pn(e,512,r)&&i.ngAfterContentInit(),2097152&n&&i.ngAfterContentChecked(),4194304&n&&Pn(e,768,r)&&i.ngAfterViewInit(),8388608&n&&i.ngAfterViewChecked(),131072&n&&i.ngOnDestroy())}}var va=new Ee("SCHEDULER_TOKEN",{providedIn:"root",factory:function(){return We}}),ga={},ya=function(){var e={LocaleId:0,DayPeriodsFormat:1,DayPeriodsStandalone:2,DaysFormat:3,DaysStandalone:4,MonthsFormat:5,MonthsStandalone:6,Eras:7,FirstDayOfWeek:8,WeekendRange:9,DateFormat:10,TimeFormat:11,DateTimeFormat:12,NumberSymbols:13,NumberFormats:14,CurrencySymbol:15,CurrencyName:16,Currencies:17,PluralCase:18,ExtraData:19};return e[e.LocaleId]="LocaleId",e[e.DayPeriodsFormat]="DayPeriodsFormat",e[e.DayPeriodsStandalone]="DayPeriodsStandalone",e[e.DaysFormat]="DaysFormat",e[e.DaysStandalone]="DaysStandalone",e[e.MonthsFormat]="MonthsFormat",e[e.MonthsStandalone]="MonthsStandalone",e[e.Eras]="Eras",e[e.FirstDayOfWeek]="FirstDayOfWeek",e[e.WeekendRange]="WeekendRange",e[e.DateFormat]="DateFormat",e[e.TimeFormat]="TimeFormat",e[e.DateTimeFormat]="DateTimeFormat",e[e.NumberSymbols]="NumberSymbols",e[e.NumberFormats]="NumberFormats",e[e.CurrencySymbol]="CurrencySymbol",e[e.CurrencyName]="CurrencyName",e[e.Currencies]="Currencies",e[e.PluralCase]="PluralCase",e[e.ExtraData]="ExtraData",e}(),_a=void 0,ba=["en",[["a","p"],["AM","PM"],_a],[["AM","PM"],_a,_a],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],_a,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],_a,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",_a,"{1} 'at' {0}",_a],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"$","US Dollar",{},function(e){var t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}],ka=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _classCallCheck2(this,n),(e=t.call(this)).__isAsync=r,e}return _createClass2(n,[{key:"emit",value:function(e){_get(_getPrototypeOf(n.prototype),"next",this).call(this,e)}},{key:"subscribe",value:function(e,t,r){var a,i=function(e){return null},o=function(){return null};e&&"object"==typeof e?(a=this.__isAsync?function(t){setTimeout((function(){return e.next(t)}))}:function(t){e.next(t)},e.error&&(i=this.__isAsync?function(t){setTimeout((function(){return e.error(t)}))}:function(t){e.error(t)}),e.complete&&(o=this.__isAsync?function(){setTimeout((function(){return e.complete()}))}:function(){e.complete()})):(a=this.__isAsync?function(t){setTimeout((function(){return e(t)}))}:function(t){e(t)},t&&(i=this.__isAsync?function(e){setTimeout((function(){return t(e)}))}:function(e){t(e)}),r&&(o=this.__isAsync?function(){setTimeout((function(){return r()}))}:function(){r()}));var s=_get(_getPrototypeOf(n.prototype),"subscribe",this).call(this,a,i,o);return e instanceof d&&e.add(s),s}}]),n}(R);function wa(){return this._results[Bt()]()}var xa=function(){function e(){_classCallCheck2(this,e),this.dirty=!0,this._results=[],this.changes=new ka,this.length=0;var t=Bt(),n=e.prototype;n[t]||(n[t]=wa)}return _createClass2(e,[{key:"map",value:function(e){return this._results.map(e)}},{key:"filter",value:function(e){return this._results.filter(e)}},{key:"find",value:function(e){return this._results.find(e)}},{key:"reduce",value:function(e,t){return this._results.reduce(e,t)}},{key:"forEach",value:function(e){this._results.forEach(e)}},{key:"some",value:function(e){return this._results.some(e)}},{key:"toArray",value:function(){return this._results.slice()}},{key:"toString",value:function(){return this._results.toString()}},{key:"reset",value:function(e){this._results=function e(t,n){void 0===n&&(n=t);for(var r=0;r<t.length;r++){var a=t[r];Array.isArray(a)?(n===t&&(n=t.slice(0,r)),e(a,n)):n!==t&&n.push(a)}return n}(e),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}},{key:"notifyOnChanges",value:function(){this.changes.emit(this)}},{key:"setDirty",value:function(){this.dirty=!0}},{key:"destroy",value:function(){this.changes.complete(),this.changes.unsubscribe()}}]),e}(),Ca=new Ee("Application Initializer"),Sa=function(){function e(t){var n=this;_classCallCheck2(this,e),this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise((function(e,t){n.resolve=e,n.reject=t}))}return _createClass2(e,[{key:"runInitializers",value:function(){var e=this;if(!this.initialized){var t=[],n=function(){e.done=!0,e.resolve()};if(this.appInits)for(var r=0;r<this.appInits.length;r++){var a=this.appInits[r]();Gt(a)&&t.push(a)}Promise.all(t).then((function(){n()})).catch((function(t){e.reject(t)})),0===t.length&&n(),this.initialized=!0}}}]),e}(),Ta=new Ee("AppId");function Aa(){return"".concat(Ea()).concat(Ea()).concat(Ea())}function Ea(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var Ia=new Ee("Platform Initializer"),Ra=new Ee("Platform ID"),Oa=new Ee("appBootstrapListener"),Na=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"log",value:function(e){console.log(e)}},{key:"warn",value:function(e){console.warn(e)}}]),e}(),Da=new Ee("LocaleId");function Pa(){throw new Error("Runtime compiler is not loaded")}var Fa,Ma,La=Pa,za=Pa,Ba=Pa,ja=Pa,Va=function(){function e(){_classCallCheck2(this,e),this.compileModuleSync=La,this.compileModuleAsync=za,this.compileModuleAndAllComponentsSync=Ba,this.compileModuleAndAllComponentsAsync=ja}return _createClass2(e,[{key:"clearCache",value:function(){}},{key:"clearCacheFor",value:function(e){}},{key:"getModuleId",value:function(e){}}]),e}(),qa=function e(){_classCallCheck2(this,e)};var Ua,Wa=!(!(Ua=Ae.wtf)||(Fa=Ua.trace,!Fa)||(Ma=Fa.events,0));function Ga(e,t){return null}var Ha=Wa?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Ma.createScope(e,t)}:function(e,t){return Ga},Ka=Wa?function(e,t){return Fa.leaveScope(e,t),t}:function(e,t){return t},Xa=Promise.resolve(0);function Qa(e){"undefined"==typeof Zone?Xa.then((function(){e&&e.apply(null,null)})):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}var Ya=function(){function e(t){var n,r=t.enableLongStackTrace,a=void 0!==r&&r;if(_classCallCheck2(this,e),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ka(!1),this.onMicrotaskEmpty=new ka(!1),this.onStable=new ka(!1),this.onError=new ka(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),a&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),(n=this)._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:function(e,t,r,a,i,o){try{return ei(n),e.invokeTask(r,a,i,o)}finally{ti(n)}},onInvoke:function(e,t,r,a,i,o,s){try{return ei(n),e.invoke(r,a,i,o,s)}finally{ti(n)}},onHasTask:function(e,t,r,a){e.hasTask(r,a),t===r&&("microTask"==a.change?(n.hasPendingMicrotasks=a.microTask,$a(n)):"macroTask"==a.change&&(n.hasPendingMacrotasks=a.macroTask))},onHandleError:function(e,t,r,a){return e.handleError(r,a),n.runOutsideAngular((function(){return n.onError.emit(a)})),!1}})}return _createClass2(e,[{key:"run",value:function(e,t,n){return this._inner.run(e,t,n)}},{key:"runTask",value:function(e,t,n,r){var a=this._inner,i=a.scheduleEventTask("NgZoneEvent: "+r,e,Ja,Za,Za);try{return a.runTask(i,t,n)}finally{a.cancelTask(i)}}},{key:"runGuarded",value:function(e,t,n){return this._inner.runGuarded(e,t,n)}},{key:"runOutsideAngular",value:function(e){return this._outer.run(e)}}],[{key:"isInAngularZone",value:function(){return!0===Zone.current.get("isAngularZone")}},{key:"assertInAngularZone",value:function(){if(!e.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}},{key:"assertNotInAngularZone",value:function(){if(e.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}}]),e}();function Za(){}var Ja={};function $a(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular((function(){return e.onStable.emit(null)}))}finally{e.isStable=!0}}}function ei(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function ti(e){e._nesting--,$a(e)}var ni,ri=function(){function e(){_classCallCheck2(this,e),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ka,this.onMicrotaskEmpty=new ka,this.onStable=new ka,this.onError=new ka}return _createClass2(e,[{key:"run",value:function(e){return e()}},{key:"runGuarded",value:function(e){return e()}},{key:"runOutsideAngular",value:function(e){return e()}},{key:"runTask",value:function(e){return e()}}]),e}(),ai=function(){function e(t){var n=this;_classCallCheck2(this,e),this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run((function(){n.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")}))}return _createClass2(e,[{key:"_watchAngularEvents",value:function(){var e=this;this._ngZone.onUnstable.subscribe({next:function(){e._didWork=!0,e._isZoneStable=!1}}),this._ngZone.runOutsideAngular((function(){e._ngZone.onStable.subscribe({next:function(){Ya.assertNotInAngularZone(),Qa((function(){e._isZoneStable=!0,e._runCallbacksIfReady()}))}})}))}},{key:"increasePendingRequestCount",value:function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}},{key:"decreasePendingRequestCount",value:function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}},{key:"isStable",value:function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}},{key:"_runCallbacksIfReady",value:function(){var e=this;if(this.isStable())Qa((function(){for(;0!==e._callbacks.length;){var t=e._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(e._didWork)}e._didWork=!1}));else{var t=this.getPendingTasks();this._callbacks=this._callbacks.filter((function(e){return!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)})),this._didWork=!0}}},{key:"getPendingTasks",value:function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map((function(e){return{source:e.source,creationLocation:e.creationLocation,data:e.data}})):[]}},{key:"addCallback",value:function(e,t,n){var r=this,a=-1;t&&t>0&&(a=setTimeout((function(){r._callbacks=r._callbacks.filter((function(e){return e.timeoutId!==a})),e(r._didWork,r.getPendingTasks())}),t)),this._callbacks.push({doneCb:e,timeoutId:a,updateCb:n})}},{key:"whenStable",value:function(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}},{key:"getPendingRequestCount",value:function(){return this._pendingCount}},{key:"findProviders",value:function(e,t,n){return[]}}]),e}(),ii=function(){function e(){_classCallCheck2(this,e),this._applications=new Map,oi.addToWindow(this)}return _createClass2(e,[{key:"registerApplication",value:function(e,t){this._applications.set(e,t)}},{key:"unregisterApplication",value:function(e){this._applications.delete(e)}},{key:"unregisterAllApplications",value:function(){this._applications.clear()}},{key:"getTestability",value:function(e){return this._applications.get(e)||null}},{key:"getAllTestabilities",value:function(){return Array.from(this._applications.values())}},{key:"getAllRootElements",value:function(){return Array.from(this._applications.keys())}},{key:"findTestabilityInTree",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return oi.findTestabilityInTree(this,e,t)}}]),e}(),oi=new(function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"addToWindow",value:function(e){}},{key:"findTestabilityInTree",value:function(e,t,n){return null}}]),e}()),si=new Ee("AllowMultipleToken"),ui=function e(t,n){_classCallCheck2(this,e),this.name=t,this.token=n};function ci(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r="Platform: "+t,a=new Ee(r);return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=li();if(!i||i.injector.get(si,!1))if(e)e(n.concat(t).concat({provide:a,useValue:!0}));else{var o=n.concat(t).concat({provide:a,useValue:!0});!function(e){if(ni&&!ni.destroyed&&!ni.injector.get(si,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");ni=e.get(hi);var t=e.get(Ia,null);t&&t.forEach((function(e){return e()}))}(It.create({providers:o,name:r}))}return function(e){var t=li();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(a)}}function li(){return ni&&!ni.destroyed?ni:null}var hi=function(){function e(t){_classCallCheck2(this,e),this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return _createClass2(e,[{key:"bootstrapModuleFactory",value:function(e,t){var n,r=this,a="noop"===(n=t?t.ngZone:void 0)?new ri:("zone.js"===n?void 0:n)||new Ya({enableLongStackTrace:Ze()}),i=[{provide:Ya,useValue:a}];return a.run((function(){var t=It.create({providers:i,parent:r.injector,name:e.moduleType.name}),n=e.create(t),o=n.injector.get(Xe,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.onDestroy((function(){return mi(r._modules,n)})),a.runOutsideAngular((function(){return a.onError.subscribe({next:function(e){o.handleError(e)}})})),function(e,t,a){try{var i=((o=n.injector.get(Sa)).runInitializers(),o.donePromise.then((function(){return r._moduleDoBootstrap(n),n})));return Gt(i)?i.catch((function(n){throw t.runOutsideAngular((function(){return e.handleError(n)})),n})):i}catch(s){throw t.runOutsideAngular((function(){return e.handleError(s)})),s}var o}(o,a)}))}},{key:"bootstrapModule",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=fi({},n);return function(e,t,n){return e.get(qa).createCompiler([t]).compileModuleAsync(n)}(this.injector,r,e).then((function(e){return t.bootstrapModuleFactory(e,r)}))}},{key:"_moduleDoBootstrap",value:function(e){var t=e.injector.get(pi);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach((function(e){return t.bootstrap(e)}));else{if(!e.instance.ngDoBootstrap)throw new Error("The module ".concat(_e(e.instance.constructor),' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.'));e.instance.ngDoBootstrap(t)}this._modules.push(e)}},{key:"onDestroy",value:function(e){this._destroyListeners.push(e)}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach((function(e){return e.destroy()})),this._destroyListeners.forEach((function(e){return e()})),this._destroyed=!0}},{key:"injector",get:function(){return this._injector}},{key:"destroyed",get:function(){return this._destroyed}}]),e}();function fi(e,t){return Array.isArray(t)?t.reduce(fi,e):Object.assign({},e,t)}var di,pi=((di=function(){function e(t,n,r,a,i,o){var s=this;_classCallCheck2(this,e),this._zone=t,this._console=n,this._injector=r,this._exceptionHandler=a,this._componentFactoryResolver=i,this._initStatus=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=Ze(),this._zone.onMicrotaskEmpty.subscribe({next:function(){s._zone.run((function(){s.tick()}))}});var u=new x((function(e){s._stable=s._zone.isStable&&!s._zone.hasPendingMacrotasks&&!s._zone.hasPendingMicrotasks,s._zone.runOutsideAngular((function(){e.next(s._stable),e.complete()}))})),c=new x((function(e){var t;s._zone.runOutsideAngular((function(){t=s._zone.onStable.subscribe((function(){Ya.assertNotInAngularZone(),Qa((function(){s._stable||s._zone.hasPendingMacrotasks||s._zone.hasPendingMicrotasks||(s._stable=!0,e.next(!0))}))}))}));var n=s._zone.onUnstable.subscribe((function(){Ya.assertInAngularZone(),s._stable&&(s._stable=!1,s._zone.runOutsideAngular((function(){e.next(!1)})))}));return function(){t.unsubscribe(),n.unsubscribe()}}));this.isStable=ee(u,c.pipe(ue()))}return _createClass2(e,[{key:"bootstrap",value:function(e,t){var n,r=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=e instanceof Xt?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);var a=n instanceof en?null:this._injector.get(Be),i=n.create(It.NULL,[],t||n.selector,a);i.onDestroy((function(){r._unloadComponent(i)}));var o=i.injector.get(ai,null);return o&&i.injector.get(ii).registerApplication(i.location.nativeElement,o),this._loadComponent(i),Ze()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),i}},{key:"tick",value:function(){var t=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");var n=e._tickScope();try{this._runningTick=!0;var r,a=_createForOfIteratorHelper(this._views);try{for(a.s();!(r=a.n()).done;)r.value.detectChanges()}catch(s){a.e(s)}finally{a.f()}if(this._enforceNoNewChanges){var i,o=_createForOfIteratorHelper(this._views);try{for(o.s();!(i=o.n()).done;)i.value.checkNoChanges()}catch(s){o.e(s)}finally{o.f()}}}catch(u){this._zone.runOutsideAngular((function(){return t._exceptionHandler.handleError(u)}))}finally{this._runningTick=!1,Ka(n)}}},{key:"attachView",value:function(e){var t=e;this._views.push(t),t.attachToAppRef(this)}},{key:"detachView",value:function(e){var t=e;mi(this._views,t),t.detachFromAppRef()}},{key:"_loadComponent",value:function(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Oa,[]).concat(this._bootstrapListeners).forEach((function(t){return t(e)}))}},{key:"_unloadComponent",value:function(e){this.detachView(e.hostView),mi(this.components,e)}},{key:"ngOnDestroy",value:function(){this._views.slice().forEach((function(e){return e.destroy()}))}},{key:"viewCount",get:function(){return this._views.length}}]),e}())._tickScope=Ha("ApplicationRef#tick()"),di);function mi(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}var vi=function e(){_classCallCheck2(this,e)},gi=function e(){_classCallCheck2(this,e)},yi={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},_i=function(){function e(t,n){_classCallCheck2(this,e),this._compiler=t,this._config=n||yi}return _createClass2(e,[{key:"load",value:function(e){return this._compiler instanceof Va?this.loadFactory(e):this.loadAndCompile(e)}},{key:"loadAndCompile",value:function(e){var t=this,r=_slicedToArray2(e.split("#"),2),a=r[0],i=r[1];return void 0===i&&(i="default"),n("zn8P")(a).then((function(e){return e[i]})).then((function(e){return bi(e,a,i)})).then((function(e){return t._compiler.compileModuleAsync(e)}))}},{key:"loadFactory",value:function(e){var t=_slicedToArray2(e.split("#"),2),r=t[0],a=t[1],i="NgFactory";return void 0===a&&(a="default",i=""),n("zn8P")(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then((function(e){return e[a+i]})).then((function(e){return bi(e,r,a)}))}}]),e}();function bi(e,t,n){if(!e)throw new Error("Cannot find '".concat(n,"' in '").concat(t,"'"));return e}var ki=function e(t,n){_classCallCheck2(this,e),this.name=t,this.callback=n},wi=function(){function e(t,n,r){_classCallCheck2(this,e),this.listeners=[],this.parent=null,this._debugContext=r,this.nativeNode=t,n&&n instanceof xi&&n.addChild(this)}return _createClass2(e,[{key:"injector",get:function(){return this._debugContext.injector}},{key:"componentInstance",get:function(){return this._debugContext.component}},{key:"context",get:function(){return this._debugContext.context}},{key:"references",get:function(){return this._debugContext.references}},{key:"providerTokens",get:function(){return this._debugContext.providerTokens}}]),e}(),xi=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,e,r,a)).properties={},i.attributes={},i.classes={},i.styles={},i.childNodes=[],i.nativeElement=e,i}return _createClass2(n,[{key:"addChild",value:function(e){e&&(this.childNodes.push(e),e.parent=this)}},{key:"removeChild",value:function(e){var t=this.childNodes.indexOf(e);-1!==t&&(e.parent=null,this.childNodes.splice(t,1))}},{key:"insertChildrenAfter",value:function(e,t){var n,r=this,a=this.childNodes.indexOf(e);-1!==a&&((n=this.childNodes).splice.apply(n,[a+1,0].concat(_toConsumableArray(t))),t.forEach((function(t){t.parent&&t.parent.removeChild(t),e.parent=r})))}},{key:"insertBefore",value:function(e,t){var n=this.childNodes.indexOf(e);-1===n?this.addChild(t):(t.parent&&t.parent.removeChild(t),t.parent=this,this.childNodes.splice(n,0,t))}},{key:"query",value:function(e){return this.queryAll(e)[0]||null}},{key:"queryAll",value:function(e){var t=[];return function e(t,r,a){t.childNodes.forEach((function(t){t instanceof n&&(r(t)&&a.push(t),e(t,r,a))}))}(this,e,t),t}},{key:"queryAllNodes",value:function(e){var t=[];return function e(t,r,a){t instanceof n&&t.childNodes.forEach((function(t){r(t)&&a.push(t),t instanceof n&&e(t,r,a)}))}(this,e,t),t}},{key:"triggerEventHandler",value:function(e,t){this.listeners.forEach((function(n){n.name==e&&n.callback(t)}))}},{key:"children",get:function(){return this.childNodes.filter((function(e){return e instanceof n}))}}]),n}(wi),Ci=new Map,Si=function(e){return Ci.get(e)||null};function Ti(e){Ci.set(e.nativeNode,e)}var Ai=ci(null,"core",[{provide:Ra,useValue:"unknown"},{provide:hi,deps:[It]},{provide:ii,deps:[]},{provide:Na,deps:[]}]);function Ei(){return Cn}function Ii(){return Sn}function Ri(e){return e||"en-US"}function Oi(e){var t=[];return e.onStable.subscribe((function(){for(;t.length;)t.pop()()})),function(e){t.push(e)}}var Ni=function e(t){_classCallCheck2(this,e)};function Di(e,t,n,r,a,i){e|=1;var o=ar(t),s=o.matchedQueries,u=o.references;return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,flags:e,checkIndex:-1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:s,matchedQueryIds:o.matchedQueryIds,references:u,ngContentIndex:n,childCount:r,bindings:[],bindingFlags:0,outputs:[],element:{ns:null,name:null,attrs:null,template:i?ur(i):null,componentProvider:null,componentView:null,componentRendererType:null,publicProviders:null,allProviders:null,handleEvent:a||Vn},provider:null,text:null,query:null,ngContent:null}}function Pi(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],u=arguments.length>7?arguments[7]:void 0,c=arguments.length>8?arguments[8]:void 0,l=arguments.length>9?arguments[9]:void 0,h=arguments.length>10?arguments[10]:void 0,f=arguments.length>11?arguments[11]:void 0;l||(l=Vn);var d=ar(n),p=d.matchedQueries,m=d.references,v=d.matchedQueryIds,g=null,y=null;i&&(g=(o=_slicedToArray2(mr(i),2))[0],y=o[1]),u=u||[];for(var _=new Array(u.length),b=0;b<u.length;b++){var k=_slicedToArray2(u[b],3),w=k[0],x=k[1],C=k[2],S=mr(x),T=_slicedToArray2(S,2),A=T[0],E=T[1],I=void 0,R=void 0;switch(15&w){case 4:R=C;break;case 1:case 8:I=C}_[b]={flags:w,ns:A,name:E,nonMinifiedName:E,securityContext:I,suffix:R}}c=c||[];for(var O=new Array(c.length),N=0;N<c.length;N++){var D=_slicedToArray2(c[N],2),P=D[0],F=D[1];O[N]={type:0,target:P,eventName:F,propName:null}}var M=(s=s||[]).map((function(e){var t=_slicedToArray2(e,2),n=t[0],r=t[1],a=_slicedToArray2(mr(n),2);return[a[0],a[1],r]}));return f=function(e){if(e&&"$$undefined"===e.id){var t=null!=e.encapsulation&&e.encapsulation!==Ue.None||e.styles.length||Object.keys(e.data).length;e.id=t?"c"+Gn++:"$$empty"}return e&&"$$empty"===e.id&&(e=null),e||null}(f),h&&(t|=33554432),{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:t|=1,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:p,matchedQueryIds:v,references:m,ngContentIndex:r,childCount:a,bindings:_,bindingFlags:vr(_),outputs:O,element:{ns:g,name:y,attrs:M,template:null,componentProvider:null,componentView:h||null,componentRendererType:f,publicProviders:null,allProviders:null,handleEvent:l||Vn},provider:null,text:null,query:null,ngContent:null}}function Fi(e,t,n){var r,a=n.element,i=e.root.selectorOrNode,o=e.renderer;if(e.parent||!i){r=a.name?o.createElement(a.name,a.ns):o.createComment("");var s=or(e,t,n);s&&o.appendChild(s,r)}else r=o.selectRootElement(i,!!a.componentRendererType&&a.componentRendererType.encapsulation===Ue.ShadowDom);if(a.attrs)for(var u=0;u<a.attrs.length;u++){var c=_slicedToArray2(a.attrs[u],3),l=c[0],h=c[1],f=c[2];o.setAttribute(r,h,f,l)}return r}function Mi(e,t,n,r){for(var a=0;a<n.outputs.length;a++){var i=n.outputs[a],o=Li(e,n.nodeIndex,(h=i.eventName,(l=i.target)?"".concat(l,":").concat(h):h)),s=i.target,u=e;"component"===i.target&&(s=null,u=t);var c=u.renderer.listen(s||r,i.eventName,o);e.disposables[n.outputIndex+a]=c}var l,h}function Li(e,t,n){return function(r){return Zn(e,t,n,r)}}function zi(e,t,n,r){if(!Kn(e,t,n,r))return!1;var a=t.bindings[n],i=Mn(e,t.nodeIndex),o=i.renderElement,s=a.name;switch(15&a.flags){case 1:!function(e,t,n,r,a,i){var o=t.securityContext,s=o?e.root.sanitizer.sanitize(o,i):i;s=null!=s?s.toString():null;var u=e.renderer;null!=i?u.setAttribute(n,a,s,r):u.removeAttribute(n,a,r)}(e,a,o,a.ns,s,r);break;case 2:!function(e,t,n,r){var a=e.renderer;r?a.addClass(t,n):a.removeClass(t,n)}(e,o,s,r);break;case 4:!function(e,t,n,r,a){var i=e.root.sanitizer.sanitize(_t.STYLE,a);if(null!=i){i=i.toString();var o=t.suffix;null!=o&&(i+=o)}else i=null;var s=e.renderer;null!=i?s.setStyle(n,r,i):s.removeStyle(n,r)}(e,a,o,s,r);break;case 8:!function(e,t,n,r,a){var i=t.securityContext,o=i?e.root.sanitizer.sanitize(i,a):a;e.renderer.setProperty(n,r,o)}(33554432&t.flags&&32&a.flags?i.componentView:e,a,o,s,r)}return!0}function Bi(e,t,n){var r=[];for(var a in n)r.push({propName:a,bindingType:n[a]});return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:e,childFlags:0,directChildFlags:0,childMatchedQueries:0,ngContentIndex:-1,matchedQueries:{},matchedQueryIds:0,references:{},childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:{id:t,filterId:rr(t),bindings:r},ngContent:null}}function ji(e){for(var t=e.def.nodeMatchedQueries;e.parent&&nr(e);){var n=e.parentNodeDef;e=e.parent;for(var r=n.nodeIndex+n.childCount,a=0;a<=r;a++){var i=e.def.nodes[a];67108864&i.flags&&536870912&i.flags&&(i.query.filterId&t)===i.query.filterId&&Bn(e,a).setDirty(),!(1&i.flags&&a+i.childCount<n.nodeIndex)&&67108864&i.childFlags&&536870912&i.childFlags||(a+=i.childCount)}}if(134217728&e.def.nodeFlags)for(var o=0;o<e.def.nodes.length;o++){var s=e.def.nodes[o];134217728&s.flags&&536870912&s.flags&&Bn(e,o).setDirty(),o+=s.childCount}}function Vi(e,t){var n=Bn(e,t.nodeIndex);if(n.dirty){var r,a=void 0;if(67108864&t.flags){var i=t.parent.parent;a=qi(e,i.nodeIndex,i.nodeIndex+i.childCount,t.query,[]),r=Ln(e,t.parent.nodeIndex).instance}else 134217728&t.flags&&(a=qi(e,0,e.def.nodes.length-1,t.query,[]),r=e.component);n.reset(a);for(var o=t.query.bindings,s=!1,u=0;u<o.length;u++){var c=o[u],l=void 0;switch(c.bindingType){case 0:l=n.first;break;case 1:l=n,s=!0}r[c.propName]=l}s&&n.notifyOnChanges()}}function qi(e,t,n,r,a){for(var i=t;i<=n;i++){var o=e.def.nodes[i],s=o.matchedQueries[r.id];if(null!=s&&a.push(Ui(e,o,s)),1&o.flags&&o.element.template&&(o.element.template.nodeMatchedQueries&r.filterId)===r.filterId){var u=Mn(e,i);if((o.childMatchedQueries&r.filterId)===r.filterId&&(qi(e,i+1,i+o.childCount,r,a),i+=o.childCount),16777216&o.flags)for(var c=u.viewContainer._embeddedViews,l=0;l<c.length;l++){var h=c[l],f=Jn(h);f&&f===u&&qi(h,0,h.def.nodes.length-1,r,a)}var d=u.template._projectedViews;if(d)for(var p=0;p<d.length;p++){var m=d[p];qi(m,0,m.def.nodes.length-1,r,a)}}(o.childMatchedQueries&r.filterId)!==r.filterId&&(i+=o.childCount)}return a}function Ui(e,t,n){if(null!=n)switch(n){case 1:return Mn(e,t.nodeIndex).renderElement;case 0:return new nn(Mn(e,t.nodeIndex).renderElement);case 2:return Mn(e,t.nodeIndex).template;case 3:return Mn(e,t.nodeIndex).viewContainer;case 4:return Ln(e,t.nodeIndex).instance}}function Wi(e,t){return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:-1,flags:8,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:e,childCount:0,bindings:[],bindingFlags:0,outputs:[],element:null,provider:null,text:null,query:null,ngContent:{index:t}}}function Gi(e,t,n){var r=or(e,t,n);r&&hr(e,n.ngContent.index,1,r,null,void 0)}function Hi(e,t){for(var n=Object.keys(t),r=n.length,a=new Array(r),i=0;i<r;i++){var o=n[i];a[t[o]]=o}return function(e,t,n){for(var r=new Array(n.length),a=0;a<n.length;a++){var i=n[a];r[a]={flags:8,name:i,ns:null,nonMinifiedName:i,securityContext:null,suffix:null}}return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:t,flags:64,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:-1,childCount:0,bindings:r,bindingFlags:vr(r),outputs:[],element:null,provider:null,text:null,query:null,ngContent:null}}(0,e,a)}function Ki(e,t,n){for(var r=new Array(n.length-1),a=1;a<n.length;a++)r[a-1]={flags:8,name:null,ns:null,nonMinifiedName:null,securityContext:null,suffix:n[a]};return{nodeIndex:-1,parent:null,renderParent:null,bindingIndex:-1,outputIndex:-1,checkIndex:e,flags:2,childFlags:0,directChildFlags:0,childMatchedQueries:0,matchedQueries:{},matchedQueryIds:0,references:{},ngContentIndex:t,childCount:0,bindings:r,bindingFlags:8,outputs:[],element:null,provider:null,text:{prefix:n[0]},query:null,ngContent:null}}function Xi(e,t,n){var r,a=e.renderer;r=a.createText(n.text.prefix);var i=or(e,t,n);return i&&a.appendChild(i,r),{renderText:r}}function Qi(e,t){return(null!=e?e.toString():"")+t.suffix}function Yi(e,t,n,r){for(var a=0,i=0,o=0,s=0,u=0,c=null,l=null,h=!1,f=!1,d=null,p=0;p<t.length;p++){var m=t[p];if(m.nodeIndex=p,m.parent=c,m.bindingIndex=a,m.outputIndex=i,m.renderParent=l,o|=m.flags,u|=m.matchedQueryIds,m.element){var v=m.element;v.publicProviders=c?c.element.publicProviders:Object.create(null),v.allProviders=v.publicProviders,h=!1,f=!1,m.element.template&&(u|=m.element.template.nodeMatchedQueries)}if(Ji(c,m,t.length),a+=m.bindings.length,i+=m.outputs.length,!l&&3&m.flags&&(d=m),20224&m.flags){h||(h=!0,c.element.publicProviders=Object.create(c.element.publicProviders),c.element.allProviders=c.element.publicProviders);var g=0!=(32768&m.flags);0==(8192&m.flags)||g?c.element.publicProviders[Un(m.provider.token)]=m:(f||(f=!0,c.element.allProviders=Object.create(c.element.publicProviders)),c.element.allProviders[Un(m.provider.token)]=m),g&&(c.element.componentProvider=m)}if(c?(c.childFlags|=m.flags,c.directChildFlags|=m.flags,c.childMatchedQueries|=m.matchedQueryIds,m.element&&m.element.template&&(c.childMatchedQueries|=m.element.template.nodeMatchedQueries)):s|=m.flags,m.childCount>0)c=m,Zi(m)||(l=m);else for(;c&&p===c.nodeIndex+c.childCount;){var y=c.parent;y&&(y.childFlags|=c.childFlags,y.childMatchedQueries|=c.childMatchedQueries),l=(c=y)&&Zi(c)?c.renderParent:c}}return{factory:null,nodeFlags:o,rootNodeFlags:s,nodeMatchedQueries:u,flags:e,nodes:t,updateDirectives:n||Vn,updateRenderer:r||Vn,handleEvent:function(e,n,r,a){return t[n].element.handleEvent(e,r,a)},bindingCount:a,outputCount:i,lastRenderRootNode:d}}function Zi(e){return 0!=(1&e.flags)&&null===e.element.name}function Ji(e,t,n){var r=t.element&&t.element.template;if(r){if(!r.lastRenderRootNode)throw new Error("Illegal State: Embedded templates without nodes are not allowed!");if(r.lastRenderRootNode&&16777216&r.lastRenderRootNode.flags)throw new Error("Illegal State: Last root node of a template can't have embedded views, at index ".concat(t.nodeIndex,"!"))}if(20224&t.flags&&0==(1&(e?e.flags:0)))throw new Error("Illegal State: StaticProvider/Directive nodes need to be children of elements or anchors, at index ".concat(t.nodeIndex,"!"));if(t.query){if(67108864&t.flags&&(!e||0==(16384&e.flags)))throw new Error("Illegal State: Content Query nodes need to be children of directives, at index ".concat(t.nodeIndex,"!"));if(134217728&t.flags&&e)throw new Error("Illegal State: View Query nodes have to be top level nodes, at index ".concat(t.nodeIndex,"!"))}if(t.childCount){var a=e?e.nodeIndex+e.childCount:n-1;if(t.nodeIndex<=a&&t.nodeIndex+t.childCount>a)throw new Error("Illegal State: childCount of node leads outside of parent, at index ".concat(t.nodeIndex,"!"))}}function $i(e,t,n,r){var a=no(e.root,e.renderer,e,t,n);return ro(a,e.component,r),ao(a),a}function eo(e,t,n){var r=no(e,e.renderer,null,null,t);return ro(r,n,n),ao(r),r}function to(e,t,n,r){var a,i=t.element.componentRendererType;return a=i?e.root.rendererFactory.createRenderer(r,i):e.root.renderer,no(e.root,a,e,t.element.componentProvider,n)}function no(e,t,n,r,a){var i=new Array(a.nodes.length),o=a.outputCount?new Array(a.outputCount):null;return{def:a,parent:n,viewContainerParent:null,parentNodeDef:r,context:null,component:null,nodes:i,state:13,root:e,renderer:t,oldValues:new Array(a.bindingCount),disposables:o,initIndex:-1}}function ro(e,t,n){e.component=t,e.context=n}function ao(e){var t;tr(e)&&(t=Mn(e.parent,e.parentNodeDef.parent.nodeIndex).renderElement);for(var n=e.def,r=e.nodes,a=0;a<n.nodes.length;a++){var i=n.nodes[a],o=void 0;switch(jn.setCurrentNode(e,a),201347067&i.flags){case 1:var s=Fi(e,t,i),u=void 0;if(33554432&i.flags){var c=ur(i.element.componentView);u=jn.createComponentView(e,i,c,s)}Mi(e,u,i,s),o={renderElement:s,componentView:u,viewContainer:null,template:i.element.template?Lr(e,i):void 0},16777216&i.flags&&(o.viewContainer=Dr(e,i,o));break;case 2:o=Xi(e,t,i);break;case 512:case 1024:case 2048:case 256:(o=r[a])||4096&i.flags||(o={instance:ra(e,i)});break;case 16:o={instance:aa(e,i)};break;case 16384:(o=r[a])||(o={instance:ia(e,i)}),32768&i.flags&&ro(Mn(e,i.parent.nodeIndex).componentView,o.instance,o.instance);break;case 32:case 64:case 128:o={value:void 0};break;case 67108864:case 134217728:o=new xa;break;case 8:Gi(e,t,i),o=void 0}r[a]=o}po(e,fo.CreateViewNodes),yo(e,201326592,268435456,0)}function io(e){uo(e),jn.updateDirectives(e,1),mo(e,fo.CheckNoChanges),jn.updateRenderer(e,1),po(e,fo.CheckNoChanges),e.state&=-97}function oo(e){1&e.state?(e.state&=-2,e.state|=2):e.state&=-3,Dn(e,0,256),uo(e),jn.updateDirectives(e,0),mo(e,fo.CheckAndUpdate),yo(e,67108864,536870912,0);var t=Dn(e,256,512);da(e,2097152|(t?1048576:0)),jn.updateRenderer(e,0),po(e,fo.CheckAndUpdate),yo(e,134217728,536870912,0),da(e,8388608|((t=Dn(e,512,768))?4194304:0)),2&e.def.flags&&(e.state&=-9),e.state&=-97,Dn(e,768,1024)}function so(e,t,n,r,a,i,o,s,u,c,l,h,f){return 0===n?function(e,t,n,r,a,i,o,s,u,c,l,h){switch(201347067&t.flags){case 1:return function(e,t,n,r,a,i,o,s,u,c,l,h){var f=t.bindings.length,d=!1;return f>0&&zi(e,t,0,n)&&(d=!0),f>1&&zi(e,t,1,r)&&(d=!0),f>2&&zi(e,t,2,a)&&(d=!0),f>3&&zi(e,t,3,i)&&(d=!0),f>4&&zi(e,t,4,o)&&(d=!0),f>5&&zi(e,t,5,s)&&(d=!0),f>6&&zi(e,t,6,u)&&(d=!0),f>7&&zi(e,t,7,c)&&(d=!0),f>8&&zi(e,t,8,l)&&(d=!0),f>9&&zi(e,t,9,h)&&(d=!0),d}(e,t,n,r,a,i,o,s,u,c,l,h);case 2:return function(e,t,n,r,a,i,o,s,u,c,l,h){var f=!1,d=t.bindings,p=d.length;if(p>0&&Kn(e,t,0,n)&&(f=!0),p>1&&Kn(e,t,1,r)&&(f=!0),p>2&&Kn(e,t,2,a)&&(f=!0),p>3&&Kn(e,t,3,i)&&(f=!0),p>4&&Kn(e,t,4,o)&&(f=!0),p>5&&Kn(e,t,5,s)&&(f=!0),p>6&&Kn(e,t,6,u)&&(f=!0),p>7&&Kn(e,t,7,c)&&(f=!0),p>8&&Kn(e,t,8,l)&&(f=!0),p>9&&Kn(e,t,9,h)&&(f=!0),f){var m=t.text.prefix;p>0&&(m+=Qi(n,d[0])),p>1&&(m+=Qi(r,d[1])),p>2&&(m+=Qi(a,d[2])),p>3&&(m+=Qi(i,d[3])),p>4&&(m+=Qi(o,d[4])),p>5&&(m+=Qi(s,d[5])),p>6&&(m+=Qi(u,d[6])),p>7&&(m+=Qi(c,d[7])),p>8&&(m+=Qi(l,d[8])),p>9&&(m+=Qi(h,d[9]));var v=Fn(e,t.nodeIndex).renderText;e.renderer.setValue(v,m)}return f}(e,t,n,r,a,i,o,s,u,c,l,h);case 16384:return function(e,t,n,r,a,i,o,s,u,c,l,h){var f=Ln(e,t.nodeIndex),d=f.instance,p=!1,m=void 0,v=t.bindings.length;return v>0&&Hn(e,t,0,n)&&(p=!0,m=fa(e,f,t,0,n,m)),v>1&&Hn(e,t,1,r)&&(p=!0,m=fa(e,f,t,1,r,m)),v>2&&Hn(e,t,2,a)&&(p=!0,m=fa(e,f,t,2,a,m)),v>3&&Hn(e,t,3,i)&&(p=!0,m=fa(e,f,t,3,i,m)),v>4&&Hn(e,t,4,o)&&(p=!0,m=fa(e,f,t,4,o,m)),v>5&&Hn(e,t,5,s)&&(p=!0,m=fa(e,f,t,5,s,m)),v>6&&Hn(e,t,6,u)&&(p=!0,m=fa(e,f,t,6,u,m)),v>7&&Hn(e,t,7,c)&&(p=!0,m=fa(e,f,t,7,c,m)),v>8&&Hn(e,t,8,l)&&(p=!0,m=fa(e,f,t,8,l,m)),v>9&&Hn(e,t,9,h)&&(p=!0,m=fa(e,f,t,9,h,m)),m&&d.ngOnChanges(m),65536&t.flags&&Pn(e,256,t.nodeIndex)&&d.ngOnInit(),262144&t.flags&&d.ngDoCheck(),p}(e,t,n,r,a,i,o,s,u,c,l,h);case 32:case 64:case 128:return function(e,t,n,r,a,i,o,s,u,c,l,h){var f=t.bindings,d=!1,p=f.length;if(p>0&&Kn(e,t,0,n)&&(d=!0),p>1&&Kn(e,t,1,r)&&(d=!0),p>2&&Kn(e,t,2,a)&&(d=!0),p>3&&Kn(e,t,3,i)&&(d=!0),p>4&&Kn(e,t,4,o)&&(d=!0),p>5&&Kn(e,t,5,s)&&(d=!0),p>6&&Kn(e,t,6,u)&&(d=!0),p>7&&Kn(e,t,7,c)&&(d=!0),p>8&&Kn(e,t,8,l)&&(d=!0),p>9&&Kn(e,t,9,h)&&(d=!0),d){var m,v=zn(e,t.nodeIndex);switch(201347067&t.flags){case 32:m=new Array(f.length),p>0&&(m[0]=n),p>1&&(m[1]=r),p>2&&(m[2]=a),p>3&&(m[3]=i),p>4&&(m[4]=o),p>5&&(m[5]=s),p>6&&(m[6]=u),p>7&&(m[7]=c),p>8&&(m[8]=l),p>9&&(m[9]=h);break;case 64:m={},p>0&&(m[f[0].name]=n),p>1&&(m[f[1].name]=r),p>2&&(m[f[2].name]=a),p>3&&(m[f[3].name]=i),p>4&&(m[f[4].name]=o),p>5&&(m[f[5].name]=s),p>6&&(m[f[6].name]=u),p>7&&(m[f[7].name]=c),p>8&&(m[f[8].name]=l),p>9&&(m[f[9].name]=h);break;case 128:var g=n;switch(p){case 1:m=g.transform(n);break;case 2:m=g.transform(r);break;case 3:m=g.transform(r,a);break;case 4:m=g.transform(r,a,i);break;case 5:m=g.transform(r,a,i,o);break;case 6:m=g.transform(r,a,i,o,s);break;case 7:m=g.transform(r,a,i,o,s,u);break;case 8:m=g.transform(r,a,i,o,s,u,c);break;case 9:m=g.transform(r,a,i,o,s,u,c,l);break;case 10:m=g.transform(r,a,i,o,s,u,c,l,h)}}v.value=m}return d}(e,t,n,r,a,i,o,s,u,c,l,h);default:throw"unreachable"}}(e,t,r,a,i,o,s,u,c,l,h,f):function(e,t,n){switch(201347067&t.flags){case 1:return function(e,t,n){for(var r=!1,a=0;a<n.length;a++)zi(e,t,a,n[a])&&(r=!0);return r}(e,t,n);case 2:return function(e,t,n){for(var r=t.bindings,a=!1,i=0;i<n.length;i++)Kn(e,t,i,n[i])&&(a=!0);if(a){for(var o="",s=0;s<n.length;s++)o+=Qi(n[s],r[s]);o=t.text.prefix+o;var u=Fn(e,t.nodeIndex).renderText;e.renderer.setValue(u,o)}return a}(e,t,n);case 16384:return function(e,t,n){for(var r=Ln(e,t.nodeIndex),a=r.instance,i=!1,o=void 0,s=0;s<n.length;s++)Hn(e,t,s,n[s])&&(i=!0,o=fa(e,r,t,s,n[s],o));return o&&a.ngOnChanges(o),65536&t.flags&&Pn(e,256,t.nodeIndex)&&a.ngOnInit(),262144&t.flags&&a.ngDoCheck(),i}(e,t,n);case 32:case 64:case 128:return function(e,t,n){for(var r=t.bindings,a=!1,i=0;i<n.length;i++)Kn(e,t,i,n[i])&&(a=!0);if(a){var o,s=zn(e,t.nodeIndex);switch(201347067&t.flags){case 32:o=n;break;case 64:o={};for(var u=0;u<n.length;u++)o[r[u].name]=n[u];break;case 128:var c=n[0],l=n.slice(1);o=c.transform.apply(c,_toConsumableArray(l))}s.value=o}return a}(e,t,n);default:throw"unreachable"}}(e,t,r)}function uo(e){var t=e.def;if(4&t.nodeFlags)for(var n=0;n<t.nodes.length;n++){var r=t.nodes[n];if(4&r.flags){var a=Mn(e,n).template._projectedViews;if(a)for(var i=0;i<a.length;i++){var o=a[i];o.state|=32,Yn(o,e)}}else 0==(4&r.childFlags)&&(n+=r.childCount)}}function co(e,t,n,r,a,i,o,s,u,c,l,h,f){return 0===n?function(e,t,n,r,a,i,o,s,u,c,l,h){var f=t.bindings.length;f>0&&Xn(e,t,0,n),f>1&&Xn(e,t,1,r),f>2&&Xn(e,t,2,a),f>3&&Xn(e,t,3,i),f>4&&Xn(e,t,4,o),f>5&&Xn(e,t,5,s),f>6&&Xn(e,t,6,u),f>7&&Xn(e,t,7,c),f>8&&Xn(e,t,8,l),f>9&&Xn(e,t,9,h)}(e,t,r,a,i,o,s,u,c,l,h,f):function(e,t,n){for(var r=0;r<n.length;r++)Xn(e,t,r,n[r])}(e,t,r),!1}function lo(e,t){if(Bn(e,t.nodeIndex).dirty)throw Rn(jn.createDebugContext(e,t.nodeIndex),"Query ".concat(t.query.id," not dirty"),"Query ".concat(t.query.id," dirty"),0!=(1&e.state))}function ho(e){if(!(128&e.state)){if(mo(e,fo.Destroy),po(e,fo.Destroy),da(e,131072),e.disposables)for(var t=0;t<e.disposables.length;t++)e.disposables[t]();!function(e){if(16&e.state){var t=Jn(e);if(t){var n=t.template._projectedViews;n&&(qe(n,n.indexOf(e)),jn.dirtyParentQueries(e))}}}(e),e.renderer.destroyNode&&function(e){for(var t=e.def.nodes.length,n=0;n<t;n++){var r=e.def.nodes[n];1&r.flags?e.renderer.destroyNode(Mn(e,n).renderElement):2&r.flags?e.renderer.destroyNode(Fn(e,n).renderText):(67108864&r.flags||134217728&r.flags)&&Bn(e,n).destroy()}}(e),tr(e)&&e.renderer.destroy(),e.state|=128}}var fo=function(){var e={CreateViewNodes:0,CheckNoChanges:1,CheckNoChangesProjectedViews:2,CheckAndUpdate:3,CheckAndUpdateProjectedViews:4,Destroy:5};return e[e.CreateViewNodes]="CreateViewNodes",e[e.CheckNoChanges]="CheckNoChanges",e[e.CheckNoChangesProjectedViews]="CheckNoChangesProjectedViews",e[e.CheckAndUpdate]="CheckAndUpdate",e[e.CheckAndUpdateProjectedViews]="CheckAndUpdateProjectedViews",e[e.Destroy]="Destroy",e}();function po(e,t){var n=e.def;if(33554432&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var a=n.nodes[r];33554432&a.flags?vo(Mn(e,r).componentView,t):0==(33554432&a.childFlags)&&(r+=a.childCount)}}function mo(e,t){var n=e.def;if(16777216&n.nodeFlags)for(var r=0;r<n.nodes.length;r++){var a=n.nodes[r];if(16777216&a.flags)for(var i=Mn(e,r).viewContainer._embeddedViews,o=0;o<i.length;o++)vo(i[o],t);else 0==(16777216&a.childFlags)&&(r+=a.childCount)}}function vo(e,t){var n=e.state;switch(t){case fo.CheckNoChanges:0==(128&n)&&(12==(12&n)?io(e):64&n&&go(e,fo.CheckNoChangesProjectedViews));break;case fo.CheckNoChangesProjectedViews:0==(128&n)&&(32&n?io(e):64&n&&go(e,t));break;case fo.CheckAndUpdate:0==(128&n)&&(12==(12&n)?oo(e):64&n&&go(e,fo.CheckAndUpdateProjectedViews));break;case fo.CheckAndUpdateProjectedViews:0==(128&n)&&(32&n?oo(e):64&n&&go(e,t));break;case fo.Destroy:ho(e);break;case fo.CreateViewNodes:ao(e)}}function go(e,t){mo(e,t),po(e,t)}function yo(e,t,n,r){if(e.def.nodeFlags&t&&e.def.nodeFlags&n)for(var a=e.def.nodes.length,i=0;i<a;i++){var o=e.def.nodes[i];if(o.flags&t&&o.flags&n)switch(jn.setCurrentNode(e,o.nodeIndex),r){case 0:Vi(e,o);break;case 1:lo(e,o)}o.childFlags&t&&o.childFlags&n||(i+=o.childCount)}}var _o=!1;function bo(e,t,n,r,a,i){var o=a.injector.get(an);return eo(wo(e,a,o,t,n),r,i)}function ko(e,t,n,r,a,i){var o=a.injector.get(an),s=wo(e,a,new es(o),t,n),u=No(r);return Jo(Vo.create,eo,null,[s,u,i])}function wo(e,t,n,r,a){var i=t.injector.get(bt),o=t.injector.get(Xe),s=n.createRenderer(null,null);return{ngModule:t,injector:e,projectableNodes:r,selectorOrNode:a,sanitizer:i,rendererFactory:n,renderer:s,errorHandler:o}}function xo(e,t,n,r){var a=No(n);return Jo(Vo.create,$i,null,[e,t,a,r])}function Co(e,t,n,r){return n=Eo.get(t.element.componentProvider.provider.token)||No(n),Jo(Vo.create,to,null,[e,t,n,r])}function So(e,t,n,r){return Wr(e,t,n,function(e){var t=function(e){var t=!1,n=!1;return 0===To.size||(e.providers.forEach((function(e){var r=To.get(e.token);3840&e.flags&&r&&(t=!0,n=n||r.deprecatedBehavior)})),e.modules.forEach((function(e){Ao.forEach((function(r,a){ge(a).providedIn===e&&(t=!0,n=n||r.deprecatedBehavior)}))}))),{hasOverrides:t,hasDeprecatedOverrides:n}}(e),n=t.hasOverrides,r=t.hasDeprecatedOverrides;return n?(function(e){for(var t=0;t<e.providers.length;t++){var n=e.providers[t];r&&(n.flags|=4096);var a=To.get(n.token);a&&(n.flags=-3841&n.flags|a.flags,n.deps=ir(a.deps),n.value=a.value)}if(Ao.size>0){var i=new Set(e.modules);Ao.forEach((function(t,n){if(i.has(ge(n).providedIn)){var a={token:n,flags:t.flags|(r?4096:0),deps:ir(t.deps),value:t.value,index:e.providers.length};e.providers.push(a),e.providersByKey[Un(n)]=a}}))}}(e=e.factory((function(){return Vn}))),e):e}(r))}var To=new Map,Ao=new Map,Eo=new Map;function Io(e){var t;To.set(e.token,e),"function"==typeof e.token&&(t=ge(e.token))&&"function"==typeof t.providedIn&&Ao.set(e.token,e)}function Ro(e,t){var n=ur(t.viewDefFactory),r=ur(n.nodes[0].element.componentView);Eo.set(e,r)}function Oo(){To.clear(),Ao.clear(),Eo.clear()}function No(e){if(0===To.size)return e;var t=function(e){for(var t=[],n=null,r=0;r<e.nodes.length;r++){var a=e.nodes[r];1&a.flags&&(n=a),n&&3840&a.flags&&To.has(a.provider.token)&&(t.push(n.nodeIndex),n=null)}return t}(e);if(0===t.length)return e;e=e.factory((function(){return Vn}));for(var n=0;n<t.length;n++)r(e,t[n]);return e;function r(e,t){for(var n=t+1;n<e.nodes.length;n++){var r=e.nodes[n];if(1&r.flags)return;if(3840&r.flags){var a=r.provider,i=To.get(a.token);i&&(r.flags=-3841&r.flags|i.flags,a.deps=ir(i.deps),a.value=i.value)}}}}function Do(e,t,n,r,a,i,o,s,u,c,l,h,f){var d=e.def.nodes[t];return so(e,d,n,r,a,i,o,s,u,c,l,h,f),224&d.flags?zn(e,t).value:void 0}function Po(e,t,n,r,a,i,o,s,u,c,l,h,f){var d=e.def.nodes[t];return co(e,d,n,r,a,i,o,s,u,c,l,h,f),224&d.flags?zn(e,t).value:void 0}function Fo(e){return Jo(Vo.detectChanges,oo,null,[e])}function Mo(e){return Jo(Vo.checkNoChanges,io,null,[e])}function Lo(e){return Jo(Vo.destroy,ho,null,[e])}var zo,Bo,jo,Vo=function(){var e={create:0,detectChanges:1,checkNoChanges:2,destroy:3,handleEvent:4};return e[e.create]="create",e[e.detectChanges]="detectChanges",e[e.checkNoChanges]="checkNoChanges",e[e.destroy]="destroy",e[e.handleEvent]="handleEvent",e}();function qo(e,t){Bo=e,jo=t}function Uo(e,t,n,r){return qo(e,t),Jo(Vo.handleEvent,e.def.handleEvent,null,[e,t,n,r])}function Wo(e,t){if(128&e.state)throw Nn(Vo[zo]);return qo(e,Xo(e,0)),e.def.updateDirectives((function(e,n,r){for(var a=e.def.nodes[n],i=arguments.length,o=new Array(i>3?i-3:0),s=3;s<i;s++)o[s-3]=arguments[s];return 0===t?Ho(e,a,r,o):Ko(e,a,r,o),16384&a.flags&&qo(e,Xo(e,n)),224&a.flags?zn(e,a.nodeIndex).value:void 0}),e)}function Go(e,t){if(128&e.state)throw Nn(Vo[zo]);return qo(e,Qo(e,0)),e.def.updateRenderer((function(e,n,r){for(var a=e.def.nodes[n],i=arguments.length,o=new Array(i>3?i-3:0),s=3;s<i;s++)o[s-3]=arguments[s];return 0===t?Ho(e,a,r,o):Ko(e,a,r,o),3&a.flags&&qo(e,Qo(e,n)),224&a.flags?zn(e,a.nodeIndex).value:void 0}),e)}function Ho(e,t,n,r){if(so.apply(void 0,[e,t,n].concat(_toConsumableArray(r)))){var a=1===n?r[0]:r;if(16384&t.flags){for(var i={},o=0;o<t.bindings.length;o++){var s=t.bindings[o],u=a[o];8&s.flags&&(i[(d=s.nonMinifiedName,"ng-reflect-"+d.replace(/[$@]/g,"_").replace(xt,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return"-"+t[1].toLowerCase()})))]=Ct(u))}var c=t.parent,l=Mn(e,c.nodeIndex).renderElement;if(c.element.name)for(var h in i){var f=i[h];null!=f?e.renderer.setAttribute(l,h,f):e.renderer.removeAttribute(l,h)}else e.renderer.setValue(l,"bindings="+JSON.stringify(i,null,2))}}var d}function Ko(e,t,n,r){co.apply(void 0,[e,t,n].concat(_toConsumableArray(r)))}function Xo(e,t){for(var n=t;n<e.def.nodes.length;n++){var r=e.def.nodes[n];if(16384&r.flags&&r.bindings&&r.bindings.length)return n}return null}function Qo(e,t){for(var n=t;n<e.def.nodes.length;n++){var r=e.def.nodes[n];if(3&r.flags&&r.bindings&&r.bindings.length)return n}return null}var Yo=function(){function e(t,n){_classCallCheck2(this,e),this.view=t,this.nodeIndex=n,null==n&&(this.nodeIndex=n=0),this.nodeDef=t.def.nodes[n];for(var r=this.nodeDef,a=t;r&&0==(1&r.flags);)r=r.parent;if(!r)for(;!r&&a;)r=$n(a),a=a.parent;this.elDef=r,this.elView=a}return _createClass2(e,[{key:"logError",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,i;2&this.nodeDef.flags?(a=this.view.def,i=this.nodeDef.nodeIndex):(a=this.elView.def,i=this.elDef.nodeIndex);var o=function(e,t){for(var n=-1,r=0;r<=t;r++)3&e.nodes[r].flags&&n++;return n}(a,i),s=-1;a.factory((function(){var t;return++s===o?(t=e.error).bind.apply(t,[e].concat(n)):Vn})),s<o&&(e.error("Illegal state: the ViewDefinitionFactory did not call the logger!"),e.error.apply(e,n))}},{key:"elOrCompView",get:function(){return Mn(this.elView,this.elDef.nodeIndex).componentView||this.view}},{key:"injector",get:function(){return Br(this.elView,this.elDef)}},{key:"component",get:function(){return this.elOrCompView.component}},{key:"context",get:function(){return this.elOrCompView.context}},{key:"providerTokens",get:function(){var e=[];if(this.elDef)for(var t=this.elDef.nodeIndex+1;t<=this.elDef.nodeIndex+this.elDef.childCount;t++){var n=this.elView.def.nodes[t];20224&n.flags&&e.push(n.provider.token),t+=n.childCount}return e}},{key:"references",get:function(){var e={};if(this.elDef){Zo(this.elView,this.elDef,e);for(var t=this.elDef.nodeIndex+1;t<=this.elDef.nodeIndex+this.elDef.childCount;t++){var n=this.elView.def.nodes[t];20224&n.flags&&Zo(this.elView,n,e),t+=n.childCount}}return e}},{key:"componentRenderElement",get:function(){var e=function(e){for(;e&&!tr(e);)e=e.parent;return e.parent?Mn(e.parent,$n(e).nodeIndex):null}(this.elOrCompView);return e?e.renderElement:void 0}},{key:"renderNode",get:function(){return 2&this.nodeDef.flags?er(this.view,this.nodeDef):er(this.elView,this.elDef)}}]),e}();function Zo(e,t,n){for(var r in t.references)n[r]=Ui(e,t,t.references[r])}function Jo(e,t,n,r){var a,i,o=zo,s=Bo,u=jo;try{zo=e;var c=t.apply(n,r);return Bo=s,jo=u,zo=o,c}catch(l){if(Ge(l)||!Bo)throw l;throw a=l,i=$o(),a instanceof Error||(a=new Error(a.toString())),On(a,i),a}}function $o(){return Bo?new Yo(Bo,jo):null}var es=function(){function e(t){_classCallCheck2(this,e),this.delegate=t}return _createClass2(e,[{key:"createRenderer",value:function(e,t){return new ts(this.delegate.createRenderer(e,t))}},{key:"begin",value:function(){this.delegate.begin&&this.delegate.begin()}},{key:"end",value:function(){this.delegate.end&&this.delegate.end()}},{key:"whenRenderingDone",value:function(){return this.delegate.whenRenderingDone?this.delegate.whenRenderingDone():Promise.resolve(null)}}]),e}(),ts=function(){function e(t){_classCallCheck2(this,e),this.delegate=t,this.debugContextFactory=$o,this.data=this.delegate.data}return _createClass2(e,[{key:"createDebugContext",value:function(e){return this.debugContextFactory(e)}},{key:"destroyNode",value:function(e){var t=Si(e);!function(e){Ci.delete(e.nativeNode)}(t),t instanceof wi&&(t.listeners.length=0),this.delegate.destroyNode&&this.delegate.destroyNode(e)}},{key:"destroy",value:function(){this.delegate.destroy()}},{key:"createElement",value:function(e,t){var n=this.delegate.createElement(e,t),r=this.createDebugContext(n);if(r){var a=new xi(n,null,r);a.name=e,Ti(a)}return n}},{key:"createComment",value:function(e){var t=this.delegate.createComment(e),n=this.createDebugContext(t);return n&&Ti(new wi(t,null,n)),t}},{key:"createText",value:function(e){var t=this.delegate.createText(e),n=this.createDebugContext(t);return n&&Ti(new wi(t,null,n)),t}},{key:"appendChild",value:function(e,t){var n=Si(e),r=Si(t);n&&r&&n instanceof xi&&n.addChild(r),this.delegate.appendChild(e,t)}},{key:"insertBefore",value:function(e,t,n){var r=Si(e),a=Si(t),i=Si(n);r&&a&&r instanceof xi&&r.insertBefore(i,a),this.delegate.insertBefore(e,t,n)}},{key:"removeChild",value:function(e,t){var n=Si(e),r=Si(t);n&&r&&n instanceof xi&&n.removeChild(r),this.delegate.removeChild(e,t)}},{key:"selectRootElement",value:function(e,t){var n=this.delegate.selectRootElement(e,t),r=$o();return r&&Ti(new xi(n,null,r)),n}},{key:"setAttribute",value:function(e,t,n,r){var a=Si(e);a&&a instanceof xi&&(a.attributes[r?r+":"+t:t]=n),this.delegate.setAttribute(e,t,n,r)}},{key:"removeAttribute",value:function(e,t,n){var r=Si(e);r&&r instanceof xi&&(r.attributes[n?n+":"+t:t]=null),this.delegate.removeAttribute(e,t,n)}},{key:"addClass",value:function(e,t){var n=Si(e);n&&n instanceof xi&&(n.classes[t]=!0),this.delegate.addClass(e,t)}},{key:"removeClass",value:function(e,t){var n=Si(e);n&&n instanceof xi&&(n.classes[t]=!1),this.delegate.removeClass(e,t)}},{key:"setStyle",value:function(e,t,n,r){var a=Si(e);a&&a instanceof xi&&(a.styles[t]=n),this.delegate.setStyle(e,t,n,r)}},{key:"removeStyle",value:function(e,t,n){var r=Si(e);r&&r instanceof xi&&(r.styles[t]=null),this.delegate.removeStyle(e,t,n)}},{key:"setProperty",value:function(e,t,n){var r=Si(e);r&&r instanceof xi&&(r.properties[t]=n),this.delegate.setProperty(e,t,n)}},{key:"listen",value:function(e,t,n){if("string"!=typeof e){var r=Si(e);r&&r.listeners.push(new ki(t,n))}return this.delegate.listen(e,t,n)}},{key:"parentNode",value:function(e){return this.delegate.parentNode(e)}},{key:"nextSibling",value:function(e){return this.delegate.nextSibling(e)}},{key:"setValue",value:function(e,t){return this.delegate.setValue(e,t)}}]),e}();var ns=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this)).moduleType=e,i._bootstrapComponents=r,i._ngModuleDefFactory=a,i}return _createClass2(n,[{key:"create",value:function(e){!function(){if(!_o){_o=!0;var e=Ze()?{setCurrentNode:qo,createRootView:ko,createEmbeddedView:xo,createComponentView:Co,createNgModuleRef:So,overrideProvider:Io,overrideComponentView:Ro,clearOverrides:Oo,checkAndUpdateView:Fo,checkNoChangesView:Mo,destroyView:Lo,createDebugContext:function(e,t){return new Yo(e,t)},handleEvent:Uo,updateDirectives:Wo,updateRenderer:Go}:{setCurrentNode:function(){},createRootView:bo,createEmbeddedView:$i,createComponentView:to,createNgModuleRef:Wr,overrideProvider:Vn,overrideComponentView:Vn,clearOverrides:Vn,checkAndUpdateView:oo,checkNoChangesView:io,destroyView:ho,createDebugContext:function(e,t){return new Yo(e,t)},handleEvent:function(e,t,n,r){return e.def.handleEvent(e,t,n,r)},updateDirectives:function(e,t){return e.def.updateDirectives(0===t?Do:Po,e)},updateRenderer:function(e,t){return e.def.updateRenderer(0===t?Do:Po,e)}};jn.setCurrentNode=e.setCurrentNode,jn.createRootView=e.createRootView,jn.createEmbeddedView=e.createEmbeddedView,jn.createComponentView=e.createComponentView,jn.createNgModuleRef=e.createNgModuleRef,jn.overrideProvider=e.overrideProvider,jn.overrideComponentView=e.overrideComponentView,jn.clearOverrides=e.clearOverrides,jn.checkAndUpdateView=e.checkAndUpdateView,jn.checkNoChangesView=e.checkNoChangesView,jn.destroyView=e.destroyView,jn.resolveDep=la,jn.createDebugContext=e.createDebugContext,jn.handleEvent=e.handleEvent,jn.updateDirectives=e.updateDirectives,jn.updateRenderer=e.updateRenderer,jn.dirtyParentQueries=ji}}();var t=function(e){var t=Array.from(e.providers),n=Array.from(e.modules),r={};for(var a in e.providersByKey)r[a]=e.providersByKey[a];return{factory:e.factory,isRoot:e.isRoot,providers:t,modules:n,providersByKey:r}}(ur(this._ngModuleDefFactory));return jn.createNgModuleRef(this.moduleType,e||It.NULL,this._bootstrapComponents,t)}}]),n}(je),rs=function e(){_classCallCheck2(this,e)},as=function e(){_classCallCheck2(this,e)},is=new Ee("Location Initialized"),os=function e(){_classCallCheck2(this,e)},ss=new Ee("appBaseHref"),us=function(){function e(t,n){var r=this;_classCallCheck2(this,e),this._subject=new ka,this._urlChangeListeners=[],this._platformStrategy=t;var a=this._platformStrategy.getBaseHref();this._platformLocation=n,this._baseHref=e.stripTrailingSlash(cs(a)),this._platformStrategy.onPopState((function(e){r._subject.emit({url:r.path(!0),pop:!0,state:e.state,type:e.type})}))}return _createClass2(e,[{key:"path",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.normalize(this._platformStrategy.path(e))}},{key:"getState",value:function(){return this._platformLocation.getState()}},{key:"isCurrentPathEqualTo",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.path()==this.normalize(t+e.normalizeQueryParams(n))}},{key:"normalize",value:function(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,cs(t)))}},{key:"prepareExternalUrl",value:function(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}},{key:"go",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._platformStrategy.pushState(r,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+e.normalizeQueryParams(n)),r)}},{key:"replaceState",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._platformStrategy.replaceState(r,"",t,n),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+e.normalizeQueryParams(n)),r)}},{key:"forward",value:function(){this._platformStrategy.forward()}},{key:"back",value:function(){this._platformStrategy.back()}},{key:"onUrlChange",value:function(e){var t=this;this._urlChangeListeners.push(e),this.subscribe((function(e){t._notifyUrlChangeListeners(e.url,e.state)}))}},{key:"_notifyUrlChangeListeners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;this._urlChangeListeners.forEach((function(n){return n(e,t)}))}},{key:"subscribe",value:function(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}],[{key:"normalizeQueryParams",value:function(e){return e&&"?"!==e[0]?"?"+e:e}},{key:"joinWithSlash",value:function(e,t){if(0==e.length)return t;if(0==t.length)return e;var n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}},{key:"stripTrailingSlash",value:function(e){var t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}}]),e}();function cs(e){return e.replace(/\/index.html$/,"")}var ls=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this))._platformLocation=e,a._baseHref="",null!=r&&(a._baseHref=r),a}return _createClass2(n,[{key:"onPopState",value:function(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}},{key:"getBaseHref",value:function(){return this._baseHref}},{key:"path",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e}},{key:"prepareExternalUrl",value:function(e){var t=us.joinWithSlash(this._baseHref,e);return t.length>0?"#"+t:t}},{key:"pushState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+us.normalizeQueryParams(r));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.pushState(e,t,a)}},{key:"replaceState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+us.normalizeQueryParams(r));0==a.length&&(a=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,a)}},{key:"forward",value:function(){this._platformLocation.forward()}},{key:"back",value:function(){this._platformLocation.back()}}]),n}(os),hs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;if(_classCallCheck2(this,n),(a=t.call(this))._platformLocation=e,null==r&&(r=a._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");return a._baseHref=r,_possibleConstructorReturn(a)}return _createClass2(n,[{key:"onPopState",value:function(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}},{key:"getBaseHref",value:function(){return this._baseHref}},{key:"prepareExternalUrl",value:function(e){return us.joinWithSlash(this._baseHref,e)}},{key:"path",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._platformLocation.pathname+us.normalizeQueryParams(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?"".concat(t).concat(n):t}},{key:"pushState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+us.normalizeQueryParams(r));this._platformLocation.pushState(e,t,a)}},{key:"replaceState",value:function(e,t,n,r){var a=this.prepareExternalUrl(n+us.normalizeQueryParams(r));this._platformLocation.replaceState(e,t,a)}},{key:"forward",value:function(){this._platformLocation.forward()}},{key:"back",value:function(){this._platformLocation.back()}}]),n}(os),fs=function(){var e={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return e[e.Zero]="Zero",e[e.One]="One",e[e.Two]="Two",e[e.Few]="Few",e[e.Many]="Many",e[e.Other]="Other",e}(),ds=new Ee("UseV4Plurals"),ps=function e(){_classCallCheck2(this,e)},ms=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this)).locale=e,a.deprecatedPluralFn=r,a}return _createClass2(n,[{key:"getPluralCategory",value:function(e,t){switch(this.deprecatedPluralFn?this.deprecatedPluralFn(t||this.locale,e):function(e){return function(e){var t=e.toLowerCase().replace(/_/g,"-"),n=ga[t];if(n)return n;var r=t.split("-")[0];if(n=ga[r])return n;if("en"===r)return ba;throw new Error('Missing locale data for the locale "'.concat(e,'".'))}(e)[ya.PluralCase]}(t||this.locale)(e)){case fs.Zero:return"zero";case fs.One:return"one";case fs.Two:return"two";case fs.Few:return"few";case fs.Many:return"many";default:return"other"}}}]),n}(ps),vs=function e(){_classCallCheck2(this,e)},gs=function(){function e(t,n,r,a){_classCallCheck2(this,e),this._iterableDiffers=t,this._keyValueDiffers=n,this._ngEl=r,this._renderer=a,this._initialClasses=[]}return _createClass2(e,[{key:"getValue",value:function(){return null}},{key:"setClass",value:function(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}},{key:"setNgClass",value:function(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&(Ut(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}},{key:"applyChanges",value:function(){if(this._iterableDiffer){var e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){var t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}},{key:"_applyKeyValueChanges",value:function(e){var t=this;e.forEachAddedItem((function(e){return t._toggleClass(e.key,e.currentValue)})),e.forEachChangedItem((function(e){return t._toggleClass(e.key,e.currentValue)})),e.forEachRemovedItem((function(e){e.previousValue&&t._toggleClass(e.key,!1)}))}},{key:"_applyIterableChanges",value:function(e){var t=this;e.forEachAddedItem((function(e){if("string"!=typeof e.item)throw new Error("NgClass can only toggle CSS classes expressed as strings, got "+_e(e.item));t._toggleClass(e.item,!0)})),e.forEachRemovedItem((function(e){return t._toggleClass(e.item,!1)}))}},{key:"_applyClasses",value:function(e){var t=this;e&&(Array.isArray(e)||e instanceof Set?e.forEach((function(e){return t._toggleClass(e,!0)})):Object.keys(e).forEach((function(n){return t._toggleClass(n,!!e[n])})))}},{key:"_removeClasses",value:function(e){var t=this;e&&(Array.isArray(e)||e instanceof Set?e.forEach((function(e){return t._toggleClass(e,!1)})):Object.keys(e).forEach((function(e){return t._toggleClass(e,!1)})))}},{key:"_toggleClass",value:function(e,t){var n=this;(e=e.trim())&&e.split(/\s+/g).forEach((function(e){t?n._renderer.addClass(n._ngEl.nativeElement,e):n._renderer.removeClass(n._ngEl.nativeElement,e)}))}}]),e}(),ys=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"ngDoCheck",value:function(){this._delegate.applyChanges()}},{key:"klass",set:function(e){this._delegate.setClass(e)}},{key:"ngClass",set:function(e){this._delegate.setNgClass(e)}}]),n}(function(){var e=function(){function e(t){_classCallCheck2(this,e),this._delegate=t}return _createClass2(e,[{key:"getValue",value:function(){return this._delegate.getValue()}}]),e}();return e.ngDirectiveDef=void 0,e}()),_s=function(){function e(t,n,r,a){_classCallCheck2(this,e),this.$implicit=t,this.ngForOf=n,this.index=r,this.count=a}return _createClass2(e,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),e}(),bs=function(){function e(t,n,r){_classCallCheck2(this,e),this._viewContainer=t,this._template=n,this._differs=r,this._ngForOfDirty=!0,this._differ=null}return _createClass2(e,[{key:"ngDoCheck",value:function(){if(this._ngForOfDirty){this._ngForOfDirty=!1;var e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch(r){throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat((t=e).name||typeof t,"'. NgFor only supports binding to Iterables such as Arrays."))}}var t;if(this._differ){var n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}},{key:"_applyChanges",value:function(e){var t=this,n=[];e.forEachOperation((function(e,r,a){if(null==e.previousIndex){var i=t._viewContainer.createEmbeddedView(t._template,new _s(null,t._ngForOf,-1,-1),null===a?void 0:a),o=new ks(e,i);n.push(o)}else if(null==a)t._viewContainer.remove(null===r?void 0:r);else if(null!==r){var s=t._viewContainer.get(r);t._viewContainer.move(s,a);var u=new ks(e,s);n.push(u)}}));for(var r=0;r<n.length;r++)this._perViewChange(n[r].view,n[r].record);for(var a=0,i=this._viewContainer.length;a<i;a++){var o=this._viewContainer.get(a);o.context.index=a,o.context.count=i,o.context.ngForOf=this._ngForOf}e.forEachIdentityChange((function(e){t._viewContainer.get(e.currentIndex).context.$implicit=e.item}))}},{key:"_perViewChange",value:function(e,t){e.context.$implicit=t.item}},{key:"ngForOf",set:function(e){this._ngForOf=e,this._ngForOfDirty=!0}},{key:"ngForTrackBy",set:function(e){Ze()&&null!=e&&"function"!=typeof e&&console&&console.warn&&console.warn("trackBy must be a function, but received ".concat(JSON.stringify(e),". See https://angular.io/docs/ts/latest/api/common/index/NgFor-directive.html#!#change-propagation for more information.")),this._trackByFn=e},get:function(){return this._trackByFn}},{key:"ngForTemplate",set:function(e){e&&(this._template=e)}}],[{key:"ngTemplateContextGuard",value:function(e,t){return!0}}]),e}(),ks=function e(t,n){_classCallCheck2(this,e),this.record=t,this.view=n},ws=function(){function e(t,n){_classCallCheck2(this,e),this._viewContainer=t,this._context=new xs,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=n}return _createClass2(e,[{key:"_updateView",value:function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}},{key:"ngIf",set:function(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}},{key:"ngIfThen",set:function(e){Cs("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}},{key:"ngIfElse",set:function(e){Cs("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}}]),e}(),xs=function e(){_classCallCheck2(this,e),this.$implicit=null,this.ngIf=null};function Cs(e,t){if(t&&!t.createEmbeddedView)throw new Error("".concat(e," must be a TemplateRef, but received '").concat(_e(t),"'."))}var Ss=function(){function e(t,n){_classCallCheck2(this,e),this._viewContainerRef=t,this._templateRef=n,this._created=!1}return _createClass2(e,[{key:"create",value:function(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}},{key:"destroy",value:function(){this._created=!1,this._viewContainerRef.clear()}},{key:"enforceState",value:function(e){e&&!this._created?this.create():!e&&this._created&&this.destroy()}}]),e}(),Ts=function(){function e(){_classCallCheck2(this,e),this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}return _createClass2(e,[{key:"_addCase",value:function(){return this._caseCount++}},{key:"_addDefault",value:function(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}},{key:"_matchCase",value:function(e){var t=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||t,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),t}},{key:"_updateDefaultCases",value:function(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(var t=0;t<this._defaultViews.length;t++)this._defaultViews[t].enforceState(e)}}},{key:"ngSwitch",set:function(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}}]),e}(),As=function(){function e(t,n,r){_classCallCheck2(this,e),this.ngSwitch=r,r._addCase(),this._view=new Ss(t,n)}return _createClass2(e,[{key:"ngDoCheck",value:function(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}]),e}(),Es=function e(){_classCallCheck2(this,e)},Is=function(){function e(t,n,r){_classCallCheck2(this,e),this._ngEl=t,this._differs=n,this._renderer=r}return _createClass2(e,[{key:"getValue",value:function(){return null}},{key:"setNgStyle",value:function(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}},{key:"applyChanges",value:function(){if(this._differ){var e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}},{key:"_applyChanges",value:function(e){var t=this;e.forEachRemovedItem((function(e){return t._setStyle(e.key,null)})),e.forEachAddedItem((function(e){return t._setStyle(e.key,e.currentValue)})),e.forEachChangedItem((function(e){return t._setStyle(e.key,e.currentValue)}))}},{key:"_setStyle",value:function(e,t){var n=_slicedToArray2(e.split("."),2),r=n[0],a=n[1];null!=(t=null!=t&&a?"".concat(t).concat(a):t)?this._renderer.setStyle(this._ngEl.nativeElement,r,t):this._renderer.removeStyle(this._ngEl.nativeElement,r)}}]),e}(),Rs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"ngDoCheck",value:function(){this._delegate.applyChanges()}},{key:"ngStyle",set:function(e){this._delegate.setNgStyle(e)}}]),n}(function(){var e=function(){function e(t){_classCallCheck2(this,e),this._delegate=t}return _createClass2(e,[{key:"getValue",value:function(){return this._delegate.getValue()}}]),e}();return e.ngDirectiveDef=void 0,e}()),Os=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"createSubscription",value:function(e,t){return e.subscribe({next:t,error:function(e){throw e}})}},{key:"dispose",value:function(e){e.unsubscribe()}},{key:"onDestroy",value:function(e){e.unsubscribe()}}]),e}(),Ns=new(function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"createSubscription",value:function(e,t){return e.then(t,(function(e){throw e}))}},{key:"dispose",value:function(e){}},{key:"onDestroy",value:function(e){}}]),e}()),Ds=new Os,Ps=function(){function e(t){_classCallCheck2(this,e),this._ref=t,this._latestValue=null,this._latestReturnedValue=null,this._subscription=null,this._obj=null,this._strategy=null}return _createClass2(e,[{key:"ngOnDestroy",value:function(){this._subscription&&this._dispose()}},{key:"transform",value:function(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):jt(this._latestValue,this._latestReturnedValue)?this._latestReturnedValue:(this._latestReturnedValue=this._latestValue,qt.wrap(this._latestValue)):(e&&this._subscribe(e),this._latestReturnedValue=this._latestValue,this._latestValue)}},{key:"_subscribe",value:function(e){var t=this;this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,(function(n){return t._updateLatestValue(e,n)}))}},{key:"_selectStrategy",value:function(t){if(Gt(t))return Ns;if(Ht(t))return Ds;throw Error("InvalidPipeArgument: '".concat(t,"' for pipe '").concat(_e(e),"'"))}},{key:"_dispose",value:function(){this._strategy.dispose(this._subscription),this._latestValue=null,this._latestReturnedValue=null,this._subscription=null,this._obj=null}},{key:"_updateLatestValue",value:function(e,t){e===this._obj&&(this._latestValue=t,this._ref.markForCheck())}}]),e}(),Fs=function e(){_classCallCheck2(this,e)},Ms=new Ee("DocumentToken");function Ls(e){return"browser"===e}var zs,Bs=((zs=function e(){_classCallCheck2(this,e)}).ngInjectableDef=ve({token:zs,providedIn:"root",factory:function(){return new js(Fe(Ms),window,Fe(Xe))}}),zs),js=function(){function e(t,n,r){_classCallCheck2(this,e),this.document=t,this.window=n,this.errorHandler=r,this.offset=function(){return[0,0]}}return _createClass2(e,[{key:"setOffset",value:function(e){this.offset=Array.isArray(e)?function(){return e}:e}},{key:"getScrollPosition",value:function(){return this.supportScrollRestoration()?[this.window.scrollX,this.window.scrollY]:[0,0]}},{key:"scrollToPosition",value:function(e){this.supportScrollRestoration()&&this.window.scrollTo(e[0],e[1])}},{key:"scrollToAnchor",value:function(e){if(this.supportScrollRestoration()){e=this.window.CSS&&this.window.CSS.escape?this.window.CSS.escape(e):e.replace(/(\"|\'\ |:|\.|\[|\]|,|=)/g,"\\$1");try{var t=this.document.querySelector("#"+e);if(t)return void this.scrollToElement(t);var n=this.document.querySelector("[name='".concat(e,"']"));if(n)return void this.scrollToElement(n)}catch(r){this.errorHandler.handleError(r)}}}},{key:"setHistoryScrollRestoration",value:function(e){if(this.supportScrollRestoration()){var t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}},{key:"scrollToElement",value:function(e){var t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,a=this.offset();this.window.scrollTo(n-a[0],r-a[1])}},{key:"supportScrollRestoration",value:function(){try{return!!this.window&&!!this.window.scrollTo}catch(e){return!1}}}]),e}(),Vs=new x((function(e){return e.complete()}));function qs(e){return e?function(e){return new x((function(t){return e.schedule((function(){return t.complete()}))}))}(e):Vs}function Us(e){var t=new x((function(t){t.next(e),t.complete()}));return t._isScalar=!0,t.value=e,t}function Ws(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[t.length-1];switch(N(r)?t.pop():r=void 0,t.length){case 0:return qs(r);case 1:return r?K(t,r):Us(t[0]);default:return K(t,r)}}var Gs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this))._value=e,r}return _createClass2(n,[{key:"_subscribe",value:function(e){var t=_get(_getPrototypeOf(n.prototype),"_subscribe",this).call(this,e);return t&&!t.closed&&e.next(this._value),t}},{key:"getValue",value:function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new A;return this._value}},{key:"next",value:function(e){_get(_getPrototypeOf(n.prototype),"next",this).call(this,this._value=e)}},{key:"value",get:function(){return this.getValue()}}]),n}(R);function Hs(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}Hs.prototype=Object.create(Error.prototype);var Ks=Hs,Xs={};function Qs(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=null,a=null;return N(t[t.length-1])&&(a=t.pop()),"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&u(t[0])&&(t=t[0]),K(t,a).lift(new Ys(r))}var Ys=function(){function e(t){_classCallCheck2(this,e),this.resultSelector=t}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new Zs(e,this.resultSelector))}}]),e}(),Zs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e)).resultSelector=r,a.active=0,a.values=[],a.observables=[],a}return _createClass2(n,[{key:"_next",value:function(e){this.values.push(Xs),this.observables.push(e)}},{key:"_complete",value:function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(q(this,r,r,n))}}}},{key:"notifyComplete",value:function(e){0==(this.active-=1)&&this.destination.complete()}},{key:"notifyNext",value:function(e,t,n,r,a){var i=this.values,o=this.toRespond?i[n]===Xs?--this.toRespond:this.toRespond:0;i[n]=t,0===o&&(this.resultSelector?this._tryResultSelector(i):this.destination.next(i.slice()))}},{key:"_tryResultSelector",value:function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),n}(U);function Js(e){return new x((function(t){var n;try{n=e()}catch(r){return void t.error(r)}return(n?X(n):qs()).subscribe(t)}))}function $s(){return $(1)}function eu(e,t){return function(n){return n.lift(new tu(e,t))}}var tu=function(){function e(t,n){_classCallCheck2(this,e),this.predicate=t,this.thisArg=n}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new nu(e,this.predicate,this.thisArg))}}]),e}(),nu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,e)).predicate=r,i.thisArg=a,i.count=0,i}return _createClass2(n,[{key:"_next",value:function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)}}]),n}(v);function ru(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}ru.prototype=Object.create(Error.prototype);var au=ru;function iu(e){return function(t){return 0===e?qs():t.lift(new ou(e))}}var ou=function(){function e(t){if(_classCallCheck2(this,e),this.total=t,this.total<0)throw new au}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new su(e,this.total))}}]),e}(),su=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e)).total=r,a.ring=new Array,a.count=0,a}return _createClass2(n,[{key:"_next",value:function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e}},{key:"_complete",value:function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,a=0;a<n;a++){var i=t++%n;e.next(r[i])}e.complete()}}]),n}(v);function uu(e,t,n){return function(r){return r.lift(new cu(e,t,n))}}var cu=function(){function e(t,n,r){_classCallCheck2(this,e),this.nextOrObserver=t,this.error=n,this.complete=r}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new lu(e,this.nextOrObserver,this.error,this.complete))}}]),e}(),lu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,a,i,o){var s;return _classCallCheck2(this,n),(s=t.call(this,e))._tapNext=_,s._tapError=_,s._tapComplete=_,s._tapError=i||_,s._tapComplete=o||_,r(a)?(s._context=_assertThisInitialized(s),s._tapNext=a):a&&(s._context=a,s._tapNext=a.next||_,s._tapError=a.error||_,s._tapComplete=a.complete||_),s}return _createClass2(n,[{key:"_next",value:function(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}},{key:"_error",value:function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)}},{key:"_complete",value:function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}]),n}(v),hu=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fu;return uu({hasValue:!1,next:function(){this.hasValue=!0},complete:function(){if(!this.hasValue)throw e()}})};function fu(){return new Ks}function du(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t){return t.lift(new pu(e))}}var pu=function(){function e(t){_classCallCheck2(this,e),this.defaultValue=t}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new mu(e,this.defaultValue))}}]),e}(),mu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e)).defaultValue=r,a.isEmpty=!0,a}return _createClass2(n,[{key:"_next",value:function(e){this.isEmpty=!1,this.destination.next(e)}},{key:"_complete",value:function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}]),n}(v);function vu(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?eu((function(t,n){return e(t,n,r)})):J,iu(1),n?du(t):hu((function(){return new Ks})))}}function gu(e){return function(t){var n=new yu(e),r=t.lift(n);return n.caught=r}}var yu=function(){function e(t){_classCallCheck2(this,e),this.selector=t}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new _u(e,this.selector,this.caught))}}]),e}(),_u=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,e)).selector=r,i.caught=a,i}return _createClass2(n,[{key:"error",value:function(e){if(!this.isStopped){var t;try{t=this.selector(e,this.caught)}catch(a){return void _get(_getPrototypeOf(n.prototype),"error",this).call(this,a)}this._unsubscribeAndRecycle();var r=new D(this,void 0,void 0);this.add(r),q(this,t,void 0,void 0,r)}}}]),n}(U);function bu(e){return function(t){return 0===e?qs():t.lift(new ku(e))}}var ku=function(){function e(t){if(_classCallCheck2(this,e),this.total=t,this.total<0)throw new au}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new wu(e,this.total))}}]),e}(),wu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e)).total=r,a.count=0,a}return _createClass2(n,[{key:"_next",value:function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))}}]),n}(v);function xu(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?eu((function(t,n){return e(t,n,r)})):J,bu(1),n?du(t):hu((function(){return new Ks})))}}var Cu=function(){function e(t,n,r){_classCallCheck2(this,e),this.predicate=t,this.thisArg=n,this.source=r}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new Su(e,this.predicate,this.thisArg,this.source))}}]),e}(),Su=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this,e)).predicate=r,o.thisArg=a,o.source=i,o.index=0,o.thisArg=a||_assertThisInitialized(o),o}return _createClass2(n,[{key:"notifyComplete",value:function(e){this.destination.next(e),this.destination.complete()}},{key:"_next",value:function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(n){return void this.destination.error(n)}t||this.notifyComplete(!1)}},{key:"_complete",value:function(){this.notifyComplete(!0)}}]),n}(v);function Tu(e,t){return"function"==typeof t?function(n){return n.pipe(Tu((function(n,r){return X(e(n,r)).pipe(W((function(e,a){return t(n,e,r,a)})))})))}:function(t){return t.lift(new Au(e))}}var Au=function(){function e(t){_classCallCheck2(this,e),this.project=t}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new Eu(e,this.project))}}]),e}(),Eu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e)).project=r,a.index=0,a}return _createClass2(n,[{key:"_next",value:function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this._innerSub(t,e,n)}},{key:"_innerSub",value:function(e,t,n){var r=this.innerSubscription;r&&r.unsubscribe();var a=new D(this,void 0,void 0);this.destination.add(a),this.innerSubscription=q(this,e,t,n,a)}},{key:"_complete",value:function(){var e=this.innerSubscription;e&&!e.closed||_get(_getPrototypeOf(n.prototype),"_complete",this).call(this),this.unsubscribe()}},{key:"_unsubscribe",value:function(){this.innerSubscription=null}},{key:"notifyComplete",value:function(e){this.destination.remove(e),this.innerSubscription=null,this.isStopped&&_get(_getPrototypeOf(n.prototype),"_complete",this).call(this)}},{key:"notifyNext",value:function(e,t,n,r,a){this.destination.next(t)}}]),n}(U);function Iu(){return $s()(Ws.apply(void 0,arguments))}function Ru(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){var n=t[t.length-1];N(n)?t.pop():n=null;var r=t.length;return Iu(1!==r||n?r>0?K(t,n):qs(n):Us(t[0]),e)}}function Ou(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Nu(e,t,n))}}var Nu=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck2(this,e),this.accumulator=t,this.seed=n,this.hasSeed=r}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new Du(e,this.accumulator,this.seed,this.hasSeed))}}]),e}(),Du=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this,e)).accumulator=r,o._seed=a,o.hasSeed=i,o.index=0,o}return _createClass2(n,[{key:"_next",value:function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}},{key:"_tryNext",value:function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(r){this.destination.error(r)}this.seed=t,this.destination.next(t)}},{key:"seed",get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e}}]),n}(v);function Pu(e,t){return Q(e,t,1)}function Fu(e){return function(t){return t.lift(new Mu(e))}}var Mu=function(){function e(t){_classCallCheck2(this,e),this.callback=t}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new Lu(e,this.callback))}}]),e}(),Lu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e)).add(new d(r)),a}return n}(v),zu=null;function Bu(){return zu}var ju,Vu={class:"className",innerHtml:"innerHTML",readonly:"readOnly",tabindex:"tabIndex"},qu={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Uu={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Wu=function(){if(Ae.Node)return Ae.Node.prototype.contains||function(e){return!!(16&this.compareDocumentPosition(e))}}(),Gu=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"parse",value:function(e){throw new Error("parse not implemented")}},{key:"hasProperty",value:function(e,t){return t in e}},{key:"setProperty",value:function(e,t,n){e[t]=n}},{key:"getProperty",value:function(e,t){return e[t]}},{key:"invoke",value:function(e,t,n){e[t].apply(e,_toConsumableArray(n))}},{key:"logError",value:function(e){window.console&&(console.error?console.error(e):console.log(e))}},{key:"log",value:function(e){window.console&&window.console.log&&window.console.log(e)}},{key:"logGroup",value:function(e){window.console&&window.console.group&&window.console.group(e)}},{key:"logGroupEnd",value:function(){window.console&&window.console.groupEnd&&window.console.groupEnd()}},{key:"contains",value:function(e,t){return Wu.call(e,t)}},{key:"querySelector",value:function(e,t){return e.querySelector(t)}},{key:"querySelectorAll",value:function(e,t){return e.querySelectorAll(t)}},{key:"on",value:function(e,t,n){e.addEventListener(t,n,!1)}},{key:"onAndCancel",value:function(e,t,n){return e.addEventListener(t,n,!1),function(){e.removeEventListener(t,n,!1)}}},{key:"dispatchEvent",value:function(e,t){e.dispatchEvent(t)}},{key:"createMouseEvent",value:function(e){var t=this.getDefaultDocument().createEvent("MouseEvent");return t.initEvent(e,!0,!0),t}},{key:"createEvent",value:function(e){var t=this.getDefaultDocument().createEvent("Event");return t.initEvent(e,!0,!0),t}},{key:"preventDefault",value:function(e){e.preventDefault(),e.returnValue=!1}},{key:"isPrevented",value:function(e){return e.defaultPrevented||null!=e.returnValue&&!e.returnValue}},{key:"getInnerHTML",value:function(e){return e.innerHTML}},{key:"getTemplateContent",value:function(e){return"content"in e&&this.isTemplateElement(e)?e.content:null}},{key:"getOuterHTML",value:function(e){return e.outerHTML}},{key:"nodeName",value:function(e){return e.nodeName}},{key:"nodeValue",value:function(e){return e.nodeValue}},{key:"type",value:function(e){return e.type}},{key:"content",value:function(e){return this.hasProperty(e,"content")?e.content:e}},{key:"firstChild",value:function(e){return e.firstChild}},{key:"nextSibling",value:function(e){return e.nextSibling}},{key:"parentElement",value:function(e){return e.parentNode}},{key:"childNodes",value:function(e){return e.childNodes}},{key:"childNodesAsList",value:function(e){for(var t=e.childNodes,n=new Array(t.length),r=0;r<t.length;r++)n[r]=t[r];return n}},{key:"clearNodes",value:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}},{key:"appendChild",value:function(e,t){e.appendChild(t)}},{key:"removeChild",value:function(e,t){e.removeChild(t)}},{key:"replaceChild",value:function(e,t,n){e.replaceChild(t,n)}},{key:"remove",value:function(e){return e.parentNode&&e.parentNode.removeChild(e),e}},{key:"insertBefore",value:function(e,t,n){e.insertBefore(n,t)}},{key:"insertAllBefore",value:function(e,t,n){n.forEach((function(n){return e.insertBefore(n,t)}))}},{key:"insertAfter",value:function(e,t,n){e.insertBefore(n,t.nextSibling)}},{key:"setInnerHTML",value:function(e,t){e.innerHTML=t}},{key:"getText",value:function(e){return e.textContent}},{key:"setText",value:function(e,t){e.textContent=t}},{key:"getValue",value:function(e){return e.value}},{key:"setValue",value:function(e,t){e.value=t}},{key:"getChecked",value:function(e){return e.checked}},{key:"setChecked",value:function(e,t){e.checked=t}},{key:"createComment",value:function(e){return this.getDefaultDocument().createComment(e)}},{key:"createTemplate",value:function(e){var t=this.getDefaultDocument().createElement("template");return t.innerHTML=e,t}},{key:"createElement",value:function(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}},{key:"createElementNS",value:function(e,t,n){return(n=n||this.getDefaultDocument()).createElementNS(e,t)}},{key:"createTextNode",value:function(e,t){return(t=t||this.getDefaultDocument()).createTextNode(e)}},{key:"createScriptTag",value:function(e,t,n){var r=(n=n||this.getDefaultDocument()).createElement("SCRIPT");return r.setAttribute(e,t),r}},{key:"createStyleElement",value:function(e,t){var n=(t=t||this.getDefaultDocument()).createElement("style");return this.appendChild(n,this.createTextNode(e,t)),n}},{key:"createShadowRoot",value:function(e){return e.createShadowRoot()}},{key:"getShadowRoot",value:function(e){return e.shadowRoot}},{key:"getHost",value:function(e){return e.host}},{key:"clone",value:function(e){return e.cloneNode(!0)}},{key:"getElementsByClassName",value:function(e,t){return e.getElementsByClassName(t)}},{key:"getElementsByTagName",value:function(e,t){return e.getElementsByTagName(t)}},{key:"classList",value:function(e){return Array.prototype.slice.call(e.classList,0)}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"hasClass",value:function(e,t){return e.classList.contains(t)}},{key:"setStyle",value:function(e,t,n){e.style[t]=n}},{key:"removeStyle",value:function(e,t){e.style[t]=""}},{key:"getStyle",value:function(e,t){return e.style[t]}},{key:"hasStyle",value:function(e,t,n){var r=this.getStyle(e,t)||"";return n?r==n:r.length>0}},{key:"tagName",value:function(e){return e.tagName}},{key:"attributeMap",value:function(e){for(var t=new Map,n=e.attributes,r=0;r<n.length;r++){var a=n.item(r);t.set(a.name,a.value)}return t}},{key:"hasAttribute",value:function(e,t){return e.hasAttribute(t)}},{key:"hasAttributeNS",value:function(e,t,n){return e.hasAttributeNS(t,n)}},{key:"getAttribute",value:function(e,t){return e.getAttribute(t)}},{key:"getAttributeNS",value:function(e,t,n){return e.getAttributeNS(t,n)}},{key:"setAttribute",value:function(e,t,n){e.setAttribute(t,n)}},{key:"setAttributeNS",value:function(e,t,n,r){e.setAttributeNS(t,n,r)}},{key:"removeAttribute",value:function(e,t){e.removeAttribute(t)}},{key:"removeAttributeNS",value:function(e,t,n){e.removeAttributeNS(t,n)}},{key:"templateAwareRoot",value:function(e){return this.isTemplateElement(e)?this.content(e):e}},{key:"createHtmlDocument",value:function(){return document.implementation.createHTMLDocument("fakeTitle")}},{key:"getDefaultDocument",value:function(){return document}},{key:"getBoundingClientRect",value:function(e){try{return e.getBoundingClientRect()}catch(t){return{top:0,bottom:0,left:0,right:0,width:0,height:0}}}},{key:"getTitle",value:function(e){return e.title}},{key:"setTitle",value:function(e,t){e.title=t||""}},{key:"elementMatches",value:function(e,t){return!!this.isElementNode(e)&&(e.matches&&e.matches(t)||e.msMatchesSelector&&e.msMatchesSelector(t)||e.webkitMatchesSelector&&e.webkitMatchesSelector(t))}},{key:"isTemplateElement",value:function(e){return this.isElementNode(e)&&"TEMPLATE"===e.nodeName}},{key:"isTextNode",value:function(e){return e.nodeType===Node.TEXT_NODE}},{key:"isCommentNode",value:function(e){return e.nodeType===Node.COMMENT_NODE}},{key:"isElementNode",value:function(e){return e.nodeType===Node.ELEMENT_NODE}},{key:"hasShadowRoot",value:function(e){return null!=e.shadowRoot&&e instanceof HTMLElement}},{key:"isShadowRoot",value:function(e){return e instanceof DocumentFragment}},{key:"importIntoDoc",value:function(e){return document.importNode(this.templateAwareRoot(e),!0)}},{key:"adoptNode",value:function(e){return document.adoptNode(e)}},{key:"getHref",value:function(e){return e.getAttribute("href")}},{key:"getEventKey",value:function(e){var t=e.key;if(null==t){if(null==(t=e.keyIdentifier))return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Uu.hasOwnProperty(t)&&(t=Uu[t]))}return qu[t]||t}},{key:"getGlobalEventTarget",value:function(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}},{key:"getHistory",value:function(){return window.history}},{key:"getLocation",value:function(){return window.location}},{key:"getBaseHref",value:function(e){var t,n=Hu||(Hu=document.querySelector("base"))?Hu.getAttribute("href"):null;return null==n?null:(t=n,ju||(ju=document.createElement("a")),ju.setAttribute("href",t),"/"===ju.pathname.charAt(0)?ju.pathname:"/"+ju.pathname)}},{key:"resetBaseElement",value:function(){Hu=null}},{key:"getUserAgent",value:function(){return window.navigator.userAgent}},{key:"setData",value:function(e,t,n){this.setAttribute(e,"data-"+t,n)}},{key:"getData",value:function(e,t){return this.getAttribute(e,"data-"+t)}},{key:"getComputedStyle",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return getComputedStyle(e)}))},{key:"supportsWebAnimation",value:function(){return"function"==typeof Element.prototype.animate}},{key:"performanceNow",value:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}},{key:"supportsCookies",value:function(){return!0}},{key:"getCookie",value:function(e){return function(e,t){t=encodeURIComponent(t);var n,r=_createForOfIteratorHelper(e.split(";"));try{for(r.s();!(n=r.n()).done;){var a=n.value,i=a.indexOf("="),o=_slicedToArray2(-1==i?[a,""]:[a.slice(0,i),a.slice(i+1)],2),s=o[0],u=o[1];if(s.trim()===t)return decodeURIComponent(u)}}catch(c){r.e(c)}finally{r.f()}return null}(document.cookie,e)}},{key:"setCookie",value:function(e,t){document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)}},{key:"attrToPropMap",get:function(){return Vu}}],[{key:"makeCurrent",value:function(){var e;e=new n,zu||(zu=e)}}]),n}(function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n),(e=t.call(this))._animationPrefix=null,e._transitionEnd=null;try{var r=e.createElement("div",document);if(null!=e.getStyle(r,"animationName"))e._animationPrefix="";else for(var a=["Webkit","Moz","O","ms"],i=0;i<a.length;i++)if(null!=e.getStyle(r,a[i]+"AnimationName")){e._animationPrefix="-"+a[i].toLowerCase()+"-";break}var o={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};Object.keys(o).forEach((function(t){null!=e.getStyle(r,t)&&(e._transitionEnd=o[t])}))}catch(s){e._animationPrefix=null,e._transitionEnd=null}return e}return _createClass2(n,[{key:"getDistributedNodes",value:function(e){return e.getDistributedNodes()}},{key:"resolveAndSetHref",value:function(e,t,n){e.href=null==n?t:t+"/../"+n}},{key:"supportsDOMEvents",value:function(){return!0}},{key:"supportsNativeShadowDOM",value:function(){return"function"==typeof document.body.createShadowRoot}},{key:"getAnimationPrefix",value:function(){return this._animationPrefix?this._animationPrefix:""}},{key:"getTransitionEnd",value:function(){return this._transitionEnd?this._transitionEnd:""}},{key:"supportsAnimation",value:function(){return null!=this._animationPrefix&&null!=this._transitionEnd}}]),n}(function(){function e(){_classCallCheck2(this,e),this.resourceLoaderType=null}return _createClass2(e,[{key:"attrToPropMap",get:function(){return this._attrToPropMap},set:function(e){this._attrToPropMap=e}}]),e}())),Hu=null;function Ku(){return!!window.history.pushState}var Xu=new Ee("TRANSITION_ID"),Qu=[{provide:Ca,useFactory:function(e,t,n){return function(){n.get(Sa).donePromise.then((function(){var n=Bu();Array.prototype.slice.apply(n.querySelectorAll(t,"style[ng-transition]")).filter((function(t){return n.getAttribute(t,"ng-transition")===e})).forEach((function(e){return n.remove(e)}))}))}},deps:[Xu,Ms,It],multi:!0}],Yu=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"addToWindow",value:function(e){Ae.getAngularTestability=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},Ae.getAllAngularTestabilities=function(){return e.getAllTestabilities()},Ae.getAllAngularRootElements=function(){return e.getAllRootElements()},Ae.frameworkStabilizers||(Ae.frameworkStabilizers=[]),Ae.frameworkStabilizers.push((function(e){var t=Ae.getAllAngularTestabilities(),n=t.length,r=!1,a=function(t){r=r||t,0==--n&&e(r)};t.forEach((function(e){e.whenStable(a)}))}))}},{key:"findTestabilityInTree",value:function(e,t,n){if(null==t)return null;var r=e.getTestability(t);return null!=r?r:n?Bu().isShadowRoot(t)?this.findTestabilityInTree(e,Bu().getHost(t),!0):this.findTestabilityInTree(e,Bu().parentElement(t),!0):null}}],[{key:"init",value:function(){var t;t=new e,oi=t}}]),e}();function Zu(e,t){"undefined"!=typeof COMPILED&&COMPILED||((Ae.ng=Ae.ng||{})[e]=t)}var Ju={ApplicationRef:pi,NgZone:Ya};function $u(e){return Si(e)}var ec=new Ee("EventManagerPlugins"),tc=function(){function e(t,n){var r=this;_classCallCheck2(this,e),this._zone=n,this._eventNameToPlugin=new Map,t.forEach((function(e){return e.manager=r})),this._plugins=t.slice().reverse()}return _createClass2(e,[{key:"addEventListener",value:function(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}},{key:"addGlobalEventListener",value:function(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}},{key:"getZone",value:function(){return this._zone}},{key:"_findPluginFor",value:function(e){var t=this._eventNameToPlugin.get(e);if(t)return t;for(var n=this._plugins,r=0;r<n.length;r++){var a=n[r];if(a.supports(e))return this._eventNameToPlugin.set(e,a),a}throw new Error("No event manager plugin found for event "+e)}}]),e}(),nc=function(){function e(t){_classCallCheck2(this,e),this._doc=t}return _createClass2(e,[{key:"addGlobalEventListener",value:function(e,t,n){var r=Bu().getGlobalEventTarget(this._doc,e);if(!r)throw new Error("Unsupported event target ".concat(r," for event ").concat(t));return this.addEventListener(r,t,n)}}]),e}(),rc=function(){function e(){_classCallCheck2(this,e),this._stylesSet=new Set}return _createClass2(e,[{key:"addStyles",value:function(e){var t=this,n=new Set;e.forEach((function(e){t._stylesSet.has(e)||(t._stylesSet.add(e),n.add(e))})),this.onStylesAdded(n)}},{key:"onStylesAdded",value:function(e){}},{key:"getAllStyles",value:function(){return Array.from(this._stylesSet)}}]),e}(),ac=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this))._doc=e,r._hostNodes=new Set,r._styleNodes=new Set,r._hostNodes.add(e.head),r}return _createClass2(n,[{key:"_addStylesToHost",value:function(e,t){var n=this;e.forEach((function(e){var r=n._doc.createElement("style");r.textContent=e,n._styleNodes.add(t.appendChild(r))}))}},{key:"addHost",value:function(e){this._addStylesToHost(this._stylesSet,e),this._hostNodes.add(e)}},{key:"removeHost",value:function(e){this._hostNodes.delete(e)}},{key:"onStylesAdded",value:function(e){var t=this;this._hostNodes.forEach((function(n){return t._addStylesToHost(e,n)}))}},{key:"ngOnDestroy",value:function(){this._styleNodes.forEach((function(e){return Bu().remove(e)}))}}]),n}(rc),ic={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},oc=/%COMP%/g;function sc(e,t,n){for(var r=0;r<t.length;r++){var a=t[r];Array.isArray(a)?sc(e,a,n):(a=a.replace(oc,e),n.push(a))}return n}function uc(e){return function(t){!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}var cc=function(){function e(t,n,r){_classCallCheck2(this,e),this.eventManager=t,this.sharedStylesHost=n,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new lc(t)}return _createClass2(e,[{key:"createRenderer",value:function(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case Ue.Emulated:var n=this.rendererByCompId.get(t.id);return n||(n=new dc(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n;case Ue.Native:case Ue.ShadowDom:return new pc(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){var r=sc(t.id,t.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}},{key:"begin",value:function(){}},{key:"end",value:function(){}}]),e}(),lc=function(){function e(t){_classCallCheck2(this,e),this.eventManager=t,this.data=Object.create(null)}return _createClass2(e,[{key:"destroy",value:function(){}},{key:"createElement",value:function(e,t){return t?document.createElementNS(ic[t]||t,e):document.createElement(e)}},{key:"createComment",value:function(e){return document.createComment(e)}},{key:"createText",value:function(e){return document.createTextNode(e)}},{key:"appendChild",value:function(e,t){e.appendChild(t)}},{key:"insertBefore",value:function(e,t,n){e&&e.insertBefore(t,n)}},{key:"removeChild",value:function(e,t){e&&e.removeChild(t)}},{key:"selectRootElement",value:function(e,t){var n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error('The selector "'.concat(e,'" did not match any elements'));return t||(n.textContent=""),n}},{key:"parentNode",value:function(e){return e.parentNode}},{key:"nextSibling",value:function(e){return e.nextSibling}},{key:"setAttribute",value:function(e,t,n,r){if(r){t=r+":"+t;var a=ic[r];a?e.setAttributeNS(a,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}},{key:"removeAttribute",value:function(e,t,n){if(n){var r=ic[n];r?e.removeAttributeNS(r,t):e.removeAttribute("".concat(n,":").concat(t))}else e.removeAttribute(t)}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"setStyle",value:function(e,t,n,r){r&on.DashCase?e.style.setProperty(t,n,r&on.Important?"important":""):e.style[t]=n}},{key:"removeStyle",value:function(e,t,n){n&on.DashCase?e.style.removeProperty(t):e.style[t]=""}},{key:"setProperty",value:function(e,t,n){fc(t,"property"),e[t]=n}},{key:"setValue",value:function(e,t){e.nodeValue=t}},{key:"listen",value:function(e,t,n){return fc(t,"listener"),"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,uc(n)):this.eventManager.addEventListener(e,t,uc(n))}}]),e}(),hc="@".charCodeAt(0);function fc(e,t){if(e.charCodeAt(0)===hc)throw new Error("Found the synthetic ".concat(t," ").concat(e,'. Please include either "BrowserAnimationsModule" or "NoopAnimationsModule" in your application.'))}var dc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;_classCallCheck2(this,n),(o=t.call(this,e)).component=a;var s,u=sc(i+"-"+a.id,a.styles,[]);return r.addStyles(u),o.contentAttr="_ngcontent-%COMP%".replace(oc,i+"-"+a.id),o.hostAttr=(s=i+"-"+a.id,"_nghost-%COMP%".replace(oc,s)),o}return _createClass2(n,[{key:"applyToHost",value:function(e){_get(_getPrototypeOf(n.prototype),"setAttribute",this).call(this,e,this.hostAttr,"")}},{key:"createElement",value:function(e,t){var r=_get(_getPrototypeOf(n.prototype),"createElement",this).call(this,e,t);return _get(_getPrototypeOf(n.prototype),"setAttribute",this).call(this,r,this.contentAttr,""),r}}]),n}(lc),pc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;_classCallCheck2(this,n),(o=t.call(this,e)).sharedStylesHost=r,o.hostEl=a,o.component=i,o.shadowRoot=i.encapsulation===Ue.ShadowDom?a.attachShadow({mode:"open"}):a.createShadowRoot(),o.sharedStylesHost.addHost(o.shadowRoot);for(var s=sc(i.id,i.styles,[]),u=0;u<s.length;u++){var c=document.createElement("style");c.textContent=s[u],o.shadowRoot.appendChild(c)}return o}return _createClass2(n,[{key:"nodeOrShadowRoot",value:function(e){return e===this.hostEl?this.shadowRoot:e}},{key:"destroy",value:function(){this.sharedStylesHost.removeHost(this.shadowRoot)}},{key:"appendChild",value:function(e,t){return _get(_getPrototypeOf(n.prototype),"appendChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"insertBefore",value:function(e,t,r){return _get(_getPrototypeOf(n.prototype),"insertBefore",this).call(this,this.nodeOrShadowRoot(e),t,r)}},{key:"removeChild",value:function(e,t){return _get(_getPrototypeOf(n.prototype),"removeChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"parentNode",value:function(e){return this.nodeOrShadowRoot(_get(_getPrototypeOf(n.prototype),"parentNode",this).call(this,this.nodeOrShadowRoot(e)))}}]),n}(lc),mc="undefined"!=typeof Zone&&Zone.__symbol__||function(e){return"__zone_symbol__"+e},vc=mc("addEventListener"),gc=mc("removeEventListener"),yc={},_c="__zone_symbol__propagationStopped",bc=function(){var e="undefined"!=typeof Zone&&Zone[mc("BLACK_LISTED_EVENTS")];if(e){var t={};return e.forEach((function(e){t[e]=e})),t}}(),kc=function(e){return!!bc&&bc.hasOwnProperty(e)},wc=function(e){var t=yc[e.type];if(t){var n=this[t];if(n){var r=[e];if(1===n.length){var a=n[0];return a.zone!==Zone.current?a.zone.run(a.handler,this,r):a.handler.apply(this,r)}for(var i=n.slice(),o=0;o<i.length&&!0!==e[_c];o++){var s=i[o];s.zone!==Zone.current?s.zone.run(s.handler,this,r):s.handler.apply(this,r)}}}},xc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,e)).ngZone=r,a&&function(e){return"server"===e}(a)||i.patchEvent(),i}return _createClass2(n,[{key:"patchEvent",value:function(){if("undefined"!=typeof Event&&Event&&Event.prototype&&!Event.prototype.__zone_symbol__stopImmediatePropagation){var e=Event.prototype.__zone_symbol__stopImmediatePropagation=Event.prototype.stopImmediatePropagation;Event.prototype.stopImmediatePropagation=function(){this&&(this[_c]=!0),e&&e.apply(this,arguments)}}}},{key:"supports",value:function(e){return!0}},{key:"addEventListener",value:function(e,t,n){var r=this,a=n;if(!e[vc]||Ya.isInAngularZone()&&!kc(t))e.addEventListener(t,a,!1);else{var i=yc[t];i||(i=yc[t]=mc("ANGULAR"+t+"FALSE"));var o=e[i],s=o&&o.length>0;o||(o=e[i]=[]);var u=kc(t)?Zone.root:Zone.current;if(0===o.length)o.push({zone:u,handler:a});else{for(var c=!1,l=0;l<o.length;l++)if(o[l].handler===a){c=!0;break}c||o.push({zone:u,handler:a})}s||e[vc](t,wc,!1)}return function(){return r.removeEventListener(e,t,a)}}},{key:"removeEventListener",value:function(e,t,n){var r=e[gc];if(!r)return e.removeEventListener.apply(e,[t,n,!1]);var a=yc[t],i=a&&e[a];if(!i)return e.removeEventListener.apply(e,[t,n,!1]);for(var o=!1,s=0;s<i.length;s++)if(i[s].handler===n){o=!0,i.splice(s,1);break}o?0===i.length&&r.apply(e,[t,wc,!1]):e.removeEventListener.apply(e,[t,n,!1])}}]),n}(nc),Cc={pan:!0,panstart:!0,panmove:!0,panend:!0,pancancel:!0,panleft:!0,panright:!0,panup:!0,pandown:!0,pinch:!0,pinchstart:!0,pinchmove:!0,pinchend:!0,pinchcancel:!0,pinchin:!0,pinchout:!0,press:!0,pressup:!0,rotate:!0,rotatestart:!0,rotatemove:!0,rotateend:!0,rotatecancel:!0,swipe:!0,swipeleft:!0,swiperight:!0,swipeup:!0,swipedown:!0,tap:!0},Sc=new Ee("HammerGestureConfig"),Tc=new Ee("HammerLoader"),Ac=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this,e))._config=r,o.console=a,o.loader=i,o}return _createClass2(n,[{key:"supports",value:function(e){return!(!Cc.hasOwnProperty(e.toLowerCase())&&!this.isCustomEvent(e)||!window.Hammer&&!this.loader&&(this.console.warn('The "'.concat(e,'" event cannot be bound because Hammer.JS is not loaded and no custom loader has been specified.')),1))}},{key:"addEventListener",value:function(e,t,n){var r=this,a=this.manager.getZone();if(t=t.toLowerCase(),!window.Hammer&&this.loader){var i=!1,o=function(){i=!0};return this.loader().then((function(){if(!window.Hammer)return r.console.warn("The custom HAMMER_LOADER completed, but Hammer.JS is not present."),void(o=function(){});i||(o=r.addEventListener(e,t,n))})).catch((function(){r.console.warn('The "'.concat(t,'" event cannot be bound because the custom Hammer.JS loader failed.')),o=function(){}})),function(){o()}}return a.runOutsideAngular((function(){var i=r._config.buildHammer(e),o=function(e){a.runGuarded((function(){n(e)}))};return i.on(t,o),function(){i.off(t,o),"function"==typeof i.destroy&&i.destroy()}}))}},{key:"isCustomEvent",value:function(e){return this._config.events.indexOf(e)>-1}}]),n}(nc),Ec=["alt","control","meta","shift"],Ic={alt:function(e){return e.altKey},control:function(e){return e.ctrlKey},meta:function(e){return e.metaKey},shift:function(e){return e.shiftKey}},Rc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"supports",value:function(e){return null!=n.parseEventName(e)}},{key:"addEventListener",value:function(e,t,r){var a=n.parseEventName(t),i=n.eventCallback(a.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular((function(){return Bu().onAndCancel(e,a.domEventName,i)}))}}],[{key:"parseEventName",value:function(e){var t=e.toLowerCase().split("."),r=t.shift();if(0===t.length||"keydown"!==r&&"keyup"!==r)return null;var a=n._normalizeKey(t.pop()),i="";if(Ec.forEach((function(e){var n=t.indexOf(e);n>-1&&(t.splice(n,1),i+=e+".")})),i+=a,0!=t.length||0===a.length)return null;var o={};return o.domEventName=r,o.fullKey=i,o}},{key:"getEventFullKey",value:function(e){var t="",n=Bu().getEventKey(e);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),Ec.forEach((function(r){r!=n&&(0,Ic[r])(e)&&(t+=r+".")})),t+=n}},{key:"eventCallback",value:function(e,t,r){return function(a){n.getEventFullKey(a)===e&&r.runGuarded((function(){return t(a)}))}}},{key:"_normalizeKey",value:function(e){switch(e){case"esc":return"escape";default:return e}}}]),n}(nc),Oc=function e(){_classCallCheck2(this,e)},Nc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this))._doc=e,r}return _createClass2(n,[{key:"sanitize",value:function(e,t){if(null==t)return null;switch(e){case _t.NONE:return t;case _t.HTML:return t instanceof Pc?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"HTML"),function(e,t){var n=null;try{at=at||new Je(e);var r=t?String(t):"";n=at.getInertBodyElement(r);var a=5,i=r;do{if(0===a)throw new Error("Failed to sanitize html because the input is unstable");a--,r=i,i=n.innerHTML,n=at.getInertBodyElement(r)}while(r!==i);var o=new pt,s=o.sanitizeChildren(yt(n)||n);return Ze()&&o.sanitizedSomething&&console.warn("WARNING: sanitizing HTML stripped some content, see http://g.co/ng/security#xss"),s}finally{if(n)for(var u=yt(n)||n;u.firstChild;)u.removeChild(u.firstChild)}}(this._doc,String(t)));case _t.STYLE:return t instanceof Fc?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"Style"),function(e){if(!(e=String(e).trim()))return"";var t=e.match(wt);return t&&tt(t[1])===t[1]||e.match(kt)&&function(e){for(var t=!0,n=!0,r=0;r<e.length;r++){var a=e.charAt(r);"'"===a&&n?t=!t:'"'===a&&t&&(n=!n)}return t&&n}(e)?e:(Ze()&&console.warn("WARNING: sanitizing unsafe style value ".concat(e," (see http://g.co/ng/security#xss).")),"unsafe")}(t));case _t.SCRIPT:if(t instanceof Mc)return t.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(t,"Script"),new Error("unsafe value used in a script context");case _t.URL:return t instanceof zc||t instanceof Lc?t.changingThisBreaksApplicationSecurity:(this.checkNotSafeValue(t,"URL"),tt(String(t)));case _t.RESOURCE_URL:if(t instanceof zc)return t.changingThisBreaksApplicationSecurity;throw this.checkNotSafeValue(t,"ResourceURL"),new Error("unsafe value used in a resource URL context (see http://g.co/ng/security#xss)");default:throw new Error("Unexpected SecurityContext ".concat(e," (see http://g.co/ng/security#xss)"))}}},{key:"checkNotSafeValue",value:function(e,t){if(e instanceof Dc)throw new Error("Required a safe ".concat(t,", got a ").concat(e.getTypeName()," (see http://g.co/ng/security#xss)"))}},{key:"bypassSecurityTrustHtml",value:function(e){return new Pc(e)}},{key:"bypassSecurityTrustStyle",value:function(e){return new Fc(e)}},{key:"bypassSecurityTrustScript",value:function(e){return new Mc(e)}},{key:"bypassSecurityTrustUrl",value:function(e){return new Lc(e)}},{key:"bypassSecurityTrustResourceUrl",value:function(e){return new zc(e)}}]),n}(Oc),Dc=function(){function e(t){_classCallCheck2(this,e),this.changingThisBreaksApplicationSecurity=t}return _createClass2(e,[{key:"toString",value:function(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"}}]),e}(),Pc=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"getTypeName",value:function(){return"HTML"}}]),n}(Dc),Fc=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"getTypeName",value:function(){return"Style"}}]),n}(Dc),Mc=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"getTypeName",value:function(){return"Script"}}]),n}(Dc),Lc=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"getTypeName",value:function(){return"URL"}}]),n}(Dc),zc=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"getTypeName",value:function(){return"ResourceURL"}}]),n}(Dc),Bc=ci(Ai,"browser",[{provide:Ra,useValue:"browser"},{provide:Ia,useValue:function(){Gu.makeCurrent(),Yu.init()},multi:!0},{provide:as,useClass:function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this))._doc=e,r._init(),r}return _createClass2(n,[{key:"_init",value:function(){this.location=Bu().getLocation(),this._history=Bu().getHistory()}},{key:"getBaseHrefFromDOM",value:function(){return Bu().getBaseHref(this._doc)}},{key:"onPopState",value:function(e){Bu().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",e,!1)}},{key:"onHashChange",value:function(e){Bu().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",e,!1)}},{key:"pushState",value:function(e,t,n){Ku()?this._history.pushState(e,t,n):this.location.hash=n}},{key:"replaceState",value:function(e,t,n){Ku()?this._history.replaceState(e,t,n):this.location.hash=n}},{key:"forward",value:function(){this._history.forward()}},{key:"back",value:function(){this._history.back()}},{key:"getState",value:function(){return this._history.state}},{key:"href",get:function(){return this.location.href}},{key:"protocol",get:function(){return this.location.protocol}},{key:"hostname",get:function(){return this.location.hostname}},{key:"port",get:function(){return this.location.port}},{key:"pathname",get:function(){return this.location.pathname},set:function(e){this.location.pathname=e}},{key:"search",get:function(){return this.location.search}},{key:"hash",get:function(){return this.location.hash}}]),n}(as),deps:[Ms]},{provide:Ms,useFactory:function(){return document},deps:[]}]);function jc(){return new Xe}var Vc=function(){function e(t){if(_classCallCheck2(this,e),t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}return _createClass2(e,null,[{key:"withServerTransition",value:function(t){return{ngModule:e,providers:[{provide:Ta,useValue:t.appId},{provide:Xu,useExisting:Ta},Qu]}}}]),e}();"undefined"!=typeof window&&window;var qc=function e(t,n){_classCallCheck2(this,e),this.id=t,this.url=n},Uc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"imperative",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return _classCallCheck2(this,n),(a=t.call(this,e,r)).navigationTrigger=i,a.restoredState=o,a}return _createClass2(n,[{key:"toString",value:function(){return"NavigationStart(id: ".concat(this.id,", url: '").concat(this.url,"')")}}]),n}(qc),Wc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,e,r)).urlAfterRedirects=a,i}return _createClass2(n,[{key:"toString",value:function(){return"NavigationEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"')")}}]),n}(qc),Gc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,e,r)).reason=a,i}return _createClass2(n,[{key:"toString",value:function(){return"NavigationCancel(id: ".concat(this.id,", url: '").concat(this.url,"')")}}]),n}(qc),Hc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,e,r)).error=a,i}return _createClass2(n,[{key:"toString",value:function(){return"NavigationError(id: ".concat(this.id,", url: '").concat(this.url,"', error: ").concat(this.error,")")}}]),n}(qc),Kc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return _createClass2(n,[{key:"toString",value:function(){return"RoutesRecognized(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(qc),Xc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return _createClass2(n,[{key:"toString",value:function(){return"GuardsCheckStart(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(qc),Qc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o){var s;return _classCallCheck2(this,n),(s=t.call(this,e,r)).urlAfterRedirects=a,s.state=i,s.shouldActivate=o,s}return _createClass2(n,[{key:"toString",value:function(){return"GuardsCheckEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,", shouldActivate: ").concat(this.shouldActivate,")")}}]),n}(qc),Yc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return _createClass2(n,[{key:"toString",value:function(){return"ResolveStart(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(qc),Zc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this,e,r)).urlAfterRedirects=a,o.state=i,o}return _createClass2(n,[{key:"toString",value:function(){return"ResolveEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}(qc),Jc=function(){function e(t){_classCallCheck2(this,e),this.route=t}return _createClass2(e,[{key:"toString",value:function(){return"RouteConfigLoadStart(path: ".concat(this.route.path,")")}}]),e}(),$c=function(){function e(t){_classCallCheck2(this,e),this.route=t}return _createClass2(e,[{key:"toString",value:function(){return"RouteConfigLoadEnd(path: ".concat(this.route.path,")")}}]),e}(),el=function(){function e(t){_classCallCheck2(this,e),this.snapshot=t}return _createClass2(e,[{key:"toString",value:function(){return"ChildActivationStart(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),tl=function(){function e(t){_classCallCheck2(this,e),this.snapshot=t}return _createClass2(e,[{key:"toString",value:function(){return"ChildActivationEnd(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),nl=function(){function e(t){_classCallCheck2(this,e),this.snapshot=t}return _createClass2(e,[{key:"toString",value:function(){return"ActivationStart(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),rl=function(){function e(t){_classCallCheck2(this,e),this.snapshot=t}return _createClass2(e,[{key:"toString",value:function(){return"ActivationEnd(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),al=function(){function e(t,n,r){_classCallCheck2(this,e),this.routerEvent=t,this.position=n,this.anchor=r}return _createClass2(e,[{key:"toString",value:function(){return"Scroll(anchor: '".concat(this.anchor,"', position: '").concat(this.position?"".concat(this.position[0],", ").concat(this.position[1]):null,"')")}}]),e}(),il=function e(){_classCallCheck2(this,e)},ol=function(){function e(t){_classCallCheck2(this,e),this.params=t||{}}return _createClass2(e,[{key:"has",value:function(e){return this.params.hasOwnProperty(e)}},{key:"get",value:function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t[0]:t}return null}},{key:"getAll",value:function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t:[t]}return[]}},{key:"keys",get:function(){return Object.keys(this.params)}}]),e}();function sl(e){return new ol(e)}function ul(e){var t=Error("NavigationCancelingError: "+e);return t.ngNavigationCancelingError=!0,t}function cl(e,t,n){var r=n.path.split("/");if(r.length>e.length)return null;if("full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;for(var a={},i=0;i<r.length;i++){var o=r[i],s=e[i];if(o.startsWith(":"))a[o.substring(1)]=s;else if(o!==s.path)return null}return{consumed:e.slice(0,r.length),posParams:a}}var ll=function e(t,n){_classCallCheck2(this,e),this.routes=t,this.module=n};function hl(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=0;n<e.length;n++){var r=e[n];fl(r,dl(t,r))}}function fl(e,t){if(!e)throw new Error("\n      Invalid configuration of route '".concat(t,"': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    "));if(Array.isArray(e))throw new Error("Invalid configuration of route '".concat(t,"': Array cannot be specified"));if(!e.component&&!e.children&&!e.loadChildren&&e.outlet&&"primary"!==e.outlet)throw new Error("Invalid configuration of route '".concat(t,"': a componentless route without children or loadChildren cannot have a named outlet set"));if(e.redirectTo&&e.children)throw new Error("Invalid configuration of route '".concat(t,"': redirectTo and children cannot be used together"));if(e.redirectTo&&e.loadChildren)throw new Error("Invalid configuration of route '".concat(t,"': redirectTo and loadChildren cannot be used together"));if(e.children&&e.loadChildren)throw new Error("Invalid configuration of route '".concat(t,"': children and loadChildren cannot be used together"));if(e.redirectTo&&e.component)throw new Error("Invalid configuration of route '".concat(t,"': redirectTo and component cannot be used together"));if(e.path&&e.matcher)throw new Error("Invalid configuration of route '".concat(t,"': path and matcher cannot be used together"));if(void 0===e.redirectTo&&!e.component&&!e.children&&!e.loadChildren)throw new Error("Invalid configuration of route '".concat(t,"'. One of the following must be provided: component, redirectTo, children or loadChildren"));if(void 0===e.path&&void 0===e.matcher)throw new Error("Invalid configuration of route '".concat(t,"': routes must have either a path or a matcher specified"));if("string"==typeof e.path&&"/"===e.path.charAt(0))throw new Error("Invalid configuration of route '".concat(t,"': path cannot start with a slash"));if(""===e.path&&void 0!==e.redirectTo&&void 0===e.pathMatch)throw new Error("Invalid configuration of route '{path: \"".concat(t,'", redirectTo: "').concat(e.redirectTo,"\"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'."));if(void 0!==e.pathMatch&&"full"!==e.pathMatch&&"prefix"!==e.pathMatch)throw new Error("Invalid configuration of route '".concat(t,"': pathMatch can only be set to 'prefix' or 'full'"));e.children&&hl(e.children,t)}function dl(e,t){return t?e||t.path?e&&!t.path?e+"/":!e&&t.path?t.path:"".concat(e,"/").concat(t.path):"":e}function pl(e){var t=e.children&&e.children.map(pl),n=t?Object.assign({},e,{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&"primary"!==n.outlet&&(n.component=il),n}function ml(e,t){var n,r=Object.keys(e),a=Object.keys(t);if(!r||!a||r.length!=a.length)return!1;for(var i=0;i<r.length;i++)if(e[n=r[i]]!==t[n])return!1;return!0}function vl(e){return Array.prototype.concat.apply([],e)}function gl(e){return e.length>0?e[e.length-1]:null}function yl(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}function _l(e){return Ht(e)?e:Gt(e)?X(Promise.resolve(e)):Ws(e)}function bl(e,t,n){return n?function(e,t){return ml(e,t)}(e.queryParams,t.queryParams)&&function e(t,n){if(!Cl(t.segments,n.segments))return!1;if(t.numberOfChildren!==n.numberOfChildren)return!1;for(var r in n.children){if(!t.children[r])return!1;if(!e(t.children[r],n.children[r]))return!1}return!0}(e.root,t.root):function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every((function(n){return t[n]===e[n]}))}(e.queryParams,t.queryParams)&&function e(t,n){return function t(n,r,a){if(n.segments.length>a.length)return!!Cl(n.segments.slice(0,a.length),a)&&!r.hasChildren();if(n.segments.length===a.length){if(!Cl(n.segments,a))return!1;for(var i in r.children){if(!n.children[i])return!1;if(!e(n.children[i],r.children[i]))return!1}return!0}var o=a.slice(0,n.segments.length),s=a.slice(n.segments.length);return!!Cl(n.segments,o)&&!!n.children.primary&&t(n.children.primary,r,s)}(t,n,n.segments)}(e.root,t.root)}var kl=function(){function e(t,n,r){_classCallCheck2(this,e),this.root=t,this.queryParams=n,this.fragment=r}return _createClass2(e,[{key:"toString",value:function(){return El.serialize(this)}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=sl(this.queryParams)),this._queryParamMap}}]),e}(),wl=function(){function e(t,n){var r=this;_classCallCheck2(this,e),this.segments=t,this.children=n,this.parent=null,yl(n,(function(e,t){return e.parent=r}))}return _createClass2(e,[{key:"hasChildren",value:function(){return this.numberOfChildren>0}},{key:"toString",value:function(){return Il(this)}},{key:"numberOfChildren",get:function(){return Object.keys(this.children).length}}]),e}(),xl=function(){function e(t,n){_classCallCheck2(this,e),this.path=t,this.parameters=n}return _createClass2(e,[{key:"toString",value:function(){return Fl(this)}},{key:"parameterMap",get:function(){return this._parameterMap||(this._parameterMap=sl(this.parameters)),this._parameterMap}}]),e}();function Cl(e,t){return e.length===t.length&&e.every((function(e,n){return e.path===t[n].path}))}function Sl(e,t){var n=[];return yl(e.children,(function(e,r){"primary"===r&&(n=n.concat(t(e,r)))})),yl(e.children,(function(e,r){"primary"!==r&&(n=n.concat(t(e,r)))})),n}var Tl=function e(){_classCallCheck2(this,e)},Al=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"parse",value:function(e){var t=new jl(e);return new kl(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}},{key:"serialize",value:function(e){return"".concat("/"+function e(t,n){if(!t.hasChildren())return Il(t);if(n){var r=t.children.primary?e(t.children.primary,!1):"",a=[];return yl(t.children,(function(t,n){"primary"!==n&&a.push("".concat(n,":").concat(e(t,!1)))})),a.length>0?"".concat(r,"(").concat(a.join("//"),")"):r}var i=Sl(t,(function(n,r){return"primary"===r?[e(t.children.primary,!1)]:["".concat(r,":").concat(e(n,!1))]}));return"".concat(Il(t),"/(").concat(i.join("//"),")")}(e.root,!0)).concat((t=e.queryParams,n=Object.keys(t).map((function(e){var n=t[e];return Array.isArray(n)?n.map((function(t){return"".concat(Ol(e),"=").concat(Ol(t))})).join("&"):"".concat(Ol(e),"=").concat(Ol(n))})),n.length?"?"+n.join("&"):"")).concat("string"==typeof e.fragment?"#"+encodeURI(e.fragment):"");var t,n}}]),e}(),El=new Al;function Il(e){return e.segments.map((function(e){return Fl(e)})).join("/")}function Rl(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ol(e){return Rl(e).replace(/%3B/gi,";")}function Nl(e){return Rl(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Dl(e){return decodeURIComponent(e)}function Pl(e){return Dl(e.replace(/\+/g,"%20"))}function Fl(e){return"".concat(Nl(e.path)).concat((t=e.parameters,Object.keys(t).map((function(e){return";".concat(Nl(e),"=").concat(Nl(t[e]))})).join("")));var t}var Ml=/^[^\/()?;=#]+/;function Ll(e){var t=e.match(Ml);return t?t[0]:""}var zl=/^[^=?&#]+/,Bl=/^[^?&#]+/,jl=function(){function e(t){_classCallCheck2(this,e),this.url=t,this.remaining=t}return _createClass2(e,[{key:"parseRootSegment",value:function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new wl([],{}):new wl([],this.parseChildren())}},{key:"parseQueryParams",value:function(){var e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}},{key:"parseFragment",value:function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}},{key:"parseChildren",value:function(){if(""===this.remaining)return{};this.consumeOptional("/");var e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());var t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));var n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n.primary=new wl(e,t)),n}},{key:"parseSegment",value:function(){var e=Ll(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '".concat(this.remaining,"'."));return this.capture(e),new xl(Dl(e),this.parseMatrixParams())}},{key:"parseMatrixParams",value:function(){for(var e={};this.consumeOptional(";");)this.parseParam(e);return e}},{key:"parseParam",value:function(e){var t=Ll(this.remaining);if(t){this.capture(t);var n="";if(this.consumeOptional("=")){var r=Ll(this.remaining);r&&(n=r,this.capture(n))}e[Dl(t)]=Dl(n)}}},{key:"parseQueryParam",value:function(e){var t=function(e){var t=e.match(zl);return t?t[0]:""}(this.remaining);if(t){this.capture(t);var n="";if(this.consumeOptional("=")){var r=function(e){var t=e.match(Bl);return t?t[0]:""}(this.remaining);r&&(n=r,this.capture(n))}var a=Pl(t),i=Pl(n);if(e.hasOwnProperty(a)){var o=e[a];Array.isArray(o)||(o=[o],e[a]=o),o.push(i)}else e[a]=i}}},{key:"parseParens",value:function(e){var t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){var n=Ll(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error("Cannot parse url '".concat(this.url,"'"));var a=void 0;n.indexOf(":")>-1?(a=n.substr(0,n.indexOf(":")),this.capture(a),this.capture(":")):e&&(a="primary");var i=this.parseChildren();t[a]=1===Object.keys(i).length?i.primary:new wl([],i),this.consumeOptional("//")}return t}},{key:"peekStartsWith",value:function(e){return this.remaining.startsWith(e)}},{key:"consumeOptional",value:function(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}},{key:"capture",value:function(e){if(!this.consumeOptional(e))throw new Error('Expected "'.concat(e,'".'))}}]),e}(),Vl=function(){function e(t){_classCallCheck2(this,e),this._root=t}return _createClass2(e,[{key:"parent",value:function(e){var t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}},{key:"children",value:function(e){var t=ql(e,this._root);return t?t.children.map((function(e){return e.value})):[]}},{key:"firstChild",value:function(e){var t=ql(e,this._root);return t&&t.children.length>0?t.children[0].value:null}},{key:"siblings",value:function(e){var t=Ul(e,this._root);return t.length<2?[]:t[t.length-2].children.map((function(e){return e.value})).filter((function(t){return t!==e}))}},{key:"pathFromRoot",value:function(e){return Ul(e,this._root).map((function(e){return e.value}))}},{key:"root",get:function(){return this._root.value}}]),e}();function ql(e,t){if(e===t.value)return t;var n,r=_createForOfIteratorHelper(t.children);try{for(r.s();!(n=r.n()).done;){var a=ql(e,n.value);if(a)return a}}catch(i){r.e(i)}finally{r.f()}return null}function Ul(e,t){if(e===t.value)return[t];var n,r=_createForOfIteratorHelper(t.children);try{for(r.s();!(n=r.n()).done;){var a=Ul(e,n.value);if(a.length)return a.unshift(t),a}}catch(i){r.e(i)}finally{r.f()}return[]}var Wl=function(){function e(t,n){_classCallCheck2(this,e),this.value=t,this.children=n}return _createClass2(e,[{key:"toString",value:function(){return"TreeNode(".concat(this.value,")")}}]),e}();function Gl(e){var t={};return e&&e.children.forEach((function(e){return t[e.value.outlet]=e})),t}var Hl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e)).snapshot=r,Jl(_assertThisInitialized(a),e),a}return _createClass2(n,[{key:"toString",value:function(){return this.snapshot.toString()}}]),n}(Vl);function Kl(e,t){var n=function(e,t){var n=new Yl([],{},{},"",{},"primary",t,null,e.root,-1,{});return new Zl("",new Wl(n,[]))}(e,t),r=new Gs([new xl("",{})]),a=new Gs({}),i=new Gs({}),o=new Gs({}),s=new Gs(""),u=new Xl(r,a,o,s,i,"primary",t,n.root);return u.snapshot=n.root,new Hl(new Wl(u,[]),n)}var Xl=function(){function e(t,n,r,a,i,o,s,u){_classCallCheck2(this,e),this.url=t,this.params=n,this.queryParams=r,this.fragment=a,this.data=i,this.outlet=o,this.component=s,this._futureSnapshot=u}return _createClass2(e,[{key:"toString",value:function(){return this.snapshot?this.snapshot.toString():"Future(".concat(this._futureSnapshot,")")}},{key:"routeConfig",get:function(){return this._futureSnapshot.routeConfig}},{key:"root",get:function(){return this._routerState.root}},{key:"parent",get:function(){return this._routerState.parent(this)}},{key:"firstChild",get:function(){return this._routerState.firstChild(this)}},{key:"children",get:function(){return this._routerState.children(this)}},{key:"pathFromRoot",get:function(){return this._routerState.pathFromRoot(this)}},{key:"paramMap",get:function(){return this._paramMap||(this._paramMap=this.params.pipe(W((function(e){return sl(e)})))),this._paramMap}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(W((function(e){return sl(e)})))),this._queryParamMap}}]),e}();function Ql(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emptyOnly",n=e.pathFromRoot,r=0;if("always"!==t)for(r=n.length-1;r>=1;){var a=n[r],i=n[r-1];if(a.routeConfig&&""===a.routeConfig.path)r--;else{if(i.component)break;r--}}return function(e){return e.reduce((function(e,t){return{params:Object.assign({},e.params,t.params),data:Object.assign({},e.data,t.data),resolve:Object.assign({},e.resolve,t._resolvedData)}}),{params:{},data:{},resolve:{}})}(n.slice(r))}var Yl=function(){function e(t,n,r,a,i,o,s,u,c,l,h){_classCallCheck2(this,e),this.url=t,this.params=n,this.queryParams=r,this.fragment=a,this.data=i,this.outlet=o,this.component=s,this.routeConfig=u,this._urlSegment=c,this._lastPathIndex=l,this._resolve=h}return _createClass2(e,[{key:"toString",value:function(){return"Route(url:'".concat(this.url.map((function(e){return e.toString()})).join("/"),"', path:'").concat(this.routeConfig?this.routeConfig.path:"","')")}},{key:"root",get:function(){return this._routerState.root}},{key:"parent",get:function(){return this._routerState.parent(this)}},{key:"firstChild",get:function(){return this._routerState.firstChild(this)}},{key:"children",get:function(){return this._routerState.children(this)}},{key:"pathFromRoot",get:function(){return this._routerState.pathFromRoot(this)}},{key:"paramMap",get:function(){return this._paramMap||(this._paramMap=sl(this.params)),this._paramMap}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=sl(this.queryParams)),this._queryParamMap}}]),e}(),Zl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,r)).url=e,Jl(_assertThisInitialized(a),r),a}return _createClass2(n,[{key:"toString",value:function(){return $l(this._root)}}]),n}(Vl);function Jl(e,t){t.value._routerState=e,t.children.forEach((function(t){return Jl(e,t)}))}function $l(e){var t=e.children.length>0?" { ".concat(e.children.map($l).join(", ")," } "):"";return"".concat(e.value).concat(t)}function eh(e){if(e.snapshot){var t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,ml(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),ml(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!ml(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),ml(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function th(e,t){var n,r;return ml(e.params,t.params)&&Cl(n=e.url,r=t.url)&&n.every((function(e,t){return ml(e.parameters,r[t].parameters)}))&&!(!e.parent!=!t.parent)&&(!e.parent||th(e.parent,t.parent))}function nh(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function rh(e,t,n,r,a){var i={};return r&&yl(r,(function(e,t){i[t]=Array.isArray(e)?e.map((function(e){return""+e})):""+e})),new kl(n.root===e?t:function e(t,n,r){var a={};return yl(t.children,(function(t,i){a[i]=t===n?r:e(t,n,r)})),new wl(t.segments,a)}(n.root,e,t),i,a)}var ah=function(){function e(t,n,r){if(_classCallCheck2(this,e),this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&nh(r[0]))throw new Error("Root segment cannot have matrix parameters");var a=r.find((function(e){return"object"==typeof e&&null!=e&&e.outlets}));if(a&&a!==gl(r))throw new Error("{outlets:{}} has to be the last command")}return _createClass2(e,[{key:"toRoot",value:function(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}]),e}(),ih=function e(t,n,r){_classCallCheck2(this,e),this.segmentGroup=t,this.processChildren=n,this.index=r};function oh(e){return"object"==typeof e&&null!=e&&e.outlets?e.outlets.primary:""+e}function sh(e,t,n){if(e||(e=new wl([],{})),0===e.segments.length&&e.hasChildren())return uh(e,t,n);var r=function(e,t,n){for(var r=0,a=t,i={match:!1,pathIndex:0,commandIndex:0};a<e.segments.length;){if(r>=n.length)return i;var o=e.segments[a],s=oh(n[r]),u=r<n.length-1?n[r+1]:null;if(a>0&&void 0===s)break;if(s&&u&&"object"==typeof u&&void 0===u.outlets){if(!fh(s,u,o))return i;r+=2}else{if(!fh(s,{},o))return i;r++}a++}return{match:!0,pathIndex:a,commandIndex:r}}(e,t,n),a=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){var i=new wl(e.segments.slice(0,r.pathIndex),{});return i.children.primary=new wl(e.segments.slice(r.pathIndex),e.children),uh(i,0,a)}return r.match&&0===a.length?new wl(e.segments,{}):r.match&&!e.hasChildren()?ch(e,t,n):r.match?uh(e,0,a):ch(e,t,n)}function uh(e,t,n){if(0===n.length)return new wl(e.segments,{});var r=function(e){return"object"!=typeof e[0]||void 0===e[0].outlets?{primary:e}:e[0].outlets}(n),a={};return yl(r,(function(n,r){null!==n&&(a[r]=sh(e.children[r],t,n))})),yl(e.children,(function(e,t){void 0===r[t]&&(a[t]=e)})),new wl(e.segments,a)}function ch(e,t,n){for(var r=e.segments.slice(0,t),a=0;a<n.length;){if("object"==typeof n[a]&&void 0!==n[a].outlets){var i=lh(n[a].outlets);return new wl(r,i)}if(0===a&&nh(n[0]))r.push(new xl(e.segments[t].path,n[0])),a++;else{var o=oh(n[a]),s=a<n.length-1?n[a+1]:null;o&&s&&nh(s)?(r.push(new xl(o,hh(s))),a+=2):(r.push(new xl(o,{})),a++)}}return new wl(r,{})}function lh(e){var t={};return yl(e,(function(e,n){null!==e&&(t[n]=ch(new wl([],{}),0,e))})),t}function hh(e){var t={};return yl(e,(function(e,n){return t[n]=""+e})),t}function fh(e,t,n){return e==n.path&&ml(t,n.parameters)}var dh=function(){function e(t,n,r,a){_classCallCheck2(this,e),this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=a}return _createClass2(e,[{key:"activate",value:function(e){var t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),eh(this.futureState.root),this.activateChildRoutes(t,n,e)}},{key:"deactivateChildRoutes",value:function(e,t,n){var r=this,a=Gl(t);e.children.forEach((function(e){var t=e.value.outlet;r.deactivateRoutes(e,a[t],n),delete a[t]})),yl(a,(function(e,t){r.deactivateRouteAndItsChildren(e,n)}))}},{key:"deactivateRoutes",value:function(e,t,n){var r=e.value,a=t?t.value:null;if(r===a)if(r.component){var i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else a&&this.deactivateRouteAndItsChildren(t,n)}},{key:"deactivateRouteAndItsChildren",value:function(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}},{key:"detachAndStoreRouteSubtree",value:function(e,t){var n=t.getContext(e.value.outlet);if(n&&n.outlet){var r=n.outlet.detach(),a=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:r,route:e,contexts:a})}}},{key:"deactivateRouteAndOutlet",value:function(e,t){var n=this,r=t.getContext(e.value.outlet);if(r){var a=Gl(e),i=e.value.component?r.children:t;yl(a,(function(e,t){return n.deactivateRouteAndItsChildren(e,i)})),r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated())}}},{key:"activateChildRoutes",value:function(e,t,n){var r=this,a=Gl(t);e.children.forEach((function(e){r.activateRoutes(e,a[e.value.outlet],n),r.forwardEvent(new rl(e.value.snapshot))})),e.children.length&&this.forwardEvent(new tl(e.value.snapshot))}},{key:"activateRoutes",value:function(e,t,n){var r=e.value,a=t?t.value:null;if(eh(r),r===a)if(r.component){var i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){var o=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){var s=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(s.contexts),o.attachRef=s.componentRef,o.route=s.route.value,o.outlet&&o.outlet.attach(s.componentRef,s.route.value),ph(s.route)}else{var u=function(e){for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(r.snapshot),c=u?u.module.componentFactoryResolver:null;o.attachRef=null,o.route=r,o.resolver=c,o.outlet&&o.outlet.activateWith(r,c),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,n)}}]),e}();function ph(e){eh(e.value),e.children.forEach(ph)}function mh(e){return"function"==typeof e}function vh(e){return e instanceof kl}var gh=function e(t){_classCallCheck2(this,e),this.segmentGroup=t||null},yh=function e(t){_classCallCheck2(this,e),this.urlTree=t};function _h(e){return new x((function(t){return t.error(new gh(e))}))}function bh(e){return new x((function(t){return t.error(new yh(e))}))}function kh(e){return new x((function(t){return t.error(new Error("Only absolute redirects can have named outlets. redirectTo: '".concat(e,"'")))}))}var wh=function(){function e(t,n,r,a,i){_classCallCheck2(this,e),this.configLoader=n,this.urlSerializer=r,this.urlTree=a,this.config=i,this.allowRedirects=!0,this.ngModule=t.get(Be)}return _createClass2(e,[{key:"apply",value:function(){var e=this;return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,"primary").pipe(W((function(t){return e.createUrlTree(t,e.urlTree.queryParams,e.urlTree.fragment)}))).pipe(gu((function(t){if(t instanceof yh)return e.allowRedirects=!1,e.match(t.urlTree);if(t instanceof gh)throw e.noMatchError(t);throw t})))}},{key:"match",value:function(e){var t=this;return this.expandSegmentGroup(this.ngModule,this.config,e.root,"primary").pipe(W((function(n){return t.createUrlTree(n,e.queryParams,e.fragment)}))).pipe(gu((function(e){if(e instanceof gh)throw t.noMatchError(e);throw e})))}},{key:"noMatchError",value:function(e){return new Error("Cannot match any routes. URL Segment: '".concat(e.segmentGroup,"'"))}},{key:"createUrlTree",value:function(e,t,n){var r=e.segments.length>0?new wl([],{primary:e}):e;return new kl(r,t,n)}},{key:"expandSegmentGroup",value:function(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(W((function(e){return new wl([],e)}))):this.expandSegment(e,n,t,n.segments,r,!0)}},{key:"expandChildren",value:function(e,t,n){var r=this;return function(n,a){if(0===Object.keys(n).length)return Ws({});var i=[],o=[],s={};return yl(n,(function(n,a){var u,c,l=(u=a,c=n,r.expandSegmentGroup(e,t,c,u)).pipe(W((function(e){return s[a]=e})));"primary"===a?i.push(l):o.push(l)})),Ws.apply(null,i.concat(o)).pipe($s(),vu(),W((function(){return s})))}(n.children)}},{key:"expandSegment",value:function(e,t,n,r,a,i){var o=this;return Ws.apply(void 0,_toConsumableArray(n)).pipe(W((function(s){return o.expandSegmentAgainstRoute(e,t,n,s,r,a,i).pipe(gu((function(e){if(e instanceof gh)return Ws(null);throw e})))})),$s(),xu((function(e){return!!e})),gu((function(e,n){if(e instanceof Ks||"EmptyError"===e.name){if(o.noLeftoversInUrl(t,r,a))return Ws(new wl([],{}));throw new gh(t)}throw e})))}},{key:"noLeftoversInUrl",value:function(e,t,n){return 0===t.length&&!e.children[n]}},{key:"expandSegmentAgainstRoute",value:function(e,t,n,r,a,i,o){return Th(r)!==i?_h(t):void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,a):o&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,a,i):_h(t)}},{key:"expandSegmentAgainstRouteUsingRedirect",value:function(e,t,n,r,a,i){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,i):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,a,i)}},{key:"expandWildCardWithParamsAgainstRouteUsingRedirect",value:function(e,t,n,r){var a=this,i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?bh(i):this.lineralizeSegments(n,i).pipe(Q((function(n){var i=new wl(n,{});return a.expandSegment(e,i,t,n,r,!1)})))}},{key:"expandRegularSegmentAgainstRouteUsingRedirect",value:function(e,t,n,r,a,i){var o=this,s=xh(t,r,a),u=s.matched,c=s.consumedSegments,l=s.lastChild,h=s.positionalParamSegments;if(!u)return _h(t);var f=this.applyRedirectCommands(c,r.redirectTo,h);return r.redirectTo.startsWith("/")?bh(f):this.lineralizeSegments(r,f).pipe(Q((function(r){return o.expandSegment(e,t,n,r.concat(a.slice(l)),i,!1)})))}},{key:"matchSegmentAgainstRoute",value:function(e,t,n,r){var a=this;if("**"===n.path)return n.loadChildren?this.configLoader.load(e.injector,n).pipe(W((function(e){return n._loadedConfig=e,new wl(r,{})}))):Ws(new wl(r,{}));var i=xh(t,n,r),o=i.matched,s=i.consumedSegments,u=i.lastChild;if(!o)return _h(t);var c=r.slice(u);return this.getChildConfig(e,n,r).pipe(Q((function(e){var n=e.module,r=e.routes,i=function(e,t,n,r){return n.length>0&&function(e,t,n){return n.some((function(n){return Sh(e,t,n)&&"primary"!==Th(n)}))}(e,n,r)?{segmentGroup:Ch(new wl(t,function(e,t){var n={};n.primary=t;var r,a=_createForOfIteratorHelper(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;""===i.path&&"primary"!==Th(i)&&(n[Th(i)]=new wl([],{}))}}catch(o){a.e(o)}finally{a.f()}return n}(r,new wl(n,e.children)))),slicedSegments:[]}:0===n.length&&function(e,t,n){return n.some((function(n){return Sh(e,t,n)}))}(e,n,r)?{segmentGroup:Ch(new wl(e.segments,function(e,t,n,r){var a,i={},o=_createForOfIteratorHelper(n);try{for(o.s();!(a=o.n()).done;){var s=a.value;Sh(e,t,s)&&!r[Th(s)]&&(i[Th(s)]=new wl([],{}))}}catch(u){o.e(u)}finally{o.f()}return Object.assign({},r,i)}(e,n,r,e.children))),slicedSegments:n}:{segmentGroup:e,slicedSegments:n}}(t,s,c,r),o=i.segmentGroup,u=i.slicedSegments;return 0===u.length&&o.hasChildren()?a.expandChildren(n,r,o).pipe(W((function(e){return new wl(s,e)}))):0===r.length&&0===u.length?Ws(new wl(s,{})):a.expandSegment(n,o,r,u,"primary",!0).pipe(W((function(e){return new wl(s.concat(e.segments),e.children)})))})))}},{key:"getChildConfig",value:function(e,t,n){var r=this;return t.children?Ws(new ll(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?Ws(t._loadedConfig):function(e,t,n){var r,a=t.canLoad;return a&&0!==a.length?X(a).pipe(W((function(r){var a,i=e.get(r);if(function(e){return e&&mh(e.canLoad)}(i))a=i.canLoad(t,n);else{if(!mh(i))throw new Error("Invalid CanLoad guard");a=i(t,n)}return _l(a)}))).pipe($s(),(r=function(e){return!0===e},function(e){return e.lift(new Cu(r,void 0,e))})):Ws(!0)}(e.injector,t,n).pipe(Q((function(n){return n?r.configLoader.load(e.injector,t).pipe(W((function(e){return t._loadedConfig=e,e}))):function(e){return new x((function(t){return t.error(ul("Cannot load children because the guard of the route \"path: '".concat(e.path,"'\" returned false")))}))}(t)}))):Ws(new ll([],e))}},{key:"lineralizeSegments",value:function(e,t){for(var n=[],r=t.root;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return Ws(n);if(r.numberOfChildren>1||!r.children.primary)return kh(e.redirectTo);r=r.children.primary}}},{key:"applyRedirectCommands",value:function(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}},{key:"applyRedirectCreatreUrlTree",value:function(e,t,n,r){var a=this.createSegmentGroup(e,t.root,n,r);return new kl(a,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}},{key:"createQueryParams",value:function(e,t){var n={};return yl(e,(function(e,r){if("string"==typeof e&&e.startsWith(":")){var a=e.substring(1);n[r]=t[a]}else n[r]=e})),n}},{key:"createSegmentGroup",value:function(e,t,n,r){var a=this,i=this.createSegments(e,t.segments,n,r),o={};return yl(t.children,(function(t,i){o[i]=a.createSegmentGroup(e,t,n,r)})),new wl(i,o)}},{key:"createSegments",value:function(e,t,n,r){var a=this;return t.map((function(t){return t.path.startsWith(":")?a.findPosParam(e,t,r):a.findOrReturn(t,n)}))}},{key:"findPosParam",value:function(e,t,n){var r=n[t.path.substring(1)];if(!r)throw new Error("Cannot redirect to '".concat(e,"'. Cannot find '").concat(t.path,"'."));return r}},{key:"findOrReturn",value:function(e,t){var n,r=0,a=_createForOfIteratorHelper(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.path===e.path)return t.splice(r),i;r++}}catch(o){a.e(o)}finally{a.f()}return e}}]),e}();function xh(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};var r=(t.matcher||cl)(n,e,t);return r?{matched:!0,consumedSegments:r.consumed,lastChild:r.consumed.length,positionalParamSegments:r.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function Ch(e){if(1===e.numberOfChildren&&e.children.primary){var t=e.children.primary;return new wl(e.segments.concat(t.segments),t.children)}return e}function Sh(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0!==n.redirectTo}function Th(e){return e.outlet||"primary"}var Ah=function e(t){_classCallCheck2(this,e),this.path=t,this.route=this.path[this.path.length-1]},Eh=function e(t,n){_classCallCheck2(this,e),this.component=t,this.route=n};function Ih(e,t,n){var r=function(e){if(!e)return null;for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function Rh(e,t,n){var r=Gl(e),a=e.value;yl(r,(function(e,r){Rh(e,a.component?t?t.children.getContext(r):null:t,n)})),n.canDeactivateChecks.push(new Eh(a.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,a))}var Oh=Symbol("INITIAL_VALUE");function Nh(){return Tu((function(e){return Qs.apply(void 0,_toConsumableArray(e.map((function(e){return e.pipe(bu(1),Ru(Oh))})))).pipe(Ou((function(e,t){var n=!1;return t.reduce((function(e,r,a){if(e!==Oh)return e;if(r===Oh&&(n=!0),!n){if(!1===r)return r;if(a===t.length-1||vh(r))return r}return e}),e)}),Oh),eu((function(e){return e!==Oh})),W((function(e){return vh(e)?e:!0===e})),bu(1))}))}function Dh(e,t){return null!==e&&t&&t(new nl(e)),Ws(!0)}function Ph(e,t){return null!==e&&t&&t(new el(e)),Ws(!0)}function Fh(e,t,n){var r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?Ws(r.map((function(r){return Js((function(){var a,i=Ih(r,t,n);if(function(e){return e&&mh(e.canActivate)}(i))a=_l(i.canActivate(t,e));else{if(!mh(i))throw new Error("Invalid CanActivate guard");a=_l(i(t,e))}return a.pipe(xu())}))}))).pipe(Nh()):Ws(!0)}function Mh(e,t,n){var r=t[t.length-1],a=t.slice(0,t.length-1).reverse().map((function(e){return function(e){var t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)})).filter((function(e){return null!==e})).map((function(t){return Js((function(){return Ws(t.guards.map((function(a){var i,o=Ih(a,t.node,n);if(function(e){return e&&mh(e.canActivateChild)}(o))i=_l(o.canActivateChild(r,e));else{if(!mh(o))throw new Error("Invalid CanActivateChild guard");i=_l(o(r,e))}return i.pipe(xu())}))).pipe(Nh())}))}));return Ws(a).pipe(Nh())}var Lh=function e(){_classCallCheck2(this,e)},zh=function(){function e(t,n,r,a,i,o){_classCallCheck2(this,e),this.rootComponentType=t,this.config=n,this.urlTree=r,this.url=a,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=o}return _createClass2(e,[{key:"recognize",value:function(){try{var e=Vh(this.urlTree.root,[],[],this.config,this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,"primary"),n=new Yl([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},"primary",this.rootComponentType,null,this.urlTree.root,-1,{}),r=new Wl(n,t),a=new Zl(this.url,r);return this.inheritParamsAndData(a._root),Ws(a)}catch(i){return new x((function(e){return e.error(i)}))}}},{key:"inheritParamsAndData",value:function(e){var t=this,n=e.value,r=Ql(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),e.children.forEach((function(e){return t.inheritParamsAndData(e)}))}},{key:"processSegmentGroup",value:function(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}},{key:"processChildren",value:function(e,t){var n,r=this,a=Sl(t,(function(t,n){return r.processSegmentGroup(e,t,n)}));return n={},a.forEach((function(e){var t=n[e.value.outlet];if(t){var r=t.url.map((function(e){return e.toString()})).join("/"),a=e.value.url.map((function(e){return e.toString()})).join("/");throw new Error("Two segments cannot have the same outlet name: '".concat(r,"' and '").concat(a,"'."))}n[e.value.outlet]=e.value})),a.sort((function(e,t){return"primary"===e.value.outlet?-1:"primary"===t.value.outlet?1:e.value.outlet.localeCompare(t.value.outlet)})),a}},{key:"processSegment",value:function(e,t,n,r){var a,i=_createForOfIteratorHelper(e);try{for(i.s();!(a=i.n()).done;){var o=a.value;try{return this.processSegmentAgainstRoute(o,t,n,r)}catch(s){if(!(s instanceof Lh))throw s}}}catch(u){i.e(u)}finally{i.f()}if(this.noLeftoversInUrl(t,n,r))return[];throw new Lh}},{key:"noLeftoversInUrl",value:function(e,t,n){return 0===t.length&&!e.children[n]}},{key:"processSegmentAgainstRoute",value:function(e,t,n,r){if(e.redirectTo)throw new Lh;if((e.outlet||"primary")!==r)throw new Lh;var a,i=[],o=[];if("**"===e.path){var s=n.length>0?gl(n).parameters:{};a=new Yl(n,s,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Wh(e),r,e.component,e,Bh(t),jh(t)+n.length,Gh(e))}else{var u=function(e,t,n){if(""===t.path){if("full"===t.pathMatch&&(e.hasChildren()||n.length>0))throw new Lh;return{consumedSegments:[],lastChild:0,parameters:{}}}var r=(t.matcher||cl)(n,e,t);if(!r)throw new Lh;var a={};yl(r.posParams,(function(e,t){a[t]=e.path}));var i=r.consumed.length>0?Object.assign({},a,r.consumed[r.consumed.length-1].parameters):a;return{consumedSegments:r.consumed,lastChild:r.consumed.length,parameters:i}}(t,e,n);i=u.consumedSegments,o=n.slice(u.lastChild),a=new Yl(i,u.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Wh(e),r,e.component,e,Bh(t),jh(t)+i.length,Gh(e))}var c=function(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(e),l=Vh(t,i,o,c,this.relativeLinkResolution),h=l.segmentGroup,f=l.slicedSegments;if(0===f.length&&h.hasChildren()){var d=this.processChildren(c,h);return[new Wl(a,d)]}if(0===c.length&&0===f.length)return[new Wl(a,[])];var p=this.processSegment(c,h,f,"primary");return[new Wl(a,p)]}}]),e}();function Bh(e){for(var t=e;t._sourceSegment;)t=t._sourceSegment;return t}function jh(e){for(var t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;t._sourceSegment;)n+=(t=t._sourceSegment)._segmentIndexShift?t._segmentIndexShift:0;return n-1}function Vh(e,t,n,r,a){if(n.length>0&&function(e,t,n){return n.some((function(n){return qh(e,t,n)&&"primary"!==Uh(n)}))}(e,n,r)){var i=new wl(t,function(e,t,n,r){var a={};a.primary=r,r._sourceSegment=e,r._segmentIndexShift=t.length;var i,o=_createForOfIteratorHelper(n);try{for(o.s();!(i=o.n()).done;){var s=i.value;if(""===s.path&&"primary"!==Uh(s)){var u=new wl([],{});u._sourceSegment=e,u._segmentIndexShift=t.length,a[Uh(s)]=u}}}catch(c){o.e(c)}finally{o.f()}return a}(e,t,r,new wl(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some((function(n){return qh(e,t,n)}))}(e,n,r)){var o=new wl(e.segments,function(e,t,n,r,a,i){var o,s={},u=_createForOfIteratorHelper(r);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(qh(e,n,c)&&!a[Uh(c)]){var l=new wl([],{});l._sourceSegment=e,l._segmentIndexShift="legacy"===i?e.segments.length:t.length,s[Uh(c)]=l}}}catch(h){u.e(h)}finally{u.f()}return Object.assign({},a,s)}(e,t,n,r,e.children,a));return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:n}}var s=new wl(e.segments,e.children);return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}function qh(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0===n.redirectTo}function Uh(e){return e.outlet||"primary"}function Wh(e){return e.data||{}}function Gh(e){return e.resolve||{}}function Hh(e,t,n,r){var a=Ih(e,t,r);return _l(a.resolve?a.resolve(t,n):a(t,n))}function Kh(e){return function(t){return t.pipe(Tu((function(t){var n=e(t);return n?X(n).pipe(W((function(){return t}))):X([t])})))}}var Xh=function e(){_classCallCheck2(this,e)},Qh=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"shouldDetach",value:function(e){return!1}},{key:"store",value:function(e,t){}},{key:"shouldAttach",value:function(e){return!1}},{key:"retrieve",value:function(e){return null}},{key:"shouldReuseRoute",value:function(e,t){return e.routeConfig===t.routeConfig}}]),e}(),Yh=new Ee("ROUTES"),Zh=function(){function e(t,n,r,a){_classCallCheck2(this,e),this.loader=t,this.compiler=n,this.onLoadStartListener=r,this.onLoadEndListener=a}return _createClass2(e,[{key:"load",value:function(e,t){var n=this;return this.onLoadStartListener&&this.onLoadStartListener(t),this.loadModuleFactory(t.loadChildren).pipe(W((function(r){n.onLoadEndListener&&n.onLoadEndListener(t);var a=r.create(e);return new ll(vl(a.injector.get(Yh)).map(pl),a)})))}},{key:"loadModuleFactory",value:function(e){var t=this;return"string"==typeof e?X(this.loader.load(e)):_l(e()).pipe(Q((function(e){return e instanceof je?Ws(e):X(t.compiler.compileModuleAsync(e))})))}}]),e}(),Jh=function e(){_classCallCheck2(this,e)},$h=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"shouldProcessUrl",value:function(e){return!0}},{key:"extract",value:function(e){return e}},{key:"merge",value:function(e,t){return e}}]),e}();function ef(e){throw e}function tf(e,t,n){return t.parse("/")}function nf(e,t){return Ws(null)}var rf=function(){function e(t,n,r,a,i,o,s,u){var c=this;_classCallCheck2(this,e),this.rootComponentType=t,this.urlSerializer=n,this.rootContexts=r,this.location=a,this.config=u,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new R,this.errorHandler=ef,this.malformedUriErrorHandler=tf,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:nf,afterPreactivation:nf},this.urlHandlingStrategy=new $h,this.routeReuseStrategy=new Qh,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="legacy",this.ngModule=i.get(Be),this.console=i.get(Na);var l=i.get(Ya);this.isNgZoneEnabled=l instanceof Ya,this.resetConfig(u),this.currentUrlTree=new kl(new wl([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Zh(o,s,(function(e){return c.triggerEvent(new Jc(e))}),(function(e){return c.triggerEvent(new $c(e))})),this.routerState=Kl(this.currentUrlTree,this.rootComponentType),this.transitions=new Gs({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}return _createClass2(e,[{key:"setupNavigations",value:function(e){var t=this,n=this.events;return e.pipe(eu((function(e){return 0!==e.id})),W((function(e){return Object.assign({},e,{extractedUrl:t.urlHandlingStrategy.extract(e.rawUrl)})})),Tu((function(e){var r,a,i,o=!1,s=!1;return Ws(e).pipe(uu((function(e){t.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:t.lastSuccessfulNavigation?Object.assign({},t.lastSuccessfulNavigation,{previousNavigation:null}):null}})),Tu((function(e){var r,a,i,o,s=!t.navigated||e.extractedUrl.toString()!==t.browserUrlTree.toString();if(("reload"===t.onSameUrlNavigation||s)&&t.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return Ws(e).pipe(Tu((function(e){var r=t.transitions.getValue();return n.next(new Uc(e.id,t.serializeUrl(e.extractedUrl),e.source,e.restoredState)),r!==t.transitions.getValue()?Vs:[e]})),Tu((function(e){return Promise.resolve(e)})),(r=t.ngModule.injector,a=t.configLoader,i=t.urlSerializer,o=t.config,function(e){return e.pipe(Tu((function(e){return function(e,t,n,r,a){return new wh(e,t,n,r,a).apply()}(r,a,i,e.extractedUrl,o).pipe(W((function(t){return Object.assign({},e,{urlAfterRedirects:t})})))})))}),uu((function(e){t.currentNavigation=Object.assign({},t.currentNavigation,{finalUrl:e.urlAfterRedirects})})),function(e,n,r,a,i){return function(r){return r.pipe(Q((function(r){return function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"emptyOnly",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"legacy";return new zh(e,t,n,r,a,i).recognize()}(e,n,r.urlAfterRedirects,(o=r.urlAfterRedirects,t.serializeUrl(o)),a,i).pipe(W((function(e){return Object.assign({},r,{targetSnapshot:e})})));var o})))}}(t.rootComponentType,t.config,0,t.paramsInheritanceStrategy,t.relativeLinkResolution),uu((function(e){"eager"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(e.urlAfterRedirects,!!e.extras.replaceUrl,e.id,e.extras.state),t.browserUrlTree=e.urlAfterRedirects)})),uu((function(e){var r=new Kc(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);n.next(r)})));if(s&&t.rawUrlTree&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){var u=e.id,c=e.extractedUrl,l=e.source,h=e.restoredState,f=e.extras,d=new Uc(u,t.serializeUrl(c),l,h);n.next(d);var p=Kl(c,t.rootComponentType).snapshot;return Ws(Object.assign({},e,{targetSnapshot:p,urlAfterRedirects:c,extras:Object.assign({},f,{skipLocationChange:!1,replaceUrl:!1})}))}return t.rawUrlTree=e.rawUrl,t.browserUrlTree=e.urlAfterRedirects,e.resolve(null),Vs})),Kh((function(e){var n=e.targetSnapshot,r=e.id,a=e.extractedUrl,i=e.rawUrl,o=e.extras,s=o.skipLocationChange,u=o.replaceUrl;return t.hooks.beforePreactivation(n,{navigationId:r,appliedUrlTree:a,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!u})})),uu((function(e){var n=new Xc(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)})),W((function(e){return Object.assign({},e,{guards:(n=e.targetSnapshot,r=e.currentSnapshot,a=t.rootContexts,i=n._root,function e(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{canDeactivateChecks:[],canActivateChecks:[]},o=Gl(n);return t.children.forEach((function(t){!function(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{canDeactivateChecks:[],canActivateChecks:[]},o=t.value,s=n?n.value:null,u=r?r.getContext(t.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){var c=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Cl(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Cl(e.url,t.url)||!ml(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!th(e,t)||!ml(e.queryParams,t.queryParams);case"paramsChange":default:return!th(e,t)}}(s,o,o.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new Ah(a)):(o.data=s.data,o._resolvedData=s._resolvedData),e(t,n,o.component?u?u.children:null:r,a,i),c&&i.canDeactivateChecks.push(new Eh(u&&u.outlet&&u.outlet.component||null,s))}else s&&Rh(n,u,i),i.canActivateChecks.push(new Ah(a)),e(t,null,o.component?u?u.children:null:r,a,i)}(t,o[t.value.outlet],r,a.concat([t.value]),i),delete o[t.value.outlet]})),yl(o,(function(e,t){return Rh(e,r.getContext(t),i)})),i}(i,r?r._root:null,a,[i.value]))});var n,r,a,i})),function(e,t){return function(n){return n.pipe(Q((function(n){var r=n.targetSnapshot,a=n.currentSnapshot,i=n.guards,o=i.canActivateChecks,s=i.canDeactivateChecks;return 0===s.length&&0===o.length?Ws(Object.assign({},n,{guardsResult:!0})):function(e,t,n,r){return X(e).pipe(Q((function(e){return function(e,t,n,r,a){var i=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return i&&0!==i.length?Ws(i.map((function(i){var o,s=Ih(i,t,a);if(function(e){return e&&mh(e.canDeactivate)}(s))o=_l(s.canDeactivate(e,t,n,r));else{if(!mh(s))throw new Error("Invalid CanDeactivate guard");o=_l(s(e,t,n,r))}return o.pipe(xu())}))).pipe(Nh()):Ws(!0)}(e.component,e.route,n,t,r)})),xu((function(e){return!0!==e}),!0))}(s,r,a,e).pipe(Q((function(n){return n&&"boolean"==typeof n?function(e,t,n,r){return X(t).pipe(Pu((function(t){return X([Ph(t.route.parent,r),Dh(t.route,r),Mh(e,t.path,n),Fh(e,t.route,n)]).pipe($s(),xu((function(e){return!0!==e}),!0))})),xu((function(e){return!0!==e}),!0))}(r,o,e,t):Ws(n)})),W((function(e){return Object.assign({},n,{guardsResult:e})})))})))}}(t.ngModule.injector,(function(e){return t.triggerEvent(e)})),uu((function(e){if(vh(e.guardsResult)){var n=ul('Redirecting to "'.concat(t.serializeUrl(e.guardsResult),'"'));throw n.url=e.guardsResult,n}})),uu((function(e){var n=new Qc(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);t.triggerEvent(n)})),eu((function(e){if(!e.guardsResult){t.resetUrlToCurrentUrlTree();var r=new Gc(e.id,t.serializeUrl(e.extractedUrl),"");return n.next(r),e.resolve(!1),!1}return!0})),Kh((function(e){if(e.guards.canActivateChecks.length)return Ws(e).pipe(uu((function(e){var n=new Yc(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)})),(n=t.paramsInheritanceStrategy,r=t.ngModule.injector,function(e){return e.pipe(Q((function(e){var t=e.targetSnapshot,a=e.guards.canActivateChecks;return a.length?X(a).pipe(Pu((function(e){return function(e,t,n,r){return function(e,t,n,r){var a=Object.keys(e);if(0===a.length)return Ws({});if(1===a.length){var i=a[0];return Hh(e[i],t,n,r).pipe(W((function(e){return _defineProperty({},i,e)})))}var o={};return X(a).pipe(Q((function(a){return Hh(e[a],t,n,r).pipe(W((function(e){return o[a]=e,e})))}))).pipe(vu(),W((function(){return o})))}(e._resolve,e,t,r).pipe(W((function(t){return e._resolvedData=t,e.data=Object.assign({},e.data,Ql(e,n).resolve),null})))}(e.route,t,n,r)})),function(e,t){return arguments.length>=2?function(n){return b(Ou(e,t),iu(1),du(t))(n)}:function(t){return b(Ou((function(t,n,r){return e(t,n,r+1)})),iu(1))(t)}}((function(e,t){return e})),W((function(t){return e}))):Ws(e)})))}),uu((function(e){var n=new Zc(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)})));var n,r})),Kh((function(e){var n=e.targetSnapshot,r=e.id,a=e.extractedUrl,i=e.rawUrl,o=e.extras,s=o.skipLocationChange,u=o.replaceUrl;return t.hooks.afterPreactivation(n,{navigationId:r,appliedUrlTree:a,rawUrlTree:i,skipLocationChange:!!s,replaceUrl:!!u})})),W((function(e){var n=function(e,t,n){var r=function e(t,n,r){if(r&&t.shouldReuseRoute(n.value,r.value.snapshot)){var a=r.value;a._futureSnapshot=n.value;var i=function(t,n,r){return n.children.map((function(n){var a,i=_createForOfIteratorHelper(r.children);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(t.shouldReuseRoute(o.value.snapshot,n.value))return e(t,n,o)}}catch(s){i.e(s)}finally{i.f()}return e(t,n)}))}(t,n,r);return new Wl(a,i)}var o=t.retrieve(n.value);if(o){var s=o.route;return function e(t,n){if(t.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=t.value;for(var r=0;r<t.children.length;++r)e(t.children[r],n.children[r])}(n,s),s}var u,c=new Xl(new Gs((u=n.value).url),new Gs(u.params),new Gs(u.queryParams),new Gs(u.fragment),new Gs(u.data),u.outlet,u.component,u),l=n.children.map((function(n){return e(t,n)}));return new Wl(c,l)}(e,t._root,n?n._root:void 0);return new Hl(r,t)}(t.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign({},e,{targetRouterState:n})})),uu((function(e){t.currentUrlTree=e.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(t.currentUrlTree,e.rawUrl),t.routerState=e.targetRouterState,"deferred"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,!!e.extras.replaceUrl,e.id,e.extras.state),t.browserUrlTree=e.urlAfterRedirects)})),(r=t.rootContexts,a=t.routeReuseStrategy,i=function(e){return t.triggerEvent(e)},W((function(e){return new dh(a,e.targetRouterState,e.currentRouterState,i).activate(r),e}))),uu({next:function(){o=!0},complete:function(){o=!0}}),Fu((function(){if(!o&&!s){t.resetUrlToCurrentUrlTree();var r=new Gc(e.id,t.serializeUrl(e.extractedUrl),"Navigation ID ".concat(e.id," is not equal to the current navigation id ").concat(t.navigationId));n.next(r),e.resolve(!1)}t.currentNavigation=null})),gu((function(r){if(s=!0,(u=r)&&u.ngNavigationCancelingError){var a=vh(r.url);a||(t.navigated=!0,t.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl));var i=new Gc(e.id,t.serializeUrl(e.extractedUrl),r.message);n.next(i),e.resolve(!1),a&&t.navigateByUrl(r.url)}else{t.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl);var o=new Hc(e.id,t.serializeUrl(e.extractedUrl),r);n.next(o);try{e.resolve(t.errorHandler(r))}catch(c){e.reject(c)}}var u;return Vs})))})))}},{key:"resetRootComponentType",value:function(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}},{key:"getTransition",value:function(){var e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}},{key:"setTransition",value:function(e){this.transitions.next(Object.assign({},this.getTransition(),e))}},{key:"initialNavigation",value:function(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}},{key:"setUpLocationChangeListener",value:function(){var e=this;this.locationSubscription||(this.locationSubscription=this.location.subscribe((function(t){var n=e.parseUrl(t.url),r="popstate"===t.type?"popstate":"hashchange",a=t.state&&t.state.navigationId?t.state:null;setTimeout((function(){e.scheduleNavigation(n,r,a,{replaceUrl:!0})}),0)})))}},{key:"getCurrentNavigation",value:function(){return this.currentNavigation}},{key:"triggerEvent",value:function(e){this.events.next(e)}},{key:"resetConfig",value:function(e){hl(e),this.config=e.map(pl),this.navigated=!1,this.lastSuccessfulId=-1}},{key:"ngOnDestroy",value:function(){this.dispose()}},{key:"dispose",value:function(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)}},{key:"createUrlTree",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.relativeTo,r=t.queryParams,a=t.fragment,i=t.preserveQueryParams,o=t.queryParamsHandling,s=t.preserveFragment;Ze()&&i&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");var u=n||this.routerState.root,c=s?this.currentUrlTree.fragment:a,l=null;if(o)switch(o){case"merge":l=Object.assign({},this.currentUrlTree.queryParams,r);break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=r||null}else l=i?this.currentUrlTree.queryParams:r||null;return null!==l&&(l=this.removeEmptyProps(l)),function(e,t,n,r,a){if(0===n.length)return rh(t.root,t.root,t,r,a);var i=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new ah(!0,0,e);var t=0,n=!1,r=e.reduce((function(e,r,a){if("object"==typeof r&&null!=r){if(r.outlets){var i={};return yl(r.outlets,(function(e,t){i[t]="string"==typeof e?e.split("/"):e})),[].concat(_toConsumableArray(e),[{outlets:i}])}if(r.segmentPath)return[].concat(_toConsumableArray(e),[r.segmentPath])}return"string"!=typeof r?[].concat(_toConsumableArray(e),[r]):0===a?(r.split("/").forEach((function(r,a){0==a&&"."===r||(0==a&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))})),e):[].concat(_toConsumableArray(e),[r])}),[]);return new ah(n,t,r)}(n);if(i.toRoot())return rh(t.root,new wl([],{}),t,r,a);var o=function(e,t,n){if(e.isAbsolute)return new ih(t.root,!0,0);if(-1===n.snapshot._lastPathIndex)return new ih(n.snapshot._urlSegment,!0,0);var r=nh(e.commands[0])?0:1;return function(e,t,n){for(var r=e,a=t,i=n;i>a;){if(i-=a,!(r=r.parent))throw new Error("Invalid number of '../'");a=r.segments.length}return new ih(r,!1,a-i)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(i,t,e),s=o.processChildren?uh(o.segmentGroup,o.index,i.commands):sh(o.segmentGroup,o.index,i.commands);return rh(o.segmentGroup,s,t,r,a)}(u,this.currentUrlTree,e,l,c)}},{key:"navigateByUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipLocationChange:!1};Ze()&&this.isNgZoneEnabled&&!Ya.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");var n=vh(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}},{key:"navigate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipLocationChange:!1};return function(e){for(var t=0;t<e.length;t++){var n=e[t];if(null==n)throw new Error("The requested path contains ".concat(n," segment at index ").concat(t))}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}},{key:"serializeUrl",value:function(e){return this.urlSerializer.serialize(e)}},{key:"parseUrl",value:function(e){var t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}},{key:"isActive",value:function(e,t){if(vh(e))return bl(this.currentUrlTree,e,t);var n=this.parseUrl(e);return bl(this.currentUrlTree,n,t)}},{key:"removeEmptyProps",value:function(e){return Object.keys(e).reduce((function(t,n){var r=e[n];return null!=r&&(t[n]=r),t}),{})}},{key:"processNavigations",value:function(){var e=this;this.navigations.subscribe((function(t){e.navigated=!0,e.lastSuccessfulId=t.id,e.events.next(new Wc(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(e.currentUrlTree))),e.lastSuccessfulNavigation=e.currentNavigation,e.currentNavigation=null,t.resolve(!0)}),(function(t){e.console.warn("Unhandled Navigation Error: ")}))}},{key:"scheduleNavigation",value:function(e,t,n,r){var a=this.getTransition();if(a&&"imperative"!==t&&"imperative"===a.source&&a.rawUrl.toString()===e.toString())return Promise.resolve(!0);if(a&&"hashchange"==t&&"popstate"===a.source&&a.rawUrl.toString()===e.toString())return Promise.resolve(!0);if(a&&"popstate"==t&&"hashchange"===a.source&&a.rawUrl.toString()===e.toString())return Promise.resolve(!0);var i=null,o=null,s=new Promise((function(e,t){i=e,o=t})),u=++this.navigationId;return this.setTransition({id:u,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:i,reject:o,promise:s,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),s.catch((function(e){return Promise.reject(e)}))}},{key:"setBrowserUrl",value:function(e,t,n,r){var a=this.urlSerializer.serialize(e);r=r||{},this.location.isCurrentPathEqualTo(a)||t?this.location.replaceState(a,"",Object.assign({},r,{navigationId:n})):this.location.go(a,"",Object.assign({},r,{navigationId:n}))}},{key:"resetStateAndUrl",value:function(e,t,n){this.routerState=e,this.currentUrlTree=t,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()}},{key:"resetUrlToCurrentUrlTree",value:function(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})}},{key:"url",get:function(){return this.serializeUrl(this.currentUrlTree)}}]),e}(),af=function(){function e(t,n,r,a,i){_classCallCheck2(this,e),this.router=t,this.route=n,this.commands=[],null==r&&a.setAttribute(i.nativeElement,"tabindex","0")}return _createClass2(e,[{key:"onClick",value:function(){var e={skipLocationChange:of(this.skipLocationChange),replaceUrl:of(this.replaceUrl)};return this.router.navigateByUrl(this.urlTree,e),!0}},{key:"routerLink",set:function(e){this.commands=null!=e?Array.isArray(e)?e:[e]:[]}},{key:"preserveQueryParams",set:function(e){Ze()&&console&&console.warn&&console.warn("preserveQueryParams is deprecated!, use queryParamsHandling instead."),this.preserve=e}},{key:"urlTree",get:function(){return this.router.createUrlTree(this.commands,{relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,preserveQueryParams:of(this.preserve),queryParamsHandling:this.queryParamsHandling,preserveFragment:of(this.preserveFragment)})}}]),e}();function of(e){return""===e||!!e}var sf=function e(){_classCallCheck2(this,e),this.outlet=null,this.route=null,this.resolver=null,this.children=new uf,this.attachRef=null},uf=function(){function e(){_classCallCheck2(this,e),this.contexts=new Map}return _createClass2(e,[{key:"onChildOutletCreated",value:function(e,t){var n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}},{key:"onChildOutletDestroyed",value:function(e){var t=this.getContext(e);t&&(t.outlet=null)}},{key:"onOutletDeactivated",value:function(){var e=this.contexts;return this.contexts=new Map,e}},{key:"onOutletReAttached",value:function(e){this.contexts=e}},{key:"getOrCreateContext",value:function(e){var t=this.getContext(e);return t||(t=new sf,this.contexts.set(e,t)),t}},{key:"getContext",value:function(e){return this.contexts.get(e)||null}}]),e}(),cf=function(){function e(t,n,r,a,i){_classCallCheck2(this,e),this.parentContexts=t,this.location=n,this.resolver=r,this.changeDetector=i,this.activated=null,this._activatedRoute=null,this.activateEvents=new ka,this.deactivateEvents=new ka,this.name=a||"primary",t.onChildOutletCreated(this.name,this)}return _createClass2(e,[{key:"ngOnDestroy",value:function(){this.parentContexts.onChildOutletDestroyed(this.name)}},{key:"ngOnInit",value:function(){if(!this.activated){var e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}},{key:"detach",value:function(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();var e=this.activated;return this.activated=null,this._activatedRoute=null,e}},{key:"attach",value:function(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}},{key:"deactivate",value:function(){if(this.activated){var e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}},{key:"activateWith",value:function(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;var n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,a=new lf(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,a),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}},{key:"isActivated",get:function(){return!!this.activated}},{key:"component",get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}},{key:"activatedRoute",get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}},{key:"activatedRouteData",get:function(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}}]),e}(),lf=function(){function e(t,n,r){_classCallCheck2(this,e),this.route=t,this.childContexts=n,this.parent=r}return _createClass2(e,[{key:"get",value:function(e,t){return e===Xl?this.route:e===uf?this.childContexts:this.parent.get(e,t)}}]),e}(),hf=function e(){_classCallCheck2(this,e)},ff=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"preload",value:function(e,t){return t().pipe(gu((function(){return Ws(null)})))}}]),e}(),df=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"preload",value:function(e,t){return Ws(null)}}]),e}(),pf=function(){function e(t,n,r,a,i){_classCallCheck2(this,e),this.router=t,this.injector=a,this.preloadingStrategy=i,this.loader=new Zh(n,r,(function(e){return t.triggerEvent(new Jc(e))}),(function(e){return t.triggerEvent(new $c(e))}))}return _createClass2(e,[{key:"setUpPreloading",value:function(){var e=this;this.subscription=this.router.events.pipe(eu((function(e){return e instanceof Wc})),Pu((function(){return e.preload()}))).subscribe((function(){}))}},{key:"preload",value:function(){var e=this.injector.get(Be);return this.processRoutes(e,this.router.config)}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"processRoutes",value:function(e,t){var n,r=[],a=_createForOfIteratorHelper(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.loadChildren&&!i.canLoad&&i._loadedConfig){var o=i._loadedConfig;r.push(this.processRoutes(o.module,o.routes))}else i.loadChildren&&!i.canLoad?r.push(this.preloadConfig(e,i)):i.children&&r.push(this.processRoutes(e,i.children))}}catch(s){a.e(s)}finally{a.f()}return X(r).pipe($(),W((function(e){})))}},{key:"preloadConfig",value:function(e,t){var n=this;return this.preloadingStrategy.preload(t,(function(){return n.loader.load(e.injector,t).pipe(Q((function(e){return t._loadedConfig=e,n.processRoutes(e.module,e.routes)})))}))}}]),e}(),mf=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck2(this,e),this.router=t,this.viewportScroller=n,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}return _createClass2(e,[{key:"init",value:function(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}},{key:"createScrollEvents",value:function(){var e=this;return this.router.events.subscribe((function(t){t instanceof Uc?(e.store[e.lastId]=e.viewportScroller.getScrollPosition(),e.lastSource=t.navigationTrigger,e.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Wc&&(e.lastId=t.id,e.scheduleScrollEvent(t,e.router.parseUrl(t.urlAfterRedirects).fragment))}))}},{key:"consumeScrollEvents",value:function(){var e=this;return this.router.events.subscribe((function(t){t instanceof al&&(t.position?"top"===e.options.scrollPositionRestoration?e.viewportScroller.scrollToPosition([0,0]):"enabled"===e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===e.options.anchorScrolling?e.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition([0,0]))}))}},{key:"scheduleScrollEvent",value:function(e,t){this.router.triggerEvent(new al(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}},{key:"ngOnDestroy",value:function(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}]),e}(),vf=new Ee("ROUTER_CONFIGURATION"),gf=new Ee("ROUTER_FORROOT_GUARD"),yf=[us,{provide:Tl,useClass:Al},{provide:rf,useFactory:Sf,deps:[pi,Tl,uf,us,It,vi,Va,Yh,vf,[Jh,new he],[Xh,new he]]},uf,{provide:Xl,useFactory:Tf,deps:[rf]},{provide:vi,useClass:_i},pf,df,ff,{provide:vf,useValue:{enableTracing:!1}}];function _f(){return new ui("Router",rf)}var bf=function(){function e(t,n){_classCallCheck2(this,e)}return _createClass2(e,null,[{key:"forRoot",value:function(t,n){return{ngModule:e,providers:[yf,Cf(t),{provide:gf,useFactory:xf,deps:[[rf,new he,new de]]},{provide:vf,useValue:n||{}},{provide:os,useFactory:wf,deps:[as,[new le(ss),new he],vf]},{provide:mf,useFactory:kf,deps:[rf,Bs,vf]},{provide:hf,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:df},{provide:ui,multi:!0,useFactory:_f},[Af,{provide:Ca,multi:!0,useFactory:Ef,deps:[Af]},{provide:Rf,useFactory:If,deps:[Af]},{provide:Oa,multi:!0,useExisting:Rf}]]}}},{key:"forChild",value:function(t){return{ngModule:e,providers:[Cf(t)]}}}]),e}();function kf(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new mf(e,t,n)}function wf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.useHash?new ls(e,t):new hs(e,t)}function xf(e){if(e)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Cf(e){return[{provide:Lt,multi:!0,useValue:e},{provide:Yh,multi:!0,useValue:e}]}function Sf(e,t,n,r,a,i,o,s){var u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{},c=arguments.length>9?arguments[9]:void 0,l=arguments.length>10?arguments[10]:void 0,h=new rf(null,t,n,r,a,i,o,vl(s));if(c&&(h.urlHandlingStrategy=c),l&&(h.routeReuseStrategy=l),u.errorHandler&&(h.errorHandler=u.errorHandler),u.malformedUriErrorHandler&&(h.malformedUriErrorHandler=u.malformedUriErrorHandler),u.enableTracing){var f=Bu();h.events.subscribe((function(e){f.logGroup("Router Event: "+e.constructor.name),f.log(e.toString()),f.log(e),f.logGroupEnd()}))}return u.onSameUrlNavigation&&(h.onSameUrlNavigation=u.onSameUrlNavigation),u.paramsInheritanceStrategy&&(h.paramsInheritanceStrategy=u.paramsInheritanceStrategy),u.urlUpdateStrategy&&(h.urlUpdateStrategy=u.urlUpdateStrategy),u.relativeLinkResolution&&(h.relativeLinkResolution=u.relativeLinkResolution),h}function Tf(e){return e.routerState.root}var Af=function(){function e(t){_classCallCheck2(this,e),this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new R}return _createClass2(e,[{key:"appInitializer",value:function(){var e=this;return this.injector.get(is,Promise.resolve(null)).then((function(){var t=null,n=new Promise((function(e){return t=e})),r=e.injector.get(rf),a=e.injector.get(vf);if(e.isLegacyDisabled(a)||e.isLegacyEnabled(a))t(!0);else if("disabled"===a.initialNavigation)r.setUpLocationChangeListener(),t(!0);else{if("enabled"!==a.initialNavigation)throw new Error("Invalid initialNavigation options: '".concat(a.initialNavigation,"'"));r.hooks.afterPreactivation=function(){return e.initNavigation?Ws(null):(e.initNavigation=!0,t(!0),e.resultOfPreactivationDone)},r.initialNavigation()}return n}))}},{key:"bootstrapListener",value:function(e){var t=this.injector.get(vf),n=this.injector.get(pf),r=this.injector.get(mf),a=this.injector.get(rf),i=this.injector.get(pi);e===i.components[0]&&(this.isLegacyEnabled(t)?a.initialNavigation():this.isLegacyDisabled(t)&&a.setUpLocationChangeListener(),n.setUpPreloading(),r.init(),a.resetRootComponentType(i.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}},{key:"isLegacyEnabled",value:function(e){return"legacy_enabled"===e.initialNavigation||!0===e.initialNavigation||void 0===e.initialNavigation}},{key:"isLegacyDisabled",value:function(e){return"legacy_disabled"===e.initialNavigation||!1===e.initialNavigation}}]),e}();function Ef(e){return e.appInitializer.bind(e)}function If(e){return e.bootstrapListener.bind(e)}var Rf=new Ee("Router Initializer"),Of=function e(t){var n=this;_classCallCheck2(this,e),this.router=t,this.title="BL Studio",t.events.subscribe((function(e){if(e instanceof Wc)switch(e.url){case"/melody":n.title="BL Studio | Melody";break;case"/voicekey":n.title="BL Studio | Voice Key";break;default:n.title="BL Studio"}}))},Nf=Wn({encapsulation:2,styles:[],data:{}});function Df(e){return Yi(0,[(e()(),Pi(0,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),ea(1,212992,null,0,cf,[uf,En,Jt,[8,null],St],null,null)],(function(e,t){e(t,1,0)}),null)}var Pf,Ff,Mf=Rr("ng-component",il,(function(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"ng-component",[],null,null,null,Df,Nf)),ea(1,49152,null,0,il,[],null,null)],null,null)}),{},{},[]),Lf=function e(t){_classCallCheck2(this,e),this._animationMode=t},zf=function e(){_classCallCheck2(this,e)},Bf=new Ee("cdk-dir-doc",{providedIn:"root",factory:function(){return Me(Ms)}}),jf=((Pf=function(){function e(t){if(_classCallCheck2(this,e),this.value="ltr",this.change=new ka,t){var n=t.documentElement?t.documentElement.dir:null,r=(t.body?t.body.dir:null)||n;this.value="ltr"===r||"rtl"===r?r:"ltr"}}return _createClass2(e,[{key:"ngOnDestroy",value:function(){this.change.complete()}}]),e}()).ngInjectableDef=ve({factory:function(){return new Pf(Fe(Bf,8))},token:Pf,providedIn:"root"}),Pf),Vf=function e(){_classCallCheck2(this,e)},qf=new cn("8.2.3");function Uf(e){return null!=e&&""+e!="false"}function Wf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):t}function Gf(e){return Array.isArray(e)?e:[e]}function Hf(e){return null==e?"":"string"==typeof e?e:e+"px"}function Kf(e){return e instanceof nn?e.nativeElement:e}try{Ff="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(qk){Ff=!1}var Xf,Qf,Yf,Zf=((Qf=function e(t){_classCallCheck2(this,e),this._platformId=t,this.isBrowser=this._platformId?Ls(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!Ff)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}).ngInjectableDef=ve({factory:function(){return new Qf(Fe(Ra,8))},token:Qf,providedIn:"root"}),Qf),Jf=function e(){_classCallCheck2(this,e)},$f=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function ed(){if(Xf)return Xf;if("object"!=typeof document||!document)return Xf=new Set($f);var e=document.createElement("input");return Xf=new Set($f.filter((function(t){return e.setAttribute("type",t),e.type===t})))}function td(e){return function(){if(null==Yf&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){return Yf=!0}}))}finally{Yf=Yf||!1}return Yf}()?e:!!e.capture}var nd,rd=function(){var e={NORMAL:0,NEGATED:1,INVERTED:2};return e[e.NORMAL]="NORMAL",e[e.NEGATED]="NEGATED",e[e.INVERTED]="INVERTED",e}();function ad(){if("object"!=typeof document||!document)return rd.NORMAL;if(!nd){var e=document.createElement("div"),t=e.style;e.dir="rtl",t.height="1px",t.width="1px",t.overflow="auto",t.visibility="hidden",t.pointerEvents="none",t.position="absolute";var n=document.createElement("div"),r=n.style;r.width="2px",r.height="1px",e.appendChild(n),document.body.appendChild(e),nd=rd.NORMAL,0===e.scrollLeft&&(e.scrollLeft=1,nd=0===e.scrollLeft?rd.NEGATED:rd.INVERTED),e.parentNode.removeChild(e)}return nd}function id(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.length?n.some((function(t){return e[t]})):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}var od=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e,r)).scheduler=e,a.work=r,a.pending=!1,a}return _createClass2(n,[{key:"schedule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this}},{key:"requestAsyncId",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return setInterval(e.flush.bind(e,this),n)}},{key:"recycleAsyncId",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)}},{key:"execute",value:function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}},{key:"_execute",value:function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(a){n=!0,r=!!a&&a||new Error(a)}if(n)return this.unsubscribe(),r}},{key:"_unsubscribe",value:function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null}}]),n}(function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){return _classCallCheck2(this,n),t.call(this)}return _createClass2(n,[{key:"schedule",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this}}]),n}(d)),sd=function(){var e=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.now;_classCallCheck2(this,e),this.SchedulerAction=t,this.now=n}return _createClass2(e,[{key:"schedule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return new this.SchedulerAction(this,e).schedule(n,t)}}]),e}();return e.now=function(){return Date.now()},e}(),ud=new(function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sd.now;return _classCallCheck2(this,n),(r=t.call(this,e,(function(){return n.delegate&&n.delegate!==_assertThisInitialized(r)?n.delegate.now():a()}))).actions=[],r.active=!1,r.scheduled=void 0,r}return _createClass2(n,[{key:"schedule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;return n.delegate&&n.delegate!==this?n.delegate.schedule(e,t,r):_get(_getPrototypeOf(n.prototype),"schedule",this).call(this,e,t,r)}},{key:"flush",value:function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}}}]),n}(sd))(od);function cd(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ud;return function(n){return n.lift(new ld(e,t))}}var ld=function(){function e(t,n){_classCallCheck2(this,e),this.dueTime=t,this.scheduler=n}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new hd(e,this.dueTime,this.scheduler))}}]),e}(),hd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,e)).dueTime=r,i.scheduler=a,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return _createClass2(n,[{key:"_next",value:function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(fd,this.dueTime,this))}},{key:"_complete",value:function(){this.debouncedNext(),this.destination.complete()}},{key:"debouncedNext",value:function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}}},{key:"clearDebounce",value:function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)}}]),n}(v);function fd(e){e.debouncedNext()}function dd(e,t){return(e.getAttribute(t)||"").match(/\S+/g)||[]}var pd,md,vd=0,gd=new Map,yd=null,_d=((md=function(){function e(t){_classCallCheck2(this,e),this._document=t}return _createClass2(e,[{key:"describe",value:function(e,t){this._canBeDescribed(e,t)&&("string"!=typeof t?(this._setMessageId(t),gd.set(t,{messageElement:t,referenceCount:0})):gd.has(t)||this._createMessageElement(t),this._isElementDescribedByMessage(e,t)||this._addMessageReference(e,t))}},{key:"removeDescription",value:function(e,t){if(this._isElementNode(e)){if(this._isElementDescribedByMessage(e,t)&&this._removeMessageReference(e,t),"string"==typeof t){var n=gd.get(t);n&&0===n.referenceCount&&this._deleteMessageElement(t)}yd&&0===yd.childNodes.length&&this._deleteMessagesContainer()}}},{key:"ngOnDestroy",value:function(){for(var e=this._document.querySelectorAll("[cdk-describedby-host]"),t=0;t<e.length;t++)this._removeCdkDescribedByReferenceIds(e[t]),e[t].removeAttribute("cdk-describedby-host");yd&&this._deleteMessagesContainer(),gd.clear()}},{key:"_createMessageElement",value:function(e){var t=this._document.createElement("div");this._setMessageId(t),t.textContent=e,this._createMessagesContainer(),yd.appendChild(t),gd.set(e,{messageElement:t,referenceCount:0})}},{key:"_setMessageId",value:function(e){e.id||(e.id="cdk-describedby-message-"+vd++)}},{key:"_deleteMessageElement",value:function(e){var t=gd.get(e),n=t&&t.messageElement;yd&&n&&yd.removeChild(n),gd.delete(e)}},{key:"_createMessagesContainer",value:function(){if(!yd){var e=this._document.getElementById("cdk-describedby-message-container");e&&e.parentNode.removeChild(e),(yd=this._document.createElement("div")).id="cdk-describedby-message-container",yd.setAttribute("aria-hidden","true"),yd.style.display="none",this._document.body.appendChild(yd)}}},{key:"_deleteMessagesContainer",value:function(){yd&&yd.parentNode&&(yd.parentNode.removeChild(yd),yd=null)}},{key:"_removeCdkDescribedByReferenceIds",value:function(e){var t=dd(e,"aria-describedby").filter((function(e){return 0!=e.indexOf("cdk-describedby-message")}));e.setAttribute("aria-describedby",t.join(" "))}},{key:"_addMessageReference",value:function(e,t){var n,r,a,i,o=gd.get(t);n=e,r="aria-describedby",a=o.messageElement.id,(i=dd(n,r)).some((function(e){return e.trim()==a.trim()}))||(i.push(a.trim()),n.setAttribute(r,i.join(" "))),e.setAttribute("cdk-describedby-host",""),o.referenceCount++}},{key:"_removeMessageReference",value:function(e,t){var n,r,a,i,o=gd.get(t);o.referenceCount--,n=e,r="aria-describedby",a=o.messageElement.id,(i=dd(n,r).filter((function(e){return e!=a.trim()}))).length?n.setAttribute(r,i.join(" ")):n.removeAttribute(r),e.removeAttribute("cdk-describedby-host")}},{key:"_isElementDescribedByMessage",value:function(e,t){var n=dd(e,"aria-describedby"),r=gd.get(t),a=r&&r.messageElement.id;return!!a&&-1!=n.indexOf(a)}},{key:"_canBeDescribed",value:function(e,t){if(!this._isElementNode(e))return!1;if(t&&"object"==typeof t)return!0;var n=null==t?"":(""+t).trim(),r=e.getAttribute("aria-label");return!(!n||r&&r.trim()===n)}},{key:"_isElementNode",value:function(e){return e.nodeType===this._document.ELEMENT_NODE}}]),e}()).ngInjectableDef=ve({factory:function(){return new md(Fe(Ms))},token:md,providedIn:"root"}),md),bd=((pd=function(){function e(t){_classCallCheck2(this,e),this._platform=t}return _createClass2(e,[{key:"isDisabled",value:function(e){return e.hasAttribute("disabled")}},{key:"isVisible",value:function(e){return function(e){return!!(e.offsetWidth||e.offsetHeight||"function"==typeof e.getClientRects&&e.getClientRects().length)}(e)&&"visible"===getComputedStyle(e).visibility}},{key:"isTabbable",value:function(e){if(!this._platform.isBrowser)return!1;var t,n=function(e){try{return e.frameElement}catch(qk){return null}}((t=e).ownerDocument&&t.ownerDocument.defaultView||window);if(n){var r=n&&n.nodeName.toLowerCase();if(-1===wd(n))return!1;if((this._platform.BLINK||this._platform.WEBKIT)&&"object"===r)return!1;if((this._platform.BLINK||this._platform.WEBKIT)&&!this.isVisible(n))return!1}var a=e.nodeName.toLowerCase(),i=wd(e);if(e.hasAttribute("contenteditable"))return-1!==i;if("iframe"===a)return!1;if("audio"===a){if(!e.hasAttribute("controls"))return!1;if(this._platform.BLINK)return!0}if("video"===a){if(!e.hasAttribute("controls")&&this._platform.TRIDENT)return!1;if(this._platform.BLINK||this._platform.FIREFOX)return!0}return("object"!==a||!this._platform.BLINK&&!this._platform.WEBKIT)&&!(this._platform.WEBKIT&&this._platform.IOS&&!function(e){var t=e.nodeName.toLowerCase(),n="input"===t&&e.type;return"text"===n||"password"===n||"select"===t||"textarea"===t}(e))&&e.tabIndex>=0}},{key:"isFocusable",value:function(e){return function(e){return!function(e){return function(e){return"input"==e.nodeName.toLowerCase()}(e)&&"hidden"==e.type}(e)&&(function(e){var t=e.nodeName.toLowerCase();return"input"===t||"select"===t||"button"===t||"textarea"===t}(e)||function(e){return function(e){return"a"==e.nodeName.toLowerCase()}(e)&&e.hasAttribute("href")}(e)||e.hasAttribute("contenteditable")||kd(e))}(e)&&!this.isDisabled(e)&&this.isVisible(e)}}]),e}()).ngInjectableDef=ve({factory:function(){return new pd(Fe(Zf))},token:pd,providedIn:"root"}),pd);function kd(e){if(!e.hasAttribute("tabindex")||void 0===e.tabIndex)return!1;var t=e.getAttribute("tabindex");return"-32768"!=t&&!(!t||isNaN(parseInt(t,10)))}function wd(e){if(!kd(e))return null;var t=parseInt(e.getAttribute("tabindex")||"",10);return isNaN(t)?-1:t}var xd,Cd,Sd,Td=function(){function e(t,n,r,a){var i=this,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];_classCallCheck2(this,e),this._element=t,this._checker=n,this._ngZone=r,this._document=a,this._hasAttached=!1,this.startAnchorListener=function(){return i.focusLastTabbableElement()},this.endAnchorListener=function(){return i.focusFirstTabbableElement()},this._enabled=!0,o||this.attachAnchors()}return _createClass2(e,[{key:"destroy",value:function(){var e=this._startAnchor,t=this._endAnchor;e&&(e.removeEventListener("focus",this.startAnchorListener),e.parentNode&&e.parentNode.removeChild(e)),t&&(t.removeEventListener("focus",this.endAnchorListener),t.parentNode&&t.parentNode.removeChild(t)),this._startAnchor=this._endAnchor=null}},{key:"attachAnchors",value:function(){var e=this;return!!this._hasAttached||(this._ngZone.runOutsideAngular((function(){e._startAnchor||(e._startAnchor=e._createAnchor(),e._startAnchor.addEventListener("focus",e.startAnchorListener)),e._endAnchor||(e._endAnchor=e._createAnchor(),e._endAnchor.addEventListener("focus",e.endAnchorListener))})),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}},{key:"focusInitialElementWhenReady",value:function(){var e=this;return new Promise((function(t){e._executeOnStable((function(){return t(e.focusInitialElement())}))}))}},{key:"focusFirstTabbableElementWhenReady",value:function(){var e=this;return new Promise((function(t){e._executeOnStable((function(){return t(e.focusFirstTabbableElement())}))}))}},{key:"focusLastTabbableElementWhenReady",value:function(){var e=this;return new Promise((function(t){e._executeOnStable((function(){return t(e.focusLastTabbableElement())}))}))}},{key:"_getRegionBoundary",value:function(e){for(var t=this._element.querySelectorAll("[cdk-focus-region-".concat(e,"], [cdkFocusRegion").concat(e,"], [cdk-focus-").concat(e,"]")),n=0;n<t.length;n++)t[n].hasAttribute("cdk-focus-"+e)?console.warn("Found use of deprecated attribute 'cdk-focus-".concat(e,"', use 'cdkFocusRegion").concat(e,"' instead. The deprecated attribute will be removed in 8.0.0."),t[n]):t[n].hasAttribute("cdk-focus-region-"+e)&&console.warn("Found use of deprecated attribute 'cdk-focus-region-".concat(e,"', use 'cdkFocusRegion").concat(e,"' instead. The deprecated attribute will be removed in 8.0.0."),t[n]);return"start"==e?t.length?t[0]:this._getFirstTabbableElement(this._element):t.length?t[t.length-1]:this._getLastTabbableElement(this._element)}},{key:"focusInitialElement",value:function(){var e=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");return e?(e.hasAttribute("cdk-focus-initial")&&console.warn("Found use of deprecated attribute 'cdk-focus-initial', use 'cdkFocusInitial' instead. The deprecated attribute will be removed in 8.0.0",e),Ze()&&!this._checker.isFocusable(e)&&console.warn("Element matching '[cdkFocusInitial]' is not focusable.",e),e.focus(),!0):this.focusFirstTabbableElement()}},{key:"focusFirstTabbableElement",value:function(){var e=this._getRegionBoundary("start");return e&&e.focus(),!!e}},{key:"focusLastTabbableElement",value:function(){var e=this._getRegionBoundary("end");return e&&e.focus(),!!e}},{key:"hasAttached",value:function(){return this._hasAttached}},{key:"_getFirstTabbableElement",value:function(e){if(this._checker.isFocusable(e)&&this._checker.isTabbable(e))return e;for(var t=e.children||e.childNodes,n=0;n<t.length;n++){var r=t[n].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(t[n]):null;if(r)return r}return null}},{key:"_getLastTabbableElement",value:function(e){if(this._checker.isFocusable(e)&&this._checker.isTabbable(e))return e;for(var t=e.children||e.childNodes,n=t.length-1;n>=0;n--){var r=t[n].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(t[n]):null;if(r)return r}return null}},{key:"_createAnchor",value:function(){var e=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,e),e.classList.add("cdk-visually-hidden"),e.classList.add("cdk-focus-trap-anchor"),e.setAttribute("aria-hidden","true"),e}},{key:"_toggleAnchorTabIndex",value:function(e,t){e?t.setAttribute("tabindex","0"):t.removeAttribute("tabindex")}},{key:"_executeOnStable",value:function(e){this._ngZone.isStable?e():this._ngZone.onStable.asObservable().pipe(bu(1)).subscribe(e)}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(e,this._startAnchor),this._toggleAnchorTabIndex(e,this._endAnchor))}}]),e}(),Ad=((xd=function(){function e(t,n,r){_classCallCheck2(this,e),this._checker=t,this._ngZone=n,this._document=r}return _createClass2(e,[{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Td(e,this._checker,this._ngZone,this._document,t)}}]),e}()).ngInjectableDef=ve({factory:function(){return new xd(Fe(bd),Fe(Ya),Fe(Ms))},token:xd,providedIn:"root"}),xd),Ed=new Ee("liveAnnouncerElement",{providedIn:"root",factory:function(){return null}}),Id=new Ee("LIVE_ANNOUNCER_DEFAULT_OPTIONS"),Rd=((Cd=function(){function e(t,n,r,a){_classCallCheck2(this,e),this._ngZone=n,this._defaultOptions=a,this._document=r,this._liveElement=t||this._createLiveElement()}return _createClass2(e,[{key:"announce",value:function(e){for(var t,n,r,a=this,i=this._defaultOptions,o=arguments.length,s=new Array(o>1?o-1:0),u=1;u<o;u++)s[u-1]=arguments[u];return 1===s.length&&"number"==typeof s[0]?r=s[0]:(n=(t=_slicedToArray2(s,2))[0],r=t[1]),this.clear(),clearTimeout(this._previousTimeout),n||(n=i&&i.politeness?i.politeness:"polite"),null==r&&i&&(r=i.duration),this._liveElement.setAttribute("aria-live",n),this._ngZone.runOutsideAngular((function(){return new Promise((function(t){clearTimeout(a._previousTimeout),a._previousTimeout=setTimeout((function(){a._liveElement.textContent=e,t(),"number"==typeof r&&(a._previousTimeout=setTimeout((function(){return a.clear()}),r))}),100)}))}))}},{key:"clear",value:function(){this._liveElement&&(this._liveElement.textContent="")}},{key:"ngOnDestroy",value:function(){clearTimeout(this._previousTimeout),this._liveElement&&this._liveElement.parentNode&&(this._liveElement.parentNode.removeChild(this._liveElement),this._liveElement=null)}},{key:"_createLiveElement",value:function(){for(var e=this._document.getElementsByClassName("cdk-live-announcer-element"),t=this._document.createElement("div"),n=0;n<e.length;n++)e[n].parentNode.removeChild(e[n]);return t.classList.add("cdk-live-announcer-element"),t.classList.add("cdk-visually-hidden"),t.setAttribute("aria-atomic","true"),t.setAttribute("aria-live","polite"),this._document.body.appendChild(t),t}}]),e}()).ngInjectableDef=ve({factory:function(){return new Cd(Fe(Ed,8),Fe(Ya),Fe(Ms),Fe(Id,8))},token:Cd,providedIn:"root"}),Cd),Od=td({passive:!0,capture:!0}),Nd=((Sd=function(){function e(t,n){var r=this;_classCallCheck2(this,e),this._ngZone=t,this._platform=n,this._origin=null,this._windowFocused=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._documentKeydownListener=function(){r._lastTouchTarget=null,r._setOriginForCurrentEventQueue("keyboard")},this._documentMousedownListener=function(){r._lastTouchTarget||r._setOriginForCurrentEventQueue("mouse")},this._documentTouchstartListener=function(e){null!=r._touchTimeoutId&&clearTimeout(r._touchTimeoutId),r._lastTouchTarget=e.composedPath?e.composedPath()[0]:e.target,r._touchTimeoutId=setTimeout((function(){return r._lastTouchTarget=null}),650)},this._windowFocusListener=function(){r._windowFocused=!0,r._windowFocusTimeoutId=setTimeout((function(){return r._windowFocused=!1}))}}return _createClass2(e,[{key:"monitor",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._platform.isBrowser)return Ws(null);var r=Kf(e);if(this._elementInfo.has(r)){var a=this._elementInfo.get(r);return a.checkChildren=n,a.subject.asObservable()}var i={unlisten:function(){},checkChildren:n,subject:new R};this._elementInfo.set(r,i),this._incrementMonitoredElementCount();var o=function(e){return t._onFocus(e,r)},s=function(e){return t._onBlur(e,r)};return this._ngZone.runOutsideAngular((function(){r.addEventListener("focus",o,!0),r.addEventListener("blur",s,!0)})),i.unlisten=function(){r.removeEventListener("focus",o,!0),r.removeEventListener("blur",s,!0)},i.subject.asObservable()}},{key:"stopMonitoring",value:function(e){var t=Kf(e),n=this._elementInfo.get(t);n&&(n.unlisten(),n.subject.complete(),this._setClasses(t),this._elementInfo.delete(t),this._decrementMonitoredElementCount())}},{key:"focusVia",value:function(e,t,n){var r=Kf(e);this._setOriginForCurrentEventQueue(t),"function"==typeof r.focus&&r.focus(n)}},{key:"ngOnDestroy",value:function(){var e=this;this._elementInfo.forEach((function(t,n){return e.stopMonitoring(n)}))}},{key:"_toggleClass",value:function(e,t,n){n?e.classList.add(t):e.classList.remove(t)}},{key:"_setClasses",value:function(e,t){this._elementInfo.get(e)&&(this._toggleClass(e,"cdk-focused",!!t),this._toggleClass(e,"cdk-touch-focused","touch"===t),this._toggleClass(e,"cdk-keyboard-focused","keyboard"===t),this._toggleClass(e,"cdk-mouse-focused","mouse"===t),this._toggleClass(e,"cdk-program-focused","program"===t))}},{key:"_setOriginForCurrentEventQueue",value:function(e){var t=this;this._ngZone.runOutsideAngular((function(){t._origin=e,t._originTimeoutId=setTimeout((function(){return t._origin=null}),1)}))}},{key:"_wasCausedByTouch",value:function(e){var t=e.target;return this._lastTouchTarget instanceof Node&&t instanceof Node&&(t===this._lastTouchTarget||t.contains(this._lastTouchTarget))}},{key:"_onFocus",value:function(e,t){var n=this._elementInfo.get(t);if(n&&(n.checkChildren||t===e.target)){var r=this._origin;r||(r=this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:this._wasCausedByTouch(e)?"touch":"program"),this._setClasses(t,r),this._emitOrigin(n.subject,r),this._lastFocusOrigin=r}}},{key:"_onBlur",value:function(e,t){var n=this._elementInfo.get(t);!n||n.checkChildren&&e.relatedTarget instanceof Node&&t.contains(e.relatedTarget)||(this._setClasses(t),this._emitOrigin(n.subject,null))}},{key:"_emitOrigin",value:function(e,t){this._ngZone.run((function(){return e.next(t)}))}},{key:"_incrementMonitoredElementCount",value:function(){var e=this;1==++this._monitoredElementCount&&this._platform.isBrowser&&this._ngZone.runOutsideAngular((function(){document.addEventListener("keydown",e._documentKeydownListener,Od),document.addEventListener("mousedown",e._documentMousedownListener,Od),document.addEventListener("touchstart",e._documentTouchstartListener,Od),window.addEventListener("focus",e._windowFocusListener)}))}},{key:"_decrementMonitoredElementCount",value:function(){--this._monitoredElementCount||(document.removeEventListener("keydown",this._documentKeydownListener,Od),document.removeEventListener("mousedown",this._documentMousedownListener,Od),document.removeEventListener("touchstart",this._documentTouchstartListener,Od),window.removeEventListener("focus",this._windowFocusListener),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._touchTimeoutId),clearTimeout(this._originTimeoutId))}}]),e}()).ngInjectableDef=ve({factory:function(){return new Sd(Fe(Ya),Fe(Zf))},token:Sd,providedIn:"root"}),Sd),Dd=function e(){_classCallCheck2(this,e)},Pd=new cn("8.2.3"),Fd=new Ee("mat-sanity-checks",{providedIn:"root",factory:function(){return!0}}),Md=function(){function e(t,n){_classCallCheck2(this,e),this._sanityChecksEnabled=t,this._hammerLoader=n,this._hasDoneGlobalChecks=!1,this._hasCheckedHammer=!1,this._document="object"==typeof document&&document?document:null,this._window="object"==typeof window&&window?window:null,this._areChecksEnabled()&&!this._hasDoneGlobalChecks&&(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}return _createClass2(e,[{key:"_areChecksEnabled",value:function(){return this._sanityChecksEnabled&&Ze()&&!this._isTestEnv()}},{key:"_isTestEnv",value:function(){var e=this._window;return e&&(e.__karma__||e.jasmine)}},{key:"_checkDoctypeIsDefined",value:function(){this._document&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}},{key:"_checkThemeIsPresent",value:function(){if(this._document&&this._document.body&&"function"==typeof getComputedStyle){var e=this._document.createElement("div");e.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(e);var t=getComputedStyle(e);t&&"none"!==t.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),this._document.body.removeChild(e)}}},{key:"_checkCdkVersionMatch",value:function(){Pd.full!==qf.full&&console.warn("The Angular Material version ("+Pd.full+") does not match the Angular CDK version ("+qf.full+").\nPlease ensure the versions of these two packages exactly match.")}},{key:"_checkHammerIsAvailable",value:function(){!this._hasCheckedHammer&&this._window&&(!this._areChecksEnabled()||this._window.Hammer||this._hammerLoader||console.warn("Could not find HammerJS. Certain Angular Material components may not work correctly."),this._hasCheckedHammer=!0)}}]),e}();function Ld(e){return function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a)))._disabled=!1,e}return _createClass2(n,[{key:"disabled",get:function(){return this._disabled},set:function(e){this._disabled=Uf(e)}}]),n}(e)}function zd(e,t){return function(e){_inherits(r,e);var n=_createSuper(r);function r(){var e;_classCallCheck2(this,r);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).color=t,e}return _createClass2(r,[{key:"color",get:function(){return this._color},set:function(e){var n=e||t;n!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove("mat-"+this._color),n&&this._elementRef.nativeElement.classList.add("mat-"+n),this._color=n)}}]),r}(e)}function Bd(e){return function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a)))._disableRipple=!1,e}return _createClass2(n,[{key:"disableRipple",get:function(){return this._disableRipple},set:function(e){this._disableRipple=Uf(e)}}]),n}(e)}try{"undefined"!=typeof Intl}catch(qk){!1}var jd,Vd=((jd=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"isErrorState",value:function(e,t){return!!(e&&e.invalid&&(e.touched||t&&t.submitted))}}]),e}()).ngInjectableDef=ve({factory:function(){return new jd},token:jd,providedIn:"root"}),jd),qd=new Ee("MAT_HAMMER_OPTIONS"),Ud=["longpress","slide","slidestart","slideend","slideright","slideleft"],Wd={on:function(){},off:function(){}},Gd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this))._hammerOptions=e,a.events=Ud,r&&r._checkHammerIsAvailable(),a}return _createClass2(n,[{key:"buildHammer",value:function(e){var t="undefined"!=typeof window?window.Hammer:null;if(!t)return Wd;var n=new t(e,this._hammerOptions||void 0),r=new t.Pan,a=new t.Swipe,i=new t.Press,o=this._createRecognizer(r,{event:"slide",threshold:0},a),s=this._createRecognizer(i,{event:"longpress",time:500});return r.recognizeWith(a),s.recognizeWith(o),n.add([a,i,r,o,s]),n}},{key:"_createRecognizer",value:function(e,t){for(var n=new e.constructor(t),r=arguments.length,a=new Array(r>2?r-2:0),i=2;i<r;i++)a[i-2]=arguments[i];return a.push(e),a.forEach((function(e){return n.recognizeWith(e)})),n}}]),n}(function(){function e(){_classCallCheck2(this,e),this.events=[],this.overrides={}}return _createClass2(e,[{key:"buildHammer",value:function(e){var t=new Hammer(e,this.options);for(var n in t.get("pinch").set({enable:!0}),t.get("rotate").set({enable:!0}),this.overrides)t.get(n).set(this.overrides[n]);return t}}]),e}());function Hd(e,t,n){var r=e.nativeElement.classList;n?r.add(t):r.remove(t)}var Kd=function e(){_classCallCheck2(this,e)},Xd=function(){var e={FADING_IN:0,VISIBLE:1,FADING_OUT:2,HIDDEN:3};return e[e.FADING_IN]="FADING_IN",e[e.VISIBLE]="VISIBLE",e[e.FADING_OUT]="FADING_OUT",e[e.HIDDEN]="HIDDEN",e}(),Qd=function(){function e(t,n,r){_classCallCheck2(this,e),this._renderer=t,this.element=n,this.config=r,this.state=Xd.HIDDEN}return _createClass2(e,[{key:"fadeOut",value:function(){this._renderer.fadeOutRipple(this)}}]),e}(),Yd={enterDuration:450,exitDuration:400},Zd=td({passive:!0}),Jd=function(){function e(t,n,r,a){var i=this;_classCallCheck2(this,e),this._target=t,this._ngZone=n,this._isPointerDown=!1,this._triggerEvents=new Map,this._activeRipples=new Set,this._onMousedown=function(e){var t=function(e){return 0===e.buttons}(e),n=i._lastTouchStartEvent&&Date.now()<i._lastTouchStartEvent+800;i._target.rippleDisabled||t||n||(i._isPointerDown=!0,i.fadeInRipple(e.clientX,e.clientY,i._target.rippleConfig))},this._onTouchStart=function(e){if(!i._target.rippleDisabled){i._lastTouchStartEvent=Date.now(),i._isPointerDown=!0;for(var t=e.changedTouches,n=0;n<t.length;n++)i.fadeInRipple(t[n].clientX,t[n].clientY,i._target.rippleConfig)}},this._onPointerUp=function(){i._isPointerDown&&(i._isPointerDown=!1,i._activeRipples.forEach((function(e){!e.config.persistent&&(e.state===Xd.VISIBLE||e.config.terminateOnPointerUp&&e.state===Xd.FADING_IN)&&e.fadeOut()})))},a.isBrowser&&(this._containerElement=Kf(r),this._triggerEvents.set("mousedown",this._onMousedown).set("mouseup",this._onPointerUp).set("mouseleave",this._onPointerUp).set("touchstart",this._onTouchStart).set("touchend",this._onPointerUp).set("touchcancel",this._onPointerUp))}return _createClass2(e,[{key:"fadeInRipple",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),i=Object.assign({},Yd,r.animation);r.centered&&(e=a.left+a.width/2,t=a.top+a.height/2);var o=r.radius||function(e,t,n){var r=Math.max(Math.abs(e-n.left),Math.abs(e-n.right)),a=Math.max(Math.abs(t-n.top),Math.abs(t-n.bottom));return Math.sqrt(r*r+a*a)}(e,t,a),s=e-a.left,u=t-a.top,c=i.enterDuration,l=document.createElement("div");l.classList.add("mat-ripple-element"),l.style.left=s-o+"px",l.style.top=u-o+"px",l.style.height=2*o+"px",l.style.width=2*o+"px",l.style.backgroundColor=r.color||null,l.style.transitionDuration=c+"ms",this._containerElement.appendChild(l),window.getComputedStyle(l).getPropertyValue("opacity"),l.style.transform="scale(1)";var h=new Qd(this,l,r);return h.state=Xd.FADING_IN,this._activeRipples.add(h),r.persistent||(this._mostRecentTransientRipple=h),this._runTimeoutOutsideZone((function(){var e=h===n._mostRecentTransientRipple;h.state=Xd.VISIBLE,r.persistent||e&&n._isPointerDown||h.fadeOut()}),c),h}},{key:"fadeOutRipple",value:function(e){var t=this._activeRipples.delete(e);if(e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),this._activeRipples.size||(this._containerRect=null),t){var n=e.element,r=Object.assign({},Yd,e.config.animation);n.style.transitionDuration=r.exitDuration+"ms",n.style.opacity="0",e.state=Xd.FADING_OUT,this._runTimeoutOutsideZone((function(){e.state=Xd.HIDDEN,n.parentNode.removeChild(n)}),r.exitDuration)}}},{key:"fadeOutAll",value:function(){this._activeRipples.forEach((function(e){return e.fadeOut()}))}},{key:"setupTriggerEvents",value:function(e){var t=this,n=Kf(e);n&&n!==this._triggerElement&&(this._removeTriggerEvents(),this._ngZone.runOutsideAngular((function(){t._triggerEvents.forEach((function(e,t){n.addEventListener(t,e,Zd)}))})),this._triggerElement=n)}},{key:"_runTimeoutOutsideZone",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._ngZone.runOutsideAngular((function(){return setTimeout(e,t)}))}},{key:"_removeTriggerEvents",value:function(){var e=this;this._triggerElement&&this._triggerEvents.forEach((function(t,n){e._triggerElement.removeEventListener(n,t,Zd)}))}}]),e}(),$d=new Ee("mat-ripple-global-options"),ep=function(){function e(t,n,r,a,i){_classCallCheck2(this,e),this._elementRef=t,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=a||{},this._rippleRenderer=new Jd(this,n,t,r),"NoopAnimations"===i&&(this._globalOptions.animation={enterDuration:0,exitDuration:0})}return _createClass2(e,[{key:"ngOnInit",value:function(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}},{key:"ngOnDestroy",value:function(){this._rippleRenderer._removeTriggerEvents()}},{key:"fadeOutAll",value:function(){this._rippleRenderer.fadeOutAll()}},{key:"_setupTriggerEventsIfEnabled",value:function(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}},{key:"launch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return"number"==typeof e?this._rippleRenderer.fadeInRipple(e,t,Object.assign({},this.rippleConfig,n)):this._rippleRenderer.fadeInRipple(0,0,Object.assign({},this.rippleConfig,e))}},{key:"disabled",get:function(){return this._disabled},set:function(e){this._disabled=e,this._setupTriggerEventsIfEnabled()}},{key:"trigger",get:function(){return this._trigger||this._elementRef.nativeElement},set:function(e){this._trigger=e,this._setupTriggerEventsIfEnabled()}},{key:"rippleConfig",get:function(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Object.assign({},this._globalOptions.animation,this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}},{key:"rippleDisabled",get:function(){return this.disabled||!!this._globalOptions.disabled}}]),e}(),tp=function e(){_classCallCheck2(this,e)},np=function e(){_classCallCheck2(this,e)},rp=function e(){_classCallCheck2(this,e)},ap=new Ee("mat-label-global-options"),ip=function e(){_classCallCheck2(this,e)};function op(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{type:2,steps:e,options:t}}function sp(e){return{type:6,styles:e,offset:null}}function up(e){Promise.resolve(null).then(e)}var cp=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck2(this,e),this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this.parentPlayer=null,this.totalTime=t+n}return _createClass2(e,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach((function(e){return e()})),this._onDoneFns=[])}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"hasStarted",value:function(){return this._started}},{key:"init",value:function(){}},{key:"play",value:function(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}},{key:"triggerMicrotask",value:function(){var e=this;up((function(){return e._onFinish()}))}},{key:"_onStart",value:function(){this._onStartFns.forEach((function(e){return e()})),this._onStartFns=[]}},{key:"pause",value:function(){}},{key:"restart",value:function(){}},{key:"finish",value:function(){this._onFinish()}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach((function(e){return e()})),this._onDestroyFns=[])}},{key:"reset",value:function(){}},{key:"setPosition",value:function(e){}},{key:"getPosition",value:function(){return 0}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach((function(e){return e()})),t.length=0}}]),e}(),lp=function(){function e(t){var n=this;_classCallCheck2(this,e),this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;var r=0,a=0,i=0,o=this.players.length;0==o?up((function(){return n._onFinish()})):this.players.forEach((function(e){e.onDone((function(){++r==o&&n._onFinish()})),e.onDestroy((function(){++a==o&&n._onDestroy()})),e.onStart((function(){++i==o&&n._onStart()}))})),this.totalTime=this.players.reduce((function(e,t){return Math.max(e,t.totalTime)}),0)}return _createClass2(e,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach((function(e){return e()})),this._onDoneFns=[])}},{key:"init",value:function(){this.players.forEach((function(e){return e.init()}))}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"_onStart",value:function(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach((function(e){return e()})),this._onStartFns=[])}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"hasStarted",value:function(){return this._started}},{key:"play",value:function(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach((function(e){return e.play()}))}},{key:"pause",value:function(){this.players.forEach((function(e){return e.pause()}))}},{key:"restart",value:function(){this.players.forEach((function(e){return e.restart()}))}},{key:"finish",value:function(){this._onFinish(),this.players.forEach((function(e){return e.finish()}))}},{key:"destroy",value:function(){this._onDestroy()}},{key:"_onDestroy",value:function(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach((function(e){return e.destroy()})),this._onDestroyFns.forEach((function(e){return e()})),this._onDestroyFns=[])}},{key:"reset",value:function(){this.players.forEach((function(e){return e.reset()})),this._destroyed=!1,this._finished=!1,this._started=!1}},{key:"setPosition",value:function(e){var t=e*this.totalTime;this.players.forEach((function(e){var n=e.totalTime?Math.min(1,t/e.totalTime):1;e.setPosition(n)}))}},{key:"getPosition",value:function(){var e=0;return this.players.forEach((function(t){var n=t.getPosition();e=Math.min(n,e)})),e}},{key:"beforeDestroy",value:function(){this.players.forEach((function(e){e.beforeDestroy&&e.beforeDestroy()}))}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach((function(e){return e()})),t.length=0}}]),e}();function hp(){return"undefined"!=typeof process}function fp(e){switch(e.length){case 0:return new cp;case 1:return e[0];default:return new lp(e)}}function dp(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=[],s=[],u=-1,c=null;if(r.forEach((function(e){var n=e.offset,r=n==u,l=r&&c||{};Object.keys(e).forEach((function(n){var r=n,s=e[n];if("offset"!==n)switch(r=t.normalizePropertyName(r,o),s){case"!":s=a[n];break;case"*":s=i[n];break;default:s=t.normalizeStyleValue(n,r,s,o)}l[r]=s})),r||s.push(l),c=l,u=n})),o.length){var l="\n - ";throw new Error("Unable to animate due to the following errors:".concat(l).concat(o.join(l)))}return s}function pp(e,t,n,r){switch(t){case"start":e.onStart((function(){return r(n&&mp(n,"start",e))}));break;case"done":e.onDone((function(){return r(n&&mp(n,"done",e))}));break;case"destroy":e.onDestroy((function(){return r(n&&mp(n,"destroy",e))}))}}function mp(e,t,n){var r=n.totalTime,a=vp(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,null==r?e.totalTime:r,!!n.disabled),i=e._data;return null!=i&&(a._data=i),a}function vp(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6?arguments[6]:void 0;return{element:e,triggerName:t,fromState:n,toState:r,phaseName:a,totalTime:i,disabled:!!o}}function gp(e,t,n){var r;return e instanceof Map?(r=e.get(t))||e.set(t,r=n):(r=e[t])||(r=e[t]=n),r}function yp(e){var t=e.indexOf(":");return[e.substring(1,t),e.substr(t+1)]}var _p=function(e,t){return!1},bp=function(e,t){return!1},kp=function(e,t,n){return[]},wp=hp();(wp||"undefined"!=typeof Element)&&(_p=function(e,t){return e.contains(t)},bp=function(){if(wp||Element.prototype.matches)return function(e,t){return e.matches(t)};var e=Element.prototype,t=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return t?function(e,n){return t.apply(e,[n])}:bp}(),kp=function(e,t,n){var r=[];if(n)r.push.apply(r,_toConsumableArray(e.querySelectorAll(t)));else{var a=e.querySelector(t);a&&r.push(a)}return r});var xp=null,Cp=!1;function Sp(e){xp||(xp=("undefined"!=typeof document?document.body:null)||{},Cp=!!xp.style&&"WebkitAppearance"in xp.style);var t=!0;return xp.style&&!function(e){return"ebkit"==e.substring(1,6)}(e)&&(!(t=e in xp.style)&&Cp)&&(t="Webkit"+e.charAt(0).toUpperCase()+e.substr(1)in xp.style),t}var Tp=bp,Ap=_p,Ep=kp;function Ip(e){var t={};return Object.keys(e).forEach((function(n){var r=n.replace(/([a-z])([A-Z])/g,"$1-$2");t[r]=e[n]})),t}var Rp=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"validateStyleProperty",value:function(e){return Sp(e)}},{key:"matchesElement",value:function(e,t){return Tp(e,t)}},{key:"containsElement",value:function(e,t){return Ap(e,t)}},{key:"query",value:function(e,t,n){return Ep(e,t,n)}},{key:"computeStyle",value:function(e,t,n){return n||""}},{key:"animate",value:function(e,t,n,r,a){arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&arguments[6];return new cp(n,r)}}]),e}(),Op=function(){var e=function e(){_classCallCheck2(this,e)};return e.NOOP=new Rp,e}();function Np(e){if("number"==typeof e)return e;var t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:Dp(parseFloat(t[1]),t[2])}function Dp(e,t){switch(t){case"s":return 1e3*e;default:return e}}function Pp(e,t,n){return e.hasOwnProperty("duration")?e:function(e,t,n){var r,a=0,i="";if("string"==typeof e){var o=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===o)return t.push('The provided timing value "'.concat(e,'" is invalid.')),{duration:0,delay:0,easing:""};r=Dp(parseFloat(o[1]),o[2]);var s=o[3];null!=s&&(a=Dp(parseFloat(s),o[4]));var u=o[5];u&&(i=u)}else r=e;if(!n){var c=!1,l=t.length;r<0&&(t.push("Duration values below 0 are not allowed for this animation step."),c=!0),a<0&&(t.push("Delay values below 0 are not allowed for this animation step."),c=!0),c&&t.splice(l,0,'The provided timing value "'.concat(e,'" is invalid.'))}return{duration:r,delay:a,easing:i}}(e,t,n)}function Fp(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).forEach((function(n){t[n]=e[n]})),t}function Mp(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t)for(var r in e)n[r]=e[r];else Fp(e,n);return n}function Lp(e,t,n){return n?t+":"+n+";":""}function zp(e){for(var t="",n=0;n<e.style.length;n++){var r=e.style.item(n);t+=Lp(0,r,e.style.getPropertyValue(r))}for(var a in e.style)e.style.hasOwnProperty(a)&&!a.startsWith("_")&&(t+=Lp(0,a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),e.style[a]));e.setAttribute("style",t)}function Bp(e,t,n){e.style&&(Object.keys(t).forEach((function(r){var a=Kp(r);n&&!n.hasOwnProperty(r)&&(n[r]=e.style[a]),e.style[a]=t[r]})),hp()&&zp(e))}function jp(e,t){e.style&&(Object.keys(t).forEach((function(t){var n=Kp(t);e.style[n]=""})),hp()&&zp(e))}function Vp(e){return Array.isArray(e)?1==e.length?e[0]:op(e):e}var qp=new RegExp("{{\\s*(.+?)\\s*}}","g");function Up(e){var t=[];if("string"==typeof e){for(var n,r=e.toString();n=qp.exec(r);)t.push(n[1]);qp.lastIndex=0}return t}function Wp(e,t,n){var r=e.toString(),a=r.replace(qp,(function(e,r){var a=t[r];return t.hasOwnProperty(r)||(n.push("Please provide a value for the animation param "+r),a=""),a.toString()}));return a==r?e:a}function Gp(e){for(var t=[],n=e.next();!n.done;)t.push(n.value),n=e.next();return t}var Hp=/-+([a-z0-9])/g;function Kp(e){return e.replace(Hp,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[1].toUpperCase()}))}function Xp(e,t){return 0===e||0===t}function Qp(e,t,n){var r=Object.keys(n);if(r.length&&t.length){var a=t[0],i=[];if(r.forEach((function(e){a.hasOwnProperty(e)||i.push(e),a[e]=n[e]})),i.length)for(var o=function(){var n=t[s];i.forEach((function(t){n[t]=Zp(e,t)}))},s=1;s<t.length;s++)o()}return t}function Yp(e,t,n){switch(t.type){case 7:return e.visitTrigger(t,n);case 0:return e.visitState(t,n);case 1:return e.visitTransition(t,n);case 2:return e.visitSequence(t,n);case 3:return e.visitGroup(t,n);case 4:return e.visitAnimate(t,n);case 5:return e.visitKeyframes(t,n);case 6:return e.visitStyle(t,n);case 8:return e.visitReference(t,n);case 9:return e.visitAnimateChild(t,n);case 10:return e.visitAnimateRef(t,n);case 11:return e.visitQuery(t,n);case 12:return e.visitStagger(t,n);default:throw new Error("Unable to resolve animation metadata node #"+t.type)}}function Zp(e,t){return window.getComputedStyle(e)[t]}var Jp=new Set(["true","1"]),$p=new Set(["false","0"]);function em(e,t){var n=Jp.has(e)||$p.has(e),r=Jp.has(t)||$p.has(t);return function(a,i){var o="*"==e||e==a,s="*"==t||t==i;return!o&&n&&"boolean"==typeof a&&(o=a?Jp.has(e):$p.has(e)),!s&&r&&"boolean"==typeof i&&(s=i?Jp.has(t):$p.has(t)),o&&s}}var tm=new RegExp("s*:selfs*,?","g");function nm(e,t,n){return new rm(e).build(t,n)}var rm=function(){function e(t){_classCallCheck2(this,e),this._driver=t}return _createClass2(e,[{key:"build",value:function(e,t){var n=new am(t);return this._resetContextStyleTimingState(n),Yp(this,Vp(e),n)}},{key:"_resetContextStyleTimingState",value:function(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}},{key:"visitTrigger",value:function(e,t){var n=this,r=t.queryCount=0,a=t.depCount=0,i=[],o=[];return"@"==e.name.charAt(0)&&t.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),e.definitions.forEach((function(e){if(n._resetContextStyleTimingState(t),0==e.type){var s=e,u=s.name;u.toString().split(/\s*,\s*/).forEach((function(e){s.name=e,i.push(n.visitState(s,t))})),s.name=u}else if(1==e.type){var c=n.visitTransition(e,t);r+=c.queryCount,a+=c.depCount,o.push(c)}else t.errors.push("only state() and transition() definitions can sit inside of a trigger()")})),{type:7,name:e.name,states:i,transitions:o,queryCount:r,depCount:a,options:null}}},{key:"visitState",value:function(e,t){var n=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(n.containsDynamicStyles){var a=new Set,i=r||{};if(n.styles.forEach((function(e){if(im(e)){var t=e;Object.keys(t).forEach((function(e){Up(t[e]).forEach((function(e){i.hasOwnProperty(e)||a.add(e)}))}))}})),a.size){var o=Gp(a.values());t.errors.push('state("'.concat(e.name,'", ...) must define default values for all the following style substitutions: ').concat(o.join(", ")))}}return{type:0,name:e.name,style:n,options:r?{params:r}:null}}},{key:"visitTransition",value:function(e,t){t.queryCount=0,t.depCount=0;var n,r,a,i=Yp(this,Vp(e.animation),t);return{type:1,matchers:(n=e.expr,r=t.errors,a=[],"string"==typeof n?n.split(/\s*,\s*/).forEach((function(e){return function(e,t,n){if(":"==e[0]){var r=function(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return function(e,t){return parseFloat(t)>parseFloat(e)};case":decrement":return function(e,t){return parseFloat(t)<parseFloat(e)};default:return t.push('The transition alias value "'.concat(e,'" is not supported')),"* => *"}}(e,n);if("function"==typeof r)return void t.push(r);e=r}var a=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==a||a.length<4)return n.push('The provided transition expression "'.concat(e,'" is not supported')),t;var i=a[1],o=a[2],s=a[3];t.push(em(i,s)),"<"!=o[0]||"*"==i&&"*"==s||t.push(em(s,i))}(e,a,r)})):a.push(n),a),animation:i,queryCount:t.queryCount,depCount:t.depCount,options:om(e.options)}}},{key:"visitSequence",value:function(e,t){var n=this;return{type:2,steps:e.steps.map((function(e){return Yp(n,e,t)})),options:om(e.options)}}},{key:"visitGroup",value:function(e,t){var n=this,r=t.currentTime,a=0,i=e.steps.map((function(e){t.currentTime=r;var i=Yp(n,e,t);return a=Math.max(a,t.currentTime),i}));return t.currentTime=a,{type:3,steps:i,options:om(e.options)}}},{key:"visitAnimate",value:function(e,t){var n,r=function(e,t){var n=null;if(e.hasOwnProperty("duration"))n=e;else if("number"==typeof e)return sm(Pp(e,t).duration,0,"");var r=e;if(r.split(/\s+/).some((function(e){return"{"==e.charAt(0)&&"{"==e.charAt(1)}))){var a=sm(0,0,"");return a.dynamic=!0,a.strValue=r,a}return sm((n=n||Pp(r,t)).duration,n.delay,n.easing)}(e.timings,t.errors);t.currentAnimateTimings=r;var a=e.styles?e.styles:sp({});if(5==a.type)n=this.visitKeyframes(a,t);else{var i=e.styles,o=!1;if(!i){o=!0;var s={};r.easing&&(s.easing=r.easing),i=sp(s)}t.currentTime+=r.duration+r.delay;var u=this.visitStyle(i,t);u.isEmptyStep=o,n=u}return t.currentAnimateTimings=null,{type:4,timings:r,style:n,options:null}}},{key:"visitStyle",value:function(e,t){var n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}},{key:"_makeStyleAst",value:function(e,t){var n=[];Array.isArray(e.styles)?e.styles.forEach((function(e){"string"==typeof e?"*"==e?n.push(e):t.errors.push("The provided style string value ".concat(e," is not allowed.")):n.push(e)})):n.push(e.styles);var r=!1,a=null;return n.forEach((function(e){if(im(e)){var t=e,n=t.easing;if(n&&(a=n,delete t.easing),!r)for(var i in t)if(t[i].toString().indexOf("{{")>=0){r=!0;break}}})),{type:6,styles:n,easing:a,offset:e.offset,containsDynamicStyles:r,options:null}}},{key:"_validateStyleAst",value:function(e,t){var n=this,r=t.currentAnimateTimings,a=t.currentTime,i=t.currentTime;r&&i>0&&(i-=r.duration+r.delay),e.styles.forEach((function(e){"string"!=typeof e&&Object.keys(e).forEach((function(r){if(n._driver.validateStyleProperty(r)){var o,s,u,c,l,h=t.collectedStyles[t.currentQuerySelector],f=h[r],d=!0;f&&(i!=a&&i>=f.startTime&&a<=f.endTime&&(t.errors.push('The CSS property "'.concat(r,'" that exists between the times of "').concat(f.startTime,'ms" and "').concat(f.endTime,'ms" is also being animated in a parallel animation between the times of "').concat(i,'ms" and "').concat(a,'ms"')),d=!1),i=f.startTime),d&&(h[r]={startTime:i,endTime:a}),t.options&&(o=e[r],s=t.options,u=t.errors,c=s.params||{},(l=Up(o)).length&&l.forEach((function(e){c.hasOwnProperty(e)||u.push("Unable to resolve the local animation param ".concat(e," in the given list of values"))})))}else t.errors.push('The provided animation property "'.concat(r,'" is not a supported CSS property for animations'))}))}))}},{key:"visitKeyframes",value:function(e,t){var n=this,r={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push("keyframes() must be placed inside of a call to animate()"),r;var a=0,i=[],o=!1,s=!1,u=0,c=e.steps.map((function(e){var r=n._makeStyleAst(e,t),c=null!=r.offset?r.offset:function(e){if("string"==typeof e)return null;var t=null;if(Array.isArray(e))e.forEach((function(e){if(im(e)&&e.hasOwnProperty("offset")){var n=e;t=parseFloat(n.offset),delete n.offset}}));else if(im(e)&&e.hasOwnProperty("offset")){var n=e;t=parseFloat(n.offset),delete n.offset}return t}(r.styles),l=0;return null!=c&&(a++,l=r.offset=c),s=s||l<0||l>1,o=o||l<u,u=l,i.push(l),r}));s&&t.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),o&&t.errors.push("Please ensure that all keyframe offsets are in order");var l=e.steps.length,h=0;a>0&&a<l?t.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==a&&(h=1/(l-1));var f=l-1,d=t.currentTime,p=t.currentAnimateTimings,m=p.duration;return c.forEach((function(e,a){var o=h>0?a==f?1:h*a:i[a],s=o*m;t.currentTime=d+p.delay+s,p.duration=s,n._validateStyleAst(e,t),e.offset=o,r.styles.push(e)})),r}},{key:"visitReference",value:function(e,t){return{type:8,animation:Yp(this,Vp(e.animation),t),options:om(e.options)}}},{key:"visitAnimateChild",value:function(e,t){return t.depCount++,{type:9,options:om(e.options)}}},{key:"visitAnimateRef",value:function(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:om(e.options)}}},{key:"visitQuery",value:function(e,t){var n=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;var a=_slicedToArray2(function(e){var t=!!e.split(/\s*,\s*/).find((function(e){return":self"==e}));return t&&(e=e.replace(tm,"")),[e=e.replace(/@\*/g,".ng-trigger").replace(/@\w+/g,(function(e){return".ng-trigger-"+e.substr(1)})).replace(/:animating/g,".ng-animating"),t]}(e.selector),2),i=a[0],o=a[1];t.currentQuerySelector=n.length?n+" "+i:i,gp(t.collectedStyles,t.currentQuerySelector,{});var s=Yp(this,Vp(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:11,selector:i,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:s,originalSelector:e.selector,options:om(e.options)}}},{key:"visitStagger",value:function(e,t){t.currentQuery||t.errors.push("stagger() can only be used inside of query()");var n="full"===e.timings?{duration:0,delay:0,easing:"full"}:Pp(e.timings,t.errors,!0);return{type:12,animation:Yp(this,Vp(e.animation),t),timings:n,options:null}}}]),e}(),am=function e(t){_classCallCheck2(this,e),this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null};function im(e){return!Array.isArray(e)&&"object"==typeof e}function om(e){var t;return e?(e=Fp(e)).params&&(e.params=(t=e.params)?Fp(t):null):e={},e}function sm(e,t,n){return{duration:e,delay:t,easing:n}}function um(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:r,duration:a,delay:i,totalTime:a+i,easing:o,subTimeline:s}}var cm=function(){function e(){_classCallCheck2(this,e),this._map=new Map}return _createClass2(e,[{key:"consume",value:function(e){var t=this._map.get(e);return t?this._map.delete(e):t=[],t}},{key:"append",value:function(e,t){var n,r=this._map.get(e);r||this._map.set(e,r=[]),(n=r).push.apply(n,_toConsumableArray(t))}},{key:"has",value:function(e){return this._map.has(e)}},{key:"clear",value:function(){this._map.clear()}}]),e}(),lm=new RegExp(":enter","g"),hm=new RegExp(":leave","g");function fm(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},s=arguments.length>7?arguments[7]:void 0,u=arguments.length>8?arguments[8]:void 0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[];return(new dm).buildKeyframes(e,t,n,r,a,i,o,s,u,c)}var dm=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"buildKeyframes",value:function(e,t,n,r,a,i,o,s,u){var c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[];u=u||new cm;var l=new mm(e,t,u,r,a,c,[]);l.options=s,l.currentTimeline.setStyles([i],null,l.errors,s),Yp(this,n,l);var h=l.timelines.filter((function(e){return e.containsAnimation()}));if(h.length&&Object.keys(o).length){var f=h[h.length-1];f.allowOnlyTimelineStyles()||f.setStyles([o],null,l.errors,s)}return h.length?h.map((function(e){return e.buildKeyframes()})):[um(t,[],[],[],0,0,"",!1)]}},{key:"visitTrigger",value:function(e,t){}},{key:"visitState",value:function(e,t){}},{key:"visitTransition",value:function(e,t){}},{key:"visitAnimateChild",value:function(e,t){var n=t.subInstructions.consume(t.element);if(n){var r=t.createSubContext(e.options),a=t.currentTimeline.currentTime,i=this._visitSubInstructions(n,r,r.options);a!=i&&t.transformIntoNewTimeline(i)}t.previousNode=e}},{key:"visitAnimateRef",value:function(e,t){var n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}},{key:"_visitSubInstructions",value:function(e,t,n){var r=t.currentTimeline.currentTime,a=null!=n.duration?Np(n.duration):null,i=null!=n.delay?Np(n.delay):null;return 0!==a&&e.forEach((function(e){var n=t.appendInstructionToTimeline(e,a,i);r=Math.max(r,n.duration+n.delay)})),r}},{key:"visitReference",value:function(e,t){t.updateOptions(e.options,!0),Yp(this,e.animation,t),t.previousNode=e}},{key:"visitSequence",value:function(e,t){var n=this,r=t.subContextCount,a=t,i=e.options;if(i&&(i.params||i.delay)&&((a=t.createSubContext(i)).transformIntoNewTimeline(),null!=i.delay)){6==a.previousNode.type&&(a.currentTimeline.snapshotCurrentStyles(),a.previousNode=pm);var o=Np(i.delay);a.delayNextStep(o)}e.steps.length&&(e.steps.forEach((function(e){return Yp(n,e,a)})),a.currentTimeline.applyStylesToKeyframe(),a.subContextCount>r&&a.transformIntoNewTimeline()),t.previousNode=e}},{key:"visitGroup",value:function(e,t){var n=this,r=[],a=t.currentTimeline.currentTime,i=e.options&&e.options.delay?Np(e.options.delay):0;e.steps.forEach((function(o){var s=t.createSubContext(e.options);i&&s.delayNextStep(i),Yp(n,o,s),a=Math.max(a,s.currentTimeline.currentTime),r.push(s.currentTimeline)})),r.forEach((function(e){return t.currentTimeline.mergeTimelineCollectedStyles(e)})),t.transformIntoNewTimeline(a),t.previousNode=e}},{key:"_visitTiming",value:function(e,t){if(e.dynamic){var n=e.strValue;return Pp(t.params?Wp(n,t.params,t.errors):n,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}},{key:"visitAnimate",value:function(e,t){var n=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),r.snapshotCurrentStyles());var a=e.style;5==a.type?this.visitKeyframes(a,t):(t.incrementTime(n.duration),this.visitStyle(a,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}},{key:"visitStyle",value:function(e,t){var n=t.currentTimeline,r=t.currentAnimateTimings;!r&&n.getCurrentStyleProperties().length&&n.forwardFrame();var a=r&&r.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(a):n.setStyles(e.styles,a,t.errors,t.options),t.previousNode=e}},{key:"visitKeyframes",value:function(e,t){var n=t.currentAnimateTimings,r=t.currentTimeline.duration,a=n.duration,i=t.createSubContext().currentTimeline;i.easing=n.easing,e.styles.forEach((function(e){i.forwardTime((e.offset||0)*a),i.setStyles(e.styles,e.easing,t.errors,t.options),i.applyStylesToKeyframe()})),t.currentTimeline.mergeTimelineCollectedStyles(i),t.transformIntoNewTimeline(r+a),t.previousNode=e}},{key:"visitQuery",value:function(e,t){var n=this,r=t.currentTimeline.currentTime,a=e.options||{},i=a.delay?Np(a.delay):0;i&&(6===t.previousNode.type||0==r&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=pm);var o=r,s=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!a.optional,t.errors);t.currentQueryTotal=s.length;var u=null;s.forEach((function(r,a){t.currentQueryIndex=a;var s=t.createSubContext(e.options,r);i&&s.delayNextStep(i),r===t.element&&(u=s.currentTimeline),Yp(n,e.animation,s),s.currentTimeline.applyStylesToKeyframe(),o=Math.max(o,s.currentTimeline.currentTime)})),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),u&&(t.currentTimeline.mergeTimelineCollectedStyles(u),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}},{key:"visitStagger",value:function(e,t){var n=t.parentContext,r=t.currentTimeline,a=e.timings,i=Math.abs(a.duration),o=i*(t.currentQueryTotal-1),s=i*t.currentQueryIndex;switch(a.duration<0?"reverse":a.easing){case"reverse":s=o-s;break;case"full":s=n.currentStaggerTime}var u=t.currentTimeline;s&&u.delayNextStep(s);var c=u.currentTime;Yp(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=r.currentTime-c+(r.startTime-n.currentTimeline.startTime)}}]),e}(),pm={},mm=function(){function e(t,n,r,a,i,o,s,u){_classCallCheck2(this,e),this._driver=t,this.element=n,this.subInstructions=r,this._enterClassName=a,this._leaveClassName=i,this.errors=o,this.timelines=s,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=pm,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=u||new vm(this._driver,n,0),s.push(this.currentTimeline)}return _createClass2(e,[{key:"updateOptions",value:function(e,t){var n=this;if(e){var r=e,a=this.options;null!=r.duration&&(a.duration=Np(r.duration)),null!=r.delay&&(a.delay=Np(r.delay));var i=r.params;if(i){var o=a.params;o||(o=this.options.params={}),Object.keys(i).forEach((function(e){t&&o.hasOwnProperty(e)||(o[e]=Wp(i[e],o,n.errors))}))}}}},{key:"_copyOptions",value:function(){var e={};if(this.options){var t=this.options.params;if(t){var n=e.params={};Object.keys(t).forEach((function(e){n[e]=t[e]}))}}return e}},{key:"createSubContext",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,a=n||this.element,i=new e(this._driver,a,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(a,r||0));return i.previousNode=this.previousNode,i.currentAnimateTimings=this.currentAnimateTimings,i.options=this._copyOptions(),i.updateOptions(t),i.currentQueryIndex=this.currentQueryIndex,i.currentQueryTotal=this.currentQueryTotal,i.parentContext=this,this.subContextCount++,i}},{key:"transformIntoNewTimeline",value:function(e){return this.previousNode=pm,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}},{key:"appendInstructionToTimeline",value:function(e,t,n){var r={duration:null!=t?t:e.duration,delay:this.currentTimeline.currentTime+(null!=n?n:0)+e.delay,easing:""},a=new gm(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(a),r}},{key:"incrementTime",value:function(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}},{key:"delayNextStep",value:function(e){e>0&&this.currentTimeline.delayNextStep(e)}},{key:"invokeQuery",value:function(e,t,n,r,a,i){var o=[];if(r&&o.push(this.element),e.length>0){e=(e=e.replace(lm,"."+this._enterClassName)).replace(hm,"."+this._leaveClassName);var s=this._driver.query(this.element,e,1!=n);0!==n&&(s=n<0?s.slice(s.length+n,s.length):s.slice(0,n)),o.push.apply(o,_toConsumableArray(s))}return a||0!=o.length||i.push('`query("'.concat(t,'")` returned zero elements. (Use `query("').concat(t,'", { optional: true })` if you wish to allow this.)')),o}},{key:"params",get:function(){return this.options.params}}]),e}(),vm=function(){function e(t,n,r,a){_classCallCheck2(this,e),this._driver=t,this.element=n,this.startTime=r,this._elementTimelineStylesLookup=a,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(n),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(n,this._localTimelineStyles)),this._loadKeyframe()}return _createClass2(e,[{key:"containsAnimation",value:function(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}},{key:"getCurrentStyleProperties",value:function(){return Object.keys(this._currentKeyframe)}},{key:"delayNextStep",value:function(e){var t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}},{key:"fork",value:function(t,n){return this.applyStylesToKeyframe(),new e(this._driver,t,n||this.currentTime,this._elementTimelineStylesLookup)}},{key:"_loadKeyframe",value:function(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}},{key:"forwardFrame",value:function(){this.duration+=1,this._loadKeyframe()}},{key:"forwardTime",value:function(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}},{key:"_updateStyle",value:function(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}},{key:"allowOnlyTimelineStyles",value:function(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}},{key:"applyEmptyStep",value:function(e){var t=this;e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach((function(e){t._backFill[e]=t._globalTimelineStyles[e]||"*",t._currentKeyframe[e]="*"})),this._currentEmptyStepKeyframe=this._currentKeyframe}},{key:"setStyles",value:function(e,t,n,r){var a=this;t&&(this._previousKeyframe.easing=t);var i=r&&r.params||{},o=function(e,t){var n,r={};return e.forEach((function(e){"*"===e?(n=n||Object.keys(t)).forEach((function(e){r[e]="*"})):Mp(e,!1,r)})),r}(e,this._globalTimelineStyles);Object.keys(o).forEach((function(e){var t=Wp(o[e],i,n);a._pendingStyles[e]=t,a._localTimelineStyles.hasOwnProperty(e)||(a._backFill[e]=a._globalTimelineStyles.hasOwnProperty(e)?a._globalTimelineStyles[e]:"*"),a._updateStyle(e,t)}))}},{key:"applyStylesToKeyframe",value:function(){var e=this,t=this._pendingStyles,n=Object.keys(t);0!=n.length&&(this._pendingStyles={},n.forEach((function(n){e._currentKeyframe[n]=t[n]})),Object.keys(this._localTimelineStyles).forEach((function(t){e._currentKeyframe.hasOwnProperty(t)||(e._currentKeyframe[t]=e._localTimelineStyles[t])})))}},{key:"snapshotCurrentStyles",value:function(){var e=this;Object.keys(this._localTimelineStyles).forEach((function(t){var n=e._localTimelineStyles[t];e._pendingStyles[t]=n,e._updateStyle(t,n)}))}},{key:"getFinalKeyframe",value:function(){return this._keyframes.get(this.duration)}},{key:"mergeTimelineCollectedStyles",value:function(e){var t=this;Object.keys(e._styleSummary).forEach((function(n){var r=t._styleSummary[n],a=e._styleSummary[n];(!r||a.time>r.time)&&t._updateStyle(n,a.value)}))}},{key:"buildKeyframes",value:function(){var e=this;this.applyStylesToKeyframe();var t=new Set,n=new Set,r=1===this._keyframes.size&&0===this.duration,a=[];this._keyframes.forEach((function(i,o){var s=Mp(i,!0);Object.keys(s).forEach((function(e){var r=s[e];"!"==r?t.add(e):"*"==r&&n.add(e)})),r||(s.offset=o/e.duration),a.push(s)}));var i=t.size?Gp(t.values()):[],o=n.size?Gp(n.values()):[];if(r){var s=a[0],u=Fp(s);s.offset=0,u.offset=1,a=[s,u]}return um(this.element,a,i,o,this.duration,this.startTime,this.easing,!1)}},{key:"currentTime",get:function(){return this.startTime+this.duration}},{key:"properties",get:function(){var e=[];for(var t in this._currentKeyframe)e.push(t);return e}}]),e}(),gm=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o,s){var u,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return _classCallCheck2(this,n),(u=t.call(this,e,r,s.delay)).element=r,u.keyframes=a,u.preStyleProps=i,u.postStyleProps=o,u._stretchStartingKeyframe=c,u.timings={duration:s.duration,delay:s.delay,easing:s.easing},u}return _createClass2(n,[{key:"containsAnimation",value:function(){return this.keyframes.length>1}},{key:"buildKeyframes",value:function(){var e=this.keyframes,t=this.timings,n=t.delay,r=t.duration,a=t.easing;if(this._stretchStartingKeyframe&&n){var i=[],o=r+n,s=n/o,u=Mp(e[0],!1);u.offset=0,i.push(u);var c=Mp(e[0],!1);c.offset=ym(s),i.push(c);for(var l=e.length-1,h=1;h<=l;h++){var f=Mp(e[h],!1);f.offset=ym((n+f.offset*r)/o),i.push(f)}r=o,n=0,a="",e=i}return um(this.element,e,this.preStyleProps,this.postStyleProps,r,n,a,!0)}}]),n}(vm);function ym(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.pow(10,t-1);return Math.round(e*n)/n}var _m=function e(){_classCallCheck2(this,e)},bm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"normalizePropertyName",value:function(e,t){return Kp(e)}},{key:"normalizeStyleValue",value:function(e,t,n,r){var a="",i=n.toString().trim();if(km[t]&&0!==n&&"0"!==n)if("number"==typeof n)a="px";else{var o=n.match(/^[+-]?[\d\.]+([a-z]*)$/);o&&0==o[1].length&&r.push("Please provide a CSS unit value for ".concat(e,":").concat(n))}return i+a}}]),n}(_m),km=function(e){var t={};return e.forEach((function(e){return t[e]=!0})),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(","));function wm(e,t,n,r,a,i,o,s,u,c,l,h,f){return{type:0,element:e,triggerName:t,isRemovalTransition:a,fromState:n,fromStyles:i,toState:r,toStyles:o,timelines:s,queriedElements:u,preStyleProps:c,postStyleProps:l,totalTime:h,errors:f}}var xm={},Cm=function(){function e(t,n,r){_classCallCheck2(this,e),this._triggerName=t,this.ast=n,this._stateStyles=r}return _createClass2(e,[{key:"match",value:function(e,t,n,r){return function(e,t,n,r,a){return e.some((function(e){return e(t,n,r,a)}))}(this.ast.matchers,e,t,n,r)}},{key:"buildStyles",value:function(e,t,n){var r=this._stateStyles["*"],a=this._stateStyles[e],i=r?r.buildStyles(t,n):{};return a?a.buildStyles(t,n):i}},{key:"build",value:function(e,t,n,r,a,i,o,s,u,c){var l=[],h=this.ast.options&&this.ast.options.params||xm,f=this.buildStyles(n,o&&o.params||xm,l),d=s&&s.params||xm,p=this.buildStyles(r,d,l),m=new Set,v=new Map,g=new Map,y="void"===r,_={params:Object.assign({},h,d)},b=c?[]:fm(e,t,this.ast.animation,a,i,f,p,_,u,l),k=0;if(b.forEach((function(e){k=Math.max(e.duration+e.delay,k)})),l.length)return wm(t,this._triggerName,n,r,y,f,p,[],[],v,g,k,l);b.forEach((function(e){var n=e.element,r=gp(v,n,{});e.preStyleProps.forEach((function(e){return r[e]=!0}));var a=gp(g,n,{});e.postStyleProps.forEach((function(e){return a[e]=!0})),n!==t&&m.add(n)}));var w=Gp(m.values());return wm(t,this._triggerName,n,r,y,f,p,b,w,v,g,k)}}]),e}(),Sm=function(){function e(t,n){_classCallCheck2(this,e),this.styles=t,this.defaultParams=n}return _createClass2(e,[{key:"buildStyles",value:function(e,t){var n={},r=Fp(this.defaultParams);return Object.keys(e).forEach((function(t){var n=e[t];null!=n&&(r[t]=n)})),this.styles.styles.forEach((function(e){if("string"!=typeof e){var a=e;Object.keys(a).forEach((function(e){var i=a[e];i.length>1&&(i=Wp(i,r,t)),n[e]=i}))}})),n}}]),e}(),Tm=function(){function e(t,n){var r=this;_classCallCheck2(this,e),this.name=t,this.ast=n,this.transitionFactories=[],this.states={},n.states.forEach((function(e){r.states[e.name]=new Sm(e.style,e.options&&e.options.params||{})})),Am(this.states,"true","1"),Am(this.states,"false","0"),n.transitions.forEach((function(e){r.transitionFactories.push(new Cm(t,e,r.states))})),this.fallbackTransition=new Cm(t,{type:1,animation:{type:2,steps:[],options:null},matchers:[function(e,t){return!0}],options:null,queryCount:0,depCount:0},this.states)}return _createClass2(e,[{key:"matchTransition",value:function(e,t,n,r){return this.transitionFactories.find((function(a){return a.match(e,t,n,r)}))||null}},{key:"matchStyles",value:function(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}},{key:"containsQueries",get:function(){return this.ast.queryCount>0}}]),e}();function Am(e,t,n){e.hasOwnProperty(t)?e.hasOwnProperty(n)||(e[n]=e[t]):e.hasOwnProperty(n)&&(e[t]=e[n])}var Em=new cm,Im=function(){function e(t,n,r){_classCallCheck2(this,e),this.bodyNode=t,this._driver=n,this._normalizer=r,this._animations={},this._playersById={},this.players=[]}return _createClass2(e,[{key:"register",value:function(e,t){var n=[],r=nm(this._driver,t,n);if(n.length)throw new Error("Unable to build the animation due to the following errors: "+n.join("\n"));this._animations[e]=r}},{key:"_buildPlayer",value:function(e,t,n){var r=e.element,a=dp(0,this._normalizer,0,e.keyframes,t,n);return this._driver.animate(r,a,e.duration,e.delay,e.easing,[],!0)}},{key:"create",value:function(e,t){var n,r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=[],o=this._animations[e],s=new Map;if(o?(n=fm(this._driver,t,o,"ng-enter","ng-leave",{},{},a,Em,i)).forEach((function(e){var t=gp(s,e.element,{});e.postStyleProps.forEach((function(e){return t[e]=null}))})):(i.push("The requested animation doesn't exist or has already been destroyed"),n=[]),i.length)throw new Error("Unable to create the animation due to the following errors: "+i.join("\n"));s.forEach((function(e,t){Object.keys(e).forEach((function(n){e[n]=r._driver.computeStyle(t,n,"*")}))}));var u=fp(n.map((function(e){var t=s.get(e.element);return r._buildPlayer(e,{},t)})));return this._playersById[e]=u,u.onDestroy((function(){return r.destroy(e)})),this.players.push(u),u}},{key:"destroy",value:function(e){var t=this._getPlayer(e);t.destroy(),delete this._playersById[e];var n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}},{key:"_getPlayer",value:function(e){var t=this._playersById[e];if(!t)throw new Error("Unable to find the timeline player referenced by "+e);return t}},{key:"listen",value:function(e,t,n,r){var a=vp(t,"","","");return pp(this._getPlayer(e),n,a,r),function(){}}},{key:"command",value:function(e,t,n,r){if("register"!=n)if("create"!=n){var a=this._getPlayer(e);switch(n){case"play":a.play();break;case"pause":a.pause();break;case"reset":a.reset();break;case"restart":a.restart();break;case"finish":a.finish();break;case"init":a.init();break;case"setPosition":a.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}else this.create(e,t,r[0]||{});else this.register(e,r[0])}}]),e}(),Rm=[],Om={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Nm={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Dm=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";_classCallCheck2(this,e),this.namespaceId=n;var r,a=t&&t.hasOwnProperty("value");if(this.value=null!=(r=a?t.value:t)?r:null,a){var i=Fp(t);delete i.value,this.options=i}else this.options={};this.options.params||(this.options.params={})}return _createClass2(e,[{key:"absorbOptions",value:function(e){var t=e.params;if(t){var n=this.options.params;Object.keys(t).forEach((function(e){null==n[e]&&(n[e]=t[e])}))}}},{key:"params",get:function(){return this.options.params}}]),e}(),Pm=new Dm("void"),Fm=function(){function e(t,n,r){_classCallCheck2(this,e),this.id=t,this.hostElement=n,this._engine=r,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,qm(n,this._hostClassName)}return _createClass2(e,[{key:"listen",value:function(e,t,n,r){var a,i=this;if(!this._triggers.hasOwnProperty(t))throw new Error('Unable to listen on the animation trigger event "'.concat(n,'" because the animation trigger "').concat(t,"\" doesn't exist!"));if(null==n||0==n.length)throw new Error('Unable to listen on the animation trigger "'.concat(t,'" because the provided event is undefined!'));if("start"!=(a=n)&&"done"!=a)throw new Error('The provided animation trigger event "'.concat(n,'" for the animation trigger "').concat(t,'" is not supported!'));var o=gp(this._elementListeners,e,[]),s={name:t,phase:n,callback:r};o.push(s);var u=gp(this._engine.statesByElement,e,{});return u.hasOwnProperty(t)||(qm(e,"ng-trigger"),qm(e,"ng-trigger-"+t),u[t]=Pm),function(){i._engine.afterFlush((function(){var e=o.indexOf(s);e>=0&&o.splice(e,1),i._triggers[t]||delete u[t]}))}}},{key:"register",value:function(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}},{key:"_getTrigger",value:function(e){var t=this._triggers[e];if(!t)throw new Error('The provided animation trigger "'.concat(e,'" has not been registered!'));return t}},{key:"trigger",value:function(e,t,n){var r=this,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this._getTrigger(t),o=new Lm(this.id,t,e),s=this._engine.statesByElement.get(e);s||(qm(e,"ng-trigger"),qm(e,"ng-trigger-"+t),this._engine.statesByElement.set(e,s={}));var u=s[t],c=new Dm(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&u&&c.absorbOptions(u.options),s[t]=c,u||(u=Pm),"void"===c.value||u.value!==c.value){var l=gp(this._engine.playersByElement,e,[]);l.forEach((function(e){e.namespaceId==r.id&&e.triggerName==t&&e.queued&&e.destroy()}));var h=i.matchTransition(u.value,c.value,e,c.params),f=!1;if(!h){if(!a)return;h=i.fallbackTransition,f=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:h,fromState:u,toState:c,player:o,isFallbackTransition:f}),f||(qm(e,"ng-animate-queued"),o.onStart((function(){Um(e,"ng-animate-queued")}))),o.onDone((function(){var t=r.players.indexOf(o);t>=0&&r.players.splice(t,1);var n=r._engine.playersByElement.get(e);if(n){var a=n.indexOf(o);a>=0&&n.splice(a,1)}})),this.players.push(o),l.push(o),o}if(!function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(var a=0;a<n.length;a++){var i=n[a];if(!t.hasOwnProperty(i)||e[i]!==t[i])return!1}return!0}(u.params,c.params)){var d=[],p=i.matchStyles(u.value,u.params,d),m=i.matchStyles(c.value,c.params,d);d.length?this._engine.reportError(d):this._engine.afterFlush((function(){jp(e,p),Bp(e,m)}))}}},{key:"deregister",value:function(e){var t=this;delete this._triggers[e],this._engine.statesByElement.forEach((function(t,n){delete t[e]})),this._elementListeners.forEach((function(n,r){t._elementListeners.set(r,n.filter((function(t){return t.name!=e})))}))}},{key:"clearElementCache",value:function(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);var t=this._engine.playersByElement.get(e);t&&(t.forEach((function(e){return e.destroy()})),this._engine.playersByElement.delete(e))}},{key:"_signalRemovalForInnerTriggers",value:function(e,t){var n=this;arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._engine.driver.query(e,".ng-trigger",!0).forEach((function(e){if(!e.__ng_removed){var r=n._engine.fetchNamespacesByElement(e);r.size?r.forEach((function(n){return n.triggerLeaveAnimation(e,t,!1,!0)})):n.clearElementCache(e)}}))}},{key:"triggerLeaveAnimation",value:function(e,t,n,r){var a=this,i=this._engine.statesByElement.get(e);if(i){var o=[];if(Object.keys(i).forEach((function(t){if(a._triggers[t]){var n=a.trigger(e,t,"void",r);n&&o.push(n)}})),o.length)return this._engine.markElementAsRemoved(this.id,e,!0,t),n&&fp(o).onDone((function(){return a._engine.processLeaveNode(e)})),!0}return!1}},{key:"prepareLeaveAnimationListeners",value:function(e){var t=this,n=this._elementListeners.get(e);if(n){var r=new Set;n.forEach((function(n){var a=n.name;if(!r.has(a)){r.add(a);var i=t._triggers[a].fallbackTransition,o=t._engine.statesByElement.get(e)[a]||Pm,s=new Dm("void"),u=new Lm(t.id,a,e);t._engine.totalQueuedPlayers++,t._queue.push({element:e,triggerName:a,transition:i,fromState:o,toState:s,player:u,isFallbackTransition:!0})}}))}}},{key:"removeNode",value:function(e,t){var n=this,r=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t,!0),!this.triggerLeaveAnimation(e,t,!0)){var a=!1;if(r.totalAnimations){var i=r.players.length?r.playersByQueriedElement.get(e):[];if(i&&i.length)a=!0;else for(var o=e;o=o.parentNode;)if(r.statesByElement.get(o)){a=!0;break}}this.prepareLeaveAnimationListeners(e),a?r.markElementAsRemoved(this.id,e,!1,t):(r.afterFlush((function(){return n.clearElementCache(e)})),r.destroyInnerAnimations(e),r._onRemovalComplete(e,t))}}},{key:"insertNode",value:function(e,t){qm(e,this._hostClassName)}},{key:"drainQueuedTransitions",value:function(e){var t=this,n=[];return this._queue.forEach((function(r){var a=r.player;if(!a.destroyed){var i=r.element,o=t._elementListeners.get(i);o&&o.forEach((function(t){if(t.name==r.triggerName){var n=vp(i,r.triggerName,r.fromState.value,r.toState.value);n._data=e,pp(r.player,t.phase,n,t.callback)}})),a.markedForDestroy?t._engine.afterFlush((function(){a.destroy()})):n.push(r)}})),this._queue=[],n.sort((function(e,n){var r=e.transition.ast.depCount,a=n.transition.ast.depCount;return 0==r||0==a?r-a:t._engine.driver.containsElement(e.element,n.element)?1:-1}))}},{key:"destroy",value:function(e){this.players.forEach((function(e){return e.destroy()})),this._signalRemovalForInnerTriggers(this.hostElement,e)}},{key:"elementContainsData",value:function(e){var t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find((function(t){return t.element===e}))||t}}]),e}(),Mm=function(){function e(t,n,r){_classCallCheck2(this,e),this.bodyNode=t,this.driver=n,this._normalizer=r,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=function(e,t){}}return _createClass2(e,[{key:"_onRemovalComplete",value:function(e,t){this.onRemovalComplete(e,t)}},{key:"createNamespace",value:function(e,t){var n=new Fm(e,t,this);return t.parentNode?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}},{key:"_balanceNamespaceList",value:function(e,t){var n=this._namespaceList.length-1;if(n>=0){for(var r=!1,a=n;a>=0;a--)if(this.driver.containsElement(this._namespaceList[a].hostElement,t)){this._namespaceList.splice(a+1,0,e),r=!0;break}r||this._namespaceList.splice(0,0,e)}else this._namespaceList.push(e);return this.namespacesByHostElement.set(t,e),e}},{key:"register",value:function(e,t){var n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}},{key:"registerTrigger",value:function(e,t,n){var r=this._namespaceLookup[e];r&&r.register(t,n)&&this.totalAnimations++}},{key:"destroy",value:function(e,t){var n=this;if(e){var r=this._fetchNamespace(e);this.afterFlush((function(){n.namespacesByHostElement.delete(r.hostElement),delete n._namespaceLookup[e];var t=n._namespaceList.indexOf(r);t>=0&&n._namespaceList.splice(t,1)})),this.afterFlushAnimationsDone((function(){return r.destroy(t)}))}}},{key:"_fetchNamespace",value:function(e){return this._namespaceLookup[e]}},{key:"fetchNamespacesByElement",value:function(e){var t=new Set,n=this.statesByElement.get(e);if(n)for(var r=Object.keys(n),a=0;a<r.length;a++){var i=n[r[a]].namespaceId;if(i){var o=this._fetchNamespace(i);o&&t.add(o)}}return t}},{key:"trigger",value:function(e,t,n,r){if(zm(t)){var a=this._fetchNamespace(e);if(a)return a.trigger(t,n,r),!0}return!1}},{key:"insertNode",value:function(e,t,n,r){if(zm(t)){var a=t.__ng_removed;if(a&&a.setForRemoval){a.setForRemoval=!1,a.setForMove=!0;var i=this.collectedLeaveElements.indexOf(t);i>=0&&this.collectedLeaveElements.splice(i,1)}if(e){var o=this._fetchNamespace(e);o&&o.insertNode(t,n)}r&&this.collectEnterElement(t)}}},{key:"collectEnterElement",value:function(e){this.collectedEnterElements.push(e)}},{key:"markElementAsDisabled",value:function(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),qm(e,"ng-animate-disabled")):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),Um(e,"ng-animate-disabled"))}},{key:"removeNode",value:function(e,t,n,r){if(zm(t)){var a=e?this._fetchNamespace(e):null;if(a?a.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),n){var i=this.namespacesByHostElement.get(t);i&&i.id!==e&&i.removeNode(t,r)}}else this._onRemovalComplete(t,r)}},{key:"markElementAsRemoved",value:function(e,t,n,r){this.collectedLeaveElements.push(t),t.__ng_removed={namespaceId:e,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1}}},{key:"listen",value:function(e,t,n,r,a){return zm(t)?this._fetchNamespace(e).listen(t,n,r,a):function(){}}},{key:"_buildInstruction",value:function(e,t,n,r,a){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,r,e.fromState.options,e.toState.options,t,a)}},{key:"destroyInnerAnimations",value:function(e){var t=this,n=this.driver.query(e,".ng-trigger",!0);n.forEach((function(e){return t.destroyActiveAnimationsForElement(e)})),0!=this.playersByQueriedElement.size&&(n=this.driver.query(e,".ng-animating",!0)).forEach((function(e){return t.finishActiveQueriedAnimationOnElement(e)}))}},{key:"destroyActiveAnimationsForElement",value:function(e){var t=this.playersByElement.get(e);t&&t.forEach((function(e){e.queued?e.markedForDestroy=!0:e.destroy()}))}},{key:"finishActiveQueriedAnimationOnElement",value:function(e){var t=this.playersByQueriedElement.get(e);t&&t.forEach((function(e){return e.finish()}))}},{key:"whenRenderingDone",value:function(){var e=this;return new Promise((function(t){if(e.players.length)return fp(e.players).onDone((function(){return t()}));t()}))}},{key:"processLeaveNode",value:function(e){var t=this,n=e.__ng_removed;if(n&&n.setForRemoval){if(e.__ng_removed=Om,n.namespaceId){this.destroyInnerAnimations(e);var r=this._fetchNamespace(n.namespaceId);r&&r.clearElementCache(e)}this._onRemovalComplete(e,n.setForRemoval)}this.driver.matchesElement(e,".ng-animate-disabled")&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach((function(e){t.markElementAsDisabled(e,!1)}))}},{key:"flush",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=[];if(this.newHostElements.size&&(this.newHostElements.forEach((function(t,n){return e._balanceNamespaceList(t,n)})),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(var r=0;r<this.collectedEnterElements.length;r++)qm(this.collectedEnterElements[r],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){var a=[];try{n=this._flushAnimations(a,t)}finally{for(var i=0;i<a.length;i++)a[i]()}}else for(var o=0;o<this.collectedLeaveElements.length;o++)this.processLeaveNode(this.collectedLeaveElements[o]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach((function(e){return e()})),this._flushFns=[],this._whenQuietFns.length){var s=this._whenQuietFns;this._whenQuietFns=[],n.length?fp(n).onDone((function(){s.forEach((function(e){return e()}))})):s.forEach((function(e){return e()}))}}},{key:"reportError",value:function(e){throw new Error("Unable to process animations due to the following failed trigger transitions\n "+e.join("\n"))}},{key:"_flushAnimations",value:function(e,t){var n=this,r=new cm,a=[],i=new Map,o=[],s=new Map,u=new Map,c=new Map,l=new Set;this.disabledNodes.forEach((function(e){l.add(e);for(var t=n.driver.query(e,".ng-animate-queued",!0),r=0;r<t.length;r++)l.add(t[r])}));var h=this.bodyNode,f=Array.from(this.statesByElement.keys()),d=Vm(f,this.collectedEnterElements),p=new Map,m=0;d.forEach((function(e,t){var n="ng-enter"+m++;p.set(t,n),e.forEach((function(e){return qm(e,n)}))}));for(var v=[],g=new Set,y=new Set,_=0;_<this.collectedLeaveElements.length;_++){var b=this.collectedLeaveElements[_],k=b.__ng_removed;k&&k.setForRemoval&&(v.push(b),g.add(b),k.hasAnimation?this.driver.query(b,".ng-star-inserted",!0).forEach((function(e){return g.add(e)})):y.add(b))}var w=new Map,x=Vm(f,Array.from(g));x.forEach((function(e,t){var n="ng-leave"+m++;w.set(t,n),e.forEach((function(e){return qm(e,n)}))})),e.push((function(){d.forEach((function(e,t){var n=p.get(t);e.forEach((function(e){return Um(e,n)}))})),x.forEach((function(e,t){var n=w.get(t);e.forEach((function(e){return Um(e,n)}))})),v.forEach((function(e){n.processLeaveNode(e)}))}));for(var C=[],S=[],T=this._namespaceList.length-1;T>=0;T--)this._namespaceList[T].drainQueuedTransitions(t).forEach((function(e){var t=e.player,i=e.element;if(C.push(t),n.collectedEnterElements.length){var l=i.__ng_removed;if(l&&l.setForMove)return void t.destroy()}var f=!h||!n.driver.containsElement(h,i),d=w.get(i),m=p.get(i),v=n._buildInstruction(e,r,m,d,f);if(v.errors&&v.errors.length)S.push(v);else{if(f)return t.onStart((function(){return jp(i,v.fromStyles)})),t.onDestroy((function(){return Bp(i,v.toStyles)})),void a.push(t);if(e.isFallbackTransition)return t.onStart((function(){return jp(i,v.fromStyles)})),t.onDestroy((function(){return Bp(i,v.toStyles)})),void a.push(t);v.timelines.forEach((function(e){return e.stretchStartingKeyframe=!0})),r.append(i,v.timelines),o.push({instruction:v,player:t,element:i}),v.queriedElements.forEach((function(e){return gp(s,e,[]).push(t)})),v.preStyleProps.forEach((function(e,t){var n=Object.keys(e);if(n.length){var r=u.get(t);r||u.set(t,r=new Set),n.forEach((function(e){return r.add(e)}))}})),v.postStyleProps.forEach((function(e,t){var n=Object.keys(e),r=c.get(t);r||c.set(t,r=new Set),n.forEach((function(e){return r.add(e)}))}))}}));if(S.length){var A=[];S.forEach((function(e){A.push("@".concat(e.triggerName," has failed due to:\n")),e.errors.forEach((function(e){return A.push("- ".concat(e,"\n"))}))})),C.forEach((function(e){return e.destroy()})),this.reportError(A)}var E=new Map,I=new Map;o.forEach((function(e){var t=e.element;r.has(t)&&(I.set(t,t),n._beforeAnimationBuild(e.player.namespaceId,e.instruction,E))})),a.forEach((function(e){var t=e.element;n._getPreviousPlayers(t,!1,e.namespaceId,e.triggerName,null).forEach((function(e){gp(E,t,[]).push(e),e.destroy()}))}));var R=v.filter((function(e){return Gm(e,u,c)})),O=new Map;jm(O,this.driver,y,c,"*").forEach((function(e){Gm(e,u,c)&&R.push(e)}));var N=new Map;d.forEach((function(e,t){jm(N,n.driver,new Set(e),u,"!")})),R.forEach((function(e){var t=O.get(e),n=N.get(e);O.set(e,Object.assign({},t,n))}));var D=[],P=[],F={};o.forEach((function(e){var t=e.element,o=e.player,s=e.instruction;if(r.has(t)){if(l.has(t))return o.onDestroy((function(){return Bp(t,s.toStyles)})),o.disabled=!0,o.overrideTotalTime(s.totalTime),void a.push(o);var u=F;if(I.size>1){for(var c=t,h=[];c=c.parentNode;){var f=I.get(c);if(f){u=f;break}h.push(c)}h.forEach((function(e){return I.set(e,u)}))}var d=n._buildAnimation(o.namespaceId,s,E,i,N,O);if(o.setRealPlayer(d),u===F)D.push(o);else{var p=n.playersByElement.get(u);p&&p.length&&(o.parentPlayer=fp(p)),a.push(o)}}else jp(t,s.fromStyles),o.onDestroy((function(){return Bp(t,s.toStyles)})),P.push(o),l.has(t)&&a.push(o)})),P.forEach((function(e){var t=i.get(e.element);if(t&&t.length){var n=fp(t);e.setRealPlayer(n)}})),a.forEach((function(e){e.parentPlayer?e.syncPlayerEvents(e.parentPlayer):e.destroy()}));for(var M=0;M<v.length;M++){var L=v[M],z=L.__ng_removed;if(Um(L,"ng-leave"),!z||!z.hasAnimation){var B=[];if(s.size){var j=s.get(L);j&&j.length&&B.push.apply(B,_toConsumableArray(j));for(var V=this.driver.query(L,".ng-animating",!0),q=0;q<V.length;q++){var U=s.get(V[q]);U&&U.length&&B.push.apply(B,_toConsumableArray(U))}}var W=B.filter((function(e){return!e.destroyed}));W.length?Wm(this,L,W):this.processLeaveNode(L)}}return v.length=0,D.forEach((function(e){n.players.push(e),e.onDone((function(){e.destroy();var t=n.players.indexOf(e);n.players.splice(t,1)})),e.play()})),D}},{key:"elementContainsData",value:function(e,t){var n=!1,r=t.__ng_removed;return r&&r.setForRemoval&&(n=!0),this.playersByElement.has(t)&&(n=!0),this.playersByQueriedElement.has(t)&&(n=!0),this.statesByElement.has(t)&&(n=!0),this._fetchNamespace(e).elementContainsData(t)||n}},{key:"afterFlush",value:function(e){this._flushFns.push(e)}},{key:"afterFlushAnimationsDone",value:function(e){this._whenQuietFns.push(e)}},{key:"_getPreviousPlayers",value:function(e,t,n,r,a){var i=[];if(t){var o=this.playersByQueriedElement.get(e);o&&(i=o)}else{var s=this.playersByElement.get(e);if(s){var u=!a||"void"==a;s.forEach((function(e){e.queued||(u||e.triggerName==r)&&i.push(e)}))}}return(n||r)&&(i=i.filter((function(e){return!(n&&n!=e.namespaceId||r&&r!=e.triggerName)}))),i}},{key:"_beforeAnimationBuild",value:function(e,t,n){var r,a=this,i=t.element,o=t.isRemovalTransition?void 0:e,s=t.isRemovalTransition?void 0:t.triggerName,u=_createForOfIteratorHelper(t.timelines);try{var c=function(){var e=r.value.element,u=e!==i,c=gp(n,e,[]);a._getPreviousPlayers(e,u,o,s,t.toState).forEach((function(e){var t=e.getRealPlayer();t.beforeDestroy&&t.beforeDestroy(),e.destroy(),c.push(e)}))};for(u.s();!(r=u.n()).done;)c()}catch(l){u.e(l)}finally{u.f()}jp(i,t.fromStyles)}},{key:"_buildAnimation",value:function(e,t,n,r,a,i){var o=this,s=t.triggerName,u=t.element,c=[],l=new Set,h=new Set,f=t.timelines.map((function(t){var f=t.element;l.add(f);var d=f.__ng_removed;if(d&&d.removedBeforeQueried)return new cp(t.duration,t.delay);var p,m,v=f!==u,g=(p=(n.get(f)||Rm).map((function(e){return e.getRealPlayer()})),m=[],function e(t,n){for(var r=0;r<t.length;r++){var a=t[r];a instanceof lp?e(a.players,n):n.push(a)}}(p,m),m).filter((function(e){return!!e.element&&e.element===f})),y=a.get(f),_=i.get(f),b=dp(0,o._normalizer,0,t.keyframes,y,_),k=o._buildPlayer(t,b,g);if(t.subTimeline&&r&&h.add(f),v){var w=new Lm(e,s,f);w.setRealPlayer(k),c.push(w)}return k}));c.forEach((function(e){gp(o.playersByQueriedElement,e.element,[]).push(e),e.onDone((function(){return function(e,t,n){var r;if(e instanceof Map){if(r=e.get(t)){if(r.length){var a=r.indexOf(n);r.splice(a,1)}0==r.length&&e.delete(t)}}else if(r=e[t]){if(r.length){var i=r.indexOf(n);r.splice(i,1)}0==r.length&&delete e[t]}return r}(o.playersByQueriedElement,e.element,e)}))})),l.forEach((function(e){return qm(e,"ng-animating")}));var d=fp(f);return d.onDestroy((function(){l.forEach((function(e){return Um(e,"ng-animating")})),Bp(u,t.toStyles)})),h.forEach((function(e){gp(r,e,[]).push(d)})),d}},{key:"_buildPlayer",value:function(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new cp(e.duration,e.delay)}},{key:"queuedPlayers",get:function(){var e=[];return this._namespaceList.forEach((function(t){t.players.forEach((function(t){t.queued&&e.push(t)}))})),e}}]),e}(),Lm=function(){function e(t,n,r){_classCallCheck2(this,e),this.namespaceId=t,this.triggerName=n,this.element=r,this._player=new cp,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}return _createClass2(e,[{key:"setRealPlayer",value:function(e){var t=this;this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach((function(n){t._queuedCallbacks[n].forEach((function(t){return pp(e,n,void 0,t)}))})),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}},{key:"getRealPlayer",value:function(){return this._player}},{key:"overrideTotalTime",value:function(e){this.totalTime=e}},{key:"syncPlayerEvents",value:function(e){var t=this,n=this._player;n.triggerCallback&&e.onStart((function(){return n.triggerCallback("start")})),e.onDone((function(){return t.finish()})),e.onDestroy((function(){return t.destroy()}))}},{key:"_queueEvent",value:function(e,t){gp(this._queuedCallbacks,e,[]).push(t)}},{key:"onDone",value:function(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}},{key:"onStart",value:function(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}},{key:"onDestroy",value:function(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}},{key:"init",value:function(){this._player.init()}},{key:"hasStarted",value:function(){return!this.queued&&this._player.hasStarted()}},{key:"play",value:function(){!this.queued&&this._player.play()}},{key:"pause",value:function(){!this.queued&&this._player.pause()}},{key:"restart",value:function(){!this.queued&&this._player.restart()}},{key:"finish",value:function(){this._player.finish()}},{key:"destroy",value:function(){this.destroyed=!0,this._player.destroy()}},{key:"reset",value:function(){!this.queued&&this._player.reset()}},{key:"setPosition",value:function(e){this.queued||this._player.setPosition(e)}},{key:"getPosition",value:function(){return this.queued?0:this._player.getPosition()}},{key:"triggerCallback",value:function(e){var t=this._player;t.triggerCallback&&t.triggerCallback(e)}}]),e}();function zm(e){return e&&1===e.nodeType}function Bm(e,t){var n=e.style.display;return e.style.display=null!=t?t:"none",n}function jm(e,t,n,r,a){var i=[];n.forEach((function(e){return i.push(Bm(e))}));var o=[];r.forEach((function(n,r){var i={};n.forEach((function(e){var n=i[e]=t.computeStyle(r,e,a);n&&0!=n.length||(r.__ng_removed=Nm,o.push(r))})),e.set(r,i)}));var s=0;return n.forEach((function(e){return Bm(e,i[s++])})),o}function Vm(e,t){var n=new Map;if(e.forEach((function(e){return n.set(e,[])})),0==t.length)return n;var r=new Set(t),a=new Map;return t.forEach((function(e){var t=function e(t){if(!t)return 1;var i=a.get(t);if(i)return i;var o=t.parentNode;return i=n.has(o)?o:r.has(o)?1:e(o),a.set(t,i),i}(e);1!==t&&n.get(t).push(e)})),n}function qm(e,t){if(e.classList)e.classList.add(t);else{var n=e.$$classes;n||(n=e.$$classes={}),n[t]=!0}}function Um(e,t){if(e.classList)e.classList.remove(t);else{var n=e.$$classes;n&&delete n[t]}}function Wm(e,t,n){fp(n).onDone((function(){return e.processLeaveNode(t)}))}function Gm(e,t,n){var r=n.get(e);if(!r)return!1;var a=t.get(e);return a?r.forEach((function(e){return a.add(e)})):t.set(e,r),n.delete(e),!0}var Hm=function(){function e(t,n,r){var a=this;_classCallCheck2(this,e),this.bodyNode=t,this._driver=n,this._triggerCache={},this.onRemovalComplete=function(e,t){},this._transitionEngine=new Mm(t,n,r),this._timelineEngine=new Im(t,n,r),this._transitionEngine.onRemovalComplete=function(e,t){return a.onRemovalComplete(e,t)}}return _createClass2(e,[{key:"registerTrigger",value:function(e,t,n,r,a){var i=e+"-"+r,o=this._triggerCache[i];if(!o){var s=[],u=nm(this._driver,a,s);if(s.length)throw new Error('The animation trigger "'.concat(r,'" has failed to build due to the following errors:\n - ').concat(s.join("\n - ")));o=function(e,t){return new Tm(e,t)}(r,u),this._triggerCache[i]=o}this._transitionEngine.registerTrigger(t,r,o)}},{key:"register",value:function(e,t){this._transitionEngine.register(e,t)}},{key:"destroy",value:function(e,t){this._transitionEngine.destroy(e,t)}},{key:"onInsert",value:function(e,t,n,r){this._transitionEngine.insertNode(e,t,n,r)}},{key:"onRemove",value:function(e,t,n,r){this._transitionEngine.removeNode(e,t,r||!1,n)}},{key:"disableAnimations",value:function(e,t){this._transitionEngine.markElementAsDisabled(e,t)}},{key:"process",value:function(e,t,n,r){if("@"==n.charAt(0)){var a=_slicedToArray2(yp(n),2),i=a[0],o=a[1];this._timelineEngine.command(i,t,o,r)}else this._transitionEngine.trigger(e,t,n,r)}},{key:"listen",value:function(e,t,n,r,a){if("@"==n.charAt(0)){var i=_slicedToArray2(yp(n),2),o=i[0],s=i[1];return this._timelineEngine.listen(o,t,s,a)}return this._transitionEngine.listen(e,t,n,r,a)}},{key:"flush",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._transitionEngine.flush(e)}},{key:"whenRenderingDone",value:function(){return this._transitionEngine.whenRenderingDone()}},{key:"players",get:function(){return this._transitionEngine.players.concat(this._timelineEngine.players)}}]),e}();function Km(e,t){var n=null,r=null;return Array.isArray(t)&&t.length?(n=Qm(t[0]),t.length>1&&(r=Qm(t[t.length-1]))):t&&(n=Qm(t)),n||r?new Xm(e,n,r):null}var Xm=function(){var e=function(){function e(t,n,r){_classCallCheck2(this,e),this._element=t,this._startStyles=n,this._endStyles=r,this._state=0;var a=e.initialStylesByElement.get(t);a||e.initialStylesByElement.set(t,a={}),this._initialStyles=a}return _createClass2(e,[{key:"start",value:function(){this._state<1&&(this._startStyles&&Bp(this._element,this._startStyles,this._initialStyles),this._state=1)}},{key:"finish",value:function(){this.start(),this._state<2&&(Bp(this._element,this._initialStyles),this._endStyles&&(Bp(this._element,this._endStyles),this._endStyles=null),this._state=1)}},{key:"destroy",value:function(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(jp(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(jp(this._element,this._endStyles),this._endStyles=null),Bp(this._element,this._initialStyles),this._state=3)}}]),e}();return e.initialStylesByElement=new WeakMap,e}();function Qm(e){for(var t=null,n=Object.keys(e),r=0;r<n.length;r++){var a=n[r];Ym(a)&&((t=t||{})[a]=e[a])}return t}function Ym(e){return"display"===e||"position"===e}var Zm=function(){function e(t,n,r,a,i,o,s){var u=this;_classCallCheck2(this,e),this._element=t,this._name=n,this._duration=r,this._delay=a,this._easing=i,this._fillMode=o,this._onDoneFn=s,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=function(e){return u._handleCallback(e)}}return _createClass2(e,[{key:"apply",value:function(){var e,t,n;e=this._element,t="".concat(this._duration,"ms ").concat(this._easing," ").concat(this._delay,"ms 1 normal ").concat(this._fillMode," ").concat(this._name),(n=rv(e,"").trim()).length&&(function(e,t){for(var n=0;n<e.length;n++)e.charAt(n)}(n),t="".concat(n,", ").concat(t)),nv(e,"",t),tv(this._element,this._eventFn,!1),this._startTime=Date.now()}},{key:"pause",value:function(){Jm(this._element,this._name,"paused")}},{key:"resume",value:function(){Jm(this._element,this._name,"running")}},{key:"setPosition",value:function(e){var t=$m(this._element,this._name);this._position=e*this._duration,nv(this._element,"Delay","-".concat(this._position,"ms"),t)}},{key:"getPosition",value:function(){return this._position}},{key:"_handleCallback",value:function(e){var t=e._ngTestManualTimestamp||Date.now(),n=1e3*parseFloat(e.elapsedTime.toFixed(3));e.animationName==this._name&&Math.max(t-this._startTime,0)>=this._delay&&n>=this._duration&&this.finish()}},{key:"finish",value:function(){this._finished||(this._finished=!0,this._onDoneFn(),tv(this._element,this._eventFn,!0))}},{key:"destroy",value:function(){var e,t,n,r;this._destroyed||(this._destroyed=!0,this.finish(),e=this._element,t=this._name,n=rv(e,"").split(","),(r=ev(n,t))>=0&&(n.splice(r,1),nv(e,"",n.join(","))))}}]),e}();function Jm(e,t,n){nv(e,"PlayState",n,$m(e,t))}function $m(e,t){var n=rv(e,"");return n.indexOf(",")>0?ev(n.split(","),t):ev([n],t)}function ev(e,t){for(var n=0;n<e.length;n++)if(e[n].indexOf(t)>=0)return n;return-1}function tv(e,t,n){n?e.removeEventListener("animationend",t):e.addEventListener("animationend",t)}function nv(e,t,n,r){var a="animation"+t;if(null!=r){var i=e.style[a];if(i.length){var o=i.split(",");o[r]=n,n=o.join(",")}}e.style[a]=n}function rv(e,t){return e.style["animation"+t]}var av=function(){function e(t,n,r,a,i,o,s,u){_classCallCheck2(this,e),this.element=t,this.keyframes=n,this.animationName=r,this._duration=a,this._delay=i,this._finalStyles=s,this._specialStyles=u,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this.currentSnapshot={},this._state=0,this.easing=o||"linear",this.totalTime=a+i,this._buildStyler()}return _createClass2(e,[{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"destroy",value:function(){this.init(),this._state>=4||(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach((function(e){return e()})),this._onDestroyFns=[])}},{key:"_flushDoneFns",value:function(){this._onDoneFns.forEach((function(e){return e()})),this._onDoneFns=[]}},{key:"_flushStartFns",value:function(){this._onStartFns.forEach((function(e){return e()})),this._onStartFns=[]}},{key:"finish",value:function(){this.init(),this._state>=3||(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}},{key:"setPosition",value:function(e){this._styler.setPosition(e)}},{key:"getPosition",value:function(){return this._styler.getPosition()}},{key:"hasStarted",value:function(){return this._state>=2}},{key:"init",value:function(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}},{key:"play",value:function(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}},{key:"pause",value:function(){this.init(),this._styler.pause()}},{key:"restart",value:function(){this.reset(),this.play()}},{key:"reset",value:function(){this._styler.destroy(),this._buildStyler(),this._styler.apply()}},{key:"_buildStyler",value:function(){var e=this;this._styler=new Zm(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",(function(){return e.finish()}))}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach((function(e){return e()})),t.length=0}},{key:"beforeDestroy",value:function(){var e=this;this.init();var t={};if(this.hasStarted()){var n=this._state>=3;Object.keys(this._finalStyles).forEach((function(r){"offset"!=r&&(t[r]=n?e._finalStyles[r]:Zp(e.element,r))}))}this.currentSnapshot=t}}]),e}(),iv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this)).element=e,a._startingStyles={},a.__initialized=!1,a._styles=Ip(r),a}return _createClass2(n,[{key:"init",value:function(){var e=this;!this.__initialized&&this._startingStyles&&(this.__initialized=!0,Object.keys(this._styles).forEach((function(t){e._startingStyles[t]=e.element.style[t]})),_get(_getPrototypeOf(n.prototype),"init",this).call(this))}},{key:"play",value:function(){var e=this;this._startingStyles&&(this.init(),Object.keys(this._styles).forEach((function(t){return e.element.style.setProperty(t,e._styles[t])})),_get(_getPrototypeOf(n.prototype),"play",this).call(this))}},{key:"destroy",value:function(){var e=this;this._startingStyles&&(Object.keys(this._startingStyles).forEach((function(t){var n=e._startingStyles[t];n?e.element.style.setProperty(t,n):e.element.style.removeProperty(t)})),this._startingStyles=null,_get(_getPrototypeOf(n.prototype),"destroy",this).call(this))}}]),n}(cp),ov=function(){function e(){_classCallCheck2(this,e),this._count=0,this._head=document.querySelector("head"),this._warningIssued=!1}return _createClass2(e,[{key:"validateStyleProperty",value:function(e){return Sp(e)}},{key:"matchesElement",value:function(e,t){return Tp(e,t)}},{key:"containsElement",value:function(e,t){return Ap(e,t)}},{key:"query",value:function(e,t,n){return Ep(e,t,n)}},{key:"computeStyle",value:function(e,t,n){return window.getComputedStyle(e)[t]}},{key:"buildKeyframeElement",value:function(e,t,n){n=n.map((function(e){return Ip(e)}));var r="@keyframes ".concat(t," {\n"),a="";n.forEach((function(e){a=" ";var t=parseFloat(e.offset);r+="".concat(a).concat(100*t,"% {\n"),a+=" ",Object.keys(e).forEach((function(t){var n=e[t];switch(t){case"offset":return;case"easing":return void(n&&(r+="".concat(a,"animation-timing-function: ").concat(n,";\n")));default:return void(r+="".concat(a).concat(t,": ").concat(n,";\n"))}})),r+=a+"}\n"})),r+="}\n";var i=document.createElement("style");return i.innerHTML=r,i}},{key:"animate",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6?arguments[6]:void 0;o&&this._notifyFaultyScrubber();var s=i.filter((function(e){return e instanceof av})),u={};Xp(n,r)&&s.forEach((function(e){var t=e.currentSnapshot;Object.keys(t).forEach((function(e){return u[e]=t[e]}))}));var c=function(e){var t={};return e&&(Array.isArray(e)?e:[e]).forEach((function(e){Object.keys(e).forEach((function(n){"offset"!=n&&"easing"!=n&&(t[n]=e[n])}))})),t}(t=Qp(e,t,u));if(0==n)return new iv(e,c);var l="gen_css_kf_"+this._count++,h=this.buildKeyframeElement(e,l,t);document.querySelector("head").appendChild(h);var f=Km(e,t),d=new av(e,t,l,n,r,a,c,f);return d.onDestroy((function(){var e;(e=h).parentNode.removeChild(e)})),d}},{key:"_notifyFaultyScrubber",value:function(){this._warningIssued||(console.warn("@angular/animations: please load the web-animations.js polyfill to allow programmatic access...\n","  visit http://bit.ly/IWukam to learn more about using the web-animation-js polyfill."),this._warningIssued=!0)}}]),e}(),sv=function(){function e(t,n,r,a){_classCallCheck2(this,e),this.element=t,this.keyframes=n,this.options=r,this._specialStyles=a,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=r.duration,this._delay=r.delay||0,this.time=this._duration+this._delay}return _createClass2(e,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach((function(e){return e()})),this._onDoneFns=[])}},{key:"init",value:function(){this._buildPlayer(),this._preparePlayerBeforeStart()}},{key:"_buildPlayer",value:function(){var e=this;if(!this._initialized){this._initialized=!0;var t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:{},this.domPlayer.addEventListener("finish",(function(){return e._onFinish()}))}}},{key:"_preparePlayerBeforeStart",value:function(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}},{key:"_triggerWebAnimation",value:function(e,t,n){return e.animate(t,n)}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"play",value:function(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach((function(e){return e()})),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}},{key:"pause",value:function(){this.init(),this.domPlayer.pause()}},{key:"finish",value:function(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}},{key:"reset",value:function(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}},{key:"_resetDomPlayerState",value:function(){this.domPlayer&&this.domPlayer.cancel()}},{key:"restart",value:function(){this.reset(),this.play()}},{key:"hasStarted",value:function(){return this._started}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach((function(e){return e()})),this._onDestroyFns=[])}},{key:"setPosition",value:function(e){this.domPlayer.currentTime=e*this.time}},{key:"getPosition",value:function(){return this.domPlayer.currentTime/this.time}},{key:"beforeDestroy",value:function(){var e=this,t={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach((function(n){"offset"!=n&&(t[n]=e._finished?e._finalKeyframe[n]:Zp(e.element,n))})),this.currentSnapshot=t}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach((function(e){return e()})),t.length=0}},{key:"totalTime",get:function(){return this._delay+this._duration}}]),e}(),uv=function(){function e(){_classCallCheck2(this,e),this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(cv().toString()),this._cssKeyframesDriver=new ov}return _createClass2(e,[{key:"validateStyleProperty",value:function(e){return Sp(e)}},{key:"matchesElement",value:function(e,t){return Tp(e,t)}},{key:"containsElement",value:function(e,t){return Ap(e,t)}},{key:"query",value:function(e,t,n){return Ep(e,t,n)}},{key:"computeStyle",value:function(e,t,n){return window.getComputedStyle(e)[t]}},{key:"overrideWebAnimationsSupport",value:function(e){this._isNativeImpl=e}},{key:"animate",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6?arguments[6]:void 0;if(!o&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(e,t,n,r,a,i);var s={duration:n,delay:r,fill:0==r?"both":"forwards"};a&&(s.easing=a);var u={},c=i.filter((function(e){return e instanceof sv}));Xp(n,r)&&c.forEach((function(e){var t=e.currentSnapshot;Object.keys(t).forEach((function(e){return u[e]=t[e]}))}));var l=Km(e,t=Qp(e,t=t.map((function(e){return Mp(e,!1)})),u));return new sv(e,t,s,l)}}]),e}();function cv(){return"undefined"!=typeof window&&void 0!==window.document&&Element.prototype.animate||{}}var lv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this))._nextAnimationId=0,a._renderer=e.createRenderer(r.body,{id:"0",encapsulation:Ue.None,styles:[],data:{animation:[]}}),a}return _createClass2(n,[{key:"build",value:function(e){var t=this._nextAnimationId.toString();this._nextAnimationId++;var n=Array.isArray(e)?op(e):e;return dv(this._renderer,null,t,"register",[n]),new hv(t,this._renderer)}}]),n}(ip),hv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this))._id=e,a._renderer=r,a}return _createClass2(n,[{key:"create",value:function(e,t){return new fv(this._id,e,t||{},this._renderer)}}]),n}(function(){return function e(){_classCallCheck2(this,e)}}()),fv=function(){function e(t,n,r,a){_classCallCheck2(this,e),this.id=t,this.element=n,this._renderer=a,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",r)}return _createClass2(e,[{key:"_listen",value:function(e,t){return this._renderer.listen(this.element,"@@".concat(this.id,":").concat(e),t)}},{key:"_command",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return dv(this._renderer,this.element,this.id,e,n)}},{key:"onDone",value:function(e){this._listen("done",e)}},{key:"onStart",value:function(e){this._listen("start",e)}},{key:"onDestroy",value:function(e){this._listen("destroy",e)}},{key:"init",value:function(){this._command("init")}},{key:"hasStarted",value:function(){return this._started}},{key:"play",value:function(){this._command("play"),this._started=!0}},{key:"pause",value:function(){this._command("pause")}},{key:"restart",value:function(){this._command("restart")}},{key:"finish",value:function(){this._command("finish")}},{key:"destroy",value:function(){this._command("destroy")}},{key:"reset",value:function(){this._command("reset")}},{key:"setPosition",value:function(e){this._command("setPosition",e)}},{key:"getPosition",value:function(){return 0}}]),e}();function dv(e,t,n,r,a){return e.setProperty(t,"@@".concat(n,":").concat(r),a)}var pv=function(){function e(t,n,r){_classCallCheck2(this,e),this.delegate=t,this.engine=n,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),n.onRemovalComplete=function(e,t){t&&t.parentNode(e)&&t.removeChild(e.parentNode,e)}}return _createClass2(e,[{key:"createRenderer",value:function(e,t){var n=this,r=this.delegate.createRenderer(e,t);if(!(e&&t&&t.data&&t.data.animation)){var a=this._rendererCache.get(r);return a||(a=new mv("",r,this.engine),this._rendererCache.set(r,a)),a}var i=t.id,o=t.id+"-"+this._currentId;return this._currentId++,this.engine.register(o,e),t.data.animation.forEach((function(t){return n.engine.registerTrigger(i,o,e,t.name,t)})),new vv(this,o,r,this.engine)}},{key:"begin",value:function(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}},{key:"_scheduleCountTask",value:function(){var e=this;this.promise.then((function(){e._microtaskId++}))}},{key:"scheduleListenerCallback",value:function(e,t,n){var r=this;e>=0&&e<this._microtaskId?this._zone.run((function(){return t(n)})):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then((function(){r._zone.run((function(){r._animationCallbacksBuffer.forEach((function(e){var t=_slicedToArray2(e,2);(0,t[0])(t[1])})),r._animationCallbacksBuffer=[]}))})),this._animationCallbacksBuffer.push([t,n]))}},{key:"end",value:function(){var e=this;this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular((function(){e._scheduleCountTask(),e.engine.flush(e._microtaskId)})),this.delegate.end&&this.delegate.end()}},{key:"whenRenderingDone",value:function(){return this.engine.whenRenderingDone()}}]),e}(),mv=function(){function e(t,n,r){_classCallCheck2(this,e),this.namespaceId=t,this.delegate=n,this.engine=r,this.destroyNode=this.delegate.destroyNode?function(e){return n.destroyNode(e)}:null}return _createClass2(e,[{key:"destroy",value:function(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}},{key:"createElement",value:function(e,t){return this.delegate.createElement(e,t)}},{key:"createComment",value:function(e){return this.delegate.createComment(e)}},{key:"createText",value:function(e){return this.delegate.createText(e)}},{key:"appendChild",value:function(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}},{key:"insertBefore",value:function(e,t,n){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,!0)}},{key:"removeChild",value:function(e,t,n){this.engine.onRemove(this.namespaceId,t,this.delegate,n)}},{key:"selectRootElement",value:function(e,t){return this.delegate.selectRootElement(e,t)}},{key:"parentNode",value:function(e){return this.delegate.parentNode(e)}},{key:"nextSibling",value:function(e){return this.delegate.nextSibling(e)}},{key:"setAttribute",value:function(e,t,n,r){this.delegate.setAttribute(e,t,n,r)}},{key:"removeAttribute",value:function(e,t,n){this.delegate.removeAttribute(e,t,n)}},{key:"addClass",value:function(e,t){this.delegate.addClass(e,t)}},{key:"removeClass",value:function(e,t){this.delegate.removeClass(e,t)}},{key:"setStyle",value:function(e,t,n,r){this.delegate.setStyle(e,t,n,r)}},{key:"removeStyle",value:function(e,t,n){this.delegate.removeStyle(e,t,n)}},{key:"setProperty",value:function(e,t,n){"@"==t.charAt(0)&&"@.disabled"==t?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}},{key:"setValue",value:function(e,t){this.delegate.setValue(e,t)}},{key:"listen",value:function(e,t,n){return this.delegate.listen(e,t,n)}},{key:"disableAnimations",value:function(e,t){this.engine.disableAnimations(e,t)}},{key:"data",get:function(){return this.delegate.data}}]),e}(),vv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this,r,a,i)).factory=e,o.namespaceId=r,o}return _createClass2(n,[{key:"setProperty",value:function(e,t,n){"@"==t.charAt(0)?"."==t.charAt(1)&&"@.disabled"==t?this.disableAnimations(e,n=void 0===n||!!n):this.engine.process(this.namespaceId,e,t.substr(1),n):this.delegate.setProperty(e,t,n)}},{key:"listen",value:function(e,t,n){var r,a,i=this;if("@"==t.charAt(0)){var o,s=function(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(e),u=t.substr(1),c="";return"@"!=u.charAt(0)&&(a=(r=u).indexOf("."),u=(o=_slicedToArray2([r.substring(0,a),r.substr(a+1)],2))[0],c=o[1]),this.engine.listen(this.namespaceId,s,u,c,(function(e){i.factory.scheduleListenerCallback(e._data||-1,n,e)}))}return this.delegate.listen(e,t,n)}}]),n}(mv),gv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){return _classCallCheck2(this,n),t.call(this,e.body,r,a)}return n}(Hm);function yv(){return"function"==typeof cv()?new uv:new ov}function _v(){return new bm}function bv(e,t,n){return new pv(e,t,n)}var kv=new Ee("AnimationModuleType"),wv=function e(){_classCallCheck2(this,e)},xv=Wn({encapsulation:2,styles:[".mat-card{transition:box-shadow 280ms cubic-bezier(.4,0,.2,1);display:block;position:relative;padding:16px;border-radius:4px}._mat-animation-noopable.mat-card{transition:none;animation:none}.mat-card .mat-divider-horizontal{position:absolute;left:0;width:100%}[dir=rtl] .mat-card .mat-divider-horizontal{left:auto;right:0}.mat-card .mat-divider-horizontal.mat-divider-inset{position:static;margin:0}[dir=rtl] .mat-card .mat-divider-horizontal.mat-divider-inset{margin-right:0}@media (-ms-high-contrast:active){.mat-card{outline:solid 1px}}.mat-card-actions,.mat-card-content,.mat-card-subtitle{display:block;margin-bottom:16px}.mat-card-title{display:block;margin-bottom:8px}.mat-card-actions{margin-left:-8px;margin-right:-8px;padding:8px 0}.mat-card-actions-align-end{display:flex;justify-content:flex-end}.mat-card-image{width:calc(100% + 32px);margin:0 -16px 16px -16px}.mat-card-footer{display:block;margin:0 -16px -16px -16px}.mat-card-actions .mat-button,.mat-card-actions .mat-raised-button,.mat-card-actions .mat-stroked-button{margin:0 8px}.mat-card-header{display:flex;flex-direction:row}.mat-card-header .mat-card-title{margin-bottom:12px}.mat-card-header-text{margin:0 16px}.mat-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;object-fit:cover}.mat-card-title-group{display:flex;justify-content:space-between}.mat-card-sm-image{width:80px;height:80px}.mat-card-md-image{width:112px;height:112px}.mat-card-lg-image{width:152px;height:152px}.mat-card-xl-image{width:240px;height:240px;margin:-8px}.mat-card-title-group>.mat-card-xl-image{margin:-8px 0 8px}@media (max-width:599px){.mat-card-title-group{margin:0}.mat-card-xl-image{margin-left:0;margin-right:0}}.mat-card-content>:first-child,.mat-card>:first-child{margin-top:0}.mat-card-content>:last-child:not(.mat-card-footer),.mat-card>:last-child:not(.mat-card-footer){margin-bottom:0}.mat-card-image:first-child{margin-top:-16px;border-top-left-radius:inherit;border-top-right-radius:inherit}.mat-card>.mat-card-actions:last-child{margin-bottom:-8px;padding-bottom:0}.mat-card-actions .mat-button:first-child,.mat-card-actions .mat-raised-button:first-child,.mat-card-actions .mat-stroked-button:first-child{margin-left:0;margin-right:0}.mat-card-subtitle:not(:first-child),.mat-card-title:not(:first-child){margin-top:-4px}.mat-card-header .mat-card-subtitle:not(:first-child){margin-top:-8px}.mat-card>.mat-card-xl-image:first-child{margin-top:-8px}.mat-card>.mat-card-xl-image:last-child{margin-bottom:-8px}"],data:{}});function Cv(e){return Yi(2,[Wi(null,0),Wi(null,1)],null,null)}var Sv=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"ngOnInit",value:function(){}}]),e}(),Tv=Wn({encapsulation:0,styles:[[""]],data:{}});function Av(e){return Yi(0,[(e()(),Pi(0,0,null,null,16,"div",[["class","container dashboard"]],null,null,null,null,null)),(e()(),Pi(1,0,null,null,2,"div",[["class","row dashboard__about"]],null,null,null,null,null)),(e()(),Pi(2,0,null,null,1,"div",[["class","col-md-12"]],null,null,null,null,null)),(e()(),Pi(3,0,null,null,0,"img",[["alt",""],["class","dashboard__about--logo"],["src","assets/image/bl-studio-logo-full-white.png"]],null,null,null,null,null)),(e()(),Pi(4,0,null,null,12,"div",[["class","row dashbaord__tiles"]],null,null,null,null,null)),(e()(),Pi(5,0,null,null,6,"div",[["class","col-md-6 dashboard__card"]],null,null,null,null,null)),(e()(),Pi(6,0,null,null,5,"mat-card",[["class","mat-card"],["routerLink","/melody"]],[[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==Vr(e,7).onClick()&&r),r}),Cv,xv)),ea(7,16384,null,0,af,[rf,Xl,[8,null],sn,nn],{routerLink:[0,"routerLink"]},null),ea(8,49152,null,0,Lf,[[2,kv]],null,null),(e()(),Pi(9,0,null,0,0,"img",[["class","dashboard__card--image"],["src","assets/image/wave1.png"]],null,null,null,null,null)),(e()(),Pi(10,0,null,0,1,"h3",[["class","dashboard__card--title"]],null,null,null,null,null)),(e()(),Ki(-1,null,["melody"])),(e()(),Pi(12,0,null,null,4,"div",[["class","col-md-6 dashboard__card"]],null,null,null,null,null)),(e()(),Pi(13,0,null,null,3,"mat-card",[["class","coming-soon mat-card"]],[[2,"_mat-animation-noopable",null]],null,null,Cv,xv)),ea(14,49152,null,0,Lf,[[2,kv]],null,null),(e()(),Pi(15,0,null,0,1,"h1",[],null,null,null,null,null)),(e()(),Ki(-1,null,["More Tools Coming Soon..."]))],(function(e,t){e(t,7,0,"/melody")}),(function(e,t){e(t,6,0,"NoopAnimations"===Vr(t,8)._animationMode),e(t,13,0,"NoopAnimations"===Vr(t,14)._animationMode)}))}var Ev,Iv=Rr("app-dashboard",Sv,(function(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"app-dashboard",[],null,null,null,Av,Tv)),ea(1,114688,null,0,Sv,[],null,null)],(function(e,t){e(t,1,0)}),null)}),{},{},[]),Rv=zd((function e(t){_classCallCheck2(this,e),this._elementRef=t}),"primary"),Ov=new Ee("mat-progress-spinner-default-options",{providedIn:"root",factory:function(){return{diameter:100}}}),Nv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o){var s;return _classCallCheck2(this,n),(s=t.call(this,e,r,a,i,o)).mode="indeterminate",s}return n}(((Ev=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o){var s;_classCallCheck2(this,n),(s=t.call(this,e))._elementRef=e,s._document=a,s._diameter=100,s._value=0,s._fallbackAnimation=!1,s.mode="determinate";var u=n._diameters;return u.has(a.head)||u.set(a.head,new Set([100])),s._fallbackAnimation=r.EDGE||r.TRIDENT,s._noopAnimations="NoopAnimations"===i&&!!o&&!o._forceAnimations,o&&(o.diameter&&(s.diameter=o.diameter),o.strokeWidth&&(s.strokeWidth=o.strokeWidth)),s}return _createClass2(n,[{key:"ngOnInit",value:function(){var e=this._elementRef.nativeElement;this._styleRoot=function(e,t){if("undefined"!=typeof window){var n=t.head;if(n&&(n.createShadowRoot||n.attachShadow)){var r=e.getRootNode?e.getRootNode():null;if(r instanceof window.ShadowRoot)return r}}return null}(e,this._document)||this._document.head,this._attachStyleNode(),e.classList.add("mat-progress-spinner-indeterminate".concat(this._fallbackAnimation?"-fallback":"","-animation"))}},{key:"_attachStyleNode",value:function(){var e=this._styleRoot,t=this._diameter,r=n._diameters,a=r.get(e);if(!a||!a.has(t)){var i=this._document.createElement("style");i.setAttribute("mat-spinner-animation",t+""),i.textContent=this._getAnimationText(),e.appendChild(i),a||(a=new Set,r.set(e,a)),a.add(t)}}},{key:"_getAnimationText",value:function(){return"\n @keyframes mat-progress-spinner-stroke-rotate-DIAMETER {\n    0%      { stroke-dashoffset: START_VALUE;  transform: rotate(0); }\n    12.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(0); }\n    12.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(72.5deg); }\n    25%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(72.5deg); }\n\n    25.0001%   { stroke-dashoffset: START_VALUE;  transform: rotate(270deg); }\n    37.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(270deg); }\n    37.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(161.5deg); }\n    50%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(161.5deg); }\n\n    50.0001%  { stroke-dashoffset: START_VALUE;  transform: rotate(180deg); }\n    62.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(180deg); }\n    62.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(251.5deg); }\n    75%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(251.5deg); }\n\n    75.0001%  { stroke-dashoffset: START_VALUE;  transform: rotate(90deg); }\n    87.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(90deg); }\n    87.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(341.5deg); }\n    100%    { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(341.5deg); }\n  }\n".replace(/START_VALUE/g,""+.95*this._strokeCircumference).replace(/END_VALUE/g,""+.2*this._strokeCircumference).replace(/DIAMETER/g,""+this.diameter)}},{key:"diameter",get:function(){return this._diameter},set:function(e){this._diameter=Wf(e),!this._fallbackAnimation&&this._styleRoot&&this._attachStyleNode()}},{key:"strokeWidth",get:function(){return this._strokeWidth||this.diameter/10},set:function(e){this._strokeWidth=Wf(e)}},{key:"value",get:function(){return"determinate"===this.mode?this._value:0},set:function(e){this._value=Math.max(0,Math.min(100,Wf(e)))}},{key:"_circleRadius",get:function(){return(this.diameter-10)/2}},{key:"_viewBox",get:function(){var e=2*this._circleRadius+this.strokeWidth;return"0 0 ".concat(e," ").concat(e)}},{key:"_strokeCircumference",get:function(){return 2*Math.PI*this._circleRadius}},{key:"_strokeDashOffset",get:function(){return"determinate"===this.mode?this._strokeCircumference*(100-this._value)/100:this._fallbackAnimation&&"indeterminate"===this.mode?.2*this._strokeCircumference:null}},{key:"_circleStrokeWidth",get:function(){return this.strokeWidth/this.diameter*100}}]),n}(Rv))._diameters=new WeakMap,Ev)),Dv=function e(){_classCallCheck2(this,e)},Pv=Wn({encapsulation:2,styles:[".mat-progress-spinner{display:block;position:relative}.mat-progress-spinner svg{position:absolute;transform:rotate(-90deg);top:0;left:0;transform-origin:center;overflow:visible}.mat-progress-spinner circle{fill:transparent;transform-origin:center;transition:stroke-dashoffset 225ms linear}._mat-animation-noopable.mat-progress-spinner circle{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate]{animation:mat-progress-spinner-linear-rotate 2s linear infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate]{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] circle{transition-property:stroke;animation-duration:4s;animation-timing-function:cubic-bezier(.35,0,.25,1);animation-iteration-count:infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] circle{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate]{animation:mat-progress-spinner-stroke-rotate-fallback 10s cubic-bezier(.87,.03,.33,1) infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate]{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] circle{transition-property:stroke}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] circle{transition:none;animation:none}@keyframes mat-progress-spinner-linear-rotate{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@keyframes mat-progress-spinner-stroke-rotate-100{0%{stroke-dashoffset:268.60617px;transform:rotate(0)}12.5%{stroke-dashoffset:56.54867px;transform:rotate(0)}12.5001%{stroke-dashoffset:56.54867px;transform:rotateX(180deg) rotate(72.5deg)}25%{stroke-dashoffset:268.60617px;transform:rotateX(180deg) rotate(72.5deg)}25.0001%{stroke-dashoffset:268.60617px;transform:rotate(270deg)}37.5%{stroke-dashoffset:56.54867px;transform:rotate(270deg)}37.5001%{stroke-dashoffset:56.54867px;transform:rotateX(180deg) rotate(161.5deg)}50%{stroke-dashoffset:268.60617px;transform:rotateX(180deg) rotate(161.5deg)}50.0001%{stroke-dashoffset:268.60617px;transform:rotate(180deg)}62.5%{stroke-dashoffset:56.54867px;transform:rotate(180deg)}62.5001%{stroke-dashoffset:56.54867px;transform:rotateX(180deg) rotate(251.5deg)}75%{stroke-dashoffset:268.60617px;transform:rotateX(180deg) rotate(251.5deg)}75.0001%{stroke-dashoffset:268.60617px;transform:rotate(90deg)}87.5%{stroke-dashoffset:56.54867px;transform:rotate(90deg)}87.5001%{stroke-dashoffset:56.54867px;transform:rotateX(180deg) rotate(341.5deg)}100%{stroke-dashoffset:268.60617px;transform:rotateX(180deg) rotate(341.5deg)}}@keyframes mat-progress-spinner-stroke-rotate-fallback{0%{transform:rotate(0)}25%{transform:rotate(1170deg)}50%{transform:rotate(2340deg)}75%{transform:rotate(3510deg)}100%{transform:rotate(4680deg)}}"],data:{}});function Fv(e){return Yi(0,[(e()(),Pi(0,0,null,null,0,":svg:circle",[["cx","50%"],["cy","50%"]],[[1,"r",0],[4,"animation-name",null],[4,"stroke-dashoffset","px"],[4,"stroke-dasharray","px"],[4,"stroke-width","%"]],null,null,null,null))],null,(function(e,t){var n=t.component;e(t,0,0,n._circleRadius,"mat-progress-spinner-stroke-rotate-"+n.diameter,n._strokeDashOffset,n._strokeCircumference,n._circleStrokeWidth)}))}function Mv(e){return Yi(0,[(e()(),Pi(0,0,null,null,0,":svg:circle",[["cx","50%"],["cy","50%"]],[[1,"r",0],[4,"stroke-dashoffset","px"],[4,"stroke-dasharray","px"],[4,"stroke-width","%"]],null,null,null,null))],null,(function(e,t){var n=t.component;e(t,0,0,n._circleRadius,n._strokeDashOffset,n._strokeCircumference,n._circleStrokeWidth)}))}function Lv(e){return Yi(2,[(e()(),Pi(0,0,null,null,5,":svg:svg",[["focusable","false"],["preserveAspectRatio","xMidYMid meet"]],[[4,"width","px"],[4,"height","px"],[1,"viewBox",0]],null,null,null,null)),ea(1,16384,null,0,Ts,[],{ngSwitch:[0,"ngSwitch"]},null),(e()(),Di(16777216,null,null,1,null,Fv)),ea(3,278528,null,0,As,[En,Tn,Ts],{ngSwitchCase:[0,"ngSwitchCase"]},null),(e()(),Di(16777216,null,null,1,null,Mv)),ea(5,278528,null,0,As,[En,Tn,Ts],{ngSwitchCase:[0,"ngSwitchCase"]},null)],(function(e,t){e(t,1,0,"indeterminate"===t.component.mode),e(t,3,0,!0),e(t,5,0,!1)}),(function(e,t){var n=t.component;e(t,0,0,n.diameter,n.diameter,n._viewBox)}))}var zv=new Ee("AdsenseConfig"),Bv=function(){function e(t,n){_classCallCheck2(this,e),this.config=t,this.platform=n,this.adRegion="page-"+Math.floor(1e4*Math.random())+1,this.className=""}return _createClass2(e,[{key:"ngOnInit",value:function(){var e,t,n,r,a,i,o,s,u,c,l,h,f,d=this.config;this.adClient=null!==(e=this.adClient)&&void 0!==e?e:d.adClient,this.adSlot=null!==(t=this.adSlot)&&void 0!==t?t:d.adSlot,this.adFormat=null!==(r=null!==(n=this.adFormat)&&void 0!==n?n:d.adFormat)&&void 0!==r?r:"auto",this.display=null!==(i=null!==(a=this.display)&&void 0!==a?a:d.display)&&void 0!==i?i:"block",this.width=null!==(o=this.width)&&void 0!==o?o:d.width,this.height=null!==(s=this.height)&&void 0!==s?s:d.height,this.layout=null!==(u=this.layout)&&void 0!==u?u:d.layout,this.layoutKey=null!==(c=this.layoutKey)&&void 0!==c?c:d.layoutKey,this.pageLevelAds=null!==(l=this.pageLevelAds)&&void 0!==l?l:d.pageLevelAds,this.adtest=null!==(h=this.adtest)&&void 0!==h?h:d.adtest,this.fullWidthResponsive=null!==(f=this.fullWidthResponsive)&&void 0!==f?f:d.fullWidthResponsive}},{key:"ngOnDestroy",value:function(){var e=this.ins.nativeElement.querySelector("iframe");e&&e.contentWindow&&(e.src="about:blank",e.remove())}},{key:"ngAfterViewInit",value:function(){Ls(this.platform)&&this.push()}},{key:"push",value:function(){var e={};if(this.pageLevelAds&&(e.google_ad_client=this.adClient,e.enable_page_level_ads=!0),window)try{(window.adsbygoogle=window.adsbygoogle||[]).push(e)}catch(qk){}}}]),e}(),jv=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,null,[{key:"forRoot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{ngModule:e,providers:[{provide:zv,useValue:t}]}}}]),e}(),Vv=Wn({encapsulation:2,styles:[],data:{}});function qv(e){return Yi(2,[Bi(402653184,1,{ins:0}),(e()(),Pi(1,0,[[1,0],["ins",1]],null,0,"ins",[],[[8,"className",0],[4,"display",null],[4,"width","px"],[4,"height","px"],[1,"data-ad-client",0],[1,"data-ad-slot",0],[1,"data-ad-format",0],[1,"data-ad-region",0],[1,"data-layout",0],[1,"data-adtest",0],[1,"data-layout-key",0],[1,"data-full-width-responsive",0]],null,null,null,null))],null,(function(e,t){var n=t.component;e(t,1,1,[gr(1,"adsbygoogle ",n.className,""),n.display,n.width,n.height,n.adClient,n.adSlot,n.adFormat,n.adRegion,n.layout,n.adtest,n.layoutKey,n.fullWidthResponsive])}))}function Uv(e,t,n,a){return r(n)&&(a=n,n=void 0),a?Uv(e,t,n).pipe(W((function(e){return u(e)?a.apply(void 0,_toConsumableArray(e)):a(e)}))):new x((function(r){!function e(t,n,r,a,i){var o;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(t)){var s=t;t.addEventListener(n,r,i),o=function(){return s.removeEventListener(n,r,i)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(t)){var u=t;t.on(n,r),o=function(){return u.off(n,r)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(t)){var c=t;t.addListener(n,r),o=function(){return c.removeListener(n,r)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var l=0,h=t.length;l<h;l++)e(t[l],n,r,a,i)}a.add(o)}(e,t,(function(e){r.next(arguments.length>1?Array.prototype.slice.call(arguments):e)}),r,n)}))}function Wv(e){return function(t){return t.lift(new Gv(e))}}var Gv=function(){function e(t){_classCallCheck2(this,e),this.notifier=t}return _createClass2(e,[{key:"call",value:function(e,t){var n=new Hv(e),r=q(n,this.notifier);return r&&!n.seenValue?(n.add(r),t.subscribe(n)):n}}]),e}(),Hv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).seenValue=!1,r}return _createClass2(n,[{key:"notifyNext",value:function(e,t,n,r,a){this.seenValue=!0,this.complete()}},{key:"notifyComplete",value:function(){}}]),n}(U),Kv=function e(){_classCallCheck2(this,e)};function Xv(e){return Error("A hint was already declared for 'align=\"".concat(e,"\"'."))}var Qv,Yv,Zv=0,Jv=function e(){_classCallCheck2(this,e),this.align="start",this.id="mat-hint-"+Zv++},$v=function e(){_classCallCheck2(this,e)},eg=0,tg=zd((function e(t){_classCallCheck2(this,e),this._elementRef=t}),"primary"),ng=new Ee("MAT_FORM_FIELD_DEFAULT_OPTIONS"),rg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o,s,u,c){var l;return _classCallCheck2(this,n),(l=t.call(this,e))._elementRef=e,l._changeDetectorRef=r,l._dir=i,l._defaults=o,l._platform=s,l._ngZone=u,l._outlineGapCalculationNeededImmediately=!1,l._outlineGapCalculationNeededOnStable=!1,l._destroyed=new R,l._showAlwaysAnimate=!1,l._subscriptAnimationState="",l._hintLabel="",l._hintLabelId="mat-hint-"+eg++,l._labelId="mat-form-field-label-"+eg++,l._previousDirection="ltr",l._labelOptions=a||{},l.floatLabel=l._labelOptions.float||"auto",l._animationsEnabled="NoopAnimations"!==c,l.appearance=o&&o.appearance?o.appearance:"legacy",l._hideRequiredMarker=!(!o||null==o.hideRequiredMarker)&&o.hideRequiredMarker,l}return _createClass2(n,[{key:"getConnectedOverlayOrigin",value:function(){return this._connectionContainerRef||this._elementRef}},{key:"ngAfterContentInit",value:function(){var e=this;this._validateControlChild();var t=this._control;t.controlType&&this._elementRef.nativeElement.classList.add("mat-form-field-type-"+t.controlType),t.stateChanges.pipe(Ru(null)).subscribe((function(){e._validatePlaceholders(),e._syncDescribedByIds(),e._changeDetectorRef.markForCheck()})),t.ngControl&&t.ngControl.valueChanges&&t.ngControl.valueChanges.pipe(Wv(this._destroyed)).subscribe((function(){return e._changeDetectorRef.markForCheck()})),this._ngZone.runOutsideAngular((function(){e._ngZone.onStable.asObservable().pipe(Wv(e._destroyed)).subscribe((function(){e._outlineGapCalculationNeededOnStable&&e.updateOutlineGap()}))})),ee(this._prefixChildren.changes,this._suffixChildren.changes).subscribe((function(){e._outlineGapCalculationNeededOnStable=!0,e._changeDetectorRef.markForCheck()})),this._hintChildren.changes.pipe(Ru(null)).subscribe((function(){e._processHints(),e._changeDetectorRef.markForCheck()})),this._errorChildren.changes.pipe(Ru(null)).subscribe((function(){e._syncDescribedByIds(),e._changeDetectorRef.markForCheck()})),this._dir&&this._dir.change.pipe(Wv(this._destroyed)).subscribe((function(){e.updateOutlineGap(),e._previousDirection=e._dir.value}))}},{key:"ngAfterContentChecked",value:function(){this._validateControlChild(),this._outlineGapCalculationNeededImmediately&&this.updateOutlineGap()}},{key:"ngAfterViewInit",value:function(){this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}},{key:"ngOnDestroy",value:function(){this._destroyed.next(),this._destroyed.complete()}},{key:"_shouldForward",value:function(e){var t=this._control?this._control.ngControl:null;return t&&t[e]}},{key:"_hasPlaceholder",value:function(){return!!(this._control&&this._control.placeholder||this._placeholderChild)}},{key:"_hasLabel",value:function(){return!!this._labelChild}},{key:"_shouldLabelFloat",value:function(){return this._canLabelFloat&&(this._control.shouldLabelFloat||this._shouldAlwaysFloat)}},{key:"_hideControlPlaceholder",value:function(){return"legacy"===this.appearance&&!this._hasLabel()||this._hasLabel()&&!this._shouldLabelFloat()}},{key:"_hasFloatingLabel",value:function(){return this._hasLabel()||"legacy"===this.appearance&&this._hasPlaceholder()}},{key:"_getDisplayedMessages",value:function(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}},{key:"_animateAndLockLabel",value:function(){var e=this;this._hasFloatingLabel()&&this._canLabelFloat&&(this._animationsEnabled&&(this._showAlwaysAnimate=!0,Uv(this._label.nativeElement,"transitionend").pipe(bu(1)).subscribe((function(){e._showAlwaysAnimate=!1}))),this.floatLabel="always",this._changeDetectorRef.markForCheck())}},{key:"_validatePlaceholders",value:function(){if(this._control.placeholder&&this._placeholderChild)throw Error("Placeholder attribute and child element were both specified.")}},{key:"_processHints",value:function(){this._validateHints(),this._syncDescribedByIds()}},{key:"_validateHints",value:function(){var e,t,n=this;this._hintChildren&&this._hintChildren.forEach((function(r){if("start"===r.align){if(e||n.hintLabel)throw Xv("start");e=r}else if("end"===r.align){if(t)throw Xv("end");t=r}}))}},{key:"_syncDescribedByIds",value:function(){if(this._control){var e=[];if("hint"===this._getDisplayedMessages()){var t=this._hintChildren?this._hintChildren.find((function(e){return"start"===e.align})):null,n=this._hintChildren?this._hintChildren.find((function(e){return"end"===e.align})):null;t?e.push(t.id):this._hintLabel&&e.push(this._hintLabelId),n&&e.push(n.id)}else this._errorChildren&&(e=this._errorChildren.map((function(e){return e.id})));this._control.setDescribedByIds(e)}}},{key:"_validateControlChild",value:function(){if(!this._control)throw Error("mat-form-field must contain a MatFormFieldControl.")}},{key:"updateOutlineGap",value:function(){var e=this._label?this._label.nativeElement:null;if("outline"===this.appearance&&e&&e.children.length&&e.textContent.trim()&&this._platform.isBrowser)if(document.documentElement.contains(this._elementRef.nativeElement)){var t=0,n=0,r=this._connectionContainerRef.nativeElement,a=r.querySelectorAll(".mat-form-field-outline-start"),i=r.querySelectorAll(".mat-form-field-outline-gap");if(this._label&&this._label.nativeElement.children.length){var o=r.getBoundingClientRect();if(0===o.width&&0===o.height)return this._outlineGapCalculationNeededOnStable=!0,void(this._outlineGapCalculationNeededImmediately=!1);var s,u=this._getStartEnd(o),c=this._getStartEnd(e.children[0].getBoundingClientRect()),l=0,h=_createForOfIteratorHelper(e.children);try{for(h.s();!(s=h.n()).done;){l+=s.value.offsetWidth}}catch(p){h.e(p)}finally{h.f()}t=c-u-5,n=l>0?.75*l+10:0}for(var f=0;f<a.length;f++)a.item(f).style.width=t+"px";for(var d=0;d<i.length;d++)i.item(d).style.width=n+"px";this._outlineGapCalculationNeededOnStable=this._outlineGapCalculationNeededImmediately=!1}else this._outlineGapCalculationNeededImmediately=!0}},{key:"_getStartEnd",value:function(e){return"rtl"===this._previousDirection?e.right:e.left}},{key:"appearance",get:function(){return this._appearance},set:function(e){var t=this._appearance;this._appearance=e||this._defaults&&this._defaults.appearance||"legacy","outline"===this._appearance&&t!==e&&(this._outlineGapCalculationNeededOnStable=!0)}},{key:"hideRequiredMarker",get:function(){return this._hideRequiredMarker},set:function(e){this._hideRequiredMarker=Uf(e)}},{key:"_shouldAlwaysFloat",get:function(){return"always"===this.floatLabel&&!this._showAlwaysAnimate}},{key:"_canLabelFloat",get:function(){return"never"!==this.floatLabel}},{key:"hintLabel",get:function(){return this._hintLabel},set:function(e){this._hintLabel=e,this._processHints()}},{key:"floatLabel",get:function(){return"legacy"!==this.appearance&&"never"===this._floatLabel?"auto":this._floatLabel},set:function(e){e!==this._floatLabel&&(this._floatLabel=e||this._labelOptions.float||"auto",this._changeDetectorRef.markForCheck())}},{key:"_control",get:function(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic},set:function(e){this._explicitFormFieldControl=e}},{key:"_labelChild",get:function(){return this._labelChildNonStatic||this._labelChildStatic}}]),n}(tg),ag=function e(){_classCallCheck2(this,e)},ig=((Yv=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"create",value:function(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}]),e}()).ngInjectableDef=ve({factory:function(){return new Yv},token:Yv,providedIn:"root"}),Yv),og=((Qv=function(){function e(t){_classCallCheck2(this,e),this._mutationObserverFactory=t,this._observedElements=new Map}return _createClass2(e,[{key:"ngOnDestroy",value:function(){var e=this;this._observedElements.forEach((function(t,n){return e._cleanupObserver(n)}))}},{key:"observe",value:function(e){var t=this,n=Kf(e);return new x((function(e){var r=t._observeElement(n).subscribe(e);return function(){r.unsubscribe(),t._unobserveElement(n)}}))}},{key:"_observeElement",value:function(e){if(this._observedElements.has(e))this._observedElements.get(e).count++;else{var t=new R,n=this._mutationObserverFactory.create((function(e){return t.next(e)}));n&&n.observe(e,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(e,{observer:n,stream:t,count:1})}return this._observedElements.get(e).stream}},{key:"_unobserveElement",value:function(e){this._observedElements.has(e)&&(this._observedElements.get(e).count--,this._observedElements.get(e).count||this._cleanupObserver(e))}},{key:"_cleanupObserver",value:function(e){if(this._observedElements.has(e)){var t=this._observedElements.get(e),n=t.observer,r=t.stream;n&&n.disconnect(),r.complete(),this._observedElements.delete(e)}}}]),e}()).ngInjectableDef=ve({factory:function(){return new Qv(Fe(ig))},token:Qv,providedIn:"root"}),Qv),sg=function(){function e(t,n,r){_classCallCheck2(this,e),this._contentObserver=t,this._elementRef=n,this._ngZone=r,this.event=new ka,this._disabled=!1,this._currentSubscription=null}return _createClass2(e,[{key:"ngAfterContentInit",value:function(){this._currentSubscription||this.disabled||this._subscribe()}},{key:"ngOnDestroy",value:function(){this._unsubscribe()}},{key:"_subscribe",value:function(){var e=this;this._unsubscribe();var t=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular((function(){e._currentSubscription=(e.debounce?t.pipe(cd(e.debounce)):t).subscribe(e.event)}))}},{key:"_unsubscribe",value:function(){this._currentSubscription&&this._currentSubscription.unsubscribe()}},{key:"disabled",get:function(){return this._disabled},set:function(e){this._disabled=Uf(e),this._disabled?this._unsubscribe():this._subscribe()}},{key:"debounce",get:function(){return this._debounce},set:function(e){this._debounce=Wf(e),this._subscribe()}}]),e}(),ug=function e(){_classCallCheck2(this,e)},cg=Wn({encapsulation:2,styles:[".mat-form-field{display:inline-block;position:relative;text-align:left}[dir=rtl] .mat-form-field{text-align:right}.mat-form-field-wrapper{position:relative}.mat-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-form-field-prefix,.mat-form-field-suffix{white-space:nowrap;flex:none;position:relative}.mat-form-field-infix{display:block;position:relative;flex:auto;min-width:0;width:180px}@media (-ms-high-contrast:active){.mat-form-field-infix{border-image:linear-gradient(transparent,transparent)}}.mat-form-field-label-wrapper{position:absolute;left:0;box-sizing:content-box;width:100%;height:100%;overflow:hidden;pointer-events:none}[dir=rtl] .mat-form-field-label-wrapper{left:auto;right:0}.mat-form-field-label{position:absolute;left:0;font:inherit;pointer-events:none;width:100%;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;transform-origin:0 0;transition:transform .4s cubic-bezier(.25,.8,.25,1),color .4s cubic-bezier(.25,.8,.25,1),width .4s cubic-bezier(.25,.8,.25,1);display:none}[dir=rtl] .mat-form-field-label{transform-origin:100% 0;left:auto;right:0}.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-label,.mat-form-field-empty.mat-form-field-label{display:block}.mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:block;transition:none}.mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-form-field-can-float .mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:block}.mat-form-field-label:not(.mat-form-field-empty){transition:none}.mat-form-field-underline{position:absolute;width:100%;pointer-events:none;transform:scaleY(1.0001)}.mat-form-field-ripple{position:absolute;left:0;width:100%;transform-origin:50%;transform:scaleX(.5);opacity:0;transition:background-color .3s cubic-bezier(.55,0,.55,.2)}.mat-form-field.mat-focused .mat-form-field-ripple,.mat-form-field.mat-form-field-invalid .mat-form-field-ripple{opacity:1;transform:scaleX(1);transition:transform .3s cubic-bezier(.25,.8,.25,1),opacity .1s cubic-bezier(.25,.8,.25,1),background-color .3s cubic-bezier(.25,.8,.25,1)}.mat-form-field-subscript-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.mat-form-field-label-wrapper .mat-icon,.mat-form-field-subscript-wrapper .mat-icon{width:1em;height:1em;font-size:inherit;vertical-align:baseline}.mat-form-field-hint-wrapper{display:flex}.mat-form-field-hint-spacer{flex:1 0 1em}.mat-error{display:block}.mat-form-field-control-wrapper{position:relative}.mat-form-field._mat-animation-noopable .mat-form-field-label,.mat-form-field._mat-animation-noopable .mat-form-field-ripple{transition:none}",".mat-form-field-appearance-fill .mat-form-field-flex{border-radius:4px 4px 0 0;padding:.75em .75em 0 .75em}@media (-ms-high-contrast:active){.mat-form-field-appearance-fill .mat-form-field-flex{outline:solid 1px}}.mat-form-field-appearance-fill .mat-form-field-underline::before{content:'';display:block;position:absolute;bottom:0;height:1px;width:100%}.mat-form-field-appearance-fill .mat-form-field-ripple{bottom:0;height:2px}@media (-ms-high-contrast:active){.mat-form-field-appearance-fill .mat-form-field-ripple{height:0;border-top:solid 2px}}.mat-form-field-appearance-fill:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity .6s cubic-bezier(.25,.8,.25,1)}.mat-form-field-appearance-fill._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}.mat-form-field-appearance-fill .mat-form-field-subscript-wrapper{padding:0 1em}",".mat-input-element{font:inherit;background:0 0;color:currentColor;border:none;outline:0;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit}.mat-input-element:-moz-ui-invalid{box-shadow:none}.mat-input-element::-ms-clear,.mat-input-element::-ms-reveal{display:none}.mat-input-element,.mat-input-element::-webkit-search-cancel-button,.mat-input-element::-webkit-search-decoration,.mat-input-element::-webkit-search-results-button,.mat-input-element::-webkit-search-results-decoration{-webkit-appearance:none}.mat-input-element::-webkit-caps-lock-indicator,.mat-input-element::-webkit-contacts-auto-fill-button,.mat-input-element::-webkit-credentials-auto-fill-button{visibility:hidden}.mat-input-element[type=date]::after,.mat-input-element[type=datetime-local]::after,.mat-input-element[type=datetime]::after,.mat-input-element[type=month]::after,.mat-input-element[type=time]::after,.mat-input-element[type=week]::after{content:' ';white-space:pre;width:1px}.mat-input-element::-webkit-calendar-picker-indicator,.mat-input-element::-webkit-clear-button,.mat-input-element::-webkit-inner-spin-button{font-size:.75em}.mat-input-element::placeholder{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:color .4s .133s cubic-bezier(.25,.8,.25,1)}.mat-input-element::placeholder:-ms-input-placeholder{-ms-user-select:text}.mat-input-element::-moz-placeholder{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:color .4s .133s cubic-bezier(.25,.8,.25,1)}.mat-input-element::-moz-placeholder:-ms-input-placeholder{-ms-user-select:text}.mat-input-element::-webkit-input-placeholder{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:color .4s .133s cubic-bezier(.25,.8,.25,1)}.mat-input-element::-webkit-input-placeholder:-ms-input-placeholder{-ms-user-select:text}.mat-input-element:-ms-input-placeholder{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;transition:color .4s .133s cubic-bezier(.25,.8,.25,1)}.mat-input-element:-ms-input-placeholder:-ms-input-placeholder{-ms-user-select:text}.mat-form-field-hide-placeholder .mat-input-element::placeholder{color:transparent!important;-webkit-text-fill-color:transparent;transition:none}.mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{color:transparent!important;-webkit-text-fill-color:transparent;transition:none}.mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{color:transparent!important;-webkit-text-fill-color:transparent;transition:none}.mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{color:transparent!important;-webkit-text-fill-color:transparent;transition:none}textarea.mat-input-element{resize:vertical;overflow:auto}textarea.mat-input-element.cdk-textarea-autosize{resize:none}textarea.mat-input-element{padding:2px 0;margin:-2px 0}select.mat-input-element{-moz-appearance:none;-webkit-appearance:none;position:relative;background-color:transparent;display:inline-flex;box-sizing:border-box;padding-top:1em;top:-1em;margin-bottom:-1em}select.mat-input-element::-ms-expand{display:none}select.mat-input-element::-moz-focus-inner{border:0}select.mat-input-element:not(:disabled){cursor:pointer}select.mat-input-element::-ms-value{color:inherit;background:0 0}@media (-ms-high-contrast:active){.mat-focused select.mat-input-element::-ms-value{color:inherit}}.mat-form-field-type-mat-native-select .mat-form-field-infix::after{content:'';width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid;position:absolute;top:50%;right:0;margin-top:-2.5px;pointer-events:none}[dir=rtl] .mat-form-field-type-mat-native-select .mat-form-field-infix::after{right:auto;left:0}.mat-form-field-type-mat-native-select .mat-input-element{padding-right:15px}[dir=rtl] .mat-form-field-type-mat-native-select .mat-input-element{padding-right:0;padding-left:15px}.mat-form-field-type-mat-native-select .mat-form-field-label-wrapper{max-width:calc(100% - 10px)}.mat-form-field-type-mat-native-select.mat-form-field-appearance-outline .mat-form-field-infix::after{margin-top:-5px}.mat-form-field-type-mat-native-select.mat-form-field-appearance-fill .mat-form-field-infix::after{margin-top:-10px}",".mat-form-field-appearance-legacy .mat-form-field-label{transform:perspective(100px);-ms-transform:none}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon{width:1em}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button{font:inherit;vertical-align:baseline}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button .mat-icon{font-size:inherit}.mat-form-field-appearance-legacy .mat-form-field-underline{height:1px}@media (-ms-high-contrast:active){.mat-form-field-appearance-legacy .mat-form-field-underline{height:0;border-top:solid 1px}}.mat-form-field-appearance-legacy .mat-form-field-ripple{top:0;height:2px;overflow:hidden}@media (-ms-high-contrast:active){.mat-form-field-appearance-legacy .mat-form-field-ripple{height:0;border-top:solid 2px}}.mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:transparent}@media (-ms-high-contrast:active){.mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px}}.mat-form-field-appearance-legacy.mat-form-field-invalid:not(.mat-focused) .mat-form-field-ripple{height:1px}",".mat-form-field-appearance-outline .mat-form-field-wrapper{margin:.25em 0}.mat-form-field-appearance-outline .mat-form-field-flex{padding:0 .75em 0 .75em;margin-top:-.25em;position:relative}.mat-form-field-appearance-outline .mat-form-field-prefix,.mat-form-field-appearance-outline .mat-form-field-suffix{top:.25em}.mat-form-field-appearance-outline .mat-form-field-outline{display:flex;position:absolute;top:.25em;left:0;right:0;bottom:0;pointer-events:none}.mat-form-field-appearance-outline .mat-form-field-outline-end,.mat-form-field-appearance-outline .mat-form-field-outline-start{border:1px solid currentColor;min-width:5px}.mat-form-field-appearance-outline .mat-form-field-outline-start{border-radius:5px 0 0 5px;border-right-style:none}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-start{border-right-style:solid;border-left-style:none;border-radius:0 5px 5px 0}.mat-form-field-appearance-outline .mat-form-field-outline-end{border-radius:0 5px 5px 0;border-left-style:none;flex-grow:1}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-end{border-left-style:solid;border-right-style:none;border-radius:5px 0 0 5px}.mat-form-field-appearance-outline .mat-form-field-outline-gap{border-radius:.000001px;border:1px solid currentColor;border-left-style:none;border-right-style:none}.mat-form-field-appearance-outline.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-outline-gap{border-top-color:transparent}.mat-form-field-appearance-outline .mat-form-field-outline-thick{opacity:0}.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-end,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-gap,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-start{border-width:2px;transition:border-color .3s cubic-bezier(.25,.8,.25,1)}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline{opacity:0;transition:opacity .1s cubic-bezier(.25,.8,.25,1)}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline-thick{opacity:1}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline{opacity:0;transition:opacity .6s cubic-bezier(.25,.8,.25,1)}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline-thick{opacity:1}.mat-form-field-appearance-outline .mat-form-field-subscript-wrapper{padding:0 1em}.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-end,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-gap,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-start,.mat-form-field-appearance-outline._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-outline{transition:none}",".mat-form-field-appearance-standard .mat-form-field-flex{padding-top:.75em}.mat-form-field-appearance-standard .mat-form-field-underline{height:1px}@media (-ms-high-contrast:active){.mat-form-field-appearance-standard .mat-form-field-underline{height:0;border-top:solid 1px}}.mat-form-field-appearance-standard .mat-form-field-ripple{bottom:0;height:2px}@media (-ms-high-contrast:active){.mat-form-field-appearance-standard .mat-form-field-ripple{height:0;border-top:2px}}.mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:transparent}@media (-ms-high-contrast:active){.mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px}}.mat-form-field-appearance-standard:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity .6s cubic-bezier(.25,.8,.25,1)}.mat-form-field-appearance-standard._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}"],data:{animation:[{type:7,name:"transitionMessages",definitions:[{type:0,name:"enter",styles:{type:6,styles:{opacity:1,transform:"translateY(0%)"},offset:null},options:void 0},{type:1,expr:"void => enter",animation:[{type:6,styles:{opacity:0,transform:"translateY(-100%)"},offset:null},{type:4,styles:null,timings:"300ms cubic-bezier(0.55, 0, 0.55, 0.2)"}],options:null}],options:{}}]}});function lg(e){return Yi(0,[(e()(),Pi(0,0,null,null,8,null,null,null,null,null,null,null)),(e()(),Pi(1,0,null,null,3,"div",[["class","mat-form-field-outline"]],null,null,null,null,null)),(e()(),Pi(2,0,null,null,0,"div",[["class","mat-form-field-outline-start"]],null,null,null,null,null)),(e()(),Pi(3,0,null,null,0,"div",[["class","mat-form-field-outline-gap"]],null,null,null,null,null)),(e()(),Pi(4,0,null,null,0,"div",[["class","mat-form-field-outline-end"]],null,null,null,null,null)),(e()(),Pi(5,0,null,null,3,"div",[["class","mat-form-field-outline mat-form-field-outline-thick"]],null,null,null,null,null)),(e()(),Pi(6,0,null,null,0,"div",[["class","mat-form-field-outline-start"]],null,null,null,null,null)),(e()(),Pi(7,0,null,null,0,"div",[["class","mat-form-field-outline-gap"]],null,null,null,null,null)),(e()(),Pi(8,0,null,null,0,"div",[["class","mat-form-field-outline-end"]],null,null,null,null,null))],null,null)}function hg(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"div",[["class","mat-form-field-prefix"]],null,null,null,null,null)),Wi(null,0)],null,null)}function fg(e){return Yi(0,[(e()(),Pi(0,0,null,null,3,null,null,null,null,null,null,null)),Wi(null,2),(e()(),Pi(2,0,null,null,1,"span",[],null,null,null,null,null)),(e()(),Ki(3,null,["",""]))],null,(function(e,t){e(t,3,0,t.component._control.placeholder)}))}function dg(e){return Yi(0,[Wi(null,3),(e()(),Di(0,null,null,0))],null,null)}function pg(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"span",[["aria-hidden","true"],["class","mat-placeholder-required mat-form-field-required-marker"]],null,null,null,null,null)),(e()(),Ki(-1,null,[" *"]))],null,null)}function mg(e){return Yi(0,[(e()(),Pi(0,0,[[4,0],["label",1]],null,8,"label",[["class","mat-form-field-label"]],[[8,"id",0],[1,"for",0],[1,"aria-owns",0],[2,"mat-empty",null],[2,"mat-form-field-empty",null],[2,"mat-accent",null],[2,"mat-warn",null]],[[null,"cdkObserveContent"]],(function(e,t,n){var r=!0;return"cdkObserveContent"===t&&(r=!1!==e.component.updateOutlineGap()&&r),r}),null,null)),ea(1,16384,null,0,Ts,[],{ngSwitch:[0,"ngSwitch"]},null),ea(2,1196032,null,0,sg,[og,nn,Ya],{disabled:[0,"disabled"]},{event:"cdkObserveContent"}),(e()(),Di(16777216,null,null,1,null,fg)),ea(4,278528,null,0,As,[En,Tn,Ts],{ngSwitchCase:[0,"ngSwitchCase"]},null),(e()(),Di(16777216,null,null,1,null,dg)),ea(6,278528,null,0,As,[En,Tn,Ts],{ngSwitchCase:[0,"ngSwitchCase"]},null),(e()(),Di(16777216,null,null,1,null,pg)),ea(8,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null)],(function(e,t){var n=t.component;e(t,1,0,n._hasLabel()),e(t,2,0,"outline"!=n.appearance),e(t,4,0,!1),e(t,6,0,!0),e(t,8,0,!n.hideRequiredMarker&&n._control.required&&!n._control.disabled)}),(function(e,t){var n=t.component;e(t,0,0,n._labelId,n._control.id,n._control.id,n._control.empty&&!n._shouldAlwaysFloat,n._control.empty&&!n._shouldAlwaysFloat,"accent"==n.color,"warn"==n.color)}))}function vg(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"div",[["class","mat-form-field-suffix"]],null,null,null,null,null)),Wi(null,4)],null,null)}function gg(e){return Yi(0,[(e()(),Pi(0,0,[[1,0],["underline",1]],null,1,"div",[["class","mat-form-field-underline"]],null,null,null,null,null)),(e()(),Pi(1,0,null,null,0,"span",[["class","mat-form-field-ripple"]],[[2,"mat-accent",null],[2,"mat-warn",null]],null,null,null,null))],null,(function(e,t){var n=t.component;e(t,1,0,"accent"==n.color,"warn"==n.color)}))}function yg(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"div",[],[[24,"@transitionMessages",0]],null,null,null,null)),Wi(null,5)],null,(function(e,t){e(t,0,0,t.component._subscriptAnimationState)}))}function _g(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"div",[["class","mat-hint"]],[[8,"id",0]],null,null,null,null)),(e()(),Ki(1,null,["",""]))],null,(function(e,t){var n=t.component;e(t,0,0,n._hintLabelId),e(t,1,0,n.hintLabel)}))}function bg(e){return Yi(0,[(e()(),Pi(0,0,null,null,5,"div",[["class","mat-form-field-hint-wrapper"]],[[24,"@transitionMessages",0]],null,null,null,null)),(e()(),Di(16777216,null,null,1,null,_g)),ea(2,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null),Wi(null,6),(e()(),Pi(4,0,null,null,0,"div",[["class","mat-form-field-hint-spacer"]],null,null,null,null,null)),Wi(null,7)],(function(e,t){e(t,2,0,t.component.hintLabel)}),(function(e,t){e(t,0,0,t.component._subscriptAnimationState)}))}function kg(e){return Yi(2,[Bi(671088640,1,{underlineRef:0}),Bi(402653184,2,{_connectionContainerRef:0}),Bi(671088640,3,{_inputContainerRef:0}),Bi(671088640,4,{_label:0}),(e()(),Pi(4,0,null,null,20,"div",[["class","mat-form-field-wrapper"]],null,null,null,null,null)),(e()(),Pi(5,0,[[2,0],["connectionContainer",1]],null,11,"div",[["class","mat-form-field-flex"]],null,[[null,"click"]],(function(e,t,n){var r=!0,a=e.component;return"click"===t&&(r=!1!==(a._control.onContainerClick&&a._control.onContainerClick(n))&&r),r}),null,null)),(e()(),Di(16777216,null,null,1,null,lg)),ea(7,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null),(e()(),Di(16777216,null,null,1,null,hg)),ea(9,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null),(e()(),Pi(10,0,[[3,0],["inputContainer",1]],null,4,"div",[["class","mat-form-field-infix"]],null,null,null,null,null)),Wi(null,1),(e()(),Pi(12,0,null,null,2,"span",[["class","mat-form-field-label-wrapper"]],null,null,null,null,null)),(e()(),Di(16777216,null,null,1,null,mg)),ea(14,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null),(e()(),Di(16777216,null,null,1,null,vg)),ea(16,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null),(e()(),Di(16777216,null,null,1,null,gg)),ea(18,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null),(e()(),Pi(19,0,null,null,5,"div",[["class","mat-form-field-subscript-wrapper"]],null,null,null,null,null)),ea(20,16384,null,0,Ts,[],{ngSwitch:[0,"ngSwitch"]},null),(e()(),Di(16777216,null,null,1,null,yg)),ea(22,278528,null,0,As,[En,Tn,Ts],{ngSwitchCase:[0,"ngSwitchCase"]},null),(e()(),Di(16777216,null,null,1,null,bg)),ea(24,278528,null,0,As,[En,Tn,Ts],{ngSwitchCase:[0,"ngSwitchCase"]},null)],(function(e,t){var n=t.component;e(t,7,0,"outline"==n.appearance),e(t,9,0,n._prefixChildren.length),e(t,14,0,n._hasFloatingLabel()),e(t,16,0,n._suffixChildren.length),e(t,18,0,"outline"!=n.appearance),e(t,20,0,n._getDisplayedMessages()),e(t,22,0,"error"),e(t,24,0,"hint")}),null)}var wg=function(){function e(t){_classCallCheck2(this,e),this.durationSelector=t}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new xg(e,this.durationSelector))}}]),e}(),xg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e)).durationSelector=r,a.hasValue=!1,a}return _createClass2(n,[{key:"_next",value:function(e){if(this.value=e,this.hasValue=!0,!this.throttled){var t;try{t=(0,this.durationSelector)(e)}catch(r){return this.destination.error(r)}var n=q(this,t);!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}}},{key:"clearThrottle",value:function(){var e=this.value,t=this.hasValue,n=this.throttled;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),t&&(this.value=null,this.hasValue=!1,this.destination.next(e))}},{key:"notifyNext",value:function(e,t,n,r){this.clearThrottle()}},{key:"notifyComplete",value:function(){this.clearThrottle()}}]),n}(U);function Cg(e){return!u(e)&&e-parseFloat(e)+1>=0}function Sg(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}function Tg(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ud;return t=function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=-1;return Cg(t)?r=Number(t)<1?1:Number(t):N(t)&&(n=t),N(n)||(n=ud),new x((function(t){var a=Cg(e)?e:+e-n.now();return n.schedule(Sg,a,{index:0,period:r,subscriber:t})}))}(e,n)},function(e){return e.lift(new wg(t))}}var Ag,Eg=td({passive:!0}),Ig=((Ag=function(){function e(t,n){_classCallCheck2(this,e),this._platform=t,this._ngZone=n,this._monitoredElements=new Map}return _createClass2(e,[{key:"monitor",value:function(e){var t=this;if(!this._platform.isBrowser)return Vs;var n=Kf(e),r=this._monitoredElements.get(n);if(r)return r.subject.asObservable();var a=new R,i="cdk-text-field-autofilled",o=function(e){"cdk-text-field-autofill-start"!==e.animationName||n.classList.contains(i)?"cdk-text-field-autofill-end"===e.animationName&&n.classList.contains(i)&&(n.classList.remove(i),t._ngZone.run((function(){return a.next({target:e.target,isAutofilled:!1})}))):(n.classList.add(i),t._ngZone.run((function(){return a.next({target:e.target,isAutofilled:!0})})))};return this._ngZone.runOutsideAngular((function(){n.addEventListener("animationstart",o,Eg),n.classList.add("cdk-text-field-autofill-monitored")})),this._monitoredElements.set(n,{subject:a,unlisten:function(){n.removeEventListener("animationstart",o,Eg)}}),a.asObservable()}},{key:"stopMonitoring",value:function(e){var t=Kf(e),n=this._monitoredElements.get(t);n&&(n.unlisten(),n.subject.complete(),t.classList.remove("cdk-text-field-autofill-monitored"),t.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(t))}},{key:"ngOnDestroy",value:function(){var e=this;this._monitoredElements.forEach((function(t,n){return e.stopMonitoring(n)}))}}]),e}()).ngInjectableDef=ve({factory:function(){return new Ag(Fe(Zf),Fe(Ya))},token:Ag,providedIn:"root"}),Ag),Rg=function e(){_classCallCheck2(this,e)},Og=["button","checkbox","file","hidden","image","radio","range","reset","submit"],Ng=0,Dg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o,s,u,c,l){var h;_classCallCheck2(this,n),(h=t.call(this,s,i,o,a))._elementRef=e,h._platform=r,h.ngControl=a,h._autofillMonitor=c,h._uid="mat-input-"+Ng++,h._isServer=!1,h._isNativeSelect=!1,h.focused=!1,h.stateChanges=new R,h.controlType="mat-input",h.autofilled=!1,h._disabled=!1,h._required=!1,h._type="text",h._readonly=!1,h._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter((function(e){return ed().has(e)}));var f=h._elementRef.nativeElement;return h._inputValueAccessor=u||f,h._previousNativeValue=h.value,h.id=h.id,r.IOS&&l.runOutsideAngular((function(){e.nativeElement.addEventListener("keyup",(function(e){var t=e.target;t.value||t.selectionStart||t.selectionEnd||(t.setSelectionRange(1,1),t.setSelectionRange(0,0))}))})),h._isServer=!h._platform.isBrowser,h._isNativeSelect="select"===f.nodeName.toLowerCase(),h._isNativeSelect&&(h.controlType=f.multiple?"mat-native-select-multiple":"mat-native-select"),h}return _createClass2(n,[{key:"ngOnInit",value:function(){var e=this;this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe((function(t){e.autofilled=t.isAutofilled,e.stateChanges.next()}))}},{key:"ngOnChanges",value:function(){this.stateChanges.next()}},{key:"ngOnDestroy",value:function(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement)}},{key:"ngDoCheck",value:function(){this.ngControl&&this.updateErrorState(),this._dirtyCheckNativeValue()}},{key:"focus",value:function(e){this._elementRef.nativeElement.focus(e)}},{key:"_focusChanged",value:function(e){e===this.focused||this.readonly&&e||(this.focused=e,this.stateChanges.next())}},{key:"_onInput",value:function(){}},{key:"_dirtyCheckNativeValue",value:function(){var e=this._elementRef.nativeElement.value;this._previousNativeValue!==e&&(this._previousNativeValue=e,this.stateChanges.next())}},{key:"_validateType",value:function(){if(Og.indexOf(this._type)>-1)throw Error('Input type "'.concat(this._type,"\" isn't supported by matInput."))}},{key:"_isNeverEmpty",value:function(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}},{key:"_isBadInput",value:function(){var e=this._elementRef.nativeElement.validity;return e&&e.badInput}},{key:"_isTextarea",value:function(){return"textarea"===this._elementRef.nativeElement.nodeName.toLowerCase()}},{key:"setDescribedByIds",value:function(e){this._ariaDescribedby=e.join(" ")}},{key:"onContainerClick",value:function(){this.focused||this.focus()}},{key:"disabled",get:function(){return this.ngControl&&null!==this.ngControl.disabled?this.ngControl.disabled:this._disabled},set:function(e){this._disabled=Uf(e),this.focused&&(this.focused=!1,this.stateChanges.next())}},{key:"id",get:function(){return this._id},set:function(e){this._id=e||this._uid}},{key:"required",get:function(){return this._required},set:function(e){this._required=Uf(e)}},{key:"type",get:function(){return this._type},set:function(e){this._type=e||"text",this._validateType(),!this._isTextarea()&&ed().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}},{key:"value",get:function(){return this._inputValueAccessor.value},set:function(e){e!==this.value&&(this._inputValueAccessor.value=e,this.stateChanges.next())}},{key:"readonly",get:function(){return this._readonly},set:function(e){this._readonly=Uf(e)}},{key:"empty",get:function(){return!(this._isNeverEmpty()||this._elementRef.nativeElement.value||this._isBadInput()||this.autofilled)}},{key:"shouldLabelFloat",get:function(){if(this._isNativeSelect){var e=this._elementRef.nativeElement,t=e.options[0];return this.focused||e.multiple||!this.empty||!!(e.selectedIndex>-1&&t&&t.label)}return this.focused||!this.empty}}]),n}(function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck2(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).errorState=!1,e.stateChanges=new R,e}return _createClass2(n,[{key:"updateErrorState",value:function(){var e=this.errorState,t=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);t!==e&&(this.errorState=t,this.stateChanges.next())}}]),n}((function e(t,n,r,a){_classCallCheck2(this,e),this._defaultErrorStateMatcher=t,this._parentForm=n,this._parentFormGroup=r,this.ngControl=a}))),Pg=function e(){_classCallCheck2(this,e)};function Fg(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;return"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&u(t[0])&&(t=t[0]),0===t.length?Vs:r?Fg(t).pipe(W((function(e){return r.apply(void 0,_toConsumableArray(e))}))):new x((function(e){return new Mg(e,t)}))}var Mg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;_classCallCheck2(this,n),(a=t.call(this,e)).sources=r,a.completed=0,a.haveValues=0;var i=r.length;a.values=new Array(i);for(var o=0;o<i;o++){var s=q(_assertThisInitialized(a),r[o],null,o);s&&a.add(s)}return a}return _createClass2(n,[{key:"notifyNext",value:function(e,t,n,r,a){this.values[n]=t,a._hasValue||(a._hasValue=!0,this.haveValues++)}},{key:"notifyComplete",value:function(e){var t=this.destination,n=this.haveValues,r=this.values,a=r.length;e._hasValue?(this.completed++,this.completed===a&&(n===a&&t.next(r),t.complete())):t.complete()}}]),n}(U),Lg=new Ee("NgValueAccessor"),zg=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"formDirective",get:function(){return null}},{key:"path",get:function(){return null}}]),n}(function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"reset",value:function(e){this.control&&this.control.reset(e)}},{key:"hasError",value:function(e,t){return!!this.control&&this.control.hasError(e,t)}},{key:"getError",value:function(e,t){return this.control?this.control.getError(e,t):null}},{key:"value",get:function(){return this.control?this.control.value:null}},{key:"valid",get:function(){return this.control?this.control.valid:null}},{key:"invalid",get:function(){return this.control?this.control.invalid:null}},{key:"pending",get:function(){return this.control?this.control.pending:null}},{key:"disabled",get:function(){return this.control?this.control.disabled:null}},{key:"enabled",get:function(){return this.control?this.control.enabled:null}},{key:"errors",get:function(){return this.control?this.control.errors:null}},{key:"pristine",get:function(){return this.control?this.control.pristine:null}},{key:"dirty",get:function(){return this.control?this.control.dirty:null}},{key:"touched",get:function(){return this.control?this.control.touched:null}},{key:"status",get:function(){return this.control?this.control.status:null}},{key:"untouched",get:function(){return this.control?this.control.untouched:null}},{key:"statusChanges",get:function(){return this.control?this.control.statusChanges:null}},{key:"valueChanges",get:function(){return this.control?this.control.valueChanges:null}},{key:"path",get:function(){return null}}]),e}());function Bg(e){return null==e||0===e.length}var jg=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Vg=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,null,[{key:"min",value:function(e){return function(t){if(Bg(t.value)||Bg(e))return null;var n=parseFloat(t.value);return!isNaN(n)&&n<e?{min:{min:e,actual:t.value}}:null}}},{key:"max",value:function(e){return function(t){if(Bg(t.value)||Bg(e))return null;var n=parseFloat(t.value);return!isNaN(n)&&n>e?{max:{max:e,actual:t.value}}:null}}},{key:"required",value:function(e){return Bg(e.value)?{required:!0}:null}},{key:"requiredTrue",value:function(e){return!0===e.value?null:{required:!0}}},{key:"email",value:function(e){return Bg(e.value)||jg.test(e.value)?null:{email:!0}}},{key:"minLength",value:function(e){return function(t){if(Bg(t.value))return null;var n=t.value?t.value.length:0;return n<e?{minlength:{requiredLength:e,actualLength:n}}:null}}},{key:"maxLength",value:function(e){return function(t){var n=t.value?t.value.length:0;return n>e?{maxlength:{requiredLength:e,actualLength:n}}:null}}},{key:"pattern",value:function(t){return t?("string"==typeof t?(r="","^"!==t.charAt(0)&&(r+="^"),r+=t,"$"!==t.charAt(t.length-1)&&(r+="$"),n=new RegExp(r)):(r=t.toString(),n=t),function(e){if(Bg(e.value))return null;var t=e.value;return n.test(t)?null:{pattern:{requiredPattern:r,actualValue:t}}}):e.nullValidator;var n,r}},{key:"nullValidator",value:function(e){return null}},{key:"compose",value:function(e){if(!e)return null;var t=e.filter(qg);return 0==t.length?null:function(e){return Wg(function(e,t){return t.map((function(t){return t(e)}))}(e,t))}}},{key:"composeAsync",value:function(e){if(!e)return null;var t=e.filter(qg);return 0==t.length?null:function(e){return Fg(function(e,t){return t.map((function(t){return t(e)}))}(e,t).map(Ug)).pipe(W(Wg))}}}]),e}();function qg(e){return null!=e}function Ug(e){var t=Gt(e)?X(e):e;if(!Ht(t))throw new Error("Expected validator to return Promise or Observable.");return t}function Wg(e){var t=e.reduce((function(e,t){return null!=t?Object.assign({},e,t):e}),{});return 0===Object.keys(t).length?null:t}function Gg(e){return e.validate?function(t){return e.validate(t)}:e}function Hg(e){return e.validate?function(t){return e.validate(t)}:e}function Kg(e,t){e||Zg(t,"Cannot find control with"),t.valueAccessor||Zg(t,"No value accessor for form control with"),e.validator=Vg.compose([e.validator,t.validator]),e.asyncValidator=Vg.composeAsync([e.asyncValidator,t.asyncValidator]),t.valueAccessor.writeValue(e.value),function(e,t){t.valueAccessor.registerOnChange((function(n){e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&Xg(e,t)}))}(e,t),function(e,t){e.registerOnChange((function(e,n){t.valueAccessor.writeValue(e),n&&t.viewToModelUpdate(e)}))}(e,t),function(e,t){t.valueAccessor.registerOnTouched((function(){e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&Xg(e,t),"submit"!==e.updateOn&&e.markAsTouched()}))}(e,t),t.valueAccessor.setDisabledState&&e.registerOnDisabledChange((function(e){t.valueAccessor.setDisabledState(e)})),t._rawValidators.forEach((function(t){t.registerOnValidatorChange&&t.registerOnValidatorChange((function(){return e.updateValueAndValidity()}))})),t._rawAsyncValidators.forEach((function(t){t.registerOnValidatorChange&&t.registerOnValidatorChange((function(){return e.updateValueAndValidity()}))}))}function Xg(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function Qg(e,t){null==e&&Zg(t,"Cannot find control with"),e.validator=Vg.compose([e.validator,t.validator]),e.asyncValidator=Vg.composeAsync([e.asyncValidator,t.asyncValidator])}function Yg(e){return Zg(e,"There is no FormControl instance attached to form control element with")}function Zg(e,t){var n;throw n=e.path.length>1?"path: '".concat(e.path.join(" -> "),"'"):e.path[0]?"name: '".concat(e.path,"'"):"unspecified name attribute",new Error("".concat(t," ").concat(n))}function Jg(e){return null!=e?Vg.compose(e.map(Gg)):null}function $g(e){return null!=e?Vg.composeAsync(e.map(Hg)):null}function ey(e,t){e._syncPendingControls(),t.forEach((function(e){var t=e.control;"submit"===t.updateOn&&t._pendingChange&&(e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1)}))}function ty(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function ny(e){var t=ay(e)?e.validators:e;return Array.isArray(t)?Jg(t):t||null}function ry(e,t){var n=ay(t)?t.asyncValidators:e;return Array.isArray(n)?$g(n):n||null}function ay(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}var iy=function(){function e(t,n){_classCallCheck2(this,e),this.validator=t,this.asyncValidator=n,this._onCollectionChange=function(){},this.pristine=!0,this.touched=!1,this._onDisabledChange=[]}return _createClass2(e,[{key:"setValidators",value:function(e){this.validator=ny(e)}},{key:"setAsyncValidators",value:function(e){this.asyncValidator=ry(e)}},{key:"clearValidators",value:function(){this.validator=null}},{key:"clearAsyncValidators",value:function(){this.asyncValidator=null}},{key:"markAsTouched",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}},{key:"markAllAsTouched",value:function(){this.markAsTouched({onlySelf:!0}),this._forEachChild((function(e){return e.markAllAsTouched()}))}},{key:"markAsUntouched",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.touched=!1,this._pendingTouched=!1,this._forEachChild((function(e){e.markAsUntouched({onlySelf:!0})})),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}},{key:"markAsDirty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}},{key:"markAsPristine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pristine=!0,this._pendingDirty=!1,this._forEachChild((function(e){e.markAsPristine({onlySelf:!0})})),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}},{key:"markAsPending",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.status="PENDING",!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}},{key:"disable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._parentMarkedDirty(e.onlySelf);this.status="DISABLED",this.errors=null,this._forEachChild((function(t){t.disable(Object.assign({},e,{onlySelf:!0}))})),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign({},e,{skipPristineCheck:t})),this._onDisabledChange.forEach((function(e){return e(!0)}))}},{key:"enable",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this._parentMarkedDirty(e.onlySelf);this.status="VALID",this._forEachChild((function(t){t.enable(Object.assign({},e,{onlySelf:!0}))})),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign({},e,{skipPristineCheck:t})),this._onDisabledChange.forEach((function(e){return e(!1)}))}},{key:"_updateAncestors",value:function(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}},{key:"setParent",value:function(e){this._parent=e}},{key:"updateValueAndValidity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),"VALID"!==this.status&&"PENDING"!==this.status||this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}},{key:"_updateTreeValidity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{emitEvent:!0};this._forEachChild((function(t){return t._updateTreeValidity(e)})),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}},{key:"_setInitialStatus",value:function(){this.status=this._allControlsDisabled()?"DISABLED":"VALID"}},{key:"_runValidator",value:function(){return this.validator?this.validator(this):null}},{key:"_runAsyncValidator",value:function(e){var t=this;if(this.asyncValidator){this.status="PENDING";var n=Ug(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe((function(n){return t.setErrors(n,{emitEvent:e})}))}}},{key:"_cancelExistingSubscription",value:function(){this._asyncValidationSubscription&&this._asyncValidationSubscription.unsubscribe()}},{key:"setErrors",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}},{key:"get",value:function(e){return function(e,t,n){return null==t?null:(t instanceof Array||(t=t.split(".")),t instanceof Array&&0===t.length?null:t.reduce((function(e,t){return e instanceof sy?e.controls.hasOwnProperty(t)?e.controls[t]:null:e instanceof uy&&e.at(t)||null}),e))}(this,e)}},{key:"getError",value:function(e,t){var n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}},{key:"hasError",value:function(e,t){return!!this.getError(e,t)}},{key:"_updateControlsErrors",value:function(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}},{key:"_initObservables",value:function(){this.valueChanges=new ka,this.statusChanges=new ka}},{key:"_calculateStatus",value:function(){return this._allControlsDisabled()?"DISABLED":this.errors?"INVALID":this._anyControlsHaveStatus("PENDING")?"PENDING":this._anyControlsHaveStatus("INVALID")?"INVALID":"VALID"}},{key:"_anyControlsHaveStatus",value:function(e){return this._anyControls((function(t){return t.status===e}))}},{key:"_anyControlsDirty",value:function(){return this._anyControls((function(e){return e.dirty}))}},{key:"_anyControlsTouched",value:function(){return this._anyControls((function(e){return e.touched}))}},{key:"_updatePristine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}},{key:"_updateTouched",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}},{key:"_isBoxedValue",value:function(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}},{key:"_registerOnCollectionChange",value:function(e){this._onCollectionChange=e}},{key:"_setUpdateStrategy",value:function(e){ay(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}},{key:"_parentMarkedDirty",value:function(e){return!e&&this._parent&&this._parent.dirty&&!this._parent._anyControlsDirty()}},{key:"parent",get:function(){return this._parent}},{key:"valid",get:function(){return"VALID"===this.status}},{key:"invalid",get:function(){return"INVALID"===this.status}},{key:"pending",get:function(){return"PENDING"==this.status}},{key:"disabled",get:function(){return"DISABLED"===this.status}},{key:"enabled",get:function(){return"DISABLED"!==this.status}},{key:"dirty",get:function(){return!this.pristine}},{key:"untouched",get:function(){return!this.touched}},{key:"updateOn",get:function(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}},{key:"root",get:function(){for(var e=this;e._parent;)e=e._parent;return e}}]),e}(),oy=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return _classCallCheck2(this,n),(e=t.call(this,ny(a),ry(i,a)))._onChange=[],e._applyFormState(r),e._setUpdateStrategy(a),e.updateValueAndValidity({onlySelf:!0,emitEvent:!1}),e._initObservables(),e}return _createClass2(n,[{key:"setValue",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.value=this._pendingValue=e,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach((function(e){return e(t.value,!1!==n.emitViewToModelChange)})),this.updateValueAndValidity(n)}},{key:"patchValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.setValue(e,t)}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}},{key:"_updateValue",value:function(){}},{key:"_anyControls",value:function(e){return!1}},{key:"_allControlsDisabled",value:function(){return this.disabled}},{key:"registerOnChange",value:function(e){this._onChange.push(e)}},{key:"_clearChangeFns",value:function(){this._onChange=[],this._onDisabledChange=[],this._onCollectionChange=function(){}}},{key:"registerOnDisabledChange",value:function(e){this._onDisabledChange.push(e)}},{key:"_forEachChild",value:function(e){}},{key:"_syncPendingControls",value:function(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}},{key:"_applyFormState",value:function(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}]),n}(iy),sy=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,ny(r),ry(a,r))).controls=e,i._initObservables(),i._setUpdateStrategy(r),i._setUpControls(),i.updateValueAndValidity({onlySelf:!0,emitEvent:!1}),i}return _createClass2(n,[{key:"registerControl",value:function(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}},{key:"addControl",value:function(e,t){this.registerControl(e,t),this.updateValueAndValidity(),this._onCollectionChange()}},{key:"removeControl",value:function(e){this.controls[e]&&this.controls[e]._registerOnCollectionChange((function(){})),delete this.controls[e],this.updateValueAndValidity(),this._onCollectionChange()}},{key:"setControl",value:function(e,t){this.controls[e]&&this.controls[e]._registerOnCollectionChange((function(){})),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity(),this._onCollectionChange()}},{key:"contains",value:function(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}},{key:"setValue",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkAllValuesPresent(e),Object.keys(e).forEach((function(r){t._throwIfControlMissing(r),t.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:n.emitEvent})})),this.updateValueAndValidity(n)}},{key:"patchValue",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.keys(e).forEach((function(r){t.controls[r]&&t.controls[r].patchValue(e[r],{onlySelf:!0,emitEvent:n.emitEvent})})),this.updateValueAndValidity(n)}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._forEachChild((function(n,r){n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})})),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}},{key:"getRawValue",value:function(){return this._reduceChildren({},(function(e,t,n){return e[n]=t instanceof oy?t.value:t.getRawValue(),e}))}},{key:"_syncPendingControls",value:function(){var e=this._reduceChildren(!1,(function(e,t){return!!t._syncPendingControls()||e}));return e&&this.updateValueAndValidity({onlySelf:!0}),e}},{key:"_throwIfControlMissing",value:function(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error("Cannot find form control with name: ".concat(e,"."))}},{key:"_forEachChild",value:function(e){var t=this;Object.keys(this.controls).forEach((function(n){return e(t.controls[n],n)}))}},{key:"_setUpControls",value:function(){var e=this;this._forEachChild((function(t){t.setParent(e),t._registerOnCollectionChange(e._onCollectionChange)}))}},{key:"_updateValue",value:function(){this.value=this._reduceValue()}},{key:"_anyControls",value:function(e){var t=this,n=!1;return this._forEachChild((function(r,a){n=n||t.contains(a)&&e(r)})),n}},{key:"_reduceValue",value:function(){var e=this;return this._reduceChildren({},(function(t,n,r){return(n.enabled||e.disabled)&&(t[r]=n.value),t}))}},{key:"_reduceChildren",value:function(e,t){var n=e;return this._forEachChild((function(e,r){n=t(n,e,r)})),n}},{key:"_allControlsDisabled",value:function(){for(var e=0,t=Object.keys(this.controls);e<t.length;e++){var n=t[e];if(this.controls[n].enabled)return!1}return Object.keys(this.controls).length>0||this.disabled}},{key:"_checkAllValuesPresent",value:function(e){this._forEachChild((function(t,n){if(void 0===e[n])throw new Error("Must supply a value for form control with name: '".concat(n,"'."))}))}}]),n}(iy),uy=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,ny(r),ry(a,r))).controls=e,i._initObservables(),i._setUpdateStrategy(r),i._setUpControls(),i.updateValueAndValidity({onlySelf:!0,emitEvent:!1}),i}return _createClass2(n,[{key:"at",value:function(e){return this.controls[e]}},{key:"push",value:function(e){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity(),this._onCollectionChange()}},{key:"insert",value:function(e,t){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity()}},{key:"removeAt",value:function(e){this.controls[e]&&this.controls[e]._registerOnCollectionChange((function(){})),this.controls.splice(e,1),this.updateValueAndValidity()}},{key:"setControl",value:function(e,t){this.controls[e]&&this.controls[e]._registerOnCollectionChange((function(){})),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity(),this._onCollectionChange()}},{key:"setValue",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkAllValuesPresent(e),e.forEach((function(e,r){t._throwIfControlMissing(r),t.at(r).setValue(e,{onlySelf:!0,emitEvent:n.emitEvent})})),this.updateValueAndValidity(n)}},{key:"patchValue",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.forEach((function(e,r){t.at(r)&&t.at(r).patchValue(e,{onlySelf:!0,emitEvent:n.emitEvent})})),this.updateValueAndValidity(n)}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._forEachChild((function(n,r){n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})})),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}},{key:"getRawValue",value:function(){return this.controls.map((function(e){return e instanceof oy?e.value:e.getRawValue()}))}},{key:"clear",value:function(){this.controls.length<1||(this._forEachChild((function(e){return e._registerOnCollectionChange((function(){}))})),this.controls.splice(0),this.updateValueAndValidity())}},{key:"_syncPendingControls",value:function(){var e=this.controls.reduce((function(e,t){return!!t._syncPendingControls()||e}),!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}},{key:"_throwIfControlMissing",value:function(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet.  If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error("Cannot find form control at index "+e)}},{key:"_forEachChild",value:function(e){this.controls.forEach((function(t,n){e(t,n)}))}},{key:"_updateValue",value:function(){var e=this;this.value=this.controls.filter((function(t){return t.enabled||e.disabled})).map((function(e){return e.value}))}},{key:"_anyControls",value:function(e){return this.controls.some((function(t){return t.enabled&&e(t)}))}},{key:"_setUpControls",value:function(){var e=this;this._forEachChild((function(t){return e._registerControl(t)}))}},{key:"_checkAllValuesPresent",value:function(e){this._forEachChild((function(t,n){if(void 0===e[n])throw new Error("Must supply a value for form control at index: ".concat(n,"."))}))}},{key:"_allControlsDisabled",value:function(){var e,t=_createForOfIteratorHelper(this.controls);try{for(t.s();!(e=t.n()).done;){if(e.value.enabled)return!1}}catch(n){t.e(n)}finally{t.f()}return this.controls.length>0||this.disabled}},{key:"_registerControl",value:function(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}},{key:"length",get:function(){return this.controls.length}}]),n}(iy),cy=Promise.resolve(null),ly=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this)).submitted=!1,a._directives=[],a.ngSubmit=new ka,a.form=new sy({},Jg(e),$g(r)),a}return _createClass2(n,[{key:"ngAfterViewInit",value:function(){this._setUpdateStrategy()}},{key:"addControl",value:function(e){var t=this;cy.then((function(){var n=t._findContainer(e.path);e.control=n.registerControl(e.name,e.control),Kg(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),t._directives.push(e)}))}},{key:"getControl",value:function(e){return this.form.get(e.path)}},{key:"removeControl",value:function(e){var t=this;cy.then((function(){var n=t._findContainer(e.path);n&&n.removeControl(e.name),ty(t._directives,e)}))}},{key:"addFormGroup",value:function(e){var t=this;cy.then((function(){var n=t._findContainer(e.path),r=new sy({});Qg(r,e),n.registerControl(e.name,r),r.updateValueAndValidity({emitEvent:!1})}))}},{key:"removeFormGroup",value:function(e){var t=this;cy.then((function(){var n=t._findContainer(e.path);n&&n.removeControl(e.name)}))}},{key:"getFormGroup",value:function(e){return this.form.get(e.path)}},{key:"updateModel",value:function(e,t){var n=this;cy.then((function(){n.form.get(e.path).setValue(t)}))}},{key:"setValue",value:function(e){this.control.setValue(e)}},{key:"onSubmit",value:function(e){return this.submitted=!0,ey(this.form,this._directives),this.ngSubmit.emit(e),!1}},{key:"onReset",value:function(){this.resetForm()}},{key:"resetForm",value:function(e){this.form.reset(e),this.submitted=!1}},{key:"_setUpdateStrategy",value:function(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}},{key:"_findContainer",value:function(e){return e.pop(),e.length?this.form.get(e):this.form}},{key:"formDirective",get:function(){return this}},{key:"control",get:function(){return this.form}},{key:"path",get:function(){return[]}},{key:"controls",get:function(){return this.form.controls}}]),n}(zg),hy=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this))._validators=e,a._asyncValidators=r,a.submitted=!1,a.directives=[],a.form=null,a.ngSubmit=new ka,a}return _createClass2(n,[{key:"ngOnChanges",value:function(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations())}},{key:"addControl",value:function(e){var t=this.form.get(e.path);return Kg(t,e),t.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),t}},{key:"getControl",value:function(e){return this.form.get(e.path)}},{key:"removeControl",value:function(e){ty(this.directives,e)}},{key:"addFormGroup",value:function(e){var t=this.form.get(e.path);Qg(t,e),t.updateValueAndValidity({emitEvent:!1})}},{key:"removeFormGroup",value:function(e){}},{key:"getFormGroup",value:function(e){return this.form.get(e.path)}},{key:"addFormArray",value:function(e){var t=this.form.get(e.path);Qg(t,e),t.updateValueAndValidity({emitEvent:!1})}},{key:"removeFormArray",value:function(e){}},{key:"getFormArray",value:function(e){return this.form.get(e.path)}},{key:"updateModel",value:function(e,t){this.form.get(e.path).setValue(t)}},{key:"onSubmit",value:function(e){return this.submitted=!0,ey(this.form,this.directives),this.ngSubmit.emit(e),!1}},{key:"onReset",value:function(){this.resetForm()}},{key:"resetForm",value:function(e){this.form.reset(e),this.submitted=!1}},{key:"_updateDomValue",value:function(){var e=this;this.directives.forEach((function(t){var n=e.form.get(t.path);t.control!==n&&(function(e,t){t.valueAccessor.registerOnChange((function(){return Yg(t)})),t.valueAccessor.registerOnTouched((function(){return Yg(t)})),t._rawValidators.forEach((function(e){e.registerOnValidatorChange&&e.registerOnValidatorChange(null)})),t._rawAsyncValidators.forEach((function(e){e.registerOnValidatorChange&&e.registerOnValidatorChange(null)})),e&&e._clearChangeFns()}(t.control,t),n&&Kg(n,t),t.control=n)})),this.form._updateTreeValidity({emitEvent:!1})}},{key:"_updateRegistrations",value:function(){var e=this;this.form._registerOnCollectionChange((function(){return e._updateDomValue()})),this._oldForm&&this._oldForm._registerOnCollectionChange((function(){})),this._oldForm=this.form}},{key:"_updateValidators",value:function(){var e=Jg(this._validators);this.form.validator=Vg.compose([this.form.validator,e]);var t=$g(this._asyncValidators);this.form.asyncValidator=Vg.composeAsync([this.form.asyncValidator,t])}},{key:"_checkFormPresent",value:function(){this.form}},{key:"formDirective",get:function(){return this}},{key:"control",get:function(){return this.form}},{key:"path",get:function(){return[]}}]),n}(zg),fy=["mat-button","mat-flat-button","mat-icon-button","mat-raised-button","mat-stroked-button","mat-mini-fab","mat-fab"],dy=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;_classCallCheck2(this,n),(i=t.call(this,e))._focusMonitor=r,i._animationMode=a,i.isRoundButton=i._hasHostAttributes("mat-fab","mat-mini-fab"),i.isIconButton=i._hasHostAttributes("mat-icon-button");var o,s=_createForOfIteratorHelper(fy);try{for(s.s();!(o=s.n()).done;){var u=o.value;i._hasHostAttributes(u)&&i._getHostElement().classList.add(u)}}catch(c){s.e(c)}finally{s.f()}return e.nativeElement.classList.add("mat-button-base"),i._focusMonitor.monitor(i._elementRef,!0),i.isRoundButton&&(i.color="accent"),i}return _createClass2(n,[{key:"ngOnDestroy",value:function(){this._focusMonitor.stopMonitoring(this._elementRef)}},{key:"focus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"program",t=arguments.length>1?arguments[1]:void 0;this._focusMonitor.focusVia(this._getHostElement(),e,t)}},{key:"_getHostElement",value:function(){return this._elementRef.nativeElement}},{key:"_isRippleDisabled",value:function(){return this.disableRipple||this.disabled}},{key:"_hasHostAttributes",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.some((function(t){return e._getHostElement().hasAttribute(t)}))}}]),n}(zd(Ld(Bd((function e(t){_classCallCheck2(this,e),this._elementRef=t}))))),py=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){return _classCallCheck2(this,n),t.call(this,r,e,a)}return _createClass2(n,[{key:"_haltDisabledEvents",value:function(e){this.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}}]),n}(dy),my=function e(){_classCallCheck2(this,e)},vy=Wn({encapsulation:2,styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:.04}@media (hover:none){.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-flat-button,.mat-icon-button,.mat-stroked-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner{border:0}.mat-button[disabled],.mat-flat-button[disabled],.mat-icon-button[disabled],.mat-stroked-button[disabled]{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button[disabled]{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-focus-overlay,.mat-stroked-button .mat-button-ripple.mat-ripple{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab[disabled]{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab[disabled]{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button .mat-icon,.mat-icon-button i{line-height:24px}.mat-button-focus-overlay,.mat-button-ripple.mat-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity .2s cubic-bezier(.35,0,.25,1),background-color .2s cubic-bezier(.35,0,.25,1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}@media (-ms-high-contrast:active){.mat-button-focus-overlay{background-color:#fff}}@media (-ms-high-contrast:black-on-white){.mat-button-focus-overlay{background-color:#000}}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:block;font-size:inherit;width:2.5em;height:2.5em}@media (-ms-high-contrast:active){.mat-button,.mat-fab,.mat-flat-button,.mat-icon-button,.mat-mini-fab,.mat-raised-button{outline:solid 1px}}"],data:{}});function gy(e){return Yi(2,[Bi(671088640,1,{ripple:0}),(e()(),Pi(1,0,null,null,1,"span",[["class","mat-button-wrapper"]],null,null,null,null,null)),Wi(null,0),(e()(),Pi(3,0,null,null,1,"div",[["class","mat-button-ripple mat-ripple"],["matRipple",""]],[[2,"mat-button-ripple-round",null],[2,"mat-ripple-unbounded",null]],null,null,null,null)),ea(4,212992,[[1,4]],0,ep,[nn,Ya,Zf,[2,$d],[2,kv]],{centered:[0,"centered"],disabled:[1,"disabled"],trigger:[2,"trigger"]},null),(e()(),Pi(5,0,null,null,0,"div",[["class","mat-button-focus-overlay"]],null,null,null,null,null))],(function(e,t){var n=t.component;e(t,4,0,n.isIconButton,n._isRippleDisabled(),n._getHostElement())}),(function(e,t){var n=t.component;e(t,3,0,n.isRoundButton||n.isIconButton,Vr(t,4).unbounded)}))}var yy=Wn({encapsulation:2,styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:.04}@media (hover:none){.mat-button:hover .mat-button-focus-overlay,.mat-stroked-button:hover .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-flat-button,.mat-icon-button,.mat-stroked-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner{border:0}.mat-button[disabled],.mat-flat-button[disabled],.mat-icon-button[disabled],.mat-stroked-button[disabled]{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button[disabled]{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}._mat-animation-noopable.mat-raised-button{transition:none;animation:none}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-focus-overlay,.mat-stroked-button .mat-button-ripple.mat-ripple{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab[disabled]{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-fab{transition:none;animation:none}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:0;border:none;-webkit-tap-highlight-color:transparent;display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0,0,0);transition:background .4s cubic-bezier(.25,.8,.25,1),box-shadow 280ms cubic-bezier(.4,0,.2,1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab[disabled]{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}._mat-animation-noopable.mat-mini-fab{transition:none;animation:none}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button .mat-icon,.mat-icon-button i{line-height:24px}.mat-button-focus-overlay,.mat-button-ripple.mat-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity .2s cubic-bezier(.35,0,.25,1),background-color .2s cubic-bezier(.35,0,.25,1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}@media (-ms-high-contrast:active){.mat-button-focus-overlay{background-color:#fff}}@media (-ms-high-contrast:black-on-white){.mat-button-focus-overlay{background-color:#000}}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:block;font-size:inherit;width:2.5em;height:2.5em}@media (-ms-high-contrast:active){.mat-button,.mat-fab,.mat-flat-button,.mat-icon-button,.mat-mini-fab,.mat-raised-button{outline:solid 1px}}"],data:{}});function _y(e){return Yi(2,[Bi(671088640,1,{ripple:0}),(e()(),Pi(1,0,null,null,1,"span",[["class","mat-button-wrapper"]],null,null,null,null,null)),Wi(null,0),(e()(),Pi(3,0,null,null,1,"div",[["class","mat-button-ripple mat-ripple"],["matRipple",""]],[[2,"mat-button-ripple-round",null],[2,"mat-ripple-unbounded",null]],null,null,null,null)),ea(4,212992,[[1,4]],0,ep,[nn,Ya,Zf,[2,$d],[2,kv]],{centered:[0,"centered"],disabled:[1,"disabled"],trigger:[2,"trigger"]},null),(e()(),Pi(5,0,null,null,0,"div",[["class","mat-button-focus-overlay"]],null,null,null,null,null))],(function(e,t){var n=t.component;e(t,4,0,n.isIconButton,n._isRippleDisabled(),n._getHostElement())}),(function(e,t){var n=t.component;e(t,3,0,n.isRoundButton||n.isIconButton,Vr(t,4).unbounded)}))}var by,ky,wy=function(){function e(t){_classCallCheck2(this,e),this.total=t}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new xy(e,this.total))}}]),e}(),xy=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e)).total=r,a.count=0,a}return _createClass2(n,[{key:"_next",value:function(e){++this.count>this.total&&this.destination.next(e)}}]),n}(v),Cy=new Set,Sy=((ky=function(){function e(t){_classCallCheck2(this,e),this._platform=t,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Ty}return _createClass2(e,[{key:"matchMedia",value:function(e){return this._platform.WEBKIT&&function(e){if(!Cy.has(e))try{by||((by=document.createElement("style")).setAttribute("type","text/css"),document.head.appendChild(by)),by.sheet&&(by.sheet.insertRule("@media ".concat(e," {.fx-query-test{ }}"),0),Cy.add(e))}catch(t){console.error(t)}}(e),this._matchMedia(e)}}]),e}()).ngInjectableDef=ve({factory:function(){return new ky(Fe(Zf))},token:ky,providedIn:"root"}),ky);function Ty(e){return{matches:"all"===e||""===e,media:e,addListener:function(){},removeListener:function(){}}}var Ay,Ey=((Ay=function(){function e(t,n){_classCallCheck2(this,e),this._mediaMatcher=t,this._zone=n,this._queries=new Map,this._destroySubject=new R}return _createClass2(e,[{key:"ngOnDestroy",value:function(){this._destroySubject.next(),this._destroySubject.complete()}},{key:"isMatched",value:function(e){var t=this;return Iy(Gf(e)).some((function(e){return t._registerQuery(e).mql.matches}))}},{key:"observe",value:function(e){var t=this,n=Qs(Iy(Gf(e)).map((function(e){return t._registerQuery(e).observable})));return(n=Iu(n.pipe(bu(1)),n.pipe((function(e){return e.lift(new wy(1))}),cd(0)))).pipe(W((function(e){var t={matches:!1,breakpoints:{}};return e.forEach((function(e){t.matches=t.matches||e.matches,t.breakpoints[e.query]=e.matches})),t})))}},{key:"_registerQuery",value:function(e){var t=this;if(this._queries.has(e))return this._queries.get(e);var n=this._mediaMatcher.matchMedia(e),r={observable:new x((function(e){var r=function(n){return t._zone.run((function(){return e.next(n)}))};return n.addListener(r),function(){n.removeListener(r)}})).pipe(Ru(n),W((function(t){return{query:e,matches:t.matches}})),Wv(this._destroySubject)),mql:n};return this._queries.set(e,r),r}}]),e}()).ngInjectableDef=ve({factory:function(){return new Ay(Fe(Sy),Fe(Ya))},token:Ay,providedIn:"root"}),Ay);function Iy(e){return e.map((function(e){return e.split(",")})).reduce((function(e,t){return e.concat(t)})).map((function(e){return e.trim()}))}var Ry,Oy,Ny=function(){function e(t,n){_classCallCheck2(this,e),this.compare=t,this.keySelector=n}return _createClass2(e,[{key:"call",value:function(e,t){return t.subscribe(new Dy(e,this.compare,this.keySelector))}}]),e}(),Dy=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,e)).keySelector=a,i.hasKey=!1,"function"==typeof r&&(i.compare=r),i}return _createClass2(n,[{key:"compare",value:function(e,t){return e===t}},{key:"_next",value:function(e){var t;try{var n=this.keySelector;t=n?n(e):e}catch(a){return this.destination.error(a)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,t)}catch(a){return this.destination.error(a)}else this.hasKey=!0;r||(this.key=t,this.destination.next(e))}}]),n}(v),Py=((Ry=function(){function e(t,n){_classCallCheck2(this,e),this._ngZone=t,this._platform=n,this._scrolled=new R,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map}return _createClass2(e,[{key:"register",value:function(e){var t=this;this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe((function(){return t._scrolled.next(e)})))}},{key:"deregister",value:function(e){var t=this.scrollContainers.get(e);t&&(t.unsubscribe(),this.scrollContainers.delete(e))}},{key:"scrolled",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return this._platform.isBrowser?new x((function(n){e._globalSubscription||e._addGlobalListener();var r=t>0?e._scrolled.pipe(Tg(t)).subscribe(n):e._scrolled.subscribe(n);return e._scrolledCount++,function(){r.unsubscribe(),e._scrolledCount--,e._scrolledCount||e._removeGlobalListener()}})):Ws()}},{key:"ngOnDestroy",value:function(){var e=this;this._removeGlobalListener(),this.scrollContainers.forEach((function(t,n){return e.deregister(n)})),this._scrolled.complete()}},{key:"ancestorScrolled",value:function(e,t){var n=this.getAncestorScrollContainers(e);return this.scrolled(t).pipe(eu((function(e){return!e||n.indexOf(e)>-1})))}},{key:"getAncestorScrollContainers",value:function(e){var t=this,n=[];return this.scrollContainers.forEach((function(r,a){t._scrollableContainsElement(a,e)&&n.push(a)})),n}},{key:"_scrollableContainsElement",value:function(e,t){var n=t.nativeElement,r=e.getElementRef().nativeElement;do{if(n==r)return!0}while(n=n.parentElement);return!1}},{key:"_addGlobalListener",value:function(){var e=this;this._globalSubscription=this._ngZone.runOutsideAngular((function(){return Uv(window.document,"scroll").subscribe((function(){return e._scrolled.next()}))}))}},{key:"_removeGlobalListener",value:function(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}]),e}()).ngInjectableDef=ve({factory:function(){return new Ry(Fe(Ya),Fe(Zf))},token:Ry,providedIn:"root"}),Ry),Fy=function e(){_classCallCheck2(this,e)},My=((Oy=function(){function e(t,n){var r=this;_classCallCheck2(this,e),this._platform=t,n.runOutsideAngular((function(){r._change=t.isBrowser?ee(Uv(window,"resize"),Uv(window,"orientationchange")):Ws(),r._invalidateCache=r.change().subscribe((function(){return r._updateViewportSize()}))}))}return _createClass2(e,[{key:"ngOnDestroy",value:function(){this._invalidateCache.unsubscribe()}},{key:"getViewportSize",value:function(){this._viewportSize||this._updateViewportSize();var e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}},{key:"getViewportRect",value:function(){var e=this.getViewportScrollPosition(),t=this.getViewportSize(),n=t.width,r=t.height;return{top:e.top,left:e.left,bottom:e.top+r,right:e.left+n,height:r,width:n}}},{key:"getViewportScrollPosition",value:function(){if(!this._platform.isBrowser)return{top:0,left:0};var e=document.documentElement,t=e.getBoundingClientRect();return{top:-t.top||document.body.scrollTop||window.scrollY||e.scrollTop||0,left:-t.left||document.body.scrollLeft||window.scrollX||e.scrollLeft||0}}},{key:"change",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return e>0?this._change.pipe(Tg(e)):this._change}},{key:"_updateViewportSize",value:function(){this._viewportSize=this._platform.isBrowser?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0}}}]),e}()).ngInjectableDef=ve({factory:function(){return new Oy(Fe(Zf),Fe(Ya))},token:Oy,providedIn:"root"}),Oy);function Ly(){throw Error("Host already has a portal attached")}var zy=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"attach",value:function(e){return null==e&&function(){throw Error("Attempting to attach a portal to a null PortalOutlet")}(),e.hasAttached()&&Ly(),this._attachedHost=e,e.attach(this)}},{key:"detach",value:function(){var e=this._attachedHost;null==e?function(){throw Error("Attempting to detach a portal that is not attached to a host")}():(this._attachedHost=null,e.detach())}},{key:"setAttachedHost",value:function(e){this._attachedHost=e}},{key:"isAttached",get:function(){return null!=this._attachedHost}}]),e}(),By=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this)).component=e,o.viewContainerRef=r,o.injector=a,o.componentFactoryResolver=i,o}return n}(zy),jy=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this)).templateRef=e,i.viewContainerRef=r,i.context=a,i}return _createClass2(n,[{key:"attach",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.context;return this.context=t,_get(_getPrototypeOf(n.prototype),"attach",this).call(this,e)}},{key:"detach",value:function(){return this.context=void 0,_get(_getPrototypeOf(n.prototype),"detach",this).call(this)}},{key:"origin",get:function(){return this.templateRef.elementRef}}]),n}(zy),Vy=function(){function e(){_classCallCheck2(this,e),this._isDisposed=!1}return _createClass2(e,[{key:"hasAttached",value:function(){return!!this._attachedPortal}},{key:"attach",value:function(e){return e||function(){throw Error("Must provide a portal to attach")}(),this.hasAttached()&&Ly(),this._isDisposed&&function(){throw Error("This PortalOutlet has already been disposed")}(),e instanceof By?(this._attachedPortal=e,this.attachComponentPortal(e)):e instanceof jy?(this._attachedPortal=e,this.attachTemplatePortal(e)):void function(){throw Error("Attempting to attach an unknown Portal type. BasePortalOutlet accepts either a ComponentPortal or a TemplatePortal.")}()}},{key:"detach",value:function(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}},{key:"dispose",value:function(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}},{key:"setDisposeFn",value:function(e){this._disposeFn=e}},{key:"_invokeDisposeFn",value:function(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}]),e}(),qy=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this)).outletElement=e,o._componentFactoryResolver=r,o._appRef=a,o._defaultInjector=i,o}return _createClass2(n,[{key:"attachComponentPortal",value:function(e){var t,n=this,r=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component);return e.viewContainerRef?(t=e.viewContainerRef.createComponent(r,e.viewContainerRef.length,e.injector||e.viewContainerRef.injector),this.setDisposeFn((function(){return t.destroy()}))):(t=r.create(e.injector||this._defaultInjector),this._appRef.attachView(t.hostView),this.setDisposeFn((function(){n._appRef.detachView(t.hostView),t.destroy()}))),this.outletElement.appendChild(this._getComponentRootNode(t)),t}},{key:"attachTemplatePortal",value:function(e){var t=this,n=e.viewContainerRef,r=n.createEmbeddedView(e.templateRef,e.context);return r.detectChanges(),r.rootNodes.forEach((function(e){return t.outletElement.appendChild(e)})),this.setDisposeFn((function(){var e=n.indexOf(r);-1!==e&&n.remove(e)})),r}},{key:"dispose",value:function(){_get(_getPrototypeOf(n.prototype),"dispose",this).call(this),null!=this.outletElement.parentNode&&this.outletElement.parentNode.removeChild(this.outletElement)}},{key:"_getComponentRootNode",value:function(e){return e.hostView.rootNodes[0]}}]),n}(Vy),Uy=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this))._componentFactoryResolver=e,a._viewContainerRef=r,a._isInitialized=!1,a.attached=new ka,a}return _createClass2(n,[{key:"ngOnInit",value:function(){this._isInitialized=!0}},{key:"ngOnDestroy",value:function(){_get(_getPrototypeOf(n.prototype),"dispose",this).call(this),this._attachedPortal=null,this._attachedRef=null}},{key:"attachComponentPortal",value:function(e){e.setAttachedHost(this);var t=null!=e.viewContainerRef?e.viewContainerRef:this._viewContainerRef,r=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component),a=t.createComponent(r,t.length,e.injector||t.injector);return _get(_getPrototypeOf(n.prototype),"setDisposeFn",this).call(this,(function(){return a.destroy()})),this._attachedPortal=e,this._attachedRef=a,this.attached.emit(a),a}},{key:"attachTemplatePortal",value:function(e){var t=this;e.setAttachedHost(this);var r=this._viewContainerRef.createEmbeddedView(e.templateRef,e.context);return _get(_getPrototypeOf(n.prototype),"setDisposeFn",this).call(this,(function(){return t._viewContainerRef.clear()})),this._attachedPortal=e,this._attachedRef=r,this.attached.emit(r),r}},{key:"portal",get:function(){return this._attachedPortal},set:function(e){(!this.hasAttached()||e||this._isInitialized)&&(this.hasAttached()&&_get(_getPrototypeOf(n.prototype),"detach",this).call(this),e&&_get(_getPrototypeOf(n.prototype),"attach",this).call(this,e),this._attachedPortal=e)}},{key:"attachedRef",get:function(){return this._attachedRef}}]),n}(Vy),Wy=function e(){_classCallCheck2(this,e)},Gy=function(){function e(t,n){_classCallCheck2(this,e),this._parentInjector=t,this._customTokens=n}return _createClass2(e,[{key:"get",value:function(e,t){var n=this._customTokens.get(e);return void 0!==n?n:this._parentInjector.get(e,t)}}]),e}(),Hy=function(){function e(t,n){_classCallCheck2(this,e),this._viewportRuler=t,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=n}return _createClass2(e,[{key:"attach",value:function(){}},{key:"enable",value:function(){if(this._canBeEnabled()){var e=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=e.style.left||"",this._previousHTMLStyles.top=e.style.top||"",e.style.left=Hf(-this._previousScrollPosition.left),e.style.top=Hf(-this._previousScrollPosition.top),e.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}},{key:"disable",value:function(){if(this._isEnabled){var e=this._document.documentElement,t=e.style,n=this._document.body.style,r=t.scrollBehavior||"",a=n.scrollBehavior||"";this._isEnabled=!1,t.left=this._previousHTMLStyles.left,t.top=this._previousHTMLStyles.top,e.classList.remove("cdk-global-scrollblock"),t.scrollBehavior=n.scrollBehavior="auto",window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),t.scrollBehavior=r,n.scrollBehavior=a}}},{key:"_canBeEnabled",value:function(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;var e=this._document.body,t=this._viewportRuler.getViewportSize();return e.scrollHeight>t.height||e.scrollWidth>t.width}}]),e}();function Ky(){return Error("Scroll strategy has already been attached.")}var Xy=function(){function e(t,n,r,a){var i=this;_classCallCheck2(this,e),this._scrollDispatcher=t,this._ngZone=n,this._viewportRuler=r,this._config=a,this._scrollSubscription=null,this._detach=function(){i.disable(),i._overlayRef.hasAttached()&&i._ngZone.run((function(){return i._overlayRef.detach()}))}}return _createClass2(e,[{key:"attach",value:function(e){if(this._overlayRef)throw Ky();this._overlayRef=e}},{key:"enable",value:function(){var e=this;if(!this._scrollSubscription){var t=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=t.subscribe((function(){var t=e._viewportRuler.getViewportScrollPosition().top;Math.abs(t-e._initialScrollPosition)>e._config.threshold?e._detach():e._overlayRef.updatePosition()}))):this._scrollSubscription=t.subscribe(this._detach)}}},{key:"disable",value:function(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}},{key:"detach",value:function(){this.disable(),this._overlayRef=null}}]),e}(),Qy=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"enable",value:function(){}},{key:"disable",value:function(){}},{key:"attach",value:function(){}}]),e}();function Yy(e,t){return t.some((function(t){return e.bottom<t.top||e.top>t.bottom||e.right<t.left||e.left>t.right}))}function Zy(e,t){return t.some((function(t){return e.top<t.top||e.bottom>t.bottom||e.left<t.left||e.right>t.right}))}var Jy,$y=function(){function e(t,n,r,a){_classCallCheck2(this,e),this._scrollDispatcher=t,this._viewportRuler=n,this._ngZone=r,this._config=a,this._scrollSubscription=null}return _createClass2(e,[{key:"attach",value:function(e){if(this._overlayRef)throw Ky();this._overlayRef=e}},{key:"enable",value:function(){var e=this;this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe((function(){if(e._overlayRef.updatePosition(),e._config&&e._config.autoClose){var t=e._overlayRef.overlayElement.getBoundingClientRect(),n=e._viewportRuler.getViewportSize(),r=n.width,a=n.height;Yy(t,[{width:r,height:a,bottom:a,right:r,top:0,left:0}])&&(e.disable(),e._ngZone.run((function(){return e._overlayRef.detach()})))}})))}},{key:"disable",value:function(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}},{key:"detach",value:function(){this.disable(),this._overlayRef=null}}]),e}(),e_=((Jy=function e(t,n,r,a){var i=this;_classCallCheck2(this,e),this._scrollDispatcher=t,this._viewportRuler=n,this._ngZone=r,this.noop=function(){return new Qy},this.close=function(e){return new Xy(i._scrollDispatcher,i._ngZone,i._viewportRuler,e)},this.block=function(){return new Hy(i._viewportRuler,i._document)},this.reposition=function(e){return new $y(i._scrollDispatcher,i._viewportRuler,i._ngZone,e)},this._document=a}).ngInjectableDef=ve({factory:function(){return new Jy(Fe(Py),Fe(My),Fe(Ya),Fe(Ms))},token:Jy,providedIn:"root"}),Jy),t_=function e(t){if(_classCallCheck2(this,e),this.scrollStrategy=new Qy,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,t)for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];void 0!==t[a]&&(this[a]=t[a])}},n_=function e(t,n,r,a,i){_classCallCheck2(this,e),this.offsetX=r,this.offsetY=a,this.panelClass=i,this.originX=t.originX,this.originY=t.originY,this.overlayX=n.overlayX,this.overlayY=n.overlayY},r_=function e(t,n){_classCallCheck2(this,e),this.connectionPair=t,this.scrollableViewProperties=n};function a_(e,t){if("top"!==t&&"bottom"!==t&&"center"!==t)throw Error("ConnectedPosition: Invalid ".concat(e,' "').concat(t,'". Expected "top", "bottom" or "center".'))}function i_(e,t){if("start"!==t&&"end"!==t&&"center"!==t)throw Error("ConnectedPosition: Invalid ".concat(e,' "').concat(t,'". Expected "start", "end" or "center".'))}var o_,s_,u_=((s_=function(){function e(t){var n=this;_classCallCheck2(this,e),this._attachedOverlays=[],this._keydownListener=function(e){for(var t=n._attachedOverlays,r=t.length-1;r>-1;r--)if(t[r]._keydownEventSubscriptions>0){t[r]._keydownEvents.next(e);break}},this._document=t}return _createClass2(e,[{key:"ngOnDestroy",value:function(){this._detach()}},{key:"add",value:function(e){this.remove(e),this._isAttached||(this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0),this._attachedOverlays.push(e)}},{key:"remove",value:function(e){var t=this._attachedOverlays.indexOf(e);t>-1&&this._attachedOverlays.splice(t,1),0===this._attachedOverlays.length&&this._detach()}},{key:"_detach",value:function(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}]),e}()).ngInjectableDef=ve({factory:function(){return new s_(Fe(Ms))},token:s_,providedIn:"root"}),s_),c_=((o_=function(){function e(t){_classCallCheck2(this,e),this._document=t}return _createClass2(e,[{key:"ngOnDestroy",value:function(){this._containerElement&&this._containerElement.parentNode&&this._containerElement.parentNode.removeChild(this._containerElement)}},{key:"getContainerElement",value:function(){return this._containerElement||this._createContainer(),this._containerElement}},{key:"_createContainer",value:function(){for(var e=this._document.getElementsByClassName("cdk-overlay-container"),t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t]);var n=this._document.createElement("div");n.classList.add("cdk-overlay-container"),this._document.body.appendChild(n),this._containerElement=n}}]),e}()).ngInjectableDef=ve({factory:function(){return new o_(Fe(Ms))},token:o_,providedIn:"root"}),o_),l_=function(){function e(t,n,r,a,i,o,s,u){var c=this;_classCallCheck2(this,e),this._portalOutlet=t,this._host=n,this._pane=r,this._config=a,this._ngZone=i,this._keyboardDispatcher=o,this._document=s,this._location=u,this._backdropElement=null,this._backdropClick=new R,this._attachments=new R,this._detachments=new R,this._locationChanges=d.EMPTY,this._backdropClickHandler=function(e){return c._backdropClick.next(e)},this._keydownEventsObservable=new x((function(e){var t=c._keydownEvents.subscribe(e);return c._keydownEventSubscriptions++,function(){t.unsubscribe(),c._keydownEventSubscriptions--}})),this._keydownEvents=new R,this._keydownEventSubscriptions=0,a.scrollStrategy&&(this._scrollStrategy=a.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=a.positionStrategy}return _createClass2(e,[{key:"attach",value:function(e){var t=this,n=this._portalOutlet.attach(e);return this._positionStrategy&&this._positionStrategy.attach(this),!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.asObservable().pipe(bu(1)).subscribe((function(){t.hasAttached()&&t.updatePosition()})),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&this._location&&(this._locationChanges=this._location.subscribe((function(){return t.dispose()}))),n}},{key:"detach",value:function(){if(this.hasAttached()){this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();var e=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),e}}},{key:"dispose",value:function(){var e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this.detachBackdrop(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._host&&this._host.parentNode&&(this._host.parentNode.removeChild(this._host),this._host=null),this._previousHostParent=this._pane=null,e&&this._detachments.next(),this._detachments.complete()}},{key:"hasAttached",value:function(){return this._portalOutlet.hasAttached()}},{key:"backdropClick",value:function(){return this._backdropClick.asObservable()}},{key:"attachments",value:function(){return this._attachments.asObservable()}},{key:"detachments",value:function(){return this._detachments.asObservable()}},{key:"keydownEvents",value:function(){return this._keydownEventsObservable}},{key:"getConfig",value:function(){return this._config}},{key:"updatePosition",value:function(){this._positionStrategy&&this._positionStrategy.apply()}},{key:"updatePositionStrategy",value:function(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}},{key:"updateSize",value:function(e){this._config=Object.assign({},this._config,e),this._updateElementSize()}},{key:"setDirection",value:function(e){this._config=Object.assign({},this._config,{direction:e}),this._updateElementDirection()}},{key:"addPanelClass",value:function(e){this._pane&&this._toggleClasses(this._pane,e,!0)}},{key:"removePanelClass",value:function(e){this._pane&&this._toggleClasses(this._pane,e,!1)}},{key:"getDirection",value:function(){var e=this._config.direction;return e?"string"==typeof e?e:e.value:"ltr"}},{key:"updateScrollStrategy",value:function(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}},{key:"_updateElementDirection",value:function(){this._host.setAttribute("dir",this.getDirection())}},{key:"_updateElementSize",value:function(){if(this._pane){var e=this._pane.style;e.width=Hf(this._config.width),e.height=Hf(this._config.height),e.minWidth=Hf(this._config.minWidth),e.minHeight=Hf(this._config.minHeight),e.maxWidth=Hf(this._config.maxWidth),e.maxHeight=Hf(this._config.maxHeight)}}},{key:"_togglePointerEvents",value:function(e){this._pane.style.pointerEvents=e?"auto":"none"}},{key:"_attachBackdrop",value:function(){var e=this;this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),"undefined"!=typeof requestAnimationFrame?this._ngZone.runOutsideAngular((function(){requestAnimationFrame((function(){e._backdropElement&&e._backdropElement.classList.add("cdk-overlay-backdrop-showing")}))})):this._backdropElement.classList.add("cdk-overlay-backdrop-showing")}},{key:"_updateStackingOrder",value:function(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}},{key:"detachBackdrop",value:function(){var e,t=this,n=this._backdropElement;if(n){var r=function r(){n&&(n.removeEventListener("click",t._backdropClickHandler),n.removeEventListener("transitionend",r),n.parentNode&&n.parentNode.removeChild(n)),t._backdropElement==n&&(t._backdropElement=null),t._config.backdropClass&&t._toggleClasses(n,t._config.backdropClass,!1),clearTimeout(e)};n.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular((function(){n.addEventListener("transitionend",r)})),n.style.pointerEvents="none",e=this._ngZone.runOutsideAngular((function(){return setTimeout(r,500)}))}}},{key:"_toggleClasses",value:function(e,t,n){var r=e.classList;Gf(t).forEach((function(e){e&&(n?r.add(e):r.remove(e))}))}},{key:"_detachContentWhenStable",value:function(){var e=this;this._ngZone.runOutsideAngular((function(){var t=e._ngZone.onStable.asObservable().pipe(Wv(ee(e._attachments,e._detachments))).subscribe((function(){e._pane&&e._host&&0!==e._pane.children.length||(e._pane&&e._config.panelClass&&e._toggleClasses(e._pane,e._config.panelClass,!1),e._host&&e._host.parentElement&&(e._previousHostParent=e._host.parentElement,e._previousHostParent.removeChild(e._host)),t.unsubscribe())}))}))}},{key:"_disposeScrollStrategy",value:function(){var e=this._scrollStrategy;e&&(e.disable(),e.detach&&e.detach())}},{key:"overlayElement",get:function(){return this._pane}},{key:"backdropElement",get:function(){return this._backdropElement}},{key:"hostElement",get:function(){return this._host}}]),e}(),h_=function(){function e(t,n,r,a,i){_classCallCheck2(this,e),this._viewportRuler=n,this._document=r,this._platform=a,this._overlayContainer=i,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new R,this._resizeSubscription=d.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges.asObservable(),this.setOrigin(t)}return _createClass2(e,[{key:"attach",value:function(e){var t=this;if(this._overlayRef&&e!==this._overlayRef)throw Error("This position strategy is already attached to an overlay");this._validatePositions(),e.hostElement.classList.add("cdk-overlay-connected-position-bounding-box"),this._overlayRef=e,this._boundingBox=e.hostElement,this._pane=e.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe((function(){t._isInitialRender=!0,t.apply()}))}},{key:"apply",value:function(){if(!this._isDisposed&&this._platform.isBrowser)if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)this.reapplyLastPosition();else{this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect();var e,t,n=this._originRect,r=this._overlayRect,a=this._viewportRect,i=[],o=_createForOfIteratorHelper(this._preferredPositions);try{for(o.s();!(t=o.n()).done;){var s=t.value,u=this._getOriginPoint(n,s),c=this._getOverlayPoint(u,r,s),l=this._getOverlayFit(c,r,a,s);if(l.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(s,u);this._canFitWithFlexibleDimensions(l,c,a)?i.push({position:s,origin:u,overlayRect:r,boundingBoxRect:this._calculateBoundingBoxRect(u,s)}):(!e||e.overlayFit.visibleArea<l.visibleArea)&&(e={overlayFit:l,overlayPoint:c,originPoint:u,position:s,overlayRect:r})}}catch(g){o.e(g)}finally{o.f()}if(i.length){var h,f=null,d=-1,p=_createForOfIteratorHelper(i);try{for(p.s();!(h=p.n()).done;){var m=h.value,v=m.boundingBoxRect.width*m.boundingBoxRect.height*(m.position.weight||1);v>d&&(d=v,f=m)}}catch(g){p.e(g)}finally{p.f()}return this._isPushed=!1,void this._applyPosition(f.position,f.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(e.position,e.originPoint);this._applyPosition(e.position,e.originPoint)}}},{key:"detach",value:function(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}},{key:"dispose",value:function(){this._isDisposed||(this._boundingBox&&f_(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove("cdk-overlay-connected-position-bounding-box"),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}},{key:"reapplyLastPosition",value:function(){if(!this._isDisposed&&(!this._platform||this._platform.isBrowser)){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect();var e=this._lastPosition||this._preferredPositions[0],t=this._getOriginPoint(this._originRect,e);this._applyPosition(e,t)}}},{key:"withScrollableContainers",value:function(e){return this._scrollables=e,this}},{key:"withPositions",value:function(e){return this._preferredPositions=e,-1===e.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}},{key:"withViewportMargin",value:function(e){return this._viewportMargin=e,this}},{key:"withFlexibleDimensions",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._hasFlexibleDimensions=e,this}},{key:"withGrowAfterOpen",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._growAfterOpen=e,this}},{key:"withPush",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._canPush=e,this}},{key:"withLockedPosition",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._positionLocked=e,this}},{key:"setOrigin",value:function(e){return this._origin=e,this}},{key:"withDefaultOffsetX",value:function(e){return this._offsetX=e,this}},{key:"withDefaultOffsetY",value:function(e){return this._offsetY=e,this}},{key:"withTransformOriginOn",value:function(e){return this._transformOriginSelector=e,this}},{key:"_getOriginPoint",value:function(e,t){var n;if("center"==t.originX)n=e.left+e.width/2;else{var r=this._isRtl()?e.right:e.left,a=this._isRtl()?e.left:e.right;n="start"==t.originX?r:a}return{x:n,y:"center"==t.originY?e.top+e.height/2:"top"==t.originY?e.top:e.bottom}}},{key:"_getOverlayPoint",value:function(e,t,n){var r,a;return r="center"==n.overlayX?-t.width/2:"start"===n.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,a="center"==n.overlayY?-t.height/2:"top"==n.overlayY?0:-t.height,{x:e.x+r,y:e.y+a}}},{key:"_getOverlayFit",value:function(e,t,n,r){var a=e.x,i=e.y,o=this._getOffset(r,"x"),s=this._getOffset(r,"y");o&&(a+=o),s&&(i+=s);var u=0-i,c=i+t.height-n.height,l=this._subtractOverflows(t.width,0-a,a+t.width-n.width),h=this._subtractOverflows(t.height,u,c),f=l*h;return{visibleArea:f,isCompletelyWithinViewport:t.width*t.height===f,fitsInViewportVertically:h===t.height,fitsInViewportHorizontally:l==t.width}}},{key:"_canFitWithFlexibleDimensions",value:function(e,t,n){if(this._hasFlexibleDimensions){var r=n.bottom-t.y,a=n.right-t.x,i=this._overlayRef.getConfig().minHeight,o=this._overlayRef.getConfig().minWidth,s=e.fitsInViewportHorizontally||null!=o&&o<=a;return(e.fitsInViewportVertically||null!=i&&i<=r)&&s}return!1}},{key:"_pushOverlayOnScreen",value:function(e,t,n){if(this._previousPushAmount&&this._positionLocked)return{x:e.x+this._previousPushAmount.x,y:e.y+this._previousPushAmount.y};var r,a,i=this._viewportRect,o=Math.max(e.x+t.width-i.right,0),s=Math.max(e.y+t.height-i.bottom,0),u=Math.max(i.top-n.top-e.y,0),c=Math.max(i.left-n.left-e.x,0);return r=t.width<=i.width?c||-o:e.x<this._viewportMargin?i.left-n.left-e.x:0,a=t.height<=i.height?u||-s:e.y<this._viewportMargin?i.top-n.top-e.y:0,this._previousPushAmount={x:r,y:a},{x:e.x+r,y:e.y+a}}},{key:"_applyPosition",value:function(e,t){if(this._setTransformOrigin(e),this._setOverlayElementStyles(t,e),this._setBoundingBoxStyles(t,e),e.panelClass&&this._addPanelClasses(e.panelClass),this._lastPosition=e,this._positionChanges.observers.length){var n=this._getScrollVisibility(),r=new r_(e,n);this._positionChanges.next(r)}this._isInitialRender=!1}},{key:"_setTransformOrigin",value:function(e){if(this._transformOriginSelector){var t,n=this._boundingBox.querySelectorAll(this._transformOriginSelector),r=e.overlayY;t="center"===e.overlayX?"center":this._isRtl()?"start"===e.overlayX?"right":"left":"start"===e.overlayX?"left":"right";for(var a=0;a<n.length;a++)n[a].style.transformOrigin="".concat(t," ").concat(r)}}},{key:"_calculateBoundingBoxRect",value:function(e,t){var n,r,a,i,o,s,u=this._viewportRect,c=this._isRtl();if("top"===t.overlayY)r=e.y,n=u.height-r+this._viewportMargin;else if("bottom"===t.overlayY)a=u.height-e.y+2*this._viewportMargin,n=u.height-a+this._viewportMargin;else{var l=Math.min(u.bottom-e.y+u.top,e.y),h=this._lastBoundingBoxSize.height;n=2*l,r=e.y-l,n>h&&!this._isInitialRender&&!this._growAfterOpen&&(r=e.y-h/2)}if("end"===t.overlayX&&!c||"start"===t.overlayX&&c)s=u.width-e.x+this._viewportMargin,i=e.x-this._viewportMargin;else if("start"===t.overlayX&&!c||"end"===t.overlayX&&c)o=e.x,i=u.right-e.x;else{var f=Math.min(u.right-e.x+u.left,e.x),d=this._lastBoundingBoxSize.width;i=2*f,o=e.x-f,i>d&&!this._isInitialRender&&!this._growAfterOpen&&(o=e.x-d/2)}return{top:r,left:o,bottom:a,right:s,width:i,height:n}}},{key:"_setBoundingBoxStyles",value:function(e,t){var n=this._calculateBoundingBoxRect(e,t);this._isInitialRender||this._growAfterOpen||(n.height=Math.min(n.height,this._lastBoundingBoxSize.height),n.width=Math.min(n.width,this._lastBoundingBoxSize.width));var r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right="",r.width=r.height="100%";else{var a=this._overlayRef.getConfig().maxHeight,i=this._overlayRef.getConfig().maxWidth;r.height=Hf(n.height),r.top=Hf(n.top),r.bottom=Hf(n.bottom),r.width=Hf(n.width),r.left=Hf(n.left),r.right=Hf(n.right),r.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",r.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",a&&(r.maxHeight=Hf(a)),i&&(r.maxWidth=Hf(i))}this._lastBoundingBoxSize=n,f_(this._boundingBox.style,r)}},{key:"_resetBoundingBoxStyles",value:function(){f_(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}},{key:"_resetOverlayElementStyles",value:function(){f_(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}},{key:"_setOverlayElementStyles",value:function(e,t){var n={};if(this._hasExactPosition()){var r=this._viewportRuler.getViewportScrollPosition();f_(n,this._getExactOverlayY(t,e,r)),f_(n,this._getExactOverlayX(t,e,r))}else n.position="static";var a="",i=this._getOffset(t,"x"),o=this._getOffset(t,"y");i&&(a+="translateX(".concat(i,"px) ")),o&&(a+="translateY(".concat(o,"px)")),n.transform=a.trim(),this._hasFlexibleDimensions&&this._overlayRef.getConfig().maxHeight&&(n.maxHeight=""),this._hasFlexibleDimensions&&this._overlayRef.getConfig().maxWidth&&(n.maxWidth=""),f_(this._pane.style,n)}},{key:"_getExactOverlayY",value:function(e,t,n){var r={top:null,bottom:null},a=this._getOverlayPoint(t,this._overlayRect,e);this._isPushed&&(a=this._pushOverlayOnScreen(a,this._overlayRect,n));var i=this._overlayContainer.getContainerElement().getBoundingClientRect().top;return a.y-=i,"bottom"===e.overlayY?r.bottom=this._document.documentElement.clientHeight-(a.y+this._overlayRect.height)+"px":r.top=Hf(a.y),r}},{key:"_getExactOverlayX",value:function(e,t,n){var r={left:null,right:null},a=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(a=this._pushOverlayOnScreen(a,this._overlayRect,n)),"right"===(this._isRtl()?"end"===e.overlayX?"left":"right":"end"===e.overlayX?"right":"left")?r.right=this._document.documentElement.clientWidth-(a.x+this._overlayRect.width)+"px":r.left=Hf(a.x),r}},{key:"_getScrollVisibility",value:function(){var e=this._getOriginRect(),t=this._pane.getBoundingClientRect(),n=this._scrollables.map((function(e){return e.getElementRef().nativeElement.getBoundingClientRect()}));return{isOriginClipped:Zy(e,n),isOriginOutsideView:Yy(e,n),isOverlayClipped:Zy(t,n),isOverlayOutsideView:Yy(t,n)}}},{key:"_subtractOverflows",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(e,t){return e-Math.max(t,0)}),e)}},{key:"_getNarrowedViewportRect",value:function(){var e=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,n=this._viewportRuler.getViewportScrollPosition();return{top:n.top+this._viewportMargin,left:n.left+this._viewportMargin,right:n.left+e-this._viewportMargin,bottom:n.top+t-this._viewportMargin,width:e-2*this._viewportMargin,height:t-2*this._viewportMargin}}},{key:"_isRtl",value:function(){return"rtl"===this._overlayRef.getDirection()}},{key:"_hasExactPosition",value:function(){return!this._hasFlexibleDimensions||this._isPushed}},{key:"_getOffset",value:function(e,t){return"x"===t?null==e.offsetX?this._offsetX:e.offsetX:null==e.offsetY?this._offsetY:e.offsetY}},{key:"_validatePositions",value:function(){if(!this._preferredPositions.length)throw Error("FlexibleConnectedPositionStrategy: At least one position is required.");this._preferredPositions.forEach((function(e){i_("originX",e.originX),a_("originY",e.originY),i_("overlayX",e.overlayX),a_("overlayY",e.overlayY)}))}},{key:"_addPanelClasses",value:function(e){var t=this;this._pane&&Gf(e).forEach((function(e){""!==e&&-1===t._appliedPanelClasses.indexOf(e)&&(t._appliedPanelClasses.push(e),t._pane.classList.add(e))}))}},{key:"_clearPanelClasses",value:function(){var e=this;this._pane&&(this._appliedPanelClasses.forEach((function(t){e._pane.classList.remove(t)})),this._appliedPanelClasses=[])}},{key:"_getOriginRect",value:function(){var e=this._origin;if(e instanceof nn)return e.nativeElement.getBoundingClientRect();if(e instanceof HTMLElement)return e.getBoundingClientRect();var t=e.width||0,n=e.height||0;return{top:e.y,bottom:e.y+n,left:e.x,right:e.x+t,height:n,width:t}}},{key:"positions",get:function(){return this._preferredPositions}}]),e}();function f_(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var d_,p_=function(){function e(t,n,r,a,i,o,s){_classCallCheck2(this,e),this._preferredPositions=[],this._positionStrategy=new h_(r,a,i,o,s).withFlexibleDimensions(!1).withPush(!1).withViewportMargin(0),this.withFallbackPosition(t,n)}return _createClass2(e,[{key:"attach",value:function(e){this._overlayRef=e,this._positionStrategy.attach(e),this._direction&&(e.setDirection(this._direction),this._direction=null)}},{key:"dispose",value:function(){this._positionStrategy.dispose()}},{key:"detach",value:function(){this._positionStrategy.detach()}},{key:"apply",value:function(){this._positionStrategy.apply()}},{key:"recalculateLastPosition",value:function(){this._positionStrategy.reapplyLastPosition()}},{key:"withScrollableContainers",value:function(e){this._positionStrategy.withScrollableContainers(e)}},{key:"withFallbackPosition",value:function(e,t,n,r){var a=new n_(e,t,n,r);return this._preferredPositions.push(a),this._positionStrategy.withPositions(this._preferredPositions),this}},{key:"withDirection",value:function(e){return this._overlayRef?this._overlayRef.setDirection(e):this._direction=e,this}},{key:"withOffsetX",value:function(e){return this._positionStrategy.withDefaultOffsetX(e),this}},{key:"withOffsetY",value:function(e){return this._positionStrategy.withDefaultOffsetY(e),this}},{key:"withLockedPosition",value:function(e){return this._positionStrategy.withLockedPosition(e),this}},{key:"withPositions",value:function(e){return this._preferredPositions=e.slice(),this._positionStrategy.withPositions(this._preferredPositions),this}},{key:"setOrigin",value:function(e){return this._positionStrategy.setOrigin(e),this}},{key:"_isRtl",get:function(){return"rtl"===this._overlayRef.getDirection()}},{key:"onPositionChange",get:function(){return this._positionStrategy.positionChanges}},{key:"positions",get:function(){return this._preferredPositions}}]),e}(),m_=function(){function e(){_classCallCheck2(this,e),this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}return _createClass2(e,[{key:"attach",value:function(e){var t=e.getConfig();this._overlayRef=e,this._width&&!t.width&&e.updateSize({width:this._width}),this._height&&!t.height&&e.updateSize({height:this._height}),e.hostElement.classList.add("cdk-global-overlay-wrapper"),this._isDisposed=!1}},{key:"top",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}},{key:"left",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this._rightOffset="",this._leftOffset=e,this._justifyContent="flex-start",this}},{key:"bottom",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}},{key:"right",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this._leftOffset="",this._rightOffset=e,this._justifyContent="flex-end",this}},{key:"width",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}},{key:"height",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}},{key:"centerHorizontally",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.left(e),this._justifyContent="center",this}},{key:"centerVertically",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.top(e),this._alignItems="center",this}},{key:"apply",value:function(){if(this._overlayRef&&this._overlayRef.hasAttached()){var e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,n=this._overlayRef.getConfig();e.position=this._cssPosition,e.marginLeft="100%"===n.width?"0":this._leftOffset,e.marginTop="100%"===n.height?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=this._rightOffset,"100%"===n.width?t.justifyContent="flex-start":"center"===this._justifyContent?t.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?t.justifyContent="flex-end":"flex-end"===this._justifyContent&&(t.justifyContent="flex-start"):t.justifyContent=this._justifyContent,t.alignItems="100%"===n.height?"flex-start":this._alignItems}}},{key:"dispose",value:function(){if(!this._isDisposed&&this._overlayRef){var e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,n=t.style;t.classList.remove("cdk-global-overlay-wrapper"),n.justifyContent=n.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}}}]),e}(),v_=((d_=function(){function e(t,n,r,a){_classCallCheck2(this,e),this._viewportRuler=t,this._document=n,this._platform=r,this._overlayContainer=a}return _createClass2(e,[{key:"global",value:function(){return new m_}},{key:"connectedTo",value:function(e,t,n){return new p_(t,n,e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}},{key:"flexibleConnectedTo",value:function(e){return new h_(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}]),e}()).ngInjectableDef=ve({factory:function(){return new d_(Fe(My),Fe(Ms),Fe(Zf),Fe(c_))},token:d_,providedIn:"root"}),d_),g_=0,y_=function(){function e(t,n,r,a,i,o,s,u,c,l){_classCallCheck2(this,e),this.scrollStrategies=t,this._overlayContainer=n,this._componentFactoryResolver=r,this._positionBuilder=a,this._keyboardDispatcher=i,this._injector=o,this._ngZone=s,this._document=u,this._directionality=c,this._location=l}return _createClass2(e,[{key:"create",value:function(e){var t=this._createHostElement(),n=this._createPaneElement(t),r=this._createPortalOutlet(n),a=new t_(e);return a.direction=a.direction||this._directionality.value,new l_(r,t,n,a,this._ngZone,this._keyboardDispatcher,this._document,this._location)}},{key:"position",value:function(){return this._positionBuilder}},{key:"_createPaneElement",value:function(e){var t=this._document.createElement("div");return t.id="cdk-overlay-"+g_++,t.classList.add("cdk-overlay-pane"),e.appendChild(t),t}},{key:"_createHostElement",value:function(){var e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}},{key:"_createPortalOutlet",value:function(e){return this._appRef||(this._appRef=this._injector.get(pi)),new qy(e,this._componentFactoryResolver,this._appRef,this._injector)}}]),e}(),__=new Ee("cdk-connected-overlay-scroll-strategy");function b_(e){return function(){return e.scrollStrategies.reposition()}}var k_=function e(){_classCallCheck2(this,e)};function w_(e){return Error('Tooltip position "'.concat(e,'" is invalid.'))}var x_=new Ee("mat-tooltip-scroll-strategy");function C_(e){return function(){return e.scrollStrategies.reposition({scrollThrottle:20})}}var S_=new Ee("mat-tooltip-default-options",{providedIn:"root",factory:function(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}}),T_=function(){function e(t,n,r,a,i,o,s,u,c,l,h,f){var d=this;_classCallCheck2(this,e),this._overlay=t,this._elementRef=n,this._scrollDispatcher=r,this._viewContainerRef=a,this._ngZone=i,this._ariaDescriber=s,this._focusMonitor=u,this._dir=l,this._defaultOptions=h,this._position="below",this._disabled=!1,this.showDelay=this._defaultOptions.showDelay,this.hideDelay=this._defaultOptions.hideDelay,this._message="",this._manualListeners=new Map,this._destroyed=new R,this._scrollStrategy=c;var p=n.nativeElement,m="undefined"==typeof window||window.Hammer||f;o.IOS||o.ANDROID?m||this._manualListeners.set("touchstart",(function(){return d.show()})):this._manualListeners.set("mouseenter",(function(){return d.show()})).set("mouseleave",(function(){return d.hide()})),this._manualListeners.forEach((function(e,t){return p.addEventListener(t,e)})),u.monitor(n).pipe(Wv(this._destroyed)).subscribe((function(e){e?"keyboard"===e&&i.run((function(){return d.show()})):i.run((function(){return d.hide(0)}))})),h&&h.position&&(this.position=h.position)}return _createClass2(e,[{key:"ngOnInit",value:function(){var e=this._elementRef.nativeElement,t=e.style;"INPUT"!==e.nodeName&&"TEXTAREA"!==e.nodeName||(t.webkitUserSelect=t.userSelect=t.msUserSelect=""),e.draggable&&"none"===t.webkitUserDrag&&(t.webkitUserDrag="")}},{key:"ngOnDestroy",value:function(){var e=this;this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._manualListeners.forEach((function(t,n){e._elementRef.nativeElement.removeEventListener(n,t)})),this._manualListeners.clear(),this._destroyed.next(),this._destroyed.complete(),this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this.message),this._focusMonitor.stopMonitoring(this._elementRef)}},{key:"show",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.showDelay;if(!this.disabled&&this.message&&(!this._isTooltipVisible()||this._tooltipInstance._showTimeoutId||this._tooltipInstance._hideTimeoutId)){var n=this._createOverlay();this._detach(),this._portal=this._portal||new By(A_,this._viewContainerRef),this._tooltipInstance=n.attach(this._portal).instance,this._tooltipInstance.afterHidden().pipe(Wv(this._destroyed)).subscribe((function(){return e._detach()})),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),this._tooltipInstance.show(t)}}},{key:"hide",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.hideDelay;this._tooltipInstance&&this._tooltipInstance.hide(e)}},{key:"toggle",value:function(){this._isTooltipVisible()?this.hide():this.show()}},{key:"_isTooltipVisible",value:function(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}},{key:"_handleKeydown",value:function(e){this._isTooltipVisible()&&27===e.keyCode&&!id(e)&&(e.preventDefault(),e.stopPropagation(),this.hide(0))}},{key:"_handleTouchend",value:function(){this.hide(this._defaultOptions.touchendHideDelay)}},{key:"_createOverlay",value:function(){var e=this;if(this._overlayRef)return this._overlayRef;var t=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),n=this._overlay.position().flexibleConnectedTo(this._elementRef).withTransformOriginOn(".mat-tooltip").withFlexibleDimensions(!1).withViewportMargin(8).withScrollableContainers(t);return n.positionChanges.pipe(Wv(this._destroyed)).subscribe((function(t){e._tooltipInstance&&t.scrollableViewProperties.isOverlayClipped&&e._tooltipInstance.isVisible()&&e._ngZone.run((function(){return e.hide(0)}))})),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:n,panelClass:"mat-tooltip-panel",scrollStrategy:this._scrollStrategy()}),this._updatePosition(),this._overlayRef.detachments().pipe(Wv(this._destroyed)).subscribe((function(){return e._detach()})),this._overlayRef}},{key:"_detach",value:function(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}},{key:"_updatePosition",value:function(){var e=this._overlayRef.getConfig().positionStrategy,t=this._getOrigin(),n=this._getOverlayPosition();e.withPositions([Object.assign({},t.main,n.main),Object.assign({},t.fallback,n.fallback)])}},{key:"_getOrigin",value:function(){var e,t=!this._dir||"ltr"==this._dir.value,n=this.position;if("above"==n||"below"==n)e={originX:"center",originY:"above"==n?"top":"bottom"};else if("before"==n||"left"==n&&t||"right"==n&&!t)e={originX:"start",originY:"center"};else{if(!("after"==n||"right"==n&&t||"left"==n&&!t))throw w_(n);e={originX:"end",originY:"center"}}var r=this._invertPosition(e.originX,e.originY);return{main:e,fallback:{originX:r.x,originY:r.y}}}},{key:"_getOverlayPosition",value:function(){var e,t=!this._dir||"ltr"==this._dir.value,n=this.position;if("above"==n)e={overlayX:"center",overlayY:"bottom"};else if("below"==n)e={overlayX:"center",overlayY:"top"};else if("before"==n||"left"==n&&t||"right"==n&&!t)e={overlayX:"end",overlayY:"center"};else{if(!("after"==n||"right"==n&&t||"left"==n&&!t))throw w_(n);e={overlayX:"start",overlayY:"center"}}var r=this._invertPosition(e.overlayX,e.overlayY);return{main:e,fallback:{overlayX:r.x,overlayY:r.y}}}},{key:"_updateTooltipMessage",value:function(){var e=this;this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),this._ngZone.onMicrotaskEmpty.asObservable().pipe(bu(1),Wv(this._destroyed)).subscribe((function(){e._tooltipInstance&&e._overlayRef.updatePosition()})))}},{key:"_setTooltipClass",value:function(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}},{key:"_invertPosition",value:function(e,t){return"above"===this.position||"below"===this.position?"top"===t?t="bottom":"bottom"===t&&(t="top"):"end"===e?e="start":"start"===e&&(e="end"),{x:e,y:t}}},{key:"position",get:function(){return this._position},set:function(e){e!==this._position&&(this._position=e,this._overlayRef&&(this._updatePosition(),this._tooltipInstance&&this._tooltipInstance.show(0),this._overlayRef.updatePosition()))}},{key:"disabled",get:function(){return this._disabled},set:function(e){this._disabled=Uf(e),this._disabled&&this.hide(0)}},{key:"message",get:function(){return this._message},set:function(e){var t=this;this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this._message),this._message=null!=e?(""+e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._updateTooltipMessage(),this._ngZone.runOutsideAngular((function(){Promise.resolve().then((function(){t._ariaDescriber.describe(t._elementRef.nativeElement,t.message)}))})))}},{key:"tooltipClass",get:function(){return this._tooltipClass},set:function(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}}]),e}(),A_=function(){function e(t,n){_classCallCheck2(this,e),this._changeDetectorRef=t,this._breakpointObserver=n,this._visibility="initial",this._closeOnInteraction=!1,this._onHide=new R,this._isHandset=this._breakpointObserver.observe("(max-width: 599.99px) and (orientation: portrait), (max-width: 959.99px) and (orientation: landscape)")}return _createClass2(e,[{key:"show",value:function(e){var t=this;this._hideTimeoutId&&(clearTimeout(this._hideTimeoutId),this._hideTimeoutId=null),this._closeOnInteraction=!0,this._showTimeoutId=setTimeout((function(){t._visibility="visible",t._showTimeoutId=null,t._markForCheck()}),e)}},{key:"hide",value:function(e){var t=this;this._showTimeoutId&&(clearTimeout(this._showTimeoutId),this._showTimeoutId=null),this._hideTimeoutId=setTimeout((function(){t._visibility="hidden",t._hideTimeoutId=null,t._markForCheck()}),e)}},{key:"afterHidden",value:function(){return this._onHide.asObservable()}},{key:"isVisible",value:function(){return"visible"===this._visibility}},{key:"ngOnDestroy",value:function(){this._onHide.complete()}},{key:"_animationStart",value:function(){this._closeOnInteraction=!1}},{key:"_animationDone",value:function(e){var t=e.toState;"hidden"!==t||this.isVisible()||this._onHide.next(),"visible"!==t&&"hidden"!==t||(this._closeOnInteraction=!0)}},{key:"_handleBodyInteraction",value:function(){this._closeOnInteraction&&this.hide(0)}},{key:"_markForCheck",value:function(){this._changeDetectorRef.markForCheck()}}]),e}(),E_=function e(){_classCallCheck2(this,e)},I_=function(){function e(t){var n=this;_classCallCheck2(this,e),this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?function(){n.headers=new Map,t.split("\n").forEach((function(e){var t=e.indexOf(":");if(t>0){var r=e.slice(0,t),a=r.toLowerCase(),i=e.slice(t+1).trim();n.maybeSetNormalizedName(r,a),n.headers.has(a)?n.headers.get(a).push(i):n.headers.set(a,[i])}}))}:function(){n.headers=new Map,Object.keys(t).forEach((function(e){var r=t[e],a=e.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(n.headers.set(a,r),n.maybeSetNormalizedName(e,a))}))}:this.headers=new Map}return _createClass2(e,[{key:"has",value:function(e){return this.init(),this.headers.has(e.toLowerCase())}},{key:"get",value:function(e){this.init();var t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}},{key:"keys",value:function(){return this.init(),Array.from(this.normalizedNames.values())}},{key:"getAll",value:function(e){return this.init(),this.headers.get(e.toLowerCase())||null}},{key:"append",value:function(e,t){return this.clone({name:e,value:t,op:"a"})}},{key:"set",value:function(e,t){return this.clone({name:e,value:t,op:"s"})}},{key:"delete",value:function(e,t){return this.clone({name:e,value:t,op:"d"})}},{key:"maybeSetNormalizedName",value:function(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}},{key:"init",value:function(){var t=this;this.lazyInit&&(this.lazyInit instanceof e?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach((function(e){return t.applyUpdate(e)})),this.lazyUpdate=null))}},{key:"copyFrom",value:function(e){var t=this;e.init(),Array.from(e.headers.keys()).forEach((function(n){t.headers.set(n,e.headers.get(n)),t.normalizedNames.set(n,e.normalizedNames.get(n))}))}},{key:"clone",value:function(t){var n=new e;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof e?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}},{key:"applyUpdate",value:function(e){var t=e.name.toLowerCase();switch(e.op){case"a":case"s":var n=e.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(e.name,t);var r=("a"===e.op?this.headers.get(t):void 0)||[];r.push.apply(r,_toConsumableArray(n)),this.headers.set(t,r);break;case"d":var a=e.value;if(a){var i=this.headers.get(t);if(!i)return;0===(i=i.filter((function(e){return-1===a.indexOf(e)}))).length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,i)}else this.headers.delete(t),this.normalizedNames.delete(t)}}},{key:"forEach",value:function(e){var t=this;this.init(),Array.from(this.normalizedNames.keys()).forEach((function(n){return e(t.normalizedNames.get(n),t.headers.get(n))}))}}]),e}(),R_=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"encodeKey",value:function(e){return O_(e)}},{key:"encodeValue",value:function(e){return O_(e)}},{key:"decodeKey",value:function(e){return decodeURIComponent(e)}},{key:"decodeValue",value:function(e){return decodeURIComponent(e)}}]),e}();function O_(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}var N_=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck2(this,e),this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new R_,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){var n=new Map;return e.length>0&&e.split("&").forEach((function(e){var r=e.indexOf("="),a=_slicedToArray2(-1==r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],2),i=a[0],o=a[1],s=n.get(i)||[];s.push(o),n.set(i,s)})),n}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach((function(e){var r=n.fromObject[e];t.map.set(e,Array.isArray(r)?r:[r])}))):this.map=null}return _createClass2(e,[{key:"has",value:function(e){return this.init(),this.map.has(e)}},{key:"get",value:function(e){this.init();var t=this.map.get(e);return t?t[0]:null}},{key:"getAll",value:function(e){return this.init(),this.map.get(e)||null}},{key:"keys",value:function(){return this.init(),Array.from(this.map.keys())}},{key:"append",value:function(e,t){return this.clone({param:e,value:t,op:"a"})}},{key:"set",value:function(e,t){return this.clone({param:e,value:t,op:"s"})}},{key:"delete",value:function(e,t){return this.clone({param:e,value:t,op:"d"})}},{key:"toString",value:function(){var e=this;return this.init(),this.keys().map((function(t){var n=e.encoder.encodeKey(t);return e.map.get(t).map((function(t){return n+"="+e.encoder.encodeValue(t)})).join("&")})).join("&")}},{key:"clone",value:function(t){var n=new e({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat([t]),n}},{key:"init",value:function(){var e=this;null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach((function(t){return e.map.set(t,e.cloneFrom.map.get(t))})),this.updates.forEach((function(t){switch(t.op){case"a":case"s":var n=("a"===t.op?e.map.get(t.param):void 0)||[];n.push(t.value),e.map.set(t.param,n);break;case"d":if(void 0===t.value){e.map.delete(t.param);break}var r=e.map.get(t.param)||[],a=r.indexOf(t.value);-1!==a&&r.splice(a,1),r.length>0?e.map.set(t.param,r):e.map.delete(t.param)}})),this.cloneFrom=this.updates=null)}}]),e}();function D_(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function P_(e){return"undefined"!=typeof Blob&&e instanceof Blob}function F_(e){return"undefined"!=typeof FormData&&e instanceof FormData}var M_=function(){function e(t,n,r,a){var i;if(_classCallCheck2(this,e),this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||a?(this.body=void 0!==r?r:null,i=a):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.params&&(this.params=i.params)),this.headers||(this.headers=new I_),this.params){var o=this.params.toString();if(0===o.length)this.urlWithParams=n;else{var s=n.indexOf("?");this.urlWithParams=n+(-1===s?"?":s<n.length-1?"&":"")+o}}else this.params=new N_,this.urlWithParams=n}return _createClass2(e,[{key:"serializeBody",value:function(){return null===this.body?null:D_(this.body)||P_(this.body)||F_(this.body)||"string"==typeof this.body?this.body:this.body instanceof N_?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}},{key:"detectContentTypeHeader",value:function(){return null===this.body||F_(this.body)?null:P_(this.body)?this.body.type||null:D_(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof N_?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null}},{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.method||this.method,r=t.url||this.url,a=t.responseType||this.responseType,i=void 0!==t.body?t.body:this.body,o=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,s=void 0!==t.reportProgress?t.reportProgress:this.reportProgress,u=t.headers||this.headers,c=t.params||this.params;return void 0!==t.setHeaders&&(u=Object.keys(t.setHeaders).reduce((function(e,n){return e.set(n,t.setHeaders[n])}),u)),t.setParams&&(c=Object.keys(t.setParams).reduce((function(e,n){return e.set(n,t.setParams[n])}),c)),new e(n,r,i,{params:c,headers:u,reportProgress:s,responseType:a,withCredentials:o})}}]),e}(),L_=function(){var e={Sent:0,UploadProgress:1,ResponseHeader:2,DownloadProgress:3,Response:4,User:5};return e[e.Sent]="Sent",e[e.UploadProgress]="UploadProgress",e[e.ResponseHeader]="ResponseHeader",e[e.DownloadProgress]="DownloadProgress",e[e.Response]="Response",e[e.User]="User",e}(),z_=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck2(this,n),(e=t.call(this,r)).type=L_.Response,e.body=void 0!==r.body?r.body:null,e}return _createClass2(n,[{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new n({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}]),n}(function(){return function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"OK";_classCallCheck2(this,e),this.headers=t.headers||new I_,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||r,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}());function B_(e,t){return{body:t,headers:e.headers,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}var j_=function(){function e(t){_classCallCheck2(this,e),this.handler=t}return _createClass2(e,[{key:"request",value:function(e,t){var n,r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e instanceof M_)n=e;else{var i=void 0;i=a.headers instanceof I_?a.headers:new I_(a.headers);var o=void 0;a.params&&(o=a.params instanceof N_?a.params:new N_({fromObject:a.params})),n=new M_(e,t,void 0!==a.body?a.body:null,{headers:i,params:o,reportProgress:a.reportProgress,responseType:a.responseType||"json",withCredentials:a.withCredentials})}var s=Ws(n).pipe(Pu((function(e){return r.handler.handle(e)})));if(e instanceof M_||"events"===a.observe)return s;var u=s.pipe(eu((function(e){return e instanceof z_})));switch(a.observe||"body"){case"body":switch(n.responseType){case"arraybuffer":return u.pipe(W((function(e){if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body})));case"blob":return u.pipe(W((function(e){if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body})));case"text":return u.pipe(W((function(e){if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body})));case"json":default:return u.pipe(W((function(e){return e.body})))}case"response":return u;default:throw new Error("Unreachable: unhandled observe type ".concat(a.observe,"}"))}}},{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("DELETE",e,t)}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("GET",e,t)}},{key:"head",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("HEAD",e,t)}},{key:"jsonp",value:function(e,t){return this.request("JSONP",e,{params:(new N_).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}},{key:"options",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("OPTIONS",e,t)}))},{key:"patch",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PATCH",e,B_(n,t))}},{key:"post",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("POST",e,B_(n,t))}},{key:"put",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PUT",e,B_(n,t))}}]),e}();function V_(e){return Error('Unable to find icon with the name "'.concat(e,'"'))}function q_(e){return Error("The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was \"".concat(e,'".'))}function U_(e){return Error("The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was \"".concat(e,'".'))}var W_,G_=function e(t,n){_classCallCheck2(this,e),this.options=n,t.nodeName?this.svgElement=t:this.url=t},H_=((W_=function(){function e(t,n,r,a){_classCallCheck2(this,e),this._httpClient=t,this._sanitizer=n,this._errorHandler=a,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._defaultFontSetClass="material-icons",this._document=r}return _createClass2(e,[{key:"addSvgIcon",value:function(e,t,n){return this.addSvgIconInNamespace("",e,t,n)}},{key:"addSvgIconLiteral",value:function(e,t,n){return this.addSvgIconLiteralInNamespace("",e,t,n)}},{key:"addSvgIconInNamespace",value:function(e,t,n,r){return this._addSvgIconConfig(e,t,new G_(n,r))}},{key:"addSvgIconLiteralInNamespace",value:function(e,t,n,r){var a=this._sanitizer.sanitize(_t.HTML,n);if(!a)throw U_(n);var i=this._createSvgElementForSingleIcon(a,r);return this._addSvgIconConfig(e,t,new G_(i,r))}},{key:"addSvgIconSet",value:function(e,t){return this.addSvgIconSetInNamespace("",e,t)}},{key:"addSvgIconSetLiteral",value:function(e,t){return this.addSvgIconSetLiteralInNamespace("",e,t)}},{key:"addSvgIconSetInNamespace",value:function(e,t,n){return this._addSvgIconSetConfig(e,new G_(t,n))}},{key:"addSvgIconSetLiteralInNamespace",value:function(e,t,n){var r=this._sanitizer.sanitize(_t.HTML,t);if(!r)throw U_(t);var a=this._svgElementFromString(r);return this._addSvgIconSetConfig(e,new G_(a,n))}},{key:"registerFontClassAlias",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this._fontCssClassesByAlias.set(e,t),this}},{key:"classNameForFontAlias",value:function(e){return this._fontCssClassesByAlias.get(e)||e}},{key:"setDefaultFontSetClass",value:function(e){return this._defaultFontSetClass=e,this}},{key:"getDefaultFontSetClass",value:function(){return this._defaultFontSetClass}},{key:"getSvgIconFromUrl",value:function(e){var t=this,n=this._sanitizer.sanitize(_t.RESOURCE_URL,e);if(!n)throw q_(e);var r=this._cachedIconsByUrl.get(n);return r?Ws(K_(r)):this._loadSvgIconFromConfig(new G_(e)).pipe(uu((function(e){return t._cachedIconsByUrl.set(n,e)})),W((function(e){return K_(e)})))}},{key:"getNamedSvgIcon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=X_(t,e),r=this._svgIconConfigs.get(n);if(r)return this._getSvgFromConfig(r);var a,i=this._iconSetConfigs.get(t);return i?this._getSvgFromIconSetConfigs(e,i):(a=V_(n),new x((function(e){return e.error(a)})))}},{key:"ngOnDestroy",value:function(){this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}},{key:"_getSvgFromConfig",value:function(e){return e.svgElement?Ws(K_(e.svgElement)):this._loadSvgIconFromConfig(e).pipe(uu((function(t){return e.svgElement=t})),W((function(e){return K_(e)})))}},{key:"_getSvgFromIconSetConfigs",value:function(e,t){var n=this,r=this._extractIconWithNameFromAnySet(e,t);return r?Ws(r):Fg(t.filter((function(e){return!e.svgElement})).map((function(e){return n._loadSvgIconSetFromConfig(e).pipe(gu((function(t){var r="Loading icon set URL: ".concat(n._sanitizer.sanitize(_t.RESOURCE_URL,e.url)," failed: ").concat(t.message);return n._errorHandler?n._errorHandler.handleError(new Error(r)):console.error(r),Ws(null)})))}))).pipe(W((function(){var r=n._extractIconWithNameFromAnySet(e,t);if(!r)throw V_(e);return r})))}},{key:"_extractIconWithNameFromAnySet",value:function(e,t){for(var n=t.length-1;n>=0;n--){var r=t[n];if(r.svgElement){var a=this._extractSvgIconFromSet(r.svgElement,e,r.options);if(a)return a}}return null}},{key:"_loadSvgIconFromConfig",value:function(e){var t=this;return this._fetchUrl(e.url).pipe(W((function(n){return t._createSvgElementForSingleIcon(n,e.options)})))}},{key:"_loadSvgIconSetFromConfig",value:function(e){var t=this;return e.svgElement?Ws(e.svgElement):this._fetchUrl(e.url).pipe(W((function(n){return e.svgElement||(e.svgElement=t._svgElementFromString(n)),e.svgElement})))}},{key:"_createSvgElementForSingleIcon",value:function(e,t){var n=this._svgElementFromString(e);return this._setSvgAttributes(n,t),n}},{key:"_extractSvgIconFromSet",value:function(e,t,n){var r=e.querySelector('[id="'.concat(t,'"]'));if(!r)return null;var a=r.cloneNode(!0);if(a.removeAttribute("id"),"svg"===a.nodeName.toLowerCase())return this._setSvgAttributes(a,n);if("symbol"===a.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(a),n);var i=this._svgElementFromString("<svg></svg>");return i.appendChild(a),this._setSvgAttributes(i,n)}},{key:"_svgElementFromString",value:function(e){var t=this._document.createElement("DIV");t.innerHTML=e;var n=t.querySelector("svg");if(!n)throw Error("<svg> tag not found");return n}},{key:"_toSvgElement",value:function(e){for(var t=this._svgElementFromString("<svg></svg>"),n=e.attributes,r=0;r<n.length;r++){var a=n[r],i=a.name,o=a.value;"id"!==i&&t.setAttribute(i,o)}for(var s=0;s<e.childNodes.length;s++)e.childNodes[s].nodeType===this._document.ELEMENT_NODE&&t.appendChild(e.childNodes[s].cloneNode(!0));return t}},{key:"_setSvgAttributes",value:function(e,t){return e.setAttribute("fit",""),e.setAttribute("height","100%"),e.setAttribute("width","100%"),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),t&&t.viewBox&&e.setAttribute("viewBox",t.viewBox),e}},{key:"_fetchUrl",value:function(e){var t=this;if(!this._httpClient)throw Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.");if(null==e)throw Error('Cannot fetch icon from URL "'.concat(e,'".'));var n=this._sanitizer.sanitize(_t.RESOURCE_URL,e);if(!n)throw q_(e);var r=this._inProgressUrlFetches.get(n);if(r)return r;var a=this._httpClient.get(n,{responseType:"text"}).pipe(Fu((function(){return t._inProgressUrlFetches.delete(n)})),ue());return this._inProgressUrlFetches.set(n,a),a}},{key:"_addSvgIconConfig",value:function(e,t,n){return this._svgIconConfigs.set(X_(e,t),n),this}},{key:"_addSvgIconSetConfig",value:function(e,t){var n=this._iconSetConfigs.get(e);return n?n.push(t):this._iconSetConfigs.set(e,[t]),this}}]),e}()).ngInjectableDef=ve({factory:function(){return new W_(Fe(j_,8),Fe(Oc),Fe(Ms,8),Fe(Xe,8))},token:W_,providedIn:"root"}),W_);function K_(e){return e.cloneNode(!0)}function X_(e,t){return e+":"+t}var Q_=zd((function e(t){_classCallCheck2(this,e),this._elementRef=t})),Y_=new Ee("mat-icon-location",{providedIn:"root",factory:function(){var e=Me(Ms),t=e?e.location:null;return{getPathname:function(){return t?t.pathname+t.search:""}}}}),Z_=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],J_=Z_.map((function(e){return"[".concat(e,"]")})).join(", "),$_=/^url\(['"]?#(.*?)['"]?\)$/,eb=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o){var s;return _classCallCheck2(this,n),(s=t.call(this,e))._iconRegistry=r,s._location=i,s._errorHandler=o,s._inline=!1,a||e.nativeElement.setAttribute("aria-hidden","true"),s}return _createClass2(n,[{key:"_splitIconName",value:function(e){if(!e)return["",""];var t=e.split(":");switch(t.length){case 1:return["",t[0]];case 2:return t;default:throw Error('Invalid icon name: "'.concat(e,'"'))}}},{key:"ngOnChanges",value:function(e){var t=this,n=e.svgIcon;if(n)if(this.svgIcon){var r=_slicedToArray2(this._splitIconName(this.svgIcon),2),a=r[0],i=r[1];this._iconRegistry.getNamedSvgIcon(i,a).pipe(bu(1)).subscribe((function(e){return t._setSvgElement(e)}),(function(e){var n="Error retrieving icon ".concat(a,":").concat(i,"! ").concat(e.message);t._errorHandler?t._errorHandler.handleError(new Error(n)):console.error(n)}))}else n.previousValue&&this._clearSvgElement();this._usingFontIcon()&&this._updateFontIconClasses()}},{key:"ngOnInit",value:function(){this._usingFontIcon()&&this._updateFontIconClasses()}},{key:"ngAfterViewChecked",value:function(){var e=this._elementsWithExternalReferences;if(e&&this._location&&e.size){var t=this._location.getPathname();t!==this._previousPath&&(this._previousPath=t,this._prependPathToReferences(t))}}},{key:"ngOnDestroy",value:function(){this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}},{key:"_usingFontIcon",value:function(){return!this.svgIcon}},{key:"_setSvgElement",value:function(e){this._clearSvgElement();for(var t=e.querySelectorAll("style"),n=0;n<t.length;n++)t[n].textContent+=" ";if(this._location){var r=this._location.getPathname();this._previousPath=r,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(r)}this._elementRef.nativeElement.appendChild(e)}},{key:"_clearSvgElement",value:function(){var e=this._elementRef.nativeElement,t=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();t--;){var n=e.childNodes[t];1===n.nodeType&&"svg"!==n.nodeName.toLowerCase()||e.removeChild(n)}}},{key:"_updateFontIconClasses",value:function(){if(this._usingFontIcon()){var e=this._elementRef.nativeElement,t=this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet):this._iconRegistry.getDefaultFontSetClass();t!=this._previousFontSetClass&&(this._previousFontSetClass&&e.classList.remove(this._previousFontSetClass),t&&e.classList.add(t),this._previousFontSetClass=t),this.fontIcon!=this._previousFontIconClass&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}}},{key:"_cleanupFontValue",value:function(e){return"string"==typeof e?e.trim().split(" ")[0]:e}},{key:"_prependPathToReferences",value:function(e){var t=this._elementsWithExternalReferences;t&&t.forEach((function(t,n){t.forEach((function(t){n.setAttribute(t.name,"url('".concat(e,"#").concat(t.value,"')"))}))}))}},{key:"_cacheChildrenWithExternalReferences",value:function(e){for(var t=e.querySelectorAll(J_),n=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map,r=function(e){Z_.forEach((function(r){var a=t[e],i=a.getAttribute(r),o=i?i.match($_):null;if(o){var s=n.get(a);s||(s=[],n.set(a,s)),s.push({name:r,value:o[1]})}}))},a=0;a<t.length;a++)r(a)}},{key:"inline",get:function(){return this._inline},set:function(e){this._inline=Uf(e)}},{key:"fontSet",get:function(){return this._fontSet},set:function(e){this._fontSet=this._cleanupFontValue(e)}},{key:"fontIcon",get:function(){return this._fontIcon},set:function(e){this._fontIcon=this._cleanupFontValue(e)}}]),n}(Q_),tb=function e(){_classCallCheck2(this,e)},nb=Wn({encapsulation:2,styles:[".mat-icon{background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1,1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],data:{}});function rb(e){return Yi(2,[Wi(null,0)],null,null)}function ab(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}var ib,ob=n("g1Bg"),sb=function(){function e(t,n){_classCallCheck2(this,e),this._snackBar=t,this.globalVar=n,this.modelRnn=new ob.MusicRNN(this.globalVar.MODEL_IMPROV_RNN),this.modelVAEMusic=new ob.MusicVAE(this.globalVar.MODEL_VAE_MELODY),this.BL_DEFAULT_QPM=120,this.BL_DEFAULT_STEPS=4,this.BL_DEFAULT_BARS=16,this.BL_DEFAULT_VARIATION=.8,this.BL_DEFAULT_CHORDS=["C","G","Am","F"],this.BL_DEFAULT_MELODY={quantizationInfo:{stepsPerQuarter:this.BL_DEFAULT_STEPS},notes:[],tempos:[{time:0,qpm:this.BL_DEFAULT_QPM}],totalQuantizedSteps:1},this.BLS_CONFIG={noteRGB:"73, 109, 145",activeNoteRGB:"255, 111, 0"},this.BLS_VISUALIZER=new ob.PianoRollCanvasVisualizer(this.BL_DEFAULT_MELODY,document.createElement("canvas"),this.BLS_CONFIG),this.playButtonText="play_arrow",this.player=new ob.SoundFontPlayer("https://storage.googleapis.com/magentadata/js/soundfonts/sgm_plus"),this.buttonActive=!0,this.readyStateRNN=!1,this.readyStateVAE=!1,this.hintColor="#ff0000",this.minPitch=48,this.maxPitch=83,this.processProgress=!1,this.PROGRESS_DATA=""}return _createClass2(e,[{key:"ngOnInit",value:function(){var e=this;this.modelRnn.initialize().then((function(){e.PROGRESS_DATA="\ud83c\udfb6 Model Initialized!",e.readyStateRNN=!0})),this.modelVAEMusic.initialize().then((function(){e.PROGRESS_DATA="\ud83c\udfb6 Model Initialized!",e.readyStateVAE=!0})),this.generateChords()}},{key:"playMusic",value:function(){var e=this;this.player.resumeContext(),"started"===this.player.getPlayState()?(this.player.pause(),this.playButtonText="play_arrow"):"paused"===this.player.getPlayState()?(this.player.resume(),this.playButtonText="pause"):"stopped"===this.player.getPlayState()&&(this.player.start(this.fullSong,this.BL_DEFAULT_QPM).then((function(){e.playMusic()})),this.playButtonText="pause")}},{key:"stopMusic",value:function(){this.playButtonText="play_arrow",this.player.stop()}},{key:"generateSamples",value:function(){return ab(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.buttonActive=!0,this.processProgress=!0,this.PROGRESS_DATA="\ud83c\udfb9 Music Generation Started!",this.chordProgression.nativeElement.querySelectorAll(".improvrnn__chords--key").forEach((function(e,t){n.BL_DEFAULT_CHORDS[t]=e.querySelector("input").value})),this.generateChords(),e.next=4,this.modelVAEMusic.sample(1,this.BL_DEFAULT_VARIATION,{chordProgression:this.BL_DEFAULT_CHORDS,extraControls:null},this.BL_DEFAULT_STEPS,this.BL_DEFAULT_QPM);case 4:return t=e.sent,console.log(t[0]),e.next=8,this.checkNoteRange(t[0]);case 8:return t[0].notes=e.sent,console.log(this.BL_DEFAULT_CHORDS,this.BL_DEFAULT_QPM,this.BL_DEFAULT_BARS,this.BL_DEFAULT_STEPS,this.BL_DEFAULT_VARIATION),this.player.stop(),e.next=13,this.modelRnn.continueSequence(t[0],this.BL_DEFAULT_STEPS*this.BL_DEFAULT_BARS,this.BL_DEFAULT_VARIATION,this.BL_DEFAULT_CHORDS);case 13:this.sampleGenerated=e.sent,this.sampleGenerated.notes.map((function(e,t){n.sampleGenerated.notes[t].program=26})),this.sampleGenerated=ob.sequences.quantizeNoteSequence(ob.sequences.unquantizeSequence(this.sampleGenerated,this.BL_DEFAULT_QPM),this.BL_DEFAULT_STEPS),console.log(this.sampleGenerated),this.BLS_VISUALIZER=new ob.PianoRollCanvasVisualizer(this.sampleGenerated,this.pianoRollCanvas.nativeElement,this.BLS_CONFIG),this.mergeNoteSequence(),this.buttonActive=!1,this.PROGRESS_DATA="\ud83c\udfb9 Music Generated!",this.processProgress=!1,e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),console.log(e.t0);case 27:case"end":return e.stop()}}),e,this,[[0,24]])})))}},{key:"checkNoteRange",value:function(e){var t=this;return new Promise((function(n,r){n(e.notes.filter((function(e){return e.pitch>=t.minPitch&&e.pitch<=t.maxPitch})))}))}},{key:"mergeNoteSequence",value:function(){return ab(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.fullSong=ob.sequences.clone(this.chordSample),e.t0=void 0!==this.sampleGenerated,!e.t0){e.next=6;break}return e.next=6,this.sampleGenerated.notes.map((function(e){t.fullSong.notes.push(e)}));case 6:console.log(this.fullSong),e.next=12;break;case 9:e.prev=9,e.t1=e.catch(0),console.log(e.t1);case 12:case"end":return e.stop()}}),e,this,[[0,9]])})))}},{key:"downloadMIDI",value:function(){this.PROGRESS_DATA="Downloaded!";var e=this.sampleGenerated;ob.sequences.isQuantizedSequence(this.sampleGenerated)||(e=ob.sequences.quantizeNoteSequence(this.sampleGenerated,1)),e.notes.forEach((function(e){return e.velocity=100}));var t=ob.sequenceProtoToMidi(e);this.globalVar.download(t,"audio/midi","melody")}},{key:"openSnackBar",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3;this._snackBar.open(e,"OK",{duration:t,panelClass:"message-snackbar",horizontalPosition:"center",verticalPosition:"top"})}},{key:"checkChord",value:function(e){console.log(e),e||(this.errorHint="\u26d4 No Chord Provided!");try{ob.chords.ChordSymbols.pitches(e),this.errorHint=""}catch(t){this.errorHint="\u26d4  "+t}}},{key:"generateChords",value:function(){var e=this;this.chordSample={quantizationInfo:{stepsPerQuarter:this.BL_DEFAULT_STEPS},notes:[],tempos:[{time:0,qpm:this.BL_DEFAULT_QPM}],totalQuantizedSteps:1},this.BL_DEFAULT_CHORDS.map((function(t,n){return ab(e,void 0,void 0,regeneratorRuntime.mark((function e(){var r,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=ob.chords.ChordSymbols.pitches(t)).map((function(e){var t={pitch:e+60,quantizedStartStep:16*n+1,quantizedEndStep:16*(n+1)};console.log(e,t),a.chordSample.notes.push(t)})),this.chordSample=ob.sequences.mergeInstruments(this.chordSample),this.chordSample.notes.map((function(e,t){a.chordSample.notes[t].program=4})),console.log(this.chordSample),console.log(t,r);case 2:case"end":return e.stop()}}),e,this)})))}))}},{key:"getTempo",value:function(e){this.BL_DEFAULT_QPM=parseInt(e)}}]),e}(),ub=function(){function e(t,n){var r=this;_classCallCheck2(this,e),this._overlayRef=n,this._afterDismissed=new R,this._afterOpened=new R,this._onAction=new R,this._dismissedByAction=!1,this.containerInstance=t,this.onAction().subscribe((function(){return r.dismiss()})),t._onExit.subscribe((function(){return r._finishDismiss()}))}return _createClass2(e,[{key:"dismiss",value:function(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}},{key:"dismissWithAction",value:function(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete())}},{key:"closeWithAction",value:function(){this.dismissWithAction()}},{key:"_dismissAfter",value:function(e){var t=this;this._durationTimeoutId=setTimeout((function(){return t.dismiss()}),e)}},{key:"_open",value:function(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}},{key:"_finishDismiss",value:function(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}},{key:"afterDismissed",value:function(){return this._afterDismissed.asObservable()}},{key:"afterOpened",value:function(){return this.containerInstance._onEnter}},{key:"onAction",value:function(){return this._onAction.asObservable()}}]),e}(),cb=new Ee("MatSnackBarData"),lb=function e(){_classCallCheck2(this,e),this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"},hb=function(){function e(t,n){_classCallCheck2(this,e),this.snackBarRef=t,this.data=n}return _createClass2(e,[{key:"action",value:function(){this.snackBarRef.dismissWithAction()}},{key:"hasAction",get:function(){return!!this.data.action}}]),e}(),fb=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this))._ngZone=e,o._elementRef=r,o._changeDetectorRef=a,o.snackBarConfig=i,o._destroyed=!1,o._onExit=new R,o._onEnter=new R,o._animationState="void",o._role="assertive"!==i.politeness||i.announcementMessage?"off"===i.politeness?null:"status":"alert",o}return _createClass2(n,[{key:"attachComponentPortal",value:function(e){return this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachComponentPortal(e)}},{key:"attachTemplatePortal",value:function(e){return this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachTemplatePortal(e)}},{key:"onAnimationEnd",value:function(e){var t=e.fromState,n=e.toState;if(("void"===n&&"void"!==t||"hidden"===n)&&this._completeExit(),"visible"===n){var r=this._onEnter;this._ngZone.run((function(){r.next(),r.complete()}))}}},{key:"enter",value:function(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}},{key:"exit",value:function(){return this._animationState="hidden",this._onExit}},{key:"ngOnDestroy",value:function(){this._destroyed=!0,this._completeExit()}},{key:"_completeExit",value:function(){var e=this;this._ngZone.onMicrotaskEmpty.asObservable().pipe(bu(1)).subscribe((function(){e._onExit.next(),e._onExit.complete()}))}},{key:"_applySnackBarClasses",value:function(){var e=this._elementRef.nativeElement,t=this.snackBarConfig.panelClass;t&&(Array.isArray(t)?t.forEach((function(t){return e.classList.add(t)})):e.classList.add(t)),"center"===this.snackBarConfig.horizontalPosition&&e.classList.add("mat-snack-bar-center"),"top"===this.snackBarConfig.verticalPosition&&e.classList.add("mat-snack-bar-top")}},{key:"_assertNotAttached",value:function(){if(this._portalOutlet.hasAttached())throw Error("Attempting to attach snack bar content after content is already attached")}}]),n}(Vy),db=function e(){_classCallCheck2(this,e)},pb=new Ee("mat-snack-bar-default-options",{providedIn:"root",factory:function(){return new lb}}),mb=((ib=function(){function e(t,n,r,a,i,o){_classCallCheck2(this,e),this._overlay=t,this._live=n,this._injector=r,this._breakpointObserver=a,this._parentSnackBar=i,this._defaultConfig=o,this._snackBarRefAtThisLevel=null}return _createClass2(e,[{key:"openFromComponent",value:function(e,t){return this._attach(e,t)}},{key:"openFromTemplate",value:function(e,t){return this._attach(e,t)}},{key:"open",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r=Object.assign({},this._defaultConfig,n);return r.data={message:e,action:t},r.announcementMessage||(r.announcementMessage=e),this.openFromComponent(hb,r)}},{key:"dismiss",value:function(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}},{key:"ngOnDestroy",value:function(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}},{key:"_attachSnackBarContainer",value:function(e,t){var n=new Gy(t&&t.viewContainerRef&&t.viewContainerRef.injector||this._injector,new WeakMap([[lb,t]])),r=new By(fb,t.viewContainerRef,n),a=e.attach(r);return a.instance.snackBarConfig=t,a.instance}},{key:"_attach",value:function(e,t){var n=Object.assign({},new lb,this._defaultConfig,t),r=this._createOverlay(n),a=this._attachSnackBarContainer(r,n),i=new ub(a,r);if(e instanceof Tn){var o=new jy(e,null,{$implicit:n.data,snackBarRef:i});i.instance=a.attachTemplatePortal(o)}else{var s=this._createInjector(n,i),u=new By(e,void 0,s),c=a.attachComponentPortal(u);i.instance=c.instance}return this._breakpointObserver.observe("(max-width: 599.99px) and (orientation: portrait)").pipe(Wv(r.detachments())).subscribe((function(e){var t=r.overlayElement.classList;e.matches?t.add("mat-snack-bar-handset"):t.remove("mat-snack-bar-handset")})),this._animateSnackBar(i,n),this._openedSnackBarRef=i,this._openedSnackBarRef}},{key:"_animateSnackBar",value:function(e,t){var n=this;e.afterDismissed().subscribe((function(){n._openedSnackBarRef==e&&(n._openedSnackBarRef=null),t.announcementMessage&&n._live.clear()})),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe((function(){e.containerInstance.enter()})),this._openedSnackBarRef.dismiss()):e.containerInstance.enter(),t.duration&&t.duration>0&&e.afterOpened().subscribe((function(){return e._dismissAfter(t.duration)})),t.announcementMessage&&this._live.announce(t.announcementMessage,t.politeness)}},{key:"_createOverlay",value:function(e){var t=new t_;t.direction=e.direction;var n=this._overlay.position().global(),r="rtl"===e.direction,a="left"===e.horizontalPosition||"start"===e.horizontalPosition&&!r||"end"===e.horizontalPosition&&r,i=!a&&"center"!==e.horizontalPosition;return a?n.left("0"):i?n.right("0"):n.centerHorizontally(),"top"===e.verticalPosition?n.top("0"):n.bottom("0"),t.positionStrategy=n,this._overlay.create(t)}},{key:"_createInjector",value:function(e,t){return new Gy(e&&e.viewContainerRef&&e.viewContainerRef.injector||this._injector,new WeakMap([[ub,t],[cb,e.data]]))}},{key:"_openedSnackBarRef",get:function(){var e=this._parentSnackBar;return e?e._openedSnackBarRef:this._snackBarRefAtThisLevel},set:function(e){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=e:this._snackBarRefAtThisLevel=e}}]),e}()).ngInjectableDef=ve({factory:function(){return new ib(Fe(y_),Fe(Rd),Fe(Ie),Fe(Ey),Fe(ib,12),Fe(pb))},token:ib,providedIn:db}),ib),vb=function(){function e(){_classCallCheck2(this,e),this.MODEL_IMPROV_RNN="https://storage.googleapis.com/magentadata/js/checkpoints/music_rnn/chord_pitches_improv",this.MODEL_VAE_MELODY="assets/checkpoints/mel_chords",this.MODEL_DRUM_GROOVE="https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/groovae_4bar",this.MODEL_VAE_DRUMS="assets/checkpoints/groovae_4bar",this.MODEL_MIDIME="assets/checkpoints/onset_frames"}return _createClass2(e,[{key:"download",value:function(e,t,n){var r=new Blob([e],{type:t}),a=(URL.createObjectURL(r),document.createElement("a")),i=URL.createObjectURL(r);a.href=i;var o=t.split("/");a.download="buddhilive_"+n+"_"+Date.now()+"."+o[1],a.click()}},{key:"uploadFile",value:function(e){var t=this;return new Promise((function(n,r){var a,i=e.target.files[0],o=new FileReader;o.onload=function(e){return ab(t,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=e.target.result,n(a);case 1:case"end":return t.stop()}}),t)})))},o.readAsDataURL(i)}))}}]),e}(),gb=Wn({encapsulation:0,styles:[[""]],data:{}});function yb(e){return Yi(0,[(e()(),Pi(0,0,null,null,7,"div",[["class","row improvrnn__loader"]],null,null,null,null,null)),(e()(),Pi(1,0,null,null,3,"div",[["class","col-md-12"]],null,null,null,null,null)),(e()(),Pi(2,0,null,null,1,"mat-spinner",[["class","mat-spinner mat-progress-spinner"],["mode","indeterminate"],["role","progressbar"]],[[2,"_mat-animation-noopable",null],[4,"width","px"],[4,"height","px"]],null,null,Lv,Pv)),ea(3,114688,null,0,Nv,[nn,Zf,[2,Ms],[2,kv],Ov],null,null),(e()(),Ki(-1,null,[" Intializing Model... "])),(e()(),Pi(5,0,null,null,2,"div",[["class","col-md-12"]],null,null,null,null,null)),(e()(),Pi(6,0,null,null,1,"ng-adsense",[],null,null,null,qv,Vv)),ea(7,4440064,null,0,Bv,[zv,Ra],{adClient:[0,"adClient"],adSlot:[1,"adSlot"],display:[2,"display"],width:[3,"width"],height:[4,"height"]},null)],(function(e,t){e(t,3,0),e(t,7,0,"ca-pub-9435032914308988",5595610335,"inline-block",300,250)}),(function(e,t){e(t,2,0,Vr(t,3)._noopAnimations,Vr(t,3).diameter,Vr(t,3).diameter)}))}function _b(e){return Yi(0,[(e()(),Pi(0,0,null,null,17,"div",[["class","col-md-3"]],null,null,null,null,null)),(e()(),Pi(1,0,null,null,16,"mat-form-field",[["appearance","fill"],["class","improvrnn__chords--key mat-form-field"]],[[2,"mat-form-field-appearance-standard",null],[2,"mat-form-field-appearance-fill",null],[2,"mat-form-field-appearance-outline",null],[2,"mat-form-field-appearance-legacy",null],[2,"mat-form-field-invalid",null],[2,"mat-form-field-can-float",null],[2,"mat-form-field-should-float",null],[2,"mat-form-field-has-label",null],[2,"mat-form-field-hide-placeholder",null],[2,"mat-form-field-disabled",null],[2,"mat-form-field-autofilled",null],[2,"mat-focused",null],[2,"mat-accent",null],[2,"mat-warn",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null],[2,"_mat-animation-noopable",null]],null,null,kg,cg)),ea(2,7520256,null,9,rg,[nn,St,[2,ap],[2,jf],[2,ng],Zf,Ya,[2,kv]],{appearance:[0,"appearance"]},null),Bi(603979776,3,{_controlNonStatic:0}),Bi(335544320,4,{_controlStatic:0}),Bi(603979776,5,{_labelChildNonStatic:0}),Bi(335544320,6,{_labelChildStatic:0}),Bi(603979776,7,{_placeholderChild:0}),Bi(603979776,8,{_errorChildren:1}),Bi(603979776,9,{_hintChildren:1}),Bi(603979776,10,{_prefixChildren:1}),Bi(603979776,11,{_suffixChildren:1}),(e()(),Pi(12,0,null,3,2,"mat-label",[],null,null,null,null,null)),ea(13,16384,[[5,4],[6,4]],0,$v,[],null,null),(e()(),Ki(14,null,["",""])),(e()(),Pi(15,0,null,1,2,"input",[["class","mat-input-element mat-form-field-autofill-control"],["matInput",""]],[[2,"mat-input-server",null],[1,"id",0],[1,"placeholder",0],[8,"disabled",0],[8,"required",0],[1,"readonly",0],[1,"aria-describedby",0],[1,"aria-invalid",0],[1,"aria-required",0]],[[null,"change"],[null,"blur"],[null,"focus"],[null,"input"]],(function(e,t,n){var r=!0,a=e.component;return"blur"===t&&(r=!1!==Vr(e,16)._focusChanged(!1)&&r),"focus"===t&&(r=!1!==Vr(e,16)._focusChanged(!0)&&r),"input"===t&&(r=!1!==Vr(e,16)._onInput()&&r),"change"===t&&(r=!1!==a.checkChord(n.target.value)&&r),r}),null,null)),ea(16,999424,null,0,Dg,[nn,Zf,[8,null],[2,ly],[2,hy],Vd,[8,null],Ig,Ya],{placeholder:[0,"placeholder"],value:[1,"value"]},null),ta(2048,[[3,4],[4,4]],Kv,null,[Dg])],(function(e,t){e(t,2,0,"fill"),e(t,16,0,gr(1,"",t.context.$implicit,""),gr(1,"",t.context.$implicit,""))}),(function(e,t){e(t,1,1,["standard"==Vr(t,2).appearance,"fill"==Vr(t,2).appearance,"outline"==Vr(t,2).appearance,"legacy"==Vr(t,2).appearance,Vr(t,2)._control.errorState,Vr(t,2)._canLabelFloat,Vr(t,2)._shouldLabelFloat(),Vr(t,2)._hasFloatingLabel(),Vr(t,2)._hideControlPlaceholder(),Vr(t,2)._control.disabled,Vr(t,2)._control.autofilled,Vr(t,2)._control.focused,"accent"==Vr(t,2).color,"warn"==Vr(t,2).color,Vr(t,2)._shouldForward("untouched"),Vr(t,2)._shouldForward("touched"),Vr(t,2)._shouldForward("pristine"),Vr(t,2)._shouldForward("dirty"),Vr(t,2)._shouldForward("valid"),Vr(t,2)._shouldForward("invalid"),Vr(t,2)._shouldForward("pending"),!Vr(t,2)._animationsEnabled]),e(t,14,0,t.context.index+1),e(t,15,0,Vr(t,16)._isServer,Vr(t,16).id,Vr(t,16).placeholder,Vr(t,16).disabled,Vr(t,16).required,Vr(t,16).readonly&&!Vr(t,16)._isNativeSelect||null,Vr(t,16)._ariaDescribedby||null,Vr(t,16).errorState,Vr(t,16).required.toString())}))}function bb(e){return Yi(0,[(e()(),Pi(0,0,null,null,68,"div",[["class","improvrnn__wrapper"]],null,null,null,null,null)),(e()(),Pi(1,0,null,null,1,"p",[],null,null,null,null,null)),(e()(),Ki(-1,null,["Chord Progression"])),(e()(),Pi(3,0,[[1,0],["chordProgression",1]],null,2,"div",[["class","row improvrnn__chords"]],null,null,null,null,null)),(e()(),Di(16777216,null,null,1,null,_b)),ea(5,278528,null,0,bs,[En,Tn,kn],{ngForOf:[0,"ngForOf"]},null),(e()(),Pi(6,0,null,null,5,"mat-hint",[["class","improvrnn__chords--error mat-hint"]],[[2,"mat-right",null],[1,"id",0],[1,"align",0]],null,null,null,null)),ta(512,null,Es,Is,[nn,wn,sn]),ea(8,278528,null,0,Rs,[Es],{ngStyle:[0,"ngStyle"]},null),Hi(9,{color:0}),ea(10,16384,null,0,Jv,[],null,null),(e()(),Ki(11,null,["",""])),(e()(),Pi(12,0,null,null,18,"div",[["class","row improvrnn__settings"]],null,null,null,null,null)),(e()(),Pi(13,0,null,null,17,"div",[["class","col-md-12"]],null,null,null,null,null)),(e()(),Pi(14,0,null,null,16,"mat-form-field",[["appearance","fill"],["class","improvrnn__settings--num mat-form-field"]],[[2,"mat-form-field-appearance-standard",null],[2,"mat-form-field-appearance-fill",null],[2,"mat-form-field-appearance-outline",null],[2,"mat-form-field-appearance-legacy",null],[2,"mat-form-field-invalid",null],[2,"mat-form-field-can-float",null],[2,"mat-form-field-should-float",null],[2,"mat-form-field-has-label",null],[2,"mat-form-field-hide-placeholder",null],[2,"mat-form-field-disabled",null],[2,"mat-form-field-autofilled",null],[2,"mat-focused",null],[2,"mat-accent",null],[2,"mat-warn",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null],[2,"_mat-animation-noopable",null]],null,null,kg,cg)),ea(15,7520256,null,9,rg,[nn,St,[2,ap],[2,jf],[2,ng],Zf,Ya,[2,kv]],{appearance:[0,"appearance"]},null),Bi(603979776,12,{_controlNonStatic:0}),Bi(335544320,13,{_controlStatic:0}),Bi(603979776,14,{_labelChildNonStatic:0}),Bi(335544320,15,{_labelChildStatic:0}),Bi(603979776,16,{_placeholderChild:0}),Bi(603979776,17,{_errorChildren:1}),Bi(603979776,18,{_hintChildren:1}),Bi(603979776,19,{_prefixChildren:1}),Bi(603979776,20,{_suffixChildren:1}),(e()(),Pi(25,0,null,3,2,"mat-label",[],null,null,null,null,null)),ea(26,16384,[[14,4],[15,4]],0,$v,[],null,null),(e()(),Ki(27,null,["Tempo: ",""])),(e()(),Pi(28,0,null,1,2,"input",[["class","mat-input-element mat-form-field-autofill-control"],["matInput",""],["type","number"]],[[2,"mat-input-server",null],[1,"id",0],[1,"placeholder",0],[8,"disabled",0],[8,"required",0],[1,"readonly",0],[1,"aria-describedby",0],[1,"aria-invalid",0],[1,"aria-required",0]],[[null,"change"],[null,"value"],[null,"blur"],[null,"focus"],[null,"input"]],(function(e,t,n){var r=!0,a=e.component;return"blur"===t&&(r=!1!==Vr(e,29)._focusChanged(!1)&&r),"focus"===t&&(r=!1!==Vr(e,29)._focusChanged(!0)&&r),"input"===t&&(r=!1!==Vr(e,29)._onInput()&&r),"change"===t&&(r=!1!==a.getTempo(n.target.value)&&r),"value"===t&&(r=!1!==a.BL_DEFAULT_QPM&&r),r}),null,null)),ea(29,999424,null,0,Dg,[nn,Zf,[8,null],[2,ly],[2,hy],Vd,[8,null],Ig,Ya],{type:[0,"type"]},null),ta(2048,[[12,4],[13,4]],Kv,null,[Dg]),(e()(),Pi(31,0,null,null,3,"div",[["class","row improvrnn__log"]],null,null,null,null,null)),(e()(),Pi(32,0,null,null,2,"div",[["class","col-lg-12 col-md-12"]],null,null,null,null,null)),(e()(),Pi(33,0,null,null,1,"p",[["class","tonebreaker__log--message"]],[[2,"progress",null]],null,null,null,null)),(e()(),Ki(34,null,["",""])),(e()(),Pi(35,0,null,null,4,"div",[["class","row improvrnn__player"]],null,null,null,null,null)),(e()(),Pi(36,0,null,null,3,"div",[["class","col-md-12"]],null,null,null,null,null)),(e()(),Pi(37,0,null,null,2,"mat-card",[["class","mat-card"]],[[2,"_mat-animation-noopable",null]],null,null,Cv,xv)),ea(38,49152,null,0,Lf,[[2,kv]],null,null),(e()(),Pi(39,0,[[2,0],["pianoRollCanvas",1]],0,0,"canvas",[["class","improvrnn__player--canvas"]],null,null,null,null,null)),(e()(),Pi(40,0,null,null,28,"div",[["class","row improvrnn__controls"]],null,null,null,null,null)),(e()(),Pi(41,0,null,null,6,"div",[["class","col-md-3"]],null,null,null,null,null)),(e()(),Pi(42,16777216,null,null,5,"button",[["color","accent"],["mat-fab",""],["matTooltip","Play Music"],["matTooltipClass","tooltip-class"]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],(function(e,t,n){var r=!0,a=e.component;return"longpress"===t&&(r=!1!==Vr(e,44).show()&&r),"keydown"===t&&(r=!1!==Vr(e,44)._handleKeydown(n)&&r),"touchend"===t&&(r=!1!==Vr(e,44)._handleTouchend()&&r),"click"===t&&(r=!1!==a.playMusic()&&r),r}),gy,vy)),ea(43,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),ea(44,212992,null,0,T_,[y_,nn,Py,En,Ya,Zf,_d,Nd,x_,[2,jf],[2,S_],[2,Tc]],{message:[0,"message"],tooltipClass:[1,"tooltipClass"]},null),(e()(),Pi(45,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(46,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(47,0,["",""])),(e()(),Pi(48,0,null,null,6,"div",[["class","col-md-3"]],null,null,null,null,null)),(e()(),Pi(49,16777216,null,null,5,"button",[["color","warn"],["mat-fab",""],["matTooltip","Stop Music"],["matTooltipClass","tooltip-class"]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],(function(e,t,n){var r=!0,a=e.component;return"longpress"===t&&(r=!1!==Vr(e,51).show()&&r),"keydown"===t&&(r=!1!==Vr(e,51)._handleKeydown(n)&&r),"touchend"===t&&(r=!1!==Vr(e,51)._handleTouchend()&&r),"click"===t&&(r=!1!==a.stopMusic()&&r),r}),gy,vy)),ea(50,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),ea(51,212992,null,0,T_,[y_,nn,Py,En,Ya,Zf,_d,Nd,x_,[2,jf],[2,S_],[2,Tc]],{message:[0,"message"],tooltipClass:[1,"tooltipClass"]},null),(e()(),Pi(52,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(53,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(-1,0,["stop"])),(e()(),Pi(55,0,null,null,6,"div",[["class","col-md-3"]],null,null,null,null,null)),(e()(),Pi(56,16777216,null,null,5,"button",[["color","primary"],["mat-fab",""],["matTooltip","Generate Melody"],["matTooltipClass","tooltip-class"]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],(function(e,t,n){var r=!0,a=e.component;return"longpress"===t&&(r=!1!==Vr(e,58).show()&&r),"keydown"===t&&(r=!1!==Vr(e,58)._handleKeydown(n)&&r),"touchend"===t&&(r=!1!==Vr(e,58)._handleTouchend()&&r),"click"===t&&(r=!1!==a.generateSamples()&&r),r}),gy,vy)),ea(57,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),ea(58,212992,null,0,T_,[y_,nn,Py,En,Ya,Zf,_d,Nd,x_,[2,jf],[2,S_],[2,Tc]],{message:[0,"message"],tooltipClass:[1,"tooltipClass"]},null),(e()(),Pi(59,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(60,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(-1,0,["music_note"])),(e()(),Pi(62,0,null,null,6,"div",[["class","col-md-3"]],null,null,null,null,null)),(e()(),Pi(63,16777216,null,null,5,"button",[["color","primary"],["mat-fab",""],["matTooltip","Download MIDI"],["matTooltipClass","tooltip-class"]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],(function(e,t,n){var r=!0,a=e.component;return"longpress"===t&&(r=!1!==Vr(e,65).show()&&r),"keydown"===t&&(r=!1!==Vr(e,65)._handleKeydown(n)&&r),"touchend"===t&&(r=!1!==Vr(e,65)._handleTouchend()&&r),"click"===t&&(r=!1!==a.downloadMIDI()&&r),r}),gy,vy)),ea(64,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),ea(65,212992,null,0,T_,[y_,nn,Py,En,Ya,Zf,_d,Nd,x_,[2,jf],[2,S_],[2,Tc]],{message:[0,"message"],tooltipClass:[1,"tooltipClass"]},null),(e()(),Pi(66,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(67,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(-1,0,["cloud_download"]))],(function(e,t){var n=t.component;e(t,5,0,n.BL_DEFAULT_CHORDS);var r=e(t,9,0,n.hintColor);e(t,8,0,r),e(t,15,0,"fill"),e(t,29,0,"number"),e(t,43,0,n.buttonActive,"accent"),e(t,44,0,"Play Music","tooltip-class"),e(t,46,0),e(t,50,0,n.buttonActive,"warn"),e(t,51,0,"Stop Music","tooltip-class"),e(t,53,0),e(t,57,0,!n.readyStateRNN&&!n.readyStateVAE,"primary"),e(t,58,0,"Generate Melody","tooltip-class"),e(t,60,0),e(t,64,0,n.buttonActive,"primary"),e(t,65,0,"Download MIDI","tooltip-class"),e(t,67,0)}),(function(e,t){var n=t.component;e(t,6,0,"end"==Vr(t,10).align,Vr(t,10).id,null),e(t,11,0,n.errorHint),e(t,14,1,["standard"==Vr(t,15).appearance,"fill"==Vr(t,15).appearance,"outline"==Vr(t,15).appearance,"legacy"==Vr(t,15).appearance,Vr(t,15)._control.errorState,Vr(t,15)._canLabelFloat,Vr(t,15)._shouldLabelFloat(),Vr(t,15)._hasFloatingLabel(),Vr(t,15)._hideControlPlaceholder(),Vr(t,15)._control.disabled,Vr(t,15)._control.autofilled,Vr(t,15)._control.focused,"accent"==Vr(t,15).color,"warn"==Vr(t,15).color,Vr(t,15)._shouldForward("untouched"),Vr(t,15)._shouldForward("touched"),Vr(t,15)._shouldForward("pristine"),Vr(t,15)._shouldForward("dirty"),Vr(t,15)._shouldForward("valid"),Vr(t,15)._shouldForward("invalid"),Vr(t,15)._shouldForward("pending"),!Vr(t,15)._animationsEnabled]),e(t,27,0,n.BL_DEFAULT_QPM),e(t,28,0,Vr(t,29)._isServer,Vr(t,29).id,Vr(t,29).placeholder,Vr(t,29).disabled,Vr(t,29).required,Vr(t,29).readonly&&!Vr(t,29)._isNativeSelect||null,Vr(t,29)._ariaDescribedby||null,Vr(t,29).errorState,Vr(t,29).required.toString()),e(t,33,0,n.processProgress),e(t,34,0,n.PROGRESS_DATA),e(t,37,0,"NoopAnimations"===Vr(t,38)._animationMode),e(t,42,0,Vr(t,43).disabled||null,"NoopAnimations"===Vr(t,43)._animationMode),e(t,45,0,Vr(t,46).inline,"primary"!==Vr(t,46).color&&"accent"!==Vr(t,46).color&&"warn"!==Vr(t,46).color),e(t,47,0,n.playButtonText),e(t,49,0,Vr(t,50).disabled||null,"NoopAnimations"===Vr(t,50)._animationMode),e(t,52,0,Vr(t,53).inline,"primary"!==Vr(t,53).color&&"accent"!==Vr(t,53).color&&"warn"!==Vr(t,53).color),e(t,56,0,Vr(t,57).disabled||null,"NoopAnimations"===Vr(t,57)._animationMode),e(t,59,0,Vr(t,60).inline,"primary"!==Vr(t,60).color&&"accent"!==Vr(t,60).color&&"warn"!==Vr(t,60).color),e(t,63,0,Vr(t,64).disabled||null,"NoopAnimations"===Vr(t,64)._animationMode),e(t,66,0,Vr(t,67).inline,"primary"!==Vr(t,67).color&&"accent"!==Vr(t,67).color&&"warn"!==Vr(t,67).color)}))}function kb(e){return Yi(0,[Bi(671088640,1,{chordProgression:0}),Bi(671088640,2,{pianoRollCanvas:0}),(e()(),Pi(2,0,null,null,4,"div",[["class","container improvrnn"]],null,null,null,null,null)),(e()(),Di(16777216,null,null,1,null,yb)),ea(4,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null),(e()(),Di(16777216,null,null,1,null,bb)),ea(6,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null)],(function(e,t){var n=t.component;e(t,4,0,!n.readyStateRNN||!n.readyStateVAE),e(t,6,0,n.readyStateRNN&&n.readyStateVAE)}),null)}var wb=Rr("app-trios",sb,(function(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"app-trios",[],null,null,null,kb,gb)),ea(1,114688,null,0,sb,[mb,vb],null,null)],(function(e,t){e(t,1,0)}),null)}),{},{},[]),xb=function e(){_classCallCheck2(this,e)},Cb=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o,s){var u;return _classCallCheck2(this,n),(u=t.call(this,e))._focusMonitor=r,u._changeDetectorRef=a,u._dir=i,u._animationMode=s,u._invert=!1,u._max=100,u._min=0,u._step=1,u._thumbLabel=!1,u._tickInterval=0,u._value=null,u._vertical=!1,u.change=new ka,u.input=new ka,u.valueChange=new ka,u.onTouched=function(){},u._percent=0,u._isSliding=!1,u._isActive=!1,u._tickIntervalPercent=0,u._sliderDimensions=null,u._controlValueAccessorChangeFn=function(){},u._dirChangeSubscription=d.EMPTY,u.tabIndex=parseInt(o)||0,u}return _createClass2(n,[{key:"focus",value:function(e){this._focusHostElement(e)}},{key:"blur",value:function(){this._blurHostElement()}},{key:"_shouldInvertMouseCoords",value:function(){return"rtl"!=this._getDirection()||this.vertical?this._invertAxis:!this._invertAxis}},{key:"_getDirection",value:function(){return this._dir&&"rtl"==this._dir.value?"rtl":"ltr"}},{key:"ngOnInit",value:function(){var e=this;this._focusMonitor.monitor(this._elementRef,!0).subscribe((function(t){e._isActive=!!t&&"keyboard"!==t,e._changeDetectorRef.detectChanges()})),this._dir&&(this._dirChangeSubscription=this._dir.change.subscribe((function(){e._changeDetectorRef.markForCheck()})))}},{key:"ngOnDestroy",value:function(){this._focusMonitor.stopMonitoring(this._elementRef),this._dirChangeSubscription.unsubscribe()}},{key:"_onMouseenter",value:function(){this.disabled||(this._sliderDimensions=this._getSliderDimensions(),this._updateTickIntervalPercent())}},{key:"_onMousedown",value:function(e){if(!this.disabled&&0===e.button){var t=this.value;this._isSliding=!1,this._focusHostElement(),this._updateValueFromPosition({x:e.clientX,y:e.clientY}),t!=this.value&&(this._emitInputEvent(),this._emitChangeEvent())}}},{key:"_onSlide",value:function(e){if(!this.disabled){this._isSliding||this._onSlideStart(null),e.preventDefault();var t=this.value;this._updateValueFromPosition({x:e.center.x,y:e.center.y}),t!=this.value&&this._emitInputEvent()}}},{key:"_onSlideStart",value:function(e){this.disabled||this._isSliding||(this._onMouseenter(),this._isSliding=!0,this._focusHostElement(),this._valueOnSlideStart=this.value,e&&(this._updateValueFromPosition({x:e.center.x,y:e.center.y}),e.preventDefault()))}},{key:"_onSlideEnd",value:function(){this._isSliding=!1,this._valueOnSlideStart==this.value||this.disabled||this._emitChangeEvent(),this._valueOnSlideStart=null}},{key:"_onFocus",value:function(){this._sliderDimensions=this._getSliderDimensions(),this._updateTickIntervalPercent()}},{key:"_onBlur",value:function(){this.onTouched()}},{key:"_onKeydown",value:function(e){if(!this.disabled&&!id(e)){var t=this.value;switch(e.keyCode){case 33:this._increment(10);break;case 34:this._increment(-10);break;case 35:this.value=this.max;break;case 36:this.value=this.min;break;case 37:this._increment("rtl"==this._getDirection()?1:-1);break;case 38:this._increment(1);break;case 39:this._increment("rtl"==this._getDirection()?-1:1);break;case 40:this._increment(-1);break;default:return}t!=this.value&&(this._emitInputEvent(),this._emitChangeEvent()),this._isSliding=!0,e.preventDefault()}}},{key:"_onKeyup",value:function(){this._isSliding=!1}},{key:"_increment",value:function(e){this.value=this._clamp((this.value||0)+this.step*e,this.min,this.max)}},{key:"_updateValueFromPosition",value:function(e){if(this._sliderDimensions){var t=this._clamp(((this.vertical?e.y:e.x)-(this.vertical?this._sliderDimensions.top:this._sliderDimensions.left))/(this.vertical?this._sliderDimensions.height:this._sliderDimensions.width));if(this._shouldInvertMouseCoords()&&(t=1-t),0===t)this.value=this.min;else if(1===t)this.value=this.max;else{var n=this._calculateValue(t),r=Math.round((n-this.min)/this.step)*this.step+this.min;this.value=this._clamp(r,this.min,this.max)}}}},{key:"_emitChangeEvent",value:function(){this._controlValueAccessorChangeFn(this.value),this.valueChange.emit(this.value),this.change.emit(this._createChangeEvent())}},{key:"_emitInputEvent",value:function(){this.input.emit(this._createChangeEvent())}},{key:"_updateTickIntervalPercent",value:function(){if(this.tickInterval&&this._sliderDimensions)if("auto"==this.tickInterval){var e=this.vertical?this._sliderDimensions.height:this._sliderDimensions.width,t=Math.ceil(30/(e*this.step/(this.max-this.min)));this._tickIntervalPercent=t*this.step/e}else this._tickIntervalPercent=this.tickInterval*this.step/(this.max-this.min)}},{key:"_createChangeEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.value,t=new xb;return t.source=this,t.value=e,t}},{key:"_calculatePercentage",value:function(e){return((e||0)-this.min)/(this.max-this.min)}},{key:"_calculateValue",value:function(e){return this.min+e*(this.max-this.min)}},{key:"_clamp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.max(t,Math.min(e,n))}},{key:"_getSliderDimensions",value:function(){return this._sliderWrapper?this._sliderWrapper.nativeElement.getBoundingClientRect():null}},{key:"_focusHostElement",value:function(e){this._elementRef.nativeElement.focus(e)}},{key:"_blurHostElement",value:function(){this._elementRef.nativeElement.blur()}},{key:"writeValue",value:function(e){this.value=e}},{key:"registerOnChange",value:function(e){this._controlValueAccessorChangeFn=e}},{key:"registerOnTouched",value:function(e){this.onTouched=e}},{key:"setDisabledState",value:function(e){this.disabled=e}},{key:"invert",get:function(){return this._invert},set:function(e){this._invert=Uf(e)}},{key:"max",get:function(){return this._max},set:function(e){this._max=Wf(e,this._max),this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}},{key:"min",get:function(){return this._min},set:function(e){this._min=Wf(e,this._min),null===this._value&&(this.value=this._min),this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}},{key:"step",get:function(){return this._step},set:function(e){this._step=Wf(e,this._step),this._step%1!=0&&(this._roundToDecimal=this._step.toString().split(".").pop().length),this._changeDetectorRef.markForCheck()}},{key:"thumbLabel",get:function(){return this._thumbLabel},set:function(e){this._thumbLabel=Uf(e)}},{key:"tickInterval",get:function(){return this._tickInterval},set:function(e){this._tickInterval="auto"===e?"auto":"number"==typeof e||"string"==typeof e?Wf(e,this._tickInterval):0}},{key:"value",get:function(){return null===this._value&&(this.value=this._min),this._value},set:function(e){if(e!==this._value){var t=Wf(e);this._roundToDecimal&&(t=parseFloat(t.toFixed(this._roundToDecimal))),this._value=t,this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}}},{key:"vertical",get:function(){return this._vertical},set:function(e){this._vertical=Uf(e)}},{key:"displayValue",get:function(){return this.displayWith?this.displayWith(this.value):this._roundToDecimal&&this.value&&this.value%1!=0?this.value.toFixed(this._roundToDecimal):this.value||0}},{key:"percent",get:function(){return this._clamp(this._percent)}},{key:"_invertAxis",get:function(){return this.vertical?!this.invert:this.invert}},{key:"_isMinValue",get:function(){return 0===this.percent}},{key:"_thumbGap",get:function(){return this.disabled?7:this._isMinValue&&!this.thumbLabel?this._isActive?10:7:0}},{key:"_trackBackgroundStyles",get:function(){var e=this.vertical?"1, ".concat(1-this.percent,", 1"):1-this.percent+", 1, 1";return{transform:"translate".concat(this.vertical?"Y":"X","(").concat(this._shouldInvertMouseCoords()?"-":"").concat(this._thumbGap,"px) scale3d(").concat(e,")")}}},{key:"_trackFillStyles",get:function(){var e=this.vertical?"1, ".concat(this.percent,", 1"):this.percent+", 1, 1";return{transform:"translate".concat(this.vertical?"Y":"X","(").concat(this._shouldInvertMouseCoords()?"":"-").concat(this._thumbGap,"px) scale3d(").concat(e,")")}}},{key:"_ticksContainerStyles",get:function(){return{transform:"translate".concat(this.vertical?"Y":"X","(").concat(this.vertical||"rtl"!=this._getDirection()?"-":"").concat(this._tickIntervalPercent/2*100,"%)")}}},{key:"_ticksStyles",get:function(){var e=100*this._tickIntervalPercent,t={backgroundSize:this.vertical?"2px ".concat(e,"%"):e+"% 2px",transform:"translateZ(0) translate".concat(this.vertical?"Y":"X","(").concat(this.vertical||"rtl"!=this._getDirection()?"":"-").concat(e/2,"%)").concat(this.vertical||"rtl"!=this._getDirection()?"":" rotate(180deg)")};return this._isMinValue&&this._thumbGap&&(t["padding"+(this.vertical?this._invertAxis?"Bottom":"Top":this._invertAxis?"Right":"Left")]=this._thumbGap+"px"),t}},{key:"_thumbContainerStyles",get:function(){return{transform:"translate".concat(this.vertical?"Y":"X","(-").concat(100*(("rtl"!=this._getDirection()||this.vertical?this._invertAxis:!this._invertAxis)?this.percent:1-this.percent),"%)")}}}]),n}(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(function(e){_inherits(r,e);var n=_createSuper(r);function r(){var e;_classCallCheck2(this,r);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i)))._tabIndex=t,e}return _createClass2(r,[{key:"tabIndex",get:function(){return this.disabled?-1:this._tabIndex},set:function(e){this._tabIndex=null!=e?e:t}}]),r}(e))}(zd(Ld((function e(t){_classCallCheck2(this,e),this._elementRef=t})),"accent"))),Sb=function e(){_classCallCheck2(this,e)},Tb=Wn({encapsulation:2,styles:[".mat-slider{display:inline-block;position:relative;box-sizing:border-box;padding:8px;outline:0;vertical-align:middle}.mat-slider.mat-slider-sliding:not(.mat-slider-disabled),.mat-slider:not(.mat-slider-disabled):active{cursor:-webkit-grabbing;cursor:grabbing}.mat-slider-wrapper{position:absolute}.mat-slider-track-wrapper{position:absolute;top:0;left:0;overflow:hidden}.mat-slider-track-fill{position:absolute;transform-origin:0 0;transition:transform .4s cubic-bezier(.25,.8,.25,1),background-color .4s cubic-bezier(.25,.8,.25,1)}.mat-slider-track-background{position:absolute;transform-origin:100% 100%;transition:transform .4s cubic-bezier(.25,.8,.25,1),background-color .4s cubic-bezier(.25,.8,.25,1)}.mat-slider-ticks-container{position:absolute;left:0;top:0;overflow:hidden}.mat-slider-ticks{background-repeat:repeat;background-clip:content-box;box-sizing:border-box;opacity:0;transition:opacity .4s cubic-bezier(.25,.8,.25,1)}.mat-slider-thumb-container{position:absolute;z-index:1;transition:transform .4s cubic-bezier(.25,.8,.25,1)}.mat-slider-focus-ring{position:absolute;width:30px;height:30px;border-radius:50%;transform:scale(0);opacity:0;transition:transform .4s cubic-bezier(.25,.8,.25,1),background-color .4s cubic-bezier(.25,.8,.25,1),opacity .4s cubic-bezier(.25,.8,.25,1)}.mat-slider.cdk-keyboard-focused .mat-slider-focus-ring,.mat-slider.cdk-program-focused .mat-slider-focus-ring{transform:scale(1);opacity:1}.mat-slider:not(.mat-slider-disabled):not(.mat-slider-sliding) .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled):not(.mat-slider-sliding) .mat-slider-thumb-label{cursor:-webkit-grab;cursor:grab}.mat-slider-thumb{position:absolute;right:-10px;bottom:-10px;box-sizing:border-box;width:20px;height:20px;border:3px solid transparent;border-radius:50%;transform:scale(.7);transition:transform .4s cubic-bezier(.25,.8,.25,1),background-color .4s cubic-bezier(.25,.8,.25,1),border-color .4s cubic-bezier(.25,.8,.25,1)}.mat-slider-thumb-label{display:none;align-items:center;justify-content:center;position:absolute;width:28px;height:28px;border-radius:50%;transition:transform .4s cubic-bezier(.25,.8,.25,1),border-radius .4s cubic-bezier(.25,.8,.25,1),background-color .4s cubic-bezier(.25,.8,.25,1)}@media (-ms-high-contrast:active){.mat-slider-thumb-label{outline:solid 1px}}.mat-slider-thumb-label-text{z-index:1;opacity:0;transition:opacity .4s cubic-bezier(.25,.8,.25,1)}.mat-slider-sliding .mat-slider-thumb-container,.mat-slider-sliding .mat-slider-track-background,.mat-slider-sliding .mat-slider-track-fill{transition-duration:0s}.mat-slider-has-ticks .mat-slider-wrapper::after{content:'';position:absolute;border-width:0;border-style:solid;opacity:0;transition:opacity .4s cubic-bezier(.25,.8,.25,1)}.mat-slider-has-ticks.cdk-focused:not(.mat-slider-hide-last-tick) .mat-slider-wrapper::after,.mat-slider-has-ticks:hover:not(.mat-slider-hide-last-tick) .mat-slider-wrapper::after{opacity:1}.mat-slider-has-ticks.cdk-focused:not(.mat-slider-disabled) .mat-slider-ticks,.mat-slider-has-ticks:hover:not(.mat-slider-disabled) .mat-slider-ticks{opacity:1}.mat-slider-thumb-label-showing .mat-slider-focus-ring{display:none}.mat-slider-thumb-label-showing .mat-slider-thumb-label{display:flex}.mat-slider-axis-inverted .mat-slider-track-fill{transform-origin:100% 100%}.mat-slider-axis-inverted .mat-slider-track-background{transform-origin:0 0}.mat-slider:not(.mat-slider-disabled).cdk-focused.mat-slider-thumb-label-showing .mat-slider-thumb{transform:scale(0)}.mat-slider:not(.mat-slider-disabled).cdk-focused .mat-slider-thumb-label{border-radius:50% 50% 0}.mat-slider:not(.mat-slider-disabled).cdk-focused .mat-slider-thumb-label-text{opacity:1}.mat-slider:not(.mat-slider-disabled).cdk-mouse-focused .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled).cdk-program-focused .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled).cdk-touch-focused .mat-slider-thumb{border-width:2px;transform:scale(1)}.mat-slider-disabled .mat-slider-focus-ring{transform:scale(0);opacity:0}.mat-slider-disabled .mat-slider-thumb{border-width:4px;transform:scale(.5)}.mat-slider-disabled .mat-slider-thumb-label{display:none}.mat-slider-horizontal{height:48px;min-width:128px}.mat-slider-horizontal .mat-slider-wrapper{height:2px;top:23px;left:8px;right:8px}.mat-slider-horizontal .mat-slider-wrapper::after{height:2px;border-left-width:2px;right:0;top:0}.mat-slider-horizontal .mat-slider-track-wrapper{height:2px;width:100%}.mat-slider-horizontal .mat-slider-track-fill{height:2px;width:100%;transform:scaleX(0)}.mat-slider-horizontal .mat-slider-track-background{height:2px;width:100%;transform:scaleX(1)}.mat-slider-horizontal .mat-slider-ticks-container{height:2px;width:100%}@media (-ms-high-contrast:active){.mat-slider-horizontal .mat-slider-ticks-container{height:0;outline:solid 2px;top:1px}}.mat-slider-horizontal .mat-slider-ticks{height:2px;width:100%}.mat-slider-horizontal .mat-slider-thumb-container{width:100%;height:0;top:50%}.mat-slider-horizontal .mat-slider-focus-ring{top:-15px;right:-15px}.mat-slider-horizontal .mat-slider-thumb-label{right:-14px;top:-40px;transform:translateY(26px) scale(.01) rotate(45deg)}.mat-slider-horizontal .mat-slider-thumb-label-text{transform:rotate(-45deg)}.mat-slider-horizontal.cdk-focused .mat-slider-thumb-label{transform:rotate(45deg)}@media (-ms-high-contrast:active){.mat-slider-horizontal.cdk-focused .mat-slider-thumb-label,.mat-slider-horizontal.cdk-focused .mat-slider-thumb-label-text{transform:none}}.mat-slider-vertical{width:48px;min-height:128px}.mat-slider-vertical .mat-slider-wrapper{width:2px;top:8px;bottom:8px;left:23px}.mat-slider-vertical .mat-slider-wrapper::after{width:2px;border-top-width:2px;bottom:0;left:0}.mat-slider-vertical .mat-slider-track-wrapper{height:100%;width:2px}.mat-slider-vertical .mat-slider-track-fill{height:100%;width:2px;transform:scaleY(0)}.mat-slider-vertical .mat-slider-track-background{height:100%;width:2px;transform:scaleY(1)}.mat-slider-vertical .mat-slider-ticks-container{width:2px;height:100%}@media (-ms-high-contrast:active){.mat-slider-vertical .mat-slider-ticks-container{width:0;outline:solid 2px;left:1px}}.mat-slider-vertical .mat-slider-focus-ring{bottom:-15px;left:-15px}.mat-slider-vertical .mat-slider-ticks{width:2px;height:100%}.mat-slider-vertical .mat-slider-thumb-container{height:100%;width:0;left:50%}.mat-slider-vertical .mat-slider-thumb{-webkit-backface-visibility:hidden;backface-visibility:hidden}.mat-slider-vertical .mat-slider-thumb-label{bottom:-14px;left:-40px;transform:translateX(26px) scale(.01) rotate(-45deg)}.mat-slider-vertical .mat-slider-thumb-label-text{transform:rotate(45deg)}.mat-slider-vertical.cdk-focused .mat-slider-thumb-label{transform:rotate(-45deg)}[dir=rtl] .mat-slider-wrapper::after{left:0;right:auto}[dir=rtl] .mat-slider-horizontal .mat-slider-track-fill{transform-origin:100% 100%}[dir=rtl] .mat-slider-horizontal .mat-slider-track-background{transform-origin:0 0}[dir=rtl] .mat-slider-horizontal.mat-slider-axis-inverted .mat-slider-track-fill{transform-origin:0 0}[dir=rtl] .mat-slider-horizontal.mat-slider-axis-inverted .mat-slider-track-background{transform-origin:100% 100%}.mat-slider._mat-animation-noopable .mat-slider-focus-ring,.mat-slider._mat-animation-noopable .mat-slider-has-ticks .mat-slider-wrapper::after,.mat-slider._mat-animation-noopable .mat-slider-thumb,.mat-slider._mat-animation-noopable .mat-slider-thumb-container,.mat-slider._mat-animation-noopable .mat-slider-thumb-label,.mat-slider._mat-animation-noopable .mat-slider-thumb-label-text,.mat-slider._mat-animation-noopable .mat-slider-ticks,.mat-slider._mat-animation-noopable .mat-slider-track-background,.mat-slider._mat-animation-noopable .mat-slider-track-fill{transition:none}"],data:{}});function Ab(e){return Yi(2,[Bi(671088640,1,{_sliderWrapper:0}),(e()(),Pi(1,0,[[1,0],["sliderWrapper",1]],null,21,"div",[["class","mat-slider-wrapper"]],null,null,null,null,null)),(e()(),Pi(2,0,null,null,6,"div",[["class","mat-slider-track-wrapper"]],null,null,null,null,null)),(e()(),Pi(3,0,null,null,2,"div",[["class","mat-slider-track-background"]],null,null,null,null,null)),ta(512,null,Es,Is,[nn,wn,sn]),ea(5,278528,null,0,Rs,[Es],{ngStyle:[0,"ngStyle"]},null),(e()(),Pi(6,0,null,null,2,"div",[["class","mat-slider-track-fill"]],null,null,null,null,null)),ta(512,null,Es,Is,[nn,wn,sn]),ea(8,278528,null,0,Rs,[Es],{ngStyle:[0,"ngStyle"]},null),(e()(),Pi(9,0,null,null,5,"div",[["class","mat-slider-ticks-container"]],null,null,null,null,null)),ta(512,null,Es,Is,[nn,wn,sn]),ea(11,278528,null,0,Rs,[Es],{ngStyle:[0,"ngStyle"]},null),(e()(),Pi(12,0,null,null,2,"div",[["class","mat-slider-ticks"]],null,null,null,null,null)),ta(512,null,Es,Is,[nn,wn,sn]),ea(14,278528,null,0,Rs,[Es],{ngStyle:[0,"ngStyle"]},null),(e()(),Pi(15,0,null,null,7,"div",[["class","mat-slider-thumb-container"]],null,null,null,null,null)),ta(512,null,Es,Is,[nn,wn,sn]),ea(17,278528,null,0,Rs,[Es],{ngStyle:[0,"ngStyle"]},null),(e()(),Pi(18,0,null,null,0,"div",[["class","mat-slider-focus-ring"]],null,null,null,null,null)),(e()(),Pi(19,0,null,null,0,"div",[["class","mat-slider-thumb"]],null,null,null,null,null)),(e()(),Pi(20,0,null,null,2,"div",[["class","mat-slider-thumb-label"]],null,null,null,null,null)),(e()(),Pi(21,0,null,null,1,"span",[["class","mat-slider-thumb-label-text"]],null,null,null,null,null)),(e()(),Ki(22,null,["",""]))],(function(e,t){var n=t.component;e(t,5,0,n._trackBackgroundStyles),e(t,8,0,n._trackFillStyles),e(t,11,0,n._ticksContainerStyles),e(t,14,0,n._ticksStyles),e(t,17,0,n._thumbContainerStyles)}),(function(e,t){e(t,22,0,t.component.displayValue)}))}var Eb=function(){function e(t,n){_classCallCheck2(this,e),this._snackBar=t,this.globalVar=n,this.modelVEA=new ob.MusicVAE(this.globalVar.MODEL_DRUM_GROOVE),this.BL_DEFAULT_QPM=120,this.BL_DEFAULT_STEPS=4,this.BL_DEFAULT_BARS=16,this.BL_DEFAULT_VARIATION=.5,this.playButtonText="play_arrow",this.player=new ob.Player,this.buttonActive=!0,this.readyState=!1,this.hintColor="#ff0000"}return _createClass2(e,[{key:"ngOnInit",value:function(){var e=this;this.modelVEA.initialize().then((function(){e.openSnackBar("\ud83c\udfb6 Model Initialized!"),e.readyState=!0}))}},{key:"playMusic",value:function(){var e=this;this.player.resumeContext(),"started"===this.player.getPlayState()?(this.player.pause(),this.playButtonText="play_arrow"):"paused"===this.player.getPlayState()?(this.player.resume(),this.playButtonText="pause"):"stopped"===this.player.getPlayState()&&(this.player.start(this.sampleGenerated).then((function(){e.playButtonText="play_arrow"})),this.playButtonText="pause")}},{key:"stopMusic",value:function(){this.playButtonText="play_arrow",this.player.stop()}},{key:"generateSamples",value:function(){return ab(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.buttonActive=!0,e.next=4,this.modelVEA.sample(1,this.BL_DEFAULT_VARIATION);case 4:t=e.sent,this.sampleGenerated=t[0],this.buttonActive=!1,console.log(this.sampleGenerated,t),this.openSnackBar("\ud83c\udfb9 Music Generated!"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})))}},{key:"downloadMIDI",value:function(){this.openSnackBar("Downloaded!");var e=this.sampleGenerated;ob.sequences.isQuantizedSequence(this.sampleGenerated)||(e=ob.sequences.quantizeNoteSequence(this.sampleGenerated,1)),e.notes.forEach((function(e){return e.velocity=100}));var t=ob.sequenceProtoToMidi(e),n=new Blob([t],{type:"audio/midi"}),r=document.createElement("a"),a=URL.createObjectURL(n);r.href=a,r.download="buddhilive_"+Date.now()+".mid",r.click()}},{key:"openSnackBar",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3;this._snackBar.open(e,"OK",{duration:t,panelClass:"message-snackbar",horizontalPosition:"center",verticalPosition:"top"})}}]),e}(),Ib=Wn({encapsulation:0,styles:[[""]],data:{}});function Rb(e){return Yi(0,[(e()(),Pi(0,0,null,null,4,"div",[["class","row improvrnn__loader"]],null,null,null,null,null)),(e()(),Pi(1,0,null,null,3,"div",[["class","col-md-12"]],null,null,null,null,null)),(e()(),Pi(2,0,null,null,1,"mat-spinner",[["class","mat-spinner mat-progress-spinner"],["mode","indeterminate"],["role","progressbar"]],[[2,"_mat-animation-noopable",null],[4,"width","px"],[4,"height","px"]],null,null,Lv,Pv)),ea(3,114688,null,0,Nv,[nn,Zf,[2,Ms],[2,kv],Ov],null,null),(e()(),Ki(-1,null,[" Intializing Model... "]))],(function(e,t){e(t,3,0)}),(function(e,t){e(t,2,0,Vr(t,3)._noopAnimations,Vr(t,3).diameter,Vr(t,3).diameter)}))}function Ob(e){return Yi(0,[(e()(),Pi(0,0,null,null,48,"div",[["class","container improvrnn"]],null,null,null,null,null)),(e()(),Di(16777216,null,null,1,null,Rb)),ea(2,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null),(e()(),Pi(3,0,null,null,5,"mat-hint",[["class","improvrnn__chords--error mat-hint"]],[[2,"mat-right",null],[1,"id",0],[1,"align",0]],null,null,null,null)),ta(512,null,Es,Is,[nn,wn,sn]),ea(5,278528,null,0,Rs,[Es],{ngStyle:[0,"ngStyle"]},null),Hi(6,{color:0}),ea(7,16384,null,0,Jv,[],null,null),(e()(),Ki(8,null,["",""])),(e()(),Pi(9,0,null,null,5,"div",[["class","row improvrnn__settings"]],null,null,null,null,null)),(e()(),Pi(10,0,null,null,4,"div",[["class","col-md-12 improvrnn__settings--slider"]],null,null,null,null,null)),(e()(),Ki(11,null,[" Variation: "," "])),(e()(),Pi(12,0,null,null,2,"mat-slider",[["class","mat-slider"],["color","primary"],["max","1"],["min","0.1"],["role","slider"],["step","0.1"]],[[8,"tabIndex",0],[1,"aria-disabled",0],[1,"aria-valuemax",0],[1,"aria-valuemin",0],[1,"aria-valuenow",0],[1,"aria-orientation",0],[2,"mat-slider-disabled",null],[2,"mat-slider-has-ticks",null],[2,"mat-slider-horizontal",null],[2,"mat-slider-axis-inverted",null],[2,"mat-slider-invert-mouse-coords",null],[2,"mat-slider-sliding",null],[2,"mat-slider-thumb-label-showing",null],[2,"mat-slider-vertical",null],[2,"mat-slider-min-value",null],[2,"mat-slider-hide-last-tick",null],[2,"_mat-animation-noopable",null]],[[null,"valueChange"],[null,"focus"],[null,"blur"],[null,"mousedown"],[null,"keydown"],[null,"keyup"],[null,"mouseenter"],[null,"slide"],[null,"slideend"],[null,"slidestart"],[null,"selectstart"]],(function(e,t,n){var r=!0,a=e.component;return"focus"===t&&(r=!1!==Vr(e,14)._onFocus()&&r),"blur"===t&&(r=!1!==Vr(e,14)._onBlur()&&r),"mousedown"===t&&(r=!1!==Vr(e,14)._onMousedown(n)&&r),"keydown"===t&&(r=!1!==Vr(e,14)._onKeydown(n)&&r),"keyup"===t&&(r=!1!==Vr(e,14)._onKeyup()&&r),"mouseenter"===t&&(r=!1!==Vr(e,14)._onMouseenter()&&r),"slide"===t&&(r=!1!==Vr(e,14)._onSlide(n)&&r),"slideend"===t&&(r=!1!==Vr(e,14)._onSlideEnd()&&r),"slidestart"===t&&(r=!1!==Vr(e,14)._onSlideStart(n)&&r),"selectstart"===t&&(r=!1!==n.preventDefault()&&r),"valueChange"===t&&(r=!1!==(a.BL_DEFAULT_VARIATION=n)&&r),r}),Ab,Tb)),ta(5120,null,Lg,(function(e){return[e]}),[Cb]),ea(14,245760,null,0,Cb,[nn,Nd,St,[2,jf],[8,null],[2,kv]],{color:[0,"color"],max:[1,"max"],min:[2,"min"],step:[3,"step"],value:[4,"value"]},{valueChange:"valueChange"}),(e()(),Pi(15,0,null,null,4,"div",[["class","row improvrnn__player"]],null,null,null,null,null)),(e()(),Pi(16,0,null,null,3,"div",[["class","col-md-12"]],null,null,null,null,null)),(e()(),Pi(17,0,null,null,2,"mat-card",[["class","mat-card"]],[[2,"_mat-animation-noopable",null]],null,null,Cv,xv)),ea(18,49152,null,0,Lf,[[2,kv]],null,null),(e()(),Pi(19,0,[["pianoRollCanvas",1]],0,0,"canvas",[["class","improvrnn__player--canvas"]],null,null,null,null,null)),(e()(),Pi(20,0,null,null,28,"div",[["class","row improvrnn__controls"]],null,null,null,null,null)),(e()(),Pi(21,0,null,null,6,"div",[["class","col-md-3"]],null,null,null,null,null)),(e()(),Pi(22,16777216,null,null,5,"button",[["color","accent"],["mat-fab",""],["matTooltip","Play Music"],["matTooltipClass","tooltip-class"]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],(function(e,t,n){var r=!0,a=e.component;return"longpress"===t&&(r=!1!==Vr(e,24).show()&&r),"keydown"===t&&(r=!1!==Vr(e,24)._handleKeydown(n)&&r),"touchend"===t&&(r=!1!==Vr(e,24)._handleTouchend()&&r),"click"===t&&(r=!1!==a.playMusic()&&r),r}),gy,vy)),ea(23,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),ea(24,212992,null,0,T_,[y_,nn,Py,En,Ya,Zf,_d,Nd,x_,[2,jf],[2,S_],[2,Tc]],{message:[0,"message"],tooltipClass:[1,"tooltipClass"]},null),(e()(),Pi(25,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(26,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(27,0,["",""])),(e()(),Pi(28,0,null,null,6,"div",[["class","col-md-3"]],null,null,null,null,null)),(e()(),Pi(29,16777216,null,null,5,"button",[["color","warn"],["mat-fab",""],["matTooltip","Stop Music"],["matTooltipClass","tooltip-class"]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],(function(e,t,n){var r=!0,a=e.component;return"longpress"===t&&(r=!1!==Vr(e,31).show()&&r),"keydown"===t&&(r=!1!==Vr(e,31)._handleKeydown(n)&&r),"touchend"===t&&(r=!1!==Vr(e,31)._handleTouchend()&&r),"click"===t&&(r=!1!==a.stopMusic()&&r),r}),gy,vy)),ea(30,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),ea(31,212992,null,0,T_,[y_,nn,Py,En,Ya,Zf,_d,Nd,x_,[2,jf],[2,S_],[2,Tc]],{message:[0,"message"],tooltipClass:[1,"tooltipClass"]},null),(e()(),Pi(32,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(33,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(-1,0,["stop"])),(e()(),Pi(35,0,null,null,6,"div",[["class","col-md-3"]],null,null,null,null,null)),(e()(),Pi(36,16777216,null,null,5,"button",[["color","primary"],["mat-fab",""],["matTooltip","Generate Melody"],["matTooltipClass","tooltip-class"]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],(function(e,t,n){var r=!0,a=e.component;return"longpress"===t&&(r=!1!==Vr(e,38).show()&&r),"keydown"===t&&(r=!1!==Vr(e,38)._handleKeydown(n)&&r),"touchend"===t&&(r=!1!==Vr(e,38)._handleTouchend()&&r),"click"===t&&(r=!1!==a.generateSamples()&&r),r}),gy,vy)),ea(37,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),ea(38,212992,null,0,T_,[y_,nn,Py,En,Ya,Zf,_d,Nd,x_,[2,jf],[2,S_],[2,Tc]],{message:[0,"message"],tooltipClass:[1,"tooltipClass"]},null),(e()(),Pi(39,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(40,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(-1,0,["music_note"])),(e()(),Pi(42,0,null,null,6,"div",[["class","col-md-3"]],null,null,null,null,null)),(e()(),Pi(43,16777216,null,null,5,"button",[["color","primary"],["mat-fab",""],["matTooltip","Download MIDI"],["matTooltipClass","tooltip-class"]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],(function(e,t,n){var r=!0,a=e.component;return"longpress"===t&&(r=!1!==Vr(e,45).show()&&r),"keydown"===t&&(r=!1!==Vr(e,45)._handleKeydown(n)&&r),"touchend"===t&&(r=!1!==Vr(e,45)._handleTouchend()&&r),"click"===t&&(r=!1!==a.downloadMIDI()&&r),r}),gy,vy)),ea(44,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),ea(45,212992,null,0,T_,[y_,nn,Py,En,Ya,Zf,_d,Nd,x_,[2,jf],[2,S_],[2,Tc]],{message:[0,"message"],tooltipClass:[1,"tooltipClass"]},null),(e()(),Pi(46,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(47,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(-1,0,["cloud_download"]))],(function(e,t){var n=t.component;e(t,2,0,!n.readyState);var r=e(t,6,0,n.hintColor);e(t,5,0,r),e(t,14,0,"primary","1","0.1","0.1",n.BL_DEFAULT_VARIATION),e(t,23,0,n.buttonActive,"accent"),e(t,24,0,"Play Music","tooltip-class"),e(t,26,0),e(t,30,0,n.buttonActive,"warn"),e(t,31,0,"Stop Music","tooltip-class"),e(t,33,0),e(t,37,0,!n.readyState,"primary"),e(t,38,0,"Generate Melody","tooltip-class"),e(t,40,0),e(t,44,0,n.buttonActive,"primary"),e(t,45,0,"Download MIDI","tooltip-class"),e(t,47,0)}),(function(e,t){var n=t.component;e(t,3,0,"end"==Vr(t,7).align,Vr(t,7).id,null),e(t,8,0,n.errorHint),e(t,11,0,n.BL_DEFAULT_VARIATION),e(t,12,1,[Vr(t,14).tabIndex,Vr(t,14).disabled,Vr(t,14).max,Vr(t,14).min,Vr(t,14).value,Vr(t,14).vertical?"vertical":"horizontal",Vr(t,14).disabled,Vr(t,14).tickInterval,!Vr(t,14).vertical,Vr(t,14)._invertAxis,Vr(t,14)._shouldInvertMouseCoords(),Vr(t,14)._isSliding,Vr(t,14).thumbLabel,Vr(t,14).vertical,Vr(t,14)._isMinValue,Vr(t,14).disabled||Vr(t,14)._isMinValue&&Vr(t,14)._thumbGap&&Vr(t,14)._invertAxis,"NoopAnimations"===Vr(t,14)._animationMode]),e(t,17,0,"NoopAnimations"===Vr(t,18)._animationMode),e(t,22,0,Vr(t,23).disabled||null,"NoopAnimations"===Vr(t,23)._animationMode),e(t,25,0,Vr(t,26).inline,"primary"!==Vr(t,26).color&&"accent"!==Vr(t,26).color&&"warn"!==Vr(t,26).color),e(t,27,0,n.playButtonText),e(t,29,0,Vr(t,30).disabled||null,"NoopAnimations"===Vr(t,30)._animationMode),e(t,32,0,Vr(t,33).inline,"primary"!==Vr(t,33).color&&"accent"!==Vr(t,33).color&&"warn"!==Vr(t,33).color),e(t,36,0,Vr(t,37).disabled||null,"NoopAnimations"===Vr(t,37)._animationMode),e(t,39,0,Vr(t,40).inline,"primary"!==Vr(t,40).color&&"accent"!==Vr(t,40).color&&"warn"!==Vr(t,40).color),e(t,43,0,Vr(t,44).disabled||null,"NoopAnimations"===Vr(t,44)._animationMode),e(t,46,0,Vr(t,47).inline,"primary"!==Vr(t,47).color&&"accent"!==Vr(t,47).color&&"warn"!==Vr(t,47).color)}))}var Nb=Rr("app-drum-groove",Eb,(function(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"app-drum-groove",[],null,null,null,Ob,Ib)),ea(1,114688,null,0,Eb,[mb,vb],null,null)],(function(e,t){e(t,1,0)}),null)}),{},{},[]),Db=function(){function e(t){_classCallCheck2(this,e),this.globalVar=t,this.ddspModel=new ob.DDSP("https://storage.googleapis.com/magentadata/js/checkpoints/ddsp/tenor_saxophone"),this.spiceModels=new ob.SPICE("https://tfhub.dev/google/tfjs-model/spice/2/default/1"),this.BL_DEFAULT_QPM=220,this.BL_DEFAULT_STEPS=4,this.BL_DEFAULT_CHORDS=["Em","C","Am","G"],this.BL_DEFAULT_MELODY={quantizationInfo:{stepsPerQuarter:this.BL_DEFAULT_STEPS},notes:[],tempos:[{time:0,qpm:this.BL_DEFAULT_QPM}],totalQuantizedSteps:1},this.BL_PLAYER_PROGRESS=0,this.BL_PLAYER_DURATION=0,this.audioCtx=new AudioContext,this.readyStateSPICE=!1,this.readyStateDDSP=!1,this.transformButtonActive=!1,this.controlButtonsActive=!1,this.processProgress=!1,this.PROGRESS_DATA="",this.playButtonText="play_arrow"}return _createClass2(e,[{key:"ngOnInit",value:function(){var e=this;this.ddspModel.initialize().then((function(){e.readyStateDDSP=!0})),this.spiceModels.initialize().then((function(){e.readyStateSPICE=!0}))}},{key:"transformAudio",value:function(e){return ab(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.audioElement.nativeElement.innerHTML="",t.next=4,this.globalVar.uploadFile(e);case 4:this.uploadData=t.sent,this.audioElement.nativeElement.src=this.uploadData,this.PROGRESS_DATA="\ud83d\ude0a Uploaded Successfully!",this.uploadData?this.transformButtonActive=!0:console.log("Oops"),this.controlButtonsActive=!1,t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),alert("No upload file found! \n"+t.t0);case 14:case"end":return t.stop()}}),t,this,[[0,11]])})))}},{key:"readFileAndProcessAudio",value:function(){return ab(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.audioElement.nativeElement.duration<=15)){e.next=17;break}return this.PROGRESS_DATA="\ud83c\udfb5 Tonebreaker in Progress...",this.processProgress=!0,e.next=4,fetch(this.uploadData);case 4:return t=e.sent,e.next=7,t.arrayBuffer();case 7:return n=e.sent,e.next=10,this.audioCtx.decodeAudioData(n);case 10:return r=e.sent,e.next=13,this.spiceModels.getAudioFeatures(r);case 13:a=e.sent,console.log("audio_features",a),console.log("audio_buffer",r,n),this.synthesizeAudio(a),e.next=18;break;case 17:alert("Oops! Duration is greater than 15 seconds! This will crash your browser \nCurrent Duration: "+this.toTime(this.audioElement.nativeElement.duration)),this.PROGRESS_DATA="\ud83d\ude22 Upload an audio less than 15 seconds duration";case 18:case"end":return e.stop()}}),e,this)})))}},{key:"synthesizeAudio",value:function(e){return ab(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.ddspModel.synthesize(e);case 2:n=t.sent,console.log(n),this.FULL_SONG=this.encodeWAV(n,this.audioCtx.sampleRate),r=new Blob([this.FULL_SONG],{type:"audio/wav"}),a=URL.createObjectURL(r),this.audioElement.nativeElement.innerHTML="",this.AUDIO_ELEMENT=new Audio(a),this.audioElement.nativeElement.src=a,console.log(this.AUDIO_ELEMENT,this.audioElement),this.controlButtonsActive=!0,this.processProgress=!1,this.PROGRESS_DATA="\ud83c\udfb7 Music Generated!";case 6:case"end":return t.stop()}}),t,this)})))}},{key:"encodeRaw",value:function(e){return ab(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=new Uint8Array(e.length),r=0;r<e.length;r++)a=(a=Math.max(-1,Math.min(1,e[r])))<0?32768*a:32767*a,a/=256,n[r]=a+128;console.log(n),new Blob([n],{type:"application/octet-binary"});case 3:case"end":return t.stop()}}),t)})))}},{key:"hzToNotes",value:function(e){var t=this;this.BL_DEFAULT_MELODY.notes=[],e.f0_hz.map((function(e,n){var r=Math.round(69+12*Math.log2(e/440));console.log("Note",r,n),t.BL_DEFAULT_MELODY.notes.push({pitch:r,quantizedStartStep:n,quantizedEndStep:n+1})}))}},{key:"encodeWAV",value:function(e,t){var n=new ArrayBuffer(44+2*e.length),r=new DataView(n);return this.writeString(r,0,"RIFF"),r.setUint32(4,36+2*e.length,!0),this.writeString(r,8,"WAVE"),this.writeString(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,t,!0),r.setUint32(28,4*t,!0),r.setUint16(32,2,!0),r.setUint16(34,16,!0),this.writeString(r,36,"data"),r.setUint32(40,2*e.length,!0),this.floatTo16BitPCM(r,44,e),r}},{key:"writeString",value:function(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))}},{key:"floatTo16BitPCM",value:function(e,t,n){for(var r=0;r<n.length;r++,t+=2){var a=Math.max(-1,Math.min(1,n[r]));e.setInt16(t,a<0?32768*a:32767*a,!0)}}},{key:"downloadSample",value:function(){this.globalVar.download(this.FULL_SONG,"audio/wav","tonebreaker")}},{key:"playMusic",value:function(){this.audioElement.nativeElement.paused?(console.log("paused"),this.audioElement.nativeElement.play(),this.playButtonText="pause"):(console.log("paly"),this.audioElement.nativeElement.pause(),this.playButtonText="play_arrow")}},{key:"showPlayerProgree",value:function(e){var t=e.target.currentTime;this.BL_PLAYER_DURATION=e.target.duration,this.BL_PLAYER_PROGRESS=Math.round(t/this.BL_PLAYER_DURATION*100),this.BL_PLAYER_DURATION&&(this.PROGRESS_DATA=this.toTime(t)+" / "+this.toTime(this.BL_PLAYER_DURATION)),t===this.BL_PLAYER_DURATION&&100===this.BL_PLAYER_PROGRESS&&(this.playButtonText="play_arrow")}},{key:"onPlayerSeek",value:function(){console.log(this.audioElement,this.BL_PLAYER_PROGRESS,this.BL_PLAYER_PROGRESS/100*this.BL_PLAYER_DURATION),this.audioElement.nativeElement.currentTime=this.BL_PLAYER_PROGRESS/100*this.BL_PLAYER_DURATION}},{key:"stopPlay",value:function(){this.audioElement.nativeElement.pause(),this.audioElement.nativeElement.currentTime=0,this.playButtonText="play_arrow"}},{key:"toTime",value:function(e){var t=Math.round(e/60),n=Math.round(e%60);return n<10?t+":0"+n:t+":"+n}},{key:"recordAudio",value:function(){return ab(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){var n=[],r=new MediaRecorder(e);r.start(),r.onstart=function(e){alert("Only 15 secods will be recorded! Larger files will crash your Browser."),t.PROGRESS_DATA="\ud83c\udfa4 Recording...",console.log(e)},setTimeout((function(){r.stop(),console.log("Stoped")}),15e3),r.onstop=function(e){r.stream.getAudioTracks().map((function(e){return e.stop()})),t.PROGRESS_DATA="\ud83d\udcfc Recorded Successfully",console.log(e,r.stream.getAudioTracks());var a=new Blob(n,{type:"audio/mp3"});t.uploadData=URL.createObjectURL(a),t.audioElement.nativeElement.src=t.uploadData,t.transformButtonActive=!0,t.controlButtonsActive=!0},r.ondataavailable=function(e){console.log(e),n.push(e.data)}})),console.log();case 1:case"end":return e.stop()}}),e)})))}}]),e}(),Pb=Wn({encapsulation:0,styles:[[""]],data:{}});function Fb(e){return Yi(0,[(e()(),Pi(0,0,null,null,4,"div",[["class","row tonebreaker__loader"]],null,null,null,null,null)),(e()(),Pi(1,0,null,null,3,"div",[["class","col-md-12"]],null,null,null,null,null)),(e()(),Pi(2,0,null,null,1,"mat-spinner",[["class","mat-spinner mat-progress-spinner"],["mode","indeterminate"],["role","progressbar"]],[[2,"_mat-animation-noopable",null],[4,"width","px"],[4,"height","px"]],null,null,Lv,Pv)),ea(3,114688,null,0,Nv,[nn,Zf,[2,Ms],[2,kv],Ov],null,null),(e()(),Ki(-1,null,[" Intializing Model... "]))],(function(e,t){e(t,3,0)}),(function(e,t){e(t,2,0,Vr(t,3)._noopAnimations,Vr(t,3).diameter,Vr(t,3).diameter)}))}function Mb(e){return Yi(0,[(e()(),Pi(0,0,null,null,42,"div",[["class","tonebreaker__wrapper"]],null,null,null,null,null)),(e()(),Pi(1,0,null,null,4,"div",[["class","col-lg-12 col-md-12"]],null,null,null,null,null)),(e()(),Pi(2,0,[["uploadInput",1]],null,0,"input",[["class","tonebreaker__wrapper--uploader"],["type","file"]],null,[[null,"change"]],(function(e,t,n){var r=!0;return"change"===t&&(r=!1!==e.component.transformAudio(n)&&r),r}),null,null)),(e()(),Pi(3,0,null,null,2,"button",[["color","primary"],["mat-raised-button",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==Vr(e,2).click()&&r),r}),gy,vy)),ea(4,180224,null,0,dy,[nn,Nd,[2,kv]],{color:[0,"color"]},null),(e()(),Ki(-1,0,["Upload Audio"])),(e()(),Pi(6,0,null,null,2,"div",[["class","row"]],null,null,null,null,null)),(e()(),Pi(7,0,null,null,1,"div",[["class","col-lg-12 col-md-12"]],null,null,null,null,null)),(e()(),Pi(8,0,[[1,0],["toneBreakerAudio",1]],null,0,"audio",[["class","tonebreaker__wrapper--audio"],["controls",""]],null,[[null,"timeupdate"]],(function(e,t,n){var r=!0;return"timeupdate"===t&&(r=!1!==e.component.showPlayerProgree(n)&&r),r}),null,null)),(e()(),Pi(9,0,null,null,4,"div",[["class","row"]],null,null,null,null,null)),(e()(),Pi(10,0,null,null,3,"div",[["class","col-md-12 tonebreaker__player--slider"]],null,null,null,null,null)),(e()(),Pi(11,0,null,null,2,"mat-slider",[["class","mat-slider"],["color","primary"],["max","100"],["min","0"],["role","slider"],["step","1"]],[[8,"tabIndex",0],[1,"aria-disabled",0],[1,"aria-valuemax",0],[1,"aria-valuemin",0],[1,"aria-valuenow",0],[1,"aria-orientation",0],[2,"mat-slider-disabled",null],[2,"mat-slider-has-ticks",null],[2,"mat-slider-horizontal",null],[2,"mat-slider-axis-inverted",null],[2,"mat-slider-invert-mouse-coords",null],[2,"mat-slider-sliding",null],[2,"mat-slider-thumb-label-showing",null],[2,"mat-slider-vertical",null],[2,"mat-slider-min-value",null],[2,"mat-slider-hide-last-tick",null],[2,"_mat-animation-noopable",null]],[[null,"valueChange"],[null,"change"],[null,"focus"],[null,"blur"],[null,"mousedown"],[null,"keydown"],[null,"keyup"],[null,"mouseenter"],[null,"slide"],[null,"slideend"],[null,"slidestart"],[null,"selectstart"]],(function(e,t,n){var r=!0,a=e.component;return"focus"===t&&(r=!1!==Vr(e,13)._onFocus()&&r),"blur"===t&&(r=!1!==Vr(e,13)._onBlur()&&r),"mousedown"===t&&(r=!1!==Vr(e,13)._onMousedown(n)&&r),"keydown"===t&&(r=!1!==Vr(e,13)._onKeydown(n)&&r),"keyup"===t&&(r=!1!==Vr(e,13)._onKeyup()&&r),"mouseenter"===t&&(r=!1!==Vr(e,13)._onMouseenter()&&r),"slide"===t&&(r=!1!==Vr(e,13)._onSlide(n)&&r),"slideend"===t&&(r=!1!==Vr(e,13)._onSlideEnd()&&r),"slidestart"===t&&(r=!1!==Vr(e,13)._onSlideStart(n)&&r),"selectstart"===t&&(r=!1!==n.preventDefault()&&r),"valueChange"===t&&(r=!1!==(a.BL_PLAYER_PROGRESS=n)&&r),"change"===t&&(r=!1!==a.onPlayerSeek()&&r),r}),Ab,Tb)),ta(5120,null,Lg,(function(e){return[e]}),[Cb]),ea(13,245760,null,0,Cb,[nn,Nd,St,[2,jf],[8,null],[2,kv]],{color:[0,"color"],max:[1,"max"],min:[2,"min"],step:[3,"step"],value:[4,"value"]},{change:"change",valueChange:"valueChange"}),(e()(),Pi(14,0,null,null,3,"div",[["class","row tonebreaker__log"]],null,null,null,null,null)),(e()(),Pi(15,0,null,null,2,"div",[["class","col-lg-12 col-md-12"]],null,null,null,null,null)),(e()(),Pi(16,0,null,null,1,"p",[["class","tonebreaker__log--message"]],[[2,"progress",null]],null,null,null,null)),(e()(),Ki(17,null,["",""])),(e()(),Pi(18,0,null,null,24,"div",[["class","row"]],null,null,null,null,null)),(e()(),Pi(19,0,null,null,5,"div",[["class","col-lg-3 col-md-3"]],null,null,null,null,null)),(e()(),Pi(20,0,null,null,4,"button",[["color","primary"],["mat-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.readFileAndProcessAudio()&&r),r}),gy,vy)),ea(21,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),(e()(),Pi(22,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(23,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(-1,0,["music_note"])),(e()(),Pi(25,0,null,null,5,"div",[["class","col-lg-3 col-md-3"]],null,null,null,null,null)),(e()(),Pi(26,0,null,null,4,"button",[["color","accent"],["mat-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.playMusic()&&r),r}),gy,vy)),ea(27,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),(e()(),Pi(28,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(29,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(30,0,["",""])),(e()(),Pi(31,0,null,null,5,"div",[["class","col-lg-3 col-md-3"]],null,null,null,null,null)),(e()(),Pi(32,0,null,null,4,"button",[["color","warn"],["mat-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.stopPlay()&&r),r}),gy,vy)),ea(33,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),(e()(),Pi(34,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(35,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(-1,0,["stop"])),(e()(),Pi(37,0,null,null,5,"div",[["class","col-lg-3 col-md-3"]],null,null,null,null,null)),(e()(),Pi(38,0,null,null,4,"button",[["color","primary"],["mat-fab",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.downloadSample()&&r),r}),gy,vy)),ea(39,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),(e()(),Pi(40,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(41,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(-1,0,["cloud_download"]))],(function(e,t){var n=t.component;e(t,4,0,"primary"),e(t,13,0,"primary","100","0","1",n.BL_PLAYER_PROGRESS),e(t,21,0,!n.transformButtonActive,"primary"),e(t,23,0),e(t,27,0,!n.controlButtonsActive,"accent"),e(t,29,0),e(t,33,0,!n.controlButtonsActive,"warn"),e(t,35,0),e(t,39,0,!n.controlButtonsActive,"primary"),e(t,41,0)}),(function(e,t){var n=t.component;e(t,3,0,Vr(t,4).disabled||null,"NoopAnimations"===Vr(t,4)._animationMode),e(t,11,1,[Vr(t,13).tabIndex,Vr(t,13).disabled,Vr(t,13).max,Vr(t,13).min,Vr(t,13).value,Vr(t,13).vertical?"vertical":"horizontal",Vr(t,13).disabled,Vr(t,13).tickInterval,!Vr(t,13).vertical,Vr(t,13)._invertAxis,Vr(t,13)._shouldInvertMouseCoords(),Vr(t,13)._isSliding,Vr(t,13).thumbLabel,Vr(t,13).vertical,Vr(t,13)._isMinValue,Vr(t,13).disabled||Vr(t,13)._isMinValue&&Vr(t,13)._thumbGap&&Vr(t,13)._invertAxis,"NoopAnimations"===Vr(t,13)._animationMode]),e(t,16,0,n.processProgress),e(t,17,0,n.PROGRESS_DATA),e(t,20,0,Vr(t,21).disabled||null,"NoopAnimations"===Vr(t,21)._animationMode),e(t,22,0,Vr(t,23).inline,"primary"!==Vr(t,23).color&&"accent"!==Vr(t,23).color&&"warn"!==Vr(t,23).color),e(t,26,0,Vr(t,27).disabled||null,"NoopAnimations"===Vr(t,27)._animationMode),e(t,28,0,Vr(t,29).inline,"primary"!==Vr(t,29).color&&"accent"!==Vr(t,29).color&&"warn"!==Vr(t,29).color),e(t,30,0,n.playButtonText),e(t,32,0,Vr(t,33).disabled||null,"NoopAnimations"===Vr(t,33)._animationMode),e(t,34,0,Vr(t,35).inline,"primary"!==Vr(t,35).color&&"accent"!==Vr(t,35).color&&"warn"!==Vr(t,35).color),e(t,38,0,Vr(t,39).disabled||null,"NoopAnimations"===Vr(t,39)._animationMode),e(t,40,0,Vr(t,41).inline,"primary"!==Vr(t,41).color&&"accent"!==Vr(t,41).color&&"warn"!==Vr(t,41).color)}))}function Lb(e){return Yi(0,[Bi(671088640,1,{audioElement:0}),(e()(),Pi(1,0,null,null,4,"div",[["class","container tonebreaker"]],null,null,null,null,null)),(e()(),Di(16777216,null,null,1,null,Fb)),ea(3,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null),(e()(),Di(16777216,null,null,1,null,Mb)),ea(5,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null)],(function(e,t){var n=t.component;e(t,3,0,!n.readyStateSPICE||!n.readyStateDDSP),e(t,5,0,n.readyStateSPICE&&n.readyStateDDSP)}),null)}var zb=Rr("app-tonebreaker",Db,(function(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"app-tonebreaker",[],null,null,null,Lb,Pb)),ea(1,114688,null,0,Db,[vb],null,null)],(function(e,t){e(t,1,0)}),null)}),{},{},[]),Bb=function(){function e(t){_classCallCheck2(this,e),this.globalVar=t,this.readyState=!1,this.midiMe=new ob.OnsetsAndFrames(this.globalVar.MODEL_MIDIME),this.audioPlayer=new ob.Player,this.playButtonText="play_arrow",this.buttonActive=!0}return _createClass2(e,[{key:"ngOnInit",value:function(){var e=this;this.midiMe.initialize().then((function(){e.readyState=!0}))}},{key:"transformAudio",value:function(e){return ab(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.globalVar.uploadFile(e);case 2:return this.audioBlob=t.sent,console.log(this.audioBlob),t.next=6,this.midiMe.transcribeFromAudioURL(this.audioBlob);case 6:this.BL_VOICE_MELODY=t.sent,this.buttonActive=!1;case 8:case"end":return t.stop()}}),t,this)})))}},{key:"downloadMIDI",value:function(){var e=ob.sequenceProtoToMidi(this.BL_VOICE_MELODY);this.globalVar.download(e,"audio/midi","voicekey")}},{key:"startPlayer",value:function(){var e=this;this.audioPlayer.resumeContext(),"started"===this.audioPlayer.getPlayState()?(this.audioPlayer.stop(),this.playButtonText="play_arrow"):"paused"===this.audioPlayer.getPlayState()?(this.audioPlayer.resume(),this.playButtonText="stop"):"stopped"===this.audioPlayer.getPlayState()&&(this.audioPlayer.start(this.BL_VOICE_MELODY).then((function(){e.startPlayer()})),this.playButtonText="stop")}}]),e}(),jb=Wn({encapsulation:0,styles:[[""]],data:{}});function Vb(e){return Yi(0,[(e()(),Pi(0,0,null,null,4,"div",[["class","row voicekey__loader"]],null,null,null,null,null)),(e()(),Pi(1,0,null,null,3,"div",[["class","col-md-12"]],null,null,null,null,null)),(e()(),Pi(2,0,null,null,1,"mat-spinner",[["class","mat-spinner mat-progress-spinner"],["mode","indeterminate"],["role","progressbar"]],[[2,"_mat-animation-noopable",null],[4,"width","px"],[4,"height","px"]],null,null,Lv,Pv)),ea(3,114688,null,0,Nv,[nn,Zf,[2,Ms],[2,kv],Ov],null,null),(e()(),Ki(-1,null,[" Intializing Model... "]))],(function(e,t){e(t,3,0)}),(function(e,t){e(t,2,0,Vr(t,3)._noopAnimations,Vr(t,3).diameter,Vr(t,3).diameter)}))}function qb(e){return Yi(0,[(e()(),Pi(0,0,null,null,18,"div",[["class","voicekey__wrapper"]],null,null,null,null,null)),(e()(),Pi(1,0,null,null,2,"div",[["class","row"]],null,null,null,null,null)),(e()(),Pi(2,0,null,null,1,"div",[["class","col-lg-12 col-md-12"]],null,null,null,null,null)),(e()(),Pi(3,0,null,null,0,"input",[["type","file"]],null,[[null,"change"]],(function(e,t,n){var r=!0;return"change"===t&&(r=!1!==e.component.transformAudio(n)&&r),r}),null,null)),(e()(),Pi(4,0,null,null,14,"div",[["class","row"]],null,null,null,null,null)),(e()(),Pi(5,0,null,null,6,"div",[["class","col-lg-6 col-md-6"]],null,null,null,null,null)),(e()(),Pi(6,16777216,null,null,5,"button",[["color","accent"],["mat-fab",""],["matTooltip","Play Music"],["matTooltipClass","tooltip-class"]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],(function(e,t,n){var r=!0,a=e.component;return"longpress"===t&&(r=!1!==Vr(e,8).show()&&r),"keydown"===t&&(r=!1!==Vr(e,8)._handleKeydown(n)&&r),"touchend"===t&&(r=!1!==Vr(e,8)._handleTouchend()&&r),"click"===t&&(r=!1!==a.startPlayer()&&r),r}),gy,vy)),ea(7,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),ea(8,212992,null,0,T_,[y_,nn,Py,En,Ya,Zf,_d,Nd,x_,[2,jf],[2,S_],[2,Tc]],{message:[0,"message"],tooltipClass:[1,"tooltipClass"]},null),(e()(),Pi(9,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(10,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(11,0,["",""])),(e()(),Pi(12,0,null,null,6,"div",[["class","col-lg-6 col-md-6"]],null,null,null,null,null)),(e()(),Pi(13,16777216,null,null,5,"button",[["color","primary"],["mat-fab",""],["matTooltip","Download MIDI"],["matTooltipClass","tooltip-class"]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],(function(e,t,n){var r=!0,a=e.component;return"longpress"===t&&(r=!1!==Vr(e,15).show()&&r),"keydown"===t&&(r=!1!==Vr(e,15)._handleKeydown(n)&&r),"touchend"===t&&(r=!1!==Vr(e,15)._handleTouchend()&&r),"click"===t&&(r=!1!==a.downloadMIDI()&&r),r}),gy,vy)),ea(14,180224,null,0,dy,[nn,Nd,[2,kv]],{disabled:[0,"disabled"],color:[1,"color"]},null),ea(15,212992,null,0,T_,[y_,nn,Py,En,Ya,Zf,_d,Nd,x_,[2,jf],[2,S_],[2,Tc]],{message:[0,"message"],tooltipClass:[1,"tooltipClass"]},null),(e()(),Pi(16,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(17,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(-1,0,["cloud_download"]))],(function(e,t){var n=t.component;e(t,7,0,n.buttonActive,"accent"),e(t,8,0,"Play Music","tooltip-class"),e(t,10,0),e(t,14,0,n.buttonActive,"primary"),e(t,15,0,"Download MIDI","tooltip-class"),e(t,17,0)}),(function(e,t){var n=t.component;e(t,6,0,Vr(t,7).disabled||null,"NoopAnimations"===Vr(t,7)._animationMode),e(t,9,0,Vr(t,10).inline,"primary"!==Vr(t,10).color&&"accent"!==Vr(t,10).color&&"warn"!==Vr(t,10).color),e(t,11,0,n.playButtonText),e(t,13,0,Vr(t,14).disabled||null,"NoopAnimations"===Vr(t,14)._animationMode),e(t,16,0,Vr(t,17).inline,"primary"!==Vr(t,17).color&&"accent"!==Vr(t,17).color&&"warn"!==Vr(t,17).color)}))}function Ub(e){return Yi(0,[(e()(),Pi(0,0,null,null,4,"div",[["class","container voicekey"]],null,null,null,null,null)),(e()(),Di(16777216,null,null,1,null,Vb)),ea(2,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null),(e()(),Di(16777216,null,null,1,null,qb)),ea(4,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null)],(function(e,t){var n=t.component;e(t,2,0,!n.readyState),e(t,4,0,n.readyState)}),null)}var Wb=Rr("app-voice-key",Bb,(function(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"app-voice-key",[],null,null,null,Ub,jb)),ea(1,114688,null,0,Bb,[vb],null,null)],(function(e,t){e(t,1,0)}),null)}),{},{},[]),Gb=Wn({encapsulation:2,styles:[".mat-snack-bar-container{border-radius:4px;box-sizing:border-box;display:block;margin:24px;max-width:33vw;min-width:344px;padding:14px 16px;min-height:48px;transform-origin:center}@media (-ms-high-contrast:active){.mat-snack-bar-container{border:solid 1px}}.mat-snack-bar-handset{width:100%}.mat-snack-bar-handset .mat-snack-bar-container{margin:8px;max-width:100%;min-width:0;width:100%}"],data:{animation:[{type:7,name:"state",definitions:[{type:0,name:"void, hidden",styles:{type:6,styles:{transform:"scale(0.8)",opacity:0},offset:null},options:void 0},{type:0,name:"visible",styles:{type:6,styles:{transform:"scale(1)",opacity:1},offset:null},options:void 0},{type:1,expr:"* => visible",animation:{type:4,styles:null,timings:"150ms cubic-bezier(0, 0, 0.2, 1)"},options:null},{type:1,expr:"* => void, * => hidden",animation:{type:4,styles:{type:6,styles:{opacity:0},offset:null},timings:"75ms cubic-bezier(0.4, 0.0, 1, 1)"},options:null}],options:{}}]}});function Hb(e){return Yi(0,[(e()(),Di(0,null,null,0))],null,null)}function Kb(e){return Yi(0,[Bi(402653184,1,{_portalOutlet:0}),(e()(),Di(16777216,null,null,1,null,Hb)),ea(2,212992,[[1,4]],0,Uy,[Jt,En],{portal:[0,"portal"]},null)],(function(e,t){e(t,2,0,"")}),null)}var Xb=Rr("snack-bar-container",fb,(function(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"snack-bar-container",[["class","mat-snack-bar-container"]],[[1,"role",0],[40,"@state",0]],[["component","@state.done"]],(function(e,t,n){var r=!0;return"component:@state.done"===t&&(r=!1!==Vr(e,1).onAnimationEnd(n)&&r),r}),Kb,Gb)),ea(1,180224,null,0,fb,[Ya,nn,St,lb],null,null)],null,(function(e,t){e(t,0,0,Vr(t,1)._role,Vr(t,1)._animationState)}))}),{},{},[]),Qb=Wn({encapsulation:2,styles:[".mat-simple-snackbar{display:flex;justify-content:space-between;align-items:center;line-height:20px;opacity:1}.mat-simple-snackbar-action{flex-shrink:0;margin:-8px -8px -8px 8px}.mat-simple-snackbar-action button{max-height:36px;min-width:0}[dir=rtl] .mat-simple-snackbar-action{margin-left:-8px;margin-right:8px}"],data:{}});function Yb(e){return Yi(0,[(e()(),Pi(0,0,null,null,3,"div",[["class","mat-simple-snackbar-action"]],null,null,null,null,null)),(e()(),Pi(1,0,null,null,2,"button",[["mat-button",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component.action()&&r),r}),gy,vy)),ea(2,180224,null,0,dy,[nn,Nd,[2,kv]],null,null),(e()(),Ki(3,0,["",""]))],null,(function(e,t){var n=t.component;e(t,1,0,Vr(t,2).disabled||null,"NoopAnimations"===Vr(t,2)._animationMode),e(t,3,0,n.data.action)}))}function Zb(e){return Yi(2,[(e()(),Pi(0,0,null,null,1,"span",[],null,null,null,null,null)),(e()(),Ki(1,null,["",""])),(e()(),Di(16777216,null,null,1,null,Yb)),ea(3,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null)],(function(e,t){e(t,3,0,t.component.hasAction)}),(function(e,t){e(t,1,0,t.component.data.message)}))}var Jb=Rr("simple-snack-bar",hb,(function(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"simple-snack-bar",[["class","mat-simple-snackbar"]],null,null,null,Zb,Qb)),ea(1,49152,null,0,hb,[ub,cb],null,null)],null,null)}),{},{},[]),$b=Wn({encapsulation:2,styles:[".mat-tooltip-panel{pointer-events:none!important}.mat-tooltip{color:#fff;border-radius:4px;margin:14px;max-width:250px;padding-left:8px;padding-right:8px;overflow:hidden;text-overflow:ellipsis}@media (-ms-high-contrast:active){.mat-tooltip{outline:solid 1px}}.mat-tooltip-handset{margin:24px;padding-left:16px;padding-right:16px}"],data:{animation:[{type:7,name:"state",definitions:[{type:0,name:"initial, void, hidden",styles:{type:6,styles:{opacity:0,transform:"scale(0)"},offset:null},options:void 0},{type:0,name:"visible",styles:{type:6,styles:{transform:"scale(1)"},offset:null},options:void 0},{type:1,expr:"* => visible",animation:{type:4,styles:{type:5,steps:[{type:6,styles:{opacity:0,transform:"scale(0)",offset:0},offset:null},{type:6,styles:{opacity:.5,transform:"scale(0.99)",offset:.5},offset:null},{type:6,styles:{opacity:1,transform:"scale(1)",offset:1},offset:null}]},timings:"200ms cubic-bezier(0, 0, 0.2, 1)"},options:null},{type:1,expr:"* => hidden",animation:{type:4,styles:{type:6,styles:{opacity:0},offset:null},timings:"100ms cubic-bezier(0, 0, 0.2, 1)"},options:null}],options:{}}]}});function ek(e){return Yi(2,[(e()(),Pi(0,0,null,null,4,"div",[["class","mat-tooltip"]],[[2,"mat-tooltip-handset",null],[24,"@state",0]],[[null,"@state.start"],[null,"@state.done"]],(function(e,t,n){var r=!0,a=e.component;return"@state.start"===t&&(r=!1!==a._animationStart()&&r),"@state.done"===t&&(r=!1!==a._animationDone(n)&&r),r}),null,null)),ta(512,null,vs,gs,[kn,wn,nn,sn]),ea(2,278528,null,0,ys,[vs],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),(t=131072,n=Ps,r=[St],na(-1,t|=16,null,0,n,n,r)),(e()(),Ki(4,null,["",""]))],(function(e,t){e(t,2,0,"mat-tooltip",t.component.tooltipClass)}),(function(e,t){var n,r=t.component;e(t,0,0,null==(n=function(e,t,n,r){if(qt.isWrapped(r)){r=qt.unwrap(r);var a=e.def.nodes[0].bindingIndex+0,i=qt.unwrap(e.oldValues[a]);e.oldValues[a]=new qt(i)}return r}(t,0,0,Vr(t,3).transform(r._isHandset)))?null:n.matches,r._visibility),e(t,4,0,r.message)}));var t,n,r}var tk=Rr("mat-tooltip-component",A_,(function(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"mat-tooltip-component",[["aria-hidden","true"]],[[4,"zoom",null]],[["body","click"]],(function(e,t,n){var r=!0;return"body:click"===t&&(r=!1!==Vr(e,1)._handleBodyInteraction()&&r),r}),ek,$b)),ea(1,180224,null,0,A_,[St,Ey],null,null)],null,(function(e,t){e(t,0,0,"visible"===Vr(t,1)._visibility?1:null)}))}),{},{},[]),nk=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a){var i;return _classCallCheck2(this,n),(i=t.call(this,e))._platform=r,i._document=a,i}return _createClass2(n,[{key:"ngAfterViewInit",value:function(){var e=this;Ze()&&this._platform.isBrowser&&(this._checkToolbarMixedModes(),this._toolbarRows.changes.subscribe((function(){return e._checkToolbarMixedModes()})))}},{key:"_checkToolbarMixedModes",value:function(){var e=this;this._toolbarRows.length&&Array.from(this._elementRef.nativeElement.childNodes).filter((function(e){return!(e.classList&&e.classList.contains("mat-toolbar-row"))})).filter((function(t){return t.nodeType!==(e._document?e._document.COMMENT_NODE:8)})).some((function(e){return!(!e.textContent||!e.textContent.trim())}))&&function(){throw Error("MatToolbar: Attempting to combine different toolbar modes. Either specify multiple `<mat-toolbar-row>` elements explicitly or just place content inside of a `<mat-toolbar>` for a single row.")}()}}]),n}(zd((function e(t){_classCallCheck2(this,e),this._elementRef=t}))),rk=function e(){_classCallCheck2(this,e)},ak=Wn({encapsulation:2,styles:["@media (-ms-high-contrast:active){.mat-toolbar{outline:solid 1px}}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%}.mat-toolbar-multiple-rows{min-height:64px}.mat-toolbar-row,.mat-toolbar-single-row{height:64px}@media (max-width:599px){.mat-toolbar-multiple-rows{min-height:56px}.mat-toolbar-row,.mat-toolbar-single-row{height:56px}}"],data:{}});function ik(e){return Yi(2,[Wi(null,0),Wi(null,1)],null,null)}function ok(e){throw Error("A drawer was already declared for 'position=\"".concat(e,"\"'"))}var sk=new Ee("MAT_DRAWER_DEFAULT_AUTOSIZE",{providedIn:"root",factory:function(){return!1}}),uk=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i,o){var s;return _classCallCheck2(this,n),(s=t.call(this,a,i,o))._changeDetectorRef=e,s._container=r,s}return _createClass2(n,[{key:"ngAfterContentInit",value:function(){var e=this;this._container._contentMarginChanges.subscribe((function(){e._changeDetectorRef.markForCheck()}))}}]),n}(function(){function e(t,n,r,a){var i=this;_classCallCheck2(this,e),this.elementRef=t,this.scrollDispatcher=n,this.ngZone=r,this.dir=a,this._destroyed=new R,this._elementScrolled=new x((function(e){return i.ngZone.runOutsideAngular((function(){return Uv(i.elementRef.nativeElement,"scroll").pipe(Wv(i._destroyed)).subscribe(e)}))}))}return _createClass2(e,[{key:"ngOnInit",value:function(){this.scrollDispatcher.register(this)}},{key:"ngOnDestroy",value:function(){this.scrollDispatcher.deregister(this),this._destroyed.next(),this._destroyed.complete()}},{key:"elementScrolled",value:function(){return this._elementScrolled}},{key:"getElementRef",value:function(){return this.elementRef}},{key:"scrollTo",value:function(e){var t=this.elementRef.nativeElement,n=this.dir&&"rtl"==this.dir.value;e.left=null==e.left?n?e.end:e.start:e.left,e.right=null==e.right?n?e.start:e.end:e.right,null!=e.bottom&&(e.top=t.scrollHeight-t.clientHeight-e.bottom),n&&ad()!=rd.NORMAL?(null!=e.left&&(e.right=t.scrollWidth-t.clientWidth-e.left),ad()==rd.INVERTED?e.left=e.right:ad()==rd.NEGATED&&(e.left=e.right?-e.right:e.right)):null!=e.right&&(e.left=t.scrollWidth-t.clientWidth-e.right),this._applyScrollToOptions(e)}},{key:"_applyScrollToOptions",value:function(e){var t=this.elementRef.nativeElement;"object"==typeof document&&"scrollBehavior"in document.documentElement.style?t.scrollTo(e):(null!=e.top&&(t.scrollTop=e.top),null!=e.left&&(t.scrollLeft=e.left))}},{key:"measureScrollOffset",value:function(e){var t=this.elementRef.nativeElement;if("top"==e)return t.scrollTop;if("bottom"==e)return t.scrollHeight-t.clientHeight-t.scrollTop;var n=this.dir&&"rtl"==this.dir.value;return"start"==e?e=n?"right":"left":"end"==e&&(e=n?"left":"right"),n&&ad()==rd.INVERTED?"left"==e?t.scrollWidth-t.clientWidth-t.scrollLeft:t.scrollLeft:n&&ad()==rd.NEGATED?"left"==e?t.scrollLeft+t.scrollWidth-t.clientWidth:-t.scrollLeft:"left"==e?t.scrollLeft:t.scrollWidth-t.clientWidth-t.scrollLeft}}]),e}()),ck=function(){function e(t,n,r,a,i,o){var s=this;_classCallCheck2(this,e),this._elementRef=t,this._focusTrapFactory=n,this._focusMonitor=r,this._platform=a,this._ngZone=i,this._doc=o,this._elementFocusedBeforeDrawerWasOpened=null,this._enableAnimations=!1,this._position="start",this._mode="over",this._disableClose=!1,this._autoFocus=!0,this._animationStarted=new R,this._animationEnd=new R,this._animationState="void",this.openedChange=new ka(!0),this._destroyed=new R,this.onPositionChanged=new ka,this._modeChanged=new R,this._opened=!1,this.openedChange.subscribe((function(e){e?(s._doc&&(s._elementFocusedBeforeDrawerWasOpened=s._doc.activeElement),s._isFocusTrapEnabled&&s._focusTrap&&s._trapFocus()):s._restoreFocus()})),this._ngZone.runOutsideAngular((function(){Uv(s._elementRef.nativeElement,"keydown").pipe(eu((function(e){return 27===e.keyCode&&!s.disableClose&&!id(e)})),Wv(s._destroyed)).subscribe((function(e){return s._ngZone.run((function(){s.close(),e.stopPropagation(),e.preventDefault()}))}))})),this._animationEnd.pipe(function(e,t){return function(t){return t.lift(new Ny(e,void 0))}}((function(e,t){return e.fromState===t.fromState&&e.toState===t.toState}))).subscribe((function(e){var t=e.fromState,n=e.toState;(0===n.indexOf("open")&&"void"===t||"void"===n&&0===t.indexOf("open"))&&s.openedChange.emit(s._opened)}))}return _createClass2(e,[{key:"_trapFocus",value:function(){var e=this;this.autoFocus&&this._focusTrap.focusInitialElementWhenReady().then((function(t){t||"function"!=typeof e._elementRef.nativeElement.focus||e._elementRef.nativeElement.focus()}))}},{key:"_restoreFocus",value:function(){if(this.autoFocus){var e=this._doc&&this._doc.activeElement;e&&this._elementRef.nativeElement.contains(e)&&(this._elementFocusedBeforeDrawerWasOpened instanceof HTMLElement?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,this._openedVia):this._elementRef.nativeElement.blur()),this._elementFocusedBeforeDrawerWasOpened=null,this._openedVia=null}}},{key:"ngAfterContentInit",value:function(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState()}},{key:"ngAfterContentChecked",value:function(){this._platform.isBrowser&&(this._enableAnimations=!0)}},{key:"ngOnDestroy",value:function(){this._focusTrap&&this._focusTrap.destroy(),this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}},{key:"open",value:function(e){return this.toggle(!0,e)}},{key:"close",value:function(){return this.toggle(!1)}},{key:"toggle",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.opened,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"program";return this._opened=t,t?(this._animationState=this._enableAnimations?"open":"open-instant",this._openedVia=n):(this._animationState="void",this._restoreFocus()),this._updateFocusTrapState(),new Promise((function(t){e.openedChange.pipe(bu(1)).subscribe((function(e){return t(e?"open":"close")}))}))}},{key:"_updateFocusTrapState",value:function(){this._focusTrap&&(this._focusTrap.enabled=this._isFocusTrapEnabled)}},{key:"_animationStartListener",value:function(e){this._animationStarted.next(e)}},{key:"_animationDoneListener",value:function(e){this._animationEnd.next(e)}},{key:"position",get:function(){return this._position},set:function(e){(e="end"===e?"end":"start")!=this._position&&(this._position=e,this.onPositionChanged.emit())}},{key:"mode",get:function(){return this._mode},set:function(e){this._mode=e,this._updateFocusTrapState(),this._modeChanged.next()}},{key:"disableClose",get:function(){return this._disableClose},set:function(e){this._disableClose=Uf(e)}},{key:"autoFocus",get:function(){return this._autoFocus},set:function(e){this._autoFocus=Uf(e)}},{key:"_openedStream",get:function(){return this.openedChange.pipe(eu((function(e){return e})),W((function(){})))}},{key:"openedStart",get:function(){return this._animationStarted.pipe(eu((function(e){return e.fromState!==e.toState&&0===e.toState.indexOf("open")})),W((function(){})))}},{key:"_closedStream",get:function(){return this.openedChange.pipe(eu((function(e){return!e})),W((function(){})))}},{key:"closedStart",get:function(){return this._animationStarted.pipe(eu((function(e){return e.fromState!==e.toState&&"void"===e.toState})),W((function(){})))}},{key:"_isFocusTrapEnabled",get:function(){return this.opened&&"side"!==this.mode}},{key:"opened",get:function(){return this._opened},set:function(e){this.toggle(Uf(e))}},{key:"_width",get:function(){return this._elementRef.nativeElement&&this._elementRef.nativeElement.offsetWidth||0}}]),e}(),lk=function(){function e(t,n,r,a,i){var o=this,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6?arguments[6]:void 0;_classCallCheck2(this,e),this._dir=t,this._element=n,this._ngZone=r,this._changeDetectorRef=a,this._animationMode=u,this.backdropClick=new ka,this._destroyed=new R,this._doCheckSubject=new R,this._contentMargins={left:null,right:null},this._contentMarginChanges=new R,t&&t.change.pipe(Wv(this._destroyed)).subscribe((function(){o._validateDrawers(),o.updateContentMargins()})),i.change().pipe(Wv(this._destroyed)).subscribe((function(){return o.updateContentMargins()})),this._autosize=s}return _createClass2(e,[{key:"ngAfterContentInit",value:function(){var e=this;this._drawers.changes.pipe(Ru(null)).subscribe((function(){e._validateDrawers(),e._drawers.forEach((function(t){e._watchDrawerToggle(t),e._watchDrawerPosition(t),e._watchDrawerMode(t)})),(!e._drawers.length||e._isDrawerOpen(e._start)||e._isDrawerOpen(e._end))&&e.updateContentMargins(),e._changeDetectorRef.markForCheck()})),this._doCheckSubject.pipe(cd(10),Wv(this._destroyed)).subscribe((function(){return e.updateContentMargins()}))}},{key:"ngOnDestroy",value:function(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._destroyed.next(),this._destroyed.complete()}},{key:"open",value:function(){this._drawers.forEach((function(e){return e.open()}))}},{key:"close",value:function(){this._drawers.forEach((function(e){return e.close()}))}},{key:"updateContentMargins",value:function(){var e=this,t=0,n=0;if(this._left&&this._left.opened)if("side"==this._left.mode)t+=this._left._width;else if("push"==this._left.mode){var r=this._left._width;t+=r,n-=r}if(this._right&&this._right.opened)if("side"==this._right.mode)n+=this._right._width;else if("push"==this._right.mode){var a=this._right._width;n+=a,t-=a}n=n||null,(t=t||null)===this._contentMargins.left&&n===this._contentMargins.right||(this._contentMargins={left:t,right:n},this._ngZone.run((function(){return e._contentMarginChanges.next(e._contentMargins)})))}},{key:"ngDoCheck",value:function(){var e=this;this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular((function(){return e._doCheckSubject.next()}))}},{key:"_watchDrawerToggle",value:function(e){var t=this;e._animationStarted.pipe(eu((function(e){return e.fromState!==e.toState})),Wv(this._drawers.changes)).subscribe((function(e){"open-instant"!==e.toState&&"NoopAnimations"!==t._animationMode&&t._element.nativeElement.classList.add("mat-drawer-transition"),t.updateContentMargins(),t._changeDetectorRef.markForCheck()})),"side"!==e.mode&&e.openedChange.pipe(Wv(this._drawers.changes)).subscribe((function(){return t._setContainerClass(e.opened)}))}},{key:"_watchDrawerPosition",value:function(e){var t=this;e&&e.onPositionChanged.pipe(Wv(this._drawers.changes)).subscribe((function(){t._ngZone.onMicrotaskEmpty.asObservable().pipe(bu(1)).subscribe((function(){t._validateDrawers()}))}))}},{key:"_watchDrawerMode",value:function(e){var t=this;e&&e._modeChanged.pipe(Wv(ee(this._drawers.changes,this._destroyed))).subscribe((function(){t.updateContentMargins(),t._changeDetectorRef.markForCheck()}))}},{key:"_setContainerClass",value:function(e){var t=this._element.nativeElement.classList,n="mat-drawer-container-has-open";e?t.add(n):t.remove(n)}},{key:"_validateDrawers",value:function(){var e=this;this._start=this._end=null,this._drawers.forEach((function(t){"end"==t.position?(null!=e._end&&ok("end"),e._end=t):(null!=e._start&&ok("start"),e._start=t)})),this._right=this._left=null,this._dir&&"rtl"===this._dir.value?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}},{key:"_isPushed",value:function(){return this._isDrawerOpen(this._start)&&"over"!=this._start.mode||this._isDrawerOpen(this._end)&&"over"!=this._end.mode}},{key:"_onBackdropClicked",value:function(){this.backdropClick.emit(),this._closeModalDrawer()}},{key:"_closeModalDrawer",value:function(){var e=this;[this._start,this._end].filter((function(t){return t&&!t.disableClose&&e._canHaveBackdrop(t)})).forEach((function(e){return e.close()}))}},{key:"_isShowingBackdrop",value:function(){return this._isDrawerOpen(this._start)&&this._canHaveBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._canHaveBackdrop(this._end)}},{key:"_canHaveBackdrop",value:function(e){return"side"!==e.mode||!!this._backdropOverride}},{key:"_isDrawerOpen",value:function(e){return null!=e&&e.opened}},{key:"start",get:function(){return this._start}},{key:"end",get:function(){return this._end}},{key:"autosize",get:function(){return this._autosize},set:function(e){this._autosize=Uf(e)}},{key:"hasBackdrop",get:function(){return null==this._backdropOverride?!this._start||"side"!==this._start.mode||!this._end||"side"!==this._end.mode:this._backdropOverride},set:function(e){this._backdropOverride=null==e?null:Uf(e)}},{key:"scrollable",get:function(){return this._userContent||this._content}}]),e}(),hk=function e(){_classCallCheck2(this,e)},fk=Wn({encapsulation:2,styles:[],data:{}});function dk(e){return Yi(2,[Wi(null,0)],null,null)}var pk=Wn({encapsulation:2,styles:[],data:{animation:[{type:7,name:"transform",definitions:[{type:0,name:"open, open-instant",styles:{type:6,styles:{transform:"none",visibility:"visible"},offset:null},options:void 0},{type:0,name:"void",styles:{type:6,styles:{"box-shadow":"none",visibility:"hidden"},offset:null},options:void 0},{type:1,expr:"void => open-instant",animation:{type:4,styles:null,timings:"0ms"},options:null},{type:1,expr:"void <=> open, open-instant => void",animation:{type:4,styles:null,timings:"400ms cubic-bezier(0.25, 0.8, 0.25, 1)"},options:null}],options:{}}]}});function mk(e){return Yi(2,[(e()(),Pi(0,0,null,null,1,"div",[["class","mat-drawer-inner-container"]],null,null,null,null,null)),Wi(null,0)],null,null)}var vk=Wn({encapsulation:2,styles:[".mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:.4s;transition-timing-function:cubic-bezier(.25,.8,.25,1);transition-property:background-color,visibility}@media (-ms-high-contrast:active){.mat-drawer-backdrop{opacity:.5}}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:.4s;transition-timing-function:cubic-bezier(.25,.8,.25,1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%,0,0)}@media (-ms-high-contrast:active){.mat-drawer,[dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}}@media (-ms-high-contrast:active){.mat-drawer.mat-drawer-end,[dir=rtl] .mat-drawer{border-left:solid 1px currentColor;border-right:none}}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%,0,0)}[dir=rtl] .mat-drawer{transform:translate3d(100%,0,0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%,0,0)}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}"],data:{}});function gk(e){return Yi(0,[(e()(),Pi(0,0,null,null,0,"div",[["class","mat-drawer-backdrop"]],[[2,"mat-drawer-shown",null]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==e.component._onBackdropClicked()&&r),r}),null,null))],null,(function(e,t){e(t,0,0,t.component._isShowingBackdrop())}))}function yk(e){return Yi(0,[(e()(),Pi(0,0,null,null,2,"mat-drawer-content",[["class","mat-drawer-content"]],[[4,"margin-left","px"],[4,"margin-right","px"]],null,null,dk,fk)),ea(1,1294336,[[1,4]],0,uk,[St,lk,nn,Py,Ya],null,null),Wi(0,2)],(function(e,t){e(t,1,0)}),(function(e,t){e(t,0,0,Vr(t,1)._container._contentMargins.left,Vr(t,1)._container._contentMargins.right)}))}function _k(e){return Yi(2,[Bi(671088640,1,{_userContent:0}),(e()(),Di(16777216,null,null,1,null,gk)),ea(2,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null),Wi(null,0),Wi(null,1),(e()(),Di(16777216,null,null,1,null,yk)),ea(6,16384,null,0,ws,[En,Tn],{ngIf:[0,"ngIf"]},null)],(function(e,t){var n=t.component;e(t,2,0,n.hasBackdrop),e(t,6,0,!n._content)}),null)}var bk=Bd((function e(){_classCallCheck2(this,e)})),kk=Bd((function e(){_classCallCheck2(this,e)})),wk=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments))._stateChanges=new R,e}return _createClass2(n,[{key:"ngOnChanges",value:function(){this._stateChanges.next()}},{key:"ngOnDestroy",value:function(){this._stateChanges.complete()}}]),n}(bk),xk=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this))._elementRef=e,r._stateChanges=new R,"action-list"===r._getListType()&&e.nativeElement.classList.add("mat-action-list"),r}return _createClass2(n,[{key:"_getListType",value:function(){var e=this._elementRef.nativeElement.nodeName.toLowerCase();return"mat-list"===e?"list":"mat-action-list"===e?"action-list":null}},{key:"ngOnChanges",value:function(){this._stateChanges.next()}},{key:"ngOnDestroy",value:function(){this._stateChanges.complete()}}]),n}(bk),Ck=function e(){_classCallCheck2(this,e)},Sk=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;_classCallCheck2(this,n),(o=t.call(this))._element=e,o._isInteractiveList=!1,o._destroyed=new R,o._isInteractiveList=!!(a||i&&"action-list"===i._getListType()),o._list=a||i;var s=o._getHostElement();return"button"!==s.nodeName.toLowerCase()||s.hasAttribute("type")||s.setAttribute("type","button"),o._list&&o._list._stateChanges.pipe(Wv(o._destroyed)).subscribe((function(){r.markForCheck()})),o}return _createClass2(n,[{key:"ngAfterContentInit",value:function(){var e,t;t=this._element,(e=this._lines).changes.pipe(Ru(e)).subscribe((function(e){var n=e.length;Hd(t,"mat-2-line",!1),Hd(t,"mat-3-line",!1),Hd(t,"mat-multi-line",!1),2===n||3===n?Hd(t,"mat-".concat(n,"-line"),!0):n>3&&Hd(t,"mat-multi-line",!0)}))}},{key:"ngOnDestroy",value:function(){this._destroyed.next(),this._destroyed.complete()}},{key:"_isRippleDisabled",value:function(){return!this._isInteractiveList||this.disableRipple||!(!this._list||!this._list.disableRipple)}},{key:"_getHostElement",value:function(){return this._element.nativeElement}}]),n}(kk),Tk=function e(){_classCallCheck2(this,e)},Ak=function e(){_classCallCheck2(this,e)},Ek=Wn({encapsulation:2,styles:[".mat-subheader{display:flex;box-sizing:border-box;padding:16px;align-items:center}.mat-list-base .mat-subheader{margin:0}.mat-list-base{padding-top:8px;display:block;-webkit-tap-highlight-color:transparent}.mat-list-base .mat-subheader{height:48px;line-height:16px}.mat-list-base .mat-subheader:first-child{margin-top:-8px}.mat-list-base .mat-list-item,.mat-list-base .mat-list-option{display:block;height:48px;-webkit-tap-highlight-color:transparent;width:100%;padding:0}.mat-list-base .mat-list-item .mat-list-item-content,.mat-list-base .mat-list-option .mat-list-item-content{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;padding:0 16px;position:relative;height:inherit}.mat-list-base .mat-list-item .mat-list-item-content-reverse,.mat-list-base .mat-list-option .mat-list-item-content-reverse{display:flex;align-items:center;padding:0 16px;flex-direction:row-reverse;justify-content:space-around}.mat-list-base .mat-list-item .mat-list-item-ripple,.mat-list-base .mat-list-option .mat-list-item-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-list-base .mat-list-item.mat-list-item-with-avatar,.mat-list-base .mat-list-option.mat-list-item-with-avatar{height:56px}.mat-list-base .mat-list-item.mat-2-line,.mat-list-base .mat-list-option.mat-2-line{height:72px}.mat-list-base .mat-list-item.mat-3-line,.mat-list-base .mat-list-option.mat-3-line{height:88px}.mat-list-base .mat-list-item.mat-multi-line,.mat-list-base .mat-list-option.mat-multi-line{height:auto}.mat-list-base .mat-list-item.mat-multi-line .mat-list-item-content,.mat-list-base .mat-list-option.mat-multi-line .mat-list-item-content{padding-top:16px;padding-bottom:16px}.mat-list-base .mat-list-item .mat-list-text,.mat-list-base .mat-list-option .mat-list-text{display:flex;flex-direction:column;width:100%;box-sizing:border-box;overflow:hidden;padding:0}.mat-list-base .mat-list-item .mat-list-text>*,.mat-list-base .mat-list-option .mat-list-text>*{margin:0;padding:0;font-weight:400;font-size:inherit}.mat-list-base .mat-list-item .mat-list-text:empty,.mat-list-base .mat-list-option .mat-list-text:empty{display:none}.mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:0;padding-left:16px}[dir=rtl] .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:0}.mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-left:0;padding-right:16px}[dir=rtl] .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-right:0;padding-left:16px}.mat-list-base .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-right:16px;padding-left:16px}.mat-list-base .mat-list-item .mat-list-avatar,.mat-list-base .mat-list-option .mat-list-avatar{flex-shrink:0;width:40px;height:40px;border-radius:50%;object-fit:cover}.mat-list-base .mat-list-item .mat-list-avatar~.mat-divider-inset,.mat-list-base .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:72px;width:calc(100% - 72px)}[dir=rtl] .mat-list-base .mat-list-item .mat-list-avatar~.mat-divider-inset,[dir=rtl] .mat-list-base .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:auto;margin-right:72px}.mat-list-base .mat-list-item .mat-list-icon,.mat-list-base .mat-list-option .mat-list-icon{flex-shrink:0;width:24px;height:24px;font-size:24px;box-sizing:content-box;border-radius:50%;padding:4px}.mat-list-base .mat-list-item .mat-list-icon~.mat-divider-inset,.mat-list-base .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:64px;width:calc(100% - 64px)}[dir=rtl] .mat-list-base .mat-list-item .mat-list-icon~.mat-divider-inset,[dir=rtl] .mat-list-base .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:auto;margin-right:64px}.mat-list-base .mat-list-item .mat-divider,.mat-list-base .mat-list-option .mat-divider{position:absolute;bottom:0;left:0;width:100%;margin:0}[dir=rtl] .mat-list-base .mat-list-item .mat-divider,[dir=rtl] .mat-list-base .mat-list-option .mat-divider{margin-left:auto;margin-right:0}.mat-list-base .mat-list-item .mat-divider.mat-divider-inset,.mat-list-base .mat-list-option .mat-divider.mat-divider-inset{position:absolute}.mat-list-base[dense]{padding-top:4px;display:block}.mat-list-base[dense] .mat-subheader{height:40px;line-height:8px}.mat-list-base[dense] .mat-subheader:first-child{margin-top:-4px}.mat-list-base[dense] .mat-list-item,.mat-list-base[dense] .mat-list-option{display:block;height:40px;-webkit-tap-highlight-color:transparent;width:100%;padding:0}.mat-list-base[dense] .mat-list-item .mat-list-item-content,.mat-list-base[dense] .mat-list-option .mat-list-item-content{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;padding:0 16px;position:relative;height:inherit}.mat-list-base[dense] .mat-list-item .mat-list-item-content-reverse,.mat-list-base[dense] .mat-list-option .mat-list-item-content-reverse{display:flex;align-items:center;padding:0 16px;flex-direction:row-reverse;justify-content:space-around}.mat-list-base[dense] .mat-list-item .mat-list-item-ripple,.mat-list-base[dense] .mat-list-option .mat-list-item-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar{height:48px}.mat-list-base[dense] .mat-list-item.mat-2-line,.mat-list-base[dense] .mat-list-option.mat-2-line{height:60px}.mat-list-base[dense] .mat-list-item.mat-3-line,.mat-list-base[dense] .mat-list-option.mat-3-line{height:76px}.mat-list-base[dense] .mat-list-item.mat-multi-line,.mat-list-base[dense] .mat-list-option.mat-multi-line{height:auto}.mat-list-base[dense] .mat-list-item.mat-multi-line .mat-list-item-content,.mat-list-base[dense] .mat-list-option.mat-multi-line .mat-list-item-content{padding-top:16px;padding-bottom:16px}.mat-list-base[dense] .mat-list-item .mat-list-text,.mat-list-base[dense] .mat-list-option .mat-list-text{display:flex;flex-direction:column;width:100%;box-sizing:border-box;overflow:hidden;padding:0}.mat-list-base[dense] .mat-list-item .mat-list-text>*,.mat-list-base[dense] .mat-list-option .mat-list-text>*{margin:0;padding:0;font-weight:400;font-size:inherit}.mat-list-base[dense] .mat-list-item .mat-list-text:empty,.mat-list-base[dense] .mat-list-option .mat-list-text:empty{display:none}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:0;padding-left:16px}[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:0}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-left:0;padding-right:16px}[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-right:0;padding-left:16px}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-right:16px;padding-left:16px}.mat-list-base[dense] .mat-list-item .mat-list-avatar,.mat-list-base[dense] .mat-list-option .mat-list-avatar{flex-shrink:0;width:36px;height:36px;border-radius:50%;object-fit:cover}.mat-list-base[dense] .mat-list-item .mat-list-avatar~.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:68px;width:calc(100% - 68px)}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-list-avatar~.mat-divider-inset,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:auto;margin-right:68px}.mat-list-base[dense] .mat-list-item .mat-list-icon,.mat-list-base[dense] .mat-list-option .mat-list-icon{flex-shrink:0;width:20px;height:20px;font-size:20px;box-sizing:content-box;border-radius:50%;padding:4px}.mat-list-base[dense] .mat-list-item .mat-list-icon~.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:60px;width:calc(100% - 60px)}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-list-icon~.mat-divider-inset,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:auto;margin-right:60px}.mat-list-base[dense] .mat-list-item .mat-divider,.mat-list-base[dense] .mat-list-option .mat-divider{position:absolute;bottom:0;left:0;width:100%;margin:0}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-divider,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-divider{margin-left:auto;margin-right:0}.mat-list-base[dense] .mat-list-item .mat-divider.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-divider.mat-divider-inset{position:absolute}.mat-nav-list a{text-decoration:none;color:inherit}.mat-nav-list .mat-list-item{cursor:pointer;outline:0}mat-action-list button{background:0 0;color:inherit;border:none;font:inherit;outline:inherit;-webkit-tap-highlight-color:transparent;text-align:left}[dir=rtl] mat-action-list button{text-align:right}mat-action-list button::-moz-focus-inner{border:0}mat-action-list .mat-list-item{cursor:pointer;outline:inherit}.mat-list-option:not(.mat-list-item-disabled){cursor:pointer;outline:0}@media (-ms-high-contrast:active){.mat-selection-list:focus{outline-style:dotted}.mat-list-option:focus,.mat-list-option:hover,.mat-nav-list .mat-list-item:focus,.mat-nav-list .mat-list-item:hover,mat-action-list .mat-list-item:focus,mat-action-list .mat-list-item:hover{outline:dotted 1px}}@media (hover:none){.mat-action-list .mat-list-item:not(.mat-list-item-disabled):hover,.mat-list-option:not(.mat-list-item-disabled):hover,.mat-nav-list .mat-list-item:not(.mat-list-item-disabled):hover{background:0 0}}"],data:{}});function Ik(e){return Yi(2,[Wi(null,0)],null,null)}var Rk=Wn({encapsulation:2,styles:[],data:{}});function Ok(e){return Yi(2,[(e()(),Pi(0,0,null,null,6,"div",[["class","mat-list-item-content"]],null,null,null,null,null)),(e()(),Pi(1,0,null,null,1,"div",[["class","mat-list-item-ripple mat-ripple"],["mat-ripple",""]],[[2,"mat-ripple-unbounded",null]],null,null,null,null)),ea(2,212992,null,0,ep,[nn,Ya,Zf,[2,$d],[2,kv]],{disabled:[0,"disabled"],trigger:[1,"trigger"]},null),Wi(null,0),(e()(),Pi(4,0,null,null,1,"div",[["class","mat-list-text"]],null,null,null,null,null)),Wi(null,1),Wi(null,2)],(function(e,t){var n=t.component;e(t,2,0,n._isRippleDisabled(),n._getHostElement())}),(function(e,t){e(t,1,0,Vr(t,2).unbounded)}))}var Nk=Wn({encapsulation:0,styles:[[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]],data:{}});function Dk(e){return Yi(0,[(e()(),Pi(0,0,null,null,19,"mat-toolbar",[["class","bls-toolbar mat-toolbar"],["color","primary"]],[[2,"mat-toolbar-multiple-rows",null],[2,"mat-toolbar-single-row",null]],null,null,ik,ak)),ea(1,4243456,null,1,nk,[nn,Zf,Ms],{color:[0,"color"]},null),Bi(603979776,1,{_toolbarRows:1}),(e()(),Pi(3,0,null,0,4,"button",[["mat-icon-button",""]],[[1,"disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==Vr(e,25).toggle()&&r),r}),gy,vy)),ea(4,180224,null,0,dy,[nn,Nd,[2,kv]],null,null),(e()(),Pi(5,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(6,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(-1,0,["menu"])),(e()(),Pi(8,0,null,0,1,"span",[],null,null,null,null,null)),(e()(),Ki(9,null,["",""])),(e()(),Pi(10,0,null,0,0,"span",[["class","toolbar-spacer"]],null,null,null,null,null)),(e()(),Pi(11,0,null,0,2,"a",[["class","bls-toolbar__button"],["color","accent"],["href","https://www.buddhilive.com/p/donations.html"],["mat-flat-button",""],["target","_blank"]],[[1,"tabindex",0],[1,"disabled",0],[1,"aria-disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==Vr(e,12)._haltDisabledEvents(n)&&r),r}),_y,yy)),ea(12,180224,null,0,py,[Nd,nn,[2,kv]],{color:[0,"color"]},null),(e()(),Ki(-1,0,[" Sponsor "])),(e()(),Pi(14,16777216,null,0,5,"a",[["class","bls-toolbar__button"],["color","accent"],["href","https://www.buddhilive.com/search/label/BL%20Studio?&max-results=7"],["mat-mini-fab",""],["matTooltip","Help"],["target","_blank"]],[[1,"tabindex",0],[1,"disabled",0],[1,"aria-disabled",0],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"longpress"],[null,"keydown"],[null,"touchend"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==Vr(e,15)._haltDisabledEvents(n)&&r),"longpress"===t&&(r=!1!==Vr(e,16).show()&&r),"keydown"===t&&(r=!1!==Vr(e,16)._handleKeydown(n)&&r),"touchend"===t&&(r=!1!==Vr(e,16)._handleTouchend()&&r),r}),_y,yy)),ea(15,180224,null,0,py,[Nd,nn,[2,kv]],{color:[0,"color"]},null),ea(16,212992,null,0,T_,[y_,nn,Py,En,Ya,Zf,_d,Nd,x_,[2,jf],[2,S_],[2,Tc]],{message:[0,"message"]},null),(e()(),Pi(17,0,null,0,2,"mat-icon",[["class","mat-icon notranslate"],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(18,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),(e()(),Ki(-1,0,["help_outline"])),(e()(),Pi(20,0,null,null,35,"mat-drawer-container",[["class","bls-container mat-drawer-container"]],[[2,"mat-drawer-container-explicit-backdrop",null]],null,null,_k,vk)),ea(21,1490944,null,2,lk,[[2,jf],nn,Ya,St,My,sk,[2,kv]],{hasBackdrop:[0,"hasBackdrop"]},null),Bi(603979776,2,{_drawers:1}),Bi(603979776,3,{_content:0}),(e()(),Pi(24,0,null,0,27,"mat-drawer",[["class","bls-container__drawer mat-drawer"],["mode","over"],["tabIndex","-1"]],[[1,"align",0],[2,"mat-drawer-end",null],[2,"mat-drawer-over",null],[2,"mat-drawer-push",null],[2,"mat-drawer-side",null],[2,"mat-drawer-opened",null],[40,"@transform",0]],[["component","@transform.start"],["component","@transform.done"]],(function(e,t,n){var r=!0;return"component:@transform.start"===t&&(r=!1!==Vr(e,25)._animationStartListener(n)&&r),"component:@transform.done"===t&&(r=!1!==Vr(e,25)._animationDoneListener(n)&&r),r}),mk,pk)),ea(25,3325952,[[2,4],["drawer",4]],0,ck,[nn,Ad,Nd,Zf,Ya,[2,Ms]],{mode:[0,"mode"]},null),(e()(),Pi(26,0,null,0,25,"mat-list",[["class","mat-list mat-list-base"],["role","list"]],null,null,null,Ik,Ek)),ea(27,704512,null,0,xk,[nn],null,null),(e()(),Pi(28,0,null,0,11,"mat-list-item",[["class","mat-list-item mat-ripple"],["matRipple",""],["role","listitem"],["routerLink","/"]],[[2,"mat-list-item-avatar",null],[2,"mat-list-item-with-avatar",null],[2,"mat-ripple-unbounded",null]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==Vr(e,29).onClick()&&r),"click"===t&&(r=!1!==Vr(e,25).toggle()&&r),r}),Ok,Rk)),ea(29,16384,null,0,af,[rf,Xl,[8,null],sn,nn],{routerLink:[0,"routerLink"]},null),ea(30,1228800,null,3,Sk,[nn,St,[2,wk],[2,xk]],null,null),Bi(603979776,4,{_lines:1}),Bi(603979776,5,{_avatar:0}),Bi(603979776,6,{_icon:0}),ea(34,212992,null,0,ep,[nn,Ya,Zf,[2,$d],[2,kv]],null,null),(e()(),Pi(35,0,null,0,3,"mat-icon",[["class","mat-icon notranslate mat-list-icon"],["mat-list-icon",""],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(36,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),ea(37,16384,[[6,4]],0,Ck,[],null,null),(e()(),Ki(-1,0,["home"])),(e()(),Ki(-1,2,[" Home "])),(e()(),Pi(40,0,null,0,11,"mat-list-item",[["class","mat-list-item mat-ripple"],["matRipple",""],["role","listitem"],["routerLink","/melody"]],[[2,"mat-list-item-avatar",null],[2,"mat-list-item-with-avatar",null],[2,"mat-ripple-unbounded",null]],[[null,"click"]],(function(e,t,n){var r=!0;return"click"===t&&(r=!1!==Vr(e,41).onClick()&&r),"click"===t&&(r=!1!==Vr(e,25).toggle()&&r),r}),Ok,Rk)),ea(41,16384,null,0,af,[rf,Xl,[8,null],sn,nn],{routerLink:[0,"routerLink"]},null),ea(42,1228800,null,3,Sk,[nn,St,[2,wk],[2,xk]],null,null),Bi(603979776,7,{_lines:1}),Bi(603979776,8,{_avatar:0}),Bi(603979776,9,{_icon:0}),ea(46,212992,null,0,ep,[nn,Ya,Zf,[2,$d],[2,kv]],null,null),(e()(),Pi(47,0,null,0,3,"mat-icon",[["class","mat-icon notranslate mat-list-icon"],["mat-list-icon",""],["role","img"]],[[2,"mat-icon-inline",null],[2,"mat-icon-no-color",null]],null,null,rb,nb)),ea(48,9158656,null,0,eb,[nn,H_,[8,null],[2,Y_],[2,Xe]],null,null),ea(49,16384,[[9,4]],0,Ck,[],null,null),(e()(),Ki(-1,0,["music_video"])),(e()(),Ki(-1,2,[" Melody "])),(e()(),Pi(52,0,null,1,3,"mat-drawer-content",[["class","mat-drawer-content"]],[[4,"margin-left","px"],[4,"margin-right","px"]],null,null,dk,fk)),ea(53,1294336,[[3,4]],0,uk,[St,lk,nn,Py,Ya],null,null),(e()(),Pi(54,16777216,null,0,1,"router-outlet",[],null,null,null,null,null)),ea(55,212992,null,0,cf,[uf,En,Jt,[8,null],St],null,null)],(function(e,t){e(t,1,0,"primary"),e(t,6,0),e(t,12,0,"accent"),e(t,15,0,"accent"),e(t,16,0,"Help"),e(t,18,0),e(t,21,0,!0),e(t,25,0,"over"),e(t,29,0,"/"),e(t,34,0),e(t,36,0),e(t,41,0,"/melody"),e(t,46,0),e(t,48,0),e(t,53,0),e(t,55,0)}),(function(e,t){var n=t.component;e(t,0,0,Vr(t,1)._toolbarRows.length>0,0===Vr(t,1)._toolbarRows.length),e(t,3,0,Vr(t,4).disabled||null,"NoopAnimations"===Vr(t,4)._animationMode),e(t,5,0,Vr(t,6).inline,"primary"!==Vr(t,6).color&&"accent"!==Vr(t,6).color&&"warn"!==Vr(t,6).color),e(t,9,0,n.title),e(t,11,0,Vr(t,12).disabled?-1:Vr(t,12).tabIndex||0,Vr(t,12).disabled||null,Vr(t,12).disabled.toString(),"NoopAnimations"===Vr(t,12)._animationMode),e(t,14,0,Vr(t,15).disabled?-1:Vr(t,15).tabIndex||0,Vr(t,15).disabled||null,Vr(t,15).disabled.toString(),"NoopAnimations"===Vr(t,15)._animationMode),e(t,17,0,Vr(t,18).inline,"primary"!==Vr(t,18).color&&"accent"!==Vr(t,18).color&&"warn"!==Vr(t,18).color),e(t,20,0,Vr(t,21)._backdropOverride),e(t,24,0,null,"end"===Vr(t,25).position,"over"===Vr(t,25).mode,"push"===Vr(t,25).mode,"side"===Vr(t,25).mode,Vr(t,25).opened,Vr(t,25)._animationState),e(t,28,0,Vr(t,30)._avatar||Vr(t,30)._icon,Vr(t,30)._avatar||Vr(t,30)._icon,Vr(t,34).unbounded),e(t,35,0,Vr(t,36).inline,"primary"!==Vr(t,36).color&&"accent"!==Vr(t,36).color&&"warn"!==Vr(t,36).color),e(t,40,0,Vr(t,42)._avatar||Vr(t,42)._icon,Vr(t,42)._avatar||Vr(t,42)._icon,Vr(t,46).unbounded),e(t,47,0,Vr(t,48).inline,"primary"!==Vr(t,48).color&&"accent"!==Vr(t,48).color&&"warn"!==Vr(t,48).color),e(t,52,0,Vr(t,53)._container._contentMargins.left,Vr(t,53)._container._contentMargins.right)}))}var Pk=Rr("app-root",Of,(function(e){return Yi(0,[(e()(),Pi(0,0,null,null,1,"app-root",[],null,null,null,Dk,Nk)),ea(1,49152,null,0,Of,[rf],null,null)],null,null)}),{},{},[]),Fk=new Ee("mat-select-scroll-strategy");function Mk(e){return function(){return e.scrollStrategies.reposition()}}var Lk=function e(){_classCallCheck2(this,e)},zk=function e(){_classCallCheck2(this,e)},Bk=function e(){_classCallCheck2(this,e)},jk=function e(){_classCallCheck2(this,e)},Vk=new ns(rs,[Of],(function(e){return function(e){for(var t={},n=[],r=!1,a=0;a<e.length;a++){var i=e[a];i.token===At&&!0===i.value&&(r=!0),1073741824&i.flags&&n.push(i.token),i.index=a,t[Un(i.token)]=i}return{factory:null,providersByKey:t,providers:e,modules:n,isRoot:r}}([xr(512,Jt,$t,[[8,[Mf,Iv,wb,Nb,zb,Wb,Xb,Jb,tk,Pk]],[3,Jt],Be]),xr(5120,Da,Ri,[[3,Da]]),xr(4608,ps,ms,[Da,[2,ds]]),xr(5120,va,Oi,[Ya]),xr(5120,Ta,Aa,[]),xr(5120,kn,Ei,[]),xr(5120,wn,Ii,[]),xr(4608,Oc,Nc,[Ms]),xr(6144,bt,null,[Oc]),xr(4608,Sc,Gd,[[2,qd],[2,Md]]),xr(5120,ec,(function(e,t,n,r,a,i,o,s){return[new xc(e,t,n),new Rc(r),new Ac(a,i,o,s)]}),[Ms,Ya,Ra,Ms,Ms,Sc,Na,[2,Tc]]),xr(4608,tc,tc,[ec,Ya]),xr(135680,ac,ac,[Ms]),xr(4608,cc,cc,[tc,ac,Ta]),xr(5120,Op,yv,[]),xr(5120,_m,_v,[]),xr(4608,Hm,gv,[Ms,Op,_m]),xr(5120,an,bv,[cc,Hm,Ya]),xr(6144,rc,null,[ac]),xr(4608,ai,ai,[Ya]),xr(5120,Xl,Tf,[rf]),xr(4608,df,df,[]),xr(6144,hf,null,[df]),xr(135680,pf,pf,[rf,vi,Va,It,hf]),xr(4608,ff,ff,[]),xr(5120,mf,kf,[rf,Bs,vf]),xr(5120,Rf,If,[Af]),xr(5120,Oa,(function(e){return[e]}),[Rf]),xr(4608,ip,lv,[an,Ms]),xr(4608,y_,y_,[e_,c_,Jt,v_,u_,It,Ya,Ms,jf,[2,us]]),xr(5120,__,b_,[y_]),xr(4608,ig,ig,[]),xr(4608,Vd,Vd,[]),xr(5120,Fk,Mk,[y_]),xr(5120,x_,C_,[y_]),xr(4608,vb,vb,[]),xr(1073742336,Fs,Fs,[]),xr(1024,Xe,jc,[]),xr(1024,ui,(function(){return[_f()]}),[]),xr(512,Af,Af,[It]),xr(1024,Ca,(function(e,t){return[(n=e,Zu("probe",$u),Zu("coreTokens",Object.assign({},Ju,(n||[]).reduce((function(e,t){return e[t.name]=t.token,e}),{}))),function(){return $u}),Ef(t)];var n}),[[2,ui],Af]),xr(512,Sa,Sa,[[2,Ca]]),xr(131584,pi,pi,[Ya,Na,It,Xe,Jt,Sa]),xr(1073742336,Ni,Ni,[pi]),xr(1073742336,Vc,Vc,[[3,Vc]]),xr(1024,gf,xf,[[3,rf]]),xr(512,Tl,Al,[]),xr(512,uf,uf,[]),xr(256,vf,{},[]),xr(1024,os,wf,[as,[2,ss],vf]),xr(512,us,us,[os,as]),xr(512,Va,Va,[]),xr(512,vi,_i,[Va,[2,gi]]),xr(1024,Yh,(function(){return[[{path:"",component:Sv},{path:"melody",component:sb},{path:"drumbeats",component:Eb},{path:"tonebreaker",component:Db},{path:"voicekey",component:Bb}]]}),[]),xr(1024,rf,Sf,[pi,Tl,uf,us,It,vi,Va,Yh,vf,[2,Jh],[2,Xh]]),xr(1073742336,bf,bf,[[2,gf],[2,rf]]),xr(1073742336,zk,zk,[]),xr(1073742336,wv,wv,[]),xr(1073742336,Vf,Vf,[]),xr(1073742336,Md,Md,[[2,Fd],[2,Tc]]),xr(1073742336,rk,rk,[]),xr(1073742336,tb,tb,[]),xr(1073742336,Jf,Jf,[]),xr(1073742336,tp,tp,[]),xr(1073742336,my,my,[]),xr(1073742336,Wy,Wy,[]),xr(1073742336,Fy,Fy,[]),xr(1073742336,k_,k_,[]),xr(1073742336,db,db,[]),xr(1073742336,Rg,Rg,[]),xr(1073742336,ug,ug,[]),xr(1073742336,ag,ag,[]),xr(1073742336,Pg,Pg,[]),xr(1073742336,Sb,Sb,[]),xr(1073742336,Bk,Bk,[]),xr(1073742336,np,np,[]),xr(1073742336,rp,rp,[]),xr(1073742336,Lk,Lk,[]),xr(1073742336,zf,zf,[]),xr(1073742336,Dd,Dd,[]),xr(1073742336,E_,E_,[]),xr(1073742336,hk,hk,[]),xr(1073742336,Kd,Kd,[]),xr(1073742336,Ak,Ak,[]),xr(1073742336,Tk,Tk,[]),xr(1073742336,Dv,Dv,[]),xr(1073742336,jk,jk,[]),xr(1073742336,jv,jv,[]),xr(1073742336,rs,rs,[]),xr(256,At,!0,[]),xr(256,kv,"BrowserAnimations",[]),xr(256,zv,{},[])])}));(function(){if(Ye)throw new Error("Cannot enable prod mode after platform setup.");Qe=!1})(),Bc().bootstrapModuleFactory(Vk).catch((function(e){return console.error(e)}))},zhpf:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"shuffle",(function(){return H})),n.d(r,"clamp",(function(){return K})),n.d(r,"nearestLargerEven",(function(){return X})),n.d(r,"sum",(function(){return Q})),n.d(r,"randUniform",(function(){return Y})),n.d(r,"distSquared",(function(){return Z})),n.d(r,"assert",(function(){return J})),n.d(r,"assertShapesMatch",(function(){return $})),n.d(r,"assertNonNull",(function(){return ee})),n.d(r,"flatten",(function(){return te})),n.d(r,"sizeFromShape",(function(){return ne})),n.d(r,"isScalarShape",(function(){return re})),n.d(r,"arraysEqual",(function(){return ae})),n.d(r,"isInt",(function(){return ie})),n.d(r,"tanh",(function(){return oe})),n.d(r,"sizeToSquarishShape",(function(){return se})),n.d(r,"createShuffledIndices",(function(){return ue})),n.d(r,"rightPad",(function(){return ce})),n.d(r,"repeatedTry",(function(){return le})),n.d(r,"inferFromImplicitShape",(function(){return he})),n.d(r,"parseAxisParam",(function(){return fe})),n.d(r,"squeezeShape",(function(){return de})),n.d(r,"getTypedArrayFromDType",(function(){return pe})),n.d(r,"getArrayFromDType",(function(){return me})),n.d(r,"checkConversionForErrors",(function(){return ve})),n.d(r,"isValidDtype",(function(){return ge})),n.d(r,"hasEncodingLoss",(function(){return ye})),n.d(r,"isTypedArray",(function(){return _e})),n.d(r,"bytesPerElement",(function(){return be})),n.d(r,"bytesFromStringArray",(function(){return ke})),n.d(r,"isString",(function(){return we})),n.d(r,"isBoolean",(function(){return xe})),n.d(r,"isNumber",(function(){return Ce})),n.d(r,"inferDtype",(function(){return Se})),n.d(r,"isFunction",(function(){return Te})),n.d(r,"nearestDivisor",(function(){return Ae})),n.d(r,"computeStrides",(function(){return Ee})),n.d(r,"toNestedArray",(function(){return Ie})),n.d(r,"makeOnesTypedArray",(function(){return Re})),n.d(r,"makeZerosTypedArray",(function(){return Oe})),n.d(r,"makeZerosNestedTypedArray",(function(){return Ne})),n.d(r,"assertNonNegativeIntegerDimensions",(function(){return De})),n.d(r,"locToIndex",(function(){return Pe})),n.d(r,"indexToLoc",(function(){return Fe})),n.d(r,"isPromise",(function(){return Me})),n.d(r,"createScalarValue",(function(){return lt})),n.d(r,"toTypedArray",(function(){return ht})),n.d(r,"now",(function(){return ft})),n.d(r,"fetch",(function(){return dt})),n.d(r,"encodeString",(function(){return pt})),n.d(r,"decodeString",(function(){return mt}));var a={};n.r(a),n.d(a,"makeTypesMatch",(function(){return It})),n.d(a,"assertTypesMatch",(function(){return Rt})),n.d(a,"isTensorInList",(function(){return Ot})),n.d(a,"getTensorsInContainer",(function(){return Nt}));var i={};n.r(i),n.d(i,"isMobile",(function(){return zt})),n.d(i,"isBrowser",(function(){return Bt}));var o={};n.r(o),n.d(o,"copyModel",(function(){return Mn})),n.d(o,"listModels",(function(){return Nn})),n.d(o,"moveModel",(function(){return zn})),n.d(o,"removeModel",(function(){return Pn})),n.d(o,"browserFiles",(function(){return Qn})),n.d(o,"browserHTTPRequest",(function(){return or})),n.d(o,"concatenateArrayBuffers",(function(){return nn})),n.d(o,"decodeWeights",(function(){return Jt})),n.d(o,"encodeWeights",(function(){return Yt})),n.d(o,"fromMemory",(function(){return cr})),n.d(o,"getLoadHandlers",(function(){return hn})),n.d(o,"getModelArtifactsInfoForJSON",(function(){return an})),n.d(o,"getSaveHandlers",(function(){return ln})),n.d(o,"http",(function(){return ir})),n.d(o,"isHTTPScheme",(function(){return rr})),n.d(o,"loadWeights",(function(){return $n})),n.d(o,"registerLoadRouter",(function(){return cn})),n.d(o,"registerSaveRouter",(function(){return un})),n.d(o,"weightsLoaderFactory",(function(){return tr})),n.d(o,"withSaveHandler",(function(){return lr}));var s={};n.r(s),n.d(s,"confusionMatrix",(function(){return vr}));var u={};n.r(u),n.d(u,"toPixels",(function(){return yr})),n.d(u,"fromPixels",(function(){return br}));var c={};n.r(c),n.d(c,"prepareAndValidate",(function(){return kr}));var l={};n.r(l),n.d(l,"validateUpdateShape",(function(){return wr})),n.d(l,"validateInput",(function(){return xr})),n.d(l,"calculateShapes",(function(){return Cr}));var h={};n.r(h),n.d(h,"assertParamsValid",(function(){return Sr})),n.d(h,"maskToAxes",(function(){return Tr})),n.d(h,"computeOutShape",(function(){return Ar})),n.d(h,"stridesWithElidedDims",(function(){return Er})),n.d(h,"getNormalizedAxes",(function(){return Or})),n.d(h,"startIndicesWithElidedDims",(function(){return Nr})),n.d(h,"stopIndicesWithElidedDims",(function(){return Dr})),n.d(h,"stridesForAxis",(function(){return Pr})),n.d(h,"startForAxis",(function(){return Fr})),n.d(h,"stopForAxis",(function(){return Mr})),n.d(h,"isSliceContinous",(function(){return Lr})),n.d(h,"computeFlatOffset",(function(){return zr})),n.d(h,"parseSliceParams",(function(){return Br}));var f={};n.r(f),n.d(f,"Serializable",(function(){return jr})),n.d(f,"SerializationMap",(function(){return Vr})),n.d(f,"registerClass",(function(){return qr}));var d={};n.r(d),n.d(d,"TEST_EPSILON_FLOAT16",(function(){return Ur})),n.d(d,"expectArraysClose",(function(){return Wr})),n.d(d,"testEpsilon",(function(){return Gr})),n.d(d,"expectPromiseToFail",(function(){return Kr})),n.d(d,"expectArraysEqual",(function(){return Xr})),n.d(d,"expectNumbersClose",(function(){return Qr})),n.d(d,"expectValuesInRange",(function(){return Zr})),n.d(d,"expectArrayBuffersEqual",(function(){return Jr}));var p={};n.r(p),n.d(p,"segOpComputeOptimalWindowSize",(function(){return Ao})),n.d(p,"computeOutShape",(function(){return Eo})),n.d(p,"collectGatherOpShapeInfo",(function(){return Io}));var m={};n.r(m),n.d(m,"conv2d",(function(){return ac})),n.d(m,"depthwiseConv2d",(function(){return sc})),n.d(m,"matMul",(function(){return uc}));var v={};n.r(v),n.d(v,"axesAreInnerMostDims",(function(){return ei})),n.d(v,"combineLocations",(function(){return ti})),n.d(v,"computeOutAndReduceShapes",(function(){return ni})),n.d(v,"expandShapeToKeepDim",(function(){return ri})),n.d(v,"assertAxesAreInnerMostDims",(function(){return ai})),n.d(v,"getAxesPermutation",(function(){return ii})),n.d(v,"getUndoAxesPermutation",(function(){return oi})),n.d(v,"getInnerMostAxes",(function(){return si})),n.d(v,"getBroadcastDims",(function(){return Ua})),n.d(v,"getReductionAxes",(function(){return Wa})),n.d(v,"assertAndGetBroadcastShape",(function(){return Ga})),n.d(v,"assertParamsConsistent",(function(){return Ni})),n.d(v,"computeOutShape",(function(){return Di})),n.d(v,"computeDilation2DInfo",(function(){return gi})),n.d(v,"computePool2DInfo",(function(){return yi})),n.d(v,"computePool3DInfo",(function(){return _i})),n.d(v,"computeConv2DInfo",(function(){return bi})),n.d(v,"computeConv3DInfo",(function(){return ki})),n.d(v,"computeDefaultPad",(function(){return wi})),n.d(v,"tupleValuesAreOne",(function(){return Ai})),n.d(v,"eitherStridesOrDilationsAreOne",(function(){return Ei})),n.d(v,"convertConv2DDataFormat",(function(){return Ii})),n.d(v,"getFusedDyActivation",(function(){return ec})),n.d(v,"getFusedBiasGradient",(function(){return tc})),n.d(v,"applyActivation",(function(){return nc})),n.d(v,"shouldFuse",(function(){return rc})),n.d(v,"PARALLELIZE_THRESHOLD",(function(){return So})),n.d(v,"computeOptimalWindowSize",(function(){return To})),n.d(v,"slice_util",(function(){return h})),n.d(v,"upcastType",(function(){return At})),n.d(v,"validateUpdateShape",(function(){return wr})),n.d(v,"validateInput",(function(){return xr})),n.d(v,"calculateShapes",(function(){return Cr})),n.d(v,"prepareSplitSize",(function(){return su})),n.d(v,"segment_util",(function(){return p})),n.d(v,"castTensor",(function(){return Al})),n.d(v,"reshapeTensor",(function(){return El})),n.d(v,"linspaceImpl",(function(){return Il})),n.d(v,"getImageCenter",(function(){return rl})),n.d(v,"getReshaped",(function(){return al})),n.d(v,"getPermuted",(function(){return il})),n.d(v,"getReshapedPermuted",(function(){return ol})),n.d(v,"getSliceBeginCoords",(function(){return sl})),n.d(v,"getSliceSize",(function(){return ul})),n.d(v,"prepareAndValidate",(function(){return kr})),n.d(v,"SELU_SCALEALPHA",(function(){return cl})),n.d(v,"SELU_SCALE",(function(){return ll})),n.d(v,"ERF_P",(function(){return hl})),n.d(v,"ERF_A1",(function(){return fl})),n.d(v,"ERF_A2",(function(){return dl})),n.d(v,"ERF_A3",(function(){return pl})),n.d(v,"ERF_A4",(function(){return ml})),n.d(v,"ERF_A5",(function(){return vl})),n.d(v,"warn",(function(){return gl})),n.d(v,"log",(function(){return yl})),n.d(v,"mergeRealAndImagArrays",(function(){return _l})),n.d(v,"splitRealAndImagArrays",(function(){return bl})),n.d(v,"complexWithEvenIndex",(function(){return kl})),n.d(v,"complexWithOddIndex",(function(){return wl})),n.d(v,"getComplexWithIndex",(function(){return xl})),n.d(v,"assignToTypedArray",(function(){return Cl})),n.d(v,"exponents",(function(){return Sl})),n.d(v,"exponent",(function(){return Tl}));var g={};n.r(g),n.d(g,"nonMaxSuppressionV3Impl",(function(){return bc})),n.d(g,"nonMaxSuppressionV4Impl",(function(){return kc})),n.d(g,"nonMaxSuppressionV5Impl",(function(){return wc})),n.d(g,"split",(function(){return Rl})),n.d(g,"tile",(function(){return Ol})),n.d(g,"topkImpl",(function(){return Nl})),n.d(g,"whereImpl",(function(){return Tu}));var y={};n.r(y),n.d(y,"maxNorm",(function(){return wf})),n.d(y,"unitNorm",(function(){return xf})),n.d(y,"nonNeg",(function(){return Cf})),n.d(y,"minMaxNorm",(function(){return Sf}));var _={};n.r(_),n.d(_,"zeros",(function(){return Id})),n.d(_,"ones",(function(){return Rd})),n.d(_,"constant",(function(){return Od})),n.d(_,"randomUniform",(function(){return Nd})),n.d(_,"randomNormal",(function(){return Dd})),n.d(_,"truncatedNormal",(function(){return Pd})),n.d(_,"identity",(function(){return Fd})),n.d(_,"varianceScaling",(function(){return Md})),n.d(_,"glorotUniform",(function(){return Ld})),n.d(_,"glorotNormal",(function(){return zd})),n.d(_,"heNormal",(function(){return Bd})),n.d(_,"heUniform",(function(){return jd})),n.d(_,"leCunNormal",(function(){return Vd})),n.d(_,"leCunUniform",(function(){return qd})),n.d(_,"orthogonal",(function(){return Ud}));var b={};n.r(b),n.d(b,"inputLayer",(function(){return Rg})),n.d(b,"elu",(function(){return Og})),n.d(b,"reLU",(function(){return Ng})),n.d(b,"leakyReLU",(function(){return Dg})),n.d(b,"prelu",(function(){return Pg})),n.d(b,"softmax",(function(){return Fg})),n.d(b,"thresholdedReLU",(function(){return Mg})),n.d(b,"conv1d",(function(){return Lg})),n.d(b,"conv2d",(function(){return zg})),n.d(b,"conv2dTranspose",(function(){return Bg})),n.d(b,"conv3d",(function(){return jg})),n.d(b,"separableConv2d",(function(){return Vg})),n.d(b,"cropping2D",(function(){return qg})),n.d(b,"upSampling2d",(function(){return Ug})),n.d(b,"depthwiseConv2d",(function(){return Wg})),n.d(b,"activation",(function(){return Gg})),n.d(b,"dense",(function(){return Hg})),n.d(b,"dropout",(function(){return Kg})),n.d(b,"spatialDropout1d",(function(){return Xg})),n.d(b,"flatten",(function(){return Qg})),n.d(b,"repeatVector",(function(){return Yg})),n.d(b,"reshape",(function(){return Zg})),n.d(b,"permute",(function(){return Jg})),n.d(b,"embedding",(function(){return $g})),n.d(b,"add",(function(){return ey})),n.d(b,"average",(function(){return ty})),n.d(b,"concatenate",(function(){return ny})),n.d(b,"maximum",(function(){return ry})),n.d(b,"minimum",(function(){return ay})),n.d(b,"multiply",(function(){return iy})),n.d(b,"dot",(function(){return oy})),n.d(b,"batchNormalization",(function(){return sy})),n.d(b,"layerNormalization",(function(){return uy})),n.d(b,"zeroPadding2d",(function(){return cy})),n.d(b,"averagePooling1d",(function(){return ly})),n.d(b,"avgPool1d",(function(){return hy})),n.d(b,"avgPooling1d",(function(){return fy})),n.d(b,"averagePooling2d",(function(){return dy})),n.d(b,"avgPool2d",(function(){return py})),n.d(b,"avgPooling2d",(function(){return my})),n.d(b,"averagePooling3d",(function(){return vy})),n.d(b,"avgPool3d",(function(){return gy})),n.d(b,"avgPooling3d",(function(){return yy})),n.d(b,"globalAveragePooling1d",(function(){return _y})),n.d(b,"globalAveragePooling2d",(function(){return by})),n.d(b,"globalMaxPooling1d",(function(){return ky})),n.d(b,"globalMaxPooling2d",(function(){return wy})),n.d(b,"maxPooling1d",(function(){return xy})),n.d(b,"maxPooling2d",(function(){return Cy})),n.d(b,"maxPooling3d",(function(){return Sy})),n.d(b,"gru",(function(){return Ty})),n.d(b,"gruCell",(function(){return Ay})),n.d(b,"lstm",(function(){return Ey})),n.d(b,"lstmCell",(function(){return Iy})),n.d(b,"simpleRNN",(function(){return Ry})),n.d(b,"simpleRNNCell",(function(){return Oy})),n.d(b,"convLstm2d",(function(){return Ny})),n.d(b,"convLstm2dCell",(function(){return Dy})),n.d(b,"rnn",(function(){return Py})),n.d(b,"stackedRNNCells",(function(){return Fy})),n.d(b,"bidirectional",(function(){return My})),n.d(b,"timeDistributed",(function(){return Ly})),n.d(b,"globalMaxPool1d",(function(){return zy})),n.d(b,"globalMaxPool2d",(function(){return By})),n.d(b,"maxPool1d",(function(){return jy})),n.d(b,"maxPool2d",(function(){return Vy})),n.d(b,"Layer",(function(){return up})),n.d(b,"RNN",(function(){return Sv})),n.d(b,"RNNCell",(function(){return Tv})),n.d(b,"input",(function(){return Em})),n.d(b,"gaussianNoise",(function(){return qy})),n.d(b,"gaussianDropout",(function(){return Uy})),n.d(b,"alphaDropout",(function(){return Wy})),n.d(b,"masking",(function(){return Gy}));var k={};n.r(k),n.d(k,"binaryAccuracy",(function(){return Hy})),n.d(k,"binaryCrossentropy",(function(){return Ky})),n.d(k,"sparseCategoricalAccuracy",(function(){return Xy})),n.d(k,"categoricalAccuracy",(function(){return Qy})),n.d(k,"categoricalCrossentropy",(function(){return Yy})),n.d(k,"precision",(function(){return Zy})),n.d(k,"recall",(function(){return Jy})),n.d(k,"cosineProximity",(function(){return $y})),n.d(k,"meanAbsoluteError",(function(){return e_})),n.d(k,"meanAbsolutePercentageError",(function(){return t_})),n.d(k,"MAPE",(function(){return n_})),n.d(k,"mape",(function(){return r_})),n.d(k,"meanSquaredError",(function(){return a_})),n.d(k,"MSE",(function(){return i_})),n.d(k,"mse",(function(){return o_}));var w={};n.r(w),n.d(w,"modelFromJSON",(function(){return wm}));var x={};n.r(x),n.d(x,"l1l2",(function(){return s_})),n.d(x,"l1",(function(){return u_})),n.d(x,"l2",(function(){return c_}));var C={};n.r(C),n.d(C,"json",(function(){return E_}));var S={};n.r(S),n.d(S,"json",(function(){return I_}));var T={};n.r(T),n.d(T,"json",(function(){return R_}));var A={};n.r(A),n.d(A,"json",(function(){return O_}));var E={};n.r(E),n.d(E,"json",(function(){return N_}));var I={};n.r(I),n.d(I,"json",(function(){return D_}));var R={};n.r(R),n.d(R,"json",(function(){return P_}));var O={};n.r(O),n.d(O,"json",(function(){return F_}));var N={};n.r(N),n.d(N,"json",(function(){return M_}));var D={};n.r(D),n.d(D,"json",(function(){return L_}));var P={};n.r(P),n.d(P,"json",(function(){return z_}));var F={};n.r(F),n.d(F,"json",(function(){return B_}));var M={};n.r(M),n.d(M,"json",(function(){return j_}));var L={};n.r(L),n.d(L,"json",(function(){return V_}));var z={};n.r(z),n.d(z,"json",(function(){return q_}));var B={};n.r(B),n.d(B,"json",(function(){return U_}));var j={};n.r(j),n.d(j,"json",(function(){return W_}));var V={};n.r(V),n.d(V,"array",(function(){return rk})),n.d(V,"Dataset",(function(){return tk})),n.d(V,"zip",(function(){return ak})),n.d(V,"CSVDataset",(function(){return fk})),n.d(V,"TextLineDataset",(function(){return ok})),n.d(V,"csv",(function(){return Tk})),n.d(V,"func",(function(){return Ak})),n.d(V,"generator",(function(){return Ek})),n.d(V,"microphone",(function(){return Ok})),n.d(V,"webcam",(function(){return Ik})),n.d(V,"FileDataSource",(function(){return Ck})),n.d(V,"URLDataSource",(function(){return Sk})),n.d(V,"version_data",(function(){return Dk}));var q={};n.r(q),n.d(q,"simpleAbsImpl",(function(){return _w})),n.d(q,"addImpl",(function(){return lw})),n.d(q,"ceilImpl",(function(){return Dw})),n.d(q,"expImpl",(function(){return dx})),n.d(q,"expm1Impl",(function(){return mx})),n.d(q,"floorImpl",(function(){return Dx})),n.d(q,"logImpl",(function(){return Vx})),n.d(q,"maxImpl",(function(){return Gx})),n.d(q,"multiplyImpl",(function(){return gx})),n.d(q,"notEqualImpl",(function(){return nC})),n.d(q,"rsqrtImpl",(function(){return uC})),n.d(q,"sliceImpl",(function(){return kx})),n.d(q,"squaredDifferenceImpl",(function(){return SC})),n.d(q,"subImpl",(function(){return Cx})),n.d(q,"transposeImpl",(function(){return Hx})),n.d(q,"uniqueImpl",(function(){return OC}));var U=function(){function e(t,n){_classCallCheck2(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return _createClass2(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),W=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"time",value:function(e){return G("time")}},{key:"read",value:function(e){return G("read")}},{key:"readSync",value:function(e){return G("readSync")}},{key:"numDataIds",value:function(){return G("numDataIds")}},{key:"disposeData",value:function(e){return G("disposeData")}},{key:"write",value:function(e,t,n){return G("write")}},{key:"move",value:function(e,t,n,r){return G("move")}},{key:"memory",value:function(){return G("memory")}},{key:"floatPrecision",value:function(){return G("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"batchMatMul",value:function(e,t,n,r){return G("batchMatMul")}},{key:"fusedBatchMatMul",value:function(e){return _objectDestructuringEmpty(e),G("fusedBatchMatMul")}},{key:"slice",value:function(e,t,n){return G("slice")}},{key:"stridedSlice",value:function(e,t,n,r){return G("stridedSlice")}},{key:"unstack",value:function(e,t){return G("unstack")}},{key:"reverse",value:function(e,t){return G("reverse")}},{key:"concat",value:function(e,t){return G("concat")}},{key:"neg",value:function(e){return G("neg")}},{key:"add",value:function(e,t){return G("add")}},{key:"addN",value:function(e){return G("addN")}},{key:"subtract",value:function(e,t){return G("subtract")}},{key:"multiply",value:function(e,t){return G("multiply")}},{key:"realDivide",value:function(e,t){return G("realDivide")}},{key:"floorDiv",value:function(e,t){return G("floorDiv")}},{key:"sum",value:function(e,t){return G("sum")}},{key:"prod",value:function(e,t){return G("prod")}},{key:"unsortedSegmentSum",value:function(e,t,n){return G("unsortedSegmentSum")}},{key:"argMin",value:function(e,t){return G("argMin")}},{key:"argMax",value:function(e,t){return G("argMax")}},{key:"equal",value:function(e,t){return G("equal")}},{key:"notEqual",value:function(e,t){return G("notEqual")}},{key:"less",value:function(e,t){return G("less")}},{key:"lessEqual",value:function(e,t){return G("lessEqual")}},{key:"greater",value:function(e,t){return G("greater")}},{key:"greaterEqual",value:function(e,t){return G("greaterEqual")}},{key:"logicalNot",value:function(e){return G("logicalNot")}},{key:"logicalAnd",value:function(e,t){return G("logicalAnd")}},{key:"logicalOr",value:function(e,t){return G("logicalOr")}},{key:"where",value:function(e){return G("where")}},{key:"select",value:function(e,t,n){return G("select")}},{key:"topk",value:function(e,t,n){return G("topk")}},{key:"min",value:function(e,t){return G("min")}},{key:"minimum",value:function(e,t){return G("minimum")}},{key:"mod",value:function(e,t){return G("mod")}},{key:"max",value:function(e,t){return G("max")}},{key:"maximum",value:function(e,t){return G("maximum")}},{key:"all",value:function(e,t){return G("all")}},{key:"any",value:function(e,t){return G("any")}},{key:"squaredDifference",value:function(e,t){return G("squaredDifference")}},{key:"ceil",value:function(e){return G("ceil")}},{key:"floor",value:function(e){return G("floor")}},{key:"round",value:function(e){return G("round")}},{key:"sign",value:function(e){return G("sign")}},{key:"isNaN",value:function(e){return G("isNaN")}},{key:"isInf",value:function(e){return G("isInf")}},{key:"isFinite",value:function(e){return G("isFinite")}},{key:"pow",value:function(e,t){return G("pow")}},{key:"exp",value:function(e){return G("exp")}},{key:"expm1",value:function(e){return G("expm1")}},{key:"softmax",value:function(e,t){return G("softmax")}},{key:"log",value:function(e){return G("log")}},{key:"log1p",value:function(e){return G("log1p")}},{key:"sqrt",value:function(e){return G("sqrt")}},{key:"rsqrt",value:function(e){return G("rsqrt")}},{key:"square",value:function(e){return G("square")}},{key:"reciprocal",value:function(e){return G("reciprocal")}},{key:"relu",value:function(e){return G("relu")}},{key:"relu6",value:function(e){return G("relu6")}},{key:"prelu",value:function(e,t){return G("prelu")}},{key:"elu",value:function(e){return G("elu")}},{key:"eluDer",value:function(e,t){return G("eluDer")}},{key:"selu",value:function(e){return G("selu")}},{key:"int",value:function(e){return G("int")}},{key:"clip",value:function(e,t,n){return G("clip")}},{key:"abs",value:function(e){return G("abs")}},{key:"complexAbs",value:function(e){return G("complexAbs")}},{key:"sigmoid",value:function(e){return G("sigmoid")}},{key:"softplus",value:function(e){return G("softplus")}},{key:"sin",value:function(e){return G("sin")}},{key:"cos",value:function(e){return G("cos")}},{key:"tan",value:function(e){return G("tan")}},{key:"asin",value:function(e){return G("asin")}},{key:"acos",value:function(e){return G("acos")}},{key:"atan",value:function(e){return G("atan")}},{key:"atan2",value:function(e,t){return G("atan2")}},{key:"sinh",value:function(e){return G("sinh")}},{key:"cosh",value:function(e){return G("cosh")}},{key:"tanh",value:function(e){return G("tanh")}},{key:"asinh",value:function(e){return G("asinh")}},{key:"acosh",value:function(e){return G("acosh")}},{key:"atanh",value:function(e){return G("atanh")}},{key:"erf",value:function(e){return G("erf")}},{key:"step",value:function(e,t){return G("step")}},{key:"fusedConv2d",value:function(e){return _objectDestructuringEmpty(e),G("fusedConv2d")}},{key:"conv2d",value:function(e,t,n){return G("conv2d")}},{key:"conv2dDerInput",value:function(e,t,n){return G("conv2dDerInput")}},{key:"conv2dDerFilter",value:function(e,t,n){return G("conv2dDerFilter")}},{key:"fusedDepthwiseConv2D",value:function(e){return _objectDestructuringEmpty(e),G("fusedDepthwiseConv2D")}},{key:"depthwiseConv2D",value:function(e,t,n){return G("depthwiseConv2D")}},{key:"depthwiseConv2DDerInput",value:function(e,t,n){return G("depthwiseConv2DDerInput")}},{key:"depthwiseConv2DDerFilter",value:function(e,t,n){return G("depthwiseConv2DDerFilter")}},{key:"conv3d",value:function(e,t,n){return G("conv3d")}},{key:"conv3dDerInput",value:function(e,t,n){return G("conv3dDerInput")}},{key:"conv3dDerFilter",value:function(e,t,n){return G("conv3dDerFilter")}},{key:"maxPool",value:function(e,t){return G("maxPool")}},{key:"maxPoolBackprop",value:function(e,t,n,r){return G("maxPoolBackprop")}},{key:"avgPool",value:function(e,t){return G("avgPool")}},{key:"avgPoolBackprop",value:function(e,t,n){return G("avgPoolBackprop")}},{key:"avgPool3d",value:function(e,t){return G("avgPool3d")}},{key:"avgPool3dBackprop",value:function(e,t,n){return G("avgPool3dBackprop")}},{key:"maxPool3d",value:function(e,t){return G("maxPool3d")}},{key:"maxPool3dBackprop",value:function(e,t,n,r){return G("maxPool3dBackprop")}},{key:"reshape",value:function(e,t){return G("reshape")}},{key:"cast",value:function(e,t){return G("cast")}},{key:"tile",value:function(e,t){return G("tile")}},{key:"pad",value:function(e,t,n){return G("pad")}},{key:"transpose",value:function(e,t){return G("transpose")}},{key:"gather",value:function(e,t,n){return G("gather")}},{key:"gatherND",value:function(e,t){return G("gatherND")}},{key:"scatterND",value:function(e,t,n){return G("scatterND")}},{key:"batchToSpaceND",value:function(e,t,n){return G("batchToSpaceND")}},{key:"spaceToBatchND",value:function(e,t,n){return G("spaceToBatchND")}},{key:"resizeBilinear",value:function(e,t,n,r){return G("resizeBilinear")}},{key:"resizeBilinearBackprop",value:function(e,t,n){return G("resizeBilinearBackprop")}},{key:"resizeNearestNeighbor",value:function(e,t,n,r){return G("resizeNearestNeighbor")}},{key:"resizeNearestNeighborBackprop",value:function(e,t,n){return G("resizeNearestNeighborBackprop")}},{key:"batchNorm",value:function(e,t,n,r,a,i){return G("batchNorm")}},{key:"localResponseNormalization4D",value:function(e,t,n,r,a){return G("localResponseNormalization4D")}},{key:"LRNGrad",value:function(e,t,n,r,a,i,o){return G("LRNGrad")}},{key:"multinomial",value:function(e,t,n,r){return G("multinomial")}},{key:"oneHot",value:function(e,t,n,r){return G("oneHot")}},{key:"cumsum",value:function(e,t,n,r){return G("cumsum")}},{key:"nonMaxSuppression",value:function(e,t,n,r,a){return G("nonMaxSuppression")}},{key:"fft",value:function(e){return G("fft")}},{key:"ifft",value:function(e){return G("ifft")}},{key:"complex",value:function(e,t){return G("complex")}},{key:"real",value:function(e){return G("real")}},{key:"imag",value:function(e){return G("imag")}},{key:"cropAndResize",value:function(e,t,n,r,a,i){return G("cropAndResize")}},{key:"depthToSpace",value:function(e,t,n){return G("depthToSpace")}},{key:"split",value:function(e,t,n){return G("split")}},{key:"sparseToDense",value:function(e,t,n,r){return G("sparseToDense")}},{key:"diag",value:function(e){return G("diag")}},{key:"fill",value:function(e,t,n){return G("fill")}},{key:"onesLike",value:function(e){return G("onesLike")}},{key:"zerosLike",value:function(e){return G("zerosLike")}},{key:"linspace",value:function(e,t,n){return G("linspace")}},{key:"dispose",value:function(){return G("dispose")}}]),e}();function G(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function H(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function K(e,t,n){return Math.max(e,Math.min(t,n))}function X(e){return e%2==0?e:e+1}function Q(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function Y(e,t){var n=Math.random();return t*n+(1-n)*e}function Z(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n}function J(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function $(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";J(ae(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function ee(e){J(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||_e(e)&&!n)for(var r=0;r<e.length;++r)te(e[r],t,n);else t.push(e);return t}function ne(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function re(e){return 0===e.length}function ae(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function ie(e){return e%1==0}function oe(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function se(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function ue(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return H(t),t}function ce(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function le(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise((function(r,a){var i=0;!function o(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}}()}))}function he(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function fe(e,t){var n=t.length;return J((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ")+e})),J(e.every((function(e){return ie(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function de(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:fe(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function pe(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function me(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function ve(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function ge(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function ye(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function _e(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function be(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function ke(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function we(e){return"string"==typeof e||e instanceof String}function xe(e){return"boolean"==typeof e}function Ce(e){return"number"==typeof e}function Se(e){return Array.isArray(e)?Se(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":Ce(e)?"float32":we(e)?"string":xe(e)?"bool":"float32"}function Te(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Ae(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function Ee(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Ie(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length,"."));return function e(t,n,r){var a=new Array;if(1===n.length)for(var i=n[0],o=0;o<i;o++)a[o]=r[t+o];else for(var s=n[0],u=n.slice(1),c=u.reduce((function(e,t){return e*t})),l=0;l<s;l++)a[l]=e(t+l*c,u,r);return a}(0,e,t)}function Re(e,t){for(var n=Oe(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Oe(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function Ne(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return Ie(e,new Float32Array(n));if("int32"===t)return Ie(e,new Int32Array(n));if("bool"===t)return Ie(e,new Uint8Array(n));throw new Error("Unknown data type "+t)}function De(e){e.forEach((function(t){J(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")}))}))}function Pe(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function Fe(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function Me(e){return e&&e.then&&"function"==typeof e.then}var Le=function(){function e(t){_classCallCheck2(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}var t;return _createClass2(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(t,".")),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t in this.flags,e.t0){e.next=5;break}return e.next=4,this.evaluateFlag(t);case 4:this.flags[t]=e.sent;case 5:return e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Me(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n,r=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(n,r[0],r[1]),r.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(t){var n=_slicedToArray2(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(r,a)}))}}},{key:"features",get:function(){return this.flags}}]),e}();function ze(){return je}var Be,je=null;function Ve(){if(null==Be){var e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Be=e}return Be}function qe(e,t){var n,r=(null==(n=Ve())._tfGlobals&&(n._tfGlobals=new Map),n._tfGlobals);if(r.has(e))return r.get(e);var a=t();return r.set(e,a),r.get(e)}var Ue="Cos",We="Div",Ge="Sin",He="Sub",Ke="Tan",Xe=qe("kernelRegistry",(function(){return new Map})),Qe=qe("gradRegistry",(function(){return new Map}));function Ye(e,t){var n=at(e,t);return Xe.get(n)}function Ze(e){return Qe.get(e)}function Je(e){for(var t=Xe.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=_slicedToArray2(i,2),s=o[0],u=o[1];_slicedToArray2(s.split("_"),1)[0]===e&&n.push(u)}return n}function $e(e){var t=e.kernelName,n=e.backendName,r=at(t,n);Xe.has(r)&&console.warn("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),Xe.set(r,e)}function et(e){var t=e.kernelName;Qe.has(t)&&ze().getBool("DEBUG")&&console.warn("Overriding the gradient for '".concat(t,"'")),Qe.set(t,e)}function tt(e,t){var n=at(e,t);if(!Xe.has(n))throw new Error("The kernel '".concat(e,"' for backend '").concat(t,"' is not registered"));Xe.delete(n)}function nt(e){if(!Qe.has(e))throw new Error("The gradient '".concat(e,"' for backend is not registered"));Qe.delete(e)}function rt(e,t){Je(e).forEach((function(e){$e(Object.assign({},e,{backendName:t}))}))}function at(e,t){return"".concat(t,"_").concat(e)}var it=function(){function e(t,n){_classCallCheck2(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new ot)}return _createClass2(e,[{key:"profileKernel",value:function(e,t,n){for(var r,a=this.backendTimer.time((function(){r=n()})),i=function(t){var n=r[t];n.data().then((function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)}))},o=0;o<r.length;o++)i(o);return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var ot=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"==typeof r?ce(r+"ms",9):r.error,s=ce(e,25),u=t.rank,c=t.size,l=ce(t.shape.toString(),14),h="";for(var f in a){var d=a[f];if(null!=d){var p=d.shape||t.shape,m=p.length;h+="".concat(f,": ").concat(m,"D ").concat(m>0?p:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(h,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function st(e,t,n){return ce(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":we(e)?"'".concat(e,"'"):"bool"===n?ut(e):parseFloat(e.toFixed(7)).toString(),t)}function ut(e){return 0===e?"false":"true"}function ct(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}function lt(e,t){return"string"===t?pt(e):ht([e],t)}function ht(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=te(e)),ze().getBool("DEBUG")&&ve(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type "+t)}function ft(){return ze().platform.now()}function dt(e,t){return ze().platform.fetch(e,t)}function pt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",ze().platform.encode(e,t)}function mt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",ze().platform.decode(e,t)}var vt=function(){function e(t,n,r){var a=this;if(_classCallCheck2(this,e),this.dtype=n,this.shape=t.slice(),this.size=ne(t),null!=r){var i=r.length;J(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size inferred by the shape '").concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||me(n,this.size),this.strides=Ee(t)}return _createClass2(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),J(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must match the rank (").concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r])throw new Error("Requested out of range element at ".concat(t,".   Buffer shape=")+this.shape);r++}for(var s=t[t.length-1],u=0;u<t.length-1;++u)s+=this.strides[u]*t[u];return this.values[s]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"toTensor",value:function(){return gt().makeTensor(this.values,this.shape,this.dtype)}},{key:"rank",get:function(){return this.shape.length}}]),e}(),gt=null,yt=null,_t=function(){function e(t,n,r,a){_classCallCheck2(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=ne(t),this.strides=Ee(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}var t,n,r,a;return _createClass2(e,[{key:"buffer",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",yt.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"bufferSync",value:function(){return yt.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Ie(this.shape,t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"arraySync",value:function(){return Ie(this.shape,this.dataSync())}},{key:"data",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=gt().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return mt(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])}))),function(){return n.apply(this,arguments)})},{key:"dataSync",value:function(){this.throwIfDisposed();var e=gt().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return mt(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,gt().read(this.dataId);case 3:return t=e.sent,e.abrupt("return","string"===this.dtype?t:new Uint8Array(t.buffer));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"dispose",value:function(){this.isDisposed||(gt().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return yt.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),yt.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e,t,n,r){var a=Ee(t),i=function(e,t,n,r){var a=ne(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?ct(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,h=0;h<i;h++)o[h]=Math.max(o[h],st(u[l+h],0,n).length);return o}(e,t,n,a),o=t.length,s=function e(t,n,r,a,i){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[st(ct(t)[0],0,r)]:"bool"===r?[ut(t[0])]:[t[0].toString()];if(1===c){if(u>20){var l=Array.from(t.slice(0,3*s)),h=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(l=ct(l),h=ct(h)),["["+l.map((function(e,t){return st(e,i[t],r)})).join(", ")+", ..., "+h.map((function(e,t){return st(e,i[u-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?ct(t):Array.from(t)).map((function(e,t){return st(e,i[t],r)})).join(", ")+"]"]}var f=n.slice(1),d=a.slice(1),p=a[0]*s,m=[];if(u>20){for(var v=0;v<3;v++){var g=v*p;m.push.apply(m,_toConsumableArray(e(t.slice(g,g+p),f,r,d,i,!1)))}m.push("...");for(var y=u-3;y<u;y++){var _=y*p;m.push.apply(m,_toConsumableArray(e(t.slice(_,_+p),f,r,d,i,y===u-1)))}}else for(var b=0;b<u;b++){var k=b*p;m.push.apply(m,_toConsumableArray(e(t.slice(k,k+p),f,r,d,i,b===u-1)))}var w=2===c?",":"";m[0]="["+m[0]+w;for(var x=1;x<m.length-1;x++)m[x]=" "+m[x]+w;for(var C=",\n",S=2;S<c;S++)C+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(o?"":C),m}(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+o),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),yt.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),gt().makeVariable(this,e,t,n)}},{key:"rank",get:function(){return this.shape.length}},{key:"isDisposed",get:function(){return this.isDisposedInternal}}]),e}();Object.defineProperty(_t,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}});var bt,kt,wt,xt,Ct,St=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,a,i){var o;return _classCallCheck2(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return _createClass2(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!ae(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));gt().disposeTensor(this),this.dataId=e.dataId,gt().incRef(this,null)}},{key:"dispose",value:function(){gt().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(_t);Object.defineProperty(St,Symbol.hasInstance,{value:function(e){return e instanceof _t&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(bt||(bt={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(kt||(kt={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(wt||(wt={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(xt||(xt={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Ct||(Ct={}));var Tt={float32:xt,int32:kt,bool:wt,complex64:Ct};function At(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Tt[e][t]}function Et(e){return At(e,"int32")}function It(e,t){if(e.dtype===t.dtype)return[e,t];var n=At(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Rt(e,t){J(e.dtype===t.dtype,(function(){return"The dtypes of the first(".concat(e.dtype,") and second(").concat(t.dtype,") input must match")}))}function Ot(e,t){return t.some((function(t){return t.id===e.id}))}function Nt(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof _t)n.push(t);else if(a=t,Array.isArray(a)||"object"==typeof a){var a,i=t;for(var o in i){var s=i[o];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}var Dt=function(){function e(){_classCallCheck2(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return _createClass2(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),Pt=function(){function e(t){_classCallCheck2(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Dt}var t,n,r,a;return _createClass2(e,[{key:"ready",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=17;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=14;break}return e.next=13,this.setBackend(r);case 13:return e.abrupt("return",void e.sent);case 14:n++,e.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=14;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=11;break}return e.next=8,r;case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=r;case 12:if(e.t0){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",(this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new it(this.backendInstance),!0));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setupRegisteredKernels",value:function(){var e=this;Je(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;Je(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof W||"function"!=typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(o){return console.warn("Initialization of backend ".concat(e," failed")),console.warn(o.stack||o.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype);return this.addTapeNode(this.state.activeScope.name,{x:e},[t],(function(e){return{x:function(){return Mt.runKernelFunc((function(t){return t.cast(e,"float32")}),{x:e},null,"Cast",{dtype:"float32"})}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n,r,a){return this.runKernelFunc(null,t,null,e,n,r,a)}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=r-t-a-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(i>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(i," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e,t,n,r,a,i,o){var s,u=this,c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,f=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var p,m,v=Ye(r,this.backendName);if(null!=v)h=function(){var e=u.backend.numDataIds();p=v.kernelFunc({inputs:t,attrs:a,backend:u.backend});var n=Array.isArray(p)?p:[p];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)}));if(l){var h=u.getTensorsForGradient(r,t,s);if(null==h){null==o&&(o=[]);var f=s.filter((function(e,t){return o[t]}));h=(i||[]).slice().concat(f)}c=u.saveTensorsForBackwardMode(h)}return s};else{var g=function(e){l&&(c=e.map((function(e){return u.keep(u.clone(e))})))};h=function(){var t=u.backend.numDataIds();p=u.tidy((function(){return e(u.backend,g)}));var n=Array.isArray(p)?p:[p];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){u.ENV.getBool("DEBUG")||u.state.profiling?(m=u.profiler.profileKernel(r,t,(function(){return h()})),u.ENV.getBool("DEBUG")&&u.profiler.logKernelProfile(m),s=m.outputs):s=h()})),l&&this.addTapeNode(r,t,s,n,c,a),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return null!=t[e]?t[e].shape:null})),outputShapes:s.map((function(e){return e.shape})),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(p)?s:s[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=Ze(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(J(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return null}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");r=r||this.backend;var a=e;"string"===(n=n||"float32")&&we(e[0])&&(a=e.map((function(e){return pt(e)})));var i=r.write(a,t,n),o=new _t(t,n,i,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=ke(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a=new _t(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,r),a}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new St(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"incRef",value:function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*be(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof St||this.track(e)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[e])}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=5,t();case 5:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,_toConsumableArray(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=_createForOfIteratorHelper(this.state.activeProfile.kernels),e.prev=11,a.s();case 13:if((i=a.n()).done){e.next=23;break}return o=i.value,e.next=17,o.kernelTimeMs;case 17:return o.kernelTimeMs=e.sent,e.next=20,o.extraInfo;case 20:o.extraInfo=e.sent;case 21:e.next=13;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(11),a.e(e.t0);case 28:return e.prev=28,a.f(),e.finish(28);case 31:return e.abrupt("return",this.state.activeProfile);case 32:case"end":return e.stop()}}),e,this,[[11,25,28,31]])}))),function(e){return n.apply(this,arguments)})},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=Ze(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=Oe(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=Nt(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(J(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));J(i instanceof _t,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],h=!1,f=0;f<t.length;f++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),h=!0,a[s.id]=!0;break}if(h)break}}var d={};d[n.id]=!0;for(var p={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(d[v.outputs[y].id]){for(var _ in g)d[g[_].id]=!0,p[v.id]=!0;break}for(var b=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&p[w.id]){var x={};for(var C in w.inputs){var S=w.inputs[C];r[S.id]&&(x[C]=S)}var T=Object.assign({},w);T.inputs=x,T.outputs=w.outputs,b.push(T)}}return b}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,a,s={};s[i.id]=null==n?(e=i.shape,a=Re(ne(e),"float32"),Mt.makeTensor(a,e,"float32")):n,function(e,t,n,a){for(var i=function(n){var i=t[n],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];o.push(null!=n?n:null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(i.kernelName,"."));var s=i.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". Available gradients found: ").concat(Object.keys(s),"."));var n=function(e){return r.tidy(e)}((function(){return s[t]()}));if("float32"!==n.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ").concat(t," must have 'float32' dtype, but has '").concat(n.dtype,"'"));var o=i.inputs[t];if(!ae(n.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input '").concat(t,"' has shape '").concat(n.shape,"', which does not match the shape of the input '").concat(o.shape,"'"));if(null==e[o.id])e[o.id]=n;else{var u=e[o.id];e[o.id]=a(u,n),u.dispose()}};for(var c in i.inputs)u(c)},o=t.length-1;o>=0;o--)i(o)}(s,o,0,Lt);var u=t.map((function(e){return s[e.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=_createForOfIteratorHelper(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:u}}))}},{key:"customGrad",value:function(e){var t=this;return J(Te(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;J(r.every((function(e){return e instanceof _t})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};return r.forEach((function(e,t){o[t]=e})),t.runKernelFunc((function(t,n){return J((i=e.apply(void 0,r.concat([n]))).value instanceof _t,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),J(Te(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value}),o,(function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];J(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),J(a.every((function(e){return e instanceof _t})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"time",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ft(),e.next=3,this.backend.time(t);case 3:return r=e.sent,e.abrupt("return",(r.wallMs=ft()-n,r));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Dt,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(t)}return this.backendInstance}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}}]),e}();function Ft(){var e=Ve();if(null==e._tfengine){var t=new Le(e);e._tfengine=new Pt(t)}return je=e._tfengine.ENV,gt=function(){return e._tfengine},e._tfengine}Pt.nextTensorId=0,Pt.nextVariableId=0;var Mt=Ft();function Lt(e,t){return Mt.runKernelFunc((function(n,r){var a=n.add(e,t);return r([e,t]),a}),{a:e,b:t},null,"Add")}function zt(){if("undefined"!=typeof navigator&&null!=navigator){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function Bt(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var jt=ze();function Vt(e,t){var n=e;if(_e(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||_e(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&ze().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||_e(t)){J(n.length>0,(function(){return"Element arr[".concat(r.join("]["),"] should be a primitive, but is an array of ").concat(t.length," elements")})),J(t.length===n[0],(function(){return"Element arr[".concat(r.join("]["),"] should have ").concat(n[0]," elements, but has ").concat(t.length," elements")}));for(var a=n.slice(1),i=0;i<t.length;++i)e(t[i],a,r.concat(i))}else J(0===n.length,(function(){return"Element arr[".concat(r.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(n[0]," elements")}))}(e,r,[]),r}function qt(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}function Ut(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof _t)return qt(r,e.dtype,t,n),e;var a=Se(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),qt(r,a,t,n),null==e||!_e(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(null==e?"null":e.constructor.name,"'"));var i=Vt(e,a);_e(e)||Array.isArray(e)||(e=[e]);var o="string"!==a?ht(e,a):te(e,[],!0);return Mt.makeTensor(o,i,a)}function Wt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map((function(e,r){return Ut(e,"".concat(t,"[").concat(r,"]"),n)}),r)}function Gt(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var a=function(){Mt.startScope(n);try{var e=r.apply(void 0,arguments);return Me(e)&&console.error("Cannot return a Promise inside of tidy."),Mt.endScope(e),e}catch(t){throw Mt.endScope(null),t}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}jt.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),jt.registerFlag("IS_BROWSER",(function(){return Bt()})),jt.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),jt.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),jt.registerFlag("PROD",(function(){return!1})),jt.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return jt.getBool("DEBUG")})),jt.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),jt.registerFlag("IS_TEST",(function(){return!1}));var Ht=Gt({complex_:function(e,t){var n=Ut(e,"real","complex"),r=Ut(t,"imag","complex");return $(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", must match in call to tf.complex().")),Mt.runKernelFunc((function(e){return e.complex(n,r)}),{real:n,imag:r},null,"Complex")}});function Kt(e,t,n,r){if(null==r&&(r=Se(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!_e(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){De(t);var a=ne(t),i=ne(n);J(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==ne(t.slice(o));J(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")}))}}return _e(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?ht(e,r):te(e,[],!0),Mt.makeTensor(e,t,r)}function Xt(e,t,n){return Kt(e,t,Vt(e,n),n)}var Qt={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function Yt(e,t){return Zt.apply(this,arguments)}function Zt(){return(Zt=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=function(e){var o=i[e],s=Array.isArray(t)?t[e].tensor:t[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(s.dtype));var u={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){var c=new Promise(function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+4*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)u=n[o],c=new Uint8Array(new Uint32Array([u.length]).buffer),a.set(c,i),i+=4,a.set(u,i),i+=u.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());a.push(c)}else a.push(s.data());null!=n&&(u.group=n),r.push(u)},s=0;s<i.length;++s)o(s);return e.t0=$t,e.next=6,Promise.all(a);case 6:return e.t1=e.sent,e.t2=(0,e.t0)(e.t1),e.t3=r,e.abrupt("return",{data:e.t2,specs:e.t3});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jt(e,t){var n,r,a={},i=0,o=_createForOfIteratorHelper(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,c=s.dtype,l=s.shape,h=ne(l),f=void 0;if("quantization"in s){var d=s.quantization;if("uint8"===d.dtype||"uint16"===d.dtype){if(!("min"in d&&"scale"in d))throw new Error("Weight ".concat(s.name," with quantization ").concat(d.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==d.dtype)throw new Error("Weight ".concat(s.name," has unknown quantization dtype ").concat(d.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==c)throw new Error("Weight ".concat(s.name," is quantized with ").concat(d.dtype," which only supports weights of type float32 not ").concat(c,"."))}var p=Qt[d.dtype],m=e.slice(i,i+h*p),v="uint8"===d.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===c)if("uint8"===d.dtype||"uint16"===d.dtype){f=new Float32Array(v.length);for(var g=0;g<v.length;g++)f[g]=v[g]*d.scale+d.min}else{if("float16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," for weight type float32."));void 0===n&&(n=on()),f=n(v)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));if("uint8"!==d.dtype&&"uint16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," for weight type int32."));f=new Int32Array(v.length);for(var y=0;y<v.length;y++)f[y]=Math.round(v[y]*d.scale+d.min)}i+=h*p}else if("string"===c){var _=ne(s.shape);f=[];for(var b=0;b<_;b++){var k=new Uint32Array(e.slice(i,i+4))[0];i+=4;var w=new Uint8Array(e.slice(i,i+k));f.push(w),i+=k}}else{var x=Qt[c],C=e.slice(i,i+h*x);if("float32"===c)f=new Float32Array(C);else if("int32"===c)f=new Int32Array(C);else if("bool"===c)f=new Uint8Array(C);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));f=new Float32Array(C);for(var S=new Float32Array(f.length/2),T=new Float32Array(f.length/2),A=0;A<S.length;A++)S[A]=f[2*A],T[A]=f[2*A+1];var E=Xt(S,l,"float32"),I=Xt(T,l,"float32");a[u]=Ht(E,I),E.dispose(),I.dispose()}i+=h*x}"complex64"!==c&&(a[u]=Xt(f,l,c))}}catch(R){o.e(R)}finally{o.f()}return a}function $t(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var en="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function tn(e){return en?Buffer.byteLength(e):new Blob([e]).size}function nn(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function rn(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function an(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:tn(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:tn(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function on(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0==(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|(n+=947912704)},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o];i[o]=e[n[s>>10]+(1023&s)]+t[s>>10]}return new Float32Array(a)}}var sn=function(){function e(){_classCallCheck2(this,e),this.saveRouters=[],this.loadRouters=[]}return _createClass2(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),un=function(e){return sn.registerSaveRouter(e)},cn=function(e){return sn.registerLoadRouter(e)},ln=function(e){return sn.getSaveHandlers(e)},hn=function(e,t){return sn.getLoadHandlers(e,t)};function fn(){if(!ze().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function dn(e){var t=e.result;t.createObjectStore("models_store",{keyPath:"modelPath"}),t.createObjectStore("model_info_store",{keyPath:"modelPath"})}var pn=function(){function e(t){if(_classCallCheck2(this,e),this.indexedDB=fn(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}var t,n;return _createClass2(e,[{key:"save",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return dn(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction("models_store","readonly"),s=o.objectStore("models_store").get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' in IndexedDB.")));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=an(t),l=i.transaction("model_info_store","readwrite"),h=l.objectStore("model_info_store"),f=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});f.onsuccess=function(){var a=(u=i.transaction("models_store","readwrite")).objectStore("models_store").put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(h=l.objectStore("model_info_store")).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},f.onerror=function(e){return i.close(),r(f.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();pn.URL_SCHEME="indexeddb://";var mn=function(e){return ze().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(pn.URL_SCHEME)?(t=e.slice(pn.URL_SCHEME.length),new pn(t)):null;var t};sn.registerSaveRouter(mn),sn.registerLoadRouter(mn);var vn=function(){function e(){_classCallCheck2(this,e),this.indexedDB=fn()}var t,n;return _createClass2(e,[{key:"listModels",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return dn(r)},r.onsuccess=function(){var t=r.result,a=t.transaction("model_info_store","readonly"),i=a.objectStore("model_info_store").getAll();i.onsuccess=function(){var t,n={},r=_createForOfIteratorHelper(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"removeModel",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=(n=t).startsWith(pn.URL_SCHEME)?n.slice(pn.URL_SCHEME.length):n,new Promise((function(e,n){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return dn(a)},a.onsuccess=function(){var r,i=a.result,o=i.transaction("model_info_store","readwrite"),s=o.objectStore("model_info_store"),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),n(new Error("Cannot find model with path '".concat(t,"' in IndexedDB.")));var a=s.delete(t),o=function(){var a=(r=i.transaction("models_store","readwrite")).objectStore("models_store").delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return n(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),n(u.error)}},u.onerror=function(e){return i.close(),n(u.error)},o.oncomplete=function(){null==r?i.close():r.oncomplete=function(){return i.close()}}},a.onerror=function(e){return n(a.error)}}))));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}(),gn="tensorflowjs_models",yn="info",_n="model_topology",bn="weight_specs",kn="weight_data",wn="model_metadata";function xn(e){return{info:[gn,e,yn].join("/"),topology:[gn,e,_n].join("/"),weightSpecs:[gn,e,bn].join("/"),weightData:[gn,e,kn].join("/"),modelMetadata:[gn,e,wn].join("/")}}function Cn(e){var t=e.split("/");if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join("/")}var Sn=function(){function e(t){if(_classCallCheck2(this,e),!ze().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=xn(this.modelPath)}var t,n;return _createClass2(e,[{key:"save",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=an(t),e.prev=3,e.abrupt("return",(this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(e){if(en)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),{modelArtifactsInfo:a}));case 7:throw e.prev=7,e.t0=e.catch(3),this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(a.modelTopologyBytes,", weightSpecsBytes=").concat(a.weightSpecsBytes,", weightDataBytes=").concat(a.weightDataBytes,"."));case 10:case"end":return e.stop()}}),e,this,[[3,7]])}))),function(e){return n.apply(this,arguments)})},{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));case 8:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));case 12:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,n.userDefinedMetadata=o.userDefinedMetadata),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));case 18:return e.abrupt("return",(n.weightData=function(e){if(en){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}(s),n));case 19:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();Sn.URL_SCHEME="localstorage://";var Tn=function(e){return ze().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Sn.URL_SCHEME)?(t=e.slice(Sn.URL_SCHEME.length),new Sn(t)):null;var t};sn.registerSaveRouter(Tn),sn.registerLoadRouter(Tn);var An=function(){function e(){_classCallCheck2(this,e),J(ze().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),J("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}var t,n;return _createClass2(e,[{key:"listModels",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=gn+"/",r="/"+yn,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(t[Cn(i)]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"removeModel",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=xn(t=(n=t).startsWith(Sn.URL_SCHEME)?n.slice(Sn.URL_SCHEME.length):n),null!=this.LS.getItem(r.info)){e.next=3;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 3:return a=JSON.parse(this.LS.getItem(r.info)),e.abrupt("return",(this.LS.removeItem(r.info),this.LS.removeItem(r.topology),this.LS.removeItem(r.weightSpecs),this.LS.removeItem(r.weightData),a));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),En=function(){function e(){_classCallCheck2(this,e),this.managers={}}return _createClass2(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){J(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith("://")&&(t=t.slice(0,t.indexOf("://"))),J(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();J(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}},{key:"getSchemes",value:function(){return Object.keys(this.getInstance().managers)}}]),e}();function In(e){if(-1===e.indexOf("://"))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+En.getSchemes().join(","));return{scheme:e.split("://")[0],path:e.split("://")[1]}}function Rn(e,t){return On.apply(this,arguments)}function On(){return(On=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f,d=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>2&&void 0!==d[2]&&d[2],J(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),J((a=sn.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),J(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") load handlers for source URL ").concat(t,".")})),i=a[0],J((o=sn.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination URL ".concat(n,".")})),J(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") save handlers for destination URL ").concat(n,".")})),s=o[0],u=In(t).scheme,c=In(t).path,l=u===In(t).scheme,e.next=12,i.load();case 12:if(h=e.sent,e.t0=r&&l,!e.t0){e.next=17;break}return e.next=17,En.getManager(u).removeModel(c);case 17:return e.next=19,s.save(h);case 19:if(f=e.sent,e.t1=r&&!l,!e.t1){e.next=24;break}return e.next=24,En.getManager(u).removeModel(c);case 24:return e.abrupt("return",f.modelArtifactsInfo);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Nn(){return Dn.apply(this,arguments)}function Dn(){return(Dn=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=En.getSchemes(),n={},r=_createForOfIteratorHelper(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=12;break}return i=a.value,e.next=8,En.getManager(i).listModels();case 8:for(s in o=e.sent)n[i+"://"+s]=o[s];case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])})))).apply(this,arguments)}function Pn(e){return Fn.apply(this,arguments)}function Fn(){return(Fn=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=In(t),e.abrupt("return",En.getManager(n.scheme).removeModel(n.path));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Mn(e,t){return Ln.apply(this,arguments)}function Ln(){return(Ln=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Rn(t,n,!1));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zn(e,t){return Bn.apply(this,arguments)}function Bn(){return(Bn=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Rn(t,n,!0));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var jn,Vn=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}();if(ze().get("IS_BROWSER")){ze().setPlatform("browser",new Vn);try{En.registerManager(Sn.URL_SCHEME,new An)}catch(sI){}try{En.registerManager(pn.URL_SCHEME,new vn)}catch(sI){}}function qn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",De(e),new vt(e,t,n)}ze().get("IS_NODE")&&ze().setPlatform("node",new(function(){function e(){_classCallCheck2(this,e),this.util=n(2),this.textEncoder=new this.util.TextEncoder}return _createClass2(e,[{key:"fetch",value:function(e,t){return null!=ze().global.fetch?ze().global.fetch(e,t):(null==jn&&(jn=n(1)),jn(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}()));var Un=Gt({cast_:function(e,t){var n=Ut(e,"x","cast");if(!ge(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return Mt.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},null,"Cast",{dtype:t})}}),Wn=Gt({clone_:function(e){var t=Ut(e,"x","clone",null);return Mt.runKernelFunc((function(){return Mt.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{x:t},null,"Identity")}});function Gn(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}function Hn(e){return new Promise((function(e){return setTimeout(e)})).then(e)}Ft(),yt={buffer:qn,cast:Un,clone:Wn,print:Gn};var Kn=function(){function e(t){if(_classCallCheck2(this,e),!ze().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}var t;return _createClass2(e,[{key:"save",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=5;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 5:return r=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]})],{type:"application/json"})),(a=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=r,e.next=10,Hn((function(){return a.dispatchEvent(new MouseEvent("click"))}));case 10:if(null==t.weightData){e.next=16;break}return(i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=n,e.next=16,Hn((function(){return i.dispatchEvent(new MouseEvent("click"))}));case 16:return e.abrupt("return",{modelArtifactsInfo:an(t)});case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();Kn.URL_SCHEME="downloads://";var Xn=function(){function e(t){if(_classCallCheck2(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}var t;return _createClass2(e,[{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.files[0],n=this.files.slice(1),e.abrupt("return",new Promise((function(e,a){var i=new FileReader;i.onload=function(i){var o=JSON.parse(i.target.result),s=o.modelTopology;if(null!=s){0===n.length&&e({modelTopology:s});var u=o.weightsManifest;if(null!=u){var c;try{c=r.checkManifestAndWeightFiles(u,n)}catch(sI){return void a(sI)}var l=[],h=[],f=[];u.forEach((function(e){e.paths.forEach((function(e){h.push(e),f.push(null)})),l.push.apply(l,_toConsumableArray(e.weights))})),u.forEach((function(t){t.paths.forEach((function(t){var n=new FileReader;n.onload=function(n){var r=n.target.result,a=h.indexOf(t);f[a]=r,-1===f.indexOf(null)&&e({modelTopology:s,weightSpecs:l,weightData:nn(f),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy,userDefinedMetadata:o.userDefinedMetadata})},n.onerror=function(e){return a("Failed to weights data from file of path '".concat(t,"'."))},n.readAsArrayBuffer(c[t])}))}))}else a(new Error("weightManifest field is missing from file "+t.name))}else a(new Error("modelTopology field is missing from file "+t.name))},i.onerror=function(e){return a("Failed to read model topology and weights manifest JSON from file '".concat(t.name,"'. BrowserFiles supports loading Keras-style tf.Model artifacts only."))},i.readAsText(t)})));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"checkManifestAndWeightFiles",value:function(e,t){var n,r=[],a=t.map((function(e){return rn(e.name)})),i={},o=_createForOfIteratorHelper(e);try{for(o.s();!(n=o.n()).done;){n.value.paths.forEach((function(e){var n=rn(e);if(-1!==r.indexOf(n))throw new Error("Duplicate file basename found in weights manifest: '".concat(n,"'"));if(r.push(n),-1===a.indexOf(n))throw new Error("Weight file with basename '".concat(n,"' is not provided."));i[e]=t[a.indexOf(n)]}))}}catch(sI){o.e(sI)}finally{o.f()}if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest (".concat(r.length,") and the number of weight files provided (").concat(t.length,")."));return i}}]),e}();function Qn(e){return new Xn(e)}function Yn(e,t,n,r){!function(e){J(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){J(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),J(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),J(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ")+t}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function Zn(e,t){return Jn.apply(this,arguments)}function Jn(){return(Jn=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?ze().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),null!=n.onProgress){e.next=9;break}return e.next=6,Promise.all(a);case 6:e.t0=e.sent,e.next=12;break;case 9:return e.next=11,Yn(a,n.onProgress,0,.5);case 11:e.t0=e.sent;case 12:if(i=e.t0.map((function(e){return e.arrayBuffer()})),null!=n.onProgress){e.next=19;break}return e.next=16,Promise.all(i);case 16:e.t1=e.sent,e.next=22;break;case 19:return e.next=21,Yn(i,n.onProgress,.5,1);case 21:e.t1=e.sent;case 22:return e.abrupt("return",e.t1);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $n(e){return er.apply(this,arguments)}function er(){return(er=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"",r=i.length>2?i[2]:void 0,a=i.length>3?i[3]:void 0,e.abrupt("return",tr((function(e){return Zn(e,{requestInit:a})}))(t,n,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tr(e){return function(){var t=_asyncToGenerator(regeneratorRuntime.mark((function t(n){var r,a,i,o,s,u,c,l,h,f,d,p,m=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:"",a=m.length>2?m[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r=Qt["quantization"in e?e.quantization.dtype:e.dtype]*ne(e.shape),c=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:r})};null!=a?a.forEach((function(t,n){t===e.name&&(c(),s[n]=!0)})):c(),u.push(e.name),n+=r}))})),s.every((function(e){return e}))){t.next=6;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");case 6:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),h=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;h.push(t)}))})),t.next=10,e(h);case 10:return f=t.sent,d={},p=0,t.abrupt("return",(l.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=f[p+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(f[p+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=Jt(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]})),p+=t})),d));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}sn.registerSaveRouter((function(e){return ze().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Kn.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new Kn(e)}(e.slice(Kn.URL_SCHEME.length)):null}));var nr=function(){function e(t,n){if(_classCallCheck2(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(J("function"==typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=ze().platform.fetch,J(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&J(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}var t,n,r;return _createClass2(e,[{key:"save",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n.body.append("model.json",new Blob([JSON.stringify({modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:t.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=6,this.fetch(this.path,n);case 6:if(!(r=e.sent).ok){e.next=9;break}return e.abrupt("return",{modelArtifactsInfo:an(t),responses:[r]});case 9:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+r.status+".");case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"load",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s,u,c,l,h,f,d,p,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+t.status+". Please verify this URL points to the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 15:if(a=n.modelTopology,i=n.weightsManifest,o=n.generatedBy,s=n.convertedBy,u=n.format,c=n.userDefinedMetadata,null!=a||null!=i){e.next=18;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model topology or manifest for weights."));case 18:if(null==i){e.next=25;break}return e.next=21,this.loadWeights(i);case 21:f=e.sent,d=_slicedToArray2(f,2),l=d[0],h=d[1];case 25:return p={modelTopology:a,weightSpecs:l,weightData:h,userDefinedMetadata:c,generatedBy:o,convertedBy:s,format:u},m=n.modelInitializer,e.abrupt("return",(m&&(p.modelInitializer=m),p));case 27:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return n.apply(this,arguments)})},{key:"loadWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,u,c,l,h,f,d,p,m,v,g,y,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,k=void 0,w=void 0,k=(b=n).lastIndexOf("/"),w=b.lastIndexOf("?"),r=[b.substring(0,k)+"/",w>k?b.substring(w):""],a=_slicedToArray2(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=[],c=_createForOfIteratorHelper(t);try{for(c.s();!(l=c.n()).done;)h=l.value,u.push.apply(u,_toConsumableArray(h.weights))}catch(sI){c.e(sI)}finally{c.f()}f=[],d=[],p=_createForOfIteratorHelper(t);try{for(p.s();!(m=p.n()).done;){v=m.value,g=_createForOfIteratorHelper(v.paths);try{for(g.s();!(y=g.n()).done;)_=y.value,null!=this.weightUrlConverter?d.push(this.weightUrlConverter(_)):f.push(s+_+o)}catch(sI){g.e(sI)}finally{g.f()}}}catch(sI){p.e(sI)}finally{p.f()}if(e.t0=this.weightUrlConverter,!e.t0){e.next=16;break}return e.t1=f.push,e.t2=f,e.t3=_toConsumableArray,e.next=13,Promise.all(d);case 13:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 16:return e.t6=u,e.t7=nn,e.next=20,Zn(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 20:return e.t8=e.sent,e.t9=(0,e.t7)(e.t8),e.abrupt("return",[e.t6,e.t9]);case 23:case"end":return e.stop()}var b,k,w}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function rr(e){return null!=e.match(nr.URL_SCHEME_REGEX)}nr.URL_SCHEME_REGEX=/^https?:\/\//;var ar=function(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return rr(e)})):rr(e))?ir(e,t):null};function ir(e,t){return new nr(e,t)}function or(e,t){return ir(e,t)}sn.registerSaveRouter(ar),sn.registerLoadRouter(ar);var sr=function(){function e(t){_classCallCheck2(this,e),this.modelArtifacts=t}var t;return _createClass2(e,[{key:"load",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.modelArtifacts);case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),ur=function(){function e(t){_classCallCheck2(this,e),this.saveHandler=t}var t;return _createClass2(e,[{key:"save",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveHandler(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();function cr(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new sr(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new sr({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new sr({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function lr(e){return new ur(e)}var hr,fr=Gt({reshape_:function(e,t){var n=Ut(e,"x","reshape",null);return Mt.runKernelFunc((function(e,r){return t=he(t,n.size),J(n.size===ne(t),(function(){return"new shape and old shape must have the same number of elements."})),r([n]),e.reshape(n,t)}),{x:n},null,"Reshape",{shape:t})}}),dr=Gt({matMul_:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=Ut(e,"a","matMul"),o=Ut(t,"b","matMul");return n=_slicedToArray2(It(i,o),2),i=n[0],o=n[1],Mt.runKernelFunc((function(e,t){t([i,o]);var n=r?i.shape[i.rank-2]:i.shape[i.rank-1],s=a?o.shape[o.rank-1]:o.shape[o.rank-2],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],c=a?o.shape[o.rank-2]:o.shape[o.rank-1],l=i.shape.slice(0,-2),h=o.shape.slice(0,-2),f=ne(l),d=ne(h);J(i.rank>=2&&o.rank>=2&&(f===d||1===f||1===d),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(l,") and (").concat(h,").")})),J(n===s,(function(){return"Error in matMul: inner shapes (".concat(n,") and (").concat(s,") of Tensors with shapes ").concat(i.shape," and ").concat(o.shape," and transposeA=").concat(r," and transposeB=").concat(a," must match.")}));var p=(f>d?l:h).concat([u,c]),m=fr(i,r?[f,n,u]:[f,u,n]),v=fr(o,a?[d,c,s]:[d,s,c]),g=e.batchMatMul(m,v,r,a);return fr(g,p)}),{a:i,b:o},null,"BatchMatMul",{transposeA:r,transposeB:a})}}),pr=Gt({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var a=Ut(e,"indices","oneHot","int32"),i=[].concat(_toConsumableArray(a.shape),[t]);return Mt.runKernelFunc((function(e,o){return o([a]),fr(e.oneHot(fr(a,[a.size]),t,n,r),i)}),{indices:a},null,"OneHot",{depth:t,onValue:n,offValue:r})}}),mr=Gt({transpose_:function(e,t){var n=Ut(e,"x","transpose");return null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),J(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of perm ").concat(t,".")})),t.forEach((function(e){J(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1?n.clone():Mt.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},null,"Transpose",{perm:t})}}),vr=Gt({confusionMatrix_:function(e,t,n){var r=Ut(e,"labels","confusionMatrix"),a=Ut(t,"predictions","confusionMatrix");J(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),J(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),J(1===a.rank,(function(){return"Expected the rank of predictions to be 1, but got "+a.rank})),J(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: ".concat(r.shape[0]," vs. ").concat(a.shape[0],". Labels and predictions should have the same number of elements.")})),J(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var i=pr(Un(r,"int32"),n),o=pr(Un(a,"int32"),n),s=mr(i),u=dr(s,o);return Un(u,"int32")}});function gr(e,t,n){if(ee(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Vt(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Kt(e,t,r,n)}function yr(e,t){return _r.apply(this,arguments)}function _r(){return(_r=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f,d,p,m,v,g,y,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Ut(t,"img","toPixels"),t instanceof _t||(r=Un(a=r,"int32"),a.dispose()),2===r.rank||3===r.rank){e.next=4;break}throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));case 4:if(i=r.shape.slice(0,2),o=_slicedToArray2(i,2),s=o[0],u=o[1],!((c=2===r.rank?1:r.shape[2])>4||2===c)){e.next=7;break}throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+c);case 7:if("float32"===r.dtype||"int32"===r.dtype){e.next=9;break}throw new Error("Unsupported type for toPixels: ".concat(r.dtype,". Please use float32 or int32 tensors."));case 9:return e.next=11,r.data();case 11:l=e.sent,h="float32"===r.dtype?255:1,f=new Uint8ClampedArray(u*s*4),d=0;case 15:if(!(d<s*u)){e.next=36;break}p=[0,0,0,255],m=0;case 18:if(!(m<c)){e.next=31;break}if(v=l[d*c+m],"float32"!==r.dtype){e.next=25;break}if(!(v<0||v>1)){e.next=23;break}throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ".concat(v,"."));case 23:e.next=27;break;case 25:if("int32"!==r.dtype||!(v<0||v>255)){e.next=27;break}throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ".concat(v,"."));case 27:1===c?(p[0]=v*h,p[1]=v*h,p[2]=v*h):p[m]=v*h;case 28:m++,e.next=18;break;case 31:f[(g=4*d)+0]=Math.round(p[0]),f[g+1]=Math.round(p[1]),f[g+2]=Math.round(p[2]),f[g+3]=Math.round(p[3]);case 33:++d,e.next=15;break;case 36:return null!=n&&(n.width=u,n.height=s,y=n.getContext("2d"),_=new ImageData(f,u,s),y.putImageData(_,0,0)),e.abrupt("return",(r!==t&&r.dispose(),f));case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var br=Gt({fromPixels_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);o=!0}if(a){var s=2;if(a&&e.readyState<s)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}if(null!=Ye("FromPixels",Mt.backendName))return Mt.runKernel("FromPixels",{pixels:e},{numChannels:t});var u,c,l=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],h=_slicedToArray2(l,2),f=h[0],d=h[1];if(o?u=e.getContext("2d").getImageData(0,0,f,d).data:r||n?u=e.data:(i||a)&&(null==hr&&(hr=document.createElement("canvas").getContext("2d")),hr.canvas.width=f,hr.canvas.height=d,hr.drawImage(e,0,0,f,d),u=hr.getImageData(0,0,f,d).data),4===t)c=new Int32Array(u);else{var p=f*d;c=new Int32Array(p*t);for(var m=0;m<p;m++)for(var v=0;v<t;++v)c[m*t+v]=u[4*m+v]}return gr(c,[d,f,t],"int32")}});function kr(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[t.rank-1]," vs. ").concat(e.rank));if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var n=t.shape,r=n[n.length-1],a=1,i=0;i<n.length-1;++i)a*=n[i];var o=e.shape,s=n.slice();s.pop();for(var u=1,c=r;c<e.rank;++c)u*=o[c],s.push(o[c]);var l=[].concat(_toConsumableArray(Ee(e.shape).map((function(e){return e/u}))),[1]).slice(0,r);return[s,a,u,l]}function wr(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: ".concat(t.shape,", shape: ").concat(e)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < "+(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != "+(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function xr(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}wr(n,t,e)}function Cr(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:ne(t.shape)/u,sliceSize:o,strides:[].concat(_toConsumableArray(Ee(n.slice(0,a))),[1]),outputSize:ne(n)}}function Sr(e,t,n){var r=e.shape.length;J(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")})),J(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")}));for(var a=function(a){J(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] (").concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function Tr(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function Ar(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function Er(e,t,n,r){for(var a=_toConsumableArray(e),i=a.length;i<r.length;i++)a.push(1);for(var o=0;o<n;o++)0===o?a[t]=1:(a.splice(t,0,1),a.pop());return a}function Ir(e,t,n){return n<=e?n:n-(t-1)}function Rr(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function Or(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),h=new Array(c),f=new Array(c);if(t.length&&n>0){var d=t[0],p=n+1;l=Nr(o,d,p,r,e),h=Dr(s,d,p,a,e),f=Er(i,d,p,e)}else for(var m=0;m<c;m++)l[m]=Fr(o,r,i,e,m,u),h[m]=Mr(s,a,i,e,m,u),f[m]=Pr(i,m,u);return{begin:l,end:h,strides:f}}function Nr(e,t,n,r,a){for(var i=_toConsumableArray(a),o=Rr(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=Ir(t,n,s),c=r[u];e&1<<u&&(c=0),i[s]=c}return i}function Dr(e,t,n,r,a){for(var i=_toConsumableArray(a),o=Rr(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=Ir(t,n,s),c=r[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var h=a[l];i[l]<0&&(i[l]+=h),i[l]=K(0,i[l],a[l])}return i}function Pr(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function Fr(e,t,n,r,a,i){var o=t[a];(e&1<<a||i&1<<a||null==o)&&(o=(n[a]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[a];return o<0&&(o+=s),o=K(0,o,s-1)}function Mr(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?K(0,o,u):K(-1,o,u-1)}function Lr(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function zr(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Br(e,t,n){var r,a,i=e.shape.length;return(r="number"==typeof t?[t].concat(_toConsumableArray(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){J(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"==typeof n?[n].concat(_toConsumableArray(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(J(-1===t,(function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}var jr=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),Vr=function(){function e(){_classCallCheck2(this,e),this.classNameMap={}}return _createClass2(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function qr(e){J(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),J("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),J(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),Vr.register(e)}var Ur=.1;function Wr(e,t,n){return null==n&&(n=Gr()),Hr(e,t,(function(e,t){return Yr(e,t,n)}))}function Gr(){return 32===Mt.backend.floatPrecision()?.001:Ur}function Hr(e,t,n){var r=!0;if((_e(e)||_e(t))&&(r=!1),_e(e)&&_e(t)&&(r=!0),r){var a=e.constructor.name,i=t.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". Expected: ")+i)}if(Array.isArray(e)&&Array.isArray(t)){var o=Vt(e),s=Vt(t);if(!ae(o,s))throw new Error("Arrays have different shapes. Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=_e(e)?e:te(e),c=_e(t)?t:te(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs expected: ").concat(c.length,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."));for(var l=0;l<c.length;++l){var h=u[l],f=c[l];if(!n(h,f))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(h,", expected[").concat(l,"] = ").concat(f,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."))}}function Kr(e,t){e().then((function(){return t.fail()}),(function(){return t()}))}function Xr(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return we(e)||we(e[0])||we(t)||we(t[0])?Hr(e,n,(function(e,t){return e==t})):Hr(e,t,(function(e,t){return Yr(e,t,0)}))}function Qr(e,t,n){if(null==n&&(n=Gr()),!Yr(e,t,n))throw new Error("Numbers differ: actual === ".concat(e,", expected === ").concat(t))}function Yr(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function Zr(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:".concat(e[r]," low: ").concat(t,", high: ").concat(n))}function Jr(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}function $r(){ze().set("PROD",!0)}function ea(){ze().set("DEBUG",!0)}function ta(){ze().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function na(e){ze().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function ra(){Mt.disposeVariables()}function aa(){return Mt}function ia(){return Mt.memory()}function oa(e){return Mt.profile(e)}function sa(e,t){return Mt.tidy(e,t)}function ua(e){Nt(e).forEach((function(e){return e.dispose()}))}function ca(e){return Mt.keep(e)}function la(e){return Mt.time(e)}function ha(e){return Mt.setBackend(e)}function fa(){return Mt.ready()}function da(){return Mt.backendName}function pa(e){Mt.removeBackend(e)}function ma(e){return Mt.findBackend(e)}function va(e){return Mt.findBackendFactory(e)}function ga(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Mt.registerBackend(e,t,n)}function ya(){return Mt.backend}function _a(e,t){ze().setPlatform(e,t)}var ba=Gt({add_:function(e,t){var n,r=Ut(e,"a","add"),a=Ut(t,"b","add");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Mt.runKernelFunc((function(e,t){var n=e.add(r,a);return t([r,a]),n}),{a:r,b:a},null,"Add")}}),ka=Gt({floorDiv_:function(e,t){var n,r=Ut(e,"a","floorDiv"),a=Ut(t,"b","floorDiv");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Mt.runKernelFunc((function(e,t){var n=e.floorDiv(r,a);return t([r,a]),n}),{a:r,b:a},null,"FloorDiv")}}),wa=Gt({div_:function(e,t){var n,r=Ut(e,"a","div"),a=Ut(t,"b","div");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],"int32"===r.dtype&&"int32"===a.dtype?ka(r,a):Mt.runKernelFunc((function(e,t){var n=e.realDivide(r,a);return t([r,a]),n}),{a:r,b:a},null,We,{})}}),xa=Gt({mul_:function(e,t){var n,r=Ut(e,"a","mul"),a=Ut(t,"b","mul");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Mt.runKernelFunc((function(e,t){var n=e.multiply(r,a);return t([r,a]),n}),{a:r,b:a},null,"Multiply")}}),Ca=Gt({sqrt_:function(e){var t=Ut(e,"x","sqrt");return Mt.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{x:t},null,"Sqrt")}}),Sa=Gt({square_:function(e){var t=Ut(e,"x","square");return Mt.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},[t],[])}}),Ta=Gt({zerosLike_:function(e){var t=Ut(e,"x","zerosLike");return Mt.runKernelFunc((function(e){return e.zerosLike(t)}),{x:t},null,"ZerosLike")}});function Aa(e){return J(Te(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=Ut(t,"x","tf.grad",null),a=null!=n?Ut(n,"dy","tf.grad"):null;return Mt.tidy((function(){var t=Mt.gradients((function(){return e(r)}),[r],a),n=t.value,i=t.grads;return null!=a&&$(n.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Da(i),i[0]}))}}function Ea(e){return J(Te(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){J(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=Wt(t,"args","tf.grads",null),a=null!=n?Ut(n,"dy","tf.grads"):null;return Mt.tidy((function(){var t=Mt.gradients((function(){return e.apply(void 0,_toConsumableArray(r))}),r,a),n=t.value,i=t.grads;return null!=a&&$(n.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Da(i),i}))}}function Ia(e){return J(Te(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){J(t instanceof _t,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),J(null==n||n instanceof _t,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=Mt.gradients((function(){return e(t)}),[t],n),a=r.grads,i=r.value;return Da(a),{grad:a[0],value:i}}}function Ra(e){return J(Te(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){J(Array.isArray(t)&&t.every((function(e){return e instanceof _t})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),J(null==n||n instanceof _t,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=Mt.gradients((function(){return e.apply(void 0,_toConsumableArray(t))}),t,n);return null!=n&&$(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Da(r.grads),r}}function Oa(e,t){J(Te(e),(function(){return"The f passed in variableGrads(f) must be a function"})),J(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof St})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],Mt.registeredVariables)t.push(Mt.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;J((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the ".concat(i," variables is trainable.")}));var o=Mt.gradients(e,t,null,!0),s=o.value,u=o.grads;J(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),J(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function Na(e){return Mt.customGrad(e)}function Da(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}function Pa(e,t){if((_e(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&_e(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Kt(e,[],[],t)}var Fa=function(e){_inherits(o,e);var t,n,r,a,i=_createSuper(o);function o(){return _classCallCheck2(this,o),i.apply(this,arguments)}return _createClass2(o,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return ua(i),t?a:(a.dispose(),null)}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return Oa(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&ua(this.iterations_)}},{key:"saveIterations",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Pa(this.iterations_,"int32")}));case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getWeights",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"setWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName());case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"extractIterations",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}}]),o}(jr);Object.defineProperty(Fa,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Ma=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return _classCallCheck2(this,a),(n=r.call(this)).learningRate=e,n.rho=t,n.epsilon=i,n.accumulatedGrads=[],n.accumulatedUpdates=[],null==i&&(n.epsilon=Mt.backend.epsilon()),n}return _createClass2(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Mt.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:sa((function(){return Ta(a).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:sa((function(){return Ta(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;sa((function(){var e=ba(xa(o,t.rho),xa(Sa(i),1-t.rho)),n=xa(wa(Ca(ba(s,t.epsilon)),Ca(ba(o,t.epsilon))),i),r=ba(xa(s,t.rho),xa(Sa(n),1-t.rho));o.assign(e),s.assign(r);var u=ba(xa(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(ua(this.accumulatedGrads.map((function(e){return e.variable}))),ua(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(_toConsumableArray(this.accumulatedGrads),_toConsumableArray(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:e.t0=(t=e.sent).length,n=e.t0/2,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),a}(Fa);function La(e,t,n){return Mt.runKernelFunc((function(r){return r.fill(e,t,n)}),{},null,"Fill",{shape:e,value:t,dtype:n})}Ma.className="Adadelta",qr(Ma);var za=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return _classCallCheck2(this,a),(t=r.call(this)).learningRate=e,t.initialAccumulatorValue=n,t.accumulatedGrads=[],t}return _createClass2(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Mt.registeredVariables[n];if(null==t.accumulatedGrads[r]){t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:sa((function(){return La(a.shape,t.initialAccumulatorValue).variable(!1)}))}}var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;sa((function(){var e=ba(o,Sa(i));o.assign(e);var n=ba(xa(wa(i,Ca(ba(e,Mt.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&ua(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),a}(Fa);za.className="Adagrad",qr(za);var Ba=Gt({pow_:function(e,t){var n,r=Ut(e,"base","pow"),a=Ut(t,"exp","pow");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Mt.runKernelFunc((function(e,t){var n=e.pow(r,a);return t([r,a,n]),n}),{a:r,b:a},null,"Pow")}}),ja=Gt({sub_:function(e,t){var n,r=Ut(e,"a","sub"),a=Ut(t,"b","sub");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Mt.runKernelFunc((function(e,t){var n=e.subtract(r,a);return t([r,a]),n}),{a:r,b:a},null,He)}}),Va=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t,n){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return _classCallCheck2(this,a),(i=r.call(this)).learningRate=e,i.beta1=t,i.beta2=n,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],sa((function(){i.accBeta1=Pa(t).variable(),i.accBeta2=Pa(n).variable()})),null==o&&(i.epsilon=Mt.backend.epsilon()),i}return _createClass2(a,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);sa((function(){var r=ja(1,t.accBeta1),a=ja(1,t.accBeta2);n.forEach((function(n,i){var o=Mt.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:sa((function(){return Ta(o).variable(!1)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:n+"/v",variable:sa((function(){return Ta(o).variable(!1)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=ba(xa(u,t.beta1),xa(s,1-t.beta1)),h=ba(xa(c,t.beta2),xa(Sa(s),1-t.beta2)),f=wa(l,r),d=wa(h,a);u.assign(l),c.assign(h);var p=ba(xa(wa(f,ba(Ca(d),t.epsilon)),-t.learningRate),o);o.assign(p)}})),t.accBeta1.assign(xa(t.accBeta1,t.beta1)),t.accBeta2.assign(xa(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&ua(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&ua(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(_toConsumableArray(this.accumulatedFirstMoment),_toConsumableArray(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,sa((function(){r.accBeta1.assign(Ba(r.beta1,r.iterations_+1)),r.accBeta2.assign(Ba(r.beta2,r.iterations_+1))})),n=t.length/2,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),a}(Fa);Va.className="Adam",qr(Va);var qa=Gt({abs_:function(e){var t=Ut(e,"x","abs");return Mt.runKernelFunc((function(e,n){return n([t]),"complex64"===t.dtype?e.complexAbs(t):e.abs(t)}),{x:t},null,"Abs")}});function Ua(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function Wa(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function Ga(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o)throw Error("Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,"."));n.unshift(i)}}return n}var Ha=Gt({maximum_:function(e,t){var n,r=Ut(e,"a","maximum"),a=Ut(t,"b","maximum");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],"bool"===r.dtype&&(r=Un(r,"int32"),a=Un(a,"int32")),Ga(r.shape,a.shape),Mt.runKernelFunc((function(e,t){var n=e.maximum(r,a);return t([r,a]),n}),{a:r,b:a},null,"Maximum")}}),Ka=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t,n){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return _classCallCheck2(this,a),(i=r.call(this)).learningRate=e,i.beta1=t,i.beta2=n,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],sa((function(){i.iteration=Pa(0).variable(),i.accBeta1=Pa(t).variable()})),null==o&&(i.epsilon=Mt.backend.epsilon()),i}return _createClass2(a,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);sa((function(){var r=ja(1,t.accBeta1),a=wa(-t.learningRate,ba(xa(t.iteration,t.decay),1));n.forEach((function(n,i){var o=Mt.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:n+"/m",variable:Ta(o).variable(!1)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:n+"/v",variable:Ta(o).variable(!1)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=ba(xa(u,t.beta1),xa(s,1-t.beta1)),h=xa(c,t.beta2),f=qa(s),d=Ha(h,f);u.assign(l),c.assign(d);var p=ba(xa(wa(a,r),wa(l,ba(d,t.epsilon))),o);o.assign(p)}})),t.iteration.assign(ba(t.iteration,1)),t.accBeta1.assign(xa(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&ua(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&ua(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),a}(Fa);Ka.className="Adamax",qr(Ka);var Xa=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t;return _classCallCheck2(this,a),(t=r.call(this)).learningRate=e,t.setLearningRate(e),t}return _createClass2(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=Mt.registeredVariables[n];sa((function(){var e=ba(xa(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=ca(Pa(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(e.t0=(t=e.sent).length,0===e.t0){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),a}(Fa);Xa.className="SGD",qr(Xa);var Qa=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return _classCallCheck2(this,a),(n=r.call(this,e)).learningRate=e,n.momentum=t,n.useNesterov=i,n.accumulations=[],n.m=Pa(n.momentum),n}return _createClass2(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Mt.registeredVariables[n];if(null==t.accumulations[r]){t.accumulations[r]={originalName:n+"/momentum",variable:sa((function(){return Ta(a).variable(!1)}))}}var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&sa((function(){var e,n=ba(xa(t.m,i),o);e=ba(xa(t.c,t.useNesterov?ba(o,xa(n,t.m)):n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&ua(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),a}(Xa);Qa.className="Momentum",qr(Qa);var Ya=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck2(this,a),(t=r.call(this)).learningRate=e,t.decay=n,t.momentum=i,t.epsilon=o,t.accumulatedMeanSquares=[],t.accumulatedMoments=[],t.accumulatedMeanGrads=[],t.centered=s,null==o&&(t.epsilon=Mt.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return _possibleConstructorReturn(t)}return _createClass2(a,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Mt.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:sa((function(){return Ta(a).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:sa((function(){return Ta(a).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:sa((function(){return Ta(a).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;sa((function(){var e=ba(xa(o,t.decay),xa(Sa(i),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=ba(xa(n,t.decay),xa(i,1-t.decay)),c=wa(xa(i,t.learningRate),Ca(ja(e,ba(Sa(u),t.epsilon)))),l=ba(xa(s,t.momentum),c);o.assign(e),n.assign(u),s.assign(l);var h=ja(a,l);a.assign(h)}else{var f=ba(xa(o,t.decay),xa(Sa(i),1-t.decay)),d=ba(xa(s,t.momentum),wa(xa(i,t.learningRate),Ca(ba(f,t.epsilon))));o.assign(f),s.assign(d);var p=ja(a,d);a.assign(p)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&ua(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&ua(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&ua(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(_toConsumableArray(this.accumulatedMeanSquares),_toConsumableArray(this.accumulatedMoments)),this.centered&&t.push.apply(t,_toConsumableArray(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"setWeights",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),a}(Fa);Ya.className="RMSProp",qr(Ya);var Za=Gt({acos_:function(e){var t=Ut(e,"x","acos");return Mt.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{x:t},null,"Acos")}}),Ja=Gt({acosh_:function(e){var t=Ut(e,"x","acosh");return Mt.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{x:t},null,"Acosh")}}),$a=Gt({addN_:function(e){J(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),J(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return Ut(e,"tensors"+t,"addN")})),n=t[0];return t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!ae(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")})),Mt.runKernelFunc((function(e,n){var r=e.addN(t);return n(t),r}),t,null,"AddN")}});function ei(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function ti(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function ni(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((function(t){return e[t]}))]}function ri(e,t){return ti(e,t.map((function(e){return 1})),t)}function ai(e,t,n){J(ei(t,n),(function(){return e+" supports only inner-most axes for now. "+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function ii(e,t){if(ei(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function oi(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function si(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var ui=Gt({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ut(e,"x","all","bool");return Mt.runKernelFunc((function(e){var a=fe(t,r.shape),i=a,o=ii(i,r.rank);null!=o&&(r=mr(r,o),i=si(i.length,r.rank));var s=e.all(r,i);if(n){var u=ri(s.shape,a);return fr(s,u)}return s}),{x:r},null,"All",{axis:t,keepDims:n})}}),ci=Gt({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ut(e,"x","any","bool");return Mt.runKernelFunc((function(e){var a=fe(t,r.shape),i=a,o=ii(i,r.rank);null!=o&&(r=mr(r,o),i=si(i.length,r.rank));var s=e.any(r,i);if(n){var u=ri(s.shape,a);return fr(s,u)}return s}),{x:r},null,"Any",{axis:t,keepDims:n})}}),li=Gt({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ut(e,"x","argMax");return Mt.runKernelFunc((function(e,r){r([n]);var a=fe(t,n.shape),i=ii(a,n.rank);return null!=i&&(n=mr(n,i),a=si(a.length,n.rank)),e.argMax(n,a[0])}),{x:n},null,"ArgMax",{axis:t})}}),hi=Gt({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ut(e,"x","argMin");return Mt.runKernelFunc((function(e,r){r([n]),null==t&&(t=0);var a=fe(t,n.shape),i=ii(a,n.rank);return null!=i&&(n=mr(n,i),a=si(a.length,n.rank)),e.argMin(n,a[0])}),{x:n},null,"ArgMin",{axis:t})}}),fi=Gt({asin_:function(e){var t=Ut(e,"x","asin");return Mt.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{x:t},null,"Asin")}}),di=Gt({asinh_:function(e){var t=Ut(e,"x","asinh");return Mt.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{x:t},null,"Asinh")}}),pi=Gt({atan_:function(e){var t=Ut(e,"x","atan");return Mt.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{x:t},null,"Atan")}}),mi=Gt({atan2_:function(e,t){var n,r=Ut(e,"a","atan2"),a=Ut(t,"b","atan2");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Mt.runKernelFunc((function(e,t){var n=e.atan2(r,a);return t([r,a]),n}),{a:r,b:a},null,"Atan2")}}),vi=Gt({atanh_:function(e){var t=Ut(e,"x","atanh");return Mt.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{x:t},null,"Atanh")}});function gi(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0;return bi(e,[].concat(_toConsumableArray(t),[e[3]]),n,i,r,null,null,Ii(a))}function yi(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=xi(t),c=_slicedToArray2(u,2),l=c[0],h=c[1];if("channelsLast"===s)o=[l,h,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);o=[l,h,e[1],e[1]]}return bi(e,o,n,r,a,i,!1,s)}function _i(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=Ci(t),l=_slicedToArray2(c,3),h=l[0],f=l[1],d=l[2];if("NDHWC"===u)s="channelsLast",o=[h,f,d,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat "+u);s="channelsFirst",o=[h,f,d,e[1],e[1]]}return ki(e,o,n,r,a,!1,s,i)}function bi(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,h=-1;if("channelsLast"===s){var f=_slicedToArray2(e,4);u=f[0],c=f[1],l=f[2],h=f[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);var d=_slicedToArray2(e,4);u=d[0],h=d[1],c=d[2],l=d[3]}var p,m=_slicedToArray2(t,4),v=m[0],g=m[1],y=m[3],_=xi(n),b=_slicedToArray2(_,2),k=b[0],w=b[1],x=xi(r),C=_slicedToArray2(x,2),S=C[0],T=C[1],A=Si(v,S),E=Si(g,T),I=function(e,t,n,r,a,i,o,s,u){var c,l,h;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,a){null==r&&(r=wi(e,t,n));var i=e[1],o=Ti((e[0]-t+2*r)/n+1,a);J(ie(o),(function(){return"The output # of rows (".concat(o,") must be an integer. Change the stride and/or zero pad parameters")}));var s=Ti((i-t+2*r)/n+1,a);return J(ie(s),(function(){return"The output # of columns (".concat(s,") must be an integer. Change the stride and/or zero pad parameters")})),[o,s]}([t,n],i,r,e,s);l=f[0],h=f[1]}else if("same"===e){l=Math.ceil(t/r),h=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),p=Math.max(0,(h-1)*a+o-n),m=Math.floor(d/2),v=d-m,g=Math.floor(p/2);c={top:m,bottom:v,left:g,right:p-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),h=Math.ceil((n-o+1)/a);else{if("object"!=typeof e)throw Error("Unknown padding parameter: "+e);var y="channelsLast"===u?e[1][0]:e[2][0],_="channelsLast"===u?e[1][1]:e[2][1],b="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:_,left:b,right:k,type:0===y&&0===_&&0===b&&0===k?"VALID":"EXPLICIT"},l=Ti((t-i+y+_)/r+1,s),h=Ti((n-o+b+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:h}}(a,c,l,k,w,A,E,i,s),R=I.padInfo,O=I.outHeight,N=I.outWidth,D=o?y*h:y;return"channelsFirst"===s?p=[u,D,O,N]:"channelsLast"===s&&(p=[u,O,N,D]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:h,outHeight:O,outWidth:N,outChannels:D,padInfo:R,strideHeight:k,strideWidth:w,filterHeight:v,filterWidth:g,effectiveFilterHeight:A,effectiveFilterWidth:E,dilationHeight:S,dilationWidth:T,inShape:e,outShape:p,filterShape:t}}function ki(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,h=-1,f=-1;if("channelsLast"===o){var d=_slicedToArray2(e,5);u=d[0],c=d[1],l=d[2],h=d[3],f=d[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat "+o);var p=_slicedToArray2(e,5);u=p[0],f=p[1],c=p[2],l=p[3],h=p[4]}var m,v=_slicedToArray2(t,5),g=v[0],y=v[1],_=v[2],b=v[4],k=Ci(n),w=_slicedToArray2(k,3),x=w[0],C=w[1],S=w[2],T=Ci(r),A=_slicedToArray2(T,3),E=A[0],I=A[1],R=A[2],O=Si(g,E),N=Si(y,I),D=Si(_,R),P=function(e,t,n,r,a,i,o,s,u,c,l){var h,f,d,p;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=wi(e,t,r));var o=e[1],s=e[2],u=Ti((e[0]-t+2*a)/r+1,i);J(ie(u),(function(){return"The output # of depths (".concat(u,") must be an integer. Change the stride and/or zero pad parameters")}));var c=Ti((o-t+2*a)/r+1,i);J(ie(c),(function(){return"The output # of rows (".concat(c,") must be an integer. Change the stride and/or zero pad parameters")}));var l=Ti((s-t+2*a)/r+1,i);return J(ie(l),(function(){return"The output # of columns (".concat(l,") must be an integer. Change the stride and/or zero pad parameters")})),[u,c,l,1]}([t,n,r,1],s,0,a,e,l);f=m[0],d=m[1],p=m[2]}else if("same"===e){var v=((f=Math.ceil(t/a))-1)*a+s-t,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((p=Math.ceil(r/o))-1)*o+c-r,_=Math.floor(v/2),b=v-_,k=Math.floor(g/2),w=g-k,x=Math.floor(y/2);h={top:k,bottom:w,left:x,right:y-x,front:_,back:b,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/a),d=Math.ceil((n-u+1)/i),p=Math.ceil((r-c+1)/o)}return{padInfo:h,outDepth:f,outHeight:d,outWidth:p}}(a,c,l,h,x,C,S,O,N,D,s),F=P.padInfo,M=P.outDepth,L=P.outHeight,z=P.outWidth,B=i?b*f:b;return"channelsFirst"===o?m=[u,B,M,L,z]:"channelsLast"===o&&(m=[u,M,L,z,B]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:h,inChannels:f,outDepth:M,outHeight:L,outWidth:z,outChannels:B,padInfo:F,strideDepth:x,strideHeight:C,strideWidth:S,filterDepth:g,filterHeight:y,filterWidth:_,effectiveFilterDepth:O,effectiveFilterHeight:N,effectiveFilterWidth:D,dilationDepth:E,dilationHeight:I,dilationWidth:R,inShape:e,outShape:m,filterShape:t}}function wi(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=Si(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function xi(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Ci(e){return"number"==typeof e?[e,e,e]:e}function Si(e,t){return t<=1?e:e+(e-1)*(t-1)}function Ti(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function Ai(e){var t=_slicedToArray2(xi(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function Ei(e,t){return Ai(e)||Ai(t)}function Ii(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}var Ri=Gt({avgPool_:function(e,t,n,r,a){var i=Ut(e,"x","avgPool","float32");J(Ei(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '1'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=fr(i,[1,i.shape[0],i.shape[1],i.shape[2]])),J(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),null!=a&&J(ie(r),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var u=Mt.runKernelFunc((function(e,i){var s=yi(o.shape,t,n,1,r,a);return i([o]),1===s.filterWidth&&1===s.filterHeight&&ae(s.inShape,s.outShape)?o.clone():e.avgPool(o,s)}),{x:o},null,"AvgPool",{filterSize:t,strides:n,pad:r,dimRoundingMode:a});return u=Un(u,i.dtype),s?fr(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),Oi=Gt({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=arguments.length>6?arguments[6]:void 0;null==o?o=[1,1,1]:na("dilations is deprecated, this field will be gone in v3.0.0.");var s=Ut(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=fr(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),J(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(u.rank,".")})),J("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),J(Ei(n,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(o,"'")})),null!=a&&J(ie(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var l=Mt.runKernelFunc((function(e,s){null==o&&(o=[1,1,1]);var c=_i(u.shape,t,n,o,r,a,i);return s([u]),e.avgPool3d(u,c)}),{x:u},null,"AvgPool3D",{filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i,dilations:o});return l=Un(l,u.dtype),c?fr(l,[l.shape[1],l.shape[2],l.shape[3],l.shape[4]]):l}});function Ni(e,t){var n=e[0].length;e.forEach((function(e,t){J(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")}))})),J(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)J(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")}))}))}function Di(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}var Pi=Gt({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;J(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Wt(e,"tensors","concat");return"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),Mt.runKernelFunc((function(e,r){var a=fe(t,n[0].shape)[0],i=Di(n.map((function(e){return e.shape})),a);if(0===ne(i))return Xt([],i);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];Ni(n.map((function(e){return e.shape})),a);var o=e.concat(n,a);return r(n),o}),n,null,"Concat",{axis:t})}}),Fi=Gt({sigmoid_:function(e){var t=Ut(e,"x","sigmoid");return Mt.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},null,"Sigmoid")}}),Mi=Gt({slice_:function(e,t,n){var r=Ut(e,"x","slice");if(0===r.rank)throw new Error("Slicing scalar is not possible");return Mt.runKernelFunc((function(e,a){var i=_slicedToArray2(Br(r,t,n),2),o=i[0],s=i[1];return Sr(r,o,s),a([r]),e.slice(r,o,s)}),{x:r},null,"Slice",{begin:t,size:n})}}),Li=Gt({tanh_:function(e){var t=Ut(e,"x","tanh");return Mt.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},null,"Tanh")}}),zi=Gt({basicLSTMCell_:function(e,t,n,r,a,i){var o=Ut(e,"forgetBias","basicLSTMCell"),s=Ut(t,"lstmKernel","basicLSTMCell"),u=Ut(n,"lstmBias","basicLSTMCell"),c=Ut(r,"data","basicLSTMCell"),l=Ut(a,"c","basicLSTMCell"),h=Ut(i,"h","basicLSTMCell"),f=Pi([c,h],1),d=dr(f,s),p=ba(d,u),m=p.shape[1]/4,v=[p.shape[0],m],g=Mi(p,[0,0],v),y=Mi(p,[0,m],v),_=Mi(p,[0,2*m],v),b=Mi(p,[0,3*m],v),k=ba(xa(Fi(g),Li(y)),xa(l,Fi(ba(o,_))));return[k,xa(Li(k),Fi(b))]}}),Bi=Gt({batchToSpaceND_:function(e,t,n){var r=Ut(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));return J(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),J(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),J(r.shape[0]%a==0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of the elements of blockShape ").concat(t.join(" * ")," === ").concat(a)})),Mt.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{x:r},null,"BatchToSpaceND",{blockShape:t,crops:n})}});function ji(e){return null==e?null:0===e.rank?fr(e,[e.size]):1===e.rank?e:2===e.rank?fr(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?fr(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}var Vi=Gt({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=Ut(e,"x","batchNorm"),c=Ut(t,"mean","batchNorm"),l=Ut(n,"variance","batchNorm");null!=a&&(o=Ut(a,"scale","batchNorm")),null!=r&&(s=Ut(r,"offset","batchNorm")),J(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),J(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),J(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var h=function(e){return 0===e.rank||1===e.rank?fr(e,[1,1,1,e.size]):2===e.rank?fr(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?fr(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(u),f=Mt.runKernelFunc((function(e,t){return t([h,c,l,o]),e.batchNorm(h,ji(c),ji(l),ji(s),ji(o),i)}),{x:h,scale:o,offset:s,mean:c,variance:l},null,"FusedBatchNorm",{varianceEpsilon:i});return fr(f,u.shape)}}),qi=Gt({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=Ut(e,"x","batchNorm"),c=Ut(t,"mean","batchNorm"),l=Ut(n,"variance","batchNorm");return null!=a&&(o=Ut(a,"scale","batchNorm")),null!=r&&(s=Ut(r,"offset","batchNorm")),J(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+u.rank+"."})),J(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ".concat(c.rank,".")})),J(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&J(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&J(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ".concat(s.rank,".")})),Vi(u,c,l,s,o,i)}}),Ui=Gt({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=Ut(e,"x","batchNorm"),c=Ut(t,"mean","batchNorm"),l=Ut(n,"variance","batchNorm");return null!=a&&(o=Ut(a,"scale","batchNorm")),null!=r&&(s=Ut(r,"offset","batchNorm")),J(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),J(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ".concat(c.rank,".")})),J(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&J(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&J(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ".concat(s.rank,".")})),Vi(u,c,l,s,o,i)}}),Wi=Gt({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=Ut(e,"x","batchNorm"),c=Ut(t,"mean","batchNorm"),l=Ut(n,"variance","batchNorm");return null!=a&&(o=Ut(a,"scale","batchNorm")),null!=r&&(s=Ut(r,"offset","batchNorm")),J(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),J(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ".concat(c.rank,".")})),J(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&J(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&J(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ".concat(s.rank,".")})),Vi(u,c,l,s,o,i)}}),Gi=Gt({broadcastTo_:function(e,t){var n=Ut(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=fr(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));return 0===o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length?Wn(n):Mt.runKernelFunc((function(e){return e.tile(n,o)}),{x:n},null,"BroadcastTo",{shape:t,inputShape:i})}}),Hi=Gt({ceil_:function(e){var t=Ut(e,"x","ceil");return Mt.runKernelFunc((function(e){return e.ceil(t)}),{x:t},null,"Ceil")}}),Ki=Gt({clipByValue_:function(e,t,n){var r=Ut(e,"x","clipByValue");return J(t<=n,(function(){return"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,").")})),Mt.runKernelFunc((function(e,a){var i=e.clip(r,t,n);return a([r]),i}),{x:r},null,"ClipByValue",{clipValueMin:t,clipValueMax:n})}}),Xi=Gt({concat1d_:function(e){return Pi(e,0)}}),Qi=Gt({concat2d_:function(e,t){return Pi(e,t)}}),Yi=Gt({concat3d_:function(e,t){return Pi(e,t)}}),Zi=Gt({concat4d_:function(e,t){return Pi(e,t)}}),Ji=Gt({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Ut(e,"x","conv2d"),u=Ut(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=fr(s,[1,s.shape[0],s.shape[1],s.shape[2]])),J(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),J(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),null!=o&&J(ie(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var h="NHWC"===a?c.shape[3]:c.shape[1];J(h===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(h,") must match input depth for filter ").concat(u.shape[2],".")})),J(Ei(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")}));var f=Mt.runKernelFunc((function(e,t){var s=Ii(a),l=bi(c.shape,u.shape,n,i,r,o,!1,s),h=e.conv2d(c,u,l);return t([c,u]),h}),{x:c,filter:u},null,"Conv2D",{strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o});return l?fr(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),$i=Gt({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=Ut(e,"x","conv1d"),u=Ut(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=fr(s,[1,s.shape[0],s.shape[1]])),J(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),J(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=o&&J(ie(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(r,".")})),J(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match input depth for filter ").concat(u.shape[1],".")})),J(Ei(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride ".concat(n," and dilation '").concat(i,"'")})),J("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var h=fr(u,[1,u.shape[0],u.shape[1],u.shape[2]]),f=fr(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=Ji(f,h,[1,n],r,"NHWC",[1,i],o);return fr(d,l?[d.shape[2],d.shape[3]]:[d.shape[0],d.shape[2],d.shape[3]])}}),eo=Gt({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;J(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=fr(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),J(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),J(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),J(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===i?s[3]:s[1],h="NHWC"===i?u.shape[3]:u.shape[1];J(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must match input depth for filter ").concat(n.shape[2],".")})),J(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(h,") must match output depth for filter ").concat(n.shape[3],".")})),null!=o&&J(ie(a),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(a,".")}));var f=Mt.runKernelFunc((function(e,t){var c=Ii(i),l=bi(s,n.shape,r,1,a,o,!1,c),h=e.conv2dDerInput(u,n,l);return t([u,n]),h}),{dy:u,filter:n},null,"Conv2DBackpropInput",{strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s});return c?fr(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),to=Gt({conv2dTranspose_:function(e,t,n,r,a,i){var o=Ut(e,"x","conv2dTranspose"),s=Ut(t,"filter","conv2dTranspose");return eo(n,o,s,r,a,"NHWC",i)}}),no=Gt({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=Ut(e,"x","conv3d"),s=Ut(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=fr(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),J(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),J(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),J(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match input depth for filter ").concat(s.shape[3],".")})),J(Ei(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")})),J("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}));var l=Mt.runKernelFunc((function(e,t){var a=ki(u.shape,s.shape,n,i,r),o=e.conv3d(u,s,a);return t([u,s]),o}),{x:u,filter:s},null,"Conv3D",{strides:n,pad:r,dataFormat:a,dilations:i});return c?fr(l,[l.shape[1],l.shape[2],l.shape[3],l.shape[4]]):l}}),ro=Gt({conv3DBackpropInput_:function(e,t,n,r,a){J(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=fr(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];J(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."})),J(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+o.rank})),J(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),J(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must match input depth for filter ").concat(n.shape[3],".")})),J(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must match output depth for filter ").concat(n.shape[4],".")}));var l=Mt.runKernelFunc((function(e){var t=ki(i,n.shape,r,1,a);return e.conv3dDerInput(o,n,t)}),{dy:o,filter:n},null,"Conv3DBackpropInputV2",{pad:a,strides:r,inputShape:i});return s?fr(l,[l.shape[1],l.shape[2],l.shape[3],l.shape[4]]):l}}),ao=Gt({conv3dTranspose_:function(e,t,n,r,a){var i=Ut(e,"x","conv3dTranspose"),o=Ut(t,"filter","conv3dTranspose");return ro(n,i,o,r,a)}}),io=Gt({cos_:function(e){var t=Ut(e,"x","cos");return Mt.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},null,Ue)}}),oo=Gt({cosh_:function(e){var t=Ut(e,"x","cosh");return Mt.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{x:t},null,"Cosh")}}),so=Gt({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Ut(e,"x","cumsum");return Mt.runKernelFunc((function(e,i){var o=ii([t],a.rank),s=a;null!=o&&(s=mr(a,o));var u=si(1,a.rank)[0],c=e.cumsum(s,u,n,r);if(i([a]),null!=o){var l=oi(o);c=mr(c,l)}return c}),{x:a},null,"Cumsum",{axis:t,exclusive:n,reverse:r})}}),uo=Gt({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=Ut(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];return J(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),J(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),J(o%(t*t)==0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)})),Mt.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{x:r},null,"DepthToSpace",{blockSize:t,dataFormat:n})}}),co=Gt({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Ut(e,"x","depthwiseConv2d"),u=Ut(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=fr(s,[1,s.shape[0],s.shape[1],s.shape[2]])),J(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),J(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),J(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels (".concat(c.shape[3],") must match the inChannels dimension in filter ").concat(u.shape[2],".")})),null!=o&&J(ie(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var h=Mt.runKernelFunc((function(e,t){null==i&&(i=[1,1]),J(Ei(n,i),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")}));var a=bi(c.shape,u.shape,n,i,r,o,!0),s=e.depthwiseConv2D(c,u,a);return t([c,u]),s}),{x:c,filter:u},null,"DepthwiseConv2dNative",{strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o});return l?fr(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),lo=Gt({diag_:function(e){var t=Ut(e,"x","diag");return Mt.runKernelFunc((function(n){var r=fr(t,[t.size]),a=n.diag(r),i=[].concat(_toConsumableArray(e.shape),_toConsumableArray(e.shape));return fr(a,i)}),{x:t},null,"Diag")}}),ho=Gt({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=Ut(e,"x","dilation2d"),s=Ut(t,"filter","dilation2d");J(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+o.rank+"."})),J(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+s.rank+"."})),J("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of "+i}));var u=o,c=!1;3===o.rank&&(u=fr(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);var l=Mt.runKernel("Dilation2D",{x:u,filter:s},{strides:n,pad:r,dilations:a});return c?fr(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),fo=Gt({equal_:function(e,t){var n,r=Ut(e,"a","equal"),a=Ut(t,"b","equal");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Ga(r.shape,a.shape),Mt.runKernelFunc((function(e){return e.equal(r,a)}),{a:r,b:a},null,"Equal")}}),po=Gt({where_:function(e,t,n){var r=Ut(t,"a","where"),a=Ut(n,"b","where"),i=Ut(e,"condition","where","bool"),o=Ga(r.shape,a.shape),s=Gi(r,o),u=Gi(a,o);return 1===i.rank&&J(i.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})),1!==i.rank&&$(i.shape,u.shape,"Error in where: "),Mt.runKernelFunc((function(e,t){var n=e.select(i,s,u);return t([i]),n}),{condition:i,t:s,e:u},null,"SelectV2")}}),mo=Gt({divNoNan_:function(e,t){var n=Ut(e,"a","div"),r=Ut(t,"b","div"),a=_slicedToArray2(It(n,r),2);n=a[0],r=a[1];var i=wa(n,r),o=Ta(i),s=fo(r,o);return po(s,o,i)}}),vo=Gt({dot_:function(e,t){var n=Ut(e,"t1","dot"),r=Ut(t,"t2","dot");J(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(J(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got ".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=fr(n,[1,-1]),s=fr(r,[-1,1]),u=dr(o,s);return fr(u,[])}if(1===n.rank&&2===r.rank){var c=fr(n,[1,-1]),l=fr(r,[r.shape[0],r.shape[1]]),h=dr(c,l);return fr(h,[h.size])}if(2===n.rank&&1===r.rank){var f=fr(r,[-1,1]),d=dr(n,f);return fr(d,[d.size])}var p=fr(r,[r.shape[0],r.shape[1]]);return dr(n,p)}}),go=Gt({elu_:function(e){var t=Ut(e,"x","elu");return Mt.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{x:t},null,"Elu")}}),yo=Gt({erf_:function(e){var t=Ut(e,"x","erf");return J("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=Un(t,"float32")),Mt.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{x:t},null,"Erf")}}),_o=Gt({exp_:function(e){var t=Ut(e,"x","exp");return Mt.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},null,"Exp")}}),bo=Gt({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ut(e,"x","expandDims",null);J(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(J(-(n.rank+1)<=t,(function(){return"Axis must be in the interval [".concat(-(n.rank+1),", ").concat(n.rank,"]")})),t=n.rank+t+1),r.splice(t,0,1),fr(n,r)}}),ko=Gt({expm1_:function(e){var t=Ut(e,"x","expm1");return Mt.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{x:t},null,"Expm1")}}),wo=Gt({tile_:function(e,t){var n=Ut(e,"x","tile",null);return J(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")})),Mt.runKernelFunc((function(e,r){var a=e.tile(n,t);return r([n]),a}),{x:n},null,"Tile",{reps:t},[n])}}),xo=Gt({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=qn([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=fr(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return wo(bo(s,0),[n[0],1,1]);if(2===n.length)return wo(bo(bo(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return wo(bo(bo(bo(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received ".concat(n.length,"D."))}}),Co=Gt({floor_:function(e){var t=Ut(e,"x","floor");return Mt.runKernelFunc((function(e){return e.floor(t)}),{x:t},null,"Floor")}}),So=30;function To(e){return e<=So?e:Ae(e,Math.floor(Math.sqrt(e)))}function Ao(e,t){var n,r=!1;for(e<=So?(n=e,r=!0):n=Ae(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Ae(e,n+1);return n}function Eo(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)r.push(i!==t?e[i]:n);return r}function Io(e,t,n){for(var r=e.shape[n],a=[],i=1,o=1,s=0;s<n;s++)a.push(e.shape[s]),i*=e.shape[s];for(var u=0;u<t.rank;u++)a.push(t.shape[u]);for(var c=n+1;c<e.rank;c++)a.push(e.shape[c]),o*=e.shape[c];return{batchSize:i,sliceSize:o,dimSize:r,outputShape:a}}var Ro=Gt({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Ut(e,"x","gather"),a=Ut(t,"indices","gather","int32");return Mt.runKernelFunc((function(e,t){var i=fe(n,r.shape)[0],o=Io(r,a,i),s=e.gather(r,fr(a,[a.size]),i);return t([r,a]),fr(s,o.outputShape)}),{x:r,indices:a},null,"GatherV2",{axis:n})}}),Oo=Gt({greater_:function(e,t){var n,r=Ut(e,"a","greater"),a=Ut(t,"b","greater");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Ga(r.shape,a.shape),Mt.runKernelFunc((function(e){return e.greater(r,a)}),{a:r,b:a},null,"Greater")}}),No=Gt({greaterEqual_:function(e,t){var n,r=Ut(e,"a","greaterEqual"),a=Ut(t,"b","greaterEqual");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Ga(r.shape,a.shape),Mt.runKernelFunc((function(e,t){var n=e.greaterEqual(r,a);return t([r,a]),n}),{a:r,b:a},null,"GreaterEqual")}}),Do=Gt({imag_:function(e){var t=Ut(e,"input","imag");return Mt.runKernelFunc((function(e){return e.imag(t)}),{input:t},null,"Imag")}}),Po=Gt({isFinite_:function(e){var t=Ut(e,"x","isFinite");return Mt.runKernelFunc((function(e){return e.isFinite(t)}),{x:t},null,"IsFinite")}}),Fo=Gt({isInf_:function(e){var t=Ut(e,"x","isInf");return Mt.runKernelFunc((function(e){return e.isInf(t)}),{x:t},null,"IsInf")}}),Mo=Gt({isNaN_:function(e){var t=Ut(e,"x","isNaN");return Mt.runKernelFunc((function(e){return e.isNaN(t)}),{x:t},null,"IsNan")}}),Lo=Gt({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=Ut(e,"x","leakyRelu");return Ha(xa(Pa(t),n),n)}}),zo=Gt({less_:function(e,t){var n,r=Ut(e,"a","less"),a=Ut(t,"b","less");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Ga(r.shape,a.shape),Mt.runKernelFunc((function(e){return e.less(r,a)}),{a:r,b:a},null,"Less")}}),Bo=Gt({lessEqual_:function(e,t){var n,r=Ut(e,"a","lessEqual"),a=Ut(t,"b","lessEqual");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Ga(r.shape,a.shape),Mt.runKernelFunc((function(e,t){var n=e.lessEqual(r,a);return t([r,a]),n}),{a:r,b:a},null,"LessEqual")}});function jo(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return Mt.runKernelFunc((function(r){return r.linspace(e,t,n)}),{},null,"LinSpace",{start:e,stop:t,num:n})}var Vo=Gt({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=Ut(e,"x","localResponseNormalization");J(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),J(ie(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=fr(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u=Mt.runKernelFunc((function(e,i){var s=e.localResponseNormalization4D(o,t,n,r,a);return i([o,s]),s}),{x:o},null,"LRN",{depthRadius:t,bias:n,alpha:r,beta:a});return s?fr(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),qo=Gt({log_:function(e){var t=Ut(e,"x","log");return Mt.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},null,"Log")}}),Uo=Gt({log1p_:function(e){var t=Ut(e,"x","log1p");return Mt.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{x:t},null,"Log1p")}}),Wo=Gt({neg_:function(e){var t=Ut(e,"x","neg");return Mt.runKernelFunc((function(e){return e.neg(t)}),{x:t},null,"Negate")}}),Go=Gt({softplus_:function(e){var t=Ut(e,"x","softplus");return Mt.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{x:t},null,"Softplus")}}),Ho=Gt({logSigmoid_:function(e){var t=Ut(e,"x","logSigmoid");return Na((function(e){return{value:Wo(Go(Wo(e))),gradFunc:function(t){return xa(t,Fi(Wo(e)))}}}))(t)}}),Ko=Gt({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ut(e,"x","max");return Mt.runKernelFunc((function(e,a){var i=fe(t,r.shape),o=ii(i,r.rank),s=r;null!=o&&(s=mr(r,o),i=si(i.length,s.rank));var u=e.max(s,i);null!=o&&s.dispose();var c=u;if(n){var l=ri(c.shape,fe(t,r.shape));c=fr(c,l),u.dispose()}return a([r,c]),c}),{x:r},null,"Max",{reductionIndices:t,keepDims:n})}}),Xo=Gt({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ut(e,"x","sum");return"bool"===r.dtype&&(r=Un(r,"int32")),Mt.runKernelFunc((function(e,a){a([r]);var i=fe(t,r.shape),o=ii(i,r.rank),s=i,u=r;null!=o&&(u=mr(r,o),s=si(s.length,r.rank));var c=e.sum(u,s);if(n){var l=ri(c.shape,i);c=fr(c,l)}return c}),{x:r},null,"Sum",{axis:t,keepDims:n})}}),Qo=Gt({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Ut(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and axis was ").concat(t));return Mt.runKernelFunc((function(n,r){var a=Ko(e,t,!0),i=ja(e,a),o=ja(Un(i,"float32"),qo(Xo(_o(i),t,!0)));return r([o]),o}),{logits:n},null,"LogSoftmax",{axis:t})}}),Yo=Gt({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ut(e,"x","logSumExp"),a=fe(t,r.shape),i=Ko(r,a,!0),o=ja(r,i),s=_o(o),u=Xo(s,a),c=qo(u),l=ba(fr(i,c.shape),c);if(n){var h=ri(l.shape,a);return fr(l,h)}return l}}),Zo=Gt({logicalAnd_:function(e,t){var n=Ut(e,"a","logicalAnd","bool"),r=Ut(t,"b","logicalAnd","bool");return Ga(n.shape,r.shape),Mt.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),Jo=Gt({logicalNot_:function(e){var t=Ut(e,"x","logicalNot","bool");return Mt.runKernelFunc((function(e){return e.logicalNot(t)}),{x:t},null,"LogicalNot")}}),$o=Gt({logicalOr_:function(e,t){var n=Ut(e,"a","logicalOr","bool"),r=Ut(t,"b","logicalOr","bool");return Ga(n.shape,r.shape),Mt.runKernelFunc((function(e){return e.logicalOr(n,r)}),{a:n,b:r},null,"LogicalOr")}}),es=Gt({logicalXor_:function(e,t){var n=Ut(e,"a","logicalXor","bool"),r=Ut(t,"b","logicalXor","bool");return Ga(n.shape,r.shape),Zo($o(e,t),Jo(Zo(e,t)))}}),ts=Gt({maxPool_:function(e,t,n,r,a){var i=Ut(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=fr(i,[1,i.shape[0],i.shape[1],i.shape[2]])),J(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),J(Ei(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '1'")})),null!=a&&J(ie(r),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var u=Mt.runKernelFunc((function(e,i){var s,u=yi(o.shape,t,n,1,r,a);return s=1===u.filterWidth&&1===u.filterHeight&&ae(u.inShape,u.outShape)?o.clone():e.maxPool(o,u),i([o,s]),s}),{x:o},null,"MaxPool",{filterSize:t,strides:n,pad:r,dimRoundingMode:a});return s?fr(u,[u.shape[1],u.shape[2],u.shape[3]]):u}}),ns=Gt({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=arguments.length>6?arguments[6]:void 0;null==o?o=[1,1,1]:na("dilations is deprecated, this field will be gone in v3.0.0.");var s=Ut(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=fr(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),J(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(u.rank,".")})),J("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),J(Ei(n,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(o,"'")})),null!=a&&J(ie(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var l=Mt.runKernelFunc((function(e,s){null==o&&(o=[1,1,1]);var c=_i(u.shape,t,n,o,r,a,i),l=e.maxPool3d(u,c);return s([u,l]),l}),{x:u},null,"MaxPool3D",{filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i,dilations:o});return c?fr(l,[l.shape[1],l.shape[2],l.shape[3],l.shape[4]]):l}}),rs=Gt({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=Ut(e,"x","maxPoolWithArgmax"),o=Mt.runKernel("MaxPoolWithArgmax",{x:i},{filterSize:t,strides:n,pad:r,includeBatchInIndex:a});return{result:o[0],indexes:o[1]}}});function as(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=as(e,"float32"),r=as(e,"float32");return Ht(n,r)}var a=Oe(ne(e),t);return Mt.makeTensor(a,e,t)}function is(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=is(e,"float32"),r=as(e,"float32");return Ht(n,r)}var a=Re(ne(e),t);return Mt.makeTensor(a,e,t)}var os=Gt({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ut(e,"x","mean"),a=fe(t,r.shape),i=ne(ni(r.shape,a)[1]),o={x:r},s={axis:t,keepDims:n},u=function(){var e=Pa(i),a=e.dtype===r.dtype?r:Un(r,e.dtype),o=wa(a,e);return Xo(o,t,n)};return Na((function(e){return{value:Mt.runKernelFunc(u,o,null,"Mean",s),gradFunc:function(t){var n=e.shape.slice();a.forEach((function(e){n[e]=1}));var r=fr(t,n);return wa(xa(r,is(e.shape,"float32")),i)}}}))(r)}}),ss=Gt({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ut(e,"x","min");return Mt.runKernelFunc((function(e,a){var i=fe(t,r.shape),o=i,s=ii(o,r.rank),u=r;null!=s&&(u=mr(r,s),o=si(o.length,r.rank));var c=e.min(u,o);null!=s&&u.dispose();var l=c;if(n){var h=ri(l.shape,i);l=fr(c,h),c.dispose()}return a([r,l]),l}),{x:r},null,"Min",{axis:t,keepDims:n})}}),us=Gt({minimum_:function(e,t){var n,r=Ut(e,"a","minimum"),a=Ut(t,"b","minimum");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],"bool"===r.dtype&&(r=Un(r,"int32"),a=Un(a,"int32")),Ga(r.shape,a.shape),Mt.runKernelFunc((function(e,t){var n=e.minimum(r,a);return t([r,a]),n}),{a:r,b:a},null,"Minimum")}}),cs=Gt({mirrorPad_:function(e,t,n){J("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")}));var r=Ut(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");J(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". Got ").concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){J(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),J(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal to ").concat(r.shape[e]-a," or less than 0 for input of shape ")+r.shape}))},o=0;o<r.rank;o++)i(o);return Mt.runKernel("MirrorPad",{x:r},{paddings:t,mode:n})}}),ls=Gt({mod_:function(e,t){var n,r=Ut(e,"a","mod"),a=Ut(t,"b","mod");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Mt.runKernelFunc((function(e,t){var n=e.mod(r,a);return t([r,a]),n}),{a:r,b:a},null,"Mod")}}),hs=Gt({moments_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=fe(t,(e=Ut(e,"x","moments")).shape),a=os(e,r,n),i=a.shape;n||(i=ri(a.shape,r));var o=Sa(ja(Un(e,"float32"),fr(a,i)));return{mean:a,variance:os(o,r,n)}}}),fs=Gt({multiRNNCell_:function(e,t,n,r){for(var a=Ut(t,"data","multiRNNCell"),i=Wt(n,"c","multiRNNCell"),o=Wt(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var h=[],f=[],d=0;d<u.length;d+=2)h.push(u[d]),f.push(u[d+1]);return[h,f]}}),ds=Gt({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Ut(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);n=n||Math.random();var s=1===o?fr(a,[1,-1]):a,u=Mt.runKernelFunc((function(e){return e.multinomial(s,r,t,n)}),{logits2D:s});return 1===o?fr(u,[u.size]):u}}),ps=Gt({notEqual_:function(e,t){var n,r=Ut(e,"a","notEqual"),a=Ut(t,"b","notEqual");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Ga(r.shape,a.shape),Mt.runKernelFunc((function(e){return e.notEqual(r,a)}),{a:r,b:a},null,"NotEqual")}}),ms=Gt({real_:function(e){var t=Ut(e,"input","real");return Mt.runKernelFunc((function(e){return e.real(t)}),{input:t},null,"Real")}}),vs=Gt({onesLike_:function(e){var t=Ut(e,"x","onesLike");return Mt.runKernelFunc((function(e,n){if("complex64"===t.dtype){var r=vs(ms(t)),a=Ta(Do(t));return Ht(r,a)}return e.onesLike(t)}),{x:t},null,"OnesLike")}}),gs=Gt({outerProduct_:function(e,t){var n=Ut(e,"v1","outerProduct"),r=Ut(t,"v2","outerProduct");J(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=fr(n,[-1,1]),i=fr(r,[1,-1]);return dr(a,i)}}),ys=Gt({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Ut(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return Mt.runKernelFunc((function(e,a){return a([r]),e.pad(r,t,n)}),{x:r},null,"PadV2",{paddings:t,constantValue:n})}}),_s=Gt({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return J(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),ys(e,[t],n)}}),bs=Gt({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return J(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ys(e,t,n)}}),ks=Gt({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return J(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ys(e,t,n)}}),ws=Gt({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return J(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ys(e,t,n)}}),xs=Gt({spaceToBatchND_:function(e,t,n){var r=Ut(e,"x","spaceToBatchND");return J(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),J(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),J(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]==0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())})),Mt.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{x:r},null,"SpaceToBatchND",{blockShape:t,paddings:n})}}),Cs=Gt({pool_:function(e,t,n,r,a,i){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var o=Ut(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=fr(o,[1,o.shape[0],o.shape[1],o.shape[2]])),J(Ei(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(a,"'")}));var c,l=yi(s.shape,t,i,a,r),h=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var f=1===h[0]&&1===h[1],d=_slicedToArray2(function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,o[t]]}))]}([l.inHeight,l.inWidth],h,c),2),p=d[0],m=d[1],v=f?r:"valid",g=f?s:xs(s,h,p),y=("avg"===n?function(){return Ri(g,t,i,v)}:function(){return ts(g,t,i,v)})(),_=f?y:Bi(y,h,m);return u?fr(_,[_.shape[1],_.shape[2],_.shape[3]]):_}}),Ss=Gt({prelu_:function(e,t){var n=Ut(e,"x","prelu"),r=Ut(t,"alpha","prelu");return Mt.runKernelFunc((function(e,t){var a=e.prelu(n,r);return t([n,r]),a}),{x:n,alpha:r},null,"Prelu")}}),Ts=Gt({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ut(e,"x","prod");return"bool"===r.dtype&&(r=Un(r,"int32")),Mt.runKernelFunc((function(e){var a=fe(t,r.shape),i=ii(a,r.rank),o=a,s=r;null!=i&&(s=mr(r,i),o=si(o.length,r.rank));var u=e.prod(s,o);if(n){var c=ri(u.shape,a);u=fr(u,c)}return u}),{x:r},null,"Prod",{axis:t,keepDims:n})}}),As=Gt({rand_:function(e,t,n){var r=ne(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return Mt.makeTensor(a,e,n)}}),Es=n("YSVl"),Is=function(){function e(t,n,r,a,i){_classCallCheck2(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Es.alea(o.toString())}return _createClass2(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),Rs=function(){function e(t,n,r,a){_classCallCheck2(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=Es.alea(i.toString()),this.randn=new Is(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return _createClass2(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i*=1/this.beta*this.d,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),Os=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(_classCallCheck2(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=Es.alea(i)}return _createClass2(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}(),Ns=Gt({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new Rs(t,n,r,a),o=qn(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Ds=Gt({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new Is(t,n,r,!1,a),o=qn(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Ps=Gt({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0,i=qn(e,r),o=new Os(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});function Fs(e,t){ee(e);var n=Vt(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Kt(e,null,n,t)}function Ms(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");return Mt.runKernelFunc((function(){if(e===t||e<t&&n<0||t<e&&n>1)return as([0],r);var a=Oe(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return Fs(a,r)}),{},null,"Range",{start:e,stop:t,step:n,dtype:r})}var Ls=Gt({reciprocal_:function(e){var t=Ut(e,"x","reciprocal");return Mt.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{x:t},null,"Reciprocal")}}),zs=Gt({relu_:function(e){var t=Ut(e,"x","relu");return Mt.runKernelFunc((function(e,n){return n([t]),"bool"===t.dtype?Un(t,"int32"):e.relu(t)}),{x:t},null,"Relu")}}),Bs=Gt({relu6_:function(e){var t=Ut(e,"x","relu6");return Mt.runKernelFunc((function(e,n){return n([t]),"bool"===t.dtype?Un(t,"int32"):e.relu6(t)}),{x:t},null,"Relu6")}}),js=Gt({reverse_:function(e,t){var n=Ut(e,"x","reverse");return Mt.runKernelFunc((function(e){var r=fe(t,n.shape);if(0===n.rank)return Wn(n);var a=e.reverse(n,r);return fr(a,n.shape)}),{x:n},null,"Reverse",{dims:t})}}),Vs=Gt({reverse1d_:function(e){var t=Ut(e,"x","reverse");return J(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),js(t,0)}}),qs=Gt({reverse2d_:function(e,t){var n=Ut(e,"x","reverse");return J(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),js(n,t)}}),Us=Gt({reverse3d_:function(e,t){var n=Ut(e,"x","reverse");return J(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),js(n,t)}}),Ws=Gt({reverse4d_:function(e,t){var n=Ut(e,"x","reverse");return J(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),js(n,t)}}),Gs=Gt({round_:function(e){var t=Ut(e,"x","round");return Mt.runKernelFunc((function(e){return e.round(t)}),{x:t},null,"Round")}}),Hs=Gt({rsqrt_:function(e){var t=Ut(e,"x","rsqrt");return Mt.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},null,"Rsqrt")}}),Ks=Gt({selu_:function(e){var t=Ut(e,"x","selu");return Mt.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{x:t},null,"Selu")}}),Xs=Gt({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=Ut(e,"x","separableConv2d"),u=Ut(t,"depthwiseFilter","separableConv2d"),c=Ut(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=fr(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");J(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),J(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank ".concat(u.rank,".")})),J(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank ".concat(u.rank,".")})),J(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ".concat(c.shape[0],".")})),J(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ".concat(c.shape[1],".")}));var f=u.shape[2],d=u.shape[3];J(c.shape[2]===f*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be ".concat(f*d,", but got ").concat(c.shape[2],".")}));var p=co(l,u,r,a,o,i),m=Ji(p,c,1,"valid",o);return h?fr(m,[m.shape[1],m.shape[2],m.shape[3]]):m}}),Qs=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Ut(t,"x","setdiff1d"),a=Ut(n,"y","setdiff1d"),J(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),J(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),J(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=4,r.data();case 4:return i=e.sent,e.next=7,a.data();case 7:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new vt([u],r.dtype),h=new vt([u],"int32"),f=0,d=0;f<i.length;f++)s.has(i[f])||(l.values[d]=i[f],h.values[d]=f,d++);return e.abrupt("return",[l.toTensor(),h.toTensor()]);case 14:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ys=Gt({sign_:function(e){var t=Ut(e,"x","sign");return Mt.runKernelFunc((function(e){return e.sign(t)}),{x:t},null,"Sign")}}),Zs=Gt({sin_:function(e){var t=Ut(e,"x","sin");return Mt.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},null,Ge)}}),Js=Gt({sinh_:function(e){var t=Ut(e,"x","sinh");return Mt.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{x:t},null,"Sinh")}}),$s=Gt({slice1d_:function(e,t,n){var r=Ut(e,"x","slice1d");return J(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),Mi(r,[t],[n])}}),eu=Gt({slice2d_:function(e,t,n){var r=Ut(e,"x","slice2d");return J(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),Mi(r,t,n)}}),tu=Gt({slice3d_:function(e,t,n){var r=Ut(e,"x","slice3d");return J(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),Mi(r,t,n)}}),nu=Gt({slice4d_:function(e,t,n){var r=Ut(e,"x","slice4d");return J(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),Mi(r,t,n)}}),ru=Gt({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Ut(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and dim was ").concat(t));return Mt.runKernelFunc((function(e,r){var a=e.softmax(n,t);return r([a]),a}),{logits:n},null,"Softmax",{dim:t})}}),au=Gt({fft_:function(e){return J("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got ".concat(e.dtype,".")})),Mt.runKernelFunc((function(t){var n=e.shape[e.shape.length-1],r=e.as2D(e.size/n,n);return t.fft(r).reshape(e.shape)}),{input:e},null,"FFT")}}),iu=Gt({ifft_:function(e){return J("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got ".concat(e.dtype,".")})),Mt.runKernelFunc((function(t){var n=e.shape[e.shape.length-1],r=fr(e,[e.size/n,n]),a=t.ifft(r);return fr(a,e.shape)}),{input:e},null,"IFFT")}}),ou=Gt({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=fr(e,[r,n]);t=iu(a)}else{var i=[r,2*(n-1)],o=fr(ms(e),[r,n]),s=fr(Do(e),[r,n]),u=js(Mi(o,[0,1],[r,n-2]),1),c=xa(js(Mi(s,[0,1],[r,n-2]),1),Pa(-1)),l=Pi([o,u],1),h=Pi([s,c],1),f=fr(Ht(l,h),[i[0],i[1]]);t=iu(f)}if(t=ms(t),3===e.rank&&0!==e.shape[0]){var d=t,p=e.shape[0];t=fr(t,[p,t.shape[0]/p,t.shape[1]]),d.dispose()}return t}});function su(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)J(e.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{J(t.reduce((function(e,t){return-1===t&&(e+=1),e}),0)<=1,(function(){return"There should be only one negative value in split array."}));var a=t.indexOf(-1);if(-1!==a){var i=t.reduce((function(e,t){return t>0?e+t:e}));t[a]=e.shape[n]-i}J(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}var uu=Gt({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Ut(e,"x","split");return Mt.runKernelFunc((function(e,a){var i=fe(n,r.shape)[0],o=su(r,t,i);return e.split(r,o,i)}),{x:r},null,"SplitV",{numOrSizeSplits:t,axis:n})}}),cu=Gt({rfft_:function(e,t){J("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=Mi(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=Pi([e,as(s)],e.shape.length-1),r=t}else n=e;var u=Ta(n),c=fr(Ht(n,u),[a,r]),l=au(c),h=Math.floor(r/2)+1,f=ms(l),d=Do(l),p=uu(f,[h,r-h],f.shape.length-1),m=uu(d,[h,r-h],d.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=h,fr(Ht(p[0],m[0]),v)}}),lu=Gt({squaredDifference_:function(e,t){var n,r=Ut(e,"a","squaredDifference"),a=Ut(t,"b","squaredDifference");return n=_slicedToArray2(It(r,a),2),r=n[0],a=n[1],Ga(r.shape,a.shape),Mt.runKernelFunc((function(e,t){var n=e.squaredDifference(r,a);return t([r,a]),n}),{a:r,b:a},null,"SquaredDifference",{})}}),hu=Gt({squeeze_:function(e,t){var n=Ut(e,"x","squeeze");return fr(n,de(n.shape,t).newShape)}}),fu=Gt({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Wt(e,"tensors","stack");if(J(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return bo(n[0],t);var r=n[0].shape,a=n[0].dtype;J(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){$(r,e.shape,"All tensors passed to stack must have matching shapes"),J(a===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=n.map((function(e){return bo(e,t)}));return Pi(i,t)}}),du=Gt({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ut(e,"x","step");return Mt.runKernelFunc((function(e){return e.step(n,t)}),{x:n},null,"Step",{alpha:t})}}),pu=Gt({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=Ut(e,"x","stridedSlice");return Mt.runKernelFunc((function(e){null==r&&(r=new Array(t.length));var l=Tr(o);if(l.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==o&&0!==s)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==o&&0!==u)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");var h=c.rank-t.length,f=Tr(s),d=c.shape.slice();f.forEach((function(e){t[e]=0,n[e]=1,d.splice(e,0,1)}));var p=Or((c=fr(c,d)).shape,l,h,t,n,r,a,i,o),m=p.begin,v=p.end,g=p.strides;t=m,n=v,r=g;var y=Tr(u);y.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var _=Ar(t,n,r),b=_.filter((function(e,t){return-1===y.indexOf(t)}));if(r.every((function(e){return 1===e})))return fr(Mi(c,t,_),b);var k=e.stridedSlice(c,t,n,r);return fr(k,b)}),{x:c},null,"StridedSlice",{begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u})}}),mu=Gt({tan_:function(e){var t=Ut(e,"x","tan");return Mt.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{x:t},null,Ke)}});function vu(e,t,n){if(ee(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Vt(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Kt(e,t,r,n)}function gu(e,t,n){if(ee(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Vt(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Kt(e,t,r,n)}function yu(e,t,n){if(ee(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Vt(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Kt(e,t,r,n)}function _u(e,t,n){if(ee(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Vt(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Kt(e,t=t||r,r,n)}var bu=Gt({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Ut(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") but got ")+t);var i={x:r},o={k:t,sorted:n},s=Mt.runKernelFunc((function(e){return e.topk(r,t,n)}),i,null,"TopK",o),u=_slicedToArray2(s,2),c=u[0],l=u[1];return{values:c,indices:l}}}),ku=Gt({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new Is(t,n,r,!0,a),o=qn(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),wu=Gt({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ut(e,"x","unique",null);J(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=Mt.runKernel("Unique",r,a),o=_slicedToArray2(i,2),s=o[0],u=o[1];return{values:s,indices:u}}}),xu=Gt({unsortedSegmentSum_:function(e,t,n){var r=Ut(e,"x","unsortedSegmentSum"),a=Ut(t,"segmentIds","unsortedSegmentSum","int32");return J(ie(n),(function(){return"numSegments must be of dtype int"})),Mt.runKernelFunc((function(e,t){var i=e.unsortedSegmentSum(r,a,n);return t([a]),i}),{x:r,segmentIds:a},null,"UnsortedSegmentSum",{numSegments:n})}}),Cu=Gt({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ut(e,"x","unstack");return J(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")})),t<0&&(t+=n.shape.length),Mt.runKernelFunc((function(e){return e.unstack(n,t)}),{value:n},null,"Unpack",{axis:t})}});function Su(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return Mt.makeVariable(e,t,n,r)}function Tu(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=qn(e,"int32"),i=qn([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]);i.values.set(s,o*e.length)}return i.toTensor()}var Au=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ut(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=Tu(n.shape,r),e.abrupt("return",(t!==n&&n.dispose(),a));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Eu=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,f,d,p,m,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=Ut(t,"tensor","boolMask"),i=Ut(n,"mask","boolMask","bool"),o=null==r?0:r,s=i.rank,u=a.shape,J(s>0,(function(){return"mask cannot be scalar"})),$(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=o;l<o+s;l++)c*=u[l];return h=u.slice(0,o).concat([c],u.slice(o+s)),f=fr(a,h),d=fr(i,[-1]),e.next=9,Au(d);case 9:return p=e.sent,m=hu(p,[1]),v=Ro(f,m,o),e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),m.dispose(),f.dispose(),d.dispose(),p.dispose(),v));case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Iu=Gt({equalStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","equalStrict"),r=Ut(t,"b","equalStrict");return $(n.shape,r.shape,"Error in equalStrict: "),fo(n,r)}}),Ru=Gt({greaterEqualStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","greaterEqualStrict"),r=Ut(t,"b","greaterEqualStrict");return $(n.shape,r.shape,"Error in greaterEqualStrict: "),No(n,r)}}),Ou=Gt({greaterStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","greaterStrict"),r=Ut(t,"b","greaterStrict");return $(n.shape,r.shape,"Error in greaterStrict: "),Oo(n,r)}}),Nu=Gt({lessEqualStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","lessEqualStrict"),r=Ut(t,"b","lessEqualStrict");return $(n.shape,r.shape,"Error in lessEqualStrict: "),Bo(n,r)}}),Du=Gt({lessStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","lessStrict"),r=Ut(t,"b","lessStrict");return $(n.shape,r.shape,"Error in lessStrict: "),zo(n,r)}}),Pu=Gt({notEqualStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","notEqualStrict"),r=Ut(t,"b","notEqualStrict");return $(n.shape,r.shape,"Error in notEqualStrict: "),ps(n,r)}}),Fu=Gt({addStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","addStrict"),r=Ut(t,"b","addStrict");return $(n.shape,r.shape,"Error in addStrict: "),ba(n,r)}}),Mu=Gt({divStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","div"),r=Ut(t,"b","div");return $(n.shape,r.shape,"Error in divideStrict: "),wa(n,r)}}),Lu=Gt({maximumStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","maximumStrict"),r=Ut(t,"b","maximumStrict");return $(n.shape,r.shape,"Error in maximumStrict: "),Ha(n,r)}}),zu=Gt({minimumStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","minimumStrict"),r=Ut(t,"b","minimumStrict");return $(n.shape,r.shape,"Error in minimumStrict: "),us(n,r)}}),Bu=Gt({modStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","modStrict"),r=Ut(t,"b","modStrict");return $(n.shape,r.shape,"Error in modStrict: "),ls(n,r)}}),ju=Gt({mulStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","mul"),r=Ut(t,"b","mul");return $(n.shape,r.shape,"Error in multiplyStrict: "),xa(n,r)}}),Vu=Gt({powStrict_:function(e,t){return na("strict variants of ops have been deprecated and will be removed in future"),$(e.shape,t.shape,"Error in powStrict: "),Ba(e,t)}}),qu=Gt({squaredDifferenceStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","squaredDifferenceStrict"),r=Ut(t,"b","squaredDifferenceStrict");return $(n.shape,r.shape,"Error in squaredDifferenceStrict: "),lu(n,r)}}),Uu=Gt({subStrict_:function(e,t){na("strict variants of ops have been deprecated and will be removed in future");var n=Ut(e,"a","subStrict"),r=Ut(t,"b","subStrict");return $(n.shape,r.shape,"Error in subStrict: "),ja(n,r)}}),Wu=Gt({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===t.rank)return qa(t);if(1!==t.rank&&null===r)return e(fr(t,[-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return Xo(qa(t),r);if(n===1/0)return Ko(qa(t),r);if(n===-1/0)return ss(qa(t),r);if("euclidean"===n||2===n)return Ca(Xo(Ba(qa(t),Pa(2,"int32")),r));throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return Ko(Xo(qa(t),r[0]),r[1]-1);if(n===1/0)return Ko(Xo(qa(t),r[1]),r[0]);if(n===-1/0)return ss(Xo(qa(t),r[1]),r[0]);if("fro"===n||"euclidean"===n)return Ca(Xo(Sa(t),r));throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=Ut(e,"x","norm"),t,n),i=a.shape;if(r){var o=fe(n,e.shape);i=ri(a.shape,o)}return fr(a,i)}}),Gu=Gt({movingAverage_:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=Ut(e,"v","movingAverage"),o=Ut(t,"x","movingAverage"),s=Ut(n,"decay","movingAverage");Rt(i,o),J(ae(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=Pa(1),c=ja(u,s),l=xa(ja(o,i),c);if(a){J(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var h=Ut(r,"step","movingAverage");l=wa(l,ja(u,Ba(s,h)))}return ba(i,l)}}),Hu=Gt({scatterND_:function(e,t,n){var r=Ut(e,"indices","scatterND","int32"),a=Ut(t,"updates","scatterND");return xr(a,r,n),Mt.runKernelFunc((function(e){return e.scatterND(r,a,n)}),{indices:r,updates:a},null,"ScatterNd",{shape:n})}}),Ku=Gt({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=Ut(e,"sparseIndices","sparseToDense","int32"),i=Ut(t,"sparseValues","sparseToDense"),o=Ut(r,"defaultValue","sparseToDense",i.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, ".concat(n.length,", should be: ").concat(i,"."));if(0!==t.rank&&(1!==t.rank||t.size!==a))throw new Error("sparseValues has incorrect shape ".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o),Mt.runKernelFunc((function(e){return e.sparseToDense(a,i,n,o)}),{sparseIndices:a,sparseValues:i,defaultValue:o},null,"SparseToDense",{outputShape:n})}}),Xu=Gt({gatherND_:function(e,t){var n=Ut(t,"indices","gatherND","int32"),r=Ut(e,"x","gatherND");return Mt.runKernelFunc((function(e){return e.gatherND(r,n)}),{params:r,indices:n},null,"GatherNd")}}),Qu=Gt({dropout_:function(e,t,n,r){var a=Ut(e,"x","dropout");if(J("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a ".concat(a.dtype," tensor instead.")})),J(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof _t?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(ae(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)n.push(null==t[r]&&null!=e.shape[r]?e.shape[r]:t[r]);return n}return t}(a,n),o=1-t,s=wa(Co(ba(Ps(i,0,1,"float32",r),o)),o);return xa(a,s)}});function Yu(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function Zu(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return Fs(a,"float32")}var Ju=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f,d,p,m,v,g,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y.length>2&&void 0!==y[2]?y[2]:1,a=Ut(t,"predictions","inTopK"),i=Ut(n,"targets","inTopK"),J(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+a.rank})),J(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank ".concat(a.rank," and targets rank ").concat(i.rank)})),$(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],J(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension (".concat(o,"), but got ").concat(r)})),e.next=7,a.data();case 7:return s=e.sent,e.next=10,i.data();case 10:u=e.sent,c=s.length/o,l=o,h=pe("bool",c),f=0;case 15:if(!(f<c)){e.next=30;break}for(d=f*l,p=s.subarray(d,d+l),m=[],v=0;v<p.length;v++)m.push({value:p[v],index:v});m.sort((function(e,t){return t.value-e.value})),h[f]=0,g=0;case 20:if(!(g<r)){e.next=27;break}if(m[g].index!==u[f]){e.next=24;break}return h[f]=1,e.abrupt("break",27);case 24:g++,e.next=20;break;case 27:f++,e.next=15;break;case 30:return e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),Xt(h,i.shape,"bool")));case 31:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),$u=Gt({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=fr(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=fr(t,[1,t.shape[0],t.shape[1],t.shape[2]])),J(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),J(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),J(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];return J(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must match input depth in filter (").concat(n[2],".")})),J(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must match output depth for filter (").concat(n[3],").")})),null!=o&&J(ie(a),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(a,".")})),Mt.runKernelFunc((function(e){var t=Ii(i),c=bi(s.shape,n,r,1,a,o,!1,t);return e.conv2dDerFilter(s,u,c)}),{x:s,dy:u},null,"Conv2DBackpropFilter",{strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n})}});function ec(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return xa(e,du(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function tc(e,t){var n=t,r=Wa(e.shape,t.shape);return r.length>0&&(n=Xo(n,r)),fr(n,e.shape)}function nc(e,t,n){if("linear"===t)return e;if("relu"===t)return zs(e);if("elu"===t)return go(e);if("relu6"===t)return Bs(e);if("prelu"===t)return Ss(e,n);throw new Error("Unknown fused activation ".concat(t,"."))}var rc=function(e,t){return!(e>0)||"linear"===t},ac=Gt({fusedConv2d_:function(e){var t,n=e.x,r=e.filter,a=e.strides,i=e.pad,o=e.dataFormat,s=void 0===o?"NHWC":o,u=e.dilations,c=void 0===u?[1,1]:u,l=e.dimRoundingMode,h=e.bias,f=e.activation,d=void 0===f?"linear":f,p=e.preluActivationWeights;if(!1===rc(Mt.state.gradientDepth,d=d||"linear")){var m=Ji(n,r,a,i,s,c,l);return null!=h&&(m=ba(m,h)),nc(m,d,p)}var v=Ut(n,"x","conv2d"),g=Ut(r,"filter","conv2d"),y=v,_=!1;3===v.rank&&(_=!0,y=fr(v,[1,v.shape[0],v.shape[1],v.shape[2]])),J(4===y.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+y.rank+"."})),J(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."})),null!=l&&J(ie(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode ".concat(l," but got pad ").concat(i,".")})),J(y.shape[3]===g.shape[2],(function(){return"Error in conv2d: depth of input (".concat(y.shape[3],") must match input depth for filter ").concat(g.shape[2],".")})),J(Ei(a,c),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(c,"'")})),J("NHWC"===s,(function(){return"Error in conv2d: got dataFormat of ".concat(s," but only NHWC is currently supported.")}));var b,k,w=bi(y.shape,g.shape,a,c,i,l);null!=h&&(t=_slicedToArray2(It(b=Ut(h,"bias","fused conv2d"),v),1),b=t[0],Ga(w.outShape,b.shape)),null!=p&&(k=Ut(p,"prelu weights","fused conv2d"));var x=function(e,t){var n=_slicedToArray2(t,4),r=n[0],o=n[1],s=n[2],u=n[3],l=ec(e,s,d);J(Ai(c),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(c,"'")}));var h=[eo(o.shape,l,r,a,i),$u(o,l,r.shape,a,i)];if(null!=u){var f=tc(u,l);h.push(f)}return h},C=function(e){return e.fusedConv2d({input:y,filter:g,convInfo:w,bias:b,activation:d,preluActivationWeights:k})},S={x:y,filter:g,bias:b,preluActivationWeights:k},T={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d};return null==h?Na((function(e,t,n){var r=Mt.runKernelFunc(C,S,null,"FusedConv2D",T);return n([t,e,r]),_&&(r=fr(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:x}}))(y,g):Na((function(e,t,n,r){var a=Mt.runKernelFunc(C,S,null,"FusedConv2D",T);return r([t,e,a,n]),_&&(a=fr(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:x}}))(y,g,b)}}),ic=Gt({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=fr(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;return 3===u.rank&&(u=fr(t,[1,t.shape[0],t.shape[1],t.shape[2]])),Mt.runKernelFunc((function(t){var c=bi(e.shape,n,r,i,a,o,!0);return t.depthwiseConv2DDerFilter(s,u,c)}),{x:s,dy:u},null,"DepthwiseConv2dNativeBackpropFilter",{strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n})}}),oc=Gt({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=fr(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c=Mt.runKernelFunc((function(t){var u=bi(e,n.shape,r,i,a,o,!0);return t.depthwiseConv2DDerInput(s,n,u)}),{dy:s,filter:n},null,"DepthwiseConv2dNativeBackpropInput",{strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e});return u?fr(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),sc=Gt({fusedDepthwiseConv2d_:function(e){var t,n=e.x,r=e.filter,a=e.strides,i=e.pad,o=e.dataFormat,s=void 0===o?"NHWC":o,u=e.dilations,c=void 0===u?[1,1]:u,l=e.dimRoundingMode,h=e.bias,f=e.activation,d=void 0===f?"linear":f,p=e.preluActivationWeights;if(!1===rc(Mt.state.gradientDepth,d)){var m=co(n,r,a,i,s,c,l);return null!=h&&(m=ba(m,h)),nc(m,d,p)}var v=Ut(n,"x","depthwiseConv2d"),g=Ut(r,"filter","depthwiseConv2d"),y=v,_=!1;3===v.rank&&(_=!0,y=fr(v,[1,v.shape[0],v.shape[1],v.shape[2]])),J(4===y.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank ".concat(y.rank,".")})),J(4===g.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank ".concat(g.rank,".")})),J(y.shape[3]===g.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels (".concat(y.shape[3],") must match the inChannels dimension in filter ").concat(g.shape[2],".")})),null==c&&(c=[1,1]),J(Ei(a,c),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(c,"'")})),null!=l&&J(ie(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ".concat(l," but got pad ").concat(i,".")}));var b,k,w=bi(y.shape,g.shape,a,c,i,l,!0);null!=h&&(t=_slicedToArray2(It(b=Ut(h,"bias","fused conv2d"),v),1),b=t[0],Ga(w.outShape,b.shape)),null!=p&&(k=Ut(p,"prelu weights","fused depthwiseConv2d"));var x=function(e,t){J(Ai(c),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '".concat(c,"'")}));var n=_slicedToArray2(t,4),r=n[0],o=n[1],s=n[2],u=n[3],h=ec(e,s,d),f=oc(o.shape,h,r,a,i,c,l),p=ic(o,h,r.shape,a,i,c,l);return null!=u?[f,p,tc(b,h)]:[f,p]},C=function(e){return e.fusedDepthwiseConv2D({input:y,filter:g,convInfo:w,bias:b,activation:d,preluActivationWeights:k})},S={x:y,filter:g,bias:b,preluActivationWeights:k},T={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d};return null==h?Na((function(e,t,n){var r=Mt.runKernelFunc(C,S,null,"FusedDepthwiseConv2D",T);return n([t,e,r]),_&&(r=fr(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:x}}))(y,g):Na((function(e,t,n,r){var a=Mt.runKernelFunc(C,S,null,"FusedDepthwiseConv2D",T);return r([t,e,a,n]),_&&(a=fr(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:x}}))(y,g,b)}}),uc=Gt({fusedMatMul_:function(e){var t,n=e.a,r=e.b,a=e.transposeA,i=void 0!==a&&a,o=e.transposeB,s=void 0!==o&&o,u=e.bias,c=e.activation,l=void 0===c?"linear":c,h=e.preluActivationWeights;if(!1===rc(Mt.state.gradientDepth,l)){var f=dr(n,r,i,s);return null!=u&&(f=ba(f,u)),nc(f,l,h)}var d=Ut(n,"a","fused matMul"),p=Ut(r,"b","fused matMul"),m=_slicedToArray2(It(d,p),2);d=m[0],p=m[1];var v=i?d.shape[d.rank-2]:d.shape[d.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],y=i?d.shape[d.rank-1]:d.shape[d.rank-2],_=s?p.shape[p.rank-2]:p.shape[p.rank-1],b=d.shape.slice(0,-2),k=p.shape.slice(0,-2),w=ne(b),x=ne(k);J(d.rank>=2&&p.rank>=2&&d.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks ".concat(d.rank," and ").concat(p.rank,".")})),J(ae(b,k),(function(){return"Error in fused matMul: outer dimensions (".concat(b,") and (").concat(k,") of Tensors with shapes ").concat(d.shape," and ")+p.shape+" must match."})),J(v===g,(function(){return"Error in fused matMul: inner shapes (".concat(v,") and (").concat(g,") of Tensors with shapes ").concat(d.shape," and ").concat(p.shape," and transposeA=").concat(i," and transposeB=").concat(s," must match.")}));var C,S,T=d.shape.slice(0,-2).concat([y,_]),A=fr(d,i?[w,v,y]:[w,y,v]),E=fr(p,s?[x,_,g]:[x,g,_]);null!=u&&(t=_slicedToArray2(It(C=Ut(u,"bias","fused matMul"),d),1),C=t[0],Ga(T,C.shape)),null!=h&&(S=Ut(h,"prelu weights","fused matMul"));var I=function(e,t){var n,r,a=_slicedToArray2(t,4),o=a[0],c=a[1],h=a[2],f=a[3],d=ec(fr(e,h.shape),h,l);return i||s?!i&&s?(n=dr(d,c,!1,!1),r=dr(d,o,!0,!1)):i&&!s?(n=dr(c,d,!1,!0),r=dr(o,d,!1,!1)):(n=dr(c,d,!0,!0),r=dr(d,o,!0,!0)):(n=dr(d,c,!1,!0),r=dr(o,d,!0,!1)),null!=u?[n,r,tc(f,d)]:[n,r]},R=function(e){return e.fusedBatchMatMul({a:A,b:E,transposeA:i,transposeB:s,bias:C,activation:l,preluActivationWeights:S})},O={a:A,b:E,bias:C,preluActivationWeights:S},N={transposeA:i,transposeB:s,activation:l};return null==u?Na((function(e,t,n){var r=Mt.runKernelFunc(R,O,null,"_FusedMatMul",N);return n([e,t,r]),{value:fr(r,T),gradFunc:I}}))(A,E):Na((function(e,t,n,r){var a=Mt.runKernelFunc(R,O,null,"_FusedMatMul",N);return r([e,t,a,n]),{value:fr(a,T),gradFunc:I}}))(A,E,C)}}),cc=Gt({hammingWindow_:function(e){return Zu(e,.54,.46)}}),lc=Gt({hannWindow_:function(e){return Zu(e,.5,.5)}}),hc=Gt({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(Mi(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Pi([Mi(e,i,t-s),La([s],a)]);o.push(u),i+=n}return 0===o.length?vu([],[0,t]):fr(Pi(o),[o.length,t])}}),fc=Gt({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:lc;null==r&&(r=Yu(t));for(var i=hc(e,t,n),o=xa(i,a(t)),s=[],u=0;u<i.shape[0];u++)s.push(cu(Mi(o,[u,0],[1,t]),r));return Pi(s)}}),dc=Gt({cropAndResize_:function(e,t,n,r,a,i){var o=Ut(e,"image","cropAndResize"),s=Ut(t,"boxes","cropAndResize","float32"),u=Ut(n,"boxInd","cropAndResize","int32");a=a||"bilinear",i=i||0;var c=s.shape[0];return J(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank ".concat(o.rank,".")})),J(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] but had shape ").concat(s.shape,".")})),J(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] but had shape ").concat(s.shape,".")})),J(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(r.length,".")})),J(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),J("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was "+a})),Mt.runKernelFunc((function(e){return e.cropAndResize(o,s,u,r,a,i)}),{image:o,boxes:s,boxInd:u},null,"CropAndResize",{method:a,extrapolationValue:i,cropSize:r})}}),pc=Gt({flipLeftRight_:function(e){var t=Ut(e,"image","flipLeftRight","float32");return J(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")})),Mt.runKernel("FlipLeftRight",{image:t},{})}}),mc=Gt({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=Ut(e,"image","rotateWithOffset","float32");return J(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(a.rank,".")})),Mt.runKernel("RotateWithOffset",{image:a},{radians:t,fillValue:n,center:r})}});function vc(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),J(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),J(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),J(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),J(1===t.rank,(function(){return"scores must be a 1D tensor"})),J(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", but was ")+t.shape[0]})),J(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var gc=Gt({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=Ut(e,"boxes","nonMaxSuppression"),o=Ut(t,"scores","nonMaxSuppression"),s=vc(i,o,n,r,a);return Mt.runKernelFunc((function(e){return e.nonMaxSuppression(i,o,n,r,a)}),{boxes:i,scores:o},null,"NonMaxSuppressionV3",{maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold})}});function yc(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||_c)}(e,t,n);e.splice(r<0?-(r+1):r,0,t)}function _c(e,t){return e>t?1:e<t?-1:0}function bc(e,t,n,r,a){return xc(e,t,n,r,a,0).selectedIndices}function kc(e,t,n,r,a,i){return xc(e,t,n,r,a,0,!1,i,!0)}function wc(e,t,n,r,a,i){return xc(e,t,n,r,a,i,!0)}function xc(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(Tc);for(var h=i>0?-.5/i:0,f=[],d=[];f.length<n&&c.length>0;){var p=c.pop(),m=p.score,v=p.boxIndex,g=p.suppressBeginIndex;if(m<a)break;for(var y=!1,_=f.length-1;_>=g;--_){var b=Cc(e,v,f[_]);if(b>=r){y=!0;break}if(p.score=p.score*Sc(r,h,b),p.score<=a)break}p.suppressBeginIndex=f.length,y||(p.score===m?(f.push(v),d.push(p.score)):p.score>a&&yc(c,p,Tc))}var k=f.length,w=n-k;s&&w>0&&(f.push.apply(f,_toConsumableArray(new Array(w).fill(0))),d.push.apply(d,_toConsumableArray(new Array(w).fill(0))));var x={selectedIndices:Fs(f,"int32")};return o&&(x.selectedScores=Fs(d,"float32")),u&&(x.validOutputs=Pa(k,"int32")),x}function Cc(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),f=Math.max(a[1],a[3]),d=(s-i)*(u-o),p=(h-c)*(f-l);if(d<=0||p<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,h),y=Math.min(u,f),_=Math.max(g-m,0)*Math.max(y-v,0);return _/(d+p-_)}function Sc(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Tc(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}var Ac=Gt({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Ut(e,"boxes","nonMaxSuppression"),s=Ut(t,"scores","nonMaxSuppression"),u=vc(o,s,n,r,a,i),c=Mt.runKernel("NonMaxSuppressionV5",{boxes:o,scores:s},{maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma});return{selectedIndices:c[0],selectedScores:c[1]}}}),Ec=Gt({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Ut(e,"boxes","nonMaxSuppression"),s=Ut(t,"scores","nonMaxSuppression"),u=vc(o,s,n,r,a,null),c=Mt.runKernel("NonMaxSuppressionV4",{boxes:o,scores:s},{maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:i});return{selectedIndices:c[0],validOutputs:c[1]}}}),Ic=Gt({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ut(e,"images","resizeBilinear");J(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(r.rank,".")})),J(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var a=r,i=!1;3===r.rank&&(i=!0,a=fr(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var o=_slicedToArray2(t,2),s=o[0],u=o[1],c=Mt.runKernelFunc((function(e,t){return t([a]),e.resizeBilinear(a,s,u,n)}),{images:a},null,"ResizeBilinear",{alignCorners:n,size:t});return i?fr(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),Rc=Gt({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ut(e,"images","resizeNearestNeighbor");J(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(r.rank,".")})),J(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),J("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var a=r,i=!1;3===r.rank&&(i=!0,a=fr(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var o=_slicedToArray2(t,2),s=o[0],u=o[1],c=Mt.runKernelFunc((function(e,t){return t([a]),e.resizeNearestNeighbor(a,s,u,n)}),{images:a},null,"ResizeNearestNeighbor",{alignCorners:n,size:t});return i?fr(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),Oc=Gt({bandPart_:function(e,t,n){J(t%1==0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),J(n%1==0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=Ut(e,"a","bandPart");J(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=_slicedToArray2(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(t<=o))throw new Error("bandPart(): numLower (".concat(t,") must not be greater than the number of rows (").concat(o,")."));if(!(n<=s))throw new Error("bandPart(): numUpper (".concat(n,") must not be greater than the number of columns (").concat(s,")."));t<0&&(t=o),n<0&&(n=s);var u=fr(Ms(0,o,1,"int32"),[-1,1]),c=Ms(0,s,1,"int32"),l=ja(u,c),h=Zo(Bo(l,Pa(+t,"int32")),No(l,Pa(-n,"int32"))),f=as([o,s],r.dtype);return fr(fu(Cu(fr(r,[-1,o,s])).map((function(e){return po(h,e,f)}))),a)}}),Nc=Gt({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,J(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){J(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: (".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=uu(e,e.shape[0],0).map((function(e){return hu(e,[0])}))),J(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds number of dimensions (").concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(Mt.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=xa(Xo(xa(n[a],t)),n[a]);t=ja(t,i)}return wa(t,Wu(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?fu(n,0):n}});function Dc(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Mt.tidy((function(){J(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=xo(n),i=Wn(e),o=vu([[1]],[1,1]),s=Wn(o),u=n>=r?r:n,c=function(e){var t,u=i,c=s,l=a;t=_slicedToArray2(Mt.tidy((function(){var t=Mi(i,[e,e],[n-e,1]),u=Wu(t),c=Mi(i,[e,e],[1,1]),l=po(Oo(c,0),vu([[-1]]),vu([[1]])),h=ja(c,xa(l,u)),f=wa(t,h);s=1===f.shape[0]?Wn(o):Pi([o,Mi(f,[1,0],[f.shape[0]-1,f.shape[1]])],0);var d=Wo(wa(dr(l,h),u)),p=Mi(i,[e,0],[n-e,r]),m=xa(d,s),v=mr(s);if(0===e)i=ja(p,dr(m,dr(v,p)));else{var g=ja(p,dr(m,dr(v,p)));i=Pi([Mi(i,[0,0],[e,r]),g],0)}var y=mr(m),_=Mi(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=ja(_,dr(dr(_,s),y));else{var b=ja(_,dr(dr(_,s),y));a=Pi([Mi(a,[0,0],[n,e]),b],1)}return[s,i,a]})),3),s=t[0],i=t[1],a=t[2],ua([u,c,l])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=Mi(a,[0,0],[n,r]),i=Mi(i,[0,0],[r,r])),[a,i]}))}var Pc,Fc=Gt({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(J(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank "+e.rank})),2===e.rank)return Dc(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=Cu(fr(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=_slicedToArray2(Dc(e,t),2),r=n[0],o=n[1];a.push(r),i.push(o)})),[fr(fu(a,0),e.shape),fr(fu(i,0),e.shape)]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Pc||(Pc={}));var Mc,Lc,zc,Bc=Gt({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pc.SUM_BY_NONZERO_WEIGHTS,r=Ut(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=Ut(t,"weights","computeWeightedLoss"));var i=null==a?r:xa(r,a);if(n===Pc.NONE)return i;if(n===Pc.SUM)return Xo(i);if(n===Pc.MEAN){if(null==a)return os(i);var o=r.size/a.size,s=wa(Xo(i),Xo(a));return o>1?wa(s,Pa(o)):s}if(n===Pc.SUM_BY_NONZERO_WEIGHTS){if(null==a)return wa(Xo(i),Pa(r.size));var u=xa(a,is(r.shape)),c=Un(Xo(ps(u,Pa(0))),"float32");return wa(Xo(i),c)}throw Error("Unknown reduction: "+n)}}),jc=Gt({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Pc.SUM_BY_NONZERO_WEIGHTS,a=Ut(e,"labels","absoluteDifference"),i=Ut(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=Ut(n,"weights","absoluteDifference")),$(a.shape,i.shape,"Error in absoluteDifference: ");var s=qa(ja(a,i));return Bc(s,o,r)}}),Vc=Gt({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pc.SUM_BY_NONZERO_WEIGHTS,i=Ut(e,"labels","cosineDistance"),o=Ut(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Ut(r,"weights","cosineDistance")),$(i.shape,o.shape,"Error in cosineDistance: ");var u=Pa(1),c=ja(u,Xo(xa(i,o),n,!0));return Bc(c,s,a)}}),qc=Gt({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Pc.SUM_BY_NONZERO_WEIGHTS,a=Ut(e,"labels","hingeLoss"),i=Ut(t,"predictions","hingeLoss"),o=null;null!=n&&(o=Ut(n,"weights","hingeLoss")),$(a.shape,i.shape,"Error in hingeLoss: ");var s=Pa(1);a=ja(xa(Pa(2),a),s);var u=zs(ja(s,xa(a,i)));return Bc(u,o,r)}}),Uc=Gt({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pc.SUM_BY_NONZERO_WEIGHTS,i=Ut(e,"labels","huberLoss"),o=Ut(t,"predictions","huberLoss"),s=null;null!=n&&(s=Ut(n,"weights","huberLoss")),$(i.shape,o.shape,"Error in huberLoss: ");var u=Pa(r),c=qa(ja(o,i)),l=us(c,u),h=ja(c,l),f=ba(xa(Pa(.5),Sa(l)),xa(u,h));return Bc(f,s,a)}}),Wc=Gt({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pc.SUM_BY_NONZERO_WEIGHTS,i=Ut(e,"labels","logLoss"),o=Ut(t,"predictions","logLoss"),s=null;null!=n&&(s=Ut(n,"weights","logLoss")),$(i.shape,o.shape,"Error in logLoss: ");var u=Pa(1),c=Pa(r),l=Wo(xa(i,qo(ba(o,c)))),h=xa(ja(u,i),qo(ba(ja(u,o),c))),f=ja(l,h);return Bc(f,s,a)}}),Gc=Gt({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Pc.SUM_BY_NONZERO_WEIGHTS,a=Ut(e,"labels","meanSquaredError"),i=Ut(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=Ut(n,"weights","meanSquaredError")),$(a.shape,i.shape,"Error in meanSquaredError: ");var s=lu(a,i);return Bc(s,o,r)}}),Hc=Gt({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pc.SUM_BY_NONZERO_WEIGHTS,i=Ut(e,"multiClassLabels","sigmoidCrossEntropy"),o=Ut(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Ut(n,"weights","sigmoidCrossEntropy")),$(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Pa(r),c=Pa(1),l=Pa(.5);i=ba(xa(i,ja(c,u)),xa(l,u))}var h=function(e,t){var n=Ut(e,"labels","sigmoidCrossEntropyWithLogits"),r=Ut(t,"logits","sigmoidCrossEntropyWithLogits");$(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=zs(r),i=xa(r,n),o=Uo(_o(Wo(qa(r))));return ba(ja(a,i),o)}(i,o);return Bc(h,s,a)}}),Kc=Gt({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Pc.SUM_BY_NONZERO_WEIGHTS,i=Ut(e,"onehotLabels","softmaxCrossEntropy"),o=Ut(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Ut(n,"weights","softmaxCrossEntropy")),$(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Pa(r),c=Pa(1),l=Pa(i.shape[1]);i=ba(xa(i,ja(c,u)),wa(u,l))}var h=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ".concat(t.rank," and dim was ")+n);return Na((function(e,t,r){var a=Yo(t,[n],!0),i=ja(Un(t,"float32"),a);r([e,i]);var o=Wo(xa(i,e));return{value:Xo(o,[n]),gradFunc:function(e,t){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=ri(e.shape,[n]);return[xa(fr(e,o),ja(Un(a,"float32"),_o(i))),xa(fr(e,o),ja(_o(i),Un(a,"float32")))]}}}))(e,t)}(i,o);return Bc(h,s,a)}}),Xc={fft:au,ifft:iu,rfft:cu,irfft:ou},Qc={hammingWindow:cc,hannWindow:lc,frame:hc,stft:fc},Yc={flipLeftRight:pc,resizeNearestNeighbor:Rc,resizeBilinear:Ic,rotateWithOffset:mc,cropAndResize:dc,nonMaxSuppression:gc,nonMaxSuppressionAsync:(zc=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.length>3&&void 0!==h[3]?h[3]:.5,i=h.length>4&&void 0!==h[4]?h[4]:Number.NEGATIVE_INFINITY,o=Ut(t,"boxes","nonMaxSuppressionAsync"),s=Ut(n,"scores","nonMaxSuppressionAsync"),u=vc(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=6,Promise.all([o.data(),s.data()]);case 6:return c=e.sent,l=bc(c[0],c[1],r,a,i),e.abrupt("return",(o!==t&&o.dispose(),s!==n&&s.dispose(),l));case 9:case"end":return e.stop()}}),e)}))),function(e,t,n){return zc.apply(this,arguments)}),nonMaxSuppressionWithScore:Ac,nonMaxSuppressionWithScoreAsync:(Lc=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.length>3&&void 0!==f[3]?f[3]:.5,i=f.length>4&&void 0!==f[4]?f[4]:Number.NEGATIVE_INFINITY,o=f.length>5&&void 0!==f[5]?f[5]:0,s=Ut(t,"boxes","nonMaxSuppressionAsync"),u=Ut(n,"scores","nonMaxSuppressionAsync"),c=vc(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=7,Promise.all([s.data(),u.data()]);case 7:return l=e.sent,h=wc(l[0],l[1],r,a,i,o),e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),h));case 10:case"end":return e.stop()}}),e)}))),function(e,t,n){return Lc.apply(this,arguments)}),nonMaxSuppressionPadded:Ec,nonMaxSuppressionPaddedAsync:(Mc=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,f,d,p,m,v,g,y=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=y.length>3&&void 0!==y[3]?y[3]:.5,i=y.length>4&&void 0!==y[4]?y[4]:Number.NEGATIVE_INFINITY,o=y.length>5&&void 0!==y[5]&&y[5],s=Ut(t,"boxes","nonMaxSuppressionAsync"),u=Ut(n,"scores","nonMaxSuppressionAsync"),c=vc(s,u,r,a,i,null),l=c.maxOutputSize,h=c.iouThreshold,f=c.scoreThreshold,e.next=11,Promise.all([s.data(),u.data()]);case 11:return d=e.sent,p=_slicedToArray2(d,2),m=p[0],v=p[1],g=kc(m,v,l,h,f,o),e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),g));case 17:case"end":return e.stop()}}),e)}))),function(e,t,n){return Mc.apply(this,arguments)})},Zc={bandPart:Oc,gramSchmidt:Nc,qr:Fc},Jc={absoluteDifference:jc,computeWeightedLoss:Bc,cosineDistance:Vc,hingeLoss:qc,huberLoss:Uc,logLoss:Wc,meanSquaredError:Gc,sigmoidCrossEntropy:Hc,softmaxCrossEntropy:Kc},$c=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,null,[{key:"sgd",value:function(e){return new Xa(e)}},{key:"momentum",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Qa(e,t,n)}},{key:"rmsprop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new Ya(e,t,n,r,a)}},{key:"adam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Va(e,t,n,r)}},{key:"adadelta",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Ma(e,t,n)}},{key:"adamax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new Ka(e,t,n,r,a)}},{key:"adagrad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return new za(e,t)}}]),e}(),el={sgd:$c.sgd,momentum:$c.momentum,adadelta:$c.adadelta,adagrad:$c.adagrad,rmsprop:$c.rmsprop,adamax:$c.adamax,adam:$c.adam},tl="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function nl(){return new Promise((function(e){return tl((function(){return e()}))}))}function rl(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function al(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function il(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2==1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function ol(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];a.push(r?e[0]/n:e[0]*n);for(var i=1;i<e.length;++i)a.push(i<=t.length?r?t[i-1]*e[i]:e[i]/t[i-1]:e[i]);return a}function sl(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function ul(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var cl=1.7580993408473768,ll=1.0507009873554805,hl=.3275911,fl=.254829592,dl=-.284496736,pl=1.421413741,ml=-1.453152027,vl=1.061405429;function gl(){var e;ze().getBool("IS_TEST")||(e=console).warn.apply(e,arguments)}function yl(){var e;ze().getBool("IS_TEST")||(e=console).log.apply(e,arguments)}function _l(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function bl(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function kl(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function wl(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function xl(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Cl(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Sl(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function Tl(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Al(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=as(e.shape),a=Un(e,"float32"),i=n.complex(a,r);return r.dispose(),a.dispose(),i}if(!ye(e.dtype,t))return Mt.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var o=n.real(e),s=Un(o,t);return o.dispose(),s}if("int32"===t)return n.int(e);if("bool"===t){var u=Pa(0,e.dtype),c=n.notEqual(e,u);return u.dispose(),c}throw new Error("Error in Cast: failed to cast ".concat(e.dtype," to ").concat(t))}function El(e,t){return Mt.makeTensorFromDataId(e.dataId,t,e.dtype)}function Il(e,t,n){var r=(t-e)/(n-1),a=Oe(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return Fs(a,"float32")}function Rl(e,t,n){var r=new Array(e.rank).fill(0),a=e.shape.slice();return t.map((function(t){var i=_toConsumableArray(a);i[n]=t;var o=Mi(e,r,i);return r[n]+=t,o}))}function Ol(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=qn(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a.toTensor()}function Nl(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=pe(n,o*r),c=pe("int32",o*r),l=0;l<o;l++){for(var h=l*s,f=e.subarray(h,h+s),d=[],p=0;p<f.length;p++)d.push({value:f[p],index:p});d.sort((function(e,t){return t.value-e.value}));for(var m=l*r,v=u.subarray(m,m+r),g=c.subarray(m,m+r),y=0;y<r;y++)v[y]=d[y].value,g[y]=d[y].index}var _=t.slice();return _[_.length-1]=r,[Xt(u,_,n),Xt(c,_,"int32")]}var Dl={kernelName:"Abs",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return xa(e,du(Un(n,"float32"),-1))}}}},Pl={kernelName:"Acos",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){var t=Sa(Un(n,"float32")),r=Ca(ja(Pa(1),t));return Wo(wa(e,r))}}}},Fl={kernelName:"Acosh",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){var t=Ca(ja(Sa(Un(n,"float32")),1));return wa(e,t)}}}},Ml={kernelName:"Add",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Ga(r.shape,a.shape);return{a:function(){var t=e,n=Wa(r.shape,i);return n.length>0&&(t=Xo(t,n)),fr(t,r.shape)},b:function(){var t=e,n=Wa(a.shape,i);return n.length>0&&(t=Xo(t,n)),fr(t,a.shape)}}}},Ll={kernelName:"ArgMax",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return Ta(n)}}}},zl={kernelName:"ArgMin",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return Ta(n)}}}},Bl={kernelName:"Asin",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wa(e,Ca(ja(Pa(1),Sa(Un(n,"float32")))))}}}},jl={kernelName:"Asinh",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){var t=Ca(ba(Pa(1),Sa(Un(n,"float32"))));return wa(e,t)}}}},Vl={kernelName:"Atan2",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Ga(r.shape,a.shape);return{a:function(){var t=ba(Sa(r),Sa(a)),n=xa(e,wa(a,t)),o=Wa(r.shape,i);return o.length>0&&(n=Xo(n,o)),fr(n,r.shape)},b:function(){var t=ba(Sa(r),Sa(a)),n=Wo(xa(e,wa(r,t))),o=Wa(a.shape,i);return o.length>0&&(n=Xo(n,o)),fr(n,a.shape)}}}},ql={kernelName:"Atan",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wa(e,ba(Sa(Un(n,"float32")),1))}}}},Ul={kernelName:"Atanh",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wa(e,ja(Pa(1),Sa(Un(n,"float32"))))}}}},Wl=Gt({avgPool3dBackprop_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1],i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=Ut(e,"dy","avgPool3dBackprop"),u=Ut(t,"input","avgPool3dBackprop"),c=s,l=u,h=!1;4===u.rank&&(h=!0,c=fr(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),l=fr(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),J(5===c.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."})),J(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."})),J(Ei(r,a),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides ".concat(r," and dilations '").concat(a,"'")})),null!=o&&J(ie(i),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")}));var f=Mt.runKernelFunc((function(e){var t=_i(l.shape,n,r,a,i,o);return e.avgPool3dBackprop(c,l,t)}),{dy:c,input:l},null,"AvgPool3DBackprop",{filterSize:n,strides:r,dilations:a,pad:i,dimRoundingMode:o});return h?fr(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),Gl={kernelName:"AvgPool3D",inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.filterSize,i=n.strides,o=n.dilations,s=n.pad,u=n.dimRoundingMode,c=null==o?[1,1,1]:o;return{x:function(){return Wl(e,r,a,i,c,s,u)}}}},Hl=Gt({avgPoolBackprop_:function(e,t,n,r,a){var i=Ut(e,"dy","avgPoolBackprop"),o=Ut(t,"input","avgPoolBackprop");J(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=fr(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=fr(i,[1,i.shape[0],i.shape[1],i.shape[2]])),J(4===u.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),J(4===s.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+s.rank+"."}));var l=Mt.runKernelFunc((function(e){var t=yi(s.shape,n,r,1,a);return e.avgPoolBackprop(u,s,t)}),{dy:u,input:s},null,"AvgPoolBackprop",{filterSize:n,strides:r,pad:a});return c?fr(l,[l.shape[1],l.shape[2],l.shape[3]]):l}}),Kl={kernelName:"AvgPool",inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return Hl(e,r,a,i,o)}}}},Xl={kernelName:"BatchMatMul",inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return dr(e,i,!1,!1)},b:function(){return dr(e,a,!0,!1)}}:o&&!s?{a:function(){return dr(i,e,!1,!0)},b:function(){return dr(a,e,!1,!1)}}:{a:function(){return dr(i,e,!0,!0)},b:function(){return dr(e,a,!0,!0)}}:{a:function(){return dr(e,i,!1,!0)},b:function(){return dr(a,e,!0,!1)}}}},Ql={kernelName:"BatchToSpaceND",gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return xs(e,r,a)}}}},Yl={kernelName:"BroadcastTo",gradFunc:function(e,t,n){for(var r=n.inputShape,a=n.shape,i=Array.from(a),o=r.length-1;o>=0;o--)if(r[o]===a[o])i[o]=1;else if(1!==r[o])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(a,"]."));for(var s=[],u=0;u<i.length;u++)i[u]>1&&s.push(u);return{x:function(){return Xo(e,s,!0)}}}},Zl={kernelName:"Ceil",gradFunc:function(e){return{x:function(){return Ta(e)}}}},Jl={kernelName:"ClipByValue",inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return po(Zo(No(r,a),Bo(r,i)),e,Ta(e))}}}},$l={kernelName:"Concat",saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=fe(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return uu(e,i,a).map((function(e){return function(){return e}}))}},eh={kernelName:"Conv2D",inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return J(Ai(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return eo(a.shape,e,i,s,u,c)},filter:function(){return $u(a,e,i.shape,s,u,c)}}}},th={kernelName:"Conv2DBackpropInput",inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return Ji(e,i,o,s,u,1,c)},filter:function(){return $u(e,a,i.shape,o,s,u,c)}}}},nh=Gt({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=fr(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;return 4===o.rank&&(o=fr(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),J(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."})),J(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+o.shape+"."})),J(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),J(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must match input depth in filter (").concat(n[3],".")})),J(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must match output depth for filter (").concat(n[4],").")})),Mt.runKernelFunc((function(e){var t=ki(i.shape,n,r,1,a);return e.conv3dDerFilter(i,o,t)}),{x:i,dy:o},null,"Conv3DBackpropFilterV2",{strides:r,pad:a,filterShape:n})}}),rh={kernelName:"Conv3D",inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;J(Ai(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=_slicedToArray2(t,2),s=o[0],u=o[1];return{x:function(){return ro(s.shape,e,u,a,i)},filter:function(){return nh(s,e,u.shape,a,i)}}}},ah={kernelName:Ue,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return xa(Wo(Zs(Un(n,"float32"))),e)}}}},ih={kernelName:"Cosh",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return xa(Js(Un(n,"float32")),e)}}}},oh={kernelName:"Cumsum",inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=ii([a],r.rank),n=so(e,a,i,!o);return null!=t&&(n=mr(n,t)),n}}}},sh={kernelName:"DepthwiseConv2dNative",inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;J(Ai(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '".concat(s,"'")}));var u=_slicedToArray2(t,2),c=u[0],l=u[1];return J(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ".concat(c.rank,".")})),J(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ".concat(l.rank,".")})),J(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input channels (".concat(c.shape[3],") must match the inChannels dimension in filter ").concat(l.shape[2],".")})),J(Ei(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ".concat(a," and dilations '").concat(s,"'.")})),null!=o&&J(ie(i),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")})),{x:function(){return oc(c.shape,e,l,a,i,r,o)},filter:function(){return ic(c,e,l.shape,a,i,r,o)}}}},uh={kernelName:"Dilation2D",inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return Mt.runKernel("Dilation2DBackpropInput",o,n)},filter:function(){return Mt.runKernel("Dilation2DBackpropFilter",s,n)}}}},ch={kernelName:We,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Ga(r.shape,a.shape);return{a:function(){var t=wa(e,Un(a,"float32")),n=Wa(r.shape,i);return n.length>0?fr(Xo(t,n),r.shape):t},b:function(){var t=xa(e,Un(r,"float32")),n=Wa(a.shape,i);n.length>0&&(t=fr(Xo(t,n),a.shape));var o=Sa(a);return Wo(wa(t,Un(o,"float32")))}}}},lh={kernelName:"Elu",outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0],r=function(t){return t.eluDer(e,n)},a={dy:e,y:n};return{x:function(){return Mt.runKernelFunc(r,a,null,"EluGrad")}}}},hh={kernelName:"Erf",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0],r=xa(_o(Wo(Sa(n))),2/Math.sqrt(Math.PI));return{x:function(){return xa(e,r)}}}},fh={kernelName:"Exp",outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return xa(e,n)}}}},dh={kernelName:"Expm1",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return xa(e,_o(n))}}}},ph={kernelName:"Floor",gradFunc:function(e){return{x:function(){return Ta(e)}}}},mh={kernelName:"FloorDiv",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Ga(r.shape,a.shape);return{a:function(){var t=wa(e,Un(a,"float32")),n=Wa(r.shape,i);return n.length>0?fr(Xo(t,n),r.shape):t},b:function(){var t=xa(e,Un(r,"float32")),n=Wa(a.shape,i);n.length>0&&(t=fr(Xo(t,n),a.shape));var o=Sa(a);return Wo(wa(t,Un(o,"float32")))}}}},vh={kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=_slicedToArray2(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?Pa(1):u,l=Wa(o.shape,i.shape),h=[];if(1===o.rank){for(var f=0;f<i.shape.length-1;++f)h.push(i.shape[f]);h.push(1)}var d=ja(i,o),p=xa(e,c),m=Hs(ba(s,Pa(r))),v=xa(xa(xa(m,m),m),Pa(-.5));return{x:function(){return fr(xa(xa(e,1===o.rank?wo(fr(m,[1,1,1,o.shape[0]]),h):m),c),i.shape)},mean:function(){var e=xa(xa(m,Pa(-1)),p);return 1===o.rank&&(e=Xo(e,l)),fr(e,o.shape)},variance:function(){var e=xa(xa(v,d),p);return 1===o.rank&&(e=Xo(e,l)),fr(e,o.shape)},scale:function(){var t=xa(d,m),n=xa(e,t);return 1===o.rank&&(n=Xo(n,l)),fr(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=Xo(t,l)),fr(t,o.shape)}}}},gh={kernelName:"GatherV2",inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.axis,s=fe(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,h=yh(0,u),f=yh(u+1,u+1+l),d=_h([r,[n],c]),p=fr(e,d),m=fr(i,[n]),v=_h([[u],h,f]),g=mr(p,v),y=xu(g,m,a.shape[s]),_=oi(v);return y=mr(y,_)},indices:function(){return i}}}};function yh(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function _h(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var bh={kernelName:"GreaterEqual",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1];return{a:function(){return Ta(r)},b:function(){return Ta(a)}}}},kh={kernelName:"Identity",gradFunc:function(e){return{x:function(){return Un(e,"float32")}}}},wh={kernelName:"IsFinite",gradFunc:function(e){return{x:function(){return Ta(e)}}}},xh={kernelName:"IsInf",gradFunc:function(e){return{x:function(){return Ta(e)}}}},Ch={kernelName:"IsNan",gradFunc:function(e){return{x:function(){return Ta(e)}}}},Sh={kernelName:"Log1p",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wa(e,ba(n,1))}}}},Th={kernelName:"Log",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wa(e,Un(n,"float32"))}}}},Ah={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.axis;return{logits:function(){var t=_o(r);return ja(e,xa(Xo(e,a,!0),t))}}}},Eh=Gt({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5;return Mt.runKernelFunc((function(s){return s.LRNGrad(n,e,t,r,a,i,o)}),{x:e,y:t,dy:n},null,"LRNBackprop",{depthRadius:r,bias:a,alpha:i,beta:o})}}),Ih={kernelName:"LRN",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return Eh(a,i,e,o,s,u,c)}}}};function Rh(e,t,n,r){return t.rank<n.rank&&(t=fr(t,ri(t.shape,r))),e.rank<n.rank&&(e=fr(e,ri(e.shape,r))),{x:function(){return xa(e,Un(fo(n,t),e.dtype))}}}for(var Oh,Nh={kernelName:"Max",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=Rh(e,t[1],a,fe(r,a.shape));return{x:function(){return i.x()}}}},Dh={kernelName:"Maximum",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1];return{a:function(){return xa(e,Un(No(r,a),"float32"))},b:function(){return xa(e,Un(zo(r,a),"float32"))}}}},Ph=Gt({maxPool3dBackprop_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,u=Ut(e,"dy","maxPool3dBackprop"),c=Ut(t,"input","maxPool3dBackprop"),l=Ut(n,"output","maxPool3dBackprop"),h=u,f=c,d=l,p=!1;4===c.rank&&(p=!0,h=fr(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),f=fr(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),d=fr(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),J(5===h.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+h.rank+"."})),J(5===f.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+f.rank+"."})),J(5===d.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+d.rank+"."})),J(Ei(a,i),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(i,"'")})),null!=s&&J(ie(o),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode ".concat(s," but got pad ").concat(o,".")}));var m=Mt.runKernelFunc((function(e){var t=_i(f.shape,r,a,i,o,s);return e.maxPool3dBackprop(h,f,d,t)}),{dy:h,input:f,output:d},null,"MaxPool3DBackprop",{filterSize:r,strides:a,dilations:i,pad:o,dimRoundingMode:s});return p?fr(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),Fh={kernelName:"MaxPool3D",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.dilations,c=n.pad,l=n.dimRoundingMode,h=null==u?[1,1,1]:u;return{x:function(){return Ph(e,a,i,o,s,h,c,l)}}}},Mh=Gt({maxPoolBackprop_:function(e,t,n,r,a,i,o){var s=Ut(e,"dy","maxPoolBackprop"),u=Ut(t,"input","maxPoolBackprop"),c=Ut(n,"output","maxPoolBackprop");return J(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy (").concat(s.rank,")")})),J(4===s.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+s.rank+"."})),J(4===u.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+u.rank+"."})),null!=o&&J(ie(i),(function(){return"Error in maxPoolBackprop: pad must be an integer when using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")})),Mt.runKernelFunc((function(e){var t=yi(u.shape,r,a,1,i,o);return e.maxPoolBackprop(s,u,c,t)}),{dy:s,input:u,output:c},null,"MaxPoolBackprop",{filterSize:r,strides:a,pad:i,dimRoundingMode:o})}}),Lh={kernelName:"PadV2",inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Mi(e,a,r.shape)}}}},zh={kernelName:"SpaceToBatchND",gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return Bi(e,r,a)}}}},Bh={kernelName:"SplitV",gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return Pi(e,r)}}}},jh=0,Vh=[Dl,Pl,Fl,Ml,{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},Ll,zl,Bl,jl,Vl,ql,Ul,Gl,Kl,Xl,Ql,Yl,{kernelName:"Cast",gradFunc:function(e){return{x:function(){return e.clone()}}}},Zl,Jl,$l,th,eh,rh,ah,ih,oh,sh,uh,ch,lh,hh,fh,dh,mh,ph,vh,gh,bh,kh,wh,xh,Ch,Sh,Th,Ah,Ih,Nh,Nh,Dh,Fh,{kernelName:"MaxPool",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray2(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return Mh(e,a,i,o,s,u)}}}},{kernelName:"Min",inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=_slicedToArray2(t,2),i=a[0],o=Rh(e,a[1],i,fe(r,i.shape));return{x:function(){return o.x()}}}},{kernelName:"Minimum",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1];return{a:function(){return xa(e,Un(Bo(r,a),"float32"))},b:function(){return xa(e,Un(Oo(r,a),"float32"))}}}},{kernelName:"MirrorPad",inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Mi(e,a,r.shape)}}}},{kernelName:"Mod",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Ga(r.shape,a.shape);return{a:function(){var t=Wa(r.shape,i);return t.length>0?fr(Xo(e,t),r.shape):e},b:function(){var t=xa(e,Wo(Co(wa(r,a)))),n=Wa(a.shape,i);return n.length>0?fr(Xo(t,n),a.shape):t}}}},{kernelName:"Multiply",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Ga(r.shape,a.shape);return{a:function(){var t=xa(e,Un(a,"float32")),n=Wa(r.shape,i);return n.length>0?fr(Xo(t,n),r.shape):t},b:function(){var t=xa(e,Un(r,"float32")),n=Wa(a.shape,i);return n.length>0?fr(Xo(t,n),a.shape):t}}}},{kernelName:"Negate",gradFunc:function(e){return{x:function(){return Wo(e)}}}},{kernelName:"OneHot",inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return as(n.shape,"float32")}}}},{kernelName:"OnesLike",gradFunc:function(e){return{x:function(){return Ta(e)}}}},Lh,Lh,{kernelName:"Pow",inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray2(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=Ga(o.shape,s.shape);return{a:function(){var t=Un(s,"float32"),n=xa(e,xa(t,Ba(o,ja(t,Pa(1))))),r=Wa(o.shape,u);return r.length>0&&(n=Xo(n,r)),fr(n,o.shape)},b:function(){var t=Oo(o,0),n=po(t,qo(o),Ta(o)),r=xa(e,xa(i,n)),a=Wa(s.shape,u);return a.length>0&&(r=Xo(r,a)),fr(r,s.shape)}}}},{kernelName:"Prelu",inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Oo(r,0);return{x:function(){return po(i,e,xa(e,a))},alpha:function(){var t=po(i,Ta(e),xa(e,r)),n=Wa(a.shape,e.shape);return n.length>0&&(t=Xo(t,n)),fr(t,a.shape)}}}},{kernelName:"Reciprocal",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wa(e,Wo(Sa(n)))}}}},{kernelName:"Relu6",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0],r=xa(Bo(n,6),du(n));return{x:function(){return xa(e,Un(r,"float32"))}}}},{kernelName:"Relu",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return xa(e,Un(du(n),"float32"))}}}},{kernelName:"Reshape",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return fr(e,n.shape)}}}},{kernelName:"ResizeBilinear",inputsToSave:["images"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=function(t){var a=n.alignCorners;return t.resizeBilinearBackprop(e,r,a)},i={images:r};return{images:function(){return Mt.runKernelFunc(a,i,null,"ResizeBilinearGrad",n)}}}},{kernelName:"ResizeNearestNeighbor",inputsToSave:["images"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=function(t){var a=n.alignCorners;return t.resizeNearestNeighborBackprop(e,r,a)},i={images:r};return{images:function(){return Mt.runKernelFunc(a,i,null,"ResizeNearestNeighborGrad",n)}}}},{kernelName:"Reverse",gradFunc:function(e,t,n){var r=fe(n.dims,e.shape);return{x:function(){return js(e,r)}}}},{kernelName:"Round",gradFunc:function(e){return{x:function(){return Ta(e)}}}},{kernelName:"Rsqrt",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return Wo(wa(e,xa(Ba(n,1.5),2)))}}}},{kernelName:"SelectV2",inputsToSave:["condition"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{condition:function(){return Un(Ta(n),"float32")},t:function(){return xa(e,Un(n,e.dtype))},e:function(){return xa(e,Un(Jo(n),e.dtype))}}}},{kernelName:"Selu",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){var t=Oo(n,Pa(0)),r=Pa(cl),a=Pa(ll),i=xa(e,a),o=xa(xa(e,r),_o(Un(n,"float32")));return po(t,i,o)}}}},{kernelName:"Sigmoid",outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return xa(e,xa(n,ja(Pa(1),n)))}}}},{kernelName:"Sign",gradFunc:function(e){return{x:function(){return Ta(e)}}}},{kernelName:Ge,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return xa(io(Un(n,"float32")),e)}}}},{kernelName:"Sinh",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return xa(oo(Un(n,"float32")),e)}}}},{kernelName:"Slice",inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=_slicedToArray2(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=_slicedToArray2(Br(r,a,i),2),u=s[0],c=s[1],l=[],h=0;h<e.rank;h++)l.push([u[h],o[h]-u[h]-c[h]]);return{x:function(){return ys(e,l)}}}},{kernelName:"Softmax",outputsToSave:[!0],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.dim,i=xa(e,r);return{logits:function(){return ja(i,xa(Xo(i,[a],!0),r))}}}},{kernelName:"Softplus",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return xa(e,Fi(n))}}}},zh,zh,Bh,Bh,{kernelName:"Sqrt",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wa(e,xa(Ca(Un(n,"float32")),2))}}}},{kernelName:"SquaredDifference",inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Pa(2);return{a:function(){return xa(e,xa(i,ja(r,a)))},b:function(){return xa(e,xa(i,ja(a,r)))}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return xa(e,xa(Un(n,"float32"),2))}}}},{kernelName:"Step",gradFunc:function(e){return{x:function(){return Ta(e)}}}},{kernelName:He,inputsToSave:["a","b"],gradFunc:function(e,t){var n=_slicedToArray2(t,2),r=n[0],a=n[1],i=Ga(r.shape,a.shape);return{a:function(){var t=e,n=Wa(r.shape,i);return n.length>0&&(t=Xo(t,n)),fr(t,r.shape)},b:function(){var t=e,n=Wa(a.shape,i);return n.length>0&&(t=Xo(t,n)),fr(Wo(t),a.shape)}}}},{kernelName:"Sum",inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=r.shape.slice();fe(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=fr(e,a),o=xa(i,is(r.shape,"float32"));return{x:function(){return o}}}},{kernelName:Ke,inputsToSave:["x"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return wa(e,Sa(io(n)))}}}},{kernelName:"Tanh",outputsToSave:[!0],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return xa(ja(Pa(1),Sa(n)),e)}}}},{kernelName:"Tile",inputsToSave:["x"],gradFunc:function(e,t,n){var r=_slicedToArray2(t,1)[0],a=n.reps;return{x:function(){var t=Ta(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=ba(t,Mi(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=ba(t,Mi(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=ba(t,Mi(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(var l=0;l<a[0];++l)for(var h=0;h<a[1];++h)for(var f=0;f<a[2];++f)for(var d=0;d<a[3];++d)t=ba(t,Mi(e,[l*r.shape[0],h*r.shape[1],f*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},{kernelName:"Transpose",gradFunc:function(e,t,n){var r=oi(n.perm);return{x:function(){return mr(e,r)}}}},{kernelName:"Unpack",gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return fu(e,r)}}}},{kernelName:"UnsortedSegmentSum",inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=_slicedToArray2(t,1)[0];return{x:function(){return function(e,t){for(var n=Ha(t,Ta(t)),r=Ro(e,n),a=No(t,Pa(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=bo(a,o+1);a=Zo(a,is(r.shape,"bool"));var s=Ta(r);return po(a,r,s)}(e,n)}}}},{kernelName:"ZerosLike",gradFunc:function(e){return{x:function(){return Ta(e)}}}}];jh<Vh.length;jh++){et(Vh[jh])}function qh(){return null==Oh&&(Oh=ya().epsilon()),Oh}_t.prototype.abs=function(){return this.throwIfDisposed(),qa(this)},_t.prototype.acos=function(){return this.throwIfDisposed(),Za(this)},_t.prototype.acosh=function(){return this.throwIfDisposed(),Ja(this)},_t.prototype.addStrict=function(e){return this.throwIfDisposed(),Fu(this,e)},_t.prototype.add=function(e){return this.throwIfDisposed(),ba(this,e)},_t.prototype.all=function(e,t){return this.throwIfDisposed(),ui(this,e,t)},_t.prototype.any=function(e,t){return this.throwIfDisposed(),ci(this,e,t)},_t.prototype.argMax=function(e){return this.throwIfDisposed(),li(this,e)},_t.prototype.argMin=function(e){return this.throwIfDisposed(),hi(this,e)},_t.prototype.asScalar=function(){return this.throwIfDisposed(),J(1===this.size,(function(){return"The array must have only 1 element."})),fr(this,[])},_t.prototype.asType=function(e){return this.throwIfDisposed(),Un(this,e)},_t.prototype.as1D=function(){return this.throwIfDisposed(),fr(this,[this.size])},_t.prototype.as2D=function(e,t){return this.throwIfDisposed(),fr(this,[e,t])},_t.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),fr(this,[e,t,n])},_t.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),fr(this,[e,t,n,r])},_t.prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),fr(this,[e,t,n,r,a])},_t.prototype.asin=function(){return this.throwIfDisposed(),fi(this)},_t.prototype.asinh=function(){return this.throwIfDisposed(),di(this)},_t.prototype.atan=function(){return this.throwIfDisposed(),pi(this)},_t.prototype.atan2=function(e){return this.throwIfDisposed(),mi(this,e)},_t.prototype.atanh=function(){return this.throwIfDisposed(),vi(this)},_t.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Ri(this,e,t,n,r)},_t.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Bi(this,e,t)},_t.prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),Vi(this,e,t,n,r,a)},_t.prototype.broadcastTo=function(e){return this.throwIfDisposed(),Gi(this,e)},_t.prototype.cast=function(e){return this.throwIfDisposed(),Un(this,e)},_t.prototype.ceil=function(){return this.throwIfDisposed(),Hi(this)},_t.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Ki(this,e,t)},_t.prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof _t&&(e=[e]),Pi([this].concat(_toConsumableArray(e)),t)},_t.prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),$i(this,e,t,n,r,a,i)},_t.prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),to(this,e,t,n,r,a)},_t.prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Ji(this,e,t,n,r,a,i)},_t.prototype.cos=function(){return this.throwIfDisposed(),io(this)},_t.prototype.cosh=function(){return this.throwIfDisposed(),oo(this)},_t.prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),so(this,e,t,n)},_t.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),uo(this,e,t)},_t.prototype.depthwiseConv2D=function(e,t,n,r,a,i){return na("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),co(this,e,t,n,r,a,i)},_t.prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),co(this,e,t,n,r,a,i)},_t.prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),ho(this,e,t,n,r,a)},_t.prototype.divNoNan=function(e){return this.throwIfDisposed(),mo(this,e)},_t.prototype.divStrict=function(e){return this.throwIfDisposed(),Mu(this,e)},_t.prototype.div=function(e){return this.throwIfDisposed(),wa(this,e)},_t.prototype.dot=function(e){return this.throwIfDisposed(),vo(this,e)},_t.prototype.elu=function(){return this.throwIfDisposed(),go(this)},_t.prototype.equalStrict=function(e){return this.throwIfDisposed(),Iu(this,e)},_t.prototype.equal=function(e){return this.throwIfDisposed(),fo(this,e)},_t.prototype.erf=function(){return this.throwIfDisposed(),yo(this)},_t.prototype.exp=function(){return this.throwIfDisposed(),_o(this)},_t.prototype.expandDims=function(e){return this.throwIfDisposed(),bo(this,e)},_t.prototype.expm1=function(){return this.throwIfDisposed(),ko(this)},_t.prototype.fft=function(){return this.throwIfDisposed(),au(this)},_t.prototype.flatten=function(){return this.throwIfDisposed(),fr(this,[this.size])},_t.prototype.floor=function(){return this.throwIfDisposed(),Co(this)},_t.prototype.floorDiv=function(e){return this.throwIfDisposed(),ka(this,e)},_t.prototype.gather=function(e,t){return this.throwIfDisposed(),Ro(this,e,t)},_t.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Ru(this,e)},_t.prototype.greaterEqual=function(e){return this.throwIfDisposed(),No(this,e)},_t.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Ou(this,e)},_t.prototype.greater=function(e){return this.throwIfDisposed(),Oo(this,e)},_t.prototype.ifft=function(){return this.throwIfDisposed(),iu(this)},_t.prototype.irfft=function(){return this.throwIfDisposed(),ou(this)},_t.prototype.isFinite=function(){return this.throwIfDisposed(),Po(this)},_t.prototype.isInf=function(){return this.throwIfDisposed(),Fo(this)},_t.prototype.isNaN=function(){return this.throwIfDisposed(),Mo(this)},_t.prototype.leakyRelu=function(e){return this.throwIfDisposed(),Lo(this,e)},_t.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Nu(this,e)},_t.prototype.lessEqual=function(e){return this.throwIfDisposed(),Bo(this,e)},_t.prototype.lessStrict=function(e){return this.throwIfDisposed(),Du(this,e)},_t.prototype.less=function(e){return this.throwIfDisposed(),zo(this,e)},_t.prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),Vo(this,e,t,n,r)},_t.prototype.logSigmoid=function(){return this.throwIfDisposed(),Ho(this)},_t.prototype.logSoftmax=function(e){return this.throwIfDisposed(),Qo(this,e)},_t.prototype.logSumExp=function(e,t){return this.throwIfDisposed(),Yo(this,e,t)},_t.prototype.log=function(){return this.throwIfDisposed(),qo(this)},_t.prototype.log1p=function(){return this.throwIfDisposed(),Uo(this)},_t.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Zo(this,e)},_t.prototype.logicalNot=function(){return this.throwIfDisposed(),Jo(this)},_t.prototype.logicalOr=function(e){return this.throwIfDisposed(),$o(this,e)},_t.prototype.logicalXor=function(e){return this.throwIfDisposed(),es(this,e)},_t.prototype.matMul=function(e,t,n){return this.throwIfDisposed(),dr(this,e,t,n)},_t.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),ts(this,e,t,n,r)},_t.prototype.max=function(e,t){return this.throwIfDisposed(),Ko(this,e,t)},_t.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Lu(this,e)},_t.prototype.maximum=function(e){return this.throwIfDisposed(),Ha(this,e)},_t.prototype.mean=function(e,t){return this.throwIfDisposed(),os(this,e,t)},_t.prototype.min=function(e,t){return this.throwIfDisposed(),ss(this,e,t)},_t.prototype.minimumStrict=function(e){return this.throwIfDisposed(),zu(this,e)},_t.prototype.minimum=function(e){return this.throwIfDisposed(),us(this,e)},_t.prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),cs(this,e,t)},_t.prototype.modStrict=function(e){return this.throwIfDisposed(),Bu(this,e)},_t.prototype.mod=function(e){return this.throwIfDisposed(),ls(this,e)},_t.prototype.mulStrict=function(e){return this.throwIfDisposed(),ju(this,e)},_t.prototype.mul=function(e){return this.throwIfDisposed(),xa(this,e)},_t.prototype.neg=function(){return this.throwIfDisposed(),Wo(this)},_t.prototype.norm=function(e,t,n){return this.throwIfDisposed(),Wu(this,e,t,n)},_t.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Pu(this,e)},_t.prototype.notEqual=function(e){return this.throwIfDisposed(),ps(this,e)},_t.prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),pr(this,e,t,n)},_t.prototype.onesLike=function(){return this.throwIfDisposed(),vs(this)},_t.prototype.pad=function(e,t){return this.throwIfDisposed(),ys(this,e,t)},_t.prototype.pool=function(e,t,n,r,a){return this.throwIfDisposed(),Cs(this,e,t,n,r,a)},_t.prototype.powStrict=function(e){return this.throwIfDisposed(),Vu(this,e)},_t.prototype.pow=function(e){return this.throwIfDisposed(),Ba(this,e)},_t.prototype.prelu=function(e){return this.throwIfDisposed(),Ss(this,e)},_t.prototype.prod=function(e,t){return this.throwIfDisposed(),Ts(this,e,t)},_t.prototype.reciprocal=function(){return this.throwIfDisposed(),Ls(this)},_t.prototype.relu=function(){return this.throwIfDisposed(),zs(this)},_t.prototype.relu6=function(){return this.throwIfDisposed(),Bs(this)},_t.prototype.reshapeAs=function(e){return this.throwIfDisposed(),fr(this,e.shape)},_t.prototype.reshape=function(e){return this.throwIfDisposed(),fr(this,e)},_t.prototype.resizeBilinear=function(e,t){return this.throwIfDisposed(),Ic(this,e,t)},_t.prototype.resizeNearestNeighbor=function(e,t){return this.throwIfDisposed(),Rc(this,e,t)},_t.prototype.reverse=function(e){return this.throwIfDisposed(),js(this,e)},_t.prototype.rfft=function(){return this.throwIfDisposed(),cu(this)},_t.prototype.round=function(){return this.throwIfDisposed(),Gs(this)},_t.prototype.rsqrt=function(){return this.throwIfDisposed(),Hs(this)},_t.prototype.selu=function(){return this.throwIfDisposed(),Ks(this)},_t.prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Xs(this,e,t,n,r,a,i)},_t.prototype.sigmoid=function(){return this.throwIfDisposed(),Fi(this)},_t.prototype.sign=function(){return this.throwIfDisposed(),Ys(this)},_t.prototype.sin=function(){return this.throwIfDisposed(),Zs(this)},_t.prototype.sinh=function(){return this.throwIfDisposed(),Js(this)},_t.prototype.slice=function(e,t){return this.throwIfDisposed(),Mi(this,e,t)},_t.prototype.softmax=function(e){return this.throwIfDisposed(),ru(this,e)},_t.prototype.softplus=function(){return this.throwIfDisposed(),Go(this)},_t.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),xs(this,e,t)},_t.prototype.split=function(e,t){return this.throwIfDisposed(),uu(this,e,t)},_t.prototype.sqrt=function(){return this.throwIfDisposed(),Ca(this)},_t.prototype.square=function(){return this.throwIfDisposed(),Sa(this)},_t.prototype.squaredDifference=function(e){return this.throwIfDisposed(),lu(this,e)},_t.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),qu(this,e)},_t.prototype.squeeze=function(e){return this.throwIfDisposed(),hu(this,e)},_t.prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof _t?[this,e]:[this].concat(_toConsumableArray(e));return fu(n,t)},_t.prototype.step=function(e){return this.throwIfDisposed(),du(this,e)},_t.prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),pu(this,e,t,n,r,a,i,o,s)},_t.prototype.subStrict=function(e){return this.throwIfDisposed(),Uu(this,e)},_t.prototype.sub=function(e){return this.throwIfDisposed(),ja(this,e)},_t.prototype.sum=function(e,t){return this.throwIfDisposed(),Xo(this,e,t)},_t.prototype.tan=function(){return this.throwIfDisposed(),mu(this)},_t.prototype.tanh=function(){return this.throwIfDisposed(),Li(this)},_t.prototype.tile=function(e){return this.throwIfDisposed(),wo(this,e)},_t.prototype.toBool=function(){return this.throwIfDisposed(),Un(this,"bool")},_t.prototype.toFloat=function(){return this.throwIfDisposed(),Un(this,"float32")},_t.prototype.toInt=function(){return this.throwIfDisposed(),Un(this,"int32")},_t.prototype.topk=function(e,t){return this.throwIfDisposed(),bu(this,e,t)},_t.prototype.transpose=function(e){return this.throwIfDisposed(),mr(this,e)},_t.prototype.unique=function(e){return this.throwIfDisposed(),wu(this,e)},_t.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),xu(this,e,t)},_t.prototype.unstack=function(e){return this.throwIfDisposed(),Cu(this,e)},_t.prototype.where=function(e,t){return this.throwIfDisposed(),po(e,this,t)},_t.prototype.zerosLike=function(){return this.throwIfDisposed(),Ta(this)};var Uh=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}(),Wh=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}(),Gh=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}(),Hh=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}(),Kh=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,e),Object.setPrototypeOf(_assertThisInitialized(r),n.prototype),r}return n}();function Xh(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function Qh(e,t){if(!e)throw new Kh(t)}function Yh(e,t){var n,r=0,a=_createForOfIteratorHelper(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(sI){a.e(sI)}finally{a.f()}return r}function Zh(e){return 1===e.length?e[0]:e}function Jh(e){return Array.isArray(e)?e:[e]}function $h(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function ef(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}Error;var tf={};function nf(e){if(null==e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function rf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"==typeof e){var i,o=e;if(o in n)i=n[o];else if(o in tf)i=tf[o];else if(null==(i=t[o]))throw new Gh("Unknown ".concat(r,": ").concat(e,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));return i}var s,u,c,l=e;if(null==l.className||null==l.config)throw new Gh(r+": Improper config format: "+JSON.stringify(l)+".\n'className' and 'config' must set.");var h,f,d=l.className;if(d in n?(h=(s=_slicedToArray2(n[d],2))[0],f=s[1]):d in tf?(h=(u=_slicedToArray2(tf.className,2))[0],f=u[1]):d in t&&(h=(c=_slicedToArray2(t[d],2))[0],f=c[1]),null==h)throw new Gh("Unknown ".concat(r,": ").concat(d,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));if(null!=f){for(var p={},m=0,v=Object.keys(tf);m<v.length;m++){var g=v[m];p[g]=tf[g]}for(var y=0,_=Object.keys(n);y<_.length;y++){var b=_[y];p[b]=n[b]}l.config.customObjects=p;for(var k=Object.assign({},tf),w=0,x=Object.keys(n);w<x.length;w++){var C=x[w];tf[C]=n[C]}!function e(t){if(null!=t&&"object"==typeof t)if(Array.isArray(t))t.forEach((function(t){return e(t)}));else for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n],i=t[a];null!=i&&"object"==typeof i&&(Array.isArray(i)||"ndarray"!==i.type||"number"!=typeof i.value?e(i):t[a]=i.value)}}(l.config);var S=f(h,l.config,n,a);return tf=Object.assign({},k),S}for(var T=Object.assign({},tf),A=0,E=Object.keys(n);A<E.length;A++){var I=E[A];tf[I]=n[I]}var R=new h(l.config);return tf=Object.assign({},T),R}function af(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function of(e){if(null==e)return e;var t,n=[],r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(sI){r.e(sI)}finally{r.f()}return n}function sf(e){if(null==e)throw new Gh("Invalid value in obj: "+JSON.stringify(e));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function uf(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new Gh("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function cf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return Qh(n>=0),Qh(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function lf(e,t){Array.isArray(e)?(r.assert(e.length>0,(function(){return t+" is unexpectedly an empty array."})),e.forEach((function(e,n){return lf(e,"element ".concat(n+1," of ").concat(t))}))):r.assert(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ")+function e(t){return null===t?"null":Array.isArray(t)?"["+t.map((function(t){return e(t)})).join(",")+"]":"string"==typeof t?'"'.concat(t,'"'):""+t}(e)+"."}))}function hf(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function ff(e,t){return sa((function(){return Ca(Xo(xa(e,e),t,!0))}))}var df=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"getConfig",value:function(){return{}}}]),n}(f.Serializable),pf=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return _createClass2(n,[{key:"apply",value:function(e){var t=this;return sa((function(){var n=ff(e,t.axis),r=Ki(n,0,t.maxValue);return xa(e,wa(r,ba(qh(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(df);pf.className="MaxNorm",f.registerClass(pf);var mf=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return _createClass2(n,[{key:"apply",value:function(e){var t=this;return sa((function(){return wa(e,ba(qh(),ff(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(df);mf.className="UnitNorm",f.registerClass(mf);var vf=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){return zs(e)}}]),n}(df);vf.className="NonNeg",f.registerClass(vf);var gf=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return _createClass2(n,[{key:"apply",value:function(e){var t=this;return sa((function(){var n=ff(e,t.axis),r=ba(xa(t.rate,Ki(n,t.minValue,t.maxValue)),xa(1-t.rate,n));return xa(e,wa(r,ba(qh(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(df);gf.className="MinMaxNorm",f.registerClass(gf);var yf={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function _f(e){return nf(e)}function bf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return rf(e,f.SerializationMap.getMap().classNameMap,t,"constraint")}function kf(e){return null==e?null:"string"==typeof e?bf({className:e in yf?yf[e]:e,config:{}}):e instanceof df?e:bf(e)}function wf(e){return new pf(e)}function xf(e){return new mf(e)}function Cf(){return new vf}function Sf(e){return new gf(e)}var Tf=["channelsFirst","channelsLast"],Af=["valid","same","causal"],Ef=["max","avg"],If=["sum","mul","concat","ave"],Rf=new Map;function Of(e){uf(Tf,"DataFormat",e)}function Nf(e){uf(Af,"PaddingMode",e)}function Df(e){uf(Ef,"PoolMode",e)}var Pf=[];function Ff(e,t){Pf.push(e);try{var n=t();return Pf.pop(),n}catch(r){throw Pf.pop(),r}}function Mf(e){if(!Bf(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===Pf.length?"":Pf.join("/")+"/")+e}function Lf(e){if(!Bf(e))throw new Error("Not a valid tensor name: '"+e+"'");Rf.has(e)||Rf.set(e,0);var t=Rf.get(e);if(Rf.set(e,Rf.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return Rf.set(n,1),n}return e}var zf=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Bf(e){return!!e.match(zf)}function jf(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function Vf(e){return Fs(e=Array.isArray(e)?new Float32Array(e):e)}function qf(e){return ss(Vf(e)).dataSync()[0]}function Uf(e){return Ko(Vf(e)).dataSync()[0]}function Wf(e,t){if(t<e)throw new Gh("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function Gf(e,t){return e.asType(t)}function Hf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function Kf(e,t,n){return sa((function(){switch(e.rank){case 1:return $s(e,t,n);case 2:return eu(e,[t,0],[n,e.shape[1]]);case 3:return tu(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return nu(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Mi(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Mi(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new Gh("sliceAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}))}function Xf(e,t,n){return sa((function(){switch(e.rank){case 1:return $s(e,t,n);case 2:return eu(e,[0,t],[e.shape[0],n]);case 3:return tu(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return nu(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new Gh("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}}))}function Qf(e,t,n,r){return sa((function(){switch(e.rank){case 1:return $s(e,t,n);case 2:switch(r){case 1:return Kf(e,t,n);case 2:return Xf(e,t,n);default:throw new Gh("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return Kf(e,t,n);case 2:return tu(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return Xf(e,t,n);default:throw new Gh("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return Kf(e,t,n);case 2:return nu(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return nu(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return Xf(e,t,n);default:throw new Gh("The axis is not within the rank of the tensor "+r)}default:throw new Gh("sliceAlongLastAxis() received an unsupported tensor rank: "+e.rank)}}))}function Yf(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),Pi(e,n)}function Zf(e,t){switch(e.rank){case 1:return Xi([e,t]);case 2:return Qi([e,t],0);case 3:return Yi([e,t],0);case 4:return Zi([e,t],0);default:throw new Gh("concatAlongFirstAxis() received an unsupported tensor rank: "+e.rank)}}function Jf(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new Gh("The length of input n (".concat(t.length,") does not match the number of dimensions in input x (").concat(e.rank,")"));return wo(e,t)}function $f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return Ds(e,t,n,r,a)}function ed(e,t,n,r){if(e.rank<2||t.rank<2)throw new Hh("dot requires both inputs to be rank >= 2 but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new Hh("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ".concat(e.shape," and  y shape = ")+t.shape);if(2===e.rank&&2===t.rank)return m.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?rd(e.rank,r,"channelsLast"):null,activation:n});var a=e.shape.slice(),i=a.pop();e=e.reshape([-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat(_toConsumableArray(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=t.transpose(l).reshape([u,-1]);var h=[].concat(_toConsumableArray(a),_toConsumableArray(c));return m.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?rd(e.rank,r,"channelsLast"):null,activation:n}).reshape(h)}function td(e,t,n){return sa((function(){return t=Array.isArray(t)?Fs(t,"int32"):t.toInt(),Ro(e,t,n)}))}function nd(e){return xa(e,e)}function rd(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new Gh("Unexpected bias dimensions: "+t.rank+"; expected it to be 1 or "+e);if(5===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1,1]:[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,1,r[0]]:[1].concat(r))}else if(4===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1,1]:[1,r[2],r[0],r[1]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,1,r[0]]:[1].concat(r))}else if(3===e){if("channelsFirst"===n)return t.reshape(1===r.length?[1,r[0],1]:[1,r[1],r[0]]);if("channelsLast"===n)return t.reshape(1===r.length?[1,1,r[0]]:[1].concat(r))}else if(e<3)return t;throw new Gh("Unsupported input rank by biasAdd: "+t.rank)}function ad(e,t,n){return sa((function(){return null==n&&(n="channelsLast"),Of(n),e.add(rd(e.rank,t,n))}))}function id(e,t,n,r){return sa((function(){return Qu(e,t,n,r)}))}function od(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e():t()}var sd=["fanIn","fanOut","fanAvg"],ud=["normal","uniform","truncatedNormal"],cd=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(f.Serializable),ld=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e,t){return as(e,t)}}]),n}(cd);ld.className="Zeros",f.registerClass(ld);var hd=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e,t){return is(e,t)}}]),n}(cd);hd.className="Ones",f.registerClass(hd);var fd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),r=t.call(this),"object"!=typeof e)throw new Gh("Expected argument of type ConstantConfig but got "+e);if(void 0===e.value)throw new Gh("config must have value set but got "+e);return r.value=e.value,_possibleConstructorReturn(r)}return _createClass2(n,[{key:"apply",value:function(e,t){var n=this;return sa((function(){return xa(Pa(n.value),is(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(cd);fd.className="Constant",f.registerClass(fd);var dd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return _createClass2(n,[{key:"apply",value:function(e,t){return Ps(e,this.minval,this.maxval,t)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(cd);dd.className="RandomUniform",f.registerClass(dd);var pd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return _createClass2(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Hh("randomNormal does not support dType ".concat(t,"."));return $f(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(cd);pd.className="RandomNormal",f.registerClass(pd);var md=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return _createClass2(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Hh("truncatedNormal does not support dType ".concat(t,"."));return ku(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(cd);md.className="TruncatedNormal",f.registerClass(md);var vd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return _createClass2(n,[{key:"apply",value:function(e,t){var n=this;return sa((function(){if(2!==e.length||e[0]!==e[1])throw new Gh("Identity matrix initializer can only be used for 2D square matrices.");return xa(n.gain,xo(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(cd);vd.className="Identity",f.registerClass(vd);var gd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r,a;if(_classCallCheck2(this,n),r=t.call(this),e.scale<0)throw new Gh("scale must be a positive float. Got: "+e.scale);return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,uf(sd,"FanMode",r.mode),r.distribution=null==e.distribution?"normal":e.distribution,a=r.distribution,uf(ud,"Distribution",a),r.seed=e.seed,_possibleConstructorReturn(r)}return _createClass2(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(Of(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=jf(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=jf(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=jf(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if(i/="fanIn"===this.mode?Math.max(1,r):"fanOut"===this.mode?Math.max(1,a):Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new Hh("".concat(this.getClassName()," does not support dType ").concat(t,"."));return ku(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return Ps(e,-s,s,t)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(cd);gd.className="VarianceScaling",f.registerClass(gd);var yd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return _createClass2(n,[{key:"getClassName",value:function(){return gd.className}}]),n}(gd);yd.className="GlorotUniform",f.registerClass(yd);var _d=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return _createClass2(n,[{key:"getClassName",value:function(){return gd.className}}]),n}(gd);_d.className="GlorotNormal",f.registerClass(_d);var bd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return _createClass2(n,[{key:"getClassName",value:function(){return gd.className}}]),n}(gd);bd.className="HeNormal",f.registerClass(bd);var kd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return _createClass2(n,[{key:"getClassName",value:function(){return gd.className}}]),n}(gd);kd.className="HeUniform",f.registerClass(kd);var wd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return _createClass2(n,[{key:"getClassName",value:function(){return gd.className}}]),n}(gd);wd.className="LeCunNormal",f.registerClass(wd);var xd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return _createClass2(n,[{key:"getClassName",value:function(){return gd.className}}]),n}(gd);xd.className="LeCunNormal",f.registerClass(xd);var Cd=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new Hh("Random seed is not implemented for Orthogonal Initializer yet.");return _possibleConstructorReturn(r)}return _createClass2(n,[{key:"apply",value:function(e,t){var n=this;return sa((function(){if(e.length<2)throw new Hh("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 (".concat(e[0]*e[1],") elements: Slowness may result."));var t=$f(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=Zc.gramSchmidt(t);return e[0]>e[1]&&(r=r.transpose()),xa(n.gain,r)}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(cd);Cd.className="Orthogonal",f.registerClass(Cd);var Sd={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Td(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return rf(e,f.SerializationMap.getMap().classNameMap,t,"initializer")}function Ad(e){return nf(e)}function Ed(e){if("string"==typeof e){var t=e in Sd?Sd[e]:e;if("GlorotNormal"===t)return new _d;if("GlorotUniform"===t)return new yd;if("HeNormal"===t)return new bd;if("HeUniform"===t)return new kd;if("LeCunNormal"===t)return new wd;if("LeCunUniform"===t)return new xd;var n={};return n.className=t,n.config={},Td(n)}return e instanceof cd?e:Td(e)}function Id(){return new ld}function Rd(){return new hd}function Od(e){return new fd(e)}function Nd(e){return new dd(e)}function Dd(e){return new pd(e)}function Pd(e){return new md(e)}function Fd(e){return new vd(e)}function Md(e){return new gd(e)}function Ld(e){return new yd(e)}function zd(e){return new _d(e)}function Bd(e){return new bd(e)}function jd(e){return new kd(e)}function Vd(e){return new wd(e)}function qd(e){return new xd(e)}function Ud(e){return new Cd(e)}var Wd=0;function Gd(){return Wd++}var Hd={};function Kd(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in Hd||(Hd[e]=0),Hd[e]+=1,e+Hd[e].toString()}function Xd(e){return Array.isArray(e)&&Array.isArray(e[0])}function Qd(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function Yd(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new Gh("Expected Tensor length to be 1; got "+e.length);t=e[0]}else t=e;return t}function Zd(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return(e=e)[0];throw new Gh("Expected exactly 1 Shape; got "+e.length)}return e}function Jd(e){var t,n=0,r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n+=0===a.shape.length?1:a.shape.reduce((function(e,t){return e*t}))}}catch(sI){r.e(sI)}finally{r.f()}return n}var $d=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Variable",a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;_classCallCheck2(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=Gd(),this.originalName=Mf(r=null==r?"Variable":r),this.name=Lf(this.originalName),this.trainable_=a,this.constraint=i,this.val=Su(t,this.trainable_,this.name,this.dtype)}return _createClass2(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function ep(e){return e.map((function(e){return e.read()}))}function tp(e){e.forEach((function(e){e[0].write(e[1])}))}var np,rp=function e(t){_classCallCheck2(this,e),this.dtype=t.dtype,this.shape=t.shape,this.ndim=null!=t.shape?t.shape.length:t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}},ap=function e(t,n,r,a,i,o,s){_classCallCheck2(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=Gd(),null!=o&&(this.originalName=Mf(o),this.name=Lf(this.originalName)),this.rank=n.length},ip=0,op=function(){function e(t,n){_classCallCheck2(this,e),this.callArgs=n,this.id=ip++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=_createForOfIteratorHelper(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(sI){a.e(sI)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return _createClass2(e,[{key:"getConfig",value:function(){var e,t=[],n=_createForOfIteratorHelper(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(null!=r?r.name:null)}}catch(sI){n.e(sI)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),sp=0,up=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck2(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=sp++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=$h(i)+"_"+Kd(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return e.initialWeights=null!=r.weights?r.weights:null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return _createClass2(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new Wh("The layer has never been called and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new Gh("Asked to get ".concat(t," at node ").concat(e,", but the layer has only ").concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return Zh(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return Zh(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=Jh(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=Jh(this.inputSpec);if(e.length!==t.length)throw new Gh("Layer ".concat(this.name," expects ").concat(t.length," inputs, but it received ").concat(e.length," input tensors. Input received: ")+e);for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new Gh("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected ndim=").concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new Gh("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected max_ndim=").concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new Gh("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected min_ndim=").concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new Gh("Input ".concat(n," is incompatible with layer ").concat(this.name," : expected dtype=").concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new Gh("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected axis ").concat(u," of input shape to have value ").concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var h=0;h<a.shape.length;++h){var f=a.shape[h],d=r.shape[h];if(null!=f&&null!=d&&f!==d)throw new Gh("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected shape=").concat(a.shape,", found shape=").concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=Jh(e),i=!0,o=_createForOfIteratorHelper(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof ap)){i=!1;break}}}catch(sI){o.e(sI)}finally{o.f()}var s,u=!0,c=_createForOfIteratorHelper(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof ap){u=!1;break}}}catch(sI){c.e(sI)}finally{c.f()}if(i===u)throw new Gh("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ff(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=_createForOfIteratorHelper(Jh(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(sI){o.e(sI)}finally{o.f()}n.build(Zh(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,l=n.call(e,t),h=[],f=_createForOfIteratorHelper(Jh(l));try{for(f.s();!(c=f.n()).done;){var d=c.value;-1!==a.indexOf(d)&&(d=d.clone()),h.push(d)}}catch(sI){f.e(sI)}finally{f.f()}if(l=Zh(h),null!=n.activityRegularizer)throw new Hh("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}var p,m=function(e){var t,n=[],r=_createForOfIteratorHelper(e=Jh(e));try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(sI){r.e(sI)}finally{r.f()}return Zh(n)}(e),v=n.computeOutputShape(m);if(n.warnOnIncompatibleInputShape(Array.isArray(e)?m[0]:m),p=null!=v&&v.length>0&&Array.isArray(v[0])?v.map((function(r,a){return new ap("float32",r,n,Jh(e),t,n.name,a)})):new ap("float32",v,n,Jh(e),t,n.name),n.addInboundNode(e,p,null,null,m,v,t),n._refCount++,null!=n.activityRegularizer)throw new Hh("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+JSON.stringify(e)+") does not match that of the "+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") of the layer ")+this.name);else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor (".concat(JSON.stringify(e),") does not match the expectation of layer ").concat(this.name,": ")+JSON.stringify(this.batchInputShape))}}},{key:"countParams",value:function(){if(!this.built)throw new Wh("You tried to call countParams() on ".concat(this.name,", but the layer is not built yet. Build it first by calling build(batchInputShape)."));return Jd(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ep(e?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;sa((function(){var n=t.weights;if(n.length!==e.length)throw new Gh('You called setWeights(weights) on layer "'.concat(t.name,'" with a weight list of length ').concat(e.length,", but the layer was expecting ").concat(n.length," weights. Provided weights: ").concat(e,"..."));if(0!==n.length){for(var a=[],i=ep(n),o=0;o<i.length;++o){var s=i[o],u=n[o],c=e[o];if(!r.arraysEqual(s.shape,c.shape))throw new Gh("Layer weight shape ".concat(s.shape," not compatible with provided weight shape ")+c.shape);a.push([u,c])}tp(a)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o){if(-1!==this._addedWeightNames.indexOf(e))throw new Gh("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=Ed("zeros"));var s=r.apply(t,n),u=new $d(s,n,e,i,o);return s.dispose(),null!=a&&this.addLoss((function(){return a.apply(u.read())})),null==i&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=Jh(e),null!=this._losses&&(t=this.losses).push.apply(t,_toConsumableArray(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, but was passed an inputMask."));t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, but was passed an inputMask."))}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=Jh(e);t=Jh(t),n=Jh(n),r=Jh(r),a=Qd(a),i=Qd(i);var u,c=[],l=[],h=[],f=_createForOfIteratorHelper(s);try{for(f.s();!(u=f.n()).done;){var d=u.value;c.push(d.sourceLayer),l.push(d.nodeIndex),h.push(d.tensorIndex)}}catch(sI){f.e(sI)}finally{f.f()}new op({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:h,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been built yet."));if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used yet."));this.assertNotDisposed();var e=0;return 0==--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new Uh("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new Uh("Layer "+this.name+" is not connected, no input to return.");return Zh(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new Uh("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new Uh("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return Zh(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new Uh("The layer ".concat(this.name," has never been called and thus has no defined output shape."));var e,t=[],n=_createForOfIteratorHelper(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(sI){n.e(sI)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new Uh("The layer ".concat(this.name,' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.'))}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(f.Serializable),cp=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:Kd("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new Gh("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new Gh("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new Gh("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new ap(r.dtype,r.batchInputShape,_assertThisInitialized(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new op({outboundLayer:_assertThisInitialized(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),_possibleConstructorReturn(r)}return _createClass2(n,[{key:"apply",value:function(e,t){throw new Gh("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(up);function lp(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new Gh("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new cp({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}function hp(e){return fp.apply(this,arguments)}function fp(){return(fp=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a,i,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!=typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=10;break}return e.next=7,Promise.all(n);case 7:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];ua(a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dp(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}cp.className="InputLayer",f.registerClass(cp),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(np||(np={}));var pp=function(){function e(){_classCallCheck2(this,e),this.validationData=null}var t,n,r,a,i,o;return _createClass2(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},{key:"onEpochEnd",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"onBatchBegin",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return a.apply(this,arguments)})},{key:"onBatchEnd",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return r.apply(this,arguments)})},{key:"onTrainBegin",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"onTrainEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"setModel",value:function(e){}}]),e}(),mp=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;_classCallCheck2(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}var t,n,r,a,i,o;return _createClass2(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=_createForOfIteratorHelper(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(sI){n.e(sI)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=_createForOfIteratorHelper(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(sI){n.e(sI)}finally{n.f()}}},{key:"onEpochBegin",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=_createForOfIteratorHelper(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e,t){return o.apply(this,arguments)})},{key:"onEpochEnd",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=_createForOfIteratorHelper(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e,t){return i.apply(this,arguments)})},{key:"onBatchBegin",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=_createForOfIteratorHelper(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e,t){return a.apply(this,arguments)})},{key:"onBatchEnd",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=_createForOfIteratorHelper(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e,t){return r.apply(this,arguments)})},{key:"onTrainBegin",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=_createForOfIteratorHelper(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e){return n.apply(this,arguments)})},{key:"onTrainEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=_createForOfIteratorHelper(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])}))),function(e){return t.apply(this,arguments)})}]),e}(),vp=function(e){_inherits(i,e);var t,n,r,a=_createSuper(i);function i(){return _classCallCheck2(this,i),a.call(this)}return _createClass2(i,[{key:"onEpochBegin",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onBatchEnd",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i in null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=function(e){var t=n[e];if("number"==typeof t)o.totals.hasOwnProperty(e)||(o.totals[e]=0),o.totals[e]=o.totals[e]+t*r;else{var a;e in o.totals?a=o.totals[e]:o.totals[e]=0;var i=sa((function(){return ba(o.totals[e],xa(t,r))}));o.totals[e]=i,null!=a&&a.dispose()}},n)a(i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"onEpochEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n){r=_createForOfIteratorHelper(this.params.metrics);try{for(i=function(){var e=a.value;null!=o.totals[e]&&("number"==typeof o.totals[e]?n[e]=o.totals[e]/o.seen:sa((function(){var t=xa(wa(1,o.seen),o.totals[e]);n[e]=t,o.totals[e].dispose(),ca(n[e])})))},r.s();!(a=r.n()).done;)i()}catch(sI){r.e(sI)}finally{r.f()}}case 1:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),i}(pp),gp=function(e){_inherits(i,e);var t,n,r,a=_createSuper(i);function i(){return _classCallCheck2(this,i),a.apply(this,arguments)}return _createClass2(i,[{key:"onTrainBegin",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onEpochEnd",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"syncData",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!=typeof i[o]&&(t.push(i[o].data()),n.push(a),r.push(o));return e.next=4,Promise.all(t);case 4:for(s=e.sent,u=0;u<s.length;++u)this.history[n[u]][r[u]].dispose(),this.history[n[u]][r[u]]=s[u][0];case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(pp),yp=function(e){_inherits(l,e);var t,n,a,i,o,s,u,c=_createSuper(l);function l(e,t){var n,a,i,o,s;if(_classCallCheck2(this,l),(n=c.call(this)).currentEpoch=0,n.yieldEvery=t||"auto","auto"===n.yieldEvery&&(n.yieldEvery=125),"never"===n.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return r.isNumber(n.yieldEvery)&&(n.maybeWait=(a=n.maybeWait.bind(_assertThisInitialized(n)),i=n.yieldEvery,s=r.now(),function(){var e=r.now();return e-s<i||(s=e,o=a.apply(void 0,arguments)),o})),n.trainBegin=e.onTrainBegin,n.trainEnd=e.onTrainEnd,n.epochBegin=e.onEpochBegin,n.epochEnd=e.onEpochEnd,n.batchBegin=e.onBatchBegin,n.batchEnd=e.onBatchEnd,n.yield=e.onYield,_possibleConstructorReturn(n)}return _createClass2(l,[{key:"maybeWait",value:(u=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],e.t0=null!=this.yield,!e.t0){e.next=6;break}return e.next=5,hp(r);case 5:a.push(this.yield(t,n,r));case 6:return a.push(nl()),e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"onEpochBegin",value:(s=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,e.t0=null!=this.epochBegin,!e.t0){e.next=7;break}return e.next=5,hp(n);case 5:return e.next=7,this.epochBegin(t,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"onEpochEnd",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.epochEnd,!e.t0){e.next=6;break}return e.next=5,hp(n);case 5:r.push(this.epochEnd(t,n));case 6:return"epoch"===this.yieldEvery&&r.push(nl()),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"onBatchBegin",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.batchBegin,!e.t0){e.next=6;break}return e.next=4,hp(n);case 4:return e.next=6,this.batchBegin(t,n);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"onBatchEnd",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],e.t0=null!=this.batchEnd,!e.t0){e.next=6;break}return e.next=5,hp(n);case 5:a.push(this.batchEnd(t,n));case 6:return"batch"===this.yieldEvery?a.push(nl()):r.isNumber(this.yieldEvery)&&a.push(this.maybeWait(this.currentEpoch,t,n)),e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"onTrainBegin",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainBegin,!e.t0){e.next=6;break}return e.next=4,hp(t);case 4:return e.next=6,this.trainBegin(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onTrainEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainEnd,!e.t0){e.next=6;break}return e.next=4,hp(t);case 4:return e.next=6,this.trainEnd(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),l}(pp);function _p(e,t){return null==e&&(e={}),e instanceof pp?[e]:Array.isArray(e)&&e[0]instanceof pp?e:Jh(e).map((function(e){return new yp(e,t)}))}var bp=function(){function e(){_classCallCheck2(this,e)}return _createClass2(e,null,[{key:"registerCallbackConstructor",value:function(t,n){r.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, but got "+t})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors)e.constructors[+n].forEach((function(e){if(e===t)throw new Gh("Duplicate callback constructor.")}))}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,_toConsumableArray(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function kp(e,t,n,r,a,i,o,s,u){var c=new gp,l=[new vp].concat(_toConsumableArray(bp.createCallbacks(t)));null!=e&&l.push.apply(l,_toConsumableArray(e)),l.push(c);var h=new mp(l);return h.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:h,history:c}}function wp(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return rf(e,f.SerializationMap.getMap().classNameMap,t,"layer",n)}function xp(e,t){return sa((function(){"float32"!==e.dtype&&(e=e.asType("float32"));var n=Xo(nd(e),t,!0),r=La(n.shape,qh()),a=Ca(Ha(n,r));return wa(e,a)}))}function Cp(e,t){return sa((function(){return os(nd(ja(t,e)),-1)}))}function Sp(e,t){return sa((function(){return os(qa(ja(t,e)),-1)}))}function Tp(e,t){return sa((function(){var n=ja(e,t),r=Ki(qa(e),qh(),Number.MAX_VALUE),a=qa(wa(n,r));return xa(100,os(a,-1))}))}function Ap(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return sa((function(){if(n)t=ru(t);else{var r=Xo(t,t.shape.length-1,!0);t=wa(t,r)}return t=Ki(t,qh(),1-qh()),Wo(Xo(xa(e.toFloat(),qo(t)),t.shape.length-1))}))}function Ep(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return sa((function(){var r,a,i=Co((r=e,a=[jf(r.shape)],r.reshape(a))).toInt(),o=(t=Ki(t,qh(),1-qh())).shape;return Ap(pr(i,o[o.length-1]).reshape(o),t,n)}))}function Ip(e,t){return sa((function(){var n;return n=Ki(t,qh(),1-qh()),n=qo(wa(n,ja(1,n))),os(function(e,t){if(!r.arraysEqual(e.shape,t.shape))throw new Gh("logits and labels must have the same shape, but got shapes ".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return sa((function(){var n=t.relu(),r=t.abs().neg();return n.sub(t.mul(e)).add(r.exp().log1p())}))}(e,n),-1)}))}function Rp(e,t){return sa((function(){var n=xp(e,-1),r=xp(t,-1),a=xa(n,r);return Wo(Xo(a,-1))}))}bp.constructors={};var Op={meanSquaredError:Cp,meanAbsoluteError:Sp,meanAbsolutePercentageError:Tp,meanSquaredLogarithmicError:function(e,t){return sa((function(){var n=Ki(t,qh(),Number.MAX_VALUE),r=qo(ba(1,n)),a=Ki(e,qh(),Number.MAX_VALUE),i=qo(ba(1,a));return os(nd(ja(r,i)),-1)}))},squaredHinge:function(e,t){return sa((function(){var n=Ha(0,ja(1,xa(e,t)));return os(nd(n),-1)}))},hinge:function(e,t){return sa((function(){var n=Ha(0,ja(1,xa(e,t)));return os(n,-1)}))},categoricalHinge:function(e,t){return sa((function(){var n=Xo(xa(e,t),-1),r=Ko(xa(ja(1,e),t),-1);return Ha(0,ba(1,ja(r,n)))}))},logcosh:function(e,t){return sa((function(){var n=Math.log(2),r=ja(t,e),a=ja(ba(r,Go(xa(-2,r))),n);return os(a,-1)}))},categoricalCrossentropy:Ap,sparseCategoricalCrossentropy:Ep,binaryCrossentropy:Ip,kullbackLeiblerDivergence:function(e,t){return sa((function(){var n=Ki(e,qh(),1),r=Ki(t,qh(),1);return Xo(xa(e,qo(wa(n,r))),-1)}))},poisson:function(e,t){return sa((function(){var n=qo(ba(qh(),t));return os(ja(t,xa(e,n)),-1)}))},cosineProximity:Rp};function Np(e){if("string"==typeof e){if(e in Op)return Op[e];var t="Unknown loss "+e;throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy')),new Gh(t)}return e}function Dp(e,t){return sa((function(){var n=xa(.5,vs(t)),r=Gf(Oo(t,n),e.dtype);return os(fo(e,r),-1)}))}function Pp(e,t){return sa((function(){return Gf(fo(li(e,-1),li(t,-1)),"float32")}))}function Fp(e,t){return sa((function(){return Zo(e.equal(1),t.equal(1)).sum().cast("float32")}))}function Mp(e,t){return sa((function(){var n=Fp(e,t),r=function(e,t){return sa((function(){return Zo(e.equal(0),t.equal(1)).sum().cast("float32")}))}(e,t),a=n.add(r);return po(Oo(a,0),n.div(a),0).cast("float32")}))}function Lp(e,t){return Ip(e,t)}function zp(e,t){return e.rank===t.rank&&(e=e.squeeze([e.rank-1])),(t=t.argMax(-1)).dtype!==e.dtype&&(t=t.asType(e.dtype)),fo(e,t).asType("float32")}var Bp=Ap,jp=Ep,Vp={binaryAccuracy:Dp,categoricalAccuracy:Pp,precision:Mp,categoricalCrossentropy:Bp,sparseCategoricalCrossentropy:jp,mse:Cp,MSE:Cp,mae:Sp,MAE:Sp,mape:Tp,MAPE:Tp,cosine:Rp};function qp(e){if("string"==typeof e&&e in Vp)return Vp[e];if("string"!=typeof e&&null!=e)return e;throw new Gh("Unknown metric "+e)}function Up(e){if(Qh(null!==e,"Unknown LossOrMetricFn "+e),"string"==typeof e)return e;for(var t,n=0,r=Object.keys(Op);n<r.length;n++){var a=r[n];if(Op[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(Vp);i<o.length;i++){var s=o[i];if(Vp[s]===e){t=s;break}}return void 0!==t?t:e.name}function Wp(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!function e(t){if(null===t)return!0;if("object"==typeof t){if(Object.getPrototypeOf(t)===Object.prototype){for(var n=0,r=Object.keys(t);n<r.length;n++){var a=r[n];if("string"!=typeof a)return!1;if(!e(t[a]))return!1}return!0}if(Array.isArray(t)){var i,o=_createForOfIteratorHelper(t);try{for(o.s();!(i=o.n()).done;){if(!e(i.value))return!1}}catch(sI){o.e(sI)}finally{o.f()}return!0}return!1}var s=typeof t;return"string"===s||"number"===s||"boolean"===s}(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>1048576&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in size (length=').concat(r.length," when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576."))}}function Gp(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function Hp(e,t,n){var r;try{r=JSON.stringify(e.outputShape)}catch(sI){r="multiple"}Gp(["".concat(e.name," (").concat(e.getClassName(),")"),r,e.countParams().toString()],t,n)}function Kp(e,t,n,r){var a;try{a=JSON.stringify(e.outputShape)}catch(sI){a="multiple"}var i,o=[],s=_createForOfIteratorHelper(e.inboundNodes);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(var c=0;c<u.inboundLayers.length;++c)o.push("".concat(u.inboundLayers[c].name,"[").concat(u.nodeIndices[c],"][").concat(u.tensorIndices[c],"]"))}}catch(sI){s.e(sI)}finally{s.f()}var l=e.name,h=e.getClassName(),f=0===o.length?"":o[0];Gp(["".concat(l," (").concat(h,")"),a,e.countParams().toString(),f],t,r);for(var d=1;d<o.length;++d)Gp(["","","",o[d]],t,r)}function Xp(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function Qp(e,t){if(null===e)return null;if("string"==typeof e)return ef(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];Xp(t,a,i)?n.push(i):n.push(Qp(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"==typeof l)o[c]=l;else{var h=ef(c);o[h]=Qp(l,h)}}return o}var Yp=function(){function e(t){if(_classCallCheck2(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=_createForOfIteratorHelper(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(sI){a.e(sI)}finally{a.f()}}}return _createClass2(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new Gh("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return Un(t,e.dtype)}catch(sI){throw new Gh("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype of the key '").concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof ap){if(null==this.id2Value[e.id])throw new Gh("Nonexistent key: "+e.name);return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new Gh("Feed dict has no SymbolicTensor name: "+e);return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof ap){if(null==this.id2Value[e.id])throw new Gh("Nonexistent key: "+e.name);return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new Gh("Feed dict has no SymbolicTensor name: "+e);return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&ua(this.id2Mask)}}]),e}(),Zp={},Jp={};function $p(e,t,n,a){var i,o=null!=n&&n.training,s=Array.isArray(e),u=s?e:[e],c=u.map((function(e){return e.name})),l=[],h=t.names(),f=_createForOfIteratorHelper(c);try{for(f.s();!(i=f.n()).done;){var d=i.value;-1!==h.indexOf(d)?l.push(t.getValue(d)):l.push(null)}}catch(sI){f.e(sI)}finally{f.f()}null!=a&&(a.maxNumTensors=-1/0,a.minNumTensors=1/0);var p,m,v=c.join(",")+"|"+t.names().join(",");if(null==Zp[v]){var g=function(e,t){r.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],a={};if(1===e.length){var i=tm(e[0],t);n=i.sorted,a=i.recipientMap}else{var o,s=new Set,u=_createForOfIteratorHelper(e);try{for(u.s();!(o=u.n()).done;){var c,l=tm(o.value,t),h=l.sorted,f=l.recipientMap,d=_createForOfIteratorHelper(h);try{for(d.s();!(c=d.n()).done;){var p=c.value;s.has(p.name)||(n.push(p),s.add(p.name))}}catch(sI){d.e(sI)}finally{d.f()}var m=function(e){null==a[e]&&(a[e]=new Set),f[e].forEach((function(t){return a[e].add(t)}))};for(var v in f)m(v)}}catch(sI){u.e(sI)}finally{u.f()}}return{sorted:n,recipientCounts:em(a)}}(u,t);p=g.sorted,m=g.recipientCounts,Zp[v]=p,Jp[v]=m}p=Zp[v],m={},o||Object.assign(m,Jp[v]);for(var y=new Yp(t),_=0;_<p.length;++_){if(null!=a){var b=ia().numTensors;b>a.maxNumTensors&&(a.maxNumTensors=b),b<a.minNumTensors&&(a.minNumTensors=b)}var k=p[_],w=k.sourceLayer;if(!(w instanceof cp)){var x,C=[],S=[],T=[],A=!1,E=_createForOfIteratorHelper(k.inputs);try{for(E.s();!(x=E.n()).done;){var I=x.value,R=y.getValue(I),O=y.getMask(I);C.push(R),S.push(O),null!=O&&(A=!0),o||(m[I.name]--,0!==m[I.name]||t.hasKey(I)||-1!==c.indexOf(I.name)||R.isDisposed||!0===I.sourceLayer.stateful||T.push(R))}}catch(sI){E.e(sI)}finally{E.f()}A&&((n=n||{}).mask=S[0]);var N=Jh(w.apply(C,n)),D=null;w.supportsMasking&&(D=w.computeMask(C,S));for(var P=nm(k),F=Array.isArray(P)?P:[P],M=0;M<F.length;++M){y.hasKey(F[M])||y.add(F[M],N[M],Array.isArray(D)?D[0]:D);var L=c.indexOf(F[M].name);-1!==L&&(l[L]=N[M])}o||ua(T)}}return y.disposeMasks(),s?l:l[0]}function em(e){var t={};for(var n in e)t[n]=e[n].size;return t}function tm(e,t){var n,r=new Set,a=[],i={},o=_createForOfIteratorHelper(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(sI){o.e(sI)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var h=c[c.length-1]===u.length-1;if(0===l.inputs.length||h)u.pop(),a.push(l),r.add(l.name),h&&c.pop();else{c.push(u.length-1);var f,d=_createForOfIteratorHelper(l.inputs);try{for(d.s();!(f=d.n()).done;){var p=f.value;null==i[p.name]&&(i[p.name]=new Set),i[p.name].add(l.name),r.has(p.name)||u.push(p)}}catch(sI){d.e(sI)}finally{d.f()}}}}return{sorted:a,recipientMap:i}}function nm(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=_createForOfIteratorHelper(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(sI){i.e(sI)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}function rm(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided classWeight is an array of ".concat(e.length," element(s), but the model has ").concat(r," outputs. Make sure a set of weights is provided for each model output."));return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){a.push(t in e?e[t]:null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, so classWeight must be either an array with ").concat(r," elements or an object with ").concat(t," keys. Provided classWeight not understood: ").concat(JSON.stringify(e)))}(e,t)}function am(e,t,n,r){return im.apply(this,arguments)}function im(){return(im=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){var i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=12;break}return i=sa((function(){if(1===t.shape.length)return t.clone();if(2===t.shape.length){if(t.shape[1]>1)return t.argMax(1);if(1===t.shape[1])return t.reshape([t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") during handling of class weights. The size is expected to be >= 1."))}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during handling of class weights. The rank is expected to be 1 or 2."))})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),ua(i),s=[],e.abrupt("return",(o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. The class ".concat(e," exists in the data but not in classWeight"));s.push(r[e])})),Fs(s,"float32")));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function om(e,t){return xa(e,t)}function sm(e,t){var n,a;n=t.xs,a=t.ys,r.assert(null!=n&&null!=a,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+t}));var i=um("input",e.inputNames,n),o=um("output",e.outputNames,a),s=i[0].shape[0];r.assert(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset provides ").concat(i.length," inputs.  (Expected input keys: ")+JSON.stringify(e.inputNames)+")"})),r.assert(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset provides ").concat(o.length," outputs.  (Expected output keys: ")+JSON.stringify(e.outputNames)+")"}));for(var u=function(t){r.assert(i[t].shape[0]===s,(function(){return"Batch size mismatch: input ".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){r.assert(o[t].shape[0]===s,(function(){return"Batch size mismatch: output ".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},h=0;h<o.length;h++)l(h);return{xs:i,ys:o}}function um(e,t,n){if(n instanceof _t)return[n];if(Array.isArray(n))return r.assert(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var a,i=[],o=_createForOfIteratorHelper(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(null==n[s])throw new Gh("The feature data generated by the dataset lacks the required ".concat(e," key '").concat(s,"'."));i.push(n[s])}}catch(sI){o.e(sI)}finally{o.f()}return i}function cm(e){return"function"==typeof e.iterator}function lm(e){r.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got "+e}))}function hm(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return Kf(e,t,n-t)})):Kf(e,t,n-t)}function fm(e,t){return sa((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return fm(e,t)})):td(e,"int32"===t.dtype?t:t.toInt())}))}function dm(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function pm(e){var t=[];e instanceof _t&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(Hf(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function mm(e,t){if(null!=e){var n=[];if(t instanceof _t)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t)n.push(t[r].id);var a=[];if(e instanceof _t)-1===n.indexOf(e.id)&&a.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&a.push(e)}));else if(null!=e)for(var i in e){var o=e[i];-1===n.indexOf(o.id)&&a.push(o)}a.forEach((function(e){e.isDisposed||e.dispose()}))}}function vm(e){return Array.isArray(e)}function gm(e){return!function(e){return e instanceof _t}(e)&&!vm(e)}function ym(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(vm(e)&&e.length>0)o=!0;else if(gm(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new Gh("Error when checking model ".concat(i," expected no data, but got ")+e)}return[]}if(null==e)return t.map((function(e){return null}));if(gm(e)){e=e,r=[];var u,c=_createForOfIteratorHelper(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new Gh('No data provided for "'.concat(l,'". Need data for each key in: ')+t);r.push(e[l])}}catch(sI){c.e(sI)}finally{c.f()}}else if(vm(e)){if((e=e).length!==t.length)throw new Gh("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got the following list of Tensor(s): ")+e);r=e}else{if(e=e,t.length>1)throw new Gh("The model ".concat(i," expects ").concat(t.length," Tensor(s), but only received one Tensor. Found: Tensor with shape ")+e.shape);r=[e]}if(r=pm(r),null!=n)for(var h=0;h<t.length;++h)if(null!=n[h]){var f=r[h];if(f.shape.length!==n[h].length)throw new Gh("Error when checking ".concat(i,": expected ").concat(t[h]," to have ").concat(n[h].length," dimension(s). but got array with shape ")+f.shape);for(var d=0;d<n[h].length;++d)if(0!==d||a){var p=f.shape[d],m=n[h][d];if(null!=m&&m>=0&&p!==m)throw new Gh("Error when checking ".concat(i,": expected ").concat(t[h]," to have shape [").concat(n[h],"], but got array with shape [").concat(f.shape,"]."))}}return r}function _m(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new Gh("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got ").concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new Gh("The model expects ".concat(t.length," ").concat(i," Tensors, but only received one Tensor. Found: array with shape ")+JSON.stringify(e.shape)+".");r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new Gh("Error when checking ".concat(i,": expected ").concat(t[o]," to have ").concat(n[o].length," dimension(s), but got array with shape ")+JSON.stringify(s.shape));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new Gh("Error when checking ".concat(i,": expected ").concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but got array with shape ").concat(JSON.stringify(s.shape),"."))}}}var bm=function(e){_inherits(l,e);var t,n,a,i,s,u,c=_createSuper(l);function l(e){var t;return _classCallCheck2(this,l),(t=c.call(this,e)).isTraining=!1,t}return _createClass2(l,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new Gh("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");!function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=function(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,_toConsumableArray(s))}if(t){var u,c=_createForOfIteratorHelper(e.layers);try{for(c.s();!(u=c.n()).done;){var l,h=u.value,f=!1,d=_createForOfIteratorHelper(h.inboundNodes);try{for(d.s();!(l=d.n()).done;){var p=l.value;if(-1!==r.indexOf(p)){if(f){t=!1;break}f=!0}}}catch(sI){d.e(sI)}finally{d.f()}if(!t)break}}catch(sI){c.e(sI)}finally{c.f()}}return t}(e),o=["Layer (type)","Output shape","Param #"];if(i?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,_toConsumableArray(e.nodesByDepth[s]))}a("_".repeat(t)),Gp(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?Hp(c[l],n,a):Kp(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var h=function(e){return Jd(null!=e.collectedTrainableWeights?e.collectedTrainableWeights:e.trainableWeights)}(e),f=Jd(e.nonTrainableWeights);a("Total params: "+(h+f)),a("Trainable params: "+h),a("Non-trainable params: "+f),a("_".repeat(t))}(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return el.adagrad(.01)},Adadelta:function(){return el.adadelta(1,.95,qh())},Adam:function(){return el.adam(.001,.9,.999,qh())},Adamax:function(){return el.adamax(.002,.9,.999,qh(),0)},RMSProp:function(){return el.rmsprop(.001,.9,0,qh())},SGD:function(){return el.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new Gh("Unknown Optimizer "+e)}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Fa))throw new Gh("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new Gh("When passing an Array as loss, it should have one entry per model output. The model has ".concat(this.outputs.length," output(s), but you passed loss=").concat(e.loss,"."));n=e.loss.map((function(e){return Np(e)}))}else{var r=Np(e.loss);this.outputs.forEach((function(e){n.push(r)}))}else{for(var a in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(a))throw new Gh('Unknown entry in loss dictionary: "'.concat(a,'". Only expected the following keys: ')+this.outputNames);var i,o=_createForOfIteratorHelper(this.outputNames);try{for(o.s();!(i=o.n()).done;){var s=i.value;null==e.loss[s]&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ').concat(s," during training")),n.push(Np(e.loss[s]))}}catch(sI){o.e(sI)}finally{o.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var u=0;u<this.outputs.length;++u){var c=this.internalOutputShapes[u];this.feedOutputNames.push(this.outputNames[u]),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[u])}var l=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ff("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===l.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var h=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: "+e);n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=_createForOfIteratorHelper(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(sI){i.e(sI)}finally{i.f()}return a}(e.metrics,this.outputNames),f=function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])};Ff("metric",(function(){for(var e=function(e){-1===l.indexOf(e)&&function(n){var r,a,i,o,s=_createForOfIteratorHelper(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;if("string"==typeof u&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(u)){var c=t.internalOutputShapes[e],l=void 0;1===c[c.length-1]||t.lossFunctions[e]===Ip?-1!==["accuracy","acc"].indexOf(u)?a=Dp:-1!==["crossentropy","ce"].indexOf(u)&&(a=Lp):t.lossFunctions[e]===Ep?-1!==["accuracy","acc"].indexOf(u)?a=zp:-1!==["crossentropy","ce"].indexOf(u)&&(a=jp):-1!==["accuracy","acc"].indexOf(u)?a=Pp:-1!==["crossentropy","ce"].indexOf(u)&&(a=Bp),-1!==["accuracy","acc"].indexOf(u)?l="acc":-1!==["crossentropy","ce"].indexOf(u)&&(l="ce"),i=a,r=""+l}else{var h=qp(u);i=h,r=""+Up(u)}var d=void 0;Ff(r,(function(){d=i})),f(e,r,d)}}catch(sI){s.e(sI)}finally{s.f()}}(h[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;lm(r);var a=this.standardizeUserDataXY(e,t,!0,r);try{var i=a[0].concat(a[1]);return this.makeTestFunction(),Zh(this.testLoop(this.testFunction,i,r,n.verbose,n.steps))}finally{mm(a[0],e),mm(a[1],t)}}},{key:"evaluateDataset",value:(u=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.makeTestFunction(),function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a){var i,o,s,u,c,l,h,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null!=(a=a||{}).batches,o=t.testFunction,s=[],!(a.verbose>0)){e.next=4;break}throw new Hh("Verbose mode is not implemented yet.");case 4:if(r.assert(!i||a.batches>0&&Number.isInteger(a.batches),(function(){return"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(a.batches)})),"function"!=typeof n.next){e.next=9;break}e.t0=n,e.next=12;break;case 9:return e.next=11,n.iterator();case 11:e.t0=e.sent;case 12:u=e.t0,c=0,l=0,h=regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.next();case 2:if(n=e.sent,s=sa((function(){return n.value&&function(){var e=sm(t,n.value),r=e.xs,a=e.ys,i=r.concat(a),u=sa((function(){return o(i)}));if(ua(i),0===l)for(var h=0;h<u.length;++h)s.push(Pa(0));for(var f=i[0].shape[0],d=function(e){var t=u[e],n=s[e];s[e]=sa((function(){return ba(s[e],xa(f,t))})),l>0&&ua(n)},p=0;p<u.length;++p)d(p);ua(u),c+=f,++l}(),s})),!n.done){e.next=6;break}return i&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, ".concat(a.batches," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("return","break");case 6:case"end":return e.stop()}}),e)}));case 15:if(i&&!(l<a.batches)){e.next=22;break}return e.delegateYield(h(),"t1",17);case 17:if("break"!==e.t1){e.next=20;break}return e.abrupt("break",22);case 20:e.next=15;break;case 22:for(f=0;f<s.length;++f)d=s[f],s[f]=wa(s[f],c),ua(d);return e.abrupt("return",Zh(s));case 24:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()(this,t,n)));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new Gh("If ".concat(a," is set, batchSize must be null or undefined.Got batchSize = ")+t)}else{if(null==e)throw new Gh("Either the input data should have a defined shape, or "+a+" shoud be specified.");r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new Gh("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=this.retrieveSymbolicTensors(n?t:[t]),a=new Yp;if(e instanceof _t&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new Gh("The number of inputs provided (".concat(e.length,") does not match the number of inputs of this model (").concat(this.inputs.length,")."));for(var i=0;i<this.inputs.length;++i)a.add(this.inputs[i],e[i])}else{var o,s=_createForOfIteratorHelper(this.inputs);try{for(s.s();!(o=s.n()).done;){var u=o.value,c=e[u.name];if(null==c)throw new Gh("No value is provided for the model's input "+u.name);a.add(u,c)}}catch(sI){s.e(sI)}finally{s.f()}}var l=$p(r,a);return n?l:l[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=Xh(null,e.length),r=e.length,a=_createForOfIteratorHelper(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(sI){a.e(sI)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new Gh("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(l))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return sa((function(){var a=t.checkNumSamples(e);if(r)throw new Hh("Verbose predictLoop() is not implemented yet.");for(var i=dm(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){sa((function(){var r=hm(e,i[n][0],i[n][1]),a=[];if(Array.isArray(r))for(var o=0;o<r.length;++o)a.push({key:t.inputs[o],value:r[o]});else a.push({key:t.inputs[0],value:r});var s=new Yp(a);return $p(t.outputs,s)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return Zh(o.map((function(e){return Pi(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=pm(e);_m(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return lm(r),this.predictLoop(n,r)}finally{mm(n,e)}}},{key:"predictOnBatch",value:function(e){_m(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new Wh("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var a=[],i=0;i<this.feedOutputShapes.length;++i){var o=this.feedOutputShapes[i];a.push(this.feedLossFns[i]===Ep?o.slice(0,o.length-1).concat([1]):o)}if(function(e,t,n){var a=of(e.map((function(e){return e.shape[0]})));a.sort();var i=of(t.map((function(e){return e.shape[0]})));if(i.sort(),a.length>1)throw new Gh("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map((function(e){return e.shape}))));if(i.length>1)throw new Gh("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map((function(e){return e.shape}))));if(a.length>0&&i.length>0&&!r.arraysEqual(a,i))throw new Gh("Input Tensors should have the same number of samples as target Tensors. Found ".concat(a[0]," input sample(s) and ").concat(i[0]," target sample(s)."))}(e=ym(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=ym(t,this.feedOutputNames,a,!1,"target")),function(e,t,n){for(var r=[Cp,Ip,Ap],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===Ap&&1===i.shape[i.shape.length-1])throw new Gh("You are passing a target array of shape ".concat(i.shape," while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes]."));if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var h=u[l],f=c[l];if(null!=f&&h!==f)throw new Gh("A target Tensor with shape ".concat(i.shape," was passed for an output of shape ").concat(s,", while using a loss function that expects targets to have the same shape as the output."))}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!=0)throw new Gh("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:(s=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){var i,o,s,u,c,l,h,f,d,p=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(p.length>4&&void 0!==p[4])||p[4],o=p.length>5?p[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),u=_slicedToArray2(s,2),c=u[0],l=u[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(h=null,null==a){e.next=19;break}f=rm(a,this.outputNames),h=[],d=0;case 10:if(!(d<f.length)){e.next=19;break}return e.t0=h,e.next=14,am(l[d],null,f[d]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++d,e.next=10;break;case 19:return e.abrupt("return",[c,l,h]);case 20:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return s.apply(this,arguments)})},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return sa((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new Hh("Verbose mode is not implemented yet.");if(null!=i)throw new Hh("steps mode in testLoop() is not implemented yet");for(var u=dm(o,n),c=Fs(Wf(0,o)),l=0;l<u.length;++l){var h=u[l][0],f=u[l][1],d=Kf(c,h,f-h),p=fm(t,d),m=e(p);if(0===l)for(var v=0;v<m.length;++v)s.push(Pa(0));for(var g=0;g<m.length;++g)s[g]=ba(s[g],xa(f-h,m[g]))}for(var y=0;y<s.length;++y)s[y]=wa(s[y],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;Yh(e,r)>1&&(a+="_"+Yh(e.slice(0,n),r)),t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new Yp(t),l=$p(e.outputs,c,{training:!0}),h=0;h<e.lossFunctions.length;++h){var f=(0,e.lossFunctions[h])(a[h],l[h]);null!=i[h]&&(f=om(f,i[h]));var d=os(f);n.push(d),u=0===h?f:ba(u,f)}for(var p=0;p<e.metricsTensors.length;++p){var m=void 0;if(e.outputs.length>1&&p<e.outputs.length)m=n[p];else{var v=e.metricsTensors[p][1];m=os((0,e.metricsTensors[p][0])(a[v],l[v]))}ca(m),o.push(m)}return u=os(u),e.calculateLosses().forEach((function(e){u=ba(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return sa((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new Yp(o),c=$p(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var h=os((0,e.lossFunctions[l])(i[l],c[l]));n=0===l?h:ba(n,h),r.push(n)}for(var f=0;f<e.metricsTensors.length;++f){var d=e.metricsTensors[f][1],p=os((0,e.metricsTensors[f][0])(i[d],c[d]));r.push(p)}return r}))}}},{key:"fit",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a,i=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.length>2&&void 0!==i[2]?i[2]:{},e.abrupt("return",function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a){var i,o,s,u,c,l,h,f,d,p,m,v,g,y,_,b,k,w,x,C,S,T,A,E=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=E.length>3&&void 0!==E[3]?E[3]:{},!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,lm(d=null==i.batchSize?32:i.batchSize),p=!1,e.next=10,t.standardizeUserData(n,a,i.sampleWeight,i.classWeight,p,d);case 10:if(m=e.sent,o=m[0],s=m[1],f=m[2],g=!1,!(null!=i.validationData&&i.validationData.length>0)){e.next=24;break}if(g=!0,2===i.validationData.length){e.next=16;break}throw 3===i.validationData.length?new Hh("validationData including sample weights is not supported yet."):new Gh("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+i.validationData+" is invalid.");case 16:return u=i.validationData[0],c=i.validationData[1],y=!0,e.next=20,t.standardizeUserData(u,c,null,null,y,d);case 20:_=e.sent,l=_[0],h=_[1],v=l.concat(h),e.next=25;break;case 24:null!=i.validationSplit&&i.validationSplit>0&&i.validationSplit<1?(g=!0,b=Math.floor(o[0].shape[0]*(1-i.validationSplit)),k=o[0].shape[0],l=hm(o,b,k),o=hm(o,0,b),h=hm(s,b,k),s=hm(s,0,b),v=l.concat(h)):null!=i.validationSteps&&(g=!0);case 25:return w=o.concat(s).concat(f),t.checkTrainableWeightsConsistency(),x=t.makeTrainFunction(),C=t.getDedupedMetricsNames(),g?(t.makeTestFunction(),S=t.testFunction,T=C.slice().concat(C.map((function(e){return"val_"+e})))):(S=null,v=[],T=C.slice()),A=_p(i.callbacks,i.yieldEvery),e.next=32,function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a,i,o,s,u,c,l,h,f,d,p,m,v){var g,y,_,b,k,w,x,C;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==o&&(o=32),null==s&&(s=1),null==f&&(f=!0),null==p&&(p=0),g=!1,null!=l&&null!=h&&(g=!0),null!=(y=t.checkNumSamples(a,o,null,"steps_per_epoch"))&&(_=Wf(0,y)),null==u&&(u=1),b=kp(c,u,s,p,y,null,o,g,d),k=b.callbackList,w=b.history,k.setModel(t),t.history=w,e.next=10,k.onTrainBegin();case 10:t.stopTraining_=!1,x=regeneratorRuntime.mark((function e(s){var u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.onEpochBegin(s);case 2:return u={},e.delegateYield(regeneratorRuntime.mark((function e(){var s,c,d,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("batch"!==f){e.next=2;break}throw new Hh("batch shuffling is not implemneted yet");case 2:f&&r.shuffle(_),s=Fs(_),c=dm(y,o),d=regeneratorRuntime.mark((function e(r){var f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f={},e.next=3,k.onBatchBegin(r,f);case 3:return sa((function(){var e=c[r][0],d=c[r][1],p=Kf(s,e,d-e);f.batch=r,f.size=d-e;for(var m=fm(a,p),v=n(m),y=0;y<i.length;++y){var _=v[y];f[i[y]]=_,ca(_)}if(r===c.length-1&&g)for(var b=t.testLoop(l,h,o),k=0;k<i.length;++k){var w=i[k],x=b[k];ca(x),u["val_"+w]=x}})),e.next=6,k.onBatchEnd(r,f);case 6:if(dp(f),!t.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),p=0;case 6:if(!(p<c.length)){e.next=14;break}return e.delegateYield(d(p),"t0",8);case 8:if("break"!==e.t0){e.next=11;break}return e.abrupt("break",14);case 11:++p,e.next=6;break;case 14:s.dispose();case 15:case"end":return e.stop()}}),e)}))(),"t0",4);case 4:return e.next=6,k.onEpochEnd(s,u);case 6:if(!t.stopTraining_){e.next=8;break}return e.abrupt("return","break");case 8:case"end":return e.stop()}}),e)})),C=p;case 13:if(!(C<s)){e.next=21;break}return e.delegateYield(x(C),"t0",15);case 15:if("break"!==e.t0){e.next=18;break}return e.abrupt("break",21);case 18:++C,e.next=13;break;case 21:return e.next=23,k.onTrainEnd();case 23:return e.next=25,t.history.syncData();case 25:return e.abrupt("return",t.history);case 26:case"end":return e.stop()}}),e)})));return function(t,n,r,a,i,o,s,u,c,l,h,f,d,p,m){return e.apply(this,arguments)}}()(t,x,w,C,d,i.epochs,i.verbose,A,S,v,i.shuffle,T,i.initialEpoch);case 32:return e.abrupt("return",e.sent);case 33:return e.prev=33,t.isTraining=!1,mm(o,n),mm(s,a),mm(l,u),mm(h,c),null!=f&&ua(f),e.finish(33);case 36:case"end":return e.stop()}}),e,null,[[4,,33,36]])})));return function(t,n,r){return e.apply(this,arguments)}}()(this,t,n,a));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"fitDataset",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,a){var i,o,s,u,c,l,h,f,d,p,m,v,g,y,_,b,k,w,x,C,S,T,A,E,I,R,O,N,D,P,F,M;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null!=a.batchesPerEpoch,r.assert(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),r.assert(null!=a,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),r.assert(null!=a.epochs&&a.epochs>0&&Number.isInteger(a.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got "+a.epochs})),r.assert(!i||a.batchesPerEpoch>0&&Number.isInteger(a.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+a.batchesPerEpoch})),r.assert(null==a.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,(o=null!=a.validationData)&&(cm(a.validationData)?r.assert(null==a.validationBatches||a.validationBatches>0&&Number.isInteger(a.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+a.validationBatches})):(c=function(e){if(3===e.length)throw new Hh("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}(a.validationData),s=c.xs,u=c.ys)),l=t.makeTrainFunction(),h=t.getDedupedMetricsNames(),f=o?h.slice().concat(h.map((function(e){return"val_"+e}))):h.slice(),d=_p(a.callbacks,a.yieldEvery),p=null==a.verbose?1:a.verbose,m=kp(d,p,a.epochs,null,null,function(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}(n,a),null,o,f),v=m.callbackList,g=m.history,v.setModel(t),t.history=g,e.next=14,v.onTrainBegin();case 14:return t.stopTraining_=!1,y=null==a.initialEpoch?0:a.initialEpoch,e.next=18,n.iterator();case 18:_=e.sent;case 19:if(!(y<a.epochs)){e.next=89;break}return b={},e.next=23,v.onEpochBegin(y);case 23:if(k=0,w=0,e.t0=i,e.t0){e.next=29;break}return e.next=28,n.iterator();case 28:_=e.sent;case 29:if(i&&!(k<a.batchesPerEpoch)){e.next=82;break}return e.next=32,_.next();case 32:if(x=e.sent,!i||!x.done){e.next=36;break}return console.warn("You provided `batchesPerEpoch` as "+a.batchesPerEpoch+", but your dataset iterator ran out of data after "+k+" batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+a.batchesPerEpoch*a.epochs+" batches). You may need to use the repeat() function when building your dataset."),e.abrupt("break",82);case 36:if(null==x.value){e.next=63;break}return C=sm(t,x.value),S=C.xs,T=C.ys,(A={}).batch=w,A.size=S[0].shape[0],e.next=42,v.onBatchBegin(w,A);case 42:if(E=[],null==a.classWeight){e.next=55;break}I=rm(a.classWeight,t.outputNames),R=0;case 46:if(!(R<I.length)){e.next=55;break}return e.t1=E,e.next=50,am(T[R],null,I[R]);case 50:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 52:++R,e.next=46;break;case 55:for(O=S.concat(T).concat(E),N=l(O),ua(O),D=0;D<h.length;++D)P=N[D],A[h[D]]=P,ca(P);return e.next=60,v.onBatchEnd(w,A);case 60:dp(A),w++,k++;case 63:if(!(i?k>=a.batchesPerEpoch:x.done)){e.next=78;break}if(!o){e.next=77;break}if(F=void 0,!cm(a.validationData)){e.next=74;break}return e.t4=Jh,e.next=70,t.evaluateDataset(a.validationData,{batches:a.validationBatches});case 70:e.t5=e.sent,e.t3=(0,e.t4)(e.t5),e.next=75;break;case 74:e.t3=Jh(t.evaluate(s,u,{batchSize:null==a.validationBatchSize?32:a.validationBatchSize,verbose:0}));case 75:for(F=e.t3,M=0;M<t.metricsNames.length;++M)b["val_"+t.metricsNames[M]]=F[M];case 77:return e.abrupt("break",82);case 78:if(!t.stopTraining_){e.next=80;break}return e.abrupt("break",82);case 80:e.next=29;break;case 82:return e.next=84,v.onEpochEnd(y,b);case 84:if(y++,!t.stopTraining_){e.next=87;break}return e.abrupt("break",89);case 87:e.next=19;break;case 89:return e.next=91,v.onTrainEnd();case 91:return e.next=93,t.history.syncData();case 93:return e.abrupt("return",t.history);case 94:return e.prev=94,t.isTraining=!1,e.finish(94);case 97:case"end":return e.stop()}}),e,null,[[4,,94,97]])})));return function(t,n,r){return e.apply(this,arguments)}}()(this,t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"trainOnBatch",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction()(a.concat(i)),s=[],u=_createForOfIteratorHelper(o),e.prev=8,u.s();case 10:if((c=u.n()).done){e.next=18;break}return l=c.value,e.next=14,l.data();case 14:h=e.sent,s.push(h[0]);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:return e.abrupt("return",(ua(o),Zh(s)));case 27:case"end":return e.stop()}}),e,this,[[8,20,23,26]])}))),function(e,t){return n.apply(this,arguments)})},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"dispose",value:function(){var e=_get(_getPrototypeOf(l.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=ia().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-ia().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"==typeof this.loss)e=$h(this.loss);else if(Array.isArray(this.loss)){var t,n=_createForOfIteratorHelper(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!=typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(sI){n.e(sI)}finally{n.f()}e=this.loss.map((function(e){return $h(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!=typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=$h(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[$h(Up(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return $h(Up(e))}));var e={};for(var t in this.metrics)e[t]=$h(Up(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=wp(Qp(e.optimizer_config));if("string"==typeof e.loss)t=ef(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return ef(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=ef(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return ef(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=ef(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,s,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=o.getSaveHandlers(t)).length){e.next=4;break}throw new Gh("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Gh("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Gh("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.next=11,o.encodeWeights(this.getNamedWeights(n));case 11:if(a=e.sent,i={modelTopology:this.toJSON(null,!1),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v2.7.0",convertedBy:null},null==n||!n.includeOptimizer||null==this.optimizer){e.next=27;break}return i.trainingConfig=this.getTrainingConfig(),u="optimizer",e.t0=o,e.next=19,this.optimizer.getWeights();case 19:return e.t1=e.sent,e.t2=u,e.next=23,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 23:c=e.sent,l=c.data,h=c.specs,(s=a.specs).push.apply(s,_toConsumableArray(h)),a.data=o.concatenateArrayBuffers([a.data,l]);case 27:return e.abrupt("return",(null!=this.userDefinedMetadata&&(Wp(this.userDefinedMetadata,this.name,!0),i.userDefinedMetadata=this.userDefinedMetadata),i.weightData=a.data,i.weightSpecs=a.specs,t.save(i)));case 28:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"setUserDefinedMetadata",value:function(e){Wp(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}},{key:"stopTraining",set:function(e){this.stopTraining_=e},get:function(){return this.stopTraining_}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}}]),l}(function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=Kd(a)}if(r.supportsMasking=!1,r.trainable_=!0,r.inputs=Array.isArray(e.inputs)?e.inputs.slice():[e.inputs],r.outputs=Array.isArray(e.outputs)?e.outputs.slice():[e.outputs],of(r.inputs).length!==r.inputs.length)throw new Gh("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+r.inputs.map((function(e){return e.name})));of(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+r.outputs.map((function(e){return e.name}))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=_createForOfIteratorHelper(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.nodeIndex,c=s.tensorIndex;r.outputLayers.push(s.sourceLayer),r.outputLayersNodeIndices.push(u),r.outputLayersTensorIndices.push(c)}}catch(sI){o.e(sI)}finally{o.f()}var l,h=_createForOfIteratorHelper(r.inputs);try{for(h.s();!(l=h.n()).done;){var f=l.value,d=f.sourceLayer,p=f.nodeIndex,m=f.tensorIndex;Qh(0===p,"input layer has >1 nodes"),Qh(0===m,"input layer has >1 tensors"),r.inputLayers.push(d),r.inputLayersNodeIndices.push(p),r.inputLayersTensorIndices.push(m)}}catch(sI){h.e(sI)}finally{h.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var v=0;v<r.inputLayers.length;v++){var g=r.inputLayers[v];if(!(g instanceof cp))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: ".concat(e.inputs,". Input ").concat(v," (0-based) originates from layer type ").concat(g.getClassName(),"."));r.inputNames.push(g.name),r.feedInputShapes.push(g.batchInputShape),r.feedInputNames.push(g.name)}var y,_=_createForOfIteratorHelper(r.outputLayers);try{for(_.s();!(y=_.n()).done;){var b=y.value;r.outputNames.push(b.name)}}catch(sI){_.e(sI)}finally{_.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var k,w={},x={},C={},S={},T={},A=[],E=function e(t,a,i,o,s,u){null!=o&&null!=s&&null!=u||(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new Wh("The tensor ".concat(t.name,' at layer "').concat(o.name,'" is part of a cycle.'));if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in T||(T[o.id]=Object.keys(T).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,h=0;h<l;h++)e(c.inputTensors[h],a,i,c.inboundLayers[h],c.nodeIndices[h],c.tensorIndices[h]);for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);A.push(c)}},I=[],R=[],O=_createForOfIteratorHelper(r.outputs);try{for(O.s();!(k=O.n()).done;){E(k.value,I,R)}}catch(sI){O.e(sI)}finally{O.f()}var N,D=_createForOfIteratorHelper(A.slice().reverse());try{for(D.s();!(N=D.n()).done;){var P=N.value;x[P.id]=P,P.id in w||(w[P.id]=0);var F=w[P.id];F=Math.max(F,null==C[P.outboundLayer.id]?0:C[P.outboundLayer.id]),C[P.outboundLayer.id]=F,S[P.outboundLayer.id]=P.outboundLayer,w[P.id]=F;for(var M=0;M<P.inboundLayers.length;M++){var L=P.inboundLayers[M].inboundNodes[P.nodeIndices[M]];w[L.id]=Math.max(F+1,null==w[L.id]?0:w[L.id]),x[L.id]=L}}}catch(sI){D.e(sI)}finally{D.f()}var z={};for(var B in w){var j=w[B];j in z||(z[j]=[]),z[j].push(x[B])}var V={};for(var q in C){var U=C[q];U in V||(V[U]=[]),V[U].push(S[q])}var W=Object.keys(V).map((function(e){return parseInt(e,10)})).sort(af);r.layers=[];var G,H=_createForOfIteratorHelper(W);try{for(H.s();!(G=H.n()).done;){var K=V[G.value];K.sort((function(e,t){var n=T[e.id],r=T[t.id];return n<r?-1:n>r?1:0}));var X,Q=_createForOfIteratorHelper(K);try{for(Q.s();!(X=Q.n()).done;){var Y=X.value;Y instanceof n&&r.internalContainerRefs.push(Y),r.layers.push(Y)}}catch(sI){Q.e(sI)}finally{Q.f()}}}catch(sI){H.e(sI)}finally{H.f()}r.layersByDepth=V,W=Object.keys(z).map((function(e){return parseInt(e,10)})).sort(af);var Z,J=r.inputs.slice(),$=[],ee=_createForOfIteratorHelper(W);try{for(ee.s();!(Z=ee.n()).done;){var te,ne=_createForOfIteratorHelper(z[Z.value]);try{for(ne.s();!(te=ne.n()).done;){var re=te.value,ae=re.outboundLayer;if(null!=ae){var ie,oe=_createForOfIteratorHelper(re.inputTensors);try{for(oe.s();!(ie=oe.n()).done;){var se=ie.value;if(-1===J.indexOf(se))throw new Wh("Graph disconnected: cannot obtain value for tensor "+se+' at layer "'.concat(ae.name,'". The following previous layers were accessed without issue: ')+$)}}catch(sI){oe.e(sI)}finally{oe.f()}var ue,ce=_createForOfIteratorHelper(re.outputTensors);try{for(ce.s();!(ue=ce.n()).done;){var le=ue.value;J.push(le)}}catch(sI){ce.e(sI)}finally{ce.f()}$.push(ae.name)}}}catch(sI){ne.e(sI)}finally{ne.f()}}}catch(sI){ee.e(sI)}finally{ee.f()}r.nodesByDepth=z;var he,fe=r.layers.map((function(e){return e.name})),de=_createForOfIteratorHelper(fe);try{var pe=function(){var e=he.value,t=fe.filter((function(t){return t===e})).length;if(1!==t)throw new Wh('The name "'.concat(e,'" is used ').concat(t," times in the model. All layer names should be unique. Layer names: ")+JSON.stringify(fe))};for(de.s();!(he=de.n()).done;)pe()}catch(sI){de.e(sI)}finally{de.f()}return r.outboundNodes=[],r.inboundNodes=[],new op({outboundLayer:_assertThisInitialized(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,_possibleConstructorReturn(r)}return _createClass2(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0==--this._refCount){var t,n=_createForOfIteratorHelper(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(sI){n.e(sI)}finally{n.f()}var a,i=_createForOfIteratorHelper(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(sI){i.e(sI)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=_createForOfIteratorHelper(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=t.value,u=_createForOfIteratorHelper(s.weights);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(null!=r[c.originalName])throw new Gh("Duplicate weight name: "+c.originalName);r[c.originalName]=c,a++}}catch(sI){u.e(sI)}finally{u.f()}}}catch(sI){i.e(sI)}finally{i.f()}var l=[];for(var h in e){var f=h;if(null==r[h]){var d=h.split("/");f=d.slice(0,-2).concat([d[d.length-1]]).join("/")}if(null!=r[f])l.push([r[f],e[h]]);else if(n)throw new Gh("Provided weight data has no target variable: "+h);delete r[f]}if(n){var p=[];for(var m in r)p.push(m);if(p.length>0)throw new Gh("".concat(p.length," of ").concat(a," weights are not set: ")+p)}tp(l)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers 2.7.0",t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=function e(t,n){if(null==t)return null;if("string"==typeof t)return $h(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var r=[],a=t.length,i=0;i<a;++i){var o=t[i];Xp(n,i,o)?r.push(o):r.push(e(o,n))}return r}for(var s={},u=0,c=Object.keys(t);u<c.length;u++){var l=c[u],h=t[l];s[$h(l)]="name"!==l&&"className"!==l||"string"!=typeof h?e(h,l):h}return s}(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return sa((function(){e=Jh(e);for(var r=new Yp,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return $p(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return sa((function(){var r;return e=Jh(e),r=null==t?Xh(null,e.length):Jh(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=Qd(e);if(t.length!==this.inputLayers.length)throw new Gh("Invalid inputShape argument ".concat(e,": model has ").concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++)n[this.inputLayers[r].name+"_0_0"]=t[r];var a=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(af);if(a.length>1){var i,o=_createForOfIteratorHelper(a);try{for(o.s();!(i=o.n()).done;){var s,u=i.value,c=_createForOfIteratorHelper(this.nodesByDepth[u]);try{for(c.s();!(s=c.n()).done;){var l=s.value,h=l.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(h.id)){for(var f=[],d=0;d<l.inboundLayers.length;d++)f.push(n["".concat(l.inboundLayers[d].name,"_").concat(l.nodeIndices[d],"_").concat(l.tensorIndices[d])]);for(var p=Qd(h.computeOutputShape(Zh(f))),m=h.inboundNodes.indexOf(l),v=0;v<p.length;v++)n["".concat(h.name,"_").concat(m,"_").concat(v)]=p[v]}}}catch(sI){c.e(sI)}finally{c.f()}}}catch(sI){o.e(sI)}finally{o.f()}}for(var g=[],y=[],_=0;_<this.outputLayers.length;_++)y.push("".concat(this.outputLayers[_].name,"_").concat(this.outputLayersNodeIndices[_],"_").concat(this.outputLayersTensorIndices[_]));for(var b=0;b<y.length;b++){var k=y[b];Qh(k in n),g.push(n[k])}return Zh(g)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=Xh(null,e.length));for(var n={},r=0;r<this.inputs.length;++r)n[this.inputs[r].id]=[e[r],t[r]];var a,i=_createForOfIteratorHelper(Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(af));try{for(i.s();!(a=i.n()).done;){var o,s=a.value,u=_createForOfIteratorHelper(this.nodesByDepth[s]);try{for(u.s();!(o=u.n()).done;){var c,l=o.value,h=l.outboundLayer,f=l.inputTensors,d=l.outputTensors,p=new Array,m=_createForOfIteratorHelper(f);try{for(m.s();!(c=m.n()).done;){var v=c.value;v.id in n&&p.push(n[v.id])}}catch(sI){m.e(sI)}finally{m.f()}if(p.length===f.length){var g=void 0,y=void 0,_=void 0,b=void 0,k={};if(null!=l.callArgs&&(k=l.callArgs),1===p.length){var w=_slicedToArray2(p[0],2),x=w[0],C=w[1];null==k.mask&&(k.mask=C),_=Jh(h.call(x,k)),b=Jh(h.computeMask(x,C)),g=[x],y=[C]}else g=p.map((function(e){return e[0]})),y=p.map((function(e){return e[1]})),null==k.mask&&(k.mask=y),_=Jh(h.call(g,k)),b=Jh(h.computeMask(g,y));if(h.activityRegularizer)throw new Hh("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var S=0;S<d.length;++S)n[d[S].id]=[_[S],b[S]]}}}catch(sI){u.e(sI)}finally{u.f()}}}catch(sI){i.e(sI)}finally{i.f()}var T,A=[],E=[],I=[],R=_createForOfIteratorHelper(this.outputs);try{for(R.s();!(T=R.n()).done;){var O=T.value;Qh(O.id in n,"Could not compute output ".concat(O.name," : ").concat(O.id));var N=_slicedToArray2(n[O.id],2),D=N[0],P=N[1];I.push(D.shape),A.push(D),E.push(P)}}catch(sI){R.e(sI)}finally{R.f()}return[A,E,I]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=_createForOfIteratorHelper(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(sI){i.e(sI)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new Gh("Was asked to retrieve layer at index ".concat(t,", but model only has ").concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new Gh("Provide either a layer name or layer index");var n,r=_createForOfIteratorHelper(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(sI){r.e(sI)}finally{r.f()}throw new Gh("No such layer: "+e)}},{key:"calculateLosses",value:function(){var e=this;return sa((function(){var t,r=[],a=_createForOfIteratorHelper(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,_toConsumableArray(i.calculateLosses()))}}catch(sI){a.e(sI)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=_createForOfIteratorHelper(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var h=o.inboundNodes[l],f=n.nodeKey(o,l),d={};if(this.containerNodes.has(f)){if(h.callArgs)try{JSON.stringify(h.callArgs),d=h.callArgs}catch(sI){console.warn("Layer ".concat(o.name," was passed non-serializable keyword arguments: ")+h.callArgs+". They will not be included in the serialized model (and thus will be missing at deserialization time)."),d={}}if(h.inboundLayers.length>0){for(var p=[],m=0;m<h.inboundLayers.length;m++){var v=h.inboundLayers[m],g=h.tensorIndices[m],y=r[n.nodeKey(v,h.nodeIndices[m])];null==y&&(y=0),p.push([v.name,y,g,d])}c.push(p)}}}var _={};_.name=o.name,_.className=s,_.config=u,_.inboundNodes=c,a.push(_)}}catch(sI){i.e(sI)}finally{i.f()}t.layers=a;for(var b=[],k=0;k<this.inputLayers.length;k++){var w=this.inputLayers[k],x=n.nodeKey(w,this.inputLayersNodeIndices[k]);if(this.containerNodes.has(x)){var C=r[x];null==C&&(C=0),b.push([w.name,C,this.inputLayersTensorIndices[k]])}}t.inputLayers=b;for(var S=[],T=0;T<this.outputLayers.length;T++){var A=this.outputLayers[T],E=n.nodeKey(A,this.outputLayersNodeIndices[T]);if(this.containerNodes.has(E)){var I=r[E];null==I&&(I=0),S.push([A.name,I,this.outputLayersTensorIndices[T]])}}return t.outputLayers=S,t}},{key:"resetStates",value:function(){var e=this;sa((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new Gh("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=_createForOfIteratorHelper(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(sI){n.e(sI)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=_createForOfIteratorHelper(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,_toConsumableArray(r.nonTrainableWeights))}}catch(sI){n.e(sI)}finally{n.f()}if(!this.trainable){var a,i=[],o=_createForOfIteratorHelper(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,_toConsumableArray(s.trainableWeights))}}catch(sI){o.e(sI)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){if(this._stateful)throw new Gh("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=_createForOfIteratorHelper(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(sI){t.e(sI)}finally{t.f()}return!1}}],[{key:"fromConfig",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=_createForOfIteratorHelper(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],h=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var f=r[c];if(f.inboundNodes.length<=l)return void i(e,t);o.push(f.inboundNodes[l].outputTensors[h])}}catch(sI){s.e(sI)}finally{s.f()}o.length>0&&e.apply(Zh(o),n)}function s(e){var a=e.name,o=wp(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new Gh("Corrupted configuration, expected array for nodeData: "+e);i(o,e)}))}var u,c=t.name,l=t.layers,h=_createForOfIteratorHelper(l);try{for(h.s();!(u=h.n()).done;){var f=u.value;s(f)}}catch(sI){h.e(sI)}finally{h.f()}for(;!sf(a);){var d,p=_createForOfIteratorHelper(l);try{for(p.s();!(d=p.n()).done;){var m=d.value,v=r[m.name];if(v.name in a){var g=a[v.name];delete a[v.name];var y,_=_createForOfIteratorHelper(g);try{for(_.s();!(y=_.n()).done;){var b=y.value;o(v,b)}}catch(sI){_.e(sI)}finally{_.f()}}}}catch(sI){p.e(sI)}finally{p.f()}}var k,w=[],x=[],C=t.inputLayers,S=_createForOfIteratorHelper(C);try{for(S.s();!(k=S.n()).done;){var T=k.value,A=T[0],E=T[1],I=T[2];Qh(A in r),w.push(r[A].inboundNodes[E].outputTensors[I])}}catch(sI){S.e(sI)}finally{S.f()}var R,O=t.outputLayers,N=_createForOfIteratorHelper(O);try{for(N.s();!(R=N.n()).done;){var D=R.value,P=D[0],F=D[1],M=D[2];Qh(P in r),x.push(r[P].inboundNodes[F].outputTensors[M])}}catch(sI){N.e(sI)}finally{N.f()}return new e({inputs:w,outputs:x,name:c})}}]),n}(up));bm.className="Model",f.registerClass(bm);var km=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return n}(bm);function wm(e,t){return xm.apply(this,arguments)}function xm(){return(xm=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("modelTopology"in t||(t={modelTopology:t}),null!=(r=(t=t).modelTopology).model_config&&(r=r.model_config),a=wp(Qp(r),n),null==t.weightsManifest){e.next=12;break}return e.next=7,o.loadWeights(t.weightsManifest,t.pathPrefix,a.weights.map((function(e){return e.originalName})));case 7:i=e.sent,s={},u=_createForOfIteratorHelper(a.weights);try{for(u.s();!(c=u.n()).done;)l=c.value,s[l.originalName]=i[l.originalName]}catch(sI){u.e(sI)}finally{u.f()}a.loadWeights(s),ua(i);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}km.className="Functional",f.registerClass(km);var Cm=function(e){_inherits(s,e);var t,n,a,i,o=_createSuper(s);function s(e){var t;if(_classCallCheck2(this,s),e=e||{},(t=o.call(this,{inputs:[],outputs:[]})).trainable=!0,t.built=!1,t.name=null!=e.name?e.name:Kd("sequential_"),null!=e.layers){var n,r=_createForOfIteratorHelper(e.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;t.add(a)}}catch(sI){r.e(sI)}finally{r.f()}}return _possibleConstructorReturn(t)}return _createClass2(s,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new Gh("Negative dimension size caused by adding layer "+e.name+" with input shape ["+e.inboundNodes[0].inputTensors[0].shape+"]")}},{key:"add",value:function(e){var t,n=e instanceof s||e instanceof bm;if(n){if(1!==(t=e).outputs.length)throw new Gh("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new Gh("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new Gh("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var r=lp({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(n)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new Gh("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ".concat(e.name," which has ").concat(e.inboundNodes.length," pre-existing inbound connections."));if(1!==e.inboundNodes[0].outputTensors.length)throw new Gh("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=function e(t,n,r){if((null==n||null!=r&&r>0)&&(n=t.sourceLayer,r=t.nodeIndex),0===n.inboundNodes.length)return[t];var a=n.inboundNodes[r];if(0===a.inboundLayers.length)return a.inputTensors;for(var i=[],o=0;o<a.inboundLayers.length;o++){var s,u=_createForOfIteratorHelper(e(a.inputTensors[o],a.inboundLayers[o],a.nodeIndices[o]));try{for(u.s();!(s=u.n()).done;){var c=s.value;-1===i.indexOf(c)&&i.push(c)}}catch(sI){u.e(sI)}finally{u.f()}}return i}(this.outputs[0])}this.inboundNodes=[],new op({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Xh(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var a=e.apply(this.outputs[0]);if(Array.isArray(a))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[a],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(Zd(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new bm({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),_get(_getPrototypeOf(s.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),_get(_getPrototypeOf(s.prototype),"summary",this).call(this,e,t,n)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new Wh("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new Wh("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"fit",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new Wh("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"fitDataset",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new Wh("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"trainOnBatch",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"getConfig",value:function(){var e,t=[],n=_createForOfIteratorHelper(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(sI){n.e(sI)}finally{n.f()}return{name:this.name,layers:t}}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"stopTraining",set:function(e){if(null==this.model)throw new Gh("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e},get:function(){if(null==this.model)throw new Gh("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}}],[{key:"fromConfig",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var n,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new Gh("Legacy serialization format not supported yet.");n=t}else r.assert(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),n=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof s))throw new Hh("Sequential.fromConfig called on non-Sequential input: "+o);var u,c=_createForOfIteratorHelper(n);try{for(c.s();!(u=c.n()).done;){var l=u.value,h=wp(l,void 0,a);a&&h.setFastWeightInitDuringBuild(!0),o.add(h)}}catch(sI){c.e(sI)}finally{c.f()}return o}}]),s}(bm);function Sm(e){return new bm(e)}function Tm(e){return new Cm(e)}function Am(e,t){return null==t&&(t={}),(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),"string"!=typeof t){e.next=9;break}if(0!==(r=o.getLoadHandlers(t,n)).length){e.next=6;break}r.push(o.browserHTTPRequest(t,n)),e.next=8;break;case 6:if(!(r.length>1)){e.next=8;break}throw new Gh("Found more than one (".concat(r.length,") load handlers for URL '").concat(t,"'"));case 8:t=r[0];case 9:return e.abrupt("return",function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,s,u,c,l,h,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r&&(r={}),null!=t.load){e.next=2;break}throw new Gh("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 2:return e.next=4,t.load();case 4:if(a=e.sent,null!=(i=a.modelTopology).model_config&&(i=i.model_config),s=null==r.strict||r.strict,u=null!=a.weightData&&null!=a.weightSpecs&&s,c=wp(Qp(i),void 0,u),null!=(l=a.trainingConfig)&&c.loadTrainingConfig(l),null!=a.userDefinedMetadata&&c.setUserDefinedMetadata(a.userDefinedMetadata),null==a.weightData){e.next=19;break}if(null!=a.weightSpecs){e.next=11;break}throw new Gh("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");case 11:if(h=function(e,t){var n=o.decodeWeights(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}(a.weightData,a.weightSpecs),f=h.modelWeights,d=h.optimizerWeights,c.loadWeights(f,s),e.t0=null!=c.optimizer&&d.length>0,!e.t0){e.next=17;break}return e.next=17,c.optimizer.setWeights(d);case 17:ua(f),ua(d.map((function(e){return e.tensor})));case 19:return e.abrupt("return",c);case 20:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()(t,0,n));case 10:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})(e,t);var n}function Em(e){return lp(e)}function Im(e,t){bp.registerCallbackConstructor(e,t)}Cm.className="Sequential",f.registerClass(Cm);var Rm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"getConfig",value:function(){return{}}}]),n}(f.Serializable),Om=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new Hh("Support for alpha values other than 1 (".concat(t,") is not implemented yet."));return go(e)}(e,t)}}]),n}(Rm);Om.className="elu",f.registerClass(Om);var Nm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){return Ks(e)}}]),n}(Rm);Nm.className="selu",f.registerClass(Nm);var Dm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){return zs(e)}}]),n}(Rm);Dm.className="relu",f.registerClass(Dm);var Pm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){return sa((function(){return us(6,zs(e))}))}}]),n}(Rm);Pm.className="relu6",f.registerClass(Pm);var Fm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){return e}}]),n}(Rm);Fm.className="linear",f.registerClass(Fm);var Mm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){return Fi(e)}}]),n}(Rm);Mm.className="sigmoid",f.registerClass(Mm);var Lm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){return function(e){return sa((function(){var t=ba(.5,xa(.2,e));return Ki(t,0,1)}))}(e)}}]),n}(Rm);Lm.className="hardSigmoid",f.registerClass(Lm);var zm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){return Go(e)}}]),n}(Rm);zm.className="softplus",f.registerClass(zm);var Bm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){return function(e){return sa((function(){return wa(e,qa(e).add(1))}))}(e)}}]),n}(Rm);Bm.className="softsign",f.registerClass(Bm);var jm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){return Li(e)}}]),n}(Rm);jm.className="tanh",f.registerClass(jm);var Vm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return ru(e,t)}}]),n}(Rm);Vm.className="softmax",f.registerClass(Vm);var qm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return Qo(e,t)}}]),n}(Rm);qm.className="logSoftmax",f.registerClass(qm);var Um=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return sa((function(){return Fi(e.mul(t)).mul(e)}))}}]),n}(Rm);function Wm(e){return e.getClassName()}function Gm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return rf(e,f.SerializationMap.getMap().classNameMap,t,"activation")}function Hm(e){if(null==e)return Gm({className:"linear",config:{}});if("string"==typeof e){var t={};return t.className=e,t.config={},Gm(t)}return e instanceof Rm?e:Gm(e)}function Km(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: "+e)}Um.className="swish",f.registerClass(Um);var Xm=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return n}(f.Serializable),Qm=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this),Km(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return _createClass2(n,[{key:"apply",value:function(e){var t=this;return sa((function(){var n=as([1]);return t.hasL1&&(n=ba(n,Xo(xa(t.l1,qa(e))))),t.hasL2&&(n=ba(n,Xo(xa(t.l2,nd(e))))),n.asScalar()}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(Xm);Qm.className="L1L2",f.registerClass(Qm);var Ym={l1l2:"L1L2"};function Zm(e){return nf(e)}function Jm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return rf(e,f.SerializationMap.getMap().classNameMap,t,"regularizer")}function $m(e){return null==e?null:"string"==typeof e?Jm({className:e in Ym?Ym[e]:e,config:{}}):e instanceof Xm?e:Jm(e)}var ev=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return _createClass2(n,[{key:"call",value:function(e,t){e=Yd(e);var n=zs(e);return null!=this.maxValue&&(n=Ki(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);ev.className="ReLU",f.registerClass(ev);var tv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return _createClass2(n,[{key:"call",value:function(e,t){var n=Yd(e);return Lo(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);tv.className="LeakyReLU",f.registerClass(tv);var nv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=Ed(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=$m(e.alphaRegularizer),r.alphaConstraint=kf(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new Gh("Expected sharedAxes to be a number or an array of numbers, but got "+e.sharedAxes);r.sharedAxes=[e.sharedAxes]}return _possibleConstructorReturn(r)}return _createClass2(n,[{key:"build",value:function(e){var t=(e=Zd(e)).slice(1);if(null!=this.sharedAxes){var n,r=_createForOfIteratorHelper(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(sI){r.e(sI)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new rp({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=Yd(e),Ss(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:Ad(this.alphaInitializer),alphaRegularizer:Zm(this.alphaRegularizer),alphaConstraint:_f(this.alphaConstraint),sharedAxes:this.sharedAxes},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);nv.className="PReLU",f.registerClass(nv);var rv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new Hh("Non-default alpha value (".concat(e.alpha,") is not supported by the ELU layer yet."));return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,_possibleConstructorReturn(r)}return _createClass2(n,[{key:"call",value:function(e,t){var n=Yd(e);return go(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);rv.className="ELU",f.registerClass(rv);var av=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return _createClass2(n,[{key:"call",value:function(e,t){var n=Yd(e);return n.mul(Gf(n.greater(this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);av.className="ThresholdedReLU",f.registerClass(av);var iv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new Vm).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return _createClass2(n,[{key:"call",value:function(e,t){var n=Yd(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);function ov(e,t,n){if("number"==typeof e)return Xh(e,t);if(e.length!==t)throw new Gh("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if((i=a)!==parseInt(i.toString(),10))throw new Gh("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(JSON.stringify(e)," including a non-integer number ")+a)}return e;var i}function sv(e,t,n,r){var a,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return null==e?e:(a="same"===n?e:e-(t+(t-1)*(i-1))+1,Math.floor((a+r-1)/r))}function uv(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+Uf([n-t,0]);else{if("same"!==r)throw new Gh("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function cv(e,t){return sa((function(){return Of(t),"channelsFirst"===t?mr(e,[0,2,3,1]):e}))}function lv(e,t){return sa((function(){return Of(t),"channelsFirst"===t?mr(e,[0,2,3,4,1]):e}))}function hv(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return sa((function(){if(null==i&&(i="channelsLast"),Of(i),3!==e.rank&&4!==e.rank)throw new Gh("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new Gh("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ".concat(e.rank,"."));var u=cv(e,i);if("causal"===a)throw new Hh("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=m.conv2d({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=mr(u,[0,3,1,2])),u}))}iv.className="Softmax",f.registerClass(iv);var fv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;if(_classCallCheck2(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,lf(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new Hh("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is not implemented yet."));if(a.kernelSize=ov(r.kernelSize,e,"kernelSize"),a.strides=ov(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,Nf(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,Of(a.dataFormat),a.activation=Hm(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=Ed(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=kf(r.biasConstraint),a.biasRegularizer=$m(r.biasRegularizer),a.activityRegularizer=$m(r.activityRegularizer),a.dilationRate=ov(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new Gh("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(a.dilationRate));if(2===a.rank){if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new Gh("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(a.dilationRate))}else if(3===a.rank)if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new Gh("dilationRate must be a number or array of three numbers for 3D convolution, but received "+JSON.stringify(a.dilationRate));return _possibleConstructorReturn(a)}return _createClass2(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Wm(this.activation),useBias:this.useBias,biasInitializer:Ad(this.biasInitializer),biasRegularizer:Zm(this.biasRegularizer),activityRegularizer:Zm(this.activityRegularizer),biasConstraint:_f(this.biasConstraint)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(Qh("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!cf(e.kernelSize,"number",1,3))throw new Gh("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(up),dv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,lf(a.filters,"filters"),a.kernelInitializer=Ed(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=kf(r.kernelConstraint),a.kernelRegularizer=$m(r.kernelRegularizer),a}return _createClass2(n,[{key:"build",value:function(e){e=Zd(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Gh("The channel dimension of the input should be defined. Found "+e[t]);var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:_defineProperty({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return sa((function(){var t;e=Yd(e);var r=null==n.bias?null:n.bias.read(),a=hf(n.activation.getClassName());if(null!=a&&2===n.rank)t=hv(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return sa((function(){if(null==i&&(i="channelsLast"),Of(i),3!==e.shape.length)throw new Gh("The input of a conv1dWithBias operation should be 3, but is "+e.shape.length+" instead.");if(3!==t.shape.length)throw new Gh("The kernel for a conv1dWithBias operation should be 3, but is "+t.shape.length+" instead");if(null!=n&&1!==n.shape.length)throw new Gh("The bias for a conv1dWithBias operation should be 1, but is "+t.shape.length+" instead");if("channelsFirst"===i&&(e=mr(e,[0,2,1])),"causal"===a)throw new Hh("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=$i(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=ad(s,n)),s}))}(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=hv(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new Hh("convolutions greater than 3D are not implemented yet.");t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return sa((function(){if(null==i&&(i="channelsLast"),Of(i),4!==e.rank&&5!==e.rank)throw new Gh("conv3dWithBias expects input to be of rank 4 or 5, but received "+e.rank+".");if(4!==t.rank&&5!==t.rank)throw new Gh("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+e.rank+".");var s=lv(e,i);if("causal"===a)throw new Hh("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=no(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=ad(s,n)),"channelsFirst"===i&&(s=mr(s,[0,4,1,2,3])),s}))}(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=Zd(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=sv(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:Ad(this.kernelInitializer),kernelRegularizer:Zm(this.kernelRegularizer),kernelConstraint:_f(this.kernelConstraint)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new Gh("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(e.filters))}}]),n}(fv),pv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return _createClass2(n,[{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!cf(e.kernelSize,"number",1,2))throw new Gh("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(dv);pv.className="Conv2D",f.registerClass(pv);var mv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return _createClass2(n,[{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new Gh("Conv3D expects config.kernelSize to be number or [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(dv);mv.className="Conv3D",f.registerClass(mv);var vv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),(r=t.call(this,e)).inputSpec=[new rp({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new Gh("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+r.padding);return _possibleConstructorReturn(r)}return _createClass2(n,[{key:"build",value:function(e){if(4!==(e=Zd(e)).length)throw new Gh("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Gh("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new rp({ndim:4,axes:_defineProperty({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return sa((function(){var t=Yd(e);if(4!==t.shape.length)throw new Gh("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+t.shape.length);var r,a,i=t.shape;"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var o=i[a],s=n.kernelSize[1],u=n.strides[1],c=[i[0],uv(i[r],n.strides[0],n.kernelSize[0],n.padding),uv(o,u,s,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=mr(t,[0,2,3,1]));var l=to(t,n.kernel.read(),c,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(l=mr(l,[0,3,1,2])),null!=n.bias&&(l=ad(l,n.bias.read(),n.dataFormat)),null!=n.activation&&(l=n.activation.apply(l)),l}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=Zd(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=uv(a[n],s,i,this.padding),a[r]=uv(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(pv);vv.className="Conv2DTranspose",f.registerClass(vv);var gv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;if(_classCallCheck2(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new Gh("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new Gh("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new Gh("SeparableConv".concat(a.rank,"D supports only padding modes: 'same' and 'valid', but received ")+JSON.stringify(r.padding));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=Ed(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=$m(r.depthwiseRegularizer),a.depthwiseConstraint=kf(r.depthwiseConstraint),a.pointwiseInitializer=Ed(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=$m(r.pointwiseRegularizer),a.pointwiseConstraint=kf(r.pointwiseConstraint),_possibleConstructorReturn(a)}return _createClass2(n,[{key:"build",value:function(e){if((e=Zd(e)).length<this.rank+2)throw new Gh("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+(this.rank+2)+", but received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new Gh("The channel dimension of the inputs should be defined, but found "+JSON.stringify(e[t]));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters),this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,!0,this.pointwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.inputSpec=[new rp({ndim:this.rank+2,axes:_defineProperty({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return sa((function(){var t;if(e=Yd(e),1===n.rank)throw new Hh("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=mr(e,[0,2,3,1])),t=Xs(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=ad(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=mr(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Ad(this.depthwiseInitializer),e.pointwiseInitializer=Ad(this.pointwiseInitializer),e.depthwiseRegularizer=Zm(this.depthwiseRegularizer),e.pointwiseRegularizer=Zm(this.pointwiseRegularizer),e.depthwiseConstraint=_f(this.depthwiseConstraint),e.pointwiseConstraint=_f(this.pointwiseConstraint),e}}]),n}(dv);gv.className="SeparableConv";var yv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,2,e)}return n}(gv);yv.className="SeparableConv2D",f.registerClass(yv);var _v=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return _createClass2(n,[{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!cf(e.kernelSize,"number",1,1))throw new Gh("Conv1D expects config.kernelSize to be number or number[] with length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(dv);_v.className="Conv1D",f.registerClass(_v);var bv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).cropping="number"==typeof e.cropping?[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return _createClass2(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return sa((function(){if(e=Yd(e),"channelsLast"===n.dataFormat){var t=Qf(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return Qf(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=Qf(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return Qf(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);bv.className="Cropping2D",f.registerClass(bv);var kv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,r}return _createClass2(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],null==e[2]?null:this.size[0]*e[2],null==e[3]?null:this.size[1]*e[3]]:[e[0],null==e[1]?null:this.size[0]*e[1],null==e[2]?null:this.size[1]*e[2],e[3]]}},{key:"call",value:function(e,t){var n=this;return sa((function(){var t=Yd(e),r=t.shape;if("channelsFirst"===n.dataFormat){var a=(t=mr(t,[0,2,3,1])).resizeNearestNeighbor([n.size[0]*r[2],n.size[1]*r[3]]);return mr(a,[0,3,1,2])}return t.resizeNearestNeighbor([n.size[0]*r[1],n.size[1]*r[2]])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);kv.className="UpSampling2D",f.registerClass(kv);var wv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=Ed(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=kf(e.depthwiseConstraint),r.depthwiseRegularizer=$m(e.depthwiseRegularizer),r}return _createClass2(n,[{key:"build",value:function(e){if((e=Zd(e)).length<4)throw new Gh("Inputs to DepthwiseConv2D should have rank 4. Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new Gh("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (".concat(e[t],")."));var n=e[t];this.depthwiseKernel=this.addWeight("depthwise_kernel",[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier],null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.bias=this.useBias?this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return sa((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return sa((function(){null==a&&(a="channelsLast"),Of(a);var o=cv(e,a);if(4!==e.rank)throw new Gh("Input for depthwiseConv2d is required to be 4-D, but is instead "+e.rank+"-D");if(4!==t.rank)throw new Gh("depthwiseKernel is required to be 4-D, but is instead "+t.rank+"-D");return o=co(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=mr(o,[0,3,1,2])),o}))}(e=Yd(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=ad(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=Zd(e);var t="channelsFirst"===this.dataFormat?e[3]:e[2],n="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,r=sv("channelsFirst"===this.dataFormat?e[2]:e[1],this.kernelSize[0],this.padding,this.strides[0]),a=sv(t,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],n,r,a]:[e[0],r,a,n]}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Ad(this.depthwiseInitializer),e.depthwiseRegularizer=Zm(this.depthwiseRegularizer),e.depthwiseConstraint=_f(this.depthwiseRegularizer),e}}]),n}(fv);function xv(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new Gh("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function Cv(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return sa((function(){var u=t.shape.length;if(u<3)throw new Gh("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(Wf(2,u));if(t=mr(t,c),null!=i)throw new Hh("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=a.asType("bool").asType("float32")).rank===u-1&&(a=bo(a,-1)),a=mr(a,c)),r&&(t=js(t,0),null!=a&&(a=js(a,0)));var l,h,f,d=[],p=n,m=t.shape[0],v=Cu(t);null!=a&&(h=Cu(a));for(var g=function(t){var n=v[t],r=sa((function(){return e(n,p)}));if(null==a)l=r[0],p=r[1];else{var i=sa((function(){var e=h[t],n=vs(e).sub(e);return{output:r[0].mul(e).add(p[0].mul(n)),newStates:p.map((function(t,a){return r[1][a].mul(e).add(t.mul(n))}))}}));l=i.output,p=i.newStates}s&&d.push(l)},y=0;y<m;++y)g(y);return s&&(f=fu(d,1)),[l,f,p]}))}wv.className="DepthwiseConv2D",f.registerClass(wv);var Sv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r,a;if(_classCallCheck2(this,n),r=t.call(this,e),null==e.cell)throw new Gh("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new Dv({cells:e.cell}):e.cell).stateSize)throw new Gh("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new rp({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],_possibleConstructorReturn(r)}return _createClass2(n,[{key:"getStates",value:function(){return null==this.states_?Wf(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){Xd(e)&&(e=e[0]),e=e;var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=_createForOfIteratorHelper(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(sI){o.e(sI)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return sa((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"build",value:function(e){if(null!=this.numConstants)throw new Hh("Constants support is not implemented in RNN yet.");Xd(e)&&(e=e[0]),e=e;var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new rp({shape:[t,null].concat(_toConsumableArray(n))});var a,i=[e[0]].concat(e.slice(2));if(this.cell.build(i),a=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!r.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),a))throw new Gh("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; However cell.stateSize is ")+this.cell.stateSize)}else this.stateSpec=a.map((function(e){return new rp({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];sa((function(){if(!t.stateful)throw new Uh("Cannot call resetStates() on an RNN Layer that is not stateful.");var a=t.inputSpec[0].shape[0];if(null==a)throw new Gh("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)t.states_=Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return as([a,e])})):[as([a,t.cell.stateSize])];else if(null==e)ua(t.states_),null!=t.keptStates&&(ua(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return as([a,e])})):t.states_[0]=as([a,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new Gh("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ")+e);!0===n?t.keptStates.push(t.states_.slice()):ua(t.states_);for(var i=0;i<t.states_.length;++i){var o=e[i],s=Array.isArray(t.cell.stateSize)?t.cell.stateSize[i]:t.cell.stateSize,u=[a,s];if(!r.arraysEqual(o.shape,u))throw new Gh("State ".concat(i," is incompatible with layer ").concat(t.name,": expected shape=").concat(u,", received shape=").concat(o.shape));t.states_[i]=o}}t.states_=t.states_.map((function(e){return ca(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=xv(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=_createForOfIteratorHelper(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new rp({shape:l.shape}))}}catch(sI){c.e(sI)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof ap){var h=[e].concat(o),f=this.inputSpec.concat(s),d=this.inputSpec;this.inputSpec=f;var p=_get(_getPrototypeOf(n.prototype),"apply",this).call(this,h,t);return this.inputSpec=d,p}return _get(_getPrototypeOf(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return sa((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=Yd(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new Gh("RNN Layer has ".concat(o," state(s) but was passed ")+i.length+" initial state(s).");n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=Cv((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],h=u[2];n.stateful&&n.resetStates(h,a);var f=n.returnSequences?l:c;return n.returnState?[f].concat(h):f}))}},{key:"getInitialState",value:function(e){var t=this;return sa((function(){var n=as(e.shape);return n=Hf(n=Xo(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?Jf(n,[1,e]):n})):t.cell.stateSize>1?[Jf(n,[1,t.cell.stateSize])]:[n]}))}},{key:"setFastWeightInitDuringBuild",value:function(e){_get(_getPrototypeOf(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign({},r,e,t)}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=wp(t.cell,n);return new e(Object.assign(t,{cell:r}))}}]),n}(up);Sv.className="RNN",f.registerClass(Sv);var Tv=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return n}(up),Av=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,lf(r.units,"units"),r.activation=Hm(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Ed(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Ed(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Ed(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=$m(e.kernelRegularizer),r.recurrentRegularizer=$m(e.recurrentRegularizer),r.biasRegularizer=$m(e.biasRegularizer),r.kernelConstraint=kf(e.kernelConstraint),r.recurrentConstraint=kf(e.recurrentConstraint),r.biasConstraint=kf(e.biasConstraint),r.dropout=qf([1,Uf([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=qf([1,Uf([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return _createClass2(n,[{key:"build",value:function(e){e=Zd(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return sa((function(){if(2!==(e=e).length)throw new Gh("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a,i=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Pv({ones:function(){return vs(e)},rate:n.dropout,training:i})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Pv({ones:function(){return vs(r)},rate:n.recurrentDropout,training:i}));var o=n.dropoutMask,s=n.recurrentDropoutMask;a=ed(null!=o?xa(e,o):e,n.kernel.read()),null!=n.bias&&(a=ad(a,n.bias.read())),null!=s&&(r=xa(r,s));var u=ba(a,ed(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:Wm(this.activation),useBias:this.useBias,kernelInitializer:Ad(this.kernelInitializer),recurrentInitializer:Ad(this.recurrentInitializer),biasInitializer:Ad(this.biasInitializer),kernelRegularizer:Zm(this.kernelRegularizer),recurrentRegularizer:Zm(this.recurrentRegularizer),biasRegularizer:Zm(this.biasRegularizer),activityRegularizer:Zm(this.activityRegularizer),kernelConstraint:_f(this.kernelConstraint),recurrentConstraint:_f(this.recurrentConstraint),biasConstraint:_f(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}]),n}(Tv);Av.className="SimpleRNNCell",f.registerClass(Av);var Ev=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),e.cell=new Av(e),t.call(this,e)}return _createClass2(n,[{key:"call",value:function(e,t){var r=this;return sa((function(){return null!=r.cell.dropoutMask&&(ua(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(ua(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),_get(_getPrototypeOf(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(Sv);Ev.className="SimpleRNN",f.registerClass(Ev);var Iv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new Gh("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,lf(r.units,"units"),r.activation=Hm(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=Hm(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Ed(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Ed(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Ed(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=$m(e.kernelRegularizer),r.recurrentRegularizer=$m(e.recurrentRegularizer),r.biasRegularizer=$m(e.biasRegularizer),r.kernelConstraint=kf(e.kernelConstraint),r.recurrentConstraint=kf(e.recurrentConstraint),r.biasConstraint=kf(e.biasConstraint),r.dropout=qf([1,Uf([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=qf([1,Uf([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,_possibleConstructorReturn(r)}return _createClass2(n,[{key:"build",value:function(e){e=Zd(e),this.kernel=this.addWeight("kernel",[e[e.length-1],3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.bias=this.useBias?this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return sa((function(){if(2!==(e=e).length)throw new Gh("GRUCell expects 2 input Tensors (inputs, h, c), got "+e.length+".");var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Pv({ones:function(){return vs(e)},rate:n.dropout,training:r,count:3})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Pv({ones:function(){return vs(a)},rate:n.recurrentDropout,training:r,count:3}));var i,o,s,u=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=xa(e,n.dropoutMask[0]));var c=ed(e,n.kernel.read());n.useBias&&(c=ad(c,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=xa(a,u[0]));var l=n.recurrentKernel.read(),h=_slicedToArray2(uu(l,[2*n.units,n.units],l.rank-1),2),f=h[0],d=h[1],p=ed(a,f),m=_slicedToArray2(uu(c,3,c.rank-1),3),v=m[0],g=m[1],y=m[2],_=_slicedToArray2(uu(p,2,p.rank-1),2),b=_[0],k=_[1];i=n.recurrentActivation.apply(ba(v,b)),o=n.recurrentActivation.apply(ba(g,k));var w=ed(xa(o,a),d);s=n.activation.apply(ba(y,w));var x=ba(xa(i,a),xa(ba(1,Wo(i)),s));return[x,x]}))}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:Wm(this.activation),recurrentActivation:Wm(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ad(this.kernelInitializer),recurrentInitializer:Ad(this.recurrentInitializer),biasInitializer:Ad(this.biasInitializer),kernelRegularizer:Zm(this.kernelRegularizer),recurrentRegularizer:Zm(this.recurrentRegularizer),biasRegularizer:Zm(this.biasRegularizer),activityRegularizer:Zm(this.activityRegularizer),kernelConstraint:_f(this.kernelConstraint),recurrentConstraint:_f(this.recurrentConstraint),biasConstraint:_f(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}]),n}(Tv);Iv.className="GRUCell",f.registerClass(Iv);var Rv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Iv(e),t.call(this,e)}return _createClass2(n,[{key:"call",value:function(e,t){var r=this;return sa((function(){return null!=r.cell.dropoutMask&&(ua(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(ua(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),_get(_getPrototypeOf(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(Sv);Rv.className="GRU",f.registerClass(Rv);var Ov=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,lf(r.units,"units"),r.activation=Hm(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=Hm(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Ed(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Ed(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Ed(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=$m(e.kernelRegularizer),r.recurrentRegularizer=$m(e.recurrentRegularizer),r.biasRegularizer=$m(e.biasRegularizer),r.kernelConstraint=kf(e.kernelConstraint),r.recurrentConstraint=kf(e.recurrentConstraint),r.biasConstraint=kf(e.biasConstraint),r.dropout=qf([1,Uf([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=qf([1,Uf([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return _createClass2(n,[{key:"build",value:function(e){var t,n;if(e=Zd(e),this.kernel=this.addWeight("kernel",[e[e.length-1],4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var r=this.biasInitializer,a=this.units;n=new((t=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e,t){var n=r.apply([a]),i=(new hd).apply([a]),o=r.apply([2*a]);return Zf(Zf(n,i),o)}}]),n}(cd)).className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return sa((function(){var r=null!=t.training&&t.training;if(3!==(e=e).length)throw new Gh("LSTMCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Pv({ones:function(){return vs(e)},rate:n.dropout,training:r,count:4})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Pv({ones:function(){return vs(a)},rate:n.recurrentDropout,training:r,count:4}));var o,s,u,c,l=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=xa(e,n.dropoutMask[0]));var h=ed(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=xa(a,l[0])),h=ba(h,ed(a,n.recurrentKernel.read())),n.useBias&&(h=ad(h,n.bias.read()));var f=_slicedToArray2(uu(h,4,h.rank-1),4),d=f[0],p=f[1],m=f[2],v=f[3];o=n.recurrentActivation.apply(d),s=n.recurrentActivation.apply(p),u=ba(xa(s,i),xa(o,n.activation.apply(m))),c=n.recurrentActivation.apply(v);var g=xa(c,n.activation.apply(u));return[g,g,u]}))}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:Wm(this.activation),recurrentActivation:Wm(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ad(this.kernelInitializer),recurrentInitializer:Ad(this.recurrentInitializer),biasInitializer:Ad(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Zm(this.kernelRegularizer),recurrentRegularizer:Zm(this.recurrentRegularizer),biasRegularizer:Zm(this.biasRegularizer),activityRegularizer:Zm(this.activityRegularizer),kernelConstraint:_f(this.kernelConstraint),recurrentConstraint:_f(this.recurrentConstraint),biasConstraint:_f(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}]),n}(Tv);Ov.className="LSTMCell",f.registerClass(Ov);var Nv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Ov(e),t.call(this,e)}return _createClass2(n,[{key:"call",value:function(e,t){var r=this;return sa((function(){return null!=r.cell.dropoutMask&&(ua(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(ua(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),_get(_getPrototypeOf(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(Sv);Nv.className="LSTM",f.registerClass(Nv);var Dv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).cells=e.cells,r}return _createClass2(n,[{key:"call",value:function(e,t){var n=this;return sa((function(){var r,a=(e=e).slice(1),i=[],o=_createForOfIteratorHelper(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(sI){o.e(sI)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var h=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=h.call(u,t),c.push(u.slice(1))}a=[];var f,d=_createForOfIteratorHelper(c.slice().reverse());try{for(d.s();!(f=d.n()).done;){var p,m=f.value;(p=a).push.apply(p,_toConsumableArray(m))}}catch(sI){d.e(sI)}finally{d.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;Xd(e)&&(e=e[0]),e=e,this.cells.forEach((function(n,r){Ff("RNNCell_"+r,(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t=this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}));return Object.assign({},e,{cells:t})}},{key:"getWeights",value:function(){var e,t=[],n=_createForOfIteratorHelper(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,_toConsumableArray(r.weights))}}catch(sI){n.e(sI)}finally{n.f()}return ep(t)}},{key:"setWeights",value:function(e){var t,n=[],r=_createForOfIteratorHelper(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=e.splice(a.weights.length),o=0;o<a.weights.length;++o)n.push([a.weights[o],i[o]])}catch(sI){r.e(sI)}finally{r.f()}tp(n)}},{key:"stateSize",get:function(){var e,t=[],n=_createForOfIteratorHelper(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,_toConsumableArray(r.stateSize)):t.push(r.stateSize)}}catch(sI){n.e(sI)}finally{n.f()}return t}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=_createForOfIteratorHelper(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,_toConsumableArray(r.trainableWeights))}}catch(sI){n.e(sI)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=_createForOfIteratorHelper(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,_toConsumableArray(r.nonTrainableWeights))}}catch(sI){n.e(sI)}finally{n.f()}if(!this.trainable){var a,i=[],o=_createForOfIteratorHelper(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,_toConsumableArray(s.trainableWeights))}}catch(sI){o.e(sI)}finally{o.f()}return i.concat(t)}return t}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=_createForOfIteratorHelper(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(wp(o,r))}}catch(sI){i.e(sI)}finally{i.f()}return new e({cells:a})}}]),n}(Tv);function Pv(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=function(){return id(t(),n)},u=function(){return od(s,t,a)};return!o||o<=1?ca(u().clone()):Array(o).fill(void 0).map(u).map((function(e){return ca(e.clone())}))}Dv.className="StackedRNNCells",f.registerClass(Dv);var Fv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),e.unroll)throw new Hh("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Hh("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new rp({ndim:5})],r}return _createClass2(n,[{key:"call",value:function(e,t){var r=this;return sa((function(){if(null!=r.cell.dropoutMask&&(ua(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(ua(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new Gh("ConvRNN2D cell does not support constants");return _get(_getPrototypeOf(n.prototype),"call",r).call(r,e,{mask:null==t?null:t.mask,training:null==t?null:t.training,initialState:null==t?null:t.initialState})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat(_toConsumableArray(t.slice(2)))),this.returnState&&(t=[t].concat(_toConsumableArray(Array(2).fill([e[0]].concat(_toConsumableArray(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return sa((function(){var n=t.cell.stateSize,r=t.computeSingleOutputShape(e.shape),a=as([r[0]].concat(_toConsumableArray(r.slice(2))));return Array.isArray(n)?Array(n.length).fill(a):[a]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];sa((function(){if(!t.stateful)throw new Uh("Cannot call resetStates() on an RNN Layer that is not stateful.");var a=t.inputSpec[0].shape,i=t.computeSingleOutputShape(a),o=[i[0]].concat(_toConsumableArray(i.slice(2)));if(null==a[0])throw new Gh("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())t.states_=Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(){return as(o)})):[as(o)];else if(null==e)ua(t.states_),null!=t.keptStates&&(ua(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return as(o)})):t.states_[0]=as(o);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new Gh("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ")+e);n?t.keptStates.push(t.states_.slice()):ua(t.states_);for(var s=0;s<t.states_.length;++s){var u=e[s],c=o;if(!r.arraysEqual(u.shape,c))throw new Gh("State ".concat(s," is incompatible with layer ").concat(t.name,": expected shape=").concat(c,", received shape=").concat(u.shape));t.states_[s]=u}}t.states_=t.states_.map((function(e){return ca(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?4:3],l=sv(e[u?3:2],a[0],i,o[0],s[0]),h=sv(c,a[1],i,o[1],s[1]);return[].concat(_toConsumableArray(e.slice(0,2)),_toConsumableArray(u?[r,l,h]:[l,h,r]))}}]),n}(Sv);Fv.className="ConvRNN2D";var Mv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;_classCallCheck2(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign({},e,{units:a}))).filters=a,lf(r.filters,"filters"),r.kernelSize=ov(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return lf(e,"kernelSize")})),r.strides=ov(o||1,2,"strides"),r.strides.forEach((function(e){return lf(e,"strides")})),r.padding=s||"valid",Nf(r.padding),r.dataFormat=u||"channelsLast",Of(r.dataFormat),r.dilationRate=ov(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return lf(e,"dilationRate")})),r}return _createClass2(n,[{key:"build",value:function(e){var t;e=Zd(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new Gh("The channel dimension of the input should be defined. Found "+e[n]);var r=this.kernelSize.concat([e[n],4*this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var a=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var i;if(this.unitForgetBias){var o=this.biasInitializer,s=this.filters;i=new((t=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"apply",value:function(e,t){return Yf([o.apply([s]),is([s]),o.apply([2*s])])}}]),n}(cd)).className="CustomInit",t)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,i,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return sa((function(){if(3!==e.length)throw new Gh("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+e.length+".");var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=Pv({ones:function(){return vs(a)},rate:n.dropout,training:r,count:4}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?xa(t[n],e):e},c=u(a,s,0),l=u(a,s,1),h=u(a,s,2),f=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=Pv({ones:function(){return vs(i)},rate:n.recurrentDropout,training:r,count:4}));var d=n.recurrentDropoutMask,p=u(i,d,0),m=u(i,d,1),v=u(i,d,2),g=u(i,d,3),y=_slicedToArray2(uu(n.kernel.read(),4,3),4),_=y[0],b=y[1],k=y[2],w=y[3],x=_slicedToArray2(n.useBias?uu(n.bias.read(),4):[null,null,null,null],4),C=x[0],S=x[1],T=x[2],A=x[3];c=n.inputConv(c,_,C,n.padding),l=n.inputConv(l,b,S,n.padding),h=n.inputConv(h,k,T,n.padding),f=n.inputConv(f,w,A,n.padding);var E=_slicedToArray2(uu(n.recurrentKernel.read(),4,3),4),I=E[0],R=E[1],O=E[2],N=E[3];p=n.recurrentConv(p,I),m=n.recurrentConv(m,R),v=n.recurrentConv(v,O),g=n.recurrentConv(g,N);var D=n.recurrentActivation.apply(ba(c,p)),P=n.recurrentActivation.apply(ba(l,m)),F=ba(xa(P,o),xa(D,n.activation.apply(ba(h,v)))),M=xa(n.recurrentActivation.apply(ba(f,g)),n.activation.apply(F));return[M,M,F]}))}},{key:"getConfig",value:function(){var e=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),["units"]);return Object.assign({},e,{filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides})}},{key:"inputConv",value:function(e,t,n,r){var a=Ji(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?ad(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return Ji(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(Ov);Mv.className="ConvLSTM2DCell",f.registerClass(Mv);var Lv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){_classCallCheck2(this,n);var r=new Mv(e);return t.call(this,Object.assign({},e,{cell:r}))}return _createClass2(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(Fv);Lv.className="ConvLSTM2D",f.registerClass(Lv);var zv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return _createClass2(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return sa((function(){n.invokeCallHook(e,t);var r=Yd(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return od((function(){return id(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return _get(_getPrototypeOf(n.prototype),"dispose",this).call(this)}}]),n}(up);zv.className="Dropout",f.registerClass(zv);var Bv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return _createClass2(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(zv);Bv.className="SpatialDropout1D",f.registerClass(Bv);var jv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,lf(r.units,"units"),r.activation=Hm(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=Ed(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=Ed(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=kf(e.kernelConstraint),r.biasConstraint=kf(e.biasConstraint),r.kernelRegularizer=$m(e.kernelRegularizer),r.biasRegularizer=$m(e.biasRegularizer),r.activityRegularizer=$m(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],_possibleConstructorReturn(r)}return _createClass2(n,[{key:"build",value:function(e){var t=(e=Zd(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:_defineProperty({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=Zd(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return sa((function(){n.invokeCallHook(e,t);var r,a=Yd(e),i=hf(n.activation.getClassName());return null!=i?r=ed(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=ed(a,n.kernel.read()),null!=n.bias&&(r=ad(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:Wm(this.activation),useBias:this.useBias,kernelInitializer:Ad(this.kernelInitializer),biasInitializer:Ad(this.biasInitializer),kernelRegularizer:Zm(this.kernelRegularizer),biasRegularizer:Zm(this.biasRegularizer),activityRegularizer:Zm(this.activityRegularizer),kernelConstraint:_f(this.kernelConstraint),biasConstraint:_f(this.biasConstraint)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);jv.className="Dense",f.registerClass(jv);var Vv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e=e||{})).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return _createClass2(n,[{key:"computeOutputShape",value:function(e){var t,n=_createForOfIteratorHelper((e=Zd(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new Gh('The shape of the input to "Flatten" is not fully defined (got '.concat(e.slice(1),'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.'))}}catch(sI){n.e(sI)}finally{n.f()}return[e[0],jf(e,1)]}},{key:"call",value:function(e,t){var n=this;return sa((function(){n.invokeCallHook(e,t);var r=Yd(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=r.transpose(a)}return function(e){if(e.rank<=1)throw new Gh("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],jf(e.shape,1)];return e.reshape(t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);Vv.className="Flatten",f.registerClass(Vv);var qv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=Hm(e.activation),r}return _createClass2(n,[{key:"call",value:function(e,t){var n=this;return sa((function(){n.invokeCallHook(e,t);var r=Yd(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:Wm(this.activation)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);qv.className="Activation",f.registerClass(qv);var Uv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return _createClass2(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return sa((function(){return e=Yd(e),t=e,r=n.n,sa((function(){if(2!==t.shape.length)throw new Gh("repeat() expects a rank-2 tensor, but received a rank-".concat(t.shape.length," tensor."));return Jf(Hf(t,1),[1,r,1])}));var t,r}))}},{key:"getConfig",value:function(){var e={n:this.n},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);Uv.className="RepeatVector",f.registerClass(Uv);var Wv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;_classCallCheck2(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return _createClass2(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new Gh("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=jf(e);if(null!==i){if(0===a||u%a!=0)throw new Gh(n);r[i]=u/a}else if(u!==a)throw new Gh(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return sa((function(){n.invokeCallHook(e,t);var r=Yd(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return r.reshape(i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);Wv.className="Reshape",f.registerClass(Wv);var Gv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var a;if(_classCallCheck2(this,n),a=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+e.dims+" instead.");var i=Wf(1,e.dims.length+1);if(!r.arraysEqual(e.dims.slice().sort(),i))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return a.dims=e.dims,a.dimsIncludingBatch=[0].concat(a.dims),a.inputSpec=[new rp({ndim:a.dims.length+1})],_possibleConstructorReturn(a)}return _createClass2(n,[{key:"computeOutputShape",value:function(e){var t=(e=Zd(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return mr(Yd(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);Gv.className="Permute",f.registerClass(Gv);var Hv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return _createClass2(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=Yd(e);return ci(ps(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return sa((function(){n.invokeCallHook(e,t);var r=Yd(e),a=ci(ps(r,n.maskValue),-1,!0);return r.mul(a.asType(r.dtype))}))}}]),n}(up);Hv.className="Masking",f.registerClass(Hv);var Kv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=null==e.inputLength?[a,null]:[a].concat(Jh(e.inputLength))}return r.inputDim=e.inputDim,lf(r.inputDim,"inputDim"),r.outputDim=e.outputDim,lf(r.outputDim,"outputDim"),r.embeddingsInitializer=Ed(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=$m(e.embeddingsRegularizer),r.activityRegularizer=$m(e.activityRegularizer),r.embeddingsConstraint=kf(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,_possibleConstructorReturn(r)}return _createClass2(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return sa((function(){return n.maskZero?(e=Yd(e),ps(e,Ta(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=Zd(e),null==this.inputLength)return[].concat(_toConsumableArray(e),[this.outputDim]);var t=Jh(this.inputLength);if(t.length!==e.length-1)throw new Gh('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ")+e);for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new Gh('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ")+e);null==a&&(t[n]=i),n++}return[e[0]].concat(_toConsumableArray(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return sa((function(){n.invokeCallHook(e,t);var r=Yd(e);return"int32"!==r.dtype&&(r=Gf(r,"int32")),td(n.embeddings.read(),r.as1D()).reshape(Zd(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Ad(this.embeddingsInitializer),embeddingsRegularizer:Zm(this.embeddingsRegularizer),activityRegularizer:Zm(this.activityRegularizer),embeddingsConstraint:_f(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);Kv.className="Embedding",f.registerClass(Kv);var Xv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return _createClass2(n,[{key:"mergeFunction",value:function(e){throw new Hh}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new Gh("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Zd(e)]),(e=e).length<2)throw new Gh("A merge layer should be called on an Array of at least 2 inputs. Got ".concat(e.length," input(s)."));var t,n=[],r=_createForOfIteratorHelper(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(sI){r.e(sI)}finally{r.f()}if((n=of(n)).length>1)throw new Gh("Can not merge tensors with different batch sizes. Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));this.reshapeRequired=-1!==e.indexOf(null)||1!==of(u).length}},{key:"call",value:function(e,t){var n=this;return sa((function(){if(e=e,n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=Uf(r),o=_createForOfIteratorHelper(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=Hf(s,1);t.push(s)}}catch(sI){o.e(sI)}finally{o.f()}return n.mergeFunction(t)}var l,h=!1,f=_createForOfIteratorHelper(e);try{for(f.s();!(l=f.n()).done;){var d=l.value,p=d.rank;if(null==p){var m=d.shape,v=m[0],g=m.slice(1).concat([v]),y=d.reshape([v].concat(jf(m.slice(1))));y=(y=mr(y,[1,0])).reshape(g),t.push(y),h=!0}else if(p>1){var _=Wf(1,p).concat([0]);t.push(mr(d,_)),h=!0}else t.push(d)}}catch(sI){f.e(sI)}finally{f.f()}var b=n.mergeFunction(t),k=b.rank;if(h)if(null==k){var w=b.shape,x=w[w.length-1],C=[x].concat(w.slice(0,w.length-1));b=mr(b.reshape([-1,x]),[1,0]).reshape(C)}else if(k>1){var S=[k-1].concat(Wf(0,k-1));b=mr(b,S)}return b}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==(e=e)[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=_createForOfIteratorHelper(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(sI){o.e(sI)}finally{o.f()}return t=1===(i=of(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return sa((function(){if(null==t)return null;if(!Array.isArray(t))throw new Gh("`mask` should be an Array");if(!Array.isArray(e))throw new Gh("`inputs` should be an Array");if(t.length!==e.length)throw new Gh("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:bo(e,0)})))[0],r=1;r<t.length-1;++r)n=Zo(n,t[r]);return n}))}}]),n}(up),Qv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"mergeFunction",value:function(e){return sa((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=ba(t,e[n]);return t}))}}]),n}(Xv);Qv.className="Add",f.registerClass(Qv);var Yv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"mergeFunction",value:function(e){return sa((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=xa(t,e[n]);return t}))}}]),n}(Xv);Yv.className="Multiply",f.registerClass(Yv);var Zv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"mergeFunction",value:function(e){return sa((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=ba(t,e[n]);return xa(1/e.length,t)}))}}]),n}(Xv);Zv.className="Average",f.registerClass(Zv);var Jv=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"mergeFunction",value:function(e){return sa((function(){for(var t=e[0],n=1;n<e.length;++n)t=Ha(t,e[n]);return t}))}}]),n}(Xv);Jv.className="Maximum",f.registerClass(Jv);var $v=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"mergeFunction",value:function(e){return sa((function(){for(var t=e[0],n=1;n<e.length;++n)t=us(t,e[n]);return t}))}}]),n}(Xv);$v.className="Minimum",f.registerClass($v);var eg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return _createClass2(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new Gh("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,a=_createForOfIteratorHelper(e=e);try{for(a.s();!(t=a.n()).done;){if(null!=t.value){n=!1;break}}}catch(sI){a.e(sI)}finally{a.f()}if(!n){for(var i=[],o=0;o<e.length;++o){var s=e[o].slice();s.splice(this.axis,1);var u,c=!1,l=_createForOfIteratorHelper(i);try{for(l.s();!(u=l.n()).done;){var h=u.value;if(r.arraysEqual(h,s)){c=!0;break}}}catch(sI){l.e(sI)}finally{l.f()}c||i.push(s)}if(i.length>1)throw new Gh("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return sa((function(){return Yf(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new Gh("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=_createForOfIteratorHelper(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(sI){i.e(sI)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new Gh("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new Gh("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new Gh("Mismatch in the length of mask (".concat(t.length,") and the legnth of inputs (").concat(e.length,")"));return sa((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)a.push(null==t[i]?vs(e[i]).asType("bool"):t[i].rank<e[i].rank?bo(t[i],-1):t[i]);var o=Pi(a,n.axis);return ui(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Xv);function tg(e,t){for(;e<0;)e+=t;return e}eg.className="Concatenate",f.registerClass(eg);var ng=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return _createClass2(n,[{key:"build",value:function(e){r.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new Hh("Dot layer does not support tensors of 4D or higher rank yet.");var a=this.interpretAxes(t,n);if(t[a[0]]!==n[a[1]])throw new Gh("Dimension incompatibility: ".concat(t[a[0]]," !== ").concat(n[a[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new Gh("A `Dot` layer must be called on exactly 2 inputs, but received ".concat(e.length," input(s)."));var t,n=e[0],a=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return tg(t,e[n].shape.length)})):[tg(this.axes,n.shape.length),tg(this.axes,a.shape.length)],this.normalize&&(n=xp(n,t[0]),a=xp(a,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new Hh("batchDot is not implemented for tensors of 4D or higher rank yet");if(r.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, but got "+e.shape.length})),r.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, but got "+t.shape.length})),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new Hh("batchDot is not implemented for complex64-type Tensors yet.");var a=e.shape.length,i=t.shape.length;null==n&&(n=[a-1,i-2]);var o=n;return sa((function(){var n,r;if(a>i){n=a-i;for(var s=[],u=0;u<n;++u)s.push(1);t=t.reshape(t.shape.concat(s))}else if(i>a){n=i-a;for(var c=[],l=0;l<n;++l)c.push(1);e=e.reshape(e.shape.concat(c))}else n=0;if(r=2===e.shape.length&&2===t.shape.length?o[0]===o[1]?e.mul(t).sum(o[0]):e.transpose([1,0]).mul(t).sum(o[1]):e.matMul(t,o[0]!==e.shape.length-1,o[1]===t.shape.length-1),n>0){for(var h,f=[],d=h=a>i?a+i-3:a-1;d<h+n;++d)f.push(d);r=r.squeeze(f)}return 1===r.shape.length&&(r=r.expandDims(1)),r}))}(n,a,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[tg(this.axes,e.length),tg(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){r.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new Hh("Dot layer does not support tensors of 4D or higher rank yet.");var a=this.interpretAxes(t,n);t.splice(a[0],1),n.splice(a[1],1),n.splice(0,1);var i=t.concat(n);return 1===i.length&&i.push(1),i}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Xv);ng.className="Dot",f.registerClass(ng);var rg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return _createClass2(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return sa((function(){n.invokeCallHook(e,t);var r=Yd(e);return od((function(){return $f(r.shape,0,n.stddev).add(r)}),(function(){return r}),t.training||!1)}))}}]),n}(up);rg.className="GaussianNoise",f.registerClass(rg);var ag=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return _createClass2(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return sa((function(){n.invokeCallHook(e,t);var r=Yd(e);return n.rate>0&&n.rate<1?od((function(){var e=Math.sqrt(n.rate/(1-n.rate));return r.mul($f(r.shape,1,e))}),(function(){return r}),t.training||!1):r}))}}]),n}(up);ag.className="GaussianDropout",f.registerClass(ag);var ig=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return _createClass2(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||Yd(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return sa((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return od((function(){var t=Yd(e),a=-1.7580993408473766,i=No(Ps(r),n.rate);i=Gf(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate;return t.mul(i).add(i.add(-1).mul(a)).mul(o).add(s)}),(function(){return Yd(e)}),t.training||!1)}return e}))}}]),n}(up);function og(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=qi(e,t,n,r,a,o);else if(3===e.rank)i=Ui(e,t,n,r,a,o);else{if(4!==e.rank)throw new Hh("batchNormalization is not implemented for array of rank ".concat(e.rank," yet"));i=Wi(e,t,n,r,a,o)}return i}ig.className="AlphaDropout",f.registerClass(ig);var sg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Ed(e.betaInitializer||"zeros"),r.gammaInitializer=Ed(e.gammaInitializer||"ones"),r.movingMeanInitializer=Ed(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=Ed(e.movingVarianceInitializer||"ones"),r.betaConstraint=kf(e.betaConstraint),r.gammaConstraint=kf(e.gammaConstraint),r.betaRegularizer=$m(e.betaRegularizer),r.gammaRegularizer=$m(e.gammaRegularizer),r}return _createClass2(n,[{key:"build",value:function(e){e=Zd(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new Gh("Axis ".concat(t," of input tensor should have a defined dimension but the layer received an input with shape ")+JSON.stringify(e)+".");this.inputSpec=[new rp({ndim:e.length,axes:_defineProperty({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return sa((function(){var a=null!=t.training&&t.training,i=Yd(e),o=i.shape,s=o.length,u=Wf(0,s),c=n.axis>=0?n.axis:n.axis+s;u.splice(c,1);var l=Xh(1,s);l[c]=o[c];var h=u.slice();h.sort();var f=!r.arraysEqual(h,Wf(0,s).slice(0,s-1));if(!a)return function(){if(f){var e=n.movingMean.read().reshape(l),t=n.movingVariance.read().reshape(l),r=n.center?n.beta.read().reshape(l):null,a=n.scale?n.gamma.read().reshape(l):null;return og(i,e,t,r,a,n.epsilon)}return og(i,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var d=_slicedToArray2(function(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return r.arraysEqual(a.slice().sort(),Wf(0,e.rank-1))?function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return sa((function(){var i=hs(e,r),o=i.mean,s=i.variance;return[og(e,o,s,n,t,a),o,s]}))}(e,t,n,a,i):function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return sa((function(){var i,o=hs(e,r),s=o.mean,u=o.variance,c=[],l=_createForOfIteratorHelper(Wf(0,e.rank));try{for(l.s();!(i=l.n()).done;){var h=i.value;-1!==r.indexOf(h)?c.push(1):c.push(e.shape[h])}}catch(sI){l.e(sI)}finally{l.f()}var f=s.reshape(c),d=u.reshape(c),p=null==t?null:t.reshape(c),m=null==n?null:n.reshape(c);return[og(e,f,d,m,p,a),s,u]}))}(e,t,n,a,i)}(i,n.gamma.read(),n.beta.read(),u,n.epsilon),3),p=d[0],m=d[1],v=d[2],g=function(e,t,n){sa((function(){var r=1-n,a=e.read(),i=a.sub(t).mul(r);e.write(a.sub(i))}))};return g(n.movingMean,m,n.momentum),g(n.movingVariance,v,n.momentum),p}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ad(this.betaInitializer),gammaInitializer:Ad(this.gammaInitializer),movingMeanInitializer:Ad(this.movingMeanInitializer),movingVarianceInitializer:Ad(this.movingVarianceInitializer),betaRegularizer:Zm(this.betaRegularizer),gammaRegularizer:Zm(this.gammaRegularizer),betaConstraint:_f(this.betaConstraint),gammaConstraint:_f(this.gammaConstraint)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);sg.className="BatchNormalization",f.registerClass(sg);var ug=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"==typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received "+r.axis)}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, but received "+JSON.stringify(r.axis));var a,i=_createForOfIteratorHelper(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, but received "+JSON.stringify(r.axis))}}catch(sI){i.e(sI)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Ed(e.betaInitializer||"zeros"),r.gammaInitializer=Ed(e.gammaInitializer||"ones"),r.betaRegularizer=$m(e.betaRegularizer),r.gammaRegularizer=$m(e.gammaRegularizer),r.supportsMasking=!0,_possibleConstructorReturn(r)}return _createClass2(n,[{key:"build",value:function(e){var t=(e=Zd(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=_createForOfIteratorHelper(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: "+i)}}catch(sI){a.e(sI)}finally{a.f()}if(this.axis.length!==of(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var o=this.axis.map((function(t){return e[t]}));this.gamma=this.scale?this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,!0):null,this.beta=this.center?this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,!0):null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=Yd(e),a=r.shape,i=a.length;return sa((function(){var e,t=hs(r,n.axis,!0),o=t.mean,s=t.variance,u=Xh(1,i),c=_createForOfIteratorHelper(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch(sI){c.e(sI)}finally{c.f()}for(var h=function(e){return null!=e&&e.shape.length!==i&&n.axis!==[i-1]?e.reshape(u):e},f=h(n.gamma.read()),d=h(n.beta.read()),p=[],m=[],v=0;v<i;++v)-1!==n.axis.indexOf(v)?(p.push(a[v]),m.push(1)):(p.push(1),m.push(a[v]));return o=o.tile(p),s=s.tile(p),f=f.tile(m),d=d.tile(m),og(r,o,s,d,f,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ad(this.betaInitializer),gammaInitializer:Ad(this.gammaInitializer),betaRegularizer:Zm(this.betaRegularizer),gammaRegularizer:Zm(this.gammaRegularizer)},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);ug.className="LayerNormalization",f.registerClass(ug);var cg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new Gh("ZeroPadding2D expects padding to be a length-2 array, but received a length-".concat(e.padding.length," array."));var a,i;if("number"==typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new Gh("ZeroPadding2D expects height padding to be a length-2 array, but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new Gh("ZeroPadding2D expects width padding to be a length-2 array, but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new rp({ndim:4})],_possibleConstructorReturn(r)}return _createClass2(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=Zd(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return sa((function(){return t=Yd(e),r=n.padding,a=n.dataFormat,sa((function(){if(4!==t.rank)throw new Gh("temporalPadding expects input tensor to be 4-D, but received a "+t.rank+"-D tensor.");if(null==r&&(r=[[1,1],[1,1]]),2!==r.length||2!==r[0].length||2!==r[1].length)throw new Gh("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==a&&(a="channelsLast"),"channelsLast"!==a&&"channelsFirst"!==a)throw new Gh("Unknown data format: ".concat(a,". Supported data formats are 'channelsLast' and 'channelsFirst."));var e;return e="channelsFirst"===a?[[0,0],[0,0],r[0],r[1]]:[[0,0],r[0],r[1],[0,0]],ys(t,e)}));var t,r,a}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up);function lg(e,t,n,r,a,i){return sa((function(){var o;Of(a),Df(i),Nf(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=cv(e,a);var s="same"===r?"same":"valid";return o="max"===i?ts(e,t,n,s):Ri(e,t,n,s),"channelsFirst"===a&&(o=mr(o,[0,3,1,2])),o}))}function hg(e,t,n,r,a,i){return sa((function(){var o;Of(a),Df(i),Nf(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=lv(e,a);var s="same"===r?"same":"valid";return o="max"===i?ns(e,t,n,s):Oi(e,t,n,s),"channelsFirst"===a&&(o=mr(o,[0,4,1,2,3])),o}))}cg.className="ZeroPadding2D",f.registerClass(cg);var fg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"==typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new Gh("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));r.poolSize=e.poolSize}if(lf(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"==typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new Gh("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));r.strides=e.strides}return lf(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,Nf(r.padding),r.inputSpec=[new rp({ndim:3})],_possibleConstructorReturn(r)}return _createClass2(n,[{key:"computeOutputShape",value:function(e){var t=sv((e=Zd(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return sa((function(){n.invokeCallHook(e,t),e=Hf(Yd(e),2);var r=n.poolingFunction(Yd(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return hu(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up),dg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Of(a),Nf(r),lg(e,t,n,r,a,"max")}}]),n}(fg);dg.className="MaxPooling1D",f.registerClass(dg);var pg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Of(a),Nf(r),lg(e,t,n,r,a,"avg")}}]),n}(fg);pg.className="AveragePooling1D",f.registerClass(pg);var mg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new Gh("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+e.strides.length+".");r.strides=e.strides}else r.strides=[e.strides,e.strides];return lf(r.poolSize,"poolSize"),lf(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Of(r.dataFormat),Nf(r.padding),r.inputSpec=[new rp({ndim:4})],_possibleConstructorReturn(r)}return _createClass2(n,[{key:"computeOutputShape",value:function(e){e=Zd(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=sv(t,this.poolSize[0],this.padding,this.strides[0]),n=sv(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return sa((function(){return n.invokeCallHook(e,t),n.poolingFunction(Yd(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up),vg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Of(a),Nf(r),lg(e,t,n,r,a,"max")}}]),n}(mg);vg.className="MaxPooling2D",f.registerClass(vg);var gg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Of(a),Nf(r),lg(e,t,n,r,a,"avg")}}]),n}(mg);gg.className="AveragePooling2D",f.registerClass(gg);var yg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;if(_classCallCheck2(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new Gh("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+e.strides.length+".");r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return lf(r.poolSize,"poolSize"),lf(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Of(r.dataFormat),Nf(r.padding),r.inputSpec=[new rp({ndim:5})],_possibleConstructorReturn(r)}return _createClass2(n,[{key:"computeOutputShape",value:function(e){e=Zd(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=sv(t,this.poolSize[0],this.padding,this.strides[0]),n=sv(n,this.poolSize[1],this.padding,this.strides[1]),r=sv(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return sa((function(){return n.invokeCallHook(e,t),n.poolingFunction(Yd(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up),_g=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Of(a),Nf(r),hg(e,t,n,r,a,"max")}}]),n}(yg);_g.className="MaxPooling3D",f.registerClass(_g);var bg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e)}return _createClass2(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Of(a),Nf(r),hg(e,t,n,r,a,"avg")}}]),n}(yg);bg.className="AveragePooling3D",f.registerClass(bg);var kg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).inputSpec=[new rp({ndim:3})],r}return _createClass2(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new Hh}}]),n}(up),wg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e||{})}return _createClass2(n,[{key:"call",value:function(e,t){return sa((function(){var t=Yd(e);return os(t,1)}))}}]),n}(kg);wg.className="GlobalAveragePooling1D",f.registerClass(wg);var xg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck2(this,n),t.call(this,e||{})}return _createClass2(n,[{key:"call",value:function(e,t){return sa((function(){var t=Yd(e);return Ko(t,1)}))}}]),n}(kg);xg.className="GlobalMaxPooling1D",f.registerClass(xg);var Cg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Of(r.dataFormat),r.inputSpec=[new rp({ndim:4})],r}return _createClass2(n,[{key:"computeOutputShape",value:function(e){return e=e,"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new Hh}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(up),Sg=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"call",value:function(e,t){var n=this;return sa((function(){var t=Yd(e);return os(t,"channelsLast"===n.dataFormat?[1,2]:[2,3])}))}}]),n}(Cg);Sg.className="GlobalAveragePooling2D",f.registerClass(Sg);var Tg=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"call",value:function(e,t){var n=this;return sa((function(){var t=Yd(e);return Ko(t,"channelsLast"===n.dataFormat?[1,2]:[2,3])}))}}]),n}(Cg);Tg.className="GlobalMaxPooling2D",f.registerClass(Tg);var Ag=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).layer=e.layer,r}return _createClass2(n,[{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){_get(_getPrototypeOf(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=wp(t.layer,n);delete t.layer;var a={layer:r};return Object.assign(a,t),new e(a)}}]),n}(up),Eg=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return _createClass2(n,[{key:"build",value:function(e){if((e=Zd(e)).length<3)throw new Gh("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),_get(_getPrototypeOf(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=Zd(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t);return[n[0],e[1]].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return sa((function(){return Cv((function(e,r){return[Yd(n.layer.call(e,t)),[]]}),e=Yd(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(Ag);Eg.className="TimeDistributed",f.registerClass(Eg);var Ig=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;_classCallCheck2(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=wp(i),a.goBackwards=!0!==a.goBackwards;var o={};if(o.className=e.layer.getClassName(),o.config=a,r.backwardLayer=wp(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,uf(If,"BidirectionalMergeMode",r.mergeMode),e.weights)throw new Hh("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return _createClass2(n,[{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=Math.floor(e.length/2);this.forwardLayer.setWeights(e.slice(0,t)),this.backwardLayer.setWeights(e.slice(t))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),a=a,this.returnState?(r=a.slice(1),t=a[0]):t=a[0],t=t,"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):Zh(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=xv(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return _get(_getPrototypeOf(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new Gh("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,_toConsumableArray(r));var c=r.map((function(e){return new rp({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,_toConsumableArray(c))}if(null!=a)throw new Hh("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof ap,h=0,f=o;h<f.length;h++){if(f[h]instanceof ap!==l)throw new Gh("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var d=[e].concat(o),p=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=p;var v=_get(_getPrototypeOf(n.prototype),"apply",this).call(this,d,t);return this.inputSpec=m,v}return _get(_getPrototypeOf(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return sa((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=js(a,1)),"concat"===n.mergeMode?o=Yf([r,a]):"sum"===n.mergeMode?o=ba(r,a):"ave"===n.mergeMode?o=xa(.5,ba(r,a)):"mul"===n.mergeMode?o=xa(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;Ff(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),Ff(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"setFastWeightInitDuringBuild",value:function(e){_get(_getPrototypeOf(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=_get(_getPrototypeOf(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}}],[{key:"fromConfig",value:function(e,t){var n=wp(t.layer);if(delete t.layer,null!=t.numConstants)throw new Hh("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(Ag);function Rg(e){return new cp(e)}function Og(e){return new rv(e)}function Ng(e){return new ev(e)}function Dg(e){return new tv(e)}function Pg(e){return new nv(e)}function Fg(e){return new iv(e)}function Mg(e){return new av(e)}function Lg(e){return new _v(e)}function zg(e){return new pv(e)}function Bg(e){return new vv(e)}function jg(e){return new mv(e)}function Vg(e){return new yv(e)}function qg(e){return new bv(e)}function Ug(e){return new kv(e)}function Wg(e){return new wv(e)}function Gg(e){return new qv(e)}function Hg(e){return new jv(e)}function Kg(e){return new zv(e)}function Xg(e){return new Bv(e)}function Qg(e){return new Vv(e)}function Yg(e){return new Uv(e)}function Zg(e){return new Wv(e)}function Jg(e){return new Gv(e)}function $g(e){return new Kv(e)}function ey(e){return new Qv(e)}function ty(e){return new Zv(e)}function ny(e){return new eg(e)}function ry(e){return new Jv(e)}function ay(e){return new $v(e)}function iy(e){return new Yv(e)}function oy(e){return new ng(e)}function sy(e){return new sg(e)}function uy(e){return new ug(e)}function cy(e){return new cg(e)}function ly(e){return new pg(e)}function hy(e){return ly(e)}function fy(e){return ly(e)}function dy(e){return new gg(e)}function py(e){return dy(e)}function my(e){return dy(e)}function vy(e){return new bg(e)}function gy(e){return vy(e)}function yy(e){return vy(e)}function _y(e){return new wg(e)}function by(e){return new Sg(e)}function ky(e){return new xg(e)}function wy(e){return new Tg(e)}function xy(e){return new dg(e)}function Cy(e){return new vg(e)}function Sy(e){return new _g(e)}function Ty(e){return new Rv(e)}function Ay(e){return new Iv(e)}function Ey(e){return new Nv(e)}function Iy(e){return new Ov(e)}function Ry(e){return new Ev(e)}function Oy(e){return new Av(e)}function Ny(e){return new Lv(e)}function Dy(e){return new Mv(e)}function Py(e){return new Sv(e)}function Fy(e){return new Dv(e)}function My(e){return new Ig(e)}function Ly(e){return new Eg(e)}Ig.className="Bidirectional",f.registerClass(Ig);var zy=ky,By=wy,jy=xy,Vy=Cy;function qy(e){return new rg(e)}function Uy(e){return new ag(e)}function Wy(e){return new ig(e)}function Gy(e){return new Hv(e)}function Hy(e,t){return Dp(e,t)}function Ky(e,t){return Lp(e,t)}function Xy(e,t){return zp(e,t)}function Qy(e,t){return Pp(e,t)}function Yy(e,t){return Bp(e,t)}function Zy(e,t){return Mp(e,t)}function Jy(e,t){return function(e,t){return sa((function(){var n=Fp(e,t),r=function(e,t){return sa((function(){return Zo(e.equal(1),t.equal(0)).sum().cast("float32")}))}(e,t),a=n.add(r);return po(Oo(a,0),n.div(a),0).cast("float32")}))}(e,t)}function $y(e,t){return Rp(e,t)}function e_(e,t){return Sp(e,t)}function t_(e,t){return Tp(e,t)}function n_(e,t){return Tp(e,t)}function r_(e,t){return Tp(e,t)}function a_(e,t){return Cp(e,t)}function i_(e,t){return Cp(e,t)}function o_(e,t){return Cp(e,t)}function s_(e){return new Qm(e)}function u_(e){return Km(t=e),new Qm({l1:null!=t?t.l1:null,l2:0});var t}function c_(e){return Km(t=e),new Qm({l2:null!=t?t.l2:null,l1:0});var t}var l_=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck2(this,n),(e=t.apply(this,arguments)).model=null,e}return _createClass2(n,[{key:"setModel",value:function(e){if(!(e instanceof bm))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}]),n}(pp);function h_(e,t){return e<t}function f_(e,t){return e>t}var d_,p_,m_=function(e){_inherits(i,e);var t,n,r,a=_createSuper(i);function i(e){var t;if(_classCallCheck2(this,i),t=a.call(this),null==e&&(e={}),e.restoreBestWeights)throw new Hh("restoreBestWeights = True is not implemented in EarlyStopping yet.");return t.monitor=e.monitor||"val_loss",t.minDelta=Math.abs(e.minDelta||0),t.patience=e.patience||0,t.verbose=e.verbose||0,t.mode=e.mode||"auto",t.baseline=e.baseline,-1===["auto","min","max"].indexOf(t.mode)&&(console.warn("EarlyStopping mode '".concat(t.mode,"' is invalid. Falling back to mode 'auto'.")),t.mode="auto"),t.monitorFunc="min"===t.mode?h_:"max"===t.mode||-1!==t.monitor.indexOf("acc")?f_:h_,t.monitorFunc===h_&&(t.minDelta*=-1),_possibleConstructorReturn(t)}return _createClass2(i,[{key:"onTrainBegin",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.wait=0,this.stoppedEpoch=0,this.best=null!=this.baseline?this.baseline:this.monitorFunc===h_?1/0:-1/0;case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onEpochEnd",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hp(n);case 2:null!=(r=this.getMonitorValue(n))&&(this.monitorFunc(r-this.minDelta,this.best)?(this.best=r,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"onTrainEnd",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping."));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getMonitorValue",value:function(e){null==e&&(e={});var t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. Available metrics are: ")+Object.keys(e)),t}}]),i}(l_),v_={earlyStopping:function(e){return new m_(e)}};!function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(d_||(d_={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(p_||(p_={}));var g_={};function y_(e,t){g_[e]={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t}}function __(e){return g_[e]}function b_(e){delete g_[e]}function k_(e,t,n,a,i){var o=t.inputParams[e];if(o&&void 0!==o.inputIndexStart){var s=o.inputIndexStart,u=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?s+1:o.inputIndexEnd;if("tensor"===o.type)return w_(t.inputNames[o.inputIndexStart],n,a,i);if("tensors"===o.type)return t.inputNames.slice(s,u).map((function(e){return w_(e,n,a,i)}));var c=w_(t.inputNames.slice(s)[0],n,a,i),l=c.dataSync();return"number"===o.type?l[0]:r.toNestedArray(c.shape,l)}var h=t.attrParams[e];return h&&h.value}function w_(e,t,n,r){var a=_slicedToArray2(S_(e),2),i=a[0],o=a[1];if(null!=r){var s=r.getHashTableHandleByName(i);if(null!=s)return s}var u=n.currentContextIds.find((function(e){return!!t[C_(i,e)]}));return void 0!==u?t[C_(i,u)][o]:void 0}function x_(e,t){var n=_slicedToArray2(S_(e),2),r=n[0],a=n[1];return[C_(r,t&&t.currentContextId),a]}function C_(e,t){return t?"".concat(e,"-").concat(t):e}function S_(e){var t=e.split(":");return 1===t.length?[e,0]:[t[0],Number(t[t.length-1])]}function T_(e,t,n){var r=k_("pad",e,t,n);if("explicit"===r){r=k_("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function A_(e){return e.kept?e:Wn(e)}var E_=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],I_=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],R_=[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]}],O_=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],N_=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],D_=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],P_=[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],F_=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],M_=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]}],L_=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}],z_=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],B_=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],j_=[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],V_=[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],q_=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],U_=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],W_=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]}],G_=function(){function e(){var t;_classCallCheck2(this,e);var n=(t=[]).concat.apply(t,_toConsumableArray([C,S,T,A,E,I,R,P,D,O,F,M,L,z,B,j,N].map((function(e){return e.json}))));this.opMappers=n.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return _createClass2(e,null,[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),_createClass2(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=[],a=[],i=[],o=e.node.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?r.push(e[n.name]):"Const"===n.op?a.push(e[n.name]):null!=n.input&&0!==n.input.length||i.push(e[n.name]),e}),{}),s=[],u=[],c={},l={};null!=n&&(c=this.mapSignatureEntries(n.inputs),l=this.mapSignatureEntries(n.outputs));var h=Object.keys(o);h.forEach((function(e){var t=o[e];t.inputNames.forEach((function(e){var n=_slicedToArray2(x_(e),1)[0];t.inputs.push(o[n]),o[n].children.push(t)}))})),0===Object.keys(l).length?h.forEach((function(e){var t=o[e];0===t.children.length&&u.push(t)})):Object.keys(l).forEach((function(e){var t=_slicedToArray2(x_(e),1)[0],n=o[t];null!=n&&(n.signatureKey=l[e],u.push(n))})),Object.keys(c).length>0?Object.keys(c).forEach((function(e){var t=_slicedToArray2(x_(e),1)[0],n=o[t];n&&(n.signatureKey=c[e],s.push(n))})):s=r;var f={};null!=e.library&&null!=e.library.function&&(f=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var d={nodes:o,inputs:s,outputs:u,weights:a,placeholders:r,signature:n,functions:f};return i.length>0&&(d.initNodes=i),d}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=__(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.substr(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r=n.type,a=void 0;switch(n.type){case"string":void 0===(a=K_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=K_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(a=rb(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=rb(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(a=Q_(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(a=Q_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(a=nb(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=nb(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(a=X_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=X_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(a=ib(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=ib(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(a=tb(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=tb(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(a=ab(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=ab(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(a=J_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=J_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(a=$_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=$_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(a=Z_(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(a=Z_(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:a,type:r},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var i=[],o=[];e.signature.inputArg.forEach((function(e){var t=_slicedToArray2(x_(e.name),1)[0],n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:Y_(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,i.push(n),a[t]=n})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e){var n=_slicedToArray2(x_(e),1)[0];t.inputs.push(a[n]),a[n].children.push(t)}))}));var s=e.ret;e.signature.outputArg.forEach((function(e){var t=_slicedToArray2(x_(s[e.name]),2),n=t[0],r=t[1],i=a[n];null!=i&&(i.defaultOutput=r,o.push(i))}));var u=this.mapArgsToSignature(e);return{nodes:a,inputs:i,outputs:o,weights:r,placeholders:[],signature:u}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}]),e}();function H_(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=ze().global;if(void 0!==t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function K_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?H_(a.s,r):n}function X_(e,t,n){var r=e[t];return r?r.b:n}function Q_(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function Y_(e){switch("string"==typeof e&&(e=d_[e]),e){case d_.DT_FLOAT:return"float32";case d_.DT_INT32:case d_.DT_INT64:case d_.DT_INT8:case d_.DT_UINT8:return"int32";case d_.DT_BOOL:return"bool";case d_.DT_DOUBLE:return"float32";case d_.DT_STRING:return"string";default:return null}}function Z_(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function J_(e,t,n){var r=e[t];return r&&r.type?Y_(r.type):n}function $_(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return Y_(e)})):n}function eb(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function tb(e,t,n){var r=e[t];return r&&r.shape?eb(r.shape):n}function nb(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function rb(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return H_(e,r)})):n}function ab(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return eb(e)})):n}function ib(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var ob=function(){function e(t,n,r){var a=this;_classCallCheck2(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return _createClass2(e,[{key:"getInput",value:function(e){return w_(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return w_(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return Q_(this.node.rawAttrs,e,t);if(null!=n.s)return K_(this.node.rawAttrs,e,t);if(null!=n.b)return X_(this.node.rawAttrs,e,t);if(null!=n.shape)return tb(this.node.rawAttrs,e,t);if(null!=n.type)return J_(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return nb(this.node.rawAttrs,e,t);if(null!=n.list.s)return rb(this.node.rawAttrs,e,t);if(null!=n.list.shape)return ab(this.node.rawAttrs,e,t);if(null!=n.list.b)return ib(this.node.rawAttrs,e,t);if(null!=n.list.type)return $_(this.node.rawAttrs,e,t)}return t}}]),e}();function sb(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";r.assert(function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(-1!==e[n]&&-1!==t[n]&&e[n]!==t[n])return!1;return!0}(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}var ub=function(){function e(t,n,r,a,i,o,s){_classCallCheck2(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Pa(0),ca(this.idTensor)}return _createClass2(e,[{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.tensor.id)||t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?)."));return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),sb(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,ca(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,because the index size: ").concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return Xt([],[0].concat(this.elementShape));var r=this.readMany(e);return sb(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),fu(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return Xt([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return sb(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),Pi(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,_toConsumableArray(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Cu(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), and the TensorArray is not marked as dynamically resizeable"));var i=0===r?0:t.size/r,o=[];sa((function(){t=fr(t,[1,r,i]);for(var s=0;s<e.length;++s)o[s]=fr(Mi(t,[0,0===s?0:a[s-1],0],[1,e[s],i]),n.elementShape);return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}},{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}}]),e}(),cb=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;_classCallCheck2(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));sb(n,e.shape,"TensorList shape mismatch: "),ca(e)})),this.idTensor=Pa(0),this.maxNumElements=a,ca(this.idTensor)}return _createClass2(e,[{key:"copy",value:function(){return new e(_toConsumableArray(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.id)||t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));return sb(e,this.elementShape,"TensorList shape mismatch: "),sa((function(){var t=n.tensors.map((function(t){return fr(t,e)}));return fu(t,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=this.tensors.pop();return sb(n.shape,e,"TensorList shape mismatch: "),fr(n,e)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(sb(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");ca(e),this.tensors.push(e)}},{key:"resize",value:function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: "+e);if(-1!==this.maxNumElements&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));this.tensors.length=e}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));return sb(this.tensors[e].shape,t,"TensorList shape mismatch: "),this.tensors[e]}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));sb(this.elementShape,t.shape,"TensorList shape mismatch: "),ca(t),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));return sb(this.elementShape,n,"TensorList shape mismatch: "),0===(e=e.slice(0,this.size())).length?Xt([],[0].concat(this.elementShape)):sa((function(){var t=e.map((function(e){return fr(r.tensors[e],n)}));return fu(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));return sb(this.elementShape,t,"TensorList shape mismatch: "),0===this.size()?Xt([],[0].concat(this.elementShape)):sa((function(){var e=n.tensors.map((function(e){return fr(e,t)}));return Pi(e,0)}))}},{key:"id",get:function(){return this.idTensor.id}}]),e}();function lb(e,t,n){var r=_slicedToArray2(k_("fusedOps",e,t,n),2),a=r[0],i=r[1],o="biasadd"===a,s="prelu"===i,u="fusedbatchnorm"===a,c=k_("numArgs",e,t,n);if(o){if(s&&2!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!s&&1!==c)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(u)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");var l=k_("strides",e,t,n),h=T_(e,t,n),f=k_("dataFormat",e,t,n).toUpperCase(),d=k_("dilations",e,t,n),p=_slicedToArray2(k_("args",e,t,n),2);return{stride:l,pad:h,dataFormat:f,dilations:d,biasArg:p[0],preluArg:p[1],activationFunc:i}}function hb(e,t,n){return{boxes:k_("boxes",e,t,n),scores:k_("scores",e,t,n),maxOutputSize:k_("maxOutputSize",e,t,n),iouThreshold:k_("iouThreshold",e,t,n),scoreThreshold:k_("scoreThreshold",e,t,n),softNmsSigma:k_("softNmsSigma",e,t,n)}}var fb=function(){function e(t,n){_classCallCheck2(this,e),this.keyDType=t,this.valueDType=n,this.handle=Pa(0),this.tensorMap=new Map,ca(this.handle)}var t,n;return _createClass2(e,[{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"import",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return a=e.sent,e.abrupt("return",(this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),sa((function(){var e=Cu(n),t=a.length,o=e.length;r.assert(t===o,(function(){return"The number of elements doesn't match, keys has ".concat(t," elements, the values has ").concat(o," elements.")}));for(var s=0;s<t;s++){var u=a[s],c=e[s];ca(c),i.tensorMap.set(u,c)}return i.handle}))));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"find",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",sa((function(){for(var e=[],t=0;t<r.length;t++){var i=a.findWithDefault(r[t],n);e.push(i)}return fu(e)})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+e.dtype);if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+t.dtype)}},{key:"id",get:function(){return this.handle.id}}]),e}();function db(e,t,n,a){var i=function(e,t,n){switch(e.category){case"arithmetic":return sa((function(){return function(e,t,n){switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[ba(k_("a",e,t,n),k_("b",e,t,n))];case"AddN":return[$a(k_("tensors",e,t,n))];case"FloorMod":case"Mod":return[ls(k_("a",e,t,n),k_("b",e,t,n))];case"Mul":return[xa(k_("a",e,t,n),k_("b",e,t,n))];case"RealDiv":case"Div":return[wa(k_("a",e,t,n),k_("b",e,t,n))];case"DivNoNan":return[mo(k_("a",e,t,n),k_("b",e,t,n))];case"FloorDiv":return[ka(k_("a",e,t,n),k_("b",e,t,n))];case"Sub":return[ja(k_("a",e,t,n),k_("b",e,t,n))];case"Minimum":return[us(k_("a",e,t,n),k_("b",e,t,n))];case"Maximum":return[Ha(k_("a",e,t,n),k_("b",e,t,n))];case"Pow":return[Ba(k_("a",e,t,n),k_("b",e,t,n))];case"SquaredDifference":return[lu(k_("a",e,t,n),k_("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"basic_math":return sa((function(){return function(e,t,n){switch(e.op){case"Abs":case"ComplexAbs":return[qa(k_("x",e,t,n))];case"Acos":return[Za(k_("x",e,t,n))];case"Acosh":return[Ja(k_("x",e,t,n))];case"Asin":return[fi(k_("x",e,t,n))];case"Asinh":return[di(k_("x",e,t,n))];case"Atan":return[pi(k_("x",e,t,n))];case"Atan2":return[mi(k_("x",e,t,n),k_("y",e,t,n))];case"Atanh":return[vi(k_("x",e,t,n))];case"Ceil":return[Hi(k_("x",e,t,n))];case"Complex":return[Ht(k_("real",e,t,n),k_("imag",e,t,n))];case"Cos":return[io(k_("x",e,t,n))];case"Cosh":return[oo(k_("x",e,t,n))];case"Elu":return[go(k_("x",e,t,n))];case"Erf":return[yo(k_("x",e,t,n))];case"Exp":return[_o(k_("x",e,t,n))];case"Expm1":return[ko(k_("x",e,t,n))];case"Floor":return[Co(k_("x",e,t,n))];case"Log":return[qo(k_("x",e,t,n))];case"Log1p":return[Uo(k_("x",e,t,n))];case"Imag":return[Do(k_("x",e,t,n))];case"Neg":return[Wo(k_("x",e,t,n))];case"Reciprocal":return[Ls(k_("x",e,t,n))];case"Real":return[ms(k_("x",e,t,n))];case"Relu":return[zs(k_("x",e,t,n))];case"Round":return[Gs(k_("x",e,t,n))];case"Selu":return[Ks(k_("x",e,t,n))];case"Sigmoid":return[Fi(k_("x",e,t,n))];case"Sin":return[Zs(k_("x",e,t,n))];case"Sign":return[Ys(k_("x",e,t,n))];case"Sinh":return[Js(k_("x",e,t,n))];case"Softplus":return[Go(k_("x",e,t,n))];case"Sqrt":return[Ca(k_("x",e,t,n))];case"Square":return[Sa(k_("x",e,t,n))];case"Tanh":return[Li(k_("x",e,t,n))];case"Tan":return[mu(k_("x",e,t,n))];case"Relu6":case"ClipByValue":return[Ki(k_("x",e,t,n),k_("clipValueMin",e,t,n),k_("clipValueMax",e,t,n))];case"Rsqrt":return[Hs(w_(e.inputNames[0],t,n))];case"Prod":return[Ts(k_("x",e,t,n),k_("axes",e,t,n))];case"LeakyRelu":return[Lo(k_("x",e,t,n),k_("alpha",e,t,n))];case"Prelu":return[Ss(k_("x",e,t,n),k_("alpha",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"control":return(u=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,f,d,p,m,v,g,y,_,b,k,w,x,C,S,T,A,E,I,R,O,N,D,P,F,M,L,z,B,j,V,q,U,W,G,H,K,X,Q,Y,Z,J,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,he,fe,de,pe,me,ve,ge,ye,_e,be,ke,we,xe,Ce,Se,Te,Ae,Ee;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0?3:"StatelessIf"===e.t0?3:"While"===e.t0?12:"StatelessWhile"===e.t0?12:"LoopCond"===e.t0?16:"Switch"===e.t0?17:"Merge"===e.t0?28:"Enter"===e.t0?30:"Exit"===e.t0?32:"NextIteration"===e.t0?34:"TensorArrayV3"===e.t0?36:"TensorArrayWriteV3"===e.t0?38:"TensorArrayReadV3"===e.t0?40:"TensorArrayGatherV3"===e.t0?42:"TensorArrayScatterV3"===e.t0?44:"TensorArrayConcatV3"===e.t0?46:"TensorArraySplitV3"===e.t0?48:"TensorArraySizeV3"===e.t0?50:"TensorArrayCloseV3"===e.t0?52:"TensorListSetItem"===e.t0?54:"TensorListGetItem"===e.t0?56:"TensorListScatterV2"===e.t0?58:"TensorListScatter"===e.t0?58:"TensorListReserve"===e.t0?60:"TensorListGather"===e.t0?62:"TensorListStack"===e.t0?64:"TensorListFromTensor"===e.t0?66:"TensorListConcat"===e.t0?68:"TensorListPushBack"===e.t0?70:"TensorListPopBack"===e.t0?72:"TensorListSplit"===e.t0?74:76;break;case 3:return a=k_("thenBranch",t,n,r),i=k_("elseBranch",t,n,r),o=k_("cond",t,n,r),s=k_("args",t,n,r),e.next=6,o.data();case 6:if(!e.sent[0]){e.next=10;break}e.t1=r.functionMap[a].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap),e.next=11;break;case 10:e.t1=r.functionMap[i].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap);case 11:return e.abrupt("return",e.t1);case 12:return e.delegateYield(regeneratorRuntime.mark((function e(){var a,i,o,s,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=k_("body",t,n,r),i=k_("cond",t,n,r),o=k_("args",t,n,r),e.next=5,r.functionMap[i].executeFunctionAsync(o,r.tensorArrayMap,r.tensorListMap);case 5:return s=e.sent,u=o.map((function(e){return e.id})),e.next=9,s[0].data();case 9:c=e.sent,s.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||e.dispose()})),l=o,h=regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l,e.next=3,r.functionMap[a].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 3:return l=e.sent,n=l.map((function(e){return e.id})),t.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()})),e.next=8,r.functionMap[i].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 8:return o=e.sent,e.next=11,o[0].data();case 11:c=e.sent,o.forEach((function(e){e.kept||-1!==u.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 13:if(!c[0]){e.next=17;break}return e.delegateYield(h(),"t0",15);case 15:e.next=13;break;case 17:return e.abrupt("return",{v:l});case 18:case"end":return e.stop()}}),e)}))(),"t2",13);case 13:if("object"!=typeof(u=e.t2)){e.next=16;break}return e.abrupt("return",u.v);case 16:return e.abrupt("return",[A_(k_("pred",t,n,r))]);case 17:return c=k_("pred",t,n,r),(l=k_("data",t,n,r)).kept||(l=A_(l)),e.next=22,c.data();case 22:if(!e.sent[0]){e.next=26;break}e.t3=[void 0,l],e.next=27;break;case 26:e.t3=[l,void 0];case 27:return e.abrupt("return",e.t3);case 28:return h=t.inputNames.find((function(e){return void 0!==w_(e,n,r)})),e.abrupt("return",h?[A_(w_(h,n,r))]:void 0);case 30:return f=k_("frameName",t,n,r),d=k_("tensor",t,n,r),e.abrupt("return",(r.enterFrame(f),[A_(d)]));case 32:return p=k_("tensor",t,n,r),e.abrupt("return",(r.exitFrame(),[A_(p)]));case 34:return m=k_("tensor",t,n,r),e.abrupt("return",(r.nextIteration(),[A_(m)]));case 36:return v=k_("size",t,n,r),g=k_("dtype",t,n,r),y=k_("elementShape",t,n,r),_=k_("dynamicSize",t,n,r),b=k_("clearAfterRead",t,n,r),k=k_("identicalElementShapes",t,n,r),w=k_("name",t,n,r),x=new ub(w,g,v,y,k,_,b),e.abrupt("return",(r.addTensorArray(x),[x.idTensor,Pa(1)]));case 38:return C=k_("tensorArrayId",t,n,r),S=k_("index",t,n,r),T=k_("tensor",t,n,r),A=r.getTensorArray(C.id),e.abrupt("return",(A.write(S,T),[A.idTensor]));case 40:return E=k_("tensorArrayId",t,n,r),I=k_("index",t,n,r),e.abrupt("return",[r.getTensorArray(E.id).read(I)]);case 42:return R=k_("tensorArrayId",t,n,r),O=k_("indices",t,n,r),N=k_("dtype",t,n,r),e.abrupt("return",[r.getTensorArray(R.id).gather(O,N)]);case 44:return D=k_("tensorArrayId",t,n,r),P=k_("indices",t,n,r),F=k_("tensor",t,n,r),M=r.getTensorArray(D.id),e.abrupt("return",(M.scatter(P,F),[M.idTensor]));case 46:return L=k_("tensorArrayId",t,n,r),z=r.getTensorArray(L.id),B=k_("dtype",t,n,r),e.abrupt("return",[z.concat(B)]);case 48:return j=k_("tensorArrayId",t,n,r),V=k_("tensor",t,n,r),q=k_("lengths",t,n,r),U=r.getTensorArray(j.id),e.abrupt("return",(U.split(q,V),[U.idTensor]));case 50:return W=k_("tensorArrayId",t,n,r),e.abrupt("return",[Pa(r.getTensorArray(W.id).size(),"int32")]);case 52:return G=k_("tensorArrayId",t,n,r),H=r.getTensorArray(G.id),e.abrupt("return",(H.clearAndClose(),[H.idTensor]));case 54:return K=k_("tensorListId",t,n,r),X=k_("index",t,n,r),Q=k_("tensor",t,n,r),Y=r.getTensorList(K.id),e.abrupt("return",(Y.setItem(X,Q),[Y.idTensor]));case 56:return Z=k_("tensorListId",t,n,r),J=k_("index",t,n,r),$=k_("elementShape",t,n,r),ee=k_("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Z.id).getItem(J,$,ee)]);case 58:return te=k_("indices",t,n,r),ne=function(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,_toConsumableArray(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new cb([],n,e.dtype,r),o=Cu(e,0);return t.forEach((function(e,t){i.setItem(e,o[t])})),i}(k_("tensor",t,n,r),te,k_("elementShape",t,n,r),k_("numElements",t,n,r)),e.abrupt("return",(r.addTensorList(ne),[ne.idTensor]));case 60:return Te=k_("elementShape",t,n,r),Ae=k_("elementDType",t,n,r),Ee=k_("numElements",t,n,r),re=new cb([],Te,Ae,Ee),e.abrupt("return",(r.addTensorList(re),[re.idTensor]));case 62:return ae=k_("tensorListId",t,n,r),ie=k_("indices",t,n,r),oe=k_("elementShape",t,n,r),se=k_("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(ae.id).gather(ie,se,oe)]);case 64:return ue=k_("tensorListId",t,n,r),ce=k_("elementShape",t,n,r),le=k_("elementDType",t,n,r),he=k_("numElements",t,n,r),e.abrupt("return",[r.getTensorList(ue.id).stack(ce,le,he)]);case 66:return fe=function(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: "+e.shape);if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));sb(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=Cu(e);return new cb(a,t,r)}(k_("tensor",t,n,r),k_("elementShape",t,n,r),k_("elementDType",t,n,r)),e.abrupt("return",(r.addTensorList(fe),[fe.idTensor]));case 68:return de=k_("tensorListId",t,n,r),pe=r.getTensorList(de.id),me=k_("dtype",t,n,r),ve=k_("elementShape",t,n,r),e.abrupt("return",[pe.concat(me,ve)]);case 70:return ge=k_("tensorListId",t,n,r),ye=k_("tensor",t,n,r),_e=r.getTensorList(ge.id),e.abrupt("return",(_e.pushBack(ye),[_e.idTensor]));case 72:return be=k_("tensorListId",t,n,r),ke=k_("elementShape",t,n,r),we=k_("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(be.id).popBack(ke,we)]);case 74:return xe=k_("tensor",t,n,r),Ce=k_("elementShape",t,n,r),Se=function(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=0===r?0:e.size/r,o=sa((function(){var o=[];e=fr(e,[1,r,i]);for(var s=0;s<t.length;++s)o[s]=fr(Mi(e,[0,0===s?0:a[s-1],0],[1,t[s],i]),n);return e.dispose(),o})),s=new cb([],n,e.dtype,t.length),u=0;u<o.length;u++)s.setItem(u,o[u]);return s}(xe,k_("lengths",t,n,r),Ce),e.abrupt("return",(r.addTensorList(Se),[Se.idTensor]));case 76:throw TypeError("Node type ".concat(t.op," is not implemented"));case 77:case"end":return e.stop()}}),e)}))),function(e,t,n){return u.apply(this,arguments)})(e,t,n);case"convolution":return sa((function(){return function(e,t,n){switch(e.op){case"Conv1D":var r=k_("stride",e,t,n),a=k_("pad",e,t,n),i=k_("dataFormat",e,t,n).toUpperCase(),o=k_("dilation",e,t,n);return[$i(k_("x",e,t,n),k_("filter",e,t,n),r,a,i,o)];case"Conv2D":var s=k_("strides",e,t,n),u=T_(e,t,n),c=k_("dataFormat",e,t,n).toUpperCase(),l=k_("dilations",e,t,n);return[Ji(k_("x",e,t,n),k_("filter",e,t,n),[s[1],s[2]],u,c,[l[1],l[2]])];case"_FusedConv2D":var h=lb(e,t,n),f=h.stride,d=h.pad,p=h.dataFormat,v=h.dilations,g=h.biasArg,y=h.preluArg,_=h.activationFunc;return[m.conv2d({x:k_("x",e,t,n),filter:k_("filter",e,t,n),strides:[f[1],f[2]],pad:d,dataFormat:p,dilations:[v[1],v[2]],bias:g,activation:_,preluActivationWeights:y})];case"FusedDepthwiseConv2dNative":var b=lb(e,t,n),k=b.stride,w=b.pad,x=b.dataFormat,C=b.dilations,S=b.biasArg,T=b.preluArg,A=b.activationFunc;return[m.depthwiseConv2d({x:k_("x",e,t,n),filter:k_("filter",e,t,n),strides:[k[1],k[2]],pad:w,dataFormat:x,dilations:[C[1],C[2]],bias:S,activation:A,preluActivationWeights:T})];case"Conv2DBackpropInput":case"Conv2dTranspose":var E=k_("outputShape",e,t,n),I=k_("strides",e,t,n),R=T_(e,t,n);return[to(k_("x",e,t,n),k_("filter",e,t,n),E,[I[1],I[2]],R)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var O=k_("strides",e,t,n),N=T_(e,t,n),D=k_("dilations",e,t,n),P=k_("dataFormat",e,t,n).toUpperCase();return[co(k_("input",e,t,n),k_("filter",e,t,n),[O[1],O[2]],N,P,[D[1],D[2]])];case"Conv3D":var F=k_("strides",e,t,n),M=k_("pad",e,t,n),L=k_("dataFormat",e,t,n).toUpperCase(),z=k_("dilations",e,t,n);return[no(k_("x",e,t,n),k_("filter",e,t,n),[F[1],F[2],F[3]],M,L,[z[1],z[2],z[3]])];case"AvgPool":var B=k_("strides",e,t,n),j=k_("pad",e,t,n),V=k_("kernelSize",e,t,n);return[Ri(k_("x",e,t,n),[V[1],V[2]],[B[1],B[2]],j)];case"MaxPool":var q=k_("strides",e,t,n),U=k_("pad",e,t,n),W=k_("kernelSize",e,t,n);return[ts(k_("x",e,t,n),[W[1],W[2]],[q[1],q[2]],U)];case"MaxPoolWithArgmax":var G=k_("strides",e,t,n),H=k_("pad",e,t,n),K=k_("kernelSize",e,t,n),X=k_("includeBatchInIndex",e,t,n),Q=rs(k_("x",e,t,n),[K[1],K[2]],[G[1],G[2]],H,X);return[Q.result,Q.indexes];case"AvgPool3D":var Y=k_("strides",e,t,n),Z=k_("pad",e,t,n),J=k_("kernelSize",e,t,n);return[Oi(k_("x",e,t,n),[J[1],J[2],J[3]],[Y[1],Y[2],Y[3]],Z)];case"MaxPool3D":var $=k_("strides",e,t,n),ee=k_("pad",e,t,n),te=k_("kernelSize",e,t,n);return[ns(k_("x",e,t,n),[te[1],te[2],te[3]],[$[1],$[2],$[3]],ee)];case"Dilation2D":var ne=k_("strides",e,t,n),re=k_("pad",e,t,n),ae=k_("dilations",e,t,n),ie=ne[1],oe=ne[2],se=ae[1],ue=ae[2];return[ho(k_("x",e,t,n),k_("filter",e,t,n),[ie,oe],re,[se,ue],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"creation":return sa((function(){return function(e,t,n){switch(e.op){case"Fill":var r=k_("shape",e,t,n),a=k_("dtype",e,t,n);return[La(r,k_("value",e,t,n),a)];case"LinSpace":return[jo(k_("start",e,t,n),k_("stop",e,t,n),k_("num",e,t,n))];case"Multinomial":var i=k_("logits",e,t,n),o=k_("numSamples",e,t,n),s=k_("seed",e,t,n);return[ds(i,o,s)];case"OneHot":var u=k_("indices",e,t,n),c=k_("depth",e,t,n),l=k_("onValue",e,t,n),h=k_("offValue",e,t,n);return[pr(u,c,l,h)];case"Ones":return[is(k_("shape",e,t,n),k_("dtype",e,t,n))];case"OnesLike":return[vs(k_("x",e,t,n))];case"RandomUniform":return[Ps(k_("shape",e,t,n),k_("minval",e,t,n),k_("maxval",e,t,n),k_("dtype",e,t,n))];case"Range":return[Ms(k_("start",e,t,n),k_("stop",e,t,n),k_("step",e,t,n),k_("dtype",e,t,n))];case"TruncatedNormal":var f=k_("shape",e,t,n),d=k_("mean",e,t,n),p=k_("stdDev",e,t,n),m=k_("seed",e,t,n);return[ku(f,d,p,k_("dtype",e,t,n),m)];case"Zeros":return[as(k_("shape",e,t,n),k_("dtype",e,t,n))];case"ZerosLike":return[Ta(k_("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"dynamic":return(s=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i,o,s,u,c,l,h,f,d,p,m,v,g,y,_,b,k,w,x,C,S,T,A;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?3:"NonMaxSuppressionV4"===e.t0?14:"NonMaxSuppressionV3"===e.t0?25:"NonMaxSuppressionV2"===e.t0?25:"Where"===e.t0?30:"ListDiff"===e.t0?36:37;break;case 3:return a=hb(t,n,r),i=a.boxes,o=a.scores,s=a.maxOutputSize,u=a.iouThreshold,c=a.scoreThreshold,l=a.softNmsSigma,e.next=12,Yc.nonMaxSuppressionWithScoreAsync(i,o,s,u,c,l);case 12:return h=e.sent,e.abrupt("return",[h.selectedIndices,h.selectedScores]);case 14:return f=hb(t,n,r),d=f.boxes,p=f.scores,m=f.maxOutputSize,v=f.iouThreshold,g=f.scoreThreshold,y=k_("padToMaxOutputSize",t,n,r),e.next=23,Yc.nonMaxSuppressionPaddedAsync(d,p,m,v,g,y);case 23:return _=e.sent,e.abrupt("return",[_.selectedIndices,_.validOutputs]);case 25:return b=hb(t,n,r),k=b.boxes,w=b.scores,x=b.maxOutputSize,C=b.iouThreshold,S=b.scoreThreshold,e.next=28,Yc.nonMaxSuppressionAsync(k,w,x,C,S);case 28:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 30:return T=Un(k_("condition",t,n,r),"bool"),e.next=33,Au(T);case 33:return e.t2=e.sent,A=[e.t2],e.abrupt("return",(T.dispose(),A));case 36:return e.abrupt("return",Qs(k_("x",t,n,r),k_("y",t,n,r)));case 37:throw TypeError("Node type ".concat(t.op," is not implemented"));case 38:case"end":return e.stop()}}),e)}))),function(e,t,n){return s.apply(this,arguments)})(e,t,n);case"evaluation":return sa((function(){return function(e,t,n){switch(e.op){case"TopKV2":var r=k_("x",e,t,n),a=k_("k",e,t,n),i=k_("sorted",e,t,n),o=bu(r,a,i);return[o.values,o.indices];case"Unique":var s=k_("x",e,t,n),u=wu(s);return[u.values,u.indices];case"UniqueV2":var c=k_("x",e,t,n),l=k_("axis",e,t,n),h=wu(c,l);return[h.values,h.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"image":return sa((function(){return function(e,t,n){switch(e.op){case"ResizeBilinear":var r=k_("images",e,t,n),a=k_("size",e,t,n),i=k_("alignCorners",e,t,n);return[Yc.resizeBilinear(r,[a[0],a[1]],i)];case"ResizeNearestNeighbor":var o=k_("images",e,t,n),s=k_("size",e,t,n),u=k_("alignCorners",e,t,n);return[Yc.resizeNearestNeighbor(o,[s[0],s[1]],u)];case"CropAndResize":var c=k_("image",e,t,n),l=k_("boxes",e,t,n),h=k_("boxInd",e,t,n),f=k_("cropSize",e,t,n),d=k_("method",e,t,n),p=k_("extrapolationValue",e,t,n);return[Yc.cropAndResize(c,l,h,f,d,p)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"graph":return sa((function(){return function(e,t,n){switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var r=k_("default",e,t,n);return[w_(e.name,t,n)||r];case"Placeholder":return[w_(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[A_(k_("x",e,t,n))];case"IdentityN":return k_("x",e,t,n).map((function(e){return A_(e)}));case"Snapshot":return[A_(k_("x",e,t,n))];case"Shape":return[Fs(k_("x",e,t,n).shape,"int32")];case"ShapeN":return k_("x",e,t,n).map((function(e){return Fs(e.shape)}));case"Size":return[Pa(k_("x",e,t,n).size,"int32")];case"Rank":return[Pa(k_("x",e,t,n).rank,"int32")];case"NoOp":return[Pa(1)];case"Print":var a=k_("x",e,t,n),i=k_("data",e,t,n),o=k_("message",e,t,n),s=k_("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(var u=0;u<i.length;u++)console.log(Array.prototype.slice.call(i[u].dataSync()).slice(0,s));return[a];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"logical":return sa((function(){return function(e,t,n){switch(e.op){case"Equal":return[fo(k_("a",e,t,n),k_("b",e,t,n))];case"NotEqual":return[ps(k_("a",e,t,n),k_("b",e,t,n))];case"Greater":return[Oo(k_("a",e,t,n),k_("b",e,t,n))];case"GreaterEqual":return[No(k_("a",e,t,n),k_("b",e,t,n))];case"Less":return[zo(k_("a",e,t,n),k_("b",e,t,n))];case"LessEqual":return[Bo(k_("a",e,t,n),k_("b",e,t,n))];case"LogicalAnd":return[Zo(k_("a",e,t,n),k_("b",e,t,n))];case"LogicalNot":return[Jo(k_("a",e,t,n))];case"LogicalOr":return[$o(k_("a",e,t,n),k_("b",e,t,n))];case"Select":case"SelectV2":return[po(k_("condition",e,t,n),k_("a",e,t,n),k_("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"matrices":return sa((function(){return function(e,t,n){switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[dr(k_("a",e,t,n),k_("b",e,t,n),k_("transposeA",e,t,n),k_("transposeB",e,t,n))];case"Transpose":return[mr(k_("x",e,t,n),k_("perm",e,t,n))];case"_FusedMatMul":var r=_slicedToArray2(k_("fusedOps",e,t,n),2),a=r[0],i=r[1],o="biasadd"===a,s="prelu"===i,u=k_("numArgs",e,t,n);if(o){if(s&&2!==u)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!s&&1!==u)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var c=_slicedToArray2(k_("args",e,t,n),2),l=c[0],h=c[1];return[m.matMul({a:k_("a",e,t,n),b:k_("b",e,t,n),transposeA:k_("transposeA",e,t,n),transposeB:k_("transposeB",e,t,n),bias:l,activation:i,preluActivationWeights:h})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"normalization":return sa((function(){return function(e,t,n){switch(e.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Vi(k_("x",e,t,n),k_("mean",e,t,n),k_("variance",e,t,n),k_("offset",e,t,n),k_("scale",e,t,n),k_("epsilon",e,t,n))];case"LRN":return[Vo(k_("x",e,t,n),k_("radius",e,t,n),k_("bias",e,t,n),k_("alpha",e,t,n),k_("beta",e,t,n))];case"Softmax":return[ru(k_("x",e,t,n))];case"LogSoftmax":return[Qo(k_("x",e,t,n))];case"SparseToDense":return[Ku(k_("sparseIndices",e,t,n),k_("outputShape",e,t,n),k_("sparseValues",e,t,n),k_("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"reduction":return sa((function(){return function(e,t,n){switch(e.op){case"Max":var r=k_("axis",e,t,n),a=k_("keepDims",e,t,n);return[Ko(k_("x",e,t,n),r,a)];case"Mean":var i=k_("axis",e,t,n),o=k_("keepDims",e,t,n);return[os(k_("x",e,t,n),i,o)];case"Min":var s=k_("axis",e,t,n),u=k_("keepDims",e,t,n);return[ss(k_("x",e,t,n),s,u)];case"Sum":var c=k_("axis",e,t,n),l=k_("keepDims",e,t,n);return[Xo(k_("x",e,t,n),c,l)];case"All":var h=k_("axis",e,t,n),f=k_("keepDims",e,t,n);return[ui(k_("x",e,t,n),h,f)];case"Any":var d=k_("axis",e,t,n),p=k_("keepDims",e,t,n);return[ci(k_("x",e,t,n),d,p)];case"ArgMax":var m=k_("axis",e,t,n);return[li(k_("x",e,t,n),m)];case"ArgMin":var v=k_("axis",e,t,n);return[hi(k_("x",e,t,n),v)];case"Prod":var g=k_("axis",e,t,n),y=k_("keepDims",e,t,n);return[Ts(k_("x",e,t,n),g,y)];case"Cumsum":var _=k_("axis",e,t,n),b=k_("exclusive",e,t,n),k=k_("reverse",e,t,n);return[so(k_("x",e,t,n),_,b,k)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"slice_join":return sa((function(){return function(e,t,n){switch(e.op){case"ConcatV2":case"Concat":var a=k_("n",e,t,n),i=k_("axis",e,t,n),o=k_("tensors",e,t,n);return o=o.slice(0,a),[Pi(o,i)];case"GatherV2":case"Gather":var s=k_("axis",e,t,n),u=k_("x",e,t,n),c=k_("indices",e,t,n);return[Ro(u,Un(c,"int32"),s)];case"ReverseV2":case"Reverse":var l=k_("axis",e,t,n),h=k_("x",e,t,n);return[js(h,l)];case"Slice":var f=k_("begin",e,t,n),d=k_("size",e,t,n);return[Mi(k_("x",e,t,n),f,d)];case"StridedSlice":var p=k_("begin",e,t,n),m=k_("end",e,t,n),v=k_("strides",e,t,n),g=k_("beginMask",e,t,n),y=k_("endMask",e,t,n),_=k_("ellipsisMask",e,t,n),b=k_("newAxisMask",e,t,n),k=k_("shrinkAxisMask",e,t,n),w=k_("x",e,t,n);return[pu(w,p,m,v,g,y,_,b,k)];case"Pack":return sa((function(){var a=k_("axis",e,t,n),i=k_("tensors",e,t,n),o=i[0].shape,s=hu(i[0]).shape,u=i.map((function(e){var t=r.arraysEqual(e.shape,o);if(!t&&!r.arraysEqual(hu(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:fr(e,o)}));return[fu(u,a)]}));case"Unpack":var x=k_("axis",e,t,n),C=k_("tensor",e,t,n);return Cu(C,x);case"Tile":var S=k_("reps",e,t,n);return[wo(k_("x",e,t,n),S)];case"Split":case"SplitV":var T=k_("axis",e,t,n),A=k_("numOrSizeSplits",e,t,n),E=k_("x",e,t,n);return uu(E,A,T);case"ScatterNd":var I=k_("indices",e,t,n),R=k_("values",e,t,n),O=k_("shape",e,t,n);return[Hu(I,R,O)];case"GatherNd":var N=k_("x",e,t,n),D=k_("indices",e,t,n);return[Xu(N,D)];case"SparseToDense":var P=k_("sparseIndices",e,t,n),F=k_("outputShape",e,t,n),M=k_("sparseValues",e,t,n),L=k_("defaultValue",e,t,n);return[Ku(P,M,F,M.dtype===L.dtype?L:Un(L,M.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"spectral":return sa((function(){return function(e,t,n){switch(e.op){case"FFT":return[au(k_("x",e,t,n))];case"IFFT":return[iu(k_("x",e,t,n))];case"RFFT":return[cu(k_("x",e,t,n))];case"IRFFT":return[ou(k_("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"transformation":return sa((function(){return function(e,t,n){switch(e.op){case"Cast":return[Un(k_("x",e,t,n),k_("dtype",e,t,n))];case"ExpandDims":var r=k_("axis",e,t,n);return[bo(k_("x",e,t,n),r)];case"Squeeze":var a=k_("axis",e,t,n);return[hu(k_("x",e,t,n),a)];case"Reshape":return[fr(k_("x",e,t,n),k_("shape",e,t,n))];case"MirrorPad":return[cs(k_("x",e,t,n),k_("padding",e,t,n),k_("mode",e,t,n))];case"PadV2":case"Pad":return[ys(k_("x",e,t,n),k_("padding",e,t,n),k_("constantValue",e,t,n))];case"SpaceToBatchND":var i=k_("blockShape",e,t,n),o=k_("paddings",e,t,n);return[xs(k_("x",e,t,n),i,o)];case"BatchToSpaceND":var s=k_("blockShape",e,t,n),u=k_("crops",e,t,n);return[Bi(k_("x",e,t,n),s,u)];case"DepthToSpace":var c=k_("blockSize",e,t,n),l=k_("dataFormat",e,t,n).toUpperCase();return[uo(k_("x",e,t,n),c,l)];case"BroadcastTo":return[Gi(k_("x",e,t,n),k_("shape",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"hash_table":return(o=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){var i,o,s,u,c,l,h,f,d,p,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0?3:"HashTableV2"===e.t0?3:"LookupTableImport"===e.t0?5:"LookupTableImportV2"===e.t0?5:"LookupTableFind"===e.t0?10:"LookupTableFindV2"===e.t0?10:15;break;case 3:return i=k_("keyDType",t,n,r),o=k_("valueDType",t,n,r),s=new fb(i,o),e.abrupt("return",(a.addHashTable(t.name,s),[s.handle]));case 5:return u=k_("tableHandle",t,n,r,a),c=k_("keys",t,n,r),l=k_("values",t,n,r),h=a.getHashTableById(u.id),e.next=8,h.import(c,l);case 8:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 10:return f=k_("tableHandle",t,n,r,a),d=k_("keys",t,n,r),p=k_("defaultValue",t,n,r),m=a.getHashTableById(f.id),e.next=13,m.find(d,p);case 13:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 15:throw TypeError("Node type ".concat(t.op," is not implemented"));case 16:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return o.apply(this,arguments)})(e,t,n,a);case"custom":var i=__(e.op);if(i&&i.customExecutor)return i.customExecutor(new ob(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()"))}var o,s,u}(e,t,n);return r.isPromise(i)?i.then((function(e){return[].concat(e)})):[].concat(i)}var pb=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_classCallCheck2(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return _createClass2(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}},{key:"currentContext",set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},get:function(){return this.contexts}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}}]),e}();function mb(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(e).map((function(e){return S_(e)[0]})),l=[];null!=r&&(l=r.map((function(e){return S_(e.name)[0]})));for(var h=_toConsumableArray(t);h.length>0;){var f=h.pop();(_b(f)||bb(f)||kb(f))&&null==o&&(s=(o=f).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(f.name),null==n[f.name]&&-1===c.indexOf(f.name)&&-1===l.indexOf(f.name)&&(0!==f.inputs.length?f.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),h.push(e))})):i.push(f.name))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}var vb=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],gb=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],yb=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2"];function _b(e){return vb.indexOf(e.op)>=0}function bb(e){return gb.indexOf(e.op)>=0}function kb(e){return yb.indexOf(e.op)>=0}var wb=function(){function e(t,n){var r=this;_classCallCheck2(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}var t,n,a,i;return _createClass2(e,[{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function(e,t){var n=mb(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has the dynamic op '").concat(a.op,"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [").concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs [").concat(s,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,i=[],o=Object.keys(a).map((function(e){return S_(e)[0]})).map((function(t){return e.nodes[t]})),s=e.initNodes;o.forEach((function(e){r.has(e.name)&&i.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&i.push(e)})),null!=s&&s.forEach((function(e){r.has(e.name)&&i.push(e)}));for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),t[l.name]||c.push(l),l.children.forEach((function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return u.has(e.name)}))&&i.push(e)}))}return c}(this.graph,this.weightMap,n)}},{key:"execute",value:function(e,t){var n=this;e=this.mapInputs(e);var a=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=a.map((function(e){return n.graph.nodes[S_(e)[0]]})),o=t.map((function(e){return S_(e)[0]})),s=o.map((function(e){return n.graph.nodes[e]}));0===s.length&&(s=this._outputs);var u=this.getCompilationKey(i,s),c=this.compiledMap.get(u);null==c&&(c=this.compile(e,s),this.compiledMap.set(u,c));var l={},h={};return sa((function(){var a=new pb(n.weightMap,l,h,n.functionExecutorMap),i=Object.assign({},n.weightMap);Object.keys(e).forEach((function(t){var n=_slicedToArray2(S_(t),2),r=n[0],a=[];a[n[1]]=e[t],i[r]=a}));for(var s=n.getFrozenTensorIds(i),u={},f=0;f<c.length;f++){var d=c[f];if(!i[d.name]){var p=db(d,i,a,n._resourceManager);if(r.isPromise(p))throw new Error("The execution of the op '".concat(d.op,"' returned a promise. Please use model.executeAsync() instead."));i[d.name]=p,n.checkTensorForDisposal(d.name,d,i,a,s,o,u)}}return null==n.parent&&a.dispose(s),t.map((function(e){return w_(e,i,a)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,i,o){"control"!==t.category&&-1===i.indexOf(e)&&(n[e].forEach((function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var t=function(e,t,n){return t[C_(e,n.currentContextId)]}(e.name,n,r);null!=t&&t.forEach((function(e){if(e&&!a.has(e.id)){var t=o[e.id];1===t?(e.dispose(),delete o[e.id]):null!=t&&o[e.id]--}}))}})))}},{key:"executeAsync",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"_executeAsync",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>2&&void 0!==f[2]&&f[2],a=f.length>3&&void 0!==f[3]?f[3]:{},i=f.length>4&&void 0!==f[4]?f[4]:{},r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n)),o=new pb(this.weightMap,a,i,this.functionExecutorMap),e.next=7,this.executeWithControlFlow(t,o,n,r);case 7:return s=e.sent,u=n.map((function(e){return w_(e,s,o)})),c=u.map((function(e){return e.id})),l=Object.keys(t).map((function(e){return t[e].id})),h=new Set([].concat(_toConsumableArray(c),_toConsumableArray(l),_toConsumableArray(this.weightIds))),e.abrupt("return",(Object.keys(s).forEach((function(e){s[e].forEach((function(e){!e||e.isDisposed||h.has(e.id)||e.dispose()}))})),null==this.parent&&o.dispose(h),u));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"executeFunctionAsync",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var a,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"executeWithControlFlow",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,a){var i,o,s,u,c,l,h,f,d,p,m,v,g,y,_,b,k,w=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.keys(t),o=i.map((function(e){return w.graph.nodes[S_(e)[0]]})),s=r.map((function(e){return S_(e)[0]})),0===(u=s.map((function(e){return w.graph.nodes[e]}))).length&&(u=this._outputs),c=mb(t,u,this.weightMap,this._initNodes),l=c.usedNodes,h=c.missingInputs,f=c.dynamicNode,d=c.syncInputs,p=[].concat(_toConsumableArray(o),_toConsumableArray(this.graph.weights),_toConsumableArray(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),m=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=_slicedToArray2(S_(e),2),r=n[0],a=[];a[n[1]]=t[e],m[r]=a})),v={},g=this.getFrozenTensorIds(m),y={};case 6:if(!(p.length>0)){e.next=12;break}return _=this.processStack(o,p,n,m,y,g,s,v,l),e.next=10,Promise.all(_);case 10:e.next=6;break;case 12:if(null!=f||a||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),!((b=u.filter((function(e){return!_b(e)&&!w_(e.name,m,n)})).map((function(e){return e.name}))).length>0)){e.next=17;break}throw k="",null!=f&&(k="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(b,"] from the provided inputs [").concat(i,"]. Consider providing the following inputs: [").concat(h,"]. ").concat(k));case 17:return e.abrupt("return",m);case 18:case"end":return e.stop()}}),e,this)}))),function(e,n,r,a){return t.apply(this,arguments)})},{key:"processStack",value:function(e,t,n,a,i,o,s,u,c){for(var l=this,h=[],f=function(){var e,f=t.pop();n.currentContext=f.contexts;var d="";if("Enter"===f.node.op&&k_("isConstant",f.node,a,n)&&(e=_slicedToArray2(x_(f.node.name,n),1),d=e[0]),null==a[f.node.name]){var p,m=db(f.node,a,n,l._resourceManager);d||(p=_slicedToArray2(x_(f.node.name,n),1),d=p[0]);var v=n.currentContext;r.isPromise(m)?h.push(m.then((function(e){return a[d]=e,n.currentContext=v,l.checkTensorForDisposal(d,f.node,a,n,o,s,u),l.processChildNodes(f.node,t,n,a,i,c),e}))):(a[d]=m,l.checkTensorForDisposal(d,f.node,a,n,o,s,u),l.processChildNodes(f.node,t,n,a,i,c))}else l.processChildNodes(f.node,t,n,a,i,c)};t.length>0;)f();return h}},{key:"processChildNodes",value:function(e,t,n,r,a,i){e.children.forEach((function(e){var o=_slicedToArray2(x_(e.name,n),1)[0];!a[o]&&i.has(e.name)&&("Merge"===e.op?e.inputNames.some((function(e){return!!w_(e,r,n)}))&&(a[o]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!w_(e,r,n)}))&&(a[o]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var a=e[n],i=_slicedToArray2(S_(n),1)[0],o=t.graph.nodes[i];if(o.attrParams.shape&&o.attrParams.shape.value){var s=o.attrParams.shape.value,u=s.length===a.shape.length&&a.shape.every((function(e,t){return-1===s[t]||s[t]===e}));r.assert(u,(function(){return"The shape of dict['".concat(o.name,"'] provided in model.execute(dict) must be [").concat(s,"], but was [").concat(a.shape,"]")}))}o.attrParams.dtype&&o.attrParams.dtype.value&&r.assert(a.dtype===o.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(o.name,"'] provided in model.execute(dict) must be ").concat(o.attrParams.dtype.value,", but was ").concat(a.dtype)}))}))}},{key:"mapInputs",value:function(e){var t={};for(var n in e)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]?t[this._signature.inputs[n].name]=e[n]:t[n]=e[n];return t}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=_slicedToArray2(S_(e),1)[0];return null==t.graph.nodes[n]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=_slicedToArray2(S_(e),1)[0];if(!t.graph.nodes[n])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}},{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,_toConsumableArray(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}}]),e}(),xb=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck2(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return _createClass2(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),Cb=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck2(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",null==n&&(this.loadOptions={}),this.resourceManager=new xb}var t,n,r;return _createClass2(e,[{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=o.browserHTTPRequest(e,this.loadOptions);else{var t=o.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(o.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for URL '").concat([e],"'"));this.handler=t[0]}}},{key:"load",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.findIOHandler(),null!=this.handler.load){e.next=2;break}throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 2:return e.next=4,this.handler.load();case 4:return t=e.sent,e.abrupt("return",this.loadSync(t));case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"loadSync",value:function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n={};null!=this.artifacts.userDefinedMetadata&&(n=this.artifacts.userDefinedMetadata.signature),this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var r=o.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new wb(G_.Instance.transformGraph(t,n)),this.executor.weightMap=this.convertTensorMapToTensorsMap(r),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer){var a=G_.Instance.transformGraph(e.modelInitializer);this.initializer=new wb(a),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}},{key:"save",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=o.getSaveHandlers(t)).length){e.next=4;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Error("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.abrupt("return",t.save(this.artifacts));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"predict",value:function(e,t){return this.execute(e,this.outputNodes)}},{key:"normalizeInputs",value:function(e){if(!(e instanceof _t||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has ".concat(this.inputNodes.length," placeholders, while there are ").concat(e.length," input tensors."));return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"execute",value:function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=3,this.executor.executeAsync(t,n);case 3:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}},{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}}]),e}();function Sb(e){return Tb.apply(this,arguments)}function Tb(){return(Tb=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:{},null!=t){e.next=3;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 3:return null==n&&(n={}),n.fromTFHub&&null==t.load&&(t.endsWith("/")||(t+="/"),t+="model.json?tfjs-format=file"),r=new Cb(t,n),e.next=7,r.load();case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ab(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(Ob(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=Ab(e[o],t,n,r);i[o]=s}return r.delete(e),i}throw new Error("Can't recurse into non-iterable type: "+e)}return n.set(e,a.value),a.value}function Eb(e){return null===e?null:Ob(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function Ib(e,t){return Rb.apply(this,arguments)}function Rb(){return(Rb=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){var a,i,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new Map,Ab(t,n,a),i=0,o=Array.from(a.keys());case 3:if(!(i<o.length)){e.next=14;break}if(s=o[i],u=a.get(s),!r.isPromise(u)){e.next=11;break}return e.next=9,u;case 9:c=e.sent,a.set(s,c);case 11:i++,e.next=3;break;case 14:return e.abrupt("return",Ab(t,n,a));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ob(e){return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof _t))}function Nb(e){return e instanceof _t?{value:e.clone(),recurse:!1}:Ob(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var Db=function(){function e(t){if(_classCallCheck2(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return _createClass2(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=_createForOfIteratorHelper(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(sI){n.e(sI)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),Pb=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.call(this,n.INITIAL_CAPACITY)}return _createClass2(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){_get(_getPrototypeOf(n.prototype),"isFull",this).call(this)&&this.expand(),_get(_getPrototypeOf(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){_get(_getPrototypeOf(n.prototype),"isFull",this).call(this)&&this.expand(),_get(_getPrototypeOf(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(Db);function Fb(e){return new Bb(e)}function Mb(e){return new jb(e)}Pb.INITIAL_CAPACITY=32;var Lb,zb=function(){function e(){_classCallCheck2(this,e)}var t,n,r,a,i,o;return _createClass2(e,[{key:"toArray",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"toArrayForTest",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=3,t.next();case 3:r=e.sent;case 4:if(r.done){e.next=11;break}return n.push(r.value),e.next=8,t.next();case 8:r=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"resolveFully",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent;case 7:e.next=3;break;case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"resolveWhile",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value);case 9:e.next=4;break;case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"handleErrors",value:function(e){return new Kb(this,e)}},{key:"filter",value:function(e){return new Gb(this,e)}},{key:"map",value:function(e){return new Hb(this,e)}},{key:"mapAsync",value:function(e){return new Xb(this,e)}},{key:"serialMapAsync",value:function(e){return new Xb(this,e).serial()}},{key:"flatmap",value:function(e){return new Yb(this,e)}},{key:"forEachAsync",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"serialForEach",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"rowMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Wb(this,e,t)}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Eb;return this.rowMajorBatch(e,t).map((function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Eb;return function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,a=t[0];if(r.has(a))throw new Error("Circular references are not supported.");var i=n(t);if(i.recurse&&null!==i.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(Ob(a)){var o=Array.isArray(a)?[]:{};r.add(a);var s=function(a){var i=e(t.map((function(e){return e[a]})),n,r);o[a]=i};for(var u in a)s(u);return r.delete(a),o}throw new Error("Can't recurse into non-iterable type: "+a)}return i.value}(e,t)}(e,n)}))}},{key:"concatenate",value:function(e,t){return new Zb(Fb([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new Ub(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new qb(this,e)}},{key:"prefetch",value:function(e){return new $b(this,e)}},{key:"shuffle",value:function(e,t){return new ek(this,e,t)}},{key:"serial",value:function(){return new Vb(this)}}]),e}(),Bb=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t;return _classCallCheck2(this,r),(t=n.call(this)).items=e,t.trav=0,t}return _createClass2(r,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],e.abrupt("return",(this.trav++,{value:(n=t,Ab(n,Nb)),done:!1}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(zb),jb=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t;return _classCallCheck2(this,r),(t=n.call(this)).nextFn=e,t}return _createClass2(r,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: "+e.t0.message,e.t0;case 7:case"end":return e.stop()}}),e,this,[[0,4]])}))),function(){return t.apply(this,arguments)})}]),r}(zb),Vb=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t;return _classCallCheck2(this,a),(t=r.call(this)).upstream=e,t.lastRead=Promise.resolve({value:null,done:!1}),t}return _createClass2(a,[{key:"summary",value:function(){return this.upstream.summary()+" -> Serial"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(zb),qb=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n;return _classCallCheck2(this,a),(n=r.call(this)).upstream=e,n.maxCount=t,n.count=0,n.lastRead=Promise.resolve({value:null,done:!1}),n}return _createClass2(a,[{key:"summary",value:function(){return this.upstream.summary()+" -> Skip"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:ua(t.value);case 7:e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(zb),Ub=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck2(this,r),(a=n.call(this)).upstream=e,a.maxCount=t,a.count=0,a}return _createClass2(r,[{key:"summary",value:function(){return this.upstream.summary()+" -> Take"}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(zb),Wb=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return _classCallCheck2(this,a),(n=r.call(this)).upstream=e,n.batchSize=t,n.enableSmallLastBatch=i,n.lastRead=Promise.resolve({value:null,done:!1}),n}return _createClass2(a,[{key:"summary",value:function(){return this.upstream.summary()+" -> RowMajorBatch"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=10;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=7;break}return e.abrupt("return",this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0});case 7:t.push(n.value);case 8:e.next=1;break;case 10:return e.abrupt("return",{value:t,done:!1});case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(zb),Gb=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n;return _classCallCheck2(this,a),(n=r.call(this)).upstream=e,n.predicate=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return _createClass2(a,[{key:"summary",value:function(){return this.upstream.summary()+" -> Filter"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=5;break}return e.abrupt("return",t);case 5:ua(t.value);case 6:e.next=0;break;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(zb),Hb=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck2(this,r),(a=n.call(this)).upstream=e,a.transform=t,a}return _createClass2(r,[{key:"summary",value:function(){return this.upstream.summary()+" -> Map"}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=a.getTensorsInContainer(t.value),r=this.transform(t.value),i=a.getTensorsInContainer(r),o=_createForOfIteratorHelper(n);try{for(o.s();!(s=o.n()).done;)u=s.value,a.isTensorInList(u,i)||u.dispose()}catch(sI){o.e(sI)}finally{o.f()}return e.abrupt("return",{value:r,done:!1});case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(zb),Kb=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n;return _classCallCheck2(this,a),(n=r.call(this)).upstream=e,n.handler=t,n.count=0,n.lastRead=Promise.resolve({value:null,done:!1}),n}return _createClass2(a,[{key:"summary",value:function(){return this.upstream.summary()+" -> handleErrors"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.upstream.next();case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),this.handler(e.t0)){e.next=10;break}return e.abrupt("return",{value:null,done:!0});case 10:e.next=0;break;case 12:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return t.apply(this,arguments)})}]),a}(zb),Xb=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck2(this,r),(a=n.call(this)).upstream=e,a.transform=t,a}return _createClass2(r,[{key:"summary",value:function(){return this.upstream.summary()+" -> AsyncMap"}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=a.getTensorsInContainer(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,i=a.getTensorsInContainer(r),o=_createForOfIteratorHelper(n);try{for(o.s();!(s=o.n()).done;)u=s.value,a.isTensorInList(u,i)||u.dispose()}catch(sI){o.e(sI)}finally{o.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(zb),Qb=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(){var e;return _classCallCheck2(this,a),(e=r.call(this)).outputQueue=new Pb,e.lastRead=Promise.resolve({value:null,done:!1}),e}return _createClass2(a,[{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(zb),Yb=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck2(this,r),(a=n.call(this)).upstream=e,a.transform=t,a}return _createClass2(r,[{key:"summary",value:function(){return this.upstream.summary()+" -> Flatmap"}},{key:"pump",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,i,o,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=a.getTensorsInContainer(t.value),r=this.transform(t.value),i=a.getTensorsInContainer(r),this.outputQueue.pushAll(r),o=_createForOfIteratorHelper(n);try{for(o.s();!(s=o.n()).done;)u=s.value,a.isTensorInList(u,i)||u.dispose()}catch(sI){o.e(sI)}finally{o.f()}return e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(Qb),Zb=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e,t){var n;return _classCallCheck2(this,a),(n=r.call(this)).baseErrorHandler=t,n.lastRead=null,n.iterator=null,n.moreIterators=e,n}return _createClass2(a,[{key:"summary",value:function(){return"TODO: fill in upstream of chained summaries -> Chained"}},{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.readFromChain(this.lastRead),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"readFromChain",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=9;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 9:return e.next=11,this.iterator.next();case 11:return r=e.sent,e.abrupt("return",r.done?(this.iterator=null,this.readFromChain(t)):r);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(zb);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(Lb||(Lb={}));var Jb=function(e){_inherits(a,e);var t,n,r=_createSuper(a);function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Lb.FAIL;return _classCallCheck2(this,a),(t=r.call(this)).iterators=e,t.mismatchMode=n,t.count=0,t.currentPromise=null,t}return _createClass2(a,[{key:"summary",value:function(){return"{TODO: fill in upstream of zip summaries} -> Zip"}},{key:"nextState",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return n=0,r=0,e.next=5,Ib(this.iterators,(function(e){return e instanceof zb?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}}));case 5:if(a=e.sent,n!==r){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:if(!(r>0)){e.next=14;break}e.t0=this.mismatchMode,e.next=e.t0===Lb.FAIL?12:e.t0===Lb.SHORTEST?13:14;break;case 12:throw new Error("Zipped streams should have the same length. Mismatched at element ".concat(this.count,"."));case 13:return e.abrupt("return",{value:null,done:!0});case 14:return e.abrupt("return",(this.count++,{value:a,done:!1}));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.currentPromise=this.nextState(this.currentPromise),this.currentPromise));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(zb),$b=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var a;return _classCallCheck2(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new Db(r),a}return _createClass2(n,[{key:"summary",value:function(){return this.upstream.summary()+" -> Prefetch"}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(zb),ek=function(e){_inherits(i,e);var t,n,a=_createSuper(i);function i(e,t,n){var o;return _classCallCheck2(this,i),(o=a.call(this,e,t)).upstream=e,o.windowSize=t,o.upstreamExhausted=!1,o.random=Es.alea(n||r.now().toString()),o.lastRead=Promise.resolve({value:null,done:!1}),o}return _createClass2(i,[{key:"next",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=11;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if((n=e.sent).done){e.next=8;break}return e.abrupt("return",(this.refill(),n));case 8:this.upstreamExhausted=!0;case 9:e.next=1;break;case 11:return e.abrupt("return",{value:null,done:!0});case 12:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}($b),tk=function(){function e(){_classCallCheck2(this,e),this.size=null}var t,n,a;return _createClass2(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this;return r.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      "+e})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),nk(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,ik));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,nk(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,nk(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return sa((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"map",value:function(e){var t=this;return nk(_asyncToGenerator(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return sa((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return nk(_asyncToGenerator(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return nk(_asyncToGenerator(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,nk(_asyncToGenerator(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(r=Mb(_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.t1=!1,e.abrupt("return",{value:e.t0,done:e.t1});case 5:case"end":return e.stop()}}),e)})))).take(e),new Zb(r,void 0)));case 1:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,nk(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size (".concat(this.size," elements)"));var a=this,i=Es.alea(t||r.now().toString());return nk(_asyncToGenerator(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.int32(),n&&(r+=i.int32()),t.next=4,a.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,r.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,nk(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"toArrayForTest",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function nk(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){_inherits(i,n);var r,a=_createSuper(i);function i(){var e;return _classCallCheck2(this,i),(e=a.apply(this,arguments)).size=t,e}return _createClass2(i,[{key:"iterator",value:(r=_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)}))),function(){return r.apply(this,arguments)})}]),i}(tk))}function rk(e){return nk(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Fb(e));case 1:case"end":return t.stop()}}),t)}))),e.length)}function ak(e){if(!Ob(e))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(e))for(var n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(var r in e)t=null==t?e[r].size:Math.min(t,e[r].size);return nk(_asyncToGenerator(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Lb.FAIL;return new Jb(e,t)},t.next=3,Ib(e,(function(e){if(e instanceof tk)return{value:e.iterator(),recurse:!1};if(Ob(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}));case 3:return t.t1=t.sent,t.t2=Lb.SHORTEST,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))),t)}function ik(e){return null===e?null:null==(t=e[0])||null===(n=t)||"object"!=typeof n&&"function"!=typeof n||Array.isArray(t)||"object"==typeof t&&t instanceof _t||r.isTypedArray(t)?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof _t?fu(e):Xt(e)}(e),recurse:!1}:{value:null,recurse:!0};var t,n}tk.MAX_BUFFER_SIZE=1e4;var ok=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t;return _classCallCheck2(this,r),(t=n.call(this)).input=e,t}return _createClass2(r,[{key:"iterator",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.input.iterator();case 2:return e.abrupt("return",e.sent.decodeUTF8().split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(tk),sk=Symbol("out"),uk=Symbol("field"),ck=Symbol("quote"),lk=Symbol("quoteafterquote"),hk=Symbol("quoteinquote"),fk=function(e){_inherits(s,e);var t,n,a,i,o=_createSuper(s);function s(e,t){var n;return _classCallCheck2(this,s),(n=o.call(this)).input=e,n.hasHeader=!0,n.fullColumnNames=null,n.columnNamesValidated=!1,n.columnConfigs=null,n.configuredColumnsOnly=!1,n.delimiter=",",n.delimWhitespace=!1,n.base=new ok(e),t||(t={}),n.hasHeader=!1!==t.hasHeader,n.fullColumnNames=t.columnNames,n.columnConfigs=t.columnConfigs,n.configuredColumnsOnly=t.configuredColumnsOnly,t.delimWhitespace?(r.assert(null==t.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),n.delimWhitespace=!0,n.delimiter=" "):n.delimiter=t.delimiter?t.delimiter:",",n}return _createClass2(s,[{key:"columnNames",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.abrupt("return",this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames);case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setColumnNames",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,a,i,o,s,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.maybeReadHeaderLine();case 2:if(t=e.sent,this.fullColumnNames||t){e.next=5;break}throw new Error("Column names must be provided if there is no header line.");case 5:if(this.fullColumnNames&&t&&r.assert(t.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+u.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."})),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),a=Object.keys(n).filter((function(e){return n[e]>1})),r.assert(0===a.length,(function(){return"Duplicate column names found: "+a.toString()})),!this.columnConfigs){e.next=16;break}i=0,o=Object.keys(this.columnConfigs);case 9:if(!(i<o.length)){e.next=16;break}if(s=o[i],-1!==this.fullColumnNames.indexOf(s)){e.next=13;break}throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");case 13:i++,e.next=9;break;case 16:this.columnNamesValidated=!0;case 17:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"maybeReadHeaderLine",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasHeader){e.next=10;break}return e.next=3,this.base.iterator();case 3:return t=e.sent,e.next=6,t.next();case 6:if(!(n=e.sent).done){e.next=9;break}throw new Error("No data was found for CSV parsing.");case 9:return e.abrupt("return",this.parseRow(n.value,!1));case 10:return e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"iterator",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.next=6,this.base.iterator();case 6:return t=e.sent,e.abrupt("return",(this.hasHeader&&(t=t.skip(1)),t.map((function(e){return n.makeDataElement(e)}))));case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"makeDataElement",value:function(e){for(var t=this.parseRow(e),n={},r={},a=0;a<this.fullColumnNames.length;a++){var i=this.fullColumnNames[a],o=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||o){var s=t[a],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column ".concat(i," is empty in this line: ").concat(e));u=void 0}else{var c=Number(s);if(isNaN(c))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(s);break;default:u=c}else u=c}o&&o.isLabel?r[i]=u:n[i]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}},{key:"getBoolean",value:function(e){return"1"===e||"true"===e.toLowerCase()?1:0}},{key:"parseRow",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=0,a=e.length,i=sk,o=0;o<a;o++)switch(i){case sk:switch(e.charAt(o)){case'"':r=o+1,i=ck;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),i=sk;break;default:i=uk,r=o}break;case uk:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o)),i=sk,r=o+1}break;case ck:switch(e.charAt(o)){case'"':i=lk}break;case lk:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),i=sk,r=o+1;break;case'"':i=ck;break;default:i=hk}break;case hk:switch(e.charAt(o)){case'"':i=ck}}if(n.push(i===lk?e.substring(r,a-1):e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(n));return n}}]),s}(tk),dk=function(e){_inherits(u,e);var t,n,a,i,o,s=_createSuper(u);function u(e){var t;_classCallCheck2(this,u),(t=s.call(this)).microphoneConfig=e,t.isClosed=!1,t.fftSize=e.fftSize||1024;var n=Math.log2(t.fftSize);if(t.fftSize<0||n<4||n>14||!Number.isInteger(n))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got "+t.fftSize);if(t.numFrames=e.numFramesPerSpectrogram||43,t.sampleRateHz=e.sampleRateHz,t.columnTruncateLength=e.columnTruncateLength||t.fftSize,t.audioTrackConstraints=e.audioTrackConstraints,t.smoothingTimeConstant=e.smoothingTimeConstant||0,t.includeSpectrogram=!1!==e.includeSpectrogram,t.includeWaveform=!0===e.includeWaveform,!t.includeSpectrogram&&!t.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return t}return _createClass2(u,[{key:"summary",value:function(){return"microphone"}},{key:"start",value:(o=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1});case 3:this.stream=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Error thrown while initializing video stream: "+e.t0.message);case 9:if(this.stream){e.next=11;break}throw new Error("Could not obtain audio from microphone.");case 11:if(t=window.AudioContext||window.webkitAudioContext,this.audioContext=new t,!this.sampleRateHz){e.next=17;break}if(this.audioContext.sampleRate===this.sampleRateHz){e.next=15;break}throw new Error("Mismatch in sampling rate: Expected: ".concat(this.sampleRateHz,"; Actual: ")+this.audioContext.sampleRate);case 15:e.next=18;break;case 17:this.sampleRateHz=this.audioContext.sampleRate;case 18:n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize);case 20:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return o.apply(this,arguments)})},{key:"next",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.next=4,this.getAudioData();case 4:return r=e.sent,this.includeSpectrogram&&(a=this.flattenQueue(r.freqDataQueue),t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(r.timeDataQueue),n=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),e.abrupt("return",{value:{spectrogram:t,waveform:n},done:!1});case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"capture",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getAudioData",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],r=0,e.abrupt("return",new Promise((function(e){var i=setInterval((function(){a.includeSpectrogram&&(a.analyser.getFloatFrequencyData(a.freqData),a.freqData[0]===-1/0&&e({freqDataQueue:t,timeDataQueue:n}),t.push(a.freqData.slice(0,a.columnTruncateLength))),a.includeWaveform&&(a.analyser.getFloatTimeDomainData(a.timeData),n.push(a.timeData.slice())),++r===a.numFrames&&(clearInterval(i),e({freqDataQueue:t,timeDataQueue:n}))}),a.fftSize/a.sampleRateHz*1e3)})));case 3:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"stop",value:function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}},{key:"toArray",value:function(){throw new Error("Can not convert infinite audio stream to array.")}},{key:"getSampleRate",value:function(){return this.sampleRateHz}},{key:"flattenQueue",value:function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n}},{key:"getTensorFromAudioDataArray",value:function(e,t){var n=new Float32Array(r.sizeFromShape(t));return n.set(e,n.length-e.length),Xt(n,t)}}],[{key:"create",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},!ze().get("IS_NODE")){e.next=3;break}throw new Error("microphone API is only supported in browser environment.");case 3:return n=new u(t),e.next=6,n.start();case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),u}(zb),pk=function(e){_inherits(s,e);var t,n,a,i,o=_createSuper(s);function s(e,t){var n;if(_classCallCheck2(this,s),(n=o.call(this)).webcamVideoElement=e,n.webcamConfig=t,n.isClosed=!0,n.resize=!1,n.needToResize())if(n.resize=!0,n.cropSize=[n.webcamConfig.resizeHeight,n.webcamConfig.resizeWidth],n.cropBoxInd=Fs([0],"int32"),n.webcamConfig.centerCrop){var r=1*n.webcamConfig.resizeWidth/n.webcamVideoElement.width,a=1*n.webcamConfig.resizeHeight/n.webcamVideoElement.height,i=(1-r)/2,u=(1-a)/2;n.cropBox=vu([u,i,a+u,i+r],[1,4])}else n.cropBox=vu([0,0,1,1],[1,4]);return _possibleConstructorReturn(n)}return _createClass2(s,[{key:"summary",value:function(){return"webcam"}},{key:"start",value:(i=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.webcamConfig.facingMode&&r.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: ".concat(t.webcamConfig.facingMode,". Please provide 'user' or 'environment'")})),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}});case 4:this.stream=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0.message="Error thrown while initializing video stream: "+e.t0.message,e.t0;case 10:if(this.stream){e.next=12;break}throw new Error("Could not obtain video from webcam.");case 12:try{this.webcamVideoElement.srcObject=this.stream}catch(n){console.log(n),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return e.abrupt("return",(this.webcamVideoElement.play(),this.isClosed=!1,new Promise((function(e){t.webcamVideoElement.onloadedmetadata=function(){e()}}))));case 14:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(){return i.apply(this,arguments)})},{key:"next",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:e.prev=2,t=u.fromPixels(this.webcamVideoElement),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new Error("Error thrown converting video to pixels: "+JSON.stringify(e.t0));case 9:if(this.resize){e.next=11;break}return e.abrupt("return",{value:t,done:!1});case 11:return e.prev=11,e.abrupt("return",{value:this.cropAndResizeFrame(t),done:!1});case 15:throw e.prev=15,e.t1=e.catch(11),new Error("Error thrown cropping the video: "+e.t1.message);case 18:return e.prev=18,t.dispose(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[2,6],[11,15,18,21]])}))),function(){return a.apply(this,arguments)})},{key:"needToResize",value:function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}},{key:"cropAndResizeFrame",value:function(e){var t=this;return sa((function(){var n,r=e.toFloat().expandDims(0);return(n=Yc.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).reshape(n.shape.slice(1))}))}},{key:"capture",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"stop",value:function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(e){console.log(e),this.webcamVideoElement.src=null}this.isClosed=!0}},{key:"toArray",value:function(){throw new Error("Can not convert infinite video stream to array.")}}],[{key:"create",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,r,a=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:{},!ze().get("IS_NODE")){e.next=3;break}throw new Error("tf.data.webcam is only supported in browser environment.");case 3:if(t){e.next=7;break}if(t=document.createElement("video"),n.resizeWidth&&n.resizeHeight){e.next=6;break}throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");case 6:t.width=n.resizeWidth,t.height=n.resizeHeight;case 7:return r=new s(t,n),e.next=10,r.start();case 10:return e.abrupt("return",r);case 11:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),s}(zb),mk=function e(){_classCallCheck2(this,e)},vk=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"split",value:function(e){return new gk(this,e)}}]),n}(zb),gk=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck2(this,r),(a=n.call(this)).upstream=e,a.impl=new yk(e,t),a}return _createClass2(r,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(vk),yk=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e,t){var a;return _classCallCheck2(this,r),(a=n.call(this)).upstream=e,a.separator=t,a.carryover="",a}return _createClass2(r,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")}},{key:"pump",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0));case 5:(n=t.value.split(this.separator))[0]=this.carryover+n[0],r=_createForOfIteratorHelper(n.slice(0,-1));try{for(r.s();!(a=r.n()).done;)i=a.value,this.outputQueue.push(i)}catch(sI){r.e(sI)}finally{r.f()}return e.abrupt("return",(this.carryover=n[n.length-1],!0));case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(Qb),_k=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck2(this,n),t.apply(this,arguments)}return _createClass2(n,[{key:"decodeUTF8",value:function(){return new bk(this)}}]),n}(zb),bk=function(e){_inherits(r,e);var t,n=_createSuper(r);function r(e){var t;return _classCallCheck2(this,r),(t=n.call(this)).upstream=e,t.impl=new kk(e),t}return _createClass2(r,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(vk),kk=function(e){_inherits(a,e);var t,r=_createSuper(a);function a(e){var t;if(_classCallCheck2(this,a),(t=r.call(this)).upstream=e,ze().get("IS_BROWSER"))t.decoder=new TextDecoder("utf-8");else{var i=n(4).StringDecoder;t.decoder=new i("utf8")}return _possibleConstructorReturn(t)}return _createClass2(a,[{key:"summary",value:function(){return this.upstream.summary()+" -> Utf8"}},{key:"pump",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:return t=e.sent,e.abrupt("return",!t.done&&(n=t.value,r=ze().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(r),!0));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(Qb),wk=function(e){_inherits(a,e);var t,n=_createSuper(a);function a(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck2(this,a),(t=n.call(this)).file=e,t.options=i,r.assert(e instanceof Uint8Array||!!ze().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),t.offset=i.offset||0,t.chunkSize=i.chunkSize||1048576,t}return _createClass2(a,[{key:"summary",value:function(){return"FileChunks "+this.file}},{key:"next",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=new Promise((function(e,t){var r=n.offset+n.chunkSize;if(n.file instanceof Uint8Array)e(new Uint8Array(n.file.slice(n.offset,r)));else{var a=new FileReader;a.onload=function(n){var r=a.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return t(new TypeError("FileReader returned unknown type."));e(r)},a.onabort=function(e){return t(new Error("Aborted"))},a.onerror=function(e){return t(new Error(e.type))};var i=n.file.slice(n.offset,r);a.readAsArrayBuffer(i)}n.offset=r})),e.next=5,t;case 5:return e.t0=e.sent,e.t1=!1,e.abrupt("return",{value:e.t0,done:e.t1});case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(_k);function xk(e){return"string"==typeof e&&"file://"===e.substr(0,7)}var Ck=function(e){_inherits(a,e);var t,r=_createSuper(a);function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck2(this,a),(t=r.call(this)).input=e,t.options=n,t}return _createClass2(a,[{key:"iterator",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return xk(this.input)&&ze().get("IS_NODE")&&(t=n(5),this.input=t.readFileSync(this.input.substr(7))),e.abrupt("return",new wk(this.input,this.options));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(mk),Sk=function(e){_inherits(a,e);var t,n=_createSuper(a);function a(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck2(this,a),(t=n.call(this)).url=e,t.fileOptions=r,t}return _createClass2(a,[{key:"iterator",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",xk(this.url)?new Ck(this.url,this.fileOptions).iterator():function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,u,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},"string"==typeof t?a=t:(a=t.url,i={method:(o=t).method,headers:o.headers,body:o.body,mode:o.mode,credentials:o.credentials,cache:o.cache,redirect:o.redirect,referrer:o.referrer,integrity:o.integrity}),e.next=4,r.fetch(a,i);case 4:if(!(s=e.sent).ok){e.next=12;break}return e.t0=Uint8Array,e.next=9,s.arrayBuffer();case 9:return e.t1=e.sent,u=new e.t0(e.t1),e.abrupt("return",new wk(u,n));case 12:throw new Error(s.statusText);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(this.url,this.fileOptions));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(mk);function Tk(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new fk(new Sk(e),t)}function Ak(e){var t=Mb(e);return nk(_asyncToGenerator(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))))}function Ek(e){return nk(_asyncToGenerator(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return n=t.sent,t.abrupt("return",Mb((function(){return n.next()})));case 4:case"end":return t.stop()}}),t)}))))}function Ik(e,t){return Rk.apply(this,arguments)}function Rk(){return(Rk=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",pk.create(t,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ok(e){return Nk.apply(this,arguments)}function Nk(){return(Nk=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",dk.create(t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Dk="2.7.0";function Pk(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&r.assert("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors in the CPU backend."}))}))}var Fk=g.nonMaxSuppressionV3Impl,Mk=g.split,Lk=g.tile,zk=g.topkImpl,Bk=g.whereImpl,jk=function(e){_inherits(i,e);var t,n,a=_createSuper(i);function i(){var e;return _classCallCheck2(this,i),(e=a.call(this)).blockSize=48,e.firstUse=!0,e.data=new U(_assertThisInitialized(e),aa()),e}return _createClass2(i,[{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,ze().get("IS_NODE")&&v.warn("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var a;if("string"===t&&null!=n&&n.length>0&&r.isString(n[0])){var i=n.map((function(e){return r.encodeString(e)}));a=this.write(i,e,t)}else a=this.write(n,e,t);return{dataId:a,shape:e,dtype:t}}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r){this.data.set(e,{values:t,dtype:r,refCount:1})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;if("complex64"===n){var a=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return v.mergeRealAndImagArrays(a,i)}return this.data.get(e).values}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return r.decodeString(e)}))}catch(a){throw new Error("Failed to decode encoded string bytes into utf-8")}return qn(e.shape,e.dtype,n)}},{key:"makeOutput",value:function(e,t,n){var r=this.write(e,t,n);return aa().makeTensorFromDataId(r,t,n,this)}},{key:"disposeData",value:function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensorInfos;null!=t&&(this.disposeData(t.real.dataId),this.disposeData(t.imag.dataId)),this.data.delete(e)}}},{key:"disposeIntermediateTensorInfo",value:function(e){var t=e.dataId;if(this.data.has(t)){var n=this.data.get(t);n.refCount--,n.refCount<1&&this.disposeData(t)}}},{key:"time",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.now(),e.abrupt("return",(t(),{kernelMs:r.now()-n}));case 2:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"stridedSlice",value:function(e,t,n,r){Pk(e,"stridedSlice");var a=h.computeOutShape(t,n,r);if(a.some((function(e){return 0===e})))return Xt([],a);for(var i=qn(a,e.dtype),o=this.bufferSync(e),s=0;s<i.size;s++){for(var u=i.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+t[l];i.set.apply(i,[o.get.apply(o,c)].concat(_toConsumableArray(u)))}return i.toTensor()}},{key:"diag",value:function(e){for(var t=this.readSync(e.dataId),n=qn([e.size,e.size],e.dtype),r=n.values,a=0;a<t.length;a++)r[a*e.size+a]=t[a];return n.toTensor()}},{key:"unstack",value:function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;for(var u=new Array(n),c=0;c<u.length;c++)o[t]=c,u[c]=Mi(e,o,s).reshape(r);return u}},{key:"reverse",value:function(e,t){Pk(e,"reverse");for(var n=qn(e.shape,e.dtype),r=this.bufferSync(e),a=function(a){var i=n.indexToLoc(a),o=i.slice();t.forEach((function(t){return o[t]=e.shape[t]-1-o[t]})),n.set.apply(n,[r.get.apply(r,_toConsumableArray(o))].concat(_toConsumableArray(i)))},i=0;i<n.size;i++)a(i);return n.toTensor()}},{key:"neg",value:function(e){return Pk(e,"neg"),xa(Pa(-1),e)}},{key:"addN",value:function(e){var t=this;Pk(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=qn(e[0].shape,e[0].dtype),a=r.values,i=0;i<e.length;i++)for(var o=n[i],s=0;s<a.length;s++)a[s]+=o[s];return r.toTensor()}},{key:"softmax",value:function(e,t){var n=r.parseAxisParam([t],e.shape),a=Ko(e,n),i=v.expandShapeToKeepDim(a.shape,n),o=ja(e,a.reshape(i)),s=_o(o),u=this.sum(s,n).reshape(i);return wa(s,u)}},{key:"pow",value:function(e,t){return Pk([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))}},{key:"floorDiv",value:function(e,t){return Pk([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))}},{key:"sum",value:function(e,t){Pk(e,"sum"),v.assertAxesAreInnerMostDims("sum",t,e.rank);for(var n=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=as(a,At(e.dtype,"int32")),s=r.sizeFromShape(i),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var h=l*s,f=0,d=0;d<s;++d)f+=c[h+d];u[l]=f}return o}},{key:"prod",value:function(e,t){Pk(e,"sum");for(var n=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=as(a,At(e.dtype,"int32")),s=r.sizeFromShape(i),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var h=l*s,f=1,d=0;d<s;++d)f*=c[h+d];u[l]=f}return o}},{key:"unsortedSegmentSum",value:function(e,t,n){Pk(e,"unsortedSegmentSum");for(var r=[],a=e.rank-t.rank,i=0;i<a;++i)t=t.expandDims(i+1);for(var o=0;o<n;++o){var s=Pa(o,"int32"),u=fo(s,t).asType("float32").mul(e).sum(0);r.push(u)}return fu(r)}},{key:"argMin",value:function(e,t){Pk(e,"argMin");var n=[t];v.assertAxesAreInnerMostDims("argMin",n,e.rank);for(var a=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,n),2),i=a[0],o=a[1],s=as(i,"int32"),u=r.sizeFromShape(o),c=this.readSync(s.dataId),l=this.readSync(e.dataId),h=0;h<c.length;++h){for(var f=h*u,d=l[f],p=0,m=0;m<u;++m){var g=l[f+m];g<d&&(d=g,p=m)}c[h]=p}return s}},{key:"argMax",value:function(e,t){Pk(e,"argMax");var n=[t];v.assertAxesAreInnerMostDims("argMax",n,e.rank);for(var a=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,n),2),i=a[0],o=a[1],s=as(i,"int32"),u=r.sizeFromShape(o),c=this.readSync(s.dataId),l=this.readSync(e.dataId),h=0;h<c.length;++h){for(var f=h*u,d=l[f],p=0,m=0;m<u;++m){var g=l[f+m];g>d&&(d=g,p=m)}c[h]=p}return s}},{key:"cumsum",value:function(e,t,n,r){if(Pk(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(e.rank-1," but got axis=")+t);for(var a=At(e.dtype,"int32"),i=as(e.shape,a),o=this.readSync(i.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],c=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=u)for(var h=0;h<u;h++){var f=c(l,h);if(0===h)o[f]=n?0:s[f];else{var d=c(l,h-1);o[f]=n?s[d]+o[d]:s[f]+o[d]}}return i}},{key:"equal",value:function(e,t){return Pk([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))}},{key:"notEqual",value:function(e,t){return Pk([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))}},{key:"less",value:function(e,t){return Pk([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))}},{key:"lessEqual",value:function(e,t){return Pk([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))}},{key:"greater",value:function(e,t){return Pk([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))}},{key:"greaterEqual",value:function(e,t){return Pk([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))}},{key:"logicalAnd",value:function(e,t){return Pk([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))}},{key:"logicalOr",value:function(e,t){return Pk([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))}},{key:"select",value:function(e,t,n){Pk([e,t,n],"select");for(var a=this.readSync(e.dataId),i=this.readSync(t.dataId),o=this.readSync(n.dataId),s=as(t.shape,At(t.dtype,n.dtype)),u=this.readSync(s.dataId),c=0,l=0===e.rank||e.rank>1||1===t.rank?1:r.sizeFromShape(t.shape.slice(1)),h=0;h<a.length;h++)for(var f=0;f<l;f++)u[c++]=1===a[h]?i[h]:o[h];return s}},{key:"where",value:function(e){Pk([e],"where");var t=this.readSync(e.dataId);return Bk(e.shape,t)}},{key:"topk",value:function(e,t,n){Pk(e,"topk");var r=this.readSync(e.dataId);return zk(r,e.shape,e.dtype,t,n)}},{key:"min",value:function(e,t){Pk(e,"min"),v.assertAxesAreInnerMostDims("min",t,e.rank);for(var n=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=as(a,e.dtype),s=r.sizeFromShape(i),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var h=l*s,f=c[h],d=0;d<s;++d){var p=c[h+d];p<f&&(f=p)}u[l]=f}return o}},{key:"minimum",value:function(e,t){return Pk([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))}},{key:"mod",value:function(e,t){return Pk([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))}},{key:"maximum",value:function(e,t){return Pk([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))}},{key:"all",value:function(e,t){Pk(e,"all"),v.assertAxesAreInnerMostDims("all",t,e.rank);for(var n=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=as(a,e.dtype),s=r.sizeFromShape(i),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var h=l*s,f=c[h],d=0;d<s;++d){var p=c[h+d];f=f&&p}u[l]=f}return o}},{key:"any",value:function(e,t){Pk(e,"any"),v.assertAxesAreInnerMostDims("any",t,e.rank);for(var n=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=as(a,e.dtype),s=r.sizeFromShape(i),u=this.readSync(o.dataId),c=this.readSync(e.dataId),l=0;l<u.length;++l){for(var h=l*s,f=c[h],d=0;d<s;++d){var p=c[h+d];f=f||p}u[l]=f}return o}},{key:"squaredDifference",value:function(e,t){return Pk([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))}},{key:"eluDer",value:function(e,t){Pk([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),a=this.readSync(e.dataId),i=0;i<r.length;++i){var o=r[i];n[i]=o>=1?a[i]:a[i]*(o+1)}return this.makeOutput(n,t.shape,"float32")}},{key:"atan2",value:function(e,t){return Pk([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))}},{key:"tile",value:function(e,t){return Pk(e,"tile"),Lk(this.bufferSync(e),t)}},{key:"gather",value:function(e,t,n){Pk([e,t],"gather");var r=e.shape.slice(),a=this.readSync(t.dataId);r[n]=a.length;for(var i=qn(r,e.dtype),o=this.bufferSync(e),s=0;s<i.size;++s){var u=i.indexToLoc(s),c=u.slice();c[n]=a[u[n]];var l=o.locToIndex(c);i.values[s]=o.values[l]}return i.toTensor()}},{key:"batchToSpaceND",value:function(e,t,n){Pk([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),a=v.getReshaped(e.shape,t,r),i=v.getPermuted(a.length,t.length),o=v.getReshapedPermuted(e.shape,t,r),s=v.getSliceBeginCoords(n,t.length),u=v.getSliceSize(o,n,t.length);return mr(e.reshape(a),i).reshape(o).slice(s,u)}},{key:"pool3d",value:function(e,t,n){Pk(e,"pool3d");for(var r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(e.dataId),g=qn(t.outShape,e.dtype),y=g.values,_=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],b=t.outShape[2]*t.outShape[3]*t.outShape[4],k=t.outShape[3]*t.outShape[4],w=t.outShape[4],x=0;x<t.batchSize;++x)for(var C=x*_,S=x*e.strides[0],T=0;T<t.inChannels;++T)for(var A=0;A<t.outDepth;++A){for(var E=A*r-f,I=E;I<0;)I+=o;for(var R=Math.min(t.inDepth,c+E),O=C+A*b,N=0;N<t.outHeight;++N){for(var D=N*a-d,P=D;P<0;)P+=s;for(var F=Math.min(t.inHeight,l+D),M=O+N*k,L=0;L<t.outWidth;++L){for(var z=L*i-p,B=z;B<0;)B+=u;for(var j=Math.min(t.inWidth,h+z),V=M+L*w,q=m,U=0,W=0,G=I;G<R;G+=o){for(var H=S+G*e.strides[1],K=P;K<F;K+=s){for(var X=H+K*e.strides[2],Q=B;Q<j;Q+=u){var Y=v[X+Q*e.strides[3]+T];if("max"===n&&Y>q?q=Y:"avg"===n&&(U+=Y,W++),isNaN(q))break}if(isNaN(q))break}if(isNaN(q))break}y[V+T]="avg"===n?U/W:q}}}return g.toTensor()}},{key:"avgPool3d",value:function(e,t){return Pk(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()}},{key:"avgPool3dBackprop",value:function(e,t,n){Pk([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,a=n.strideHeight,i=n.strideWidth,o=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,h=n.dilationWidth,f=n.effectiveFilterDepth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=f-1-n.padInfo.front,v=p-1-n.padInfo.left,g=d-1-n.padInfo.top,y=qn(t.shape,"float32"),_=1/(o*s*u),b=this.bufferSync(e),k=0;k<n.batchSize;++k)for(var w=0;w<n.inChannels;++w)for(var x=0;x<n.inDepth;++x)for(var C=0;C<n.inHeight;++C)for(var S=0;S<n.inWidth;++S){for(var T=x-m,A=C-g,E=S-v,I=0,R=0;R<f;R+=c){var O=(T+R)/r;if(!(O<0||O>=n.outDepth||Math.floor(O)!==O))for(var N=0;N<d;N+=l){var D=(A+N)/a;if(!(D<0||D>=n.outHeight||Math.floor(D)!==D))for(var P=0;P<p;P+=h){var F=(E+P)/i;F<0||F>=n.outWidth||Math.floor(F)!==F||(I+=b.get(k,O,D,F,w))}}}y.set(I*_,k,x,C,S,w)}return y.toTensor()}},{key:"maxPool3d",value:function(e,t){return Pk(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()}},{key:"maxPool3dPositions",value:function(e,t){for(var n=qn(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left,m=this.bufferSync(e),v=0;v<t.batchSize;++v)for(var g=0;g<t.inChannels;++g)for(var y=0;y<t.outDepth;++y){for(var _=y*r-f,b=_;b<0;)b+=o;for(var k=Math.min(t.inDepth,c+_),w=0;w<t.outHeight;++w){for(var x=w*a-d,C=x;C<0;)C+=s;for(var S=Math.min(t.inHeight,l+x),T=0;T<t.outWidth;++T){for(var A=T*i-p,E=A;E<0;)E+=u;for(var I=Math.min(t.inWidth,h+A),R=Number.NEGATIVE_INFINITY,O=-1,N=b;N<k;N+=o)for(var D=N-_,P=C;P<S;P+=s)for(var F=P-x,M=E;M<I;M+=u){var L=M-A,z=m.get(v,N,P,M,g);z>=R&&(R=z,O=D*l*h+F*l+L)}n.set(O,v,y,w,T,g)}}}return n.toTensor()}},{key:"maxPool3dBackprop",value:function(e,t,n,r){Pk([t,n],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(t,r),i=r.strideDepth,o=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=h-1-r.padInfo.front,m=d-1-r.padInfo.left,v=f-1-r.padInfo.top,g=qn(t.shape,"float32"),y=this.bufferSync(a),_=this.bufferSync(e),b=0;b<r.batchSize;++b)for(var k=0;k<r.inChannels;++k)for(var w=0;w<r.inDepth;++w)for(var x=0;x<r.inHeight;++x)for(var C=0;C<r.inWidth;++C){for(var S=w-p,T=x-v,A=C-m,E=0,I=0;I<h;I+=u){var R=(S+I)/i;if(!(R<0||R>=r.outDepth||Math.floor(R)!==R))for(var O=0;O<f;O+=c){var N=(T+O)/o;if(!(N<0||N>=r.outHeight||Math.floor(N)!==N))for(var D=0;D<d;D+=l){var P=(A+D)/s;if(!(P<0||P>=r.outWidth||Math.floor(P)!==P)){var F=h*f*d-1-y.get(b,R,N,P,k)===I*f*d+O*d+D?1:0;0!==F&&(E+=_.get(b,R,N,P,k)*F)}}}}g.set(E,b,w,x,C,k)}return g.toTensor()}},{key:"resizeBilinear",value:function(e,t,n,a){Pk(e,"resizeBilinear");for(var i=_slicedToArray2(e.shape,4),o=i[0],s=i[1],u=i[2],c=i[3],l=this.readSync(e.dataId),h=new Float32Array(r.sizeFromShape([o,t,n,c])),f=[a&&t>1?s-1:s,a&&n>1?u-1:u],d=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=0,m=f[0]/d[0],v=f[1]/d[1],g=0;g<o;g++)for(var y=0;y<t;y++)for(var _=m*y,b=Math.floor(_),k=_-b,w=Math.min(s-1,Math.ceil(_)),x=g*e.strides[0]+b*e.strides[1],C=g*e.strides[0]+w*e.strides[1],S=0;S<n;S++)for(var T=v*S,A=Math.floor(T),E=T-A,I=Math.min(u-1,Math.ceil(T)),R=x+A*e.strides[2],O=C+A*e.strides[2],N=x+I*e.strides[2],D=C+I*e.strides[2],P=0;P<c;P++){var F=l[R+P],M=l[O+P],L=F+(l[N+P]-F)*E;h[p++]=L+(M+(l[D+P]-M)*E-L)*k}return Xt(h,[o,t,n,c])}},{key:"resizeBilinearBackprop",value:function(e,t,n){Pk([e,t],"resizeBilinearBackprop");for(var r=_slicedToArray2(t.shape,4),a=r[0],i=r[1],o=r[2],s=r[3],u=_slicedToArray2(e.shape,3),c=u[1],l=u[2],h=new Float32Array(a*i*o*s),f=[n&&c>1?i-1:i,n&&l>1?o-1:o],d=[n&&c>1?c-1:c,n&&l>1?l-1:l],p=f[0]/d[0],m=f[1]/d[1],v=this.readSync(e.dataId),g=0,y=0;y<a;y++)for(var _=y*t.strides[0],b=0;b<c;b++)for(var k=b*p,w=Math.floor(k),x=Math.min(Math.ceil(k),i-1),C=_+w*t.strides[1],S=_+x*t.strides[1],T=k-w,A=1-T,E=0;E<l;E++)for(var I=E*m,R=Math.floor(I),O=Math.min(Math.ceil(I),o-1),N=I-R,D=1-N,P=C+R*t.strides[2],F=C+O*t.strides[2],M=S+R*t.strides[2],L=S+O*t.strides[2],z=A*D,B=A*N,j=T*D,V=T*N,q=0;q<s;q++){var U=v[g++];h[P+q]+=U*z,h[F+q]+=U*B,h[M+q]+=U*j,h[L+q]+=U*V}return gu(h,[a,o,i,s],t.dtype)}},{key:"resizeNearestNeighbor",value:function(e,t,n,r){Pk(e,"resizeNearestNeighbor");for(var a=_slicedToArray2(e.shape,4),i=a[0],o=a[1],s=a[2],u=a[3],c=this.readSync(e.dataId),l=new Float32Array(i*t*n*u),h=[r&&t>1?o-1:o,r&&n>1?s-1:s],f=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=h[0]/f[0],p=h[1]/f[1],m=0,v=0;v<i;v++)for(var g=v*e.strides[0],y=0;y<t;y++)for(var _=d*y,b=g+Math.min(o-1,r?Math.round(_):Math.floor(_))*e.strides[1],k=0;k<n;k++)for(var w=p*k,x=b+Math.min(s-1,r?Math.round(w):Math.floor(w))*e.strides[2],C=0;C<u;C++)l[m++]=c[x+C];return Xt(l,[i,t,n,u],e.dtype)}},{key:"resizeNearestNeighborBackprop",value:function(e,t,n){Pk([e,t],"resizeNearestNeighborBackprop");for(var r=_slicedToArray2(t.shape,4),a=r[0],i=r[1],o=r[2],s=r[3],u=_slicedToArray2(e.shape,3),c=u[1],l=u[2],h=new Float32Array(a*i*o*s),f=this.readSync(e.dataId),d=[n&&c>1?i-1:i,n&&l>1?o-1:o],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],m=d[0]/p[0],v=d[1]/p[1],g=1/m,y=1/v,_=2*Math.ceil(g)+2,b=2*Math.ceil(y)+2,k=0;k<a;k++)for(var w=k*t.strides[0],x=0;x<i;x++)for(var C=w+x*t.strides[1],S=Math.floor(x*g),T=Math.floor(S-_/2),A=0;A<o;A++)for(var E=C+A*t.strides[2],I=Math.floor(A*y),R=Math.floor(I-b/2),O=0;O<s;O++){for(var N=0,D=0;D<_;D++){var P=D+T;if(!(P<0||P>=c)){var F=w+P*e.strides[1],M=P*m;if(x===Math.min(i-1,n?Math.round(M):Math.floor(M)))for(var L=0;L<b;L++){var z=L+R;if(!(z<0||z>=l)){var B=F+z*e.strides[2],j=z*v;A===Math.min(o-1,n?Math.round(j):Math.floor(j))&&(N+=f[B+O])}}}}h[E+O]=N}return gu(h,t.shape,t.dtype)}},{key:"localResponseNormalization4D",value:function(e,t,n,r,a){Pk(e,"localResponseNormalization4D");var i=e.shape[3],o=i-1,s=this.readSync(e.dataId),u=e.size,c=new Float32Array(u);function l(e){for(var n=e%i,r=e-n+Math.max(0,n-t),a=e-n+Math.min(n+t,o),u=0;r<=a;r++){var c=s[r];u+=c*c}return u}for(var h=0;h<u;h++){var f=l(h),d=s[h]*Math.pow(n+r*f,-a);c[h]=d}return gu(c,e.shape)}},{key:"LRNGrad",value:function(e,t,n,r,a,i,o){Pk(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=this.readSync(n.dataId),h=new Float32Array(e.size),f=e.size,d=0;d<f;d++){for(var p=d%s,m=d-p+Math.max(0,p-r),v=d-p+Math.min(s,p+r+1),g=0,y=m;y<v;y++)g+=Math.pow(c[y],2);g=i*g+a;for(var _=m;_<v;_++){var b=-2*i*o*c[_]*l[d]/g;d===_&&(b+=Math.pow(g,-o)),b*=u[d],h[_]+=b}}return gu(h,e.shape)}},{key:"multinomial",value:function(e,t,n,r){Pk(e,"multinomial");for(var a=t?e:ru(e),i=a.shape[0],o=a.shape[1],s=as([i,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(a.dataId),l=0;l<i;++l){var h=l*o,f=new Float32Array(o-1);f[0]=c[h];for(var d=1;d<f.length;++d)f[d]=f[d-1]+c[h+d];for(var p=Es.alea(r.toString()),m=l*n,v=0;v<n;++v){var g=p();u[m+v]=f.length;for(var y=0;y<f.length;y++)if(g<f[y]){u[m+v]=y;break}}}return s}},{key:"oneHot",value:function(e,t,n,r){Pk(e,"oneHot");var a=new Float32Array(e.size*t);a.fill(r);for(var i=this.readSync(e.dataId),o=0;o<e.size;++o)i[o]>=0&&i[o]<t&&(a[o*t+i[o]]=n);return vu(a,[e.size,t],"int32")}},{key:"nonMaxSuppression",value:function(e,t,n,r,a){Pk(e,"nonMaxSuppression");var i=this.readSync(e.dataId),o=this.readSync(t.dataId);return Fk(i,o,n,r,a)}},{key:"depthToSpace",value:function(e,t,n){r.assert("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),r.assert(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var a=e.shape[0],i=e.shape[1],o=e.shape[2],s=e.shape[3],u=i*t,c=o*t,l=s/(t*t),h=this.readSync(e.dataId),f=new Float32Array(a*u*c*l),d=0,p=0;p<a;++p)for(var m=0;m<u;++m)for(var v=Math.floor(m/t),g=m%t,y=0;y<c;++y)for(var _=Math.floor(y/t),b=(g*t+y%t)*l,k=0;k<l;++k)f[d++]=h[k+b+s*(_+o*(v+i*p))];return gu(f,[a,u,c,l])}},{key:"broadcastedBinaryOp",value:function(e,t,n,r){var a=v.assertAndGetBroadcastShape(e.shape,t.shape),i=qn(a,n),o=this.readSync(e.dataId),s=this.readSync(t.dataId),u=v.getBroadcastDims(e.shape,a),c=v.getBroadcastDims(t.shape,a),l=i.values;if(u.length+c.length===0)for(var h=0;h<l.length;++h)l[h]=r(o[h%o.length],s[h%s.length]);else for(var f=this.bufferSync(e),d=this.bufferSync(t),p=function(n){var a=i.indexToLoc(n),h=a.slice(-e.rank);u.forEach((function(e){return h[e]=0}));var p=f.locToIndex(h),m=a.slice(-t.rank);c.forEach((function(e){return m[e]=0}));var v=d.locToIndex(m);l[n]=r(o[p],s[v])},m=0;m<l.length;++m)p(m);return i.toTensor()}},{key:"split",value:function(e,t,n){return Mk(e,t,n)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return _get(_getPrototypeOf(i.prototype),"epsilon",this).call(this)}},{key:"cropAndResize",value:function(e,t,n,r,a,i){for(var o=_slicedToArray2(e.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],h=t.shape[0],f=_slicedToArray2(r,2),d=f[0],p=f[1],m=qn([h,d,p,l],"float32"),v=this.readSync(t.dataId),g=this.readSync(n.dataId),y=this.readSync(e.dataId),_=e.strides,b=m.strides,k=0;k<h;k++){var w=4*k,x=v[w],C=v[w+1],S=v[w+2],T=v[w+3],A=g[k];if(!(A>=s))for(var E=d>1?(S-x)*(u-1)/(d-1):0,I=p>1?(T-C)*(c-1)/(p-1):0,R=0;R<d;R++){var O=d>1?x*(u-1)+R*E:.5*(x+S)*(u-1);if(O<0||O>u-1)for(var N=0;N<p;N++)for(var D=0;D<l;D++)m.values[D+N*b[2]+R*b[1]+k*b[0]]=i;else if("bilinear"===a)for(var P=Math.floor(O),F=Math.ceil(O),M=O-P,L=0;L<p;L++){var z=p>1?C*(c-1)+L*I:.5*(C+T)*(c-1);if(z<0||z>c-1)for(var B=0;B<l;B++)m.values[B+L*b[2]+R*b[1]+k*b[0]]=i;else for(var j=Math.floor(z),V=Math.ceil(z),q=z-j,U=0;U<l;U++){var W=U+j*_[2]+P*_[1]+A*_[0],G=y[W],H=y[W=U+V*_[2]+P*_[1]+A*_[0]],K=y[W=U+j*_[2]+F*_[1]+A*_[0]],X=y[W=U+V*_[2]+F*_[1]+A*_[0]],Q=G+(H-G)*q;W=U+L*b[2]+R*b[1]+k*b[0],m.values[W]=Q+(K+(X-K)*q-Q)*M}}else for(var Y=0;Y<p;++Y){var Z=p>1?C*(c-1)+Y*I:.5*(C+T)*(c-1);if(Z<0||Z>c-1)for(var J=0;J<l;J++)m.values[J+Y*b[2]+R*b[1]+k*b[0]]=i;else for(var $=Math.round(Z),ee=Math.round(O),te=0;te<l;te++)m.values[te+Y*b[2]+R*b[1]+k*b[0]]=y[te+$*_[2]+ee*_[1]+A*_[0]]}}}return m.toTensor()}},{key:"sparseToDense",value:function(e,t,n,r){var a=v.calculateShapes(t,e,n),i=a.sliceRank,o=a.numUpdates,s=a.sliceSize,u=a.strides,c=a.outputSize;return this.scatter(e,t,n,c,s,o,i,u,r,!1)}},{key:"gatherND",value:function(e,t){var n=t.shape,r=n[n.length-1],a=_slicedToArray2(v.prepareAndValidate(e,t),4),i=a[0],o=a[1],s=a[2],u=a[3];if(0===o)return Xt([],i,e.dtype);for(var c=new vt([o,s],e.dtype),l=this.readSync(t.dataId),h=this.readSync(e.dataId),f=0;f<o;f++){for(var d=[],p=0,m=0;m<r;m++){var g=l[f*r+m];p+=g*u[m],d.push(g)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: ".concat(d," does not index into ").concat(e.shape));for(var y=0;y<s;y++)c.values[f*s+y]=h[p*s+y]}return c.toTensor().reshape(i)}},{key:"scatterND",value:function(e,t,n){var r=v.calculateShapes(t,e,n),a=r.sliceRank,i=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=Pa(0);return this.scatter(e,t,n,u,o,i,a,s,c,!0)}},{key:"onesLike",value:function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return La(e.shape,1,e.dtype)}},{key:"zerosLike",value:function(e){var t=r.getArrayFromDType(e.dtype,r.sizeFromShape(e.shape));return this.makeOutput(t,e.shape,e.dtype)}},{key:"linspace",value:function(e,t,n){return v.linspaceImpl(e,t,n)}},{key:"scatter",value:function(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],h=this.readSync(e.dataId),f=this.readSync(t.dataId);if(0===r)return Xt([],n,t.dtype);var d=new vt(l,t.dtype);d.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<i;p++){for(var m=[],v=0,g=0;g<o;g++){var y=h[p*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var _=0;_<a;_++)c?d.values[v*a+_]+=f[p*a+_]:d.values[v*a+_]=0===t.rank?f[0]:f[p*a+_]}return d.toTensor().reshape(n)}}]),i}(W);function Vk(e,t,n){return function(a){var i=a.inputs,o=a.attrs,s=a.backend,u=i.x;if(Pk(u,e),"string"===u.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var c=s,l=c.data.get(u.dataId).values,h=r.sizeFromShape(u.shape),f=n||u.dtype,d=r.getArrayFromDType(f,h),p=0;p<h;++p)d[p]=t(l[p],o);return c.makeTensorInfo(u.shape,f,d)}}function qk(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(Pk(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,h=t(c,l,i);return u.makeTensorInfo(s.shape,l,h)}}ga("cpu",(function(){return new jk}),1);var Uk=Vk("Elu",(function(e){return e>=0?e:Math.exp(e)-1})),Wk={kernelName:"Elu",backendName:"cpu",kernelFunc:Uk};function Gk(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var Hk={kernelName:"Identity",backendName:"cpu",kernelFunc:Gk};function Kk(e){return function(t,n,a,i,o){var s=v.assertAndGetBroadcastShape(t,n),u=s.length,c=r.computeStrides(s),l=r.sizeFromShape(s),h=r.getTypedArrayFromDType(o,l),f=t.length,d=n.length,p=r.computeStrides(t),m=r.computeStrides(n),g=v.getBroadcastDims(t,s),y=v.getBroadcastDims(n,s);if(g.length+y.length===0)for(var _=0;_<h.length;++_)h[_]=e(a[_%a.length],i[_%i.length]);else for(var b=function(t){var n=r.indexToLoc(t,u,c),o=n.slice(-f);g.forEach((function(e){return o[e]=0}));var s=r.locToIndex(o,f,p),l=n.slice(-d);y.forEach((function(e){return l[e]=0}));var v=r.locToIndex(l,d,m);h[t]=e(a[s],i[v])},k=0;k<h.length;++k)b(k);return[h,s]}}var Xk=Kk((function(e,t){return e<0?t*e:e}));function Qk(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;Pk([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=_slicedToArray2(Xk(r.shape,a.shape,i,o,r.dtype),2),u=s[0],c=s[1];return n.makeTensorInfo(c,r.dtype,u)}var Yk={kernelName:"Prelu",backendName:"cpu",kernelFunc:Qk},Zk=Vk("Relu",(function(e){return Math.max(0,e)})),Jk={kernelName:"Relu",backendName:"cpu",kernelFunc:Zk},$k=Vk("Relu6",(function(e){return Math.min(Math.max(0,e),6)})),ew={kernelName:"Relu6",backendName:"cpu",kernelFunc:$k};function tw(e,t,n,r){if("linear"===n)return Gk({inputs:{x:t},backend:e});if("relu"===n)return Zk({inputs:{x:t},backend:e});if("elu"===n)return Uk({inputs:{x:t},backend:e});if("relu6"===n)return $k({inputs:{x:t},backend:e});if("prelu"===n)return Qk({inputs:{x:t,alpha:r},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function nw(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var rw={kernelName:"Complex",backendName:"cpu",kernelFunc:nw};function aw(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var iw={kernelName:"Real",backendName:"cpu",kernelFunc:aw};function ow(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return Gk({inputs:{x:i},backend:n});var s=as(i.shape),u=ow({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),c=nw({inputs:{real:u,imag:s},backend:n});return s.dispose(),n.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var l=aw({inputs:{input:i},backend:n}),h=ow({inputs:{x:l},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(l),h}if(!r.hasEncodingLoss(i.dtype,o)){var f=Gk({inputs:{x:i},backend:n});return{dataId:f.dataId,shape:f.shape,dtype:o}}if("int32"===o){var d=n.data.get(i.dataId).values,p=Int32Array.from(d);return n.makeTensorInfo(i.shape,"int32",p)}if("bool"===o){var m=n.data.get(i.dataId).values,v=r.toTypedArray([0],i.dtype),g=_slicedToArray2(Kk((function(e,t){return e!==t?1:0}))(i.shape,[],m,v,"bool"),2),y=g[0],_=g[1];return n.makeTensorInfo(_,"bool",y)}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}var sw={kernelName:"Cast",backendName:"cpu",kernelFunc:ow};function uw(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;Pk([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,h=r||o.dtype,f=_slicedToArray2(t(o.shape,s.shape,c,l,h),2),d=f[0],p=f[1];return u.makeTensorInfo(p,h,d)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=ow({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),l=u.data.get(c.dataId),h=l.complexTensorInfos.imag,f=u.data.get(l.complexTensorInfos.real.dataId).values,d=u.data.get(h.dataId).values,p=ow({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),m=u.data.get(p.dataId),v=m.complexTensorInfos.imag,g=u.data.get(m.complexTensorInfos.real.dataId).values,y=u.data.get(v.dataId).values,_=_slicedToArray2(n(o.shape,s.shape,f,d,g,y),3),b=_[0],k=_[1],w=_[2],x=u.makeTensorInfo(w,"float32",b),C=u.makeTensorInfo(w,"float32",k),S=nw({inputs:{real:x,imag:C},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(p),u.disposeIntermediateTensorInfo(x),u.disposeIntermediateTensorInfo(C),S}var T=u.data.get(o.dataId).values,A=u.data.get(s.dataId).values,E=r||o.dtype,I=_slicedToArray2(t(o.shape,s.shape,T,A,E),2),R=I[0],O=I[1];return u.makeTensorInfo(O,E,R)}}function cw(e){return function(t,n,a,i,o,s){var u=v.assertAndGetBroadcastShape(t,n),c=r.sizeFromShape(u),l=u.length,h=r.computeStrides(u),f=r.getTypedArrayFromDType("float32",c),d=r.getTypedArrayFromDType("float32",c),p=v.getBroadcastDims(t,u),m=v.getBroadcastDims(n,u),g=v.mergeRealAndImagArrays(a,i),y=v.mergeRealAndImagArrays(o,s),_=t.length,b=r.computeStrides(t),k=n.length,w=r.computeStrides(n);if(p.length+m.length===0)for(var x=0;x<f.length;x++){var C=x%g.length,S=x%y.length,T=e(g[2*C],g[2*C+1],y[2*S],y[2*S+1]);f[x]=T.real,d[x]=T.imag}else for(var A=function(t){var n=r.indexToLoc(t,l,h),a=n.slice(-_);p.forEach((function(e){return a[e]=0}));var i=r.locToIndex(a,_,b),o=n.slice(-k);m.forEach((function(e){return o[e]=0}));var s=r.locToIndex(o,k,w),u=e(g[2*i],g[2*i+1],y[2*s],y[2*s+1]);f[t]=u.real,d[t]=u.imag},E=0;E<f.length;E++)A(E);return[f,d,u]}}var lw=Kk((function(e,t){return e+t})),hw=cw((function(e,t,n,r){return{real:e+n,imag:t+r}})),fw=uw("Add",lw,hw),dw={kernelName:"Add",backendName:"cpu",kernelFunc:fw};function pw(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.shape,s=r.sizeFromShape(i.shape),u=r.inferFromImplicitShape(o,s),c=r.sizeFromShape(u);r.assert(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old shape (").concat(i.shape,") has ").concat(s," elements. The new shape and old shape must have the same number of elements.")})),n.incRef(i.dataId);var l=n.data.get(i.dataId);if(null!=l.complexTensorInfos){var h=l.complexTensorInfos.imag;l.complexTensorInfos.real.shape=u,h.shape=u}return{dataId:i.dataId,shape:u,dtype:i.dtype}}var mw={kernelName:"Reshape",backendName:"cpu",kernelFunc:pw};function vw(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.a,o=t.b,s=a.transposeA,u=a.transposeB;Pk([i,o],"matMul");var c=i.shape.length,l=o.shape.length,h=s?i.shape[c-2]:i.shape[c-1],f=u?o.shape[l-1]:o.shape[l-2],d=s?i.shape[c-1]:i.shape[c-2],p=u?o.shape[l-2]:o.shape[l-1],m=i.shape.slice(0,-2),v=o.shape.slice(0,-2),g=r.sizeFromShape(m),y=r.sizeFromShape(v);r.assert(c>=2&&l>=2&&(g===y||1===g||1===y),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (".concat(m,") and (").concat(v,").")}));var _=(g>y?i.shape.slice(0,-2):o.shape.slice(0,-2)).concat([d,p]);r.assert(h===f,(function(){return"Error in matMul: inner shapes (".concat(h,") and (").concat(f,") of Tensors with shapes ").concat(i.shape," and ").concat(o.shape," and transposeA=").concat(s," and transposeB=").concat(u," must match.")}));for(var b=u?[y,p,f]:[y,f,p],k=pw({inputs:{x:i},backend:n,attrs:{shape:s?[g,h,d]:[g,d,h]}}),w=pw({inputs:{x:o},backend:n,attrs:{shape:b}}),x=s?k.shape[1]:k.shape[2],C=s?k.shape[2]:k.shape[1],S=u?w.shape[1]:w.shape[2],T=Math.max(g,y),A=n.data.get(k.dataId).values,E=n.data.get(w.dataId).values,I=r.computeStrides(k.shape),R=r.computeStrides(w.shape),O=_slicedToArray2(s?[I[0],1,I[1]]:[I[0],I[1],1],3),N=O[0],D=O[1],P=O[2],F=_slicedToArray2(u?[1,R[1],R[0]]:[R[1],1,R[0]],3),M=F[0],L=F[1],z=F[2],B=C*S,j=qn([T,C,S],k.dtype),V=j.values,q=n.blockSize,U=0;U<T;U++)for(var W=0;W<C;W+=q)for(var G=0;G<S;G+=q)for(var H=0;H<x;H+=q)for(var K=Math.min(W+q,C),X=Math.min(G+q,S),Q=Math.min(H+q,x),Y=W;Y<K;Y++)for(var Z=G;Z<X;Z++){for(var J=0,$=H;$<Q;$++){var ee=Math.min(U,g-1)*N,te=Math.min(U,y-1)*z;J+=A[ee+Y*D+$*P]*E[$*M+Z*L+te]}V[U*B+(Y*S+Z)]+=J}return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(_,j.dtype,j.values)}var gw={kernelName:"BatchMatMul",backendName:"cpu",kernelFunc:vw},yw={kernelName:"_FusedMatMul",backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,h=o.transposeA,f=o.transposeB,d=o.activation,p=[];t=vw({inputs:{a:s,b:u},attrs:{transposeA:h,transposeB:f},backend:i}),c&&(n=fw({inputs:{a:t,b:c},backend:i}),p.push(t),t=n),d&&(r=tw(i,t,d,l),p.push(t),t=r);for(var m=0,v=p;m<v.length;m++){var g=v[m];i.disposeIntermediateTensorInfo(g)}return t}};function _w(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var bw={kernelName:"Abs",backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,a=new Float32Array(r.sizeFromShape(t.shape));if("complex64"!==t.dtype)a=_w(n.data.get(t.dataId).values);else for(var i=n.data.get(t.dataId),o=i.complexTensorInfos.imag,s=n.data.get(i.complexTensorInfos.real.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++)a[c]=Math.hypot(s[c],u[c]);return n.makeOutput(a,t.shape,"float32")}},kw={kernelName:"Acos",backendName:"cpu",kernelFunc:Vk("Acos",(function(e){return Math.acos(e)}))},ww={kernelName:"Acosh",backendName:"cpu",kernelFunc:Vk("Acosh",(function(e){return Math.acosh(e)}))},xw={kernelName:"Asin",backendName:"cpu",kernelFunc:Vk("Asin",(function(e){return Math.asin(e)}))},Cw={kernelName:"Asinh",backendName:"cpu",kernelFunc:Vk("Asinh",(function(e){return Math.asinh(e)}))},Sw={kernelName:"Atan",backendName:"cpu",kernelFunc:Vk("Atan",(function(e){return Math.atan(e)}))},Tw={kernelName:"Atanh",backendName:"cpu",kernelFunc:Vk("Atanh",(function(e){return Math.atanh(e)}))};function Aw(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,h=a.effectiveFilterWidth,f=a.padInfo.top,d=a.padInfo.left,p="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=qn(a.outShape,n),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],_=a.outShape[3],b=0;b<a.batchSize;++b)for(var k=b*g,w=b*r[0],x=0;x<a.inChannels;++x)for(var C=0;C<a.outHeight;++C)for(var S=C*o-f,T=Math.max(0,S),A=Math.min(a.inHeight,l+S),E=k+C*y,I=0;I<a.outWidth;++I){for(var R=I*s-d,O=Math.max(0,R),N=Math.min(a.inWidth,h+R),D=p,P=0,F=0,M=T;M<A;M+=u){for(var L=w+M*r[1],z=O;z<N;z+=c){var B=e[L+z*r[2]+x];"max"===i&&B>D?D=B:"avg"===i&&(P+=B,F++)}if(isNaN(D))break}v[E+I*_+x]="avg"===i?P/F:D}return m}function Ew(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=qn(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,m=qn(t,n,e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var _=y*s-d,b=_;b<0;)b+=c;for(var k=Math.min(r.inHeight,h+_),w=0;w<r.outWidth;++w){for(var x=w*u-p,C=x;C<0;)C+=l;for(var S=Math.min(r.inWidth,f+x),T=Number.NEGATIVE_INFINITY,A=-1,E=b;E<k;E+=c)for(var I=E-_,R=C;R<S;R+=l){var O=R-x,N=m.get(v,E,R,g);N>T&&(T=N,A=a?i?((v*r.inHeight+E)*r.inWidth+R)*r.inChannels+g:(E*r.inWidth+R)*r.inChannels+g:I*f+O)}o.set(A,v,y,w,g)}}return o}var Iw={kernelName:"AvgPool",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x;Pk(i,"avgPool");var o=a.filterSize,s=a.strides,u=a.pad,c=a.dimRoundingMode;r.assert(v.eitherStridesOrDilationsAreOne(s,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var l,h=v.computePool2DInfo(i.shape,o,s,1,u,c);if(1===h.filterWidth&&1===h.filterHeight&&r.arraysEqual(h.inShape,h.outShape))l=Gk({inputs:{x:i},backend:n});else{var f=n.data.get(i.dataId).values,d=r.computeStrides(i.shape),p=Aw(f,0,i.dtype,d,h,"avg");l=n.makeTensorInfo(h.outShape,i.dtype,p.values)}return l}},Rw={kernelName:"AvgPoolBackprop",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Pk([a,i],"avgPoolBackprop");for(var s=r.filterSize,u=r.strides,c=r.pad,l=v.computePool2DInfo(o.shape,s,u,1,c),h=l.strideHeight,f=l.strideWidth,d=l.filterHeight,p=l.filterWidth,m=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterHeight,_=l.effectiveFilterWidth,b=_-1-l.padInfo.left,k=y-1-l.padInfo.top,w=qn(o.shape,"float32"),x=1/(d*p),C=n.data.get(a.dataId).values,S=qn(a.shape,"float32",C),T=0;T<l.batchSize;++T)for(var A=0;A<l.inChannels;++A)for(var E=0;E<l.inHeight;++E)for(var I=0;I<l.inWidth;++I){for(var R=E-k,O=I-b,N=0,D=0;D<y;D+=m){var P=(R+D)/h;if(!(P<0||P>=l.outHeight||Math.floor(P)!==P))for(var F=0;F<_;F+=g){var M=(O+F)/f;M<0||M>=l.outWidth||Math.floor(M)!==M||(N+=S.get(T,P,M,A))}}w.set(N*x,T,E,I,A)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}},Ow={kernelName:"FusedBatchNorm",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.scale,s=t.offset,u=t.mean,c=t.variance;r.assert(u.shape.length===c.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),r.assert(null==s||u.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),r.assert(null==o||u.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),Pk([i,u,c,o,s],"batchNorm");var l=a.varianceEpsilon;null==l&&(l=.001);for(var h=n.data.get(i.dataId).values,f=n.data.get(u.dataId).values,d=n.data.get(c.dataId).values,p=o?n.data.get(o.dataId).values:new Float32Array([1]),m=s?n.data.get(s.dataId).values:new Float32Array([0]),v=new Float32Array(h.length),g=m.length,y=p.length,_=d.length,b=f.length,k=0,w=0,x=0,C=0,S=0;S<h.length;++S)v[S]=m[k++]+(h[S]-f[w++])*p[x++]/Math.sqrt(d[C++]+l),k>=g&&(k=0),w>=b&&(w=0),x>=y&&(x=0),C>=_&&(C=0);return n.makeTensorInfo(i.shape,i.dtype,v)}};function Nw(e){return function(t,n,a){for(var i=r.getTypedArrayFromDType(n,t.length),o=0;o<t.length;++o)i[o]=e(t[o],a);return i}}var Dw=Nw((function(e){return Math.ceil(e)})),Pw={kernelName:"Ceil",backendName:"cpu",kernelFunc:qk("Ceil",Dw)},Fw={kernelName:"ClipByValue",backendName:"cpu",kernelFunc:Vk("ClipByValue",(function(e,t){return e>t.clipValueMax?t.clipValueMax:e<t.clipValueMin?t.clipValueMin:e}))};function Mw(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var Lw={kernelName:"Imag",backendName:"cpu",kernelFunc:Mw};function zw(e){var t=e.inputs,n=e.backend,a=e.attrs.axis,i=r.parseAxisParam(a,t[0].shape)[0],o=v.computeOutShape(t.map((function(e){return e.shape})),i);if(0===r.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);var s=t.filter((function(e){return r.sizeFromShape(e.shape)>0}));if(1===s.length)return s[0];var u=s.map((function(e){return e.shape}));if(v.assertParamsConsistent(u,i),"complex64"===s[0].dtype){var c=s.map((function(e){return aw({inputs:{input:e},backend:n})})),l=s.map((function(e){return Mw({inputs:{input:e},backend:n})})),h=zw({inputs:c,backend:n,attrs:{axis:i}}),f=zw({inputs:l,backend:n,attrs:{axis:i}}),d=nw({inputs:{real:h,imag:f},backend:n});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),d}var p=s.map((function(e){var t=r.sizeFromShape(e.shape.slice(i));return pw({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})}));o=v.computeOutShape(p.map((function(e){return e.shape})),1);var m=r.getTypedArrayFromDType(s[0].dtype,r.sizeFromShape(o));if(1===p[0].shape[0]){var g=0;p.forEach((function(e){var t=n.data.get(e.dataId).values,a=r.sizeFromShape(e.shape);m.set(t,g),g+=a}))}else{var y=0;p.forEach((function(e){for(var t=n.data.get(e.dataId).values,r=0,a=0;a<e.shape[0];++a)for(var i=a*o[1]+y,s=0;s<e.shape[1];++s)m[i+s]=t[r++];y+=e.shape[1]}))}var _=v.computeOutShape(s.map((function(e){return e.shape})),i),b=n.makeTensorInfo(_,t[0].dtype,m);return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),b}var Bw={kernelName:"Concat",backendName:"cpu",kernelFunc:zw};function jw(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,h=a.dimRoundingMode;Pk([i,o],"conv2d");for(var f=v.convertConv2DDataFormat(c),d=v.computeConv2DInfo(i.shape,o.shape,s,l,u,h,!1,f),p=d.filterHeight,m=d.filterWidth,g=d.dilationHeight,y=d.dilationWidth,_=d.padInfo.left,b=d.padInfo.top,k="channelsLast"===d.dataFormat,w=new vt(d.outShape,i.dtype),x=r.computeStrides(i.shape),C=r.computeStrides(o.shape),S=x[0],T=k?x[1]:x[2],A=k?x[2]:1,E=k?1:x[1],I=w.strides[0],R=k?w.strides[1]:w.strides[2],O=k?w.strides[2]:1,N=k?1:w.strides[1],D=n.data.get(i.dataId).values,P=n.data.get(o.dataId).values,F=w.values,M=0;M<d.batchSize;++M)for(var L=M*S,z=M*I,B=0;B<d.outHeight;++B)for(var j=z+B*R,V=B*d.strideHeight-b,q=0;q<p;++q){var U=V+q*g;if(!(U<0||U>=d.inHeight))for(var W=q*C[0],G=L+U*T,H=0;H<d.outWidth;++H)for(var K=j+H*O,X=H*d.strideWidth-_,Q=0;Q<m;++Q){var Y=X+Q*y;if(!(Y<0||Y>=d.inWidth))for(var Z=G+Y*A,J=W+Q*C[1],$=0;$<d.inChannels;++$){for(var ee=D[Z+$*E],te=0;te<d.outChannels;++te)F[K+te*N]+=ee*P[J+te];J+=d.outChannels}}}return n.makeTensorInfo(w.shape,w.dtype,F)}var Vw={kernelName:"Conv2D",backendName:"cpu",kernelFunc:jw},qw={kernelName:"Conv2DBackpropFilter",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;Pk([a,i],"conv2dBackpropFilter");for(var h=v.convertConv2DDataFormat(u),f=v.computeConv2DInfo(a.shape,l,o,1,s,c,!1,h),d=f.strideHeight,p=f.strideWidth,m=f.filterHeight,g=f.filterWidth,y="channelsLast"===f.dataFormat,_=new vt(f.filterShape,"float32"),b=f.padInfo.left,k=f.padInfo.top,w=n.data.get(a.dataId).values,x=n.data.get(i.dataId).values,C=new vt(a.shape,a.dtype,w),S=new vt(i.shape,i.dtype,x),T=0;T<m;++T)for(var A=Math.max(0,Math.ceil((k-T)/d)),E=Math.min(f.outHeight,(f.inHeight+k-T)/d),I=0;I<g;++I)for(var R=Math.max(0,Math.ceil((b-I)/p)),O=Math.min(f.outWidth,(f.inWidth+b-I)/p),N=0;N<f.inChannels;++N)for(var D=0;D<f.outChannels;++D){for(var P=0,F=0;F<f.batchSize;++F)for(var M=A;M<E;++M)for(var L=T+M*d-k,z=R;z<O;++z){var B=I+z*p-b;P+=y?C.get(F,L,B,N)*S.get(F,M,z,D):C.get(F,N,L,B)*S.get(F,D,M,z)}_.set(P,T,I,N,D)}return n.makeTensorInfo(_.shape,_.dtype,_.values)}},Uw={kernelName:"Conv2DBackpropInput",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.dy,o=t.filter,s=a.inputShape,u=a.strides,c=a.pad,l=a.dataFormat,h=a.dimRoundingMode;Pk([i,o],"conv2dBackpropInput");var f=r.computeStrides(o.shape),d=r.computeStrides(i.shape),p=v.convertConv2DDataFormat(l),m=v.computeConv2DInfo(s,o.shape,u,1,c,h,!1,p),g=new vt(m.inShape,"float32"),y=g.values,_=n.data.get(i.dataId).values,b=n.data.get(o.dataId).values,k=_slicedToArray2(f,3),w=k[0],x=k[1],C=k[2],S=m.batchSize,T=m.filterHeight,A=m.filterWidth,E=m.inChannels,I=m.inHeight,R=m.inWidth,O=m.outChannels,N=m.outHeight,D=m.outWidth,P=m.strideHeight,F=m.strideWidth;p=m.dataFormat;for(var M=T-1-m.padInfo.top,L=A-1-m.padInfo.left,z="channelsLast"===p,B=g.strides[0],j=z?g.strides[1]:g.strides[2],V=z?g.strides[2]:1,q=z?1:g.strides[1],U=d[0],W=z?d[1]:d[2],G=z?d[2]:1,H=z?1:d[1],K=0;K<S;++K)for(var X=0;X<E;++X)for(var Q=0;Q<I;++Q)for(var Y=Q-M,Z=Math.max(0,Math.ceil(Y/P)),J=Math.min(N,(T+Y)/P),$=0;$<R;++$){for(var ee=$-L,te=Math.max(0,Math.ceil(ee/F)),ne=Math.min(D,(A+ee)/F),re=0,ae=Z;ae<J;++ae)for(var ie=ae*P-Y,oe=te;oe<ne;++oe)for(var se=U*K+W*ae+G*oe,ue=w*(T-1-ie)+x*(A-1-(oe*F-ee))+C*X,ce=0;ce<O;++ce)re+=_[se+H*ce]*b[ue+ce];y[B*K+j*Q+V*$+q*X]=re}return n.makeTensorInfo(g.shape,g.dtype,g.values)}},Ww={kernelName:"Conv3D",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=a.strides,u=a.pad,c=a.dilations;Pk([i,o],"conv3d");for(var l=v.computeConv3DInfo(i.shape,o.shape,s,c,u),h=l.filterDepth,f=l.filterHeight,d=l.filterWidth,p=l.dilationDepth,m=l.dilationHeight,g=l.dilationWidth,y=l.padInfo,_=y.front,b=y.left,k=y.top,w=new vt(l.outShape,i.dtype),x=n.data.get(i.dataId).values,C=n.data.get(o.dataId).values,S=w.values,T=r.computeStrides(i.shape),A=r.computeStrides(o.shape),E=0;E<l.batchSize;++E)for(var I=E*T[0],R=E*w.strides[0],O=0;O<l.outDepth;++O)for(var N=R+O*w.strides[1],D=O*l.strideDepth-_,P=0;P<h;++P){var F=D+P*p;if(!(F<0||F>=l.inDepth))for(var M=P*A[0],L=I+F*T[1],z=0;z<l.outHeight;++z)for(var B=N+z*w.strides[2],j=z*l.strideHeight-k,V=0;V<f;++V){var q=j+V*m;if(!(q<0||q>=l.inHeight))for(var U=M+V*A[1],W=L+q*T[2],G=0;G<l.outWidth;++G)for(var H=B+G*l.outChannels,K=G*l.strideWidth-b,X=0;X<d;++X){var Q=K+X*g;if(!(Q<0||Q>=l.inWidth))for(var Y=W+Q*l.inChannels,Z=U+X*A[2],J=0;J<l.inChannels;++J){for(var $=x[Y+J],ee=0;ee<l.outChannels;++ee)S[H+ee]+=$*C[Z+ee];Z+=l.outChannels}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}},Gw={kernelName:"Conv3DBackpropFilterV2",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.dy,s=a.strides,u=a.pad,c=a.filterShape;Pk([i,o],"conv3dBackpropFilterV2");for(var l=r.computeStrides(i.shape),h=r.computeStrides(o.shape),f=v.computeConv3DInfo(i.shape,c,s,1,u),d=f.strideDepth,p=f.strideHeight,m=f.strideWidth,g=f.filterDepth,y=f.filterHeight,_=f.filterWidth,b=new vt(f.filterShape,"float32"),k=b.values,w=_slicedToArray2(b.strides,4),x=w[0],C=w[1],S=w[2],T=w[3],A=n.data.get(o.dataId).values,E=_slicedToArray2(h,4),I=E[0],R=E[1],O=E[2],N=E[3],D=n.data.get(i.dataId).values,P=_slicedToArray2(l,4),F=P[0],M=P[1],L=P[2],z=P[3],B=f.padInfo.front,j=f.padInfo.left,V=f.padInfo.top,q=0;q<g;++q)for(var U=Math.max(0,Math.ceil((B-q)/d)),W=Math.min(f.outDepth,(f.inDepth+B-q)/d),G=q*x,H=0;H<y;++H)for(var K=Math.max(0,Math.ceil((V-H)/p)),X=Math.min(f.outHeight,(f.inHeight+V-H)/p),Q=H*C+G,Y=0;Y<_;++Y)for(var Z=Math.max(0,Math.ceil((j-Y)/m)),J=Math.min(f.outWidth,(f.inWidth+j-Y)/m),$=Y*S+Q,ee=0;ee<f.inChannels;++ee)for(var te=ee*T+$,ne=0;ne<f.outChannels;++ne){for(var re=0,ae=0;ae<f.batchSize;++ae)for(var ie=ae*F,oe=ae*I,se=U;se<W;++se)for(var ue=(q+se*d-B)*M+ie,ce=se*R+oe,le=K;le<X;++le)for(var he=(H+le*p-V)*L+ue,fe=le*O+ce,de=Z;de<J;++de)re+=D[(Y+de*m-j)*z+he+ee]*A[de*N+fe+ne];k[te+ne]=re}return n.makeTensorInfo(b.shape,b.dtype,b.values)}},Hw={kernelName:"Conv3DBackpropInputV2",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.dy,o=t.filter,s=a.pad,u=a.strides,c=a.inputShape;Pk([i],"conv3dBackpropInputV2");for(var l=r.computeStrides(i.shape),h=r.computeStrides(o.shape),f=v.computeConv3DInfo(c,o.shape,u,1,s),d=new vt(f.inShape,"float32"),p=d.values,m=_slicedToArray2(d.strides,4),g=m[0],y=m[1],_=m[2],b=m[3],k=n.data.get(i.dataId).values,w=_slicedToArray2(l,4),x=w[0],C=w[1],S=w[2],T=w[3],A=n.data.get(o.dataId).values,E=_slicedToArray2(h,4),I=E[0],R=E[1],O=E[2],N=E[3],D=f.batchSize,P=f.filterDepth,F=f.filterHeight,M=f.filterWidth,L=f.inChannels,z=f.inDepth,B=f.inHeight,j=f.inWidth,V=f.outChannels,q=f.outDepth,U=f.outHeight,W=f.outWidth,G=f.strideDepth,H=f.strideHeight,K=f.strideWidth,X=P-1-f.padInfo.front,Q=F-1-f.padInfo.top,Y=M-1-f.padInfo.left,Z=0;Z<D;++Z)for(var J=0;J<L;++J)for(var $=0;$<z;++$)for(var ee=$-X,te=Math.max(0,Math.ceil(ee/G)),ne=Math.min(q,(P+ee)/G),re=0;re<B;++re)for(var ae=re-Q,ie=Math.max(0,Math.ceil(ae/H)),oe=Math.min(U,(F+ae)/H),se=0;se<j;++se){for(var ue=se-Y,ce=Math.max(0,Math.ceil(ue/K)),le=Math.min(W,(M+ue)/K),he=0,fe=te;fe<ne;++fe)for(var de=fe*G-ee,pe=ie;pe<oe;++pe)for(var me=pe*H-ae,ve=ce;ve<le;++ve)for(var ge=x*Z+C*fe+S*pe+T*ve,ye=I*(P-1-de)+R*(F-1-me)+O*(M-1-(ve*K-ue))+N*J,_e=0;_e<V;++_e)he+=k[ge+_e]*A[ye+_e];p[g*Z+y*$+_*re+b*se+J]=he}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},Kw=Vk(Ue,(function(e){return Math.cos(e)})),Xw={kernelName:Ue,backendName:"cpu",kernelFunc:Kw},Qw={kernelName:"Cosh",backendName:"cpu",kernelFunc:Vk("Cosh",(function(e){return Math.cosh(e)}))};function Yw(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=a.strides,u=a.pad,c=a.dilations,l=a.dimRoundingMode;Pk([i,o],"depthwiseConv2DNative");var h=r.computeStrides(i.shape),f=r.computeStrides(o.shape),d=c;null==d&&(d=[1,1]),r.assert(v.eitherStridesOrDilationsAreOne(s,d),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '").concat(d,"'")}));for(var p=v.computeConv2DInfo(i.shape,o.shape,s,d,u,l,!0),m=p.filterHeight,g=p.filterWidth,y=p.dilationHeight,_=p.dilationWidth,b=p.padInfo,k=b.left,w=b.top,x=p.outChannels/p.inChannels,C=new vt(p.outShape,i.dtype),S=n.data.get(i.dataId).values,T=n.data.get(o.dataId).values,A=C.values,E=0;E<p.batchSize;++E)for(var I=E*h[0],R=E*C.strides[0],O=0;O<p.outHeight;++O)for(var N=R+O*C.strides[1],D=O*p.strideHeight-k,P=0;P<m;++P){var F=D+P*y;if(!(F<0||F>=p.inHeight))for(var M=P*f[0],L=I+F*h[1],z=0;z<p.outWidth;++z)for(var B=N+z*C.strides[2],j=z*p.strideWidth-w,V=0;V<g;++V){var q=j+V*_;if(!(q<0||q>=p.inWidth))for(var U=L+q*p.inChannels,W=B,G=M+V*f[1],H=0;H<p.inChannels;++H){for(var K=S[U+H],X=0;X<x;++X)A[W+X]+=K*T[G+X];W+=x,G+=x}}}return n.makeTensorInfo(C.shape,C.dtype,C.values)}var Zw={kernelName:"DepthwiseConv2dNative",backendName:"cpu",kernelFunc:Yw},Jw={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;Pk([a,i],"depthwiseConv2dNativeBackpropFilter");for(var h=v.computeConv2DInfo(a.shape,l,o,s,u,c,!0),f=h.strideHeight,d=h.strideWidth,p=h.filterHeight,m=h.filterWidth,g=new vt(h.filterShape,"float32"),y=h.padInfo.left,_=h.padInfo.top,b=h.outChannels/h.inChannels,k=n.data.get(a.dataId).values,w=new vt(a.shape,a.dtype,k),x=n.data.get(i.dataId).values,C=new vt(i.shape,i.dtype,x),S=0;S<p;++S)for(var T=Math.max(0,Math.ceil((_-S)/f)),A=Math.min(h.outHeight,(h.inHeight+_-S)/f),E=0;E<m;++E)for(var I=Math.max(0,Math.ceil((y-E)/d)),R=Math.min(h.outWidth,(h.inWidth+y-E)/d),O=0;O<h.outChannels;++O){for(var N=Math.trunc(O/b),D=O%b,P=0,F=0;F<h.batchSize;++F)for(var M=T;M<A;++M)for(var L=S+M*f-_,z=I;z<R;++z)P+=w.get(F,L,E+z*d-y,N)*C.get(F,M,z,O);g.set(P,S,E,N,D)}return n.makeTensorInfo(g.shape,g.dtype,g.values)}},$w={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.dy,o=t.filter,s=a.strides,u=a.dilations,c=a.pad,l=a.dimRoundingMode,h=a.inputShape;Pk([i,o],"depthwiseConv2DNativeBackpropInput");for(var f=r.computeStrides(i.shape),d=r.computeStrides(o.shape),p=v.computeConv2DInfo(h,o.shape,s,u,c,l,!0),m=new vt(p.inShape,"float32"),g=m.values,y=_slicedToArray2(m.strides,3),_=y[0],b=y[1],k=y[2],w=n.data.get(i.dataId).values,x=_slicedToArray2(f,3),C=x[0],S=x[1],T=x[2],A=n.data.get(o.dataId).values,E=_slicedToArray2(d,3),I=E[0],R=E[1],O=E[2],N=p.batchSize,D=p.filterHeight,P=p.filterWidth,F=p.inChannels,M=p.inHeight,L=p.inWidth,z=p.outChannels,B=p.outHeight,j=p.outWidth,V=p.strideHeight,q=p.strideWidth,U=D-1-p.padInfo.top,W=P-1-p.padInfo.left,G=z/F,H=0;H<N;++H)for(var K=0;K<F;++K)for(var X=0;X<M;++X)for(var Q=X-U,Y=Math.max(0,Math.ceil(Q/V)),Z=Math.min(B,(D+Q)/V),J=0;J<L;++J){for(var $=J-W,ee=Math.max(0,Math.ceil($/q)),te=Math.min(j,(P+$)/q),ne=0,re=Y;re<Z;++re)for(var ae=re*V-Q,ie=ee;ie<te;++ie)for(var oe=C*H+S*re+T*ie,se=I*(D-1-ae)+R*(P-1-(ie*q-$))+O*K,ue=0;ue<G;++ue)ne+=w[oe+(K*G+ue)]*A[se+ue];g[_*H+b*X+k*J+K]=ne}return n.makeTensorInfo(m.shape,m.dtype,m.values)}},ex={kernelName:"Dilation2D",backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=a.strides,u=a.pad,c=a.dilations,l=n,h=l.data.get(i.dataId).values,f=i.shape.length,d=l.data.get(o.dataId).values,p=o.shape.length,m=v.computeDilation2DInfo(i.shape,o.shape,s,u,"NHWC",c),g=m.batchSize,y=m.inHeight,_=m.inWidth,b=m.inChannels,k=m.outHeight,w=m.outWidth,x=m.padInfo,C=m.strideHeight,S=m.strideWidth,T=m.filterHeight,A=m.filterWidth,E=m.dilationHeight,I=m.dilationWidth,R=m.outShape,O=r.sizeFromShape(R),N=R.length,D=r.getArrayFromDType(i.dtype,O),P=0;P<g;++P)for(var F=0;F<k;++F)for(var M=F*C-x.top,L=0;L<w;++L)for(var z=L*S-x.left,B=0;B<b;++B){for(var j=Number.MIN_SAFE_INTEGER,V=0;V<T;++V){var q=M+V*E;if(q>=0&&q<y)for(var U=0;U<A;++U){var W=z+U*I;if(W>=0&&W<_){var G=r.locToIndex([P,q,W,B],f,r.computeStrides(i.shape)),H=r.locToIndex([V,U,B],p,r.computeStrides(o.shape)),K=h[G]+d[H];K>j&&(j=K)}}}D[r.locToIndex([P,F,L,B],N,r.computeStrides(R))]=j}return{dataId:l.write(r.toTypedArray(D,i.dtype),R,i.dtype),shape:R,dtype:i.dtype}}},tx={kernelName:"Dilation2DBackpropFilter",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=t.dy,u=a.strides,c=a.pad,l=a.dilations,h=n,f=r.toNestedArray(i.shape,h.data.get(i.dataId).values),d=r.toNestedArray(o.shape,h.data.get(o.dataId).values),p=v.computeDilation2DInfo(i.shape,o.shape,u,c,"NHWC",l),m=p.batchSize,g=p.inHeight,y=p.inWidth,_=p.inChannels,b=p.outHeight,k=p.outWidth,w=p.padInfo,x=p.strideHeight,C=p.strideWidth,S=p.filterHeight,T=p.filterWidth,A=p.dilationHeight,E=p.dilationWidth,I=p.outShape;r.assert(s.rank===I.length,(function(){return"Error in Dilation2DBackpropFilter, dy must have the same rank as output ".concat(I.length,", but got ")+s.rank}));for(var R=r.toNestedArray(I,h.data.get(s.dataId).values),O=r.makeZerosNestedTypedArray(o.shape,o.dtype),N=0;N<m;++N)for(var D=0;D<b;++D)for(var P=D*x-w.top,F=0;F<k;++F)for(var M=F*C-w.left,L=0;L<_;++L){for(var z=Number.MIN_SAFE_INTEGER,B=0,j=0,V=0;V<S;++V){var q=P+V*A;if(q>=0&&q<g)for(var U=0;U<T;++U){var W=M+U*E;if(W>=0&&W<y){var G=f[N][q][W][L]+d[V][U][L];G>z&&(z=G,B=V,j=U)}}}O[B][j][L]+=R[N][D][F][L]}return{dataId:h.write(r.toTypedArray(O,i.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}},nx={kernelName:"Dilation2DBackpropInput",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.filter,s=t.dy,u=a.strides,c=a.pad,l=a.dilations,h=n,f=r.toNestedArray(i.shape,h.data.get(i.dataId).values),d=r.toNestedArray(o.shape,h.data.get(o.dataId).values),p=v.computeDilation2DInfo(i.shape,o.shape,u,c,"NHWC",l),m=p.batchSize,g=p.inHeight,y=p.inWidth,_=p.inChannels,b=p.outHeight,k=p.outWidth,w=p.padInfo,x=p.strideHeight,C=p.strideWidth,S=p.filterHeight,T=p.filterWidth,A=p.dilationHeight,E=p.dilationWidth,I=p.outShape;r.assert(s.rank===I.length,(function(){return"Error in Dilation2DBackpropInput, dy must have the same rank as output ".concat(I.length,", but got ")+s.rank}));for(var R=r.toNestedArray(I,h.data.get(s.dataId).values),O=r.makeZerosNestedTypedArray(i.shape,i.dtype),N=0;N<m;++N)for(var D=0;D<b;++D)for(var P=D*x-w.top,F=0;F<k;++F)for(var M=F*C-w.left,L=0;L<_;++L){for(var z=Number.MIN_SAFE_INTEGER,B=P<0?0:P,j=M<0?0:M,V=0;V<S;++V){var q=P+V*A;if(q>=0&&q<g)for(var U=0;U<T;++U){var W=M+U*E;if(W>=0&&W<y){var G=f[N][q][W][L]+d[V][U][L];G>z&&(z=G,B=q,j=W)}}}O[N][B][j][L]+=R[N][D][F][L]}return{dataId:h.write(r.toTypedArray(O,i.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},rx=Kk((function(e,t){return e/t})),ax=uw(We,rx),ix={kernelName:We,backendName:"cpu",kernelFunc:ax},ox=v.ERF_P,sx=v.ERF_A1,ux=v.ERF_A2,cx=v.ERF_A3,lx=v.ERF_A4,hx=v.ERF_A5,fx={kernelName:"Erf",backendName:"cpu",kernelFunc:Vk("Erf",(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+ox*n);return t*(1-((((hx*r+lx)*r+cx)*r+ux)*r+sx)*r*Math.exp(-n*n))}))},dx=Nw((function(e){return Math.exp(e)})),px={kernelName:"Exp",backendName:"cpu",kernelFunc:qk("Exp",dx)},mx=Nw((function(e){return Math.expm1(e)})),vx={kernelName:"Expm1",backendName:"cpu",kernelFunc:qk("Expm1",mx)},gx=Kk((function(e,t){return e*t})),yx=cw((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),_x=uw("Multiply",gx,yx),bx={kernelName:"Multiply",backendName:"cpu",kernelFunc:_x};function kx(e,t,n,a,i){var o=h.isSliceContinous(a,t,n),s=r.sizeFromShape(n),u=r.computeStrides(a);if(o){var c=h.computeFlatOffset(t,u);return e.subarray(c,c+s)}for(var l=r.getTypedArrayFromDType(i,s),f=0;f<s;++f){var d=n.length,p=r.computeStrides(n),m=r.indexToLoc(f,d,p).map((function(e,n){return e+t[n]})),v=r.locToIndex(m,a.length,u);l[f]=e[v]}return l}function wx(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;Pk(a,"slice");var s=_slicedToArray2(h.parseSliceParams(a,i,o),2),u=s[0],c=s[1];h.assertParamsValid(a,u,c);var l=kx(n.data.get(a.dataId).values,u,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,l)}var xx={kernelName:"Slice",backendName:"cpu",kernelFunc:wx},Cx=Kk((function(e,t){return e-t})),Sx=cw((function(e,t,n,r){return{real:e-n,imag:t-r}})),Tx=uw(He,Cx,Sx),Ax={kernelName:He,backendName:"cpu",kernelFunc:Tx};function Ex(e,t,n){for(var a=e.shape,i=a[0],o=a[1],s=n.data.get(e.dataId),u=s.complexTensorInfos.real,c=s.complexTensorInfos.imag,l=[i,o],h=r.sizeFromShape(l),f=r.getTypedArrayFromDType("float32",h),d=r.getTypedArrayFromDType("float32",h),p=0;p<i;p++){for(var m=wx({inputs:{x:u},backend:n,attrs:{begin:[p,0],size:[1,o]}}),g=wx({inputs:{x:c},backend:n,attrs:{begin:[p,0],size:[1,o]}}),y=nw({inputs:{real:m,imag:g},backend:n}),_=Ix(y,t,n),b=_.real,k=_.imag,w=v.mergeRealAndImagArrays(b,k),x=0;x<o;x++){var C=v.getComplexWithIndex(w,x);f[p*o+x]=C.real,d[p*o+x]=C.imag}n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y)}var S=n.makeTensorInfo(l,"float32",f),T=n.makeTensorInfo(l,"float32",d),A=nw({inputs:{real:S,imag:T},backend:n});return n.disposeIntermediateTensorInfo(S),n.disposeIntermediateTensorInfo(T),A}function Ix(e,t,n){var a=r.sizeFromShape(e.shape),i=n.data.get(e.dataId),o=n.data.get(i.complexTensorInfos.real.dataId).values,s=n.data.get(i.complexTensorInfos.imag.dataId).values;if(0==((_=a)&_-1)){var u=function e(t,n,r,a,i){if(1===r)return{real:t,imag:n};var o=v.mergeRealAndImagArrays(t,n),s=r/2,u=v.complexWithEvenIndex(o),c=u.real,l=u.imag,h=[c.length],f=i.makeTensorInfo(h,"float32",c),d=i.makeTensorInfo(h,"float32",l),p=nw({inputs:{real:f,imag:d},backend:i}),m=v.complexWithOddIndex(o),g=m.real,y=m.imag,_=[g.length],b=i.makeTensorInfo(_,"float32",g),k=i.makeTensorInfo(_,"float32",y),w=nw({inputs:{real:b,imag:k},backend:i}),x=e(c,l,s,a,i),C=x.real,S=x.imag,T=[C.length],A=i.makeTensorInfo(T,"float32",C),E=i.makeTensorInfo(T,"float32",S),I=nw({inputs:{real:A,imag:E},backend:i}),R=e(g,y,s,a,i),O=R.real,N=R.imag,D=[O.length],P=i.makeTensorInfo(D,"float32",O),F=i.makeTensorInfo(D,"float32",N),M=nw({inputs:{real:P,imag:F},backend:i}),L=v.exponents(r,a),z=[L.real.length],B=i.makeTensorInfo(z,"float32",L.real),j=i.makeTensorInfo(z,"float32",L.imag),V=nw({inputs:{real:B,imag:j},backend:i}),q=_x({inputs:{a:V,b:M},backend:i}),U=fw({inputs:{a:I,b:q},backend:i}),W=Tx({inputs:{a:I,b:q},backend:i}),G=aw({inputs:{input:U},backend:i}),H=aw({inputs:{input:W},backend:i}),K=Mw({inputs:{input:U},backend:i}),X=Mw({inputs:{input:W},backend:i}),Q=zw({inputs:[G,H],backend:i,attrs:{axis:0}}),Y=zw({inputs:[K,X],backend:i,attrs:{axis:0}}),Z=i.data.get(Q.dataId).values,J=i.data.get(Y.dataId).values;return i.disposeIntermediateTensorInfo(f),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(p),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(k),i.disposeIntermediateTensorInfo(w),i.disposeIntermediateTensorInfo(A),i.disposeIntermediateTensorInfo(E),i.disposeIntermediateTensorInfo(I),i.disposeIntermediateTensorInfo(P),i.disposeIntermediateTensorInfo(F),i.disposeIntermediateTensorInfo(M),i.disposeIntermediateTensorInfo(B),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(q),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(K),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(X),i.disposeIntermediateTensorInfo(Q),i.disposeIntermediateTensorInfo(Y),{real:Z,imag:J}}(o,s,a,t,n),c=[e.shape[0],e.shape[1]];if(t){var l=n.makeTensorInfo(c,"float32",u.real),h=n.makeTensorInfo(c,"float32",u.imag),f=n.makeTensorInfo([],"float32",r.createScalarValue(a,"float32")),d=Gk({inputs:{x:f},backend:n}),p=ix.kernelFunc({inputs:{a:l,b:f},backend:n}),m=ix.kernelFunc({inputs:{a:h,b:d},backend:n}),g=n.data.get(p.dataId).values,y=n.data.get(m.dataId).values;return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),{real:g,imag:y}}return u}var _,b=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=v.exponent(a*s,t,n),c=v.getComplexWithIndex(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),v.assignToTypedArray(r,i,o,a)}return r}(v.mergeRealAndImagArrays(o,s),a,t);return v.splitRealAndImagArrays(b)}var Rx={kernelName:"FFT",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=t.input,i=r.sizeFromShape(a.shape),o=a.shape[a.shape.length-1],s=pw({inputs:{x:a},backend:n,attrs:{shape:[i/o,o]}}),u=Ex(s,!1,n),c=pw({inputs:{x:u},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}},Ox={kernelName:"Fill",backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,a=n.shape,i=n.value,o=n.dtype||r.inferDtype(i),s=r.getArrayFromDType(o,r.sizeFromShape(a));return function(e,t,n){e.fill(t)}(s,i),t.makeTensorInfo(a,o,s)}},Nx={kernelName:"FlipLeftRight",backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,a=t.image,i=n,o=r.getTypedArrayFromDType(a.dtype,r.sizeFromShape(a.shape)),s=_slicedToArray2(a.shape,4),u=s[0],c=s[1],l=s[2],h=s[3],f=i.data.get(a.dataId).values,d=0;d<u;d++)for(var p=d*l*c*h,m=0;m<c;m++)for(var v=m*(l*h),g=0;g<l;g++)for(var y=g*h,_=0;_<h;_++){var b=Math.round(l-[u,m,g,_][2]),k=p+v+y+_,w=f[k];b>=0&&b<l&&(w=f[p+v+b*h+_]),o[k]=w}return{dataId:i.write(o,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},Dx=Nw((function(e){return Math.floor(e)})),Px={kernelName:"Floor",backendName:"cpu",kernelFunc:qk("Floor",Dx)},Fx={kernelName:"FusedConv2D",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,f=r.dimRoundingMode,d=r.activation,p=jw({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:f}});if(o){var m=p;p=fw({inputs:{a:p,b:o},backend:n}),n.disposeIntermediateTensorInfo(m)}if(d){var v=p;p=tw(n,p,d,s),n.disposeIntermediateTensorInfo(v)}return p}},Mx={kernelName:"FusedDepthwiseConv2D",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,f=r.dimRoundingMode,d=r.activation,p=Yw({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:f}});if(o){var m=p;p=fw({inputs:{a:p,b:o},backend:n}),n.disposeIntermediateTensorInfo(m)}if(d){var v=p;p=tw(n,p,d,s),n.disposeIntermediateTensorInfo(v)}return p}},Lx={kernelName:"IFFT",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=t.input,i=r.sizeFromShape(a.shape),o=a.shape[a.shape.length-1],s=pw({inputs:{x:a},backend:n,attrs:{shape:[i/o,o]}}),u=Ex(s,!0,n),c=pw({inputs:{x:u},backend:n,attrs:{shape:a.shape}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}},zx={kernelName:"IsFinite",backendName:"cpu",kernelFunc:Vk("IsFinite",(function(e){return Number.isFinite(e)?1:0}),"bool")},Bx={kernelName:"IsInf",backendName:"cpu",kernelFunc:Vk("IsInf",(function(e){return Math.abs(e)===1/0?1:0}),"bool")},jx={kernelName:"IsNan",backendName:"cpu",kernelFunc:Vk("IsNan",(function(e){return Number.isNaN(e)?1:0}),"bool")},Vx=Nw((function(e){return Math.log(e)})),qx={kernelName:"Log",backendName:"cpu",kernelFunc:qk("Log",Vx)},Ux={kernelName:"Log1p",backendName:"cpu",kernelFunc:Vk("Log1p",(function(e){return Math.log1p(e)}))},Wx={kernelName:"LogicalNot",backendName:"cpu",kernelFunc:Vk("LogicalNot",(function(e){return e?0:1}),"bool")};function Gx(e,t,n,a){for(var i=r.getTypedArrayFromDType(a,r.sizeFromShape(n)),o=0;o<i.length;++o){for(var s=o*t,u=e[s],c=0;c<t;++c){var l=e[s+c];l>u&&(u=l)}i[o]=u}return i}function Hx(e,t,n,a,i){for(var o=t.length,s=r.sizeFromShape(t),u=r.computeStrides(t),c=r.computeStrides(i),l=r.getTypedArrayFromDType(n,r.sizeFromShape(i)),h=0;h<s;++h){for(var f=r.indexToLoc(h,o,u),d=new Array(f.length),p=0;p<d.length;p++)d[p]=f[a[p]];l[r.locToIndex(d,o,c)]=e[h]}return l}var Kx={kernelName:"Max",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,a=e.backend,i=t.x,o=n.reductionIndices,s=n.keepDims,u=a,c=i.shape,l=c.length,h=r.parseAxisParam(o,c),f=h,d=v.getAxesPermutation(f,l),p=u.data.get(i.dataId).values;if(null!=d){for(var m=new Array(l),g=0;g<m.length;g++)m[g]=c[d[g]];p=Hx(p,c,i.dtype,d,m),f=v.getInnerMostAxes(f.length,l),c=m}Pk(i,"max"),v.assertAxesAreInnerMostDims("max",f,l);var y=_slicedToArray2(v.computeOutAndReduceShapes(c,f),2),_=y[0],b=y[1],k=Gx(p,r.sizeFromShape(b),_,i.dtype),w=u.write(k,_,i.dtype),x=_;return s&&(x=v.expandShapeToKeepDim(_,h)),{dataId:w,shape:x,dtype:i.dtype}}},Xx={kernelName:"MaxPool",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x;Pk(i,"maxPool");var o=a.filterSize,s=a.strides,u=a.pad,c=a.dimRoundingMode;r.assert(v.eitherStridesOrDilationsAreOne(s,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var l,h=v.computePool2DInfo(i.shape,o,s,1,u,c);if(1===h.filterWidth&&1===h.filterHeight&&r.arraysEqual(h.inShape,h.outShape))l=Gk({inputs:{x:i},backend:n});else{var f=n.data.get(i.dataId).values,d=r.computeStrides(i.shape),p=Aw(f,0,i.dtype,d,h,"max");l=n.makeTensorInfo(h.outShape,i.dtype,p.values)}return l}},Qx={kernelName:"MaxPoolBackprop",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;Pk([i,t.output],"maxPoolBackprop");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=v.computePool2DInfo(o.shape,s,u,1,c,l),f=n.data.get(o.dataId).values,d=qn(h.outShape,o.dtype,Ew(f,o.shape,o.dtype,h).values),p=h.strideHeight,m=h.strideWidth,g=h.dilationHeight,y=h.dilationWidth,_=h.effectiveFilterHeight,b=h.effectiveFilterWidth,k=b-1-h.padInfo.left,w=_-1-h.padInfo.top,x=qn(o.shape,"float32"),C=n.data.get(a.dataId).values,S=qn(a.shape,"float32",C),T=0;T<h.batchSize;++T)for(var A=0;A<h.inChannels;++A)for(var E=0;E<h.inHeight;++E)for(var I=0;I<h.inWidth;++I){for(var R=E-w,O=I-k,N=0,D=0;D<_;D+=g){var P=(R+D)/p;if(!(P<0||P>=h.outHeight||Math.floor(P)!==P))for(var F=0;F<b;F+=y){var M=(O+F)/m;if(!(M<0||M>=h.outWidth||Math.floor(M)!==M)){var L=_*b-1-d.get(T,P,M,A)===D*b+F?1:0;0!==L&&(N+=S.get(T,P,M,A)*L)}}}x.set(N,T,E,I,A)}return n.makeTensorInfo(x.shape,x.dtype,x.values)}},Yx={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,a=e.backend,i=t.x,o=n.filterSize,s=n.strides,u=n.pad,c=n.includeBatchInIndex,l=a;Pk(i,"MaxPoolWithArgmax");var h=l.data.get(i.dataId).values,f=v.computePool2DInfo(i.shape,o,s,[1,1],u),d=_slicedToArray2(function(e,t,n,a,i){var o=Aw(e,0,n,r.computeStrides(t),i,"max"),s=Ew(e,t,n,i,!0,a);return[o.values,s.values]}(h,i.shape,i.dtype,c,f),2),p=d[0],m=d[1],g=l.write(p,f.outShape,i.dtype),y=l.write(m,f.outShape,i.dtype);return[{dataId:g,shape:f.outShape,dtype:i.dtype},{dataId:y,shape:f.outShape,dtype:"int32"}]}},Zx={kernelName:"MirrorPad",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.paddings,s=a.mode;Pk(i,"mirrorPad");for(var u=o.map((function(e,t){return e[0]+i.shape[t]+e[1]})),c=o.map((function(e){return e[0]})),l=o.map((function(e,t){return e[0]+i.shape[t]})),h="reflect"===s?0:1,f=n.data.get(i.dataId).values,d=i.shape.length,p=r.computeStrides(i.shape),m=r.sizeFromShape(u),v=u.length,g=r.computeStrides(u),y=r.getTypedArrayFromDType(i.dtype,m),_=0;_<m;_++){for(var b=r.indexToLoc(_,v,g),k=0;k<v;k++)b[k]<c[k]?b[k]=2*c[k]-b[k]-h:b[k]>=l[k]&&(b[k]=2*(l[k]-1)-b[k]+h);b=b.map((function(e,t){return e-c[t]}));var w=r.locToIndex(b,d,p);y[_]=f[w]}return{dataId:n.write(y,u,i.dtype),shape:u,dtype:i.dtype}}},Jx=g.nonMaxSuppressionV4Impl,$x={kernelName:"NonMaxSuppressionV4",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n;Pk(a,"NonMaxSuppressionPadded");var h=l.data.get(a.dataId).values,f=l.data.get(i.dataId).values,d=Jx(h,f,o,s,u,c);return[d.selectedIndices,d.validOutputs]}},eC=g.nonMaxSuppressionV5Impl,tC={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n;Pk(a,"NonMaxSuppressionWithScore");var h=l.data.get(a.dataId).values,f=l.data.get(i.dataId).values,d=eC(h,f,o,s,u,c);return[d.selectedIndices,d.selectedScores]}},nC=Kk((function(e,t){return e!==t?1:0})),rC={kernelName:"NotEqual",backendName:"cpu",kernelFunc:uw("NotEqual",nC,null,"bool")},aC={kernelName:"PadV2",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.paddings,s=a.constantValue;Pk(i,"pad");var u=o.map((function(e,t){return e[0]+i.shape[t]+e[1]})),c=o.map((function(e){return e[0]})),l=n.data.get(i.dataId).values,h=r.sizeFromShape(i.shape),f=i.shape.length,d=r.computeStrides(i.shape),p=r.sizeFromShape(u),m=u.length,v=r.computeStrides(u),g=r.getTypedArrayFromDType(i.dtype,p);0!==s&&g.fill(s);for(var y=0;y<h;y++){var _=r.indexToLoc(y,f,d).map((function(e,t){return e+c[t]}));g[r.locToIndex(_,m,v)]=l[y]}return{dataId:n.write(g,u,i.dtype),shape:u,dtype:i.dtype}}},iC={kernelName:"Reciprocal",backendName:"cpu",kernelFunc:Vk("Reciprocal",(function(e){return 1/e}))},oC={kernelName:"RotateWithOffset",backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,a=e.backend,i=t.image,o=n.radians,s=n.fillValue,u=n.center,c=a,l=r.getTypedArrayFromDType(i.dtype,r.sizeFromShape(i.shape)),h=_slicedToArray2(i.shape,4),f=h[0],d=h[1],p=h[2],m=h[3],g=_slicedToArray2(v.getImageCenter(u,d,p),2),y=g[0],_=g[1],b=Math.sin(o),k=Math.cos(o),w=c.data.get(i.dataId).values,x=0;x<f;x++)for(var C=x*p*d*m,S=0;S<d;S++)for(var T=S*(p*m),A=0;A<p;A++)for(var E=A*m,I=0;I<m;I++){var R=[f,S,A,I],O=R[2],N=R[1],D=(O-y)*k-(N-_)*b,P=(O-y)*b+(N-_)*k;D=Math.round(D+y),P=Math.round(P+_);var F=s;"number"!=typeof s&&(F=3===I?255:s[I]),D>=0&&D<p&&P>=0&&P<d&&(F=w[C+P*(p*m)+D*m+I]),l[C+T+E+I]=F}return{dataId:c.write(l,i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},sC={kernelName:"Round",backendName:"cpu",kernelFunc:Vk("Round",(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2==0?t:t+1}))},uC=Nw((function(e){return 1/Math.sqrt(e)})),cC={kernelName:"Rsqrt",backendName:"cpu",kernelFunc:qk("Rsqrt",uC)},lC=v.SELU_SCALEALPHA,hC=v.SELU_SCALE,fC={kernelName:"Selu",backendName:"cpu",kernelFunc:Vk("Selu",(function(e){return e>=0?hC*e:lC*(Math.exp(e)-1)}))},dC={kernelName:"Sigmoid",backendName:"cpu",kernelFunc:Vk("Sigmoid",(function(e){return 1/(1+Math.exp(-e))}))},pC={kernelName:"Sign",backendName:"cpu",kernelFunc:Vk("Sign",(function(e){return e<0?-1:e>0?1:0}))},mC=Vk(Ge,(function(e){return Math.sin(e)})),vC={kernelName:Ge,backendName:"cpu",kernelFunc:mC},gC={kernelName:"Sinh",backendName:"cpu",kernelFunc:Vk("Sinh",(function(e){return Math.sinh(e)}))},yC=Math.log(1.1920928955078125e-7)+2,_C={kernelName:"Softplus",backendName:"cpu",kernelFunc:Vk("Softplus",(function(e){var t=e>-yC,n=e<yC,r=Math.exp(e);return n?r:t?e:Math.log(1+r)}))};function bC(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;Pk(a,"transpose");for(var o=new Array(a.shape.length),s=0;s<o.length;s++)o[s]=a.shape[i[s]];var u=Hx(r.data.get(a.dataId).values,a.shape,a.dtype,i,o);return{dataId:r.write(u,o,a.dtype),shape:o,dtype:a.dtype}}var kC={kernelName:"Transpose",backendName:"cpu",kernelFunc:bC},wC={kernelName:"SpaceToBatchND",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.blockShape,s=a.paddings;Pk([i],"spaceToBatchND");var u=r.sizeFromShape(o),c=[[0,0]];c.push.apply(c,_toConsumableArray(s));for(var l=1+o.length;l<i.shape.length;++l)c.push([0,0]);var h=aC.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:c,constantValue:0}}),f=v.getReshaped(h.shape,o,u,!1),d=v.getPermuted(f.length,o.length,!1),p=v.getReshapedPermuted(h.shape,o,u,!1),m=pw({inputs:{x:h},backend:n,attrs:{shape:f}}),g=bC({inputs:{x:m},backend:n,attrs:{perm:d}}),y=pw({inputs:{x:g},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),y}},xC={kernelName:"Sqrt",backendName:"cpu",kernelFunc:Vk("Sqrt",(function(e){return Math.sqrt(e)}))},CC={kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;Pk(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},SC=Kk((function(e,t){var n=e-t;return n*n})),TC={kernelName:"SquaredDifference",backendName:"cpu",kernelFunc:uw("SquaredDifference",SC)},AC={kernelName:"Step",backendName:"cpu",kernelFunc:Vk("Step",(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha}))},EC=Vk(Ke,(function(e){return Math.tan(e)})),IC={kernelName:Ke,backendName:"cpu",kernelFunc:EC},RC=Vk("Tanh",(function(e){return Math.tanh(e)}));function OC(e,t,n,a){for(var i=r.parseAxisParam(t,n)[0],o=[1,n[0],1],s=0;s<i;s++)o[0]*=n[s];o[1]=n[i];for(var u=i+1;u<n.length;u++)o[2]*=n[u];for(var c={},l=new Int32Array(n[i]),h=new vt(o,a,e),f=[],d=1===o[0]&&1===o[2],p=0;p<n[i];p++){var m=void 0;if(d)m=e[p].toString();else{for(var v=[],g=0;g<o[0];g++)for(var y=0;y<o[2];y++)v.push(h.get(g,p,y));m=v.join(",")}if(void 0!==c[m])l[p]=c[m];else{var _=Object.keys(c).length;c[m]=_,l[p]=_,f.push(p)}}var b=o.slice();b[1]=Object.keys(c).length;var k=new vt(b,a);f.forEach((function(e,t){for(var n=0;n<o[0];n++)for(var r=0;r<o[2];r++)k.set(h.get(n,e,r),n,t,r)}));var w=n.slice();return w[i]=b[1],{outputValues:k.values,outputShape:w,indices:l}}for(var NC=0,DC=[yw,bw,kw,ww,dw,xw,Cw,Sw,Tw,Iw,Rw,gw,Ow,sw,Pw,Fw,rw,Bw,qw,Uw,Vw,Gw,Hw,Ww,Xw,Qw,Zw,Jw,$w,ex,nx,tx,ix,Wk,fx,px,vx,Rx,Ox,Nx,Px,Fx,Mx,Hk,Lx,Lw,zx,Bx,jx,qx,Ux,Wx,Xx,Qx,Yx,Kx,Zx,bx,$x,tC,rC,aC,Yk,iw,iC,Jk,ew,mw,oC,sC,cC,fC,dC,pC,vC,gC,xx,_C,wC,xC,CC,TC,AC,Ax,IC,{kernelName:"Tanh",backendName:"cpu",kernelFunc:RC},kC,{kernelName:"Unique",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;Pk(i,"unique");var o=OC(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}}];NC<DC.length;NC++){$e(DC[NC])}var PC,FC,MC,LC={},zC={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function BC(e){if(!(e in LC)){var t=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete LC[e]}),!1),1===e?t.getContext("webgl",zC)||t.getContext("experimental-webgl",zC):t.getContext("webgl2",zC)}(e);if(null===t)return console.log("Could not get context for WebGL version",e),null;LC[e]=t}var n=LC[e];return n.isContextLost()?(delete LC[e],BC(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),LC[e])}function jC(e,t){return[t,e]}function VC(e){var t=r.sizeFromShape(e),n=Math.ceil(t/4);return r.sizeToSquarishShape(n)}function qC(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function UC(e,t){var n,r,a,i,o,s,u,c,l,h=e;return 2===ze().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,a=h.RGBA16F,i=h.RGBA32F,o=h.RED,s=4,u=1,c=h.HALF_FLOAT,l=h.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=h.RGBA,o=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function WC(e,t){var n=t();return ze().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}(e,t))}(e),n}function GC(e){return!!(ze().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function HC(e,t){return tS(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(PC||(PC={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(FC||(FC={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(MC||(MC={}));var KC,XC,QC=/ERROR: [0-9]+:([0-9]+):/g;function YC(e,t){if(WC(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function ZC(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(WC(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),WC(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),WC(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function JC(e,t,n){WC(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),WC(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function $C(e,t){WC(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),WC(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function eS(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}(e,t))}function tS(e,t,n){var r=WC(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function nS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return r.sizeFromShape(e.slice(0,e.length-t))}function rS(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function aS(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[nS(e)].concat(_toConsumableArray(rS(e)))),t}function iS(e){return e%2==0}function oS(e,t){if(e=e.slice(-2),t=t.slice(-2),r.arraysEqual(e,t))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],a=t.slice(-1)[0];if(n===a)return!0;if(iS(n)&&iS(a)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&iS(e[0])&&iS(t[0])}function sS(e,t){return null!=e.getExtension(t)}function uS(e){try{if(null!=BC(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function cS(e){var t=UC(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function lS(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&r.assert("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors in the WebGL backend."}))}))}var hS=ze();hS.registerFlag("HAS_WEBGL",(function(){return hS.getNumber("WEBGL_VERSION")>0})),hS.registerFlag("WEBGL_VERSION",(function(){return uS(2)?2:uS(1)?1:0})),hS.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),hS.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===hS.get("WEBGL_VERSION")})),hS.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),hS.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),hS.registerFlag("WEBGL_PACK",(function(){return hS.getBool("HAS_WEBGL")})),hS.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return hS.getBool("WEBGL_PACK")})),hS.registerFlag("WEBGL_PACK_CLIP",(function(){return hS.getBool("WEBGL_PACK")})),hS.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),hS.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return hS.getBool("WEBGL_PACK")})),hS.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return hS.getBool("WEBGL_PACK")})),hS.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return hS.getBool("WEBGL_PACK")})),hS.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return hS.getBool("WEBGL_PACK")})),hS.registerFlag("WEBGL_PACK_REDUCE",(function(){return hS.getBool("WEBGL_PACK")})),hS.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return hS.getBool("WEBGL_PACK")})),hS.registerFlag("WEBGL_CONV_IM2COL",(function(){return hS.getBool("WEBGL_PACK")})),hS.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==KC){var t=BC(e);KC=t.getParameter(t.MAX_TEXTURE_SIZE)}return KC}(hS.getNumber("WEBGL_VERSION"))})),hS.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==XC){var t=BC(e);XC=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,XC)}(hS.getNumber("WEBGL_VERSION"))})),hS.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=hS.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=BC(e);return sS(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:sS(t,"EXT_disjoint_timer_query")?1:0}(e)})),hS.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return hS.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!i.isMobile()})),hS.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=BC(e);if(1===e){if(!sS(t,"OES_texture_float"))return!1}else if(!sS(t,"EXT_color_buffer_float"))return!1;return cS(t)}(hS.getNumber("WEBGL_VERSION"))})),hS.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!hS.getBool("WEBGL_FORCE_F16_TEXTURES")&&hS.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),hS.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return function(e){if(0===e)return!1;var t=BC(e);if(1!==e){if(sS(t,"EXT_color_buffer_float"))return cS(t);if(sS(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=UC(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),i}(t,n)}return!1}return!!sS(t,"OES_texture_float")&&!!sS(t,"WEBGL_color_buffer_float")&&cS(t)}(hS.getNumber("WEBGL_VERSION"))})),hS.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=hS.getNumber("WEBGL_VERSION"))&&null!=BC(e).fenceSync;var e})),hS.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return hS.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),hS.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))}));var fS=q.simpleAbsImpl,dS=q.addImpl,pS=q.ceilImpl,mS=q.expImpl,vS=q.expm1Impl,gS=q.floorImpl,yS=q.logImpl,_S=q.maxImpl,bS=q.multiplyImpl,kS=q.rsqrtImpl,wS=q.sliceImpl,xS=q.subImpl,CS=q.transposeImpl,SS=q.uniqueImpl,TS=function e(t,n){_classCallCheck2(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T"+t}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")},AS=function e(t,n){_classCallCheck2(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T"+t}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")},ES=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));",";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat("max"===n?">":"<"," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")};function IS(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function RS(e,t){return 1===t?[e]:IS(e,t)}function OS(){var e,t,n,r,a,i,o,s,u,c;return 2===ze().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function NS(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",a=r.computeStrides(t);return a.map((function(t,r){return"int ".concat(e[r]," = ").concat(n," / ").concat(t,"; ").concat(r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(t):"index -= ".concat(e[r]," * ").concat(t),";")})).join("")}function DS(e){var t=r.computeStrides(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}var PS="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",FS=v.getBroadcastDims,MS="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",LS="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",zS="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",BS="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function jS(e){return"offset"+e}function VS(e){var t=e.name,n=r.sizeFromShape(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function qS(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function US(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function WS(e,t){return t.map((function(t){return e[t]})).join(", ")}var GS=function e(t,n,a,i){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,r.assert(t.length>2,(function(){return"Packed arg".concat(a.charAt(0).toUpperCase()+a.slice(1)," supports only inputs with rank above 2.")}));var o=Math.ceil(t[t.length-1]/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),i||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,h=qS(l),f=RS("coords",l);if(1===o){var d=qS(u=l+1);s="\n        ".concat(d," sourceLocR = ").concat(d,"(").concat(f.join(),", 0);\n        ++").concat(f[l-1],";\n        ").concat(d," sourceLocG = ").concat(d,"(").concat(f.join(),", 0);\n        ++").concat(f[l-2],";\n        ").concat(d," sourceLocA = ").concat(d,"(").concat(f.join(),", 0);\n        --").concat(f[l-1],";\n        ").concat(d," sourceLocB = ").concat(d,"(").concat(f.join(),", 0);\n        --").concat(f[l-2],";")}else u=l,s="\n        ".concat(h," sourceLocR = coords;\n        ++").concat(f[l-1],";\n        ").concat(h," sourceLocG = coords;\n        ++").concat(f[l-2],";\n        ").concat(h," sourceLocA = coords;\n        --").concat(f[l-1],";\n        ").concat(h," sourceLocB = coords;\n        --").concat(f[l-2],";");var p=["x","y","z","w","u","v"].slice(0,u),m="."+p[u-1],v=p.map((function(e){return"int "+e})),g=RS("sourceLocR",u-1).concat("inIdx.r"),y=RS("sourceLocG",u-1).concat("inIdx.g"),_=RS("sourceLocB",u-1).concat("inIdx.b"),b=RS("sourceLocA",u-1).concat("inIdx.a"),k="max"===a?"greaterThan":"lessThan",w=i?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(_.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),")));"),x="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(_.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(b.join(),") : 0.)"),C=i?"":"\n      float getBestIndicesAChannel(".concat(v.join(),") {\n        return getChannel(getBestIndicesA(").concat(p.join(),"),\n                                          vec2(").concat(p.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(v.join(),") {\n        return getChannel(getA(").concat(p.join(),"),\n                               vec2(").concat(p.slice(-2).join(),"));\n      }\n      ").concat(C,"\n      void main() {\n        ").concat(h," coords = getOutputCoords();\n        bool hasNextCol = ").concat(f[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(f[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(m,", sourceLocG").concat(m,",\n          sourceLocB").concat(m,", sourceLocA").concat(m,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(x,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(x,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(k,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")},HS=function e(t){_classCallCheck2(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n      const float avgMultiplier = float(").concat(1/(t.filterHeight*t.filterWidth),");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,";\n            wR += ").concat(t.dilationHeight,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(r,";\n            wC+= ").concat(t.dilationWidth,") {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},KS=function e(t){_classCallCheck2(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.effectiveFilterDepth,r=t.effectiveFilterHeight,a=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n      const float avgMultiplier = float(").concat(1/(t.filterDepth*t.filterHeight*t.filterWidth),");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(n,";\n            wD += ").concat(t.dilationDepth,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t.strideDepth,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(r,";\n              wR += ").concat(t.dilationHeight,") {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(a,";\n                wC += ").concat(t.dilationWidth,") {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},XS="return (a < 0.) ? b * a : a;",QS=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["A","B"],this.outputShape=v.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")},YS="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",ZS=function e(t,n,a){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck2(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=v.assertAndGetBroadcastShape(n,a);var o=this.outputShape.length,s="";if(i)if(0===o||1===r.sizeFromShape(this.outputShape))s="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(s="\n          ".concat(qS(o)," coords = getOutputCoords();\n        "),1===o)s+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var u=RS("coords",o);s+="\n            bool nextRowOutOfBounds =\n              (".concat(u[o-2]," + 1) >= ").concat(this.outputShape[o-2],";\n            bool nextColOutOfBounds =\n              (").concat(u[o-1]," + 1) >= ").concat(this.outputShape[o-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(s,"\n\n        setOutput(result);\n      }\n    ")},JS=function(){function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}(),$S=function(){function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}(),eT=function e(t){_classCallCheck2(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},tT=function e(t){_classCallCheck2(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat("channelsLast"===t.dataFormat,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},nT=function e(t){_classCallCheck2(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a="channelsLast"===t.dataFormat;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(a?3:1,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(a?1:2,"], coords[").concat(a?2:3,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(a,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},rT=function e(t){_classCallCheck2(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(t.strideDepth," - ").concat(t.padInfo.front,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},aT=function e(t){_classCallCheck2(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(t.strideDepth,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},iT=function e(t){_classCallCheck2(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(t.outChannels/t.inChannels," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(t.strideHeight," - ").concat(t.padInfo.top,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(t.strideWidth," - ").concat(t.padInfo.left,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},oT=function e(t){_classCallCheck2(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(a,"; dm++) {\n              int d2 = d1 * ").concat(a," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},sT=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck2(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.padInfo.top,o=t.padInfo.left,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterHeight,f=t.filterWidth,d=4*Math.floor(t.inChannels/4),p=t.inChannels%4,m="channelsLast"===t.dataFormat,v=m?1:2,g=m?2:3,y=m?3:1,_="",b="";r&&(_=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),b="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      ".concat(_,"\n\n      const ivec2 strides = ivec2(").concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(o,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(y,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(v,"], coords[").concat(g,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(c,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(d,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(m,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===p,") {\n\n              if (").concat(m,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(d,") *\n                    getW(wR, wC, ").concat(d,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(d,", xR, xC) *\n                    getW(wR, wC, ").concat(d,", d2);\n              }\n\n            } else if (").concat(2===p,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(d,", d2),\n                getW(wR, wC, ").concat(d," + 1, d2)\n              );\n\n              if (").concat(m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(d,"),\n                  getX(batch, xR, xC, ").concat(d," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(d,", xR, xC),\n                  getX(batch, ").concat(d," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===p,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(d,", d2),\n                getW(wR, wC, ").concat(d," + 1, d2),\n                getW(wR, wC, ").concat(d," + 2, d2)\n              );\n\n              if (").concat(m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(d,"),\n                  getX(batch, xR, xC, ").concat(d," + 1),\n                  getX(batch, xR, xC, ").concat(d," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(d,", xR, xC),\n                  getX(batch, ").concat(d," + 1, xR, xC),\n                  getX(batch, ").concat(d," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(k,"\n        ").concat(b,"\n        setOutput(result);\n      }\n    ")},uT=function e(t){_classCallCheck2(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterDepth,f=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(h,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(p,") *\n                  getW(wF, wR, wC, ").concat(p,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1),\n                  getX(batch, xF, xR, xC, ").concat(p," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2),\n                  getW(wF, wR, wC, ").concat(p," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},cT=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck2(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.inHeight,o=t.inWidth,s=t.padInfo.top,u=t.padInfo.left,c=t.strideHeight,l=t.strideWidth,h=t.dilationHeight,f=t.dilationWidth,d=t.filterHeight,p=t.filterWidth,m=t.outChannels/t.inChannels,v="",g="";r&&(v=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),g="result = activation(result);");var y=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      ".concat(v,"\n\n      const ivec2 strides = ivec2(").concat(c,", ").concat(l,");\n      const ivec2 pads = ivec2(").concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(m,";\n        int q = d2 - d1 * ").concat(m,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(d,"; wR++) {\n          int xR = xRCorner + wR * ").concat(h,";\n\n          if (xR < 0 || xR >= ").concat(i,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(p,"; wC++) {\n            int xC = xCCorner + wC * ").concat(f,";\n\n            if (xC < 0 || xC >= ").concat(o,") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(y,"\n        ").concat(g,"\n        setOutput(result);\n      }\n    ")},lT=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];_classCallCheck2(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,s=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,l=t.strideHeight,h=t.strideWidth,f=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,m=t.filterWidth,v=m,g="int xR; int xC; int xCOffset;",y=0;y<p;y++)for(var _=0;_<m;_++)g+="\n          vec4 xTexelR".concat(y,"C").concat(2*_," = vec4(0.);\n          vec4 wR").concat(y,"C").concat(_," = vec4(0.);\n          vec4 xR").concat(y,"C").concat(_," = vec4(0.);");for(var b=0;b<p;b++)for(var k=0;k<v;k++){var w=2*k;if(g+="\n          xR = xRCorner + ".concat(b*f,";\n          xC = xCCorner + ").concat(w*d,";\n        "),1===h){if(w<m&&(g+=c%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ".concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(b,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    xTexelR").concat(b,"C").concat(w,".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR").concat(b,"C").concat(w," = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ").concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR").concat(b,"C").concat(w," = vec4(previous.zw, xTexelR").concat(b,"C").concat(w,".xy);\n                } else {\n                  xR").concat(b,"C").concat(w," = vec4(0, 0, xTexelR").concat(b,"C").concat(w,".xy);\n                }\n              "):"\n                if(xR >= 0 && xR < ".concat(o," && xC >= 0 && xC < ").concat(s,") {\n                  xTexelR").concat(b,"C").concat(w," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(b,"C").concat(w," = vec4(0.);\n                }\n\n                xR").concat(b,"C").concat(w," = xTexelR").concat(b,"C").concat(w,";\n              "),w+1<m)){var x=c%2==0?r.nearestLargerEven(d):d;d%2==0&&c%2==1||d%2!=0&&c%2!=1?(g+="\n                  xCOffset = xC + ".concat(c%2," + ").concat(x,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(b,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                  }\n                "),d>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ".concat(o," &&\n                      xCOffset >= 0 && xCOffset < ").concat(s,") {\n                      xTexelR").concat(b,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR").concat(b,"C").concat(w," = vec4(0.);\n                    }\n                  ")),g+="\n                  xR".concat(b,"C").concat(w+1," = vec4(\n                    xTexelR").concat(b,"C").concat(w,".zw, xTexelR").concat(b,"C").concat(w+2,".xy);\n                ")):g+="\n                  xCOffset = xC + ".concat(x,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(b,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR").concat(b,"C").concat(w+1," = xTexelR").concat(b,"C").concat(w+2,";\n                ")}}else w<m&&(g+="\n              if(xR >= 0 && xR < ".concat(o,") {\n            "),c%2==1?(g+="\n                xCOffset = xC + 1 - ".concat(h,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(b,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(b,"C").concat(w," = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ").concat(s,") {\n                  xTexelR").concat(b,"C").concat(w+2," = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR").concat(b,"C").concat(w+2," = vec4(0.);\n                }\n\n                xR").concat(b,"C").concat(w," = vec4(\n                  xTexelR").concat(b,"C").concat(w,".zw, xTexelR").concat(b,"C").concat(w+2,".zw);\n              "),w+1<m&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ".concat(h,";\n                  if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR").concat(b,"C").concat(w+1," = vec4(xTexelR").concat(b,"C").concat(w+2,".xy, final.xy);\n                "))):(g+="\n                if(xC >= 0 && xC < ".concat(s,") {\n                  xTexelR").concat(b,"C").concat(w," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(b,"C").concat(w," = vec4(0.);\n                }\n\n                xCOffset = xC + ").concat(h,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(b,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(b,"C").concat(w+2," = vec4(0.);\n                }\n\n                xR").concat(b,"C").concat(w," = vec4(\n                  xTexelR").concat(b,"C").concat(w,".xy, xTexelR").concat(b,"C").concat(w+2,".xy);\n              "),w+1<m&&(g+="\n                  xR".concat(b,"C").concat(w+1," = vec4(\n                    xTexelR").concat(b,"C").concat(w,".zw, xTexelR").concat(b,"C").concat(w+2,".zw);\n                "))),g+="}");w<m&&(g+="\n            vec4 wTexelR".concat(b,"C").concat(w," = getW(").concat(b,", ").concat(w,", d1, q);\n            wR").concat(b,"C").concat(w," = vec4(wTexelR").concat(b,"C").concat(w,".xz, wTexelR").concat(b,"C").concat(w,".xz);\n          "),w+1<m&&(g+="\n              vec4 wTexelR".concat(b,"C").concat(w+1," = getW(").concat(b,", ").concat(w+1,", d1, q);\n              wR").concat(b,"C").concat(w+1," =\n                vec4(wTexelR").concat(b,"C").concat(w+1,".xz, wTexelR").concat(b,"C").concat(w+1,".xz);")))}for(var C=0;C<p;C++)for(var S=0;S<m;S++)g+="dotProd += xR".concat(C,"C").concat(S," * wR").concat(C,"C").concat(S,";");var T="",A="";a&&(T=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(a,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(a,"\n        }"),A="result = activation(result);");var E=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      ".concat(T,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(h,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(c,");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ").concat(g,"\n\n        vec4 result = dotProd;\n        ").concat(E,"\n        ").concat(A,"\n        setOutput(result);\n      }\n    ")},hT=function e(t,n,r,a,i){_classCallCheck2(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=_slicedToArray2(t,4),s=o[0],u=o[1],c=o[2],l=o[3],h=_slicedToArray2(n,1)[0],f=_slicedToArray2(r,2),d=f[0],p=f[1];this.outputShape=[h,d,p,l];var m="bilinear"===a?1:0,v=u-1+".0",g=c-1+".0",y=_slicedToArray2(d>1?[""+(u-1)/(d-1),"(y2-y1) * height_ratio","y1*".concat(v," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * "+v],3),_=y[0],b=y[1],k=y[2],w=_slicedToArray2(p>1?[""+(c-1)/(p-1),"(x2-x1) * width_ratio","x1*".concat(g," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * "+g],3),x=w[0],C=w[1],S=w[2];this.userCode="\n      const float height_ratio = float(".concat(_,");\n      const float width_ratio = float(").concat(x,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(b,";\n        float width_scale = ").concat(C,";\n\n        float in_y = ").concat(k,";\n        if( in_y < 0.0 || in_y > ").concat(v," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(S,";\n        if( in_x < 0.0 || in_x > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(m," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")},fT=function(){function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=t;var a=t.length,i=n?"0.0":"getX(".concat(dT(a,"coords"),")"),o=t[t.length-1],s="",u="";n?(s=r?"end != "+(o-1):"end != 0",u=r?"end + 1":"end - 1"):(s=r?"end + pow2 < "+o:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode="\n      uniform float index;\n      void main() {\n        ".concat(qS(a)," coords = getOutputCoords();\n        int end = ").concat(pT(a,"coords"),";\n        float val = ").concat(i,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(s,") {\n          int idx = ").concat(u,";\n          ").concat(pT(a,"coords")," = idx;\n          val += getX(").concat(dT(a,"coords"),");\n        }\n        setOutput(val);\n      }\n    ")}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.index&&(t.index=n.getUniformLocation(r,"index")),n.gl.uniform1f(t.index,e)}}}]),e}();function dT(e,t){if(1===e)return""+t;if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}function pT(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}var mT=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=PC.DENSE;var n=VC(t),r=OS();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(NS(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")},vT=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=PC.DENSE;var n=VC(t),r=OS();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(NS(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")},gT=function(){function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return _createClass2(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}(),yT=function e(t){_classCallCheck2(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},_T=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.outTexUsage=FC.DOWNLOAD;var n=OS();this.outputShape=t,this.userCode="\n      ".concat(PS,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},bT=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=FC.DOWNLOAD;var n=OS();this.outputShape=t,this.userCode="\n      ".concat(PS,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")},kT=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck2(this,e),this.variableNames=["A"];var a=OS(),i=_slicedToArray2(n,2),o=i[0],s=i[1];this.outputShape=t;var u="result";r&&(u="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(DS(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ").concat(s,";\n        int c = imod(flatIndex, ").concat(s,");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n        vec4 values = ").concat(a.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(a.output," = vec4(").concat(u,", 0., 0., 0.);\n      }\n    ")},wT=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var a=OS(),i=_slicedToArray2(n,2),o=i[0],s=i[1];this.outputShape=t;var u="",c="result";r&&(c="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var h=0;h<=1;h++){var f=2*l+h;u+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(h," < ").concat(t[2],") {\n            localCoords[2] += ").concat(h,";\n            if(localCoords[1] + ").concat(l," < ").concat(t[1],") {\n              localCoords[1] += ").concat(l,";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ").concat(s,";\n              c = imod(flatIndex, ").concat(s,");\n              uv = (vec2(c, r) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n              values = ").concat(a.texture2D,"(A, uv);\n\n              if(offset == 0) {\n                result[").concat(f,"] = values[0];\n              } else if(offset == 1) {\n                result[").concat(f,"] = values[1];\n              } else if(offset == 2) {\n                result[").concat(f,"] = values[2];\n              } else {\n                result[").concat(f,"] = values[3];\n              }\n            }\n          }\n        ")}this.userCode="\n      ".concat(DS(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ").concat(u,"\n\n        ").concat(a.output," = ").concat(c,";\n      }\n    ")},xT=function(){function e(t,n){_classCallCheck2(this,e),this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}}}]),e}(),CT=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["A","indices"];var a=t.slice();a[r]=n,this.outputShape=a,this.rank=a.length;var i=qS(this.rank),o=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank ".concat(n," is not yet supported"));if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],i=0;i<e.length;i++)a.push(i===t?"int(getIndices(".concat(r[i],"))"):""+r[i]);return a.join()}(t,r);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")},ST=function e(t,n,r){_classCallCheck2(this,e),this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=r;var a=qS(n.length),i=qS(r.length);this.userCode="\n        ".concat(a," strides = ").concat(a,"(").concat(this.strides,");\n         void main() {\n          ").concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ").concat(this.sliceDim>1?"strides[j]":"strides",";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      ")};function TT(e,t,n,r,a,i){!function(e,t){var n=ze().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] is invalid."));if(e>n||t>n)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] greater than WebGL maximum on this browser / GPU [").concat(n,"x").concat(n,"]."))}(t,n);var o=function(e){return tS(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return WC(e,(function(){return e.bindTexture(s,o)})),WC(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),WC(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),WC(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),WC(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),WC(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})),WC(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),o}function AT(e){return e.internalFormatFloat}function ET(e){return e.internalFormatHalfFloat}function IT(e){return e.downloadTextureFormat}function RT(e){return e.internalFormatPackedFloat}function OT(e){return e.internalFormatPackedHalfFloat}var NT=function(){function e(t){_classCallCheck2(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=ze().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(e,t){LC[e]=t}(n,t)):this.gl=BC(n);var r="WEBGL_color_buffer_float";if(1===ze().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=HC(this.gl,"OES_texture_float"),sS(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=HC(this.gl,"OES_texture_half_float");else if(ze().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),sS(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=HC(this.gl,"EXT_color_buffer_half_float");else if(ze().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",sS(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!sS(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=function(e){return function(e,t){var n=tS(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return WC(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),WC(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(e){return function(e,t){var n=tS(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return WC(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),WC(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(e){return tS(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=UC(this.gl,this.textureHalfFloatExtension)}var t;return _createClass2(e,[{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;WC(t,(function(){return t.finish()})),WC(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),WC(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),WC(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),WC(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),WC(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray2(jC(t,n),2);return TT(e,a[0],a[1],AT(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray2(jC(t,n),2);return TT(e,a[0],a[1],ET(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray2(jC(t,n),2);return TT(e,a[0],a[1],IT(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){WC(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?WC(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):WC(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),WC(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;WC(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),WC(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),WC(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray2(qC(t,n),2);return TT(e,a[0],a[1],OT(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=_slicedToArray2(qC(t,n),2);return TT(e,a[0],a[1],RT(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&($C(this.gl,this.framebuffer),this.outputTexture=null),WC(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=_slicedToArray2(jC(t,n),2),i=a[0],o=a[1],s=new Uint8Array(t*n*4);return WC(e,(function(){return e.readPixels(0,0,i,o,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)})),new Float32Array(s.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return function(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=_slicedToArray2(qC(e,t),2);return n[0]*n[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}(this.gl,e,0,0,0,a,i)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();WC(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return WC(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),WC(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),WC(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(ze().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else ze().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,ze().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return WC(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){this.throwIfDisposed();var t=this.gl,n=function(e,t){var n=tS(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(WC(e,(function(){return e.shaderSource(n,t)})),WC(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){var n=QC.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var a=+n[1],i=e.split("\n"),o=i.length.toString().length+2,s=i.map((function(e,t){return r.rightPad((t+1).toString(),o)+e})),u=0,c=0;c<s.length;c++)u=Math.max(s[c].length,u);var l=s.slice(0,a-1),h=s.slice(a-1,a),f=s.slice(a);console.log(l.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+r.rightPad(h[0],u),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(t,e),a=function(e){var t=OS();return function(e,t){var n=tS(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(WC(e,(function(){return e.shaderSource(n,t)})),WC(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}(t),i=function(e){return tS(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(t);return WC(t,(function(){return t.attachShader(i,a)})),WC(t,(function(){return t.attachShader(i,n)})),function(e,t){if(WC(e,(function(){return e.linkProgram(t)})),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,i),this.debug&&YC(t,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=function(e,t,n){return WC(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),ZC(e,t,"clipSpacePos",n,3,20,0)&&ZC(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),i}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&WC(this.gl,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&YC(this.gl,this.program),WC(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return tS(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),WC(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r){WC(e,(function(){return function(e,t,n){(function(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE".concat(n,"]."))})(e,n),WC(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),WC(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),WC(e,(function(){return e.uniform1i(n,r)}))}(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=_slicedToArray2(qC(t,n),2),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&YC(this.gl,this.program),eS(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),WC(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),WC(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=HC(this.gl,2===ze().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===ze().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==ze().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.repeatedTry((function(){return n.disposed||n.isQueryAvailable(t,ze().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,ze().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||r.repeatedTry((function(){return n.pollItems(),0===n.itemsToPoll.length}))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),JC(this.gl,e,this.framebuffer),this.debug&&eS(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(JC(this.gl,this.outputTexture,this.framebuffer),this.debug&&eS(this.gl)):$C(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;JC(r,e,this.framebuffer),this.debug&&eS(r),this.outputTexture=e,WC(r,(function(){return r.viewport(0,0,t,n)})),WC(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),WC(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}},{key:"debug",get:function(){return ze().getBool("DEBUG")}}]),e}();function DT(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach((function(e,n){var a=e.logicalShape,i=t[n],o=i.shape;if(!r.arraysEqual(a,o))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(a," and ").concat(o," must match"));if(!e.isUniform||!i.isUniform){var s=e.texShape,u=i.isUniform?null:i.texData.texShape;if(!r.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(s," and ").concat(u," must match"))}}))}var PT=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var a=r.filterWidth,i=r.inChannels,o=r.strideWidth,s=r.strideHeight,u=r.padInfo,c=r.outWidth,l=r.dilationWidth,h=r.dilationHeight,f=r.dataFormat,d=u.left,p=u.top,m=i*a,v=OS(),g="channelsLast"===f,y=g?0:1,_=g?1:2,b="",k=0;k<=1;k++)for(var w=0;w<=1;w++)b+="\n          blockIndex = rc.y + ".concat(w,";\n          pos = rc.x + ").concat(k,";\n\n          if(blockIndex < ").concat(t[1]," && pos < ").concat(t[0],") {\n            offsetY = int(blockIndex / (").concat(c,")) * ").concat(s," - ").concat(p,";\n            d0 = offsetY + ").concat(h," * (pos / ").concat(m,");\n\n            if(d0 < ").concat(n[y]," && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ").concat(c,".) * ").concat(o,". - ").concat(d,".);\n              d1 = offsetX + ").concat(l," * (int(mod(float(pos), ").concat(m,".) / ").concat(i,".));\n\n              if(d1 < ").concat(n[_]," && d1 >= 0) {\n\n                ch = int(mod(float(pos), ").concat(i,".));\n\n                if (").concat(g,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*k+w,"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*k+w,"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(b,"\n\n        ").concat(v.output," = result;\n      }\n    ")},FT=function e(t,n,r,a,i){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")},MT=function e(t,n,r,a,i){_classCallCheck2(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")},LT=function e(t,n,r,a,i){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")},zT=function e(t){_classCallCheck2(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.effectiveFilterHeight,r=t.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2(".concat(n-1-t.padInfo.top,", ").concat(r-1-t.padInfo.left,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,";\n          wR += ").concat(t.dilationHeight,") {\n          float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(n*r-1," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(r," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},BT=function e(t){_classCallCheck2(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.effectiveFilterDepth,r=t.effectiveFilterHeight,a=t.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3(".concat(n-1-t.padInfo.front,", ").concat(r-1-t.padInfo.top,", ").concat(a-1-t.padInfo.left,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(n,";\n           wD += ").concat(t.dilationDepth,") {\n          float dyD = float(dyDCorner + wD) / ").concat(t.strideDepth,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(r,";\n              wR += ").concat(t.dilationHeight,") {\n            float dyR = float(dyRCorner + wR) / ").concat(t.strideHeight,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(a,";\n                wC += ").concat(t.dilationWidth,") {\n              float dyC = float(dyCCorner + wC) / ").concat(t.strideWidth,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(n*r*a-1," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(r," * ").concat(a," +\n                  wR * ").concat(a," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")},jT=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7];_classCallCheck2(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;var c=Math.ceil((a?t[1]:t[2])/2),l=a?"i * 2, rc.y":"rc.y, i * 2",h=i?"rc.z, i * 2":"i * 2, rc.z",f=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",m="";s&&(p=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),m="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights");var g="rc.x",y="rc.x";t[0]<n[0]?g="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(y="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(p,"\n\n      const float sharedDimension = ").concat(c,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(c,"; i++) {\n          int batchA = ").concat(g,";\n          int batchB = ").concat(y,";\n          vec4 a = getMatrixA(batchA, ").concat(l,");\n          vec4 b = getMatrixB(batchB, ").concat(h,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(f[0]," * ").concat(d[0],");\n          result += (").concat(f[1]," * ").concat(d[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(v,"\n\n        ").concat(m,"\n\n        setOutput(result);\n      }\n    ")},VT=function(){function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["probs"],this.outputShape=[t,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}}}]),e}(),qT=function e(t,n,r,a){_classCallCheck2(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")},UT=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var n=t.length;if(0===n)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var r=RS("rc",n),a=qS(n),i=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",a=e-2;a<e;a++)r+="".concat(n[a]," >= ").concat(t[a]),a<e-1&&(r+="||");return r}(n,t,r),o=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = ".concat(a[0],";\n    int c = ").concat(a[1],";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ").concat(t,";\n    bool rEdge = rp1 >= ").concat(n,";\n  ")}(n,t[t.length-1],t[t.length-2],r),s=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i="".concat(0===r?"r":"rp1",", ").concat(0===a?"c":"cp1"),o=2;o<e;o++)i=t[t.length-1-o]+","+i;n.push(i)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= ".concat(e[0]," ? 0. : getA(rc + 1),\n            0, 0"):"getA(".concat(r[0],"),\n          cEdge ? 0. : getA(").concat(r[1],"),\n          rEdge ? 0. : getA(").concat(r[2],"),\n          rEdge || cEdge ? 0. : getA(").concat(r[3],")")}(t,r);this.userCode="\n        void main() {\n          ".concat(a," rc = getOutputCoords();\n\n          if(").concat(i,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(o,"\n\n            setOutput(vec4(").concat(s,"));\n          }\n        }\n      ")}},WT=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=qS(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float(").concat(r,"));\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float(").concat(r,"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")},GT=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=qS(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=RS("rc",a),c=RS("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),f=[i+" rc = outputLoc;","".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],d=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",m=0,v=1===a?2:4;m<v;m++)p+="\n        ".concat(f[m],"\n        if (").concat(d,") {\n          result[").concat(m,"] = float(").concat(r,");\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ");p+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")},HT=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck2(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,v="0.0";if(m||(v="-1.0 / 1e-20"),r)this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?"((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"):"(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"):"wR * ".concat(f," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ");else{var g="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(g="avgValue / count");var y=4*Math.floor(o/4),_=o%4,b="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n      const float initializationValue = ").concat(v,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(v,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(y,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(b,"\n          }\n\n          int xC = xCCorner + ").concat(y,";\n          if (").concat(1===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(b,"\n          } else if (").concat(2===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(b,"\n          } else if (").concat(3===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(b,"\n          }\n        }\n        setOutput(").concat(g,");\n      }\n    ")}},KT=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(_classCallCheck2(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,h=t.dilationHeight,f=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,m=t.effectiveFilterWidth,v=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var _="avg"===n,b="0.0";if(_||(b="-1.0 / 1e-20"),r)this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(p,";\n                wR += ").concat(h,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(f,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(p," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ");else{var k="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(k="avgValue / count");var w=4*Math.floor(o/4),x=o%4,C="\n      if (".concat(_,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(b,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(b,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(h,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(f,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(f,", ch)\n              );\n\n              ").concat(C,"\n            }\n\n            int xC = xCCorner + ").concat(w,";\n            if (").concat(1===x,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(C,"\n            } else if (").concat(2===x,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(C,"\n            } else if (").concat(3===x,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                initializationValue\n              );\n\n              ").concat(C,"\n            }\n          }\n          setOutput(").concat(k,");\n        }\n      }\n    ")}},XT=function e(t,n){_classCallCheck2(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),h=r%4,f="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n      }\n    "),d="vec4";"all"===n?(s="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===n&&(s="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(f,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(2===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(3===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(f,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")},QT=function e(t,n){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r,a="",i=0;i<4;i++){var o="thisRC = rc;";i%2==1&&(o+="thisRC.z += 1;"),i>1&&(o+="thisRC.y += 1;"),a+="\n        ".concat(o,"\n        ").concat(i>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(i,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(i>0?"}":"","\n      ")}this.userCode="\n      ".concat((r=n,"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(NS(["r","c","d"],r),"\n      return ivec3(r, c, d);\n    }\n  ")),"\n      ").concat(DS(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(t[1],";\n        int cols = ").concat(t[2],";\n\n        ").concat(a,"\n\n        setOutput(result);\n      }\n    ")},YT=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var a=_slicedToArray2(n.shape,3),i=a[1],o=a[2],s=_slicedToArray2(t.shape,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],f=l[0]/h[0],d=l[1]/h[1],p=1/f,m=1/d,v=2*Math.ceil(p)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(p,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},ZT=function e(t,n,r,a){_classCallCheck2(this,e),this.variableNames=["A"],this.outputShape=[];var i=_slicedToArray2(t,4),o=i[0],s=i[1],u=i[2],c=i[3];this.outputShape=[o,n,r,c];var l=[a&&n>1?s-1:s,a&&r>1?u-1:u],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/h[0],",\n          ").concat(l[1]/h[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(u,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")},JT=function e(t,n,r,a){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=_slicedToArray2(t,4),o=i[0],s=i[1],u=i[2],c=i[3];this.outputShape=[o,n,r,c];var l=[a&&n>1?s-1:s,a&&r>1?u-1:u],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(l[0]/h[0],",\n          ").concat(l[1]/h[1],",\n          ").concat(l[1]/h[1],");\n      const vec3 inputShapeRC = vec3(").concat(s,".0, ").concat(u,".0,\n                                     ").concat(u,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(c-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")},$T=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var a=_slicedToArray2(n.shape,3),i=a[1],o=a[2],s=_slicedToArray2(t.shape,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],f=l[0]/h[0],d=l[1]/h[1],p=1/f,m=1/d,v=2*Math.ceil(p)+2,g=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(d,");\n\n        const float invHeightScale = float(").concat(p,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(v,");\n        const int winWidth = int(").concat(g,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(h[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(h[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")},eA=function e(t,n,r,a){_classCallCheck2(this,e),this.variableNames=["A"],this.outputShape=[];var i=_slicedToArray2(t,4),o=i[0],s=i[1],u=i[2],c=i[3];this.outputShape=[o,n,r,c];var l=[a&&n>1?s-1:s,a&&r>1?u-1:u],h=[a&&n>1?n-1:n,a&&r>1?r-1:r];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(l[0]/h[0],",\n          ").concat(l[1]/h[1],");\n      const vec2 inputShapeRC = vec2(").concat(s,".0, ").concat(u,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(a?"0.5":"0.0",")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")},tA=function e(t,n){_classCallCheck2(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=qS(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")},nA=function e(t,n){_classCallCheck2(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=RS("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=qS(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):""+r[e]}(a,e)}));return"getChannel(getX(".concat(r.join(","),"), vec2(").concat(r.slice(-2).join(","),"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")},rA=function e(t,n,r,a,i,o){!(arguments.length>6&&void 0!==arguments[6])||arguments[6];_classCallCheck2(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=qS(i.length),u=qS(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="";1===a?l="i":2===a&&(l="i, coords[1]"),this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(getIndices(").concat(c,"));\n              flattenedIndex += index * ").concat(n>1?"strides[j]":"strides",";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates(").concat(l,");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")},aA=function e(t,n){_classCallCheck2(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ".concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(f,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")},iA=function e(t,n,r){var a,i;if(_classCallCheck2(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push(""+o[c]),c<t&&s.push(""+o[c]);a=s.join(),i=u.join()}var l=qS(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")},oA=function(){function e(t){_classCallCheck2(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=qS(this.rank),a="uniform int start[".concat(this.rank,"];"),i=function(e){if(1===e)return"sourceLoc";if(e<=6)return sA.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank);n="\n        ".concat(r," sourceLoc;\n        ").concat(r," coords = getOutputCoords();\n        ").concat(t.map((function(e,t){return"sourceLoc.".concat(sA[t]," = start[").concat(t,"] + coords.").concat(sA[t],";")})).join("\n"),"\n      "),this.userCode="\n      ".concat(a,"\n      void main() {\n        ").concat(n,"\n        setOutput(getSource(").concat(i,"));\n      }\n    ")}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the length of start (").concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}(),sA=["x","y","z","w","u","v"],uA=function(){function e(t){_classCallCheck2(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=qS(this.rank),r=RS("coords",this.rank),a=RS("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      uniform int start[".concat(this.rank,"];\n      void main() {\n        ").concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}return _createClass2(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the length of start (").concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}(),cA=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=qS(r.length),o=qS(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")},lA=function(){function e(t){_classCallCheck2(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return _createClass2(e,[{key:"acquireTexture",value:function(e,t,n){var r=fA(t,n),a=dA(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=hA(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===MC.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===MC.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===MC.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===MC.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===MC.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=fA(n,r),i=dA(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=hA(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=ze().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(this.numFreeTextures+this.numUsedTextures,")"));var e=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: "+this._numBytesAllocated),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*e),"%)"))}}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}}]),e}();function hA(e,t,n,r,a){var i,o=function(e,t){switch(e){case MC.PACKED_2X2_FLOAT32:return RT(t);case MC.PACKED_2X2_FLOAT16:return OT(t);case MC.UNPACKED_FLOAT32:return AT(t);case MC.UNPACKED_FLOAT16:return ET(t);case MC.PACKED_4X1_UNSIGNED_BYTE:return IT(t);default:throw new Error("Unknown physical texture type "+e)}}(t,r);if(a){var s=_slicedToArray2(qC(e[0],e[1]),2);i=s[0]*s[1]}else{var u=_slicedToArray2(jC(e[0],e[1]),2);i=u[0]*u[1]}return i*function(e,t){if(t===e.R32F)return 4;if(t===e.R16F)return 2;if(t===e.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===e.RGBA16F)return 8;throw new Error("Unknown internal format "+t)}(n,o)}function fA(e,t){if(e===FC.UPLOAD)return MC.PACKED_2X2_FLOAT32;if(e===FC.RENDER||null==e)return function(e){return ze().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?MC.PACKED_2X2_FLOAT32:MC.UNPACKED_FLOAT32:e?MC.PACKED_2X2_FLOAT16:MC.UNPACKED_FLOAT16}(t);if(e===FC.DOWNLOAD||e===FC.PIXELS)return MC.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function dA(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var pA=function e(t,n){_classCallCheck2(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=qS(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")},mA=function e(t,n){_classCallCheck2(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},vA="return abs(x);",gA="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",yA="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",_A="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(v.SELU_SCALEALPHA,";\n  float scale = ").concat(v.SELU_SCALE,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n"),bA="return -x;",kA="return ceil(x);",wA="return floor(x);",xA="return exp(x);",CA="return exp(x) - 1.0;",SA='\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(v.ERF_P,";\n  float a1 = ").concat(v.ERF_A1,";\n  float a2 = ").concat(v.ERF_A2,";\n  float a3 = ").concat(v.ERF_A3,";\n  float a4 = ").concat(v.ERF_A4,";\n  float a5 = ").concat(v.ERF_A5,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n"),TA="return x;",AA="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",EA="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",IA="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",RA=function e(t,n){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")},OA=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var n=t.length,r=RS("rc",n),a=qS(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")},NA=v.segment_util,DA=g.split,PA=g.tile,FA=g.topkImpl,MA=g.whereImpl,LA={};function zA(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return"return x;";if("relu"===e)return t?AA:gA;if("elu"===e)return t?IA:"return (x >= 0.0) ? x : (exp(x) - 1.0);";if("relu6"===e)return t?EA:yA;if("prelu"===e)return t?YS:XS;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var BA=function(e){_inherits(o,e);var t,n,a,i=_createSuper(o);function o(e){var t,n;if(_classCallCheck2(this,o),(t=i.call(this)).pendingRead=new WeakMap,t.pendingDisposal=new WeakSet,t.dataRefCount=new WeakMap,t.numBytesInGPU=0,t.uploadWaitMs=0,t.downloadWaitMs=0,t.warnedAboutMemory=!1,t.warnedAboutCPUBackend=!1,t.pendingDeletes=0,t.disposed=!1,!ze().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var r=BC(ze().getNumber("WEBGL_VERSION"));t.binaryCache=((n=ze().getNumber("WEBGL_VERSION"))in LA||(LA[n]={}),LA[n]),t.gpgpu=new NT(r),t.canvas=r.canvas,t.gpgpuCreatedLocally=!0}else t.gpgpu=e,t.binaryCache={},t.gpgpuCreatedLocally=!1,t.canvas=e.gl.canvas;return t.textureManager=new lA(t.gpgpu),t.numMBBeforeWarning=null==ze().global.screen?1024:ze().global.screen.height*ze().global.screen.width*window.devicePixelRatio*600/1024/1024,t.texData=new U(_assertThisInitialized(t),aa()),_possibleConstructorReturn(t)}return _createClass2(o,[{key:"numDataIds",value:function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}},{key:"write",value:function(e,t,n){if((ze().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ze().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:FC.UPLOAD,refCount:1,complexParentRefCount:0}),r}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r){if(ze().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:FC.UPLOAD,refCount:1,complexParentRefCount:0})}},{key:"disposeIntermediateTensorInfo",value:function(e){var t=e.dataId;if(this.texData.has(t)){var n=this.texData.get(t);n.refCount--,n.refCount<1&&this.disposeData(t)}}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,a=t.dtype,i=t.complexTensorInfos,o=t.slice,s=t.shape,u=t.isPacked;if(null!=o){var c;c=u?new RA(s,TA):new mA(s,TA);var l=this.runWebGLProgram(c,[{dataId:e,shape:s,dtype:a}],a),h=this.readSync(l.dataId);return this.disposeIntermediateTensorInfo(l),h}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===a)return n;var f,d,p=null!=this.activeTimers;if(p&&(f=r.now()),"complex64"===a){var m=this.readSync(i.real.dataId),g=this.readSync(i.imag.dataId);d=v.mergeRealAndImagArrays(m,g)}else d=this.getValuesFromTexture(e);return p&&(this.downloadWaitMs+=r.now()-f),this.convertAndCacheOnCPU(e,d)}},{key:"read",value:(a=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,u,c,l,h,f,d,p,m,g,y,_,b,k,w,x;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.complexTensorInfos,l=a.isPacked,null==s){e.next=8;break}return h=l?new RA(o,TA):new mA(o,TA),f=this.runWebGLProgram(h,[{dataId:t,shape:o,dtype:u}],u),d=this.read(f.dataId),e.abrupt("return",(this.disposeIntermediateTensorInfo(f),d));case 8:if(null==i){e.next=10;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 10:if(ze().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==ze().getNumber("WEBGL_VERSION")){e.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(g=null,"complex64"!==u&&ze().get("WEBGL_BUFFER_SUPPORTED")&&(p=this.decode(t),_=this.texData.get(p.dataId),g=(y=this.gpgpu).createBufferFromTexture.apply(y,[_.texture].concat(_toConsumableArray(VC(o))))),this.pendingRead.set(t,[]),e.t0="complex64"!==u,!e.t0){e.next=19;break}return e.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==u){e.next=26;break}return e.next=22,Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)]);case 22:b=e.sent,m=v.mergeRealAndImagArrays(b[0],b[1]),e.next=27;break;case 26:null==g?m=this.getValuesFromTexture(t):(k=r.sizeFromShape(o),m=this.gpgpu.downloadFloat32MatrixFromBuffer(g,k));case 27:return null!=p&&this.disposeIntermediateTensorInfo(p),w=this.convertAndCacheOnCPU(t,m),x=this.pendingRead.get(t),e.abrupt("return",(this.pendingRead.delete(t),x.forEach((function(e){return e(w)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),w));case 30:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!GC(n)){if(ze().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"));throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,a=t.dtype,i=t.isPacked,o=r.sizeFromShape(n);if(ze().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s,u=this.decode(e),c=this.texData.get(u.dataId),l=(s=this.gpgpu).downloadMatrixFromPackedTexture.apply(s,[c.texture].concat(_toConsumableArray(VC(n)))).subarray(0,o);return this.disposeIntermediateTensorInfo(u),l}var h=ze().getBool("WEBGL_PACK")&&!0===i,f=h?aS(n):n,d=h?new bT(f):new _T(f),p=this.runWebGLProgram(d,[{shape:f,dtype:a,dataId:e}],"float32"),m=this.texData.get(p.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(p),v}},{key:"time",value:(n=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var n,a,i,o,s,u,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.activeTimers,a=[],i=!1,null==this.programTimersStack?(this.programTimersStack=a,i=!0):this.activeTimers.push(a),this.activeTimers=a,t(),o=r.flatten(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),s=r.flatten(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=n,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},!(ze().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=13;break}return e.next=9,Promise.all(o);case 9:c=e.sent,u.kernelMs=r.sum(c),u.getExtraProfileInfo=function(){return c.map((function(e,t){return{name:s[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=14;break;case 13:u.kernelMs={error:"WebGL query timers are not supported in this environment."};case 14:return e.abrupt("return",(this.uploadWaitMs=0,this.downloadWaitMs=0,u));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return ze().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:r.now(),endMs:null}}},{key:"endTimer",value:function(e){return ze().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=r.now(),e)}},{key:"getQueryTime",value:(t=_asyncToGenerator(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ze().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.waitForQueryAndGetTime(t):t.endMs-t.startMs);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"disposeData",value:function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e))if(this.texData.get(e).complexParentRefCount>0)this.texData.get(e).refCount--;else{this.releaseGPUData(e);var t=this.texData.get(e).complexTensorInfos;null!=t&&(this.texData.get(t.real.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.real),this.texData.get(t.imag.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.imag)),this.texData.delete(e)}}}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"getCPUBackend",value:function(){return ze().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=aa().findBackend("cpu")),this.cpuBackend):null}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128,a=this.getCPUBackend();return this.warnedAboutCPUBackend||null!=a||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=a&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&r.sizeFromShape(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"slice",value:function(e,t,n){if(this.shouldExecuteOnCPU([e])){var a=wS(this.texData.get(e.dataId).values,t,n,e.shape,e.dtype);return this.makeOutput(n,e.dtype,a)}if(0===r.sizeFromShape(n))return Xt([],n,e.dtype);var i=this.texData.get(e.dataId).isPacked,o=h.isSliceContinous(e.shape,t,n);if(i||!o){var s=ze().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uA(n):new oA(n),u=s.getCustomSetupFunc(t);return this.compileAndRun(s,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)}},{key:"shallowSlice",value:function(e,t,n){var r=this.texData.get(e.dataId),a=this.makeOutput(n,e.dtype),i=this.texData.get(a.dataId);Object.assign(i,r),i.shape=n,i.dtype=e.dtype;var o=h.computeFlatOffset(t,e.strides);r.slice&&(o+=r.slice.flatOffset),i.slice={flatOffset:o,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,s+1),a}},{key:"stridedSlice",value:function(e,t,n,r){var a=this,i=this.tryRunOnCpuOrThrow([e],(function(){return a.cpuBackend.stridedSlice(e,t,n,r)}));if(i)return i;var o=h.computeOutShape(t,n,r);if(o.some((function(e){return 0===e})))return Xt([],o);var s=new cA(t,r,o);return this.compileAndRun(s,[e])}},{key:"reverse",value:function(e,t){var n=ze().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nA(e.shape,t):new tA(e.shape,t);return this.compileAndRun(n,[e])}},{key:"neg",value:function(e){var t=this,n=this.tryRunOnCpuOrThrow([e],(function(){return t.cpuBackend.neg(e)}));if(n)return n;if(ze().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,bA,e.dtype);var r=new mA(e.shape,bA);return this.compileAndRun(r,[e])}},{key:"batchMatMul",value:function(e,t,n,r){var a=n?e.shape[2]:e.shape[1],i=r?t.shape[1]:t.shape[2],o=n?e.shape[1]:e.shape[2],s=Math.max(e.shape[0],t.shape[0]);if((1===a||1===i)&&o>1e3){n&&(e=mr(e,[0,2,1])),r&&(t=mr(t,[0,2,1]));var u=1===i?e:e.as3D(s,o,1),c=1===i?2:1,l=1===i?t.as3D(s,1,o):t;return xa(u,l).sum(c,!0)}var h=At(e.dtype,t.dtype),f=new jT(e.shape,t.shape,[s,a,i],n,r);return this.compileAndRun(f,[e,t],h)}},{key:"fusedBatchMatMul",value:function(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.bias,o=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],c=a?n.shape[1]:n.shape[2],l=Math.max(t.shape[0],n.shape[0]),h=At(t.dtype,n.dtype),f=null!=i,d=null!=s,p=o?zA(o,!0):null,m=new jT(t.shape,n.shape,[l,u,c],r,a,f,p,d),v=[t,n];return i&&v.push(i),s&&v.push(s),this.compileAndRun(m,v,h)}},{key:"localResponseNormalization4D",value:function(e,t,n,r,a){var i=ze().getBool("WEBGL_PACK_NORMALIZATION")?new LT(e.shape,t,n,r,a):new FT(e.shape,t,n,r,a);return this.compileAndRun(i,[e])}},{key:"LRNGrad",value:function(e,t,n,r,a,i,o){var s=new MT(t.shape,r,a,i,o);return this.compileAndRun(s,[t,n,e])}},{key:"tile",value:function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return r.decodeString(e)})),a=qn(e.shape,e.dtype,n);return PA(a,t)}var i=new pA(e.shape,t);return this.compileAndRun(i,[e])}},{key:"pad",value:function(e,t,n){var r=ze().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new GT(e.shape,t,n):new WT(e.shape,t,n);return this.compileAndRun(r,[e])}},{key:"gather",value:function(e,t,n){var r=this,a=this.tryRunOnCpuOrThrow([e,t],(function(){return r.cpuBackend.gather(e,t,n)}));if(a)return a;var i=new CT(e.shape,t.size,n);return this.compileAndRun(i,[e,t])}},{key:"batchToSpaceND",value:function(e,t,n){r.assert(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var a=t.reduce((function(e,t){return e*t})),i=v.getReshaped(e.shape,t,a),o=v.getPermuted(i.length,t.length),s=v.getReshapedPermuted(e.shape,t,a),u=v.getSliceBeginCoords(n,t.length),c=v.getSliceSize(s,n,t.length);return mr(e.reshape(i),o).reshape(s).slice(u,c)}},{key:"spaceToBatchND",value:function(e,t,n){r.assert(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var a=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,_toConsumableArray(n));for(var o=1+t.length;o<e.shape.length;++o)i.push([0,0]);var s=e.pad(i),u=v.getReshaped(s.shape,t,a,!1),c=v.getPermuted(u.length,t.length,!1),l=v.getReshapedPermuted(s.shape,t,a,!1),h=mr(s.reshape(u),c);return fr(h,l)}},{key:"reduce",value:function(e,t,n){var r=e.shape[0],a=e.shape[1],i=v.computeOptimalWindowSize(a),o=Math.ceil(a/i),s=new XT({windowSize:i,inSize:a,batchSize:r,outSize:o},t),u=this.compileAndRun(s,[e],n);return 1===u.shape[1]?u:this.reduce(u,t,n)}},{key:"argReduce",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=e.shape[0],a=e.shape[1];null!=n&&(r=n.shape[0],a=n.shape[1]);var i=v.computeOptimalWindowSize(a),o={windowSize:i,inSize:a,batchSize:r,outSize:Math.ceil(a/i)},s=new ES(o,t,null==n),u=[e];null!=n&&u.push(n);var c=this.compileAndRun(s,u,"int32");return 1===c.shape[1]?c:this.argReduce(e,t,c)}},{key:"argReducePacked",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=null!=n?n.shape:e.shape,a=v.computeOptimalWindowSize(r[r.length-1]),i=new GS(r,a,t,null==n),o=this.compileAndRun(i,null==n?[e]:[e,n],"int32");return o.rank===e.rank?this.argReducePacked(e,t,o):o}},{key:"sum",value:function(e,t){v.assertAxesAreInnerMostDims("sum",t,e.rank);var n=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=r.sizeFromShape(i),s=e.as2D(-1,o),u=Et(e.dtype);return this.reduce(s,"sum",u).reshape(a)}},{key:"prod",value:function(e,t){var n=this,a=this.tryRunOnCpuOrThrow([e],(function(){return n.cpuBackend.prod(e,t)}));if(a)return a;var i=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,t),2),o=i[0],s=i[1],u=r.sizeFromShape(s),c=e.as2D(-1,u),l=Et(e.dtype);return this.reduce(c,"prod",l).reshape(o)}},{key:"unsortedSegmentSum",value:function(e,t,n){var a=0,i=v.getAxesPermutation([a],e.rank),o=e;null!=i&&(o=mr(e,i),a=v.getInnerMostAxes(1,e.rank)[0]);var s=NA.computeOutShape(o.shape,a,n),u=r.sizeFromShape([o.shape[a]]),c=o.as2D(-1,u),l=Et(e.dtype),h=this.segOpCompute(c,"unsortedSegmentSum",t,l,n).reshape(s);return null!=i&&(h=mr(h,v.getUndoAxesPermutation(i))),h}},{key:"segOpCompute",value:function(e,t,n,r,a){var i=e.shape[0],o=e.shape[1],s=NA.segOpComputeOptimalWindowSize(o,a),u=new aA({windowSize:s,inSize:o,batchSize:i,numSegments:a},t),c=this.compileAndRun(u,[e,n],r);return c.shape[1]===a?c:(n=Ms(0,a).tile([o/s]),this.segOpCompute(c,t,n,r,a))}},{key:"argMinMaxReduce",value:function(e,t,n){var a=[t];if(v.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),a,e.rank),!ze().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,a),2),o=i[0],s=i[1],u=r.sizeFromShape(s),c=e.as2D(-1,u);return this.argReduce(c,n).reshape(o)}return this.argReducePacked(e,n)}},{key:"argMin",value:function(e,t){return this.argMinMaxReduce(e,t,"min")}},{key:"argMax",value:function(e,t){return this.argMinMaxReduce(e,t,"max")}},{key:"cumsum",value:function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis=".concat(e.rank-1," but got axis=")+t);for(var a=e.shape[t],i=e,o=0;o<=Math.ceil(Math.log2(a))-1;o++){var s=new fT(e.shape,!1,r),u=s.getCustomSetupFunc(o),c=i;i=this.compileAndRun(s,[i],i.dtype,u),c.dispose()}if(n){var l=new fT(e.shape,n,r),h=i;i=this.compileAndRun(l,[i]),h.dispose()}return i}},{key:"equal",value:function(e,t){if(ze().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new QS("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"less",value:function(e,t){var n=this,r=this.tryRunOnCpuOrThrow([e,t],(function(){return n.cpuBackend.less(e,t)}));if(r)return r;if(ze().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var a=new QS("return float(a < b);",e.shape,t.shape);return this.compileAndRun(a,[e,t],"bool")}},{key:"lessEqual",value:function(e,t){if(ze().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new QS("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"greater",value:function(e,t){var n=this,r=this.tryRunOnCpuOrThrow([e,t],(function(){return n.cpuBackend.greater(e,t)}));if(r)return r;if(ze().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var a=new QS("return float(a > b);",e.shape,t.shape);return this.compileAndRun(a,[e,t],"bool")}},{key:"greaterEqual",value:function(e,t){if(ze().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new QS("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"logicalNot",value:function(e){var t=new mA(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])}},{key:"logicalAnd",value:function(e,t){if(ze().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new QS("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"logicalOr",value:function(e,t){if(ze().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new QS("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")}},{key:"select",value:function(e,t,n){var r=new iA(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],At(t.dtype,n.dtype))}},{key:"where",value:function(e){v.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return MA(e.shape,t)}},{key:"topk",value:function(e,t,n){var r=e.dataSync();return FA(r,e.shape,e.dtype,t,n)}},{key:"min",value:function(e,t){v.assertAxesAreInnerMostDims("min",t,e.rank);var n=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=r.sizeFromShape(i),s=e.as2D(-1,o);return this.reduce(s,"min",s.dtype).reshape(a)}},{key:"minimum",value:function(e,t){var n=this,r=this.tryRunOnCpuOrThrow([e,t],(function(){return n.cpuBackend.minimum(e,t)}));if(r)return r;var a=ze().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ZS("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new QS("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(a,[e,t])}},{key:"mod",value:function(e,t){var n=ze().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ZS("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new QS("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])}},{key:"maximum",value:function(e,t){var n=this,r=this.tryRunOnCpuOrThrow([e,t],(function(){return n.cpuBackend.maximum(e,t)}));if(r)return r;var a=ze().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ZS("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new QS("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(a,[e,t])}},{key:"all",value:function(e,t){v.assertAxesAreInnerMostDims("all",t,e.rank);var n=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=r.sizeFromShape(i),s=e.as2D(-1,o);return this.reduce(s,"all",s.dtype).reshape(a)}},{key:"any",value:function(e,t){v.assertAxesAreInnerMostDims("any",t,e.rank);var n=_slicedToArray2(v.computeOutAndReduceShapes(e.shape,t),2),a=n[0],i=n[1],o=r.sizeFromShape(i),s=e.as2D(-1,o);return this.reduce(s,"any",s.dtype).reshape(a)}},{key:"floorDiv",value:function(e,t){if(ze().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new QS("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")}},{key:"packedUnaryOp",value:function(e,t,n){var r=new RA(e.shape,t);return this.compileAndRun(r,[e],n)}},{key:"packedBinaryOp",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=new ZS(n,e.shape,t.shape,a);return this.compileAndRun(i,[e,t],r)}},{key:"makeComplexComponentTensorInfo",value:function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}},{key:"addN",value:function(e){if(1===e.length)return e[0];if(e.length>ze().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var a=e.map((function(e){return e.dtype})).reduce((function(e,t){return At(e,t)})),i=e.map((function(e){return e.shape})),o=ze().getBool("WEBGL_PACK")?new AS(e[0].shape,i):new TS(e[0].shape,i);return this.compileAndRun(o,e,a)}},{key:"pow",value:function(e,t){var n=ze().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ZS("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new QS("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=At(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)}},{key:"ceil",value:function(e){if(this.shouldExecuteOnCPU([e])){var t=pS(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(ze().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,kA,e.dtype);var n=new mA(e.shape,kA);return this.compileAndRun(n,[e])}},{key:"floor",value:function(e){if(this.shouldExecuteOnCPU([e])){var t=gS(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(ze().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,wA,e.dtype);var n=new mA(e.shape,wA);return this.compileAndRun(n,[e])}},{key:"sign",value:function(e){var t=new mA(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])}},{key:"isNaN",value:function(e){var t=new mA(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")}},{key:"isInf",value:function(e){var t=new mA(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")}},{key:"isFinite",value:function(e){var t=new mA(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")}},{key:"round",value:function(e){var t=new mA(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])}},{key:"exp",value:function(e){if(this.shouldExecuteOnCPU([e])){var t=mS(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(ze().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,xA,e.dtype);var n=new mA(e.shape,xA);return this.compileAndRun(n,[e])}},{key:"expm1",value:function(e){if(this.shouldExecuteOnCPU([e])){var t=vS(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(ze().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,CA,e.dtype);var n=new mA(e.shape,CA);return this.compileAndRun(n,[e])}},{key:"softmax",value:function(e,t){var n=r.parseAxisParam([t],e.shape),a=Ko(e,n),i=v.expandShapeToKeepDim(a.shape,n),o=ja(e,a.reshape(i)),s=this.exp(o),u=this.sum(s,n).reshape(i);return wa(s,u)}},{key:"log",value:function(e){if(this.shouldExecuteOnCPU([e])){var t=yS(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}if(ze().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var n=new mA(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(n,[e])}},{key:"log1p",value:function(e){var t=new mA(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])}},{key:"sqrt",value:function(e){var t=new mA(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])}},{key:"rsqrt",value:function(e){if(this.shouldExecuteOnCPU([e])){var t=kS(this.texData.get(e.dataId).values,e.dtype);return this.makeOutput(e.shape,e.dtype,t)}var n=new mA(e.shape,"return inversesqrt(x);");return this.compileAndRun(n,[e])}},{key:"reciprocal",value:function(e){var t=new mA(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])}},{key:"relu",value:function(e){var t;return t=ze().getBool("WEBGL_PACK")?new RA(e.shape,AA):new mA(e.shape,gA),this.compileAndRun(t,[e])}},{key:"relu6",value:function(e){var t;return t=ze().getBool("WEBGL_PACK")?new RA(e.shape,EA):new mA(e.shape,yA),this.compileAndRun(t,[e])}},{key:"prelu",value:function(e,t){var n=ze().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ZS(YS,e.shape,t.shape):new QS(XS,e.shape,t.shape);return this.compileAndRun(n,[e,t])}},{key:"elu",value:function(e){if(ze().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,IA,e.dtype);var t=new mA(e.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(t,[e])}},{key:"eluDer",value:function(e,t){var n=ze().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ZS("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new QS("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])}},{key:"selu",value:function(e){var t=new mA(e.shape,_A);return this.compileAndRun(t,[e])}},{key:"clip",value:function(e,t,n){var r,a=(r=ze().getBool("WEBGL_PACK_CLIP")?new $S(e.shape):new JS(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=fS(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(ze().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,vA,e.dtype);var n=new mA(e.shape,vA);return this.compileAndRun(n,[e])}},{key:"complexAbs",value:function(e){var t=this.texData.get(e.dataId),n=new eT(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensorInfos.real),this.makeComplexComponentTensorInfo(e,t.complexTensorInfos.imag)];return this.compileAndRun(n,r)}},{key:"sigmoid",value:function(e){var t=new mA(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])}},{key:"softplus",value:function(e){var t=new mA(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])}},{key:"asin",value:function(e){var t=new mA(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(t,[e])}},{key:"acos",value:function(e){var t=new mA(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(t,[e])}},{key:"atan",value:function(e){var t=new mA(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(t,[e])}},{key:"sinh",value:function(e){var t=new mA(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])}},{key:"cosh",value:function(e){var t=new mA(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])}},{key:"tanh",value:function(e){var t=new mA(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])}},{key:"asinh",value:function(e){var t=new mA(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])}},{key:"acosh",value:function(e){var t=new mA(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(t,[e])}},{key:"atanh",value:function(e){var t=new mA(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(t,[e])}},{key:"erf",value:function(e){var t=new mA(e.shape,SA);return this.compileAndRun(t,[e])}},{key:"step",value:function(e,t){var n=new mA(e.shape,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"if (isnan(x)) return x;\n    return x > 0.0 ? 1.0 : float(".concat(e,");\n  ")}(t));return this.compileAndRun(n,[e])}},{key:"conv2dByMatMul",value:function(e,t,n,a,i,o){var s=e.shape,u=this.texData.get(e.dataId),c="channelsLast"===n.dataFormat,l=s[2]%2!=0&&!!u.isPacked;if((1==s[0]*s[1]*s[2]||1===n.outChannels)&&n.inChannels>1e3||!ze().getBool("WEBGL_LAZILY_UNPACK")||!ze().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!l){var h=fr(e,[1,c?s[0]*s[1]*s[2]:s[0]*s[2]*s[3],n.inChannels]),f=fr(t,[1,n.inChannels,n.outChannels]),d=this.fusedBatchMatMul({a:h,b:f,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:o});return fr(d,n.outShape)}var p={dataId:e.dataId,shape:[1,c?s[0]*s[1]*(s[2]+1):s[0]*s[2]*(s[3]+1),n.inChannels],dtype:e.dtype},m=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,r.assert(oS(u.shape,p.shape),(function(){return"packed reshape ".concat(u.shape," to ").concat(p.shape," isn't free")}));var v=fr(t,[1,n.inChannels,n.outChannels]),g=this.fusedBatchMatMul({a:p,b:v,transposeA:!1,transposeB:!1,bias:a,activation:i,preluActivationWeights:o}),y=this.texData.get(g.dataId);return r.assert(y.isPacked,(function(){return"batchMatMul result is expected to be packed"})),u.shape=m,y.shape=n.outShape,aa().makeTensorFromDataId(g.dataId,n.outShape,g.dtype)}},{key:"conv2dWithIm2Row",value:function(e,t,n,r,a,i){var o=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,h="channelsLast"===n.dataFormat,f=o*s*u,d=l*c,p=[f,d],m=e.squeeze([0]),v=t.reshape([1,f,-1]),g=new PT(p,m.shape,n),y=this.compileAndRun(g,[m]).reshape([1,p[0],p[1]]),_=null!=r,b=null!=i,k=a?zA(a,!0):null,w=new jT(y.shape,v.shape,[1,d,n.outChannels],!0,!1,_,k,b),x=[y,v];return r&&x.push(r),b&&x.push(i),this.compileAndRun(w,x).reshape(h?[1,l,c,n.outChannels]:[1,n.outChannels,l,c])}},{key:"fusedConv2d",value:function(e){var t=e.input,n=e.filter,r=e.convInfo,a=e.bias,i=e.activation,o=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,a,i,o);if(ze().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,a,i,o);var s=null!=a,u=null!=o,c=i?zA(i,!1):null,l=new sT(r,s,c,u),h=[t,n];return a&&h.push(a),o&&h.push(o),this.compileAndRun(l,h)}},{key:"conv2d",value:function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(ze().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new sT(n);return this.compileAndRun(r,[e,t])}},{key:"conv2dDerInput",value:function(e,t,n){var r=new nT(n);return this.compileAndRun(r,[e,t])}},{key:"conv2dDerFilter",value:function(e,t,n){var r=new tT(n);return this.compileAndRun(r,[e,t])}},{key:"fusedDepthwiseConv2D",value:function(e){var t,n=e.input,r=e.filter,a=e.convInfo,i=e.bias,o=e.activation,s=e.preluActivationWeights,u=ze().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,c=o?zA(o,u):null,l=[n,r],h=null!=i,f=null!=s;return h&&l.push(i),f&&l.push(s),u?(t=new lT(a,h,c,f),this.compileAndRun(t,l)):(t=new cT(a,h,c,f),this.compileAndRun(t,l))}},{key:"depthwiseConv2D",value:function(e,t,n){var r;return ze().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new lT(n),this.compileAndRun(r,[e,t])):(r=new cT(n),this.compileAndRun(r,[e,t]))}},{key:"depthwiseConv2DDerInput",value:function(e,t,n){var r=new oT(n);return this.compileAndRun(r,[e,t])}},{key:"depthwiseConv2DDerFilter",value:function(e,t,n){var r=new iT(n);return this.compileAndRun(r,[e,t])}},{key:"conv3d",value:function(e,t,n){var r=new uT(n);return this.compileAndRun(r,[e,t])}},{key:"conv3dDerInput",value:function(e,t,n){var r=new aT(n);return this.compileAndRun(r,[e,t])}},{key:"conv3dDerFilter",value:function(e,t,n){var r=new rT(n);return this.compileAndRun(r,[e,t])}},{key:"unstack",value:function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),a=0,i=0;i<e.rank;i++)i!==t&&(r[a++]=e.shape[i]);var o=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;for(var u=new Array(n),c=0;c<u.length;c++)o[t]=c,u[c]=this.slice(e,o,s).reshape(r);return u}},{key:"avgPool3d",value:function(e,t){var n=new KT(t,"avg",!1);return this.compileAndRun(n,[e],"float32")}},{key:"avgPool3dBackprop",value:function(e,t,n){var r=new KS(n);return this.compileAndRun(r,[e],t.dtype)}},{key:"maxPool3d",value:function(e,t){var n=new KT(t,"max",!1);return this.compileAndRun(n,[e],"float32")}},{key:"maxPool3dBackprop",value:function(e,t,n,r){var a=new KT(r,"max",!0),i=this.compileAndRun(a,[t]),o=new BT(r),s=this.compileAndRun(o,[e,i],t.dtype);return i.dispose(),s}},{key:"resizeBilinear",value:function(e,t,n,r){var a=ze().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new JT(e.shape,t,n,r):new ZT(e.shape,t,n,r);return this.compileAndRun(a,[e],"float32")}},{key:"resizeBilinearBackprop",value:function(e,t,n){var r=new YT(e,t,n);return this.compileAndRun(r,[e])}},{key:"resizeNearestNeighbor",value:function(e,t,n,r){var a=new eA(e.shape,t,n,r);return this.compileAndRun(a,[e])}},{key:"resizeNearestNeighborBackprop",value:function(e,t,n){var r=new $T(e,t,n);return this.compileAndRun(r,[e])}},{key:"multinomial",value:function(e,t,n,r){var a=t?e:ru(e),i=new VT(a.shape[0],a.shape[1],n),o=i.getCustomSetupFunc(r);return this.compileAndRun(i,[a],"int32",o)}},{key:"oneHot",value:function(e,t,n,r){var a=new qT(e.size,t,n,r);return this.compileAndRun(a,[e])}},{key:"diag",value:function(e){var t=new yT(e.size);return this.compileAndRun(t,[e])}},{key:"cropAndResize",value:function(e,t,n,r,a,i){var o=new hT(e.shape,t.shape,r,a,i);return this.compileAndRun(o,[e,t,n],"float32")}},{key:"depthToSpace",value:function(e,t,n){r.assert(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var a=e.shape[0],i=("NHWC"===n?e.shape[1]:e.shape[2])*t,o=("NHWC"===n?e.shape[2]:e.shape[3])*t,s=("NHWC"===n?e.shape[3]:e.shape[1])/(t*t),u=new gT("NHWC"===n?[a,i,o,s]:[a,s,i,o],t,n);return this.compileAndRun(u,[e])}},{key:"split",value:function(e,t,n){return DA(e,t,n)}},{key:"scatterND",value:function(e,t,n){var r=v.calculateShapes(t,e,n),a=r.sliceRank,i=r.numUpdates,o=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/o,o],l=e.reshape([i,a]),h=t.reshape([i,o]);if(0===u)return v.reshapeTensor(Xt([]),n);var f=Pa(0),d=new rA(i,a,l.rank,h.rank,s,c);return this.compileAndRun(d,[h,l,f]).reshape(n)}},{key:"sparseToDense",value:function(e,t,n,r){var a=v.calculateShapes(t,e,n),i=a.sliceRank,o=a.numUpdates,s=a.strides,u=a.outputSize,c=new rA(o,i,e.rank,t.rank,s,[u,1],!1);return this.compileAndRun(c,[t,e,r]).reshape(n)}},{key:"gatherND",value:function(e,t){var n=t.shape,r=n[n.length-1],a=_slicedToArray2(v.prepareAndValidate(e,t),4),i=a[0],o=a[1],s=a[2],u=a[3],c=t.reshape([o,r]),l=e.reshape([e.size/s,s]),h=new ST(r,u,[o,s]);return this.compileAndRun(h,[l,c]).reshape(i)}},{key:"fill",value:function(e,t,n){if("string"===(n=n||r.inferDtype(t))){var a=r.getArrayFromDType(n,r.sizeFromShape(e));return a.fill(t),aa().makeTensor(a,e,n,this)}var i=new xT(e,t),o=i.getCustomSetupFunc(t);return this.compileAndRun(i,[],n,o)}},{key:"onesLike",value:function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)}},{key:"zerosLike",value:function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)}},{key:"linspace",value:function(e,t,n){return v.linspaceImpl(e,t,n)}},{key:"makeTensorInfo",value:function(e,t,n){var r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){var r=this.makeTensorInfo(e,t,n).dataId;return aa().makeTensorFromDataId(r,e,t,this)}},{key:"unpackTensor",value:function(e){var t=new OA(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new UT(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[nS(e.shape)].concat(_toConsumableArray(rS(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[nS(t)].concat(_toConsumableArray(rS(t))),i=new QT(a,n),o=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}},{key:"decode",value:function(e){var t,n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype,o=aS(a);return t=r?new vT(o):new mT(o),{dtype:i,shape:a,dataId:this.runWebGLProgram(t,[{shape:o,dtype:i,dataId:e}],i,null,!0).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,a){var i=this,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===PC.DENSE){var c=VC(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===r.sizeFromShape(s.shape))return u.values=r.getTypedArrayFromDType(s.dtype,0),s;var l=[],h=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&r.sizeFromShape(t.shape)<=ze().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?i.unpackTensor(t):i.packTensor(t),l.push(t),n=i.texData.get(t.dataId);else if(n.isPacked&&!oS(n.shape,t.shape)){var a=t,o=t.shape;t.shape=n.shape,t=i.packedReshape(t,o),l.push(t),n=i.texData.get(t.dataId),a.shape=o}return i.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var f,d={shape:s.shape,texData:u,isUniform:!1},p=function(e,t,n){var r="";t.concat(n).forEach((function(e){r+="".concat(e.shape,"_").concat(e.isUniform?"uniform":e.texData.texShape,"_").concat(null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0)}));var a=e.constructor.name;return a+="_"+r+"_"+e.userCode}(e,h,d),m=this.getAndSaveBinary(p,(function(){return function(e,t,n,a){var i=t.userCode,o=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),s=o.map((function(e){return e.shapeInfo})),u={logicalShape:a.shape,texShape:a.texData.texShape,isUniform:!1,isPacked:a.texData.isPacked,flatOffset:null},c=function(e,t,n,a){var i=[];e.forEach((function(e){var t=r.sizeFromShape(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?i.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(i.push("uniform sampler2D ".concat(e.name,";")),i.push("uniform int offset".concat(e.name,";")))}));var o,s,u=i.join("\n"),c=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a="";return a+=n?function e(t){switch(t.shapeInfo.logicalShape.length){case 0:return n=t.name,"\n    vec4 ".concat("get"+n.charAt(0).toUpperCase()+n.slice(1),"() {\n      return ").concat(OS().texture2D,"(").concat(n,", halfCR);\n    }\n  ");case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=OS();return"\n    vec4 ".concat(n,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(a[0],", ").concat(a[1],", index);\n      return ").concat(i.texture2D,"(").concat(t,", uv);\n    }\n  ")}(t);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=OS();if(null!=i&&r.arraysEqual(t,i))return"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(n,", uv);\n      }\n    ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(Math.ceil(t[1]/2),", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(n,", uv);\n    }\n  ")}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=US(t,n.slice(1));return"\n        ".concat(e(s),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(WS(["b","row","col"],[1,2]),");\n        }\n      ")}var u=o[0],c=o[1],l=Math.ceil(n[2]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(u,", ").concat(c,", ").concat(l*Math.ceil(n[1]/2),", ").concat(l,", b, row, col);\n      return ").concat(OS().texture2D,"(").concat(r,", uv);\n    }\n  ")}(t);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=o[0],u=o[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),h="int b, int row, int col",f="b * ".concat(l," + (row / 2) * ").concat(c," + (col / 2)"),d=2;d<n-1;d++)h="int b".concat(d,", ")+h,l*=t[n-d-1],f="b".concat(d," * ").concat(l," + ")+f;return"\n    vec4 ".concat(a,"(").concat(h,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(s,");\n      return ").concat(OS().texture2D,"(").concat(r,", uv);\n    }\n  ")}(t)}var n}(e):function e(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");var r=_slicedToArray2(e.shapeInfo.texShape,2),a=r[0],i=r[1];if(1===a&&1===i)return"\n      float ".concat(n,"() {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=_slicedToArray2(e.shapeInfo.texShape,2),s=o[0],u=o[1];return"\n    float ".concat(n,"() {\n      vec2 uv = uvFromFlat(").concat(s,", ").concat(u,", ").concat(jS(t),");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(t);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(n,"(int index) {\n        ").concat(VS(e),"\n      }\n    ");var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===i&&1===a)return"\n      float ".concat(n,"(int index) {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=jS(t);return 1===i?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / ").concat(a,".0);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):1===a?"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / ").concat(i,".0, 0.5);\n        return sampleTexture(").concat(t,", uv);\n      }\n    "):"\n    float ".concat(n,"(int index) {\n      vec2 uv = uvFromFlat(").concat(a,", ").concat(i,", index + ").concat(o,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(t);case 2:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=t.shapeInfo.texShape;if(null!=o&&r.arraysEqual(n,o))return"\n    float ".concat(i,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o[1],".0, ").concat(o[0],".0);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ");var s=r.squeezeShape(n),u=s.newShape,c=s.keptDims;if(u.length<n.length){var l=US(t,u);return"\n      ".concat(e(l),"\n      float ").concat(i,"(int row, int col) {\n        return ").concat(i,"(").concat(WS(["row","col"],c),");\n      }\n    ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(VS(t),"\n      }\n    ");var h=o[0],f=o[1],d=jS(a);return 1===f?"\n    float ".concat(i,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(d,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(h,".0);\n      return sampleTexture(").concat(a,", uv);\n    }\n  "):1===h?"\n    float ".concat(i,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(d,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(f,".0, 0.5);\n      return sampleTexture(").concat(a,", uv);\n    }\n  "):"\n  float ".concat(i,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(d,";\n    vec2 uv = uvFromFlat(").concat(h,", ").concat(f,", index);\n    return sampleTexture(").concat(a,", uv);\n  }\n")}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n[1]*n[2],s=n[2],u=r.squeezeShape(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var h=US(t,c);return"\n        ".concat(e(h),"\n        float ").concat(i,"(int row, int col, int depth) {\n          return ").concat(i,"(").concat(WS(["row","col","depth"],l),");\n        }\n      ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(o,", ").concat(s,", 1)));\n        ").concat(VS(t),"\n      }\n    ");var f=t.shapeInfo.texShape,d=f[0],p=f[1],m=t.shapeInfo.flatOffset;return p===o&&null==m?"\n        float ".concat(i,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(s,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(p,".0, ").concat(d,".0);\n          return sampleTexture(").concat(a,", uv);\n        }\n      "):p===s&&null==m?"\n    float ".concat(i,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(p,".0, ").concat(d,".0);\n      return sampleTexture(").concat(a,", uv);\n    }\n  "):"\n      float ".concat(i,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(o," + col * ").concat(s," + depth + ").concat(jS(a),";\n        vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index);\n        return sampleTexture(").concat(a,", uv);\n      }\n  ")}(t);case 4:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n[3],s=n[2]*o,u=n[1]*s,c=r.squeezeShape(n),l=c.newShape,h=c.keptDims;if(l.length<n.length){var f=US(t,l);return"\n      ".concat(e(f),"\n      float ").concat(i,"(int row, int col, int depth, int depth2) {\n        return ").concat(i,"(").concat(WS(["row","col","depth","depth2"],h),");\n      }\n    ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(u,", ").concat(s,", ").concat(o,", 1)));\n        ").concat(VS(t),"\n      }\n    ");var d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,m=p[0],v=p[1];return v===u&&null==d?"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(s,", ").concat(o,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):v===o&&null==d?"\n      float ".concat(i,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(u," + col * ").concat(s," +\n          depth * ").concat(o," + depth2;\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index + ").concat(jS(a),");\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}(t);case 5:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=n[4],s=n[3]*o,u=n[2]*s,c=n[1]*u,l=r.squeezeShape(n),h=l.newShape,f=l.keptDims;if(h.length<n.length){var d=US(t,h);return"\n      ".concat(e(d),"\n      float ").concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(i,"(").concat(WS(["row","col","depth","depth2","depth3"],f),");\n      }\n    ")}if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(c,", ").concat(u,", ").concat(s,", ").concat(o,")) +\n          depth3;\n        ").concat(VS(t),"\n      }\n    ");var p=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,v=m[0],g=m[1];return g===c&&null==p?"\n      float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(u,", ").concat(s,", ").concat(o,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):g===o&&null==p?"\n      float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(n[1]*n[2]*n[3],",\n               ").concat(n[2]*n[3],", ").concat(n[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(c," + col * ").concat(u," + depth * ").concat(s," +\n          depth2 * ").concat(o," + depth3 + ").concat(jS(a),";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(g,", index);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}(t);case 6:return function(t){var n=t.shapeInfo.logicalShape,a=t.name,i="get"+a.charAt(0).toUpperCase()+a.slice(1),o=r.squeezeShape(n),s=o.newShape,u=o.keptDims;if(s.length<n.length){var c=US(t,s);return"\n      ".concat(e(c),"\n      float ").concat(i,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(i,"(").concat(WS(["row","col","depth","depth2","depth3","depth4"],u),");\n      }\n    ")}var l=n[5],h=n[4]*l,f=n[3]*h,d=n[2]*f,p=n[1]*d;if(t.shapeInfo.isUniform)return"\n      float ".concat(i,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(p,", ").concat(d,", ").concat(f,", ").concat(h,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(l,", 1)));\n        ").concat(VS(t),"\n      }\n    ");var m=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,g=v[0],y=v[1];return y===p&&null==m?"\n      float ".concat(i,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(d,", ").concat(f,", ").concat(h,", ").concat(l,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(y,".0, ").concat(g,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):y===l&&null==m?"\n      float ".concat(i,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(n[1]*n[2]*n[3]*n[4],",\n               ").concat(n[2]*n[3]*n[4],",\n               ").concat(n[3]*n[4],",\n               ").concat(n[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(y,".0, ").concat(g,".0);\n        return sampleTexture(").concat(a,", uv);\n      }\n    "):"\n    float ".concat(i,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(p," + col * ").concat(d," + depth * ").concat(f," +\n          depth2 * ").concat(h," + depth3 * ").concat(l," + depth4 + ").concat(jS(a),";\n      vec2 uv = uvFromFlat(").concat(g,", ").concat(y,", index);\n      return sampleTexture(").concat(a,", uv);\n    }\n  ")}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(e),e.shapeInfo.logicalShape.length<=t.logicalShape.length&&(a+=n?function(e,t){var n,a=e.name,i=a.charAt(0).toUpperCase()+a.slice(1),o="get"+i+"AtOutCoords",s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,c=FS(e.shapeInfo.logicalShape,t.logicalShape),l=qS(u),h=u-s,f=["x","y","z","w","u","v"];n=0===s?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords.".concat(f[e+h]," = 0;")})).join("\n");var d;d=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+f[t+h]})).join(", ");var p="return outputValue;",m=1===r.sizeFromShape(e.shapeInfo.logicalShape),v=1===r.sizeFromShape(t.logicalShape);if(1!==s||m||v){if(m&&!v)p=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var g=s-2,y=s-1;c.indexOf(g)>-1&&c.indexOf(y)>-1?p="return vec4(outputValue.x);":c.indexOf(g)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(y)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(o,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(i,"(").concat(d,");\n      ").concat(p,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,a=n.charAt(0).toUpperCase()+n.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===s&&null==e.shapeInfo.flatOffset&&r.arraysEqual(e.shapeInfo.texShape,t.texShape))return"\n      float ".concat(i,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var u,c=qS(s),l=FS(e.shapeInfo.logicalShape,t.logicalShape),h=s-o,f=["x","y","z","w","u","v"];u=0===o?"":s<2&&l.length>=1?"coords = 0;":l.map((function(e){return"coords.".concat(f[e+h]," = 0;")})).join("\n");var d;return d=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+f[t+h]})).join(", "),"\n    float ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(u,"\n      return get").concat(a,"(").concat(d,");\n    }\n  ")}(e,t)),a}(e,t,a)})).join("\n"),l=t.texShape,h=OS(),f=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(h),d=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(MS,"\n    ").concat(LS,"\n    ").concat(zS,"\n  ")}(h);return t.isPacked?(o=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return n=t,1===(a=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(a[1],".0);\n      }\n    "):1===a[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(a[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(a[0],", ").concat(a[1],"));\n      return 2 * (resTexRC.x * ").concat(a[1]," + resTexRC.y);\n    }\n  ");case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(r.arraysEqual(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(n[0],", ").concat(n[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),a=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t);default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),i=a,o="",s="b, r, c",u=2;u<e.length-1;u++)i*=e[e.length-u-1],o="\n      int b".concat(u," = index / ").concat(i,";\n      index -= b").concat(u," * ").concat(i,";\n    ")+o,s="b".concat(u,", ")+s;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      ").concat(o,"\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec").concat(e.length,"(").concat(s,");\n    }\n  ")}(e,t)}var n,a}(t.logicalShape,l),s=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(h)):(o=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(n=t)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(n[1],".0);\n      }\n    "):1===n[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(n[0],".0);\n      }\n    "):"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      return resTexRC.x * ").concat(n[1]," + resTexRC.y;\n    }\n  ");case 2:return function(e,t){return r.arraysEqual(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=NS(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t);case 4:return function(e,t){var n=NS(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t);case 5:return function(e,t){var n=NS(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=NS(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n}(t.logicalShape,l),s=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(h)),a&&(d+=BS),[d,f,s,u,o,c,n].join("\n")}(o,u,i,t.packedInputs),l=e.createProgram(c),h=null,f=e.getUniformLocation(l,"NAN",!1);1===ze().getNumber("WEBGL_VERSION")&&(h=e.getUniformLocation(l,"INFINITY",!1));for(var d={},p=0;p<t.variableNames.length;p++){var m=t.variableNames[p];d[m]=e.getUniformLocation(l,m,!1),d["offset"+m]=e.getUniformLocation(l,"offset"+m,!1)}return{program:t,source:c,webGLProgram:l,uniformLocations:d,inShapeInfos:s,outShapeInfo:u,infLoc:h,nanLoc:f}}(i.gpgpu,e,h,d)})),v=null!=this.activeTimers;if(v&&(f=this.startTimer()),function(e,t,n,a,i){DT(t.inShapeInfos,n),DT([t.outShapeInfo],[a]);var o=a.texData.texture,s=a.texData.texShape;a.texData.isPacked?e.setOutputPackedMatrixTexture(o,s[0],s[1]):e.setOutputMatrixTexture(o,s[0],s[1]),e.setProgram(t.webGLProgram),1===ze().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,a){var i=t.program.variableNames[a],o=t.uniformLocations[i],s=t.uniformLocations["offset"+i];if(null!=o)if(n.isUniform)if(r.sizeFromShape(n.shape)<2)e.gl.uniform1f(o,n.uniformValues[0]);else{var u=n.uniformValues;u instanceof Float32Array||(u=new Float32Array(u)),e.gl.uniform1fv(o,u)}else null!=n.texData.slice&&null!=s&&e.gl.uniform1i(s,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,o,a)})),null!=i&&i(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,m,h,d,a),l.forEach((function(e){return i.disposeIntermediateTensorInfo(e)})),v&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)})),!ze().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===o){var g=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),g}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=this.runWebGLProgram(e,t,n=n||t[0].dtype,r,a);return aa().makeTensorFromDataId(i.dataId,i.shape,i.dtype)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;this.disposed||(ze().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=sa((function(){if(!ze().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=ze().getBool("DEBUG");ze().set("DEBUG",!1);var n=e.abs(Pa(1e-8)).dataSync()[0];if(ze().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,a=t.dtype,i=t.values,o=t.texture,s=t.usage,u=t.isPacked;if(null==o){var c,l=null!=this.activeTimers;l&&(c=r.now());var h=t.texShape;if(null==h&&(h=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=ze().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map((function(t,n){return n>=e.length-2?r.nearestLargerEven(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var a=r.squeezeShape(e);e=a.newShape}var i=r.sizeFromShape(e);if(e.length<=1&&i<=n)return[1,i];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){var o,s=nS(e),u=2,c=2;return e.length&&(u=(o=_slicedToArray2(rS(e),2))[0],c=o[1]),i=s*(u/2)*(c/2),r.sizeToSquarishShape(i).map((function(e){return 2*e}))}return r.sizeToSquarishShape(i)}(n,u),t.texShape=h),null!=i){var f,d,p=aS(n),m=h[1],v=h[0],g=i instanceof Uint8Array;u?(m=(f=_slicedToArray2(qC(h[0],h[1]),2))[0],v=f[1],d=new wT(p,[v,m],g)):d=new kT(p,[v,m],g);var y=this.makeTensorInfo([v,m],a);this.texData.get(y.dataId).usage=g?FC.PIXELS:FC.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),m,v,i);var _=this.runWebGLProgram(d,[y],a,null,!0),b=this.texData.get(_.dataId);t.texture=b.texture,t.texShape=b.texShape,t.isPacked=b.isPacked,t.usage=b.usage,this.disposeIntermediateTensorInfo(y),this.texData.delete(_.dataId),t.values=null,l&&(this.uploadWaitMs+=r.now()-c)}else{var k=this.acquireTexture(h,s,a,u);t.texture=k}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*r.bytesPerElement(t)}},{key:"tryRunOnCpuOrThrow",value:function(e,t){if(this.shouldExecuteOnCPU(e))try{return t()}catch(n){if(ze().getBool("IS_TEST"))throw new Error("CPU forwarding failed")}return null}}]),o}(W);function jA(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}i.isBrowser()&&ga("webgl",(function(){return new BA}),2);var VA={kernelName:"Identity",backendName:"webgl",kernelFunc:jA};function qA(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=jA({inputs:{x:r},backend:n});n.texData.get(s.dataId).complexParentRefCount++;var u=jA({inputs:{x:a},backend:n});return n.texData.get(u.dataId).complexParentRefCount++,o.complexTensorInfos={real:s,imag:u},i}var UA={kernelName:"Complex",backendName:"webgl",kernelFunc:qA};function WA(e){return function(t){var n=t.inputs,r=t.backend,a=n.x,i=r,o=new mA(a.shape,e);return i.runWebGLProgram(o,[a],a.dtype)}}function GA(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,l=r.b,h=i;if(o&&"complex64"===c.dtype){var f=h.texData.get(c.dataId),d=h.texData.get(l.dataId),p=[[f.complexTensorInfos.real,d.complexTensorInfos.real],[f.complexTensorInfos.imag,d.complexTensorInfos.imag]].map((function(e){var n=_slicedToArray2(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:l.shape},s=new QS(t,c.shape,l.shape);return h.runWebGLProgram(s,[i,o],At(r.dtype,a.dtype))})),m=_slicedToArray2(p,2),v=m[0],g=m[1],y=qA({inputs:{real:v,imag:g},backend:h});return h.disposeIntermediateTensorInfo(v),h.disposeIntermediateTensorInfo(g),y}var _,b=u||At(c.dtype,l.dtype);if(h.shouldExecuteOnCPU([c,l])&&null!=s){var k=h.texData.get(c.dataId),w=h.texData.get(l.dataId),x=_slicedToArray2(s(c.shape,l.shape,k.values,w.values,b),2),C=x[0],S=x[1],T=h.makeTensorInfo(S,b);return h.texData.get(T.dataId).values=C,T}return _=ze().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new ZS(n,c.shape,l.shape,a):new QS(t,c.shape,l.shape),h.runWebGLProgram(_,[c,l],b)}}var HA="return a + b;",KA={kernelName:"Add",backendName:"webgl",kernelFunc:GA({opSnippet:HA,packedOpSnippet:HA,supportsComplex:!0,cpuKernelImpl:dS})},XA={kernelName:"Atan2",backendName:"webgl",kernelFunc:GA({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})},QA={kernelName:"AvgPool",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x;lS(i,"avgPool");var o=a.filterSize,s=a.strides,u=a.pad,c=a.dimRoundingMode;r.assert(v.eitherStridesOrDilationsAreOne(s,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var l=v.computePool2DInfo(i.shape,o,s,1,u,c);if(1===l.filterWidth&&1===l.filterHeight&&r.arraysEqual(l.inShape,l.outShape))return jA({inputs:{x:i},backend:n});var h=new HT(l,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}},YA={kernelName:"AvgPoolBackprop",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;lS([a,i],"avgPoolBackprop");var s=r.filterSize,u=r.strides,c=r.pad,l=v.computePool2DInfo(o.shape,s,u,1,c),h=new HS(l);return n.runWebGLProgram(h,[a],o.dtype)}},ZA=function e(t,n,r,a,i,o){_classCallCheck2(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],v.assertAndGetBroadcastShape(t,n),v.assertAndGetBroadcastShape(t,r);var s="0.0";null!=a&&(v.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(v.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")},JA=function e(t,n,r,a,i,o){_classCallCheck2(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],v.assertAndGetBroadcastShape(t,n),v.assertAndGetBroadcastShape(t,r);var s="vec4(0.0)";null!=a&&(v.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(v.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")},$A={kernelName:"FusedBatchNorm",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=t.mean,s=t.variance,u=t.offset,c=t.scale;r.assert(o.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),r.assert(null==u||o.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),r.assert(null==c||o.shape.length===c.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var l=a.varianceEpsilon;null==l&&(l=.001);var h=[i,o,s],f=null;null!=u&&(f=u.shape,h.push(u));var d=null;null!=c&&(d=c.shape,h.push(c));var p=ze().getBool("WEBGL_PACK_NORMALIZATION")?new JA(i.shape,o.shape,s.shape,f,d,l):new ZA(i.shape,o.shape,s.shape,f,d,l);return n.runWebGLProgram(p,h,h[0].dtype)}},eE=GA({opSnippet:"return float(a != b);",dtype:"bool"}),tE={kernelName:"NotEqual",backendName:"webgl",kernelFunc:eE};function nE(e){var t=e.inputs,n=e.backend,r=t.input;return jA({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var rE={kernelName:"Real",backendName:"webgl",kernelFunc:nE},aE={kernelName:"Cast",backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,a=t.backend,i=t.attrs,o=n.x,s=i.dtype;if("complex64"===s){if("complex64"===o.dtype)return jA({inputs:{x:o},backend:a});var u=as(o.shape),c=e({inputs:{x:o},backend:a,attrs:{dtype:"float32"}}),l=qA({inputs:{real:c,imag:u},backend:a});return u.dispose(),a.disposeIntermediateTensorInfo(c),l}if("complex64"===o.dtype){var h=nE({inputs:{input:o},backend:a}),f=e({inputs:{x:h},backend:a,attrs:{dtype:s}});return a.disposeIntermediateTensorInfo(h),f}if(!r.hasEncodingLoss(o.dtype,s)){var d=jA({inputs:{x:o},backend:a});return{dataId:d.dataId,shape:d.shape,dtype:s}}if("int32"===s)return function(e,t){var n=new mA(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(o,a);if("bool"===s){var p=a.makeTensorInfo([],"bool",r.getTypedArrayFromDType("bool",1)),m=eE({inputs:{a:o,b:p},backend:a});return a.disposeIntermediateTensorInfo(p),m}throw new Error("Error in Cast: failed to cast ".concat(o.dtype," to ").concat(s))}},iE=function e(t){_classCallCheck2(this,e),this.outputShape=[],this.outputShape=v.computeOutShape(t,1),this.variableNames=t.map((function(e,t){return"T"+t}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++)a.push("else if (yC < ".concat(n[i],") setOutput(getT").concat(i,"(yR, yC-").concat(n[i-1],"));"));a.push("else setOutput(getT".concat(n.length,"(yR, yC-").concat(n[n.length-1],"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")},oE=function e(t,n){_classCallCheck2(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=v.computeOutShape(t,n);var r=this.outputShape,a=r.length,i=qS(a),o=RS("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T"+t}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],h=s.slice(-2),f=s.join(),d="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(f,"), vec2(").concat(h.join(),"));\n        }"),p=1;p<u.length;p++){var m=u[p-1];d+="\n        if (".concat(l," < ").concat(u[p],"  && ").concat(l," >= ").concat(u[p-1],") {\n          return getChannel(\n            getT").concat(p,"(").concat(sE(s,l,m),"),\n            vec2(").concat(sE(h,l,m),"));\n        }")}var g=u[u.length-1];d+="\n        return getChannel(\n          getT".concat(u.length,"(").concat(sE(s,l,g),"),\n          vec2(").concat(sE(h,l,g),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(d,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")};function sE(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function uE(e){var t=e.inputs,n=e.backend,r=t.input;return jA({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var cE={kernelName:"Imag",backendName:"webgl",kernelFunc:uE};function lE(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x,o=a.shape,s=n,u=r.sizeFromShape(i.shape),c=r.inferFromImplicitShape(o,u),l=r.sizeFromShape(c);r.assert(u===l,(function(){return"The new shape (".concat(c,") has ").concat(l," elements and the old shape (").concat(i.shape,") has ").concat(u," elements. The new shape and old shape must have the same number of elements.")}));var h=s.texData.get(i.dataId);return!h.isPacked||oS(i.shape,c)||null!==h.texture&&oS(h.shape,c)?(s.incRef(i.dataId),{dataId:i.dataId,shape:c,dtype:i.dtype}):function(e,t,n){var r=[nS(e.shape)].concat(_toConsumableArray(rS(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[nS(t)].concat(_toConsumableArray(rS(t))),o=new QT(i,r),s=n.runWebGLProgram(o,[a],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}(i,c,s)}var hE={kernelName:"Reshape",backendName:"webgl",kernelFunc:lE},fE={kernelName:"Concat",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs.axis,i=r.parseAxisParam(a,t[0].shape)[0],o=v.computeOutShape(t.map((function(e){return e.shape})),i);if(0===r.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);var s=t.filter((function(e){return r.sizeFromShape(e.shape)>0}));if(1===s.length)return s[0];var u=s.map((function(e){return e.shape}));return v.assertParamsConsistent(u,i),function e(t,n,a){var i=t[0].dtype;if("complex64"===i){var o=t.map((function(e){return nE({inputs:{input:e},backend:a})})),s=t.map((function(e){return uE({inputs:{input:e},backend:a})})),u=e(o,n,a),c=e(s,n,a),l=qA({inputs:{real:u,imag:c},backend:a});return o.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),s.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),a.disposeIntermediateTensorInfo(u),a.disposeIntermediateTensorInfo(c),l}if(t.length>ze().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var h=Math.floor(t.length/2),f=e(t.slice(0,h),n,a),d=e(t.slice(h),n,a),p=e([f,d],n,a);return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(d),p}if(ze().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){var m=new oE(t.map((function(e){return e.shape})),n);return a.runWebGLProgram(m,t,i)}var g=v.computeOutShape(t.map((function(e){return e.shape})),n),y=t.map((function(e){return lE({inputs:{x:e},attrs:{shape:[-1,r.sizeFromShape(e.shape.slice(n))]},backend:a})})),_=new iE(y.map((function(e){return e.shape}))),b=a.runWebGLProgram(_,y,i);y.forEach((function(e){return a.disposeIntermediateTensorInfo(e)}));var k=lE({inputs:{x:b},attrs:{shape:g},backend:a});return a.disposeIntermediateTensorInfo(b),k}(s,i,n)}},dE=WA("if (isnan(x)) return x;\n  return cos(x);\n"),pE={kernelName:Ue,backendName:"webgl",kernelFunc:dE},mE=GA({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),vE={kernelName:We,backendName:"webgl",kernelFunc:mE},gE=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,s=r?a+".0":"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")};function yE(e,t,n){var a=n.texData.get(e.dataId),i=r.sizeFromShape(e.shape),o=e.shape[e.shape.length-1],s=lE({inputs:{x:e},backend:n,attrs:{shape:[i/o,o]}}).shape,u=new gE("real",s,t),c=new gE("imag",s,t),l=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s}],h=n.runWebGLProgram(u,l,"float32"),f=n.runWebGLProgram(c,l,"float32"),d=qA({inputs:{real:h,imag:f},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f);var p=lE({inputs:{x:d},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(p),p}var _E,bE={kernelName:"FFT",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return yE(t.input,!1,n)}},kE=function e(t){_classCallCheck2(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},wE={kernelName:"FlipLeftRight",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new kE(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},xE=function e(t){_classCallCheck2(this,e),this.variableNames=["A"];var n=OS(),r=_slicedToArray2(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")},CE=function e(t){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=OS(),r=_slicedToArray2(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")},SE={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,u=_slicedToArray2(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),c=u[0],l=u[1],h=[l,c],f=[l,c,i];(s||o)&&(null==_E&&(_E=document.createElement("canvas").getContext("2d")),_E.canvas.width=c,_E.canvas.height=l,_E.drawImage(a,0,0,c,l),a=_E.canvas);var d=n.makeTensorInfo(h,"int32");n.texData.get(d.dataId).usage=FC.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),a);var p=ze().getBool("WEBGL_PACK")?new CE(f):new xE(f),m=n.runWebGLProgram(p,[d],"int32");return n.disposeData(d.dataId),m}},TE={kernelName:"IFFT",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return yE(t.input,!0,n)}},AE=function e(t,n){_classCallCheck2(this,e),this.variableNames=["x"];var a=t.windowSize,i=t.batchSize,o=t.inSize,s=t.outSize;this.outputShape=[i,s];var u=4*Math.floor(a/4),c=a%4,l="sumValue += dot(values, ones);";if(null!=n){var h=1/n;l="sumValue += dot(values * ".concat(r.isInt(h)?h.toPrecision(2):h,", ones);")}var f="";o%a>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(f,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(a,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(l,"\n        }\n        setOutput(sumValue);\n      }\n    ")};function EE(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=v.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u,c=a[o],l=c.inSize,h=c.windowSize,f=c.outSize;s="mean"===n?0===o?new AE({windowSize:h,inSize:l,batchSize:e.shape[0],outSize:f},l):new AE({windowSize:h,inSize:l,batchSize:e.shape[0],outSize:f}):new XT({windowSize:h,inSize:l,batchSize:e.shape[0],outSize:f},n),u=i,i=r.runWebGLProgram(s,[i],t),u.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(u)}return i}var IE=function e(t,n){_classCallCheck2(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=qS(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")},RE=function e(t,n){_classCallCheck2(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=qS(this.rank),o=IS("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),h="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(h,";\n      if(").concat(l,") {\n        result[1] = ").concat(h,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(h,";\n        if(").concat(l,") {\n          result[3] = ").concat(h,";\n        }\n      }\n      setOutput(result);\n    }\n    ")};function OE(e,t,n){var r=ze().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RE(e.shape,t):new IE(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}for(var NE={kernelName:"Max",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,a=e.backend,i=t.x,o=n.reductionIndices,s=n.keepDims,u=a,c=i.shape.length,l=r.parseAxisParam(o,i.shape),h=l,f=v.getAxesPermutation(h,c),d=null!=f,p=u.shouldExecuteOnCPU([i]),m=i;if(d){if(p){for(var g=u.texData.get(m.dataId).values,y=new Array(c),_=0;_<y.length;_++)y[_]=i.shape[f[_]];var b=CS(g,i.shape,i.dtype,f,y);m=u.makeTensorInfo(y,i.dtype),u.texData.get(m.dataId).values=b}else m=OE(i,f,u);h=v.getInnerMostAxes(h.length,c)}v.assertAxesAreInnerMostDims("max",h,c);var k,w=_slicedToArray2(v.computeOutAndReduceShapes(m.shape,h),2),x=w[0],C=w[1],S=x;if(s&&(S=v.expandShapeToKeepDim(x,l)),p){var T=u.texData.get(m.dataId),A=_S(T.values,r.sizeFromShape(C),S,i.dtype);k=u.makeTensorInfo(S,i.dtype),u.texData.get(k.dataId).values=A}else k=function(e,t,n,a){var i=r.sizeFromShape(t),o=lE({inputs:{x:e},attrs:{shape:[r.sizeFromShape(e.shape)/i,i]},backend:a}),s=EE(o,e.dtype,"max",a),u=lE({inputs:{x:s},attrs:{shape:n},backend:a});return a.disposeIntermediateTensorInfo(o),a.disposeIntermediateTensorInfo(s),u}(m,C,S,u);return d&&u.disposeIntermediateTensorInfo(m),k}},DE={kernelName:"MaxPool",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,a=e.attrs,i=t.x;lS(i,"maxPool");var o=a.filterSize,s=a.strides,u=a.pad,c=a.dimRoundingMode;r.assert(v.eitherStridesOrDilationsAreOne(s,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '1'")}));var l=v.computePool2DInfo(i.shape,o,s,1,u,c);if(1===l.filterWidth&&1===l.filterHeight&&r.arraysEqual(l.inShape,l.outShape))return jA({inputs:{x:i},backend:n});var h=new HT(l,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}},PE={kernelName:"MaxPoolBackprop",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;lS([i,t.output],"maxPoolBackprop");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=v.computePool2DInfo(o.shape,s,u,1,c,l),f=new HT(h,"max",!0),d=n.runWebGLProgram(f,[o],o.dtype),p=new zT(h),m=n.runWebGLProgram(p,[a,d],o.dtype);return n.disposeIntermediateTensorInfo(d),m}},FE={kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,a=e.backend,i=t.x,o=n.filterSize,s=n.strides,u=n.pad,c=n.includeBatchInIndex,l=a;r.assert(4===i.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(i.shape.length,".")}));var h=[1,1];r.assert(v.eitherStridesOrDilationsAreOne(s,h),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '").concat(h,"'")}));var f=v.computePool2DInfo(i.shape,o,s,h,u),d=_slicedToArray2(function(e,t,n,r){var a=new HT(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new HT(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(i,c,f,l),2);return[d[0],d[1]]}},ME={kernelName:"Mean",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,a=e.backend,i=t.x,o=n.keepDims,s=n.axis,u=a,c=i.shape.length,l=r.parseAxisParam(s,i.shape),h=l,f=v.getAxesPermutation(h,c),d=null!=f,p=u.shouldExecuteOnCPU([i]),m=[],g=i;if(d){if(p){for(var y=u.texData.get(g.dataId).values,_=new Array(c),b=0;b<_.length;b++)_[b]=i.shape[f[b]];var k=CS(y,i.shape,i.dtype,f,_);g=u.makeTensorInfo(_,i.dtype),u.texData.get(g.dataId).values=k}else g=OE(i,f,u);m.push(g),h=v.getInnerMostAxes(h.length,c)}v.assertAxesAreInnerMostDims("sum",h,c);var w=_slicedToArray2(v.computeOutAndReduceShapes(g.shape,h),2),x=w[0],C=w[1],S=x;o&&(S=v.expandShapeToKeepDim(x,l));for(var T=function(e,t,n,a){var i=r.sizeFromShape(t),o=lE({inputs:{x:e},attrs:{shape:[r.sizeFromShape(e.shape)/i,i]},backend:a}),s=EE(o,"float32","mean",a),u=lE({inputs:{x:s},attrs:{shape:n},backend:a});return a.disposeIntermediateTensorInfo(o),a.disposeIntermediateTensorInfo(s),u}(g,C,S,u),A=0,E=m;A<E.length;A++){var I=E[A];u.disposeIntermediateTensorInfo(I)}return T}},LE=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=qS(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")},zE=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=qS(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=RS("rc",a),c=RS("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),f="reflect"===r?0:1,d="";if(1===a){var p="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(f,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(f,";\n        }\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(p,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(p,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(f,") +\n                gte * ((end - 1) * 2 - source + ").concat(f,");\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")},BE={kernelName:"MirrorPad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=ze().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zE(a.shape,i,o):new LE(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},jE=function e(t,n,r){_classCallCheck2(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=v.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")},VE="return a * b;",qE={kernelName:"Multiply",backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=v.upcastType(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new jE("return areal * breal - aimag * bimag;",a.shape,i.shape),l=new jE("return areal * bimag + aimag * breal;",a.shape,i.shape),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],f=r.runWebGLProgram(c,h,"float32"),d=r.runWebGLProgram(l,h,"float32"),p=qA({inputs:{real:f,imag:d},backend:r});return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),p}if(r.shouldExecuteOnCPU([a,i])){var m=r.texData.get(a.dataId),g=r.texData.get(i.dataId),y=_slicedToArray2(bS(a.shape,i.shape,m.values,g.values,o),2),_=y[0],b=y[1],k=r.makeTensorInfo(b,o);return r.texData.get(k.dataId).values=_,k}return t=ze().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ZS(VE,a.shape,i.shape):new QS(VE,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}},UE={kernelName:"NonMaxSuppressionV3",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;v.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n,l=c.readSync(a.dataId),h=c.readSync(i.dataId);return g.nonMaxSuppressionV3Impl(l,h,o,s,u)}},WE=g.nonMaxSuppressionV4Impl,GE={kernelName:"NonMaxSuppressionV4",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;v.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n,h=l.readSync(a.dataId),f=l.readSync(i.dataId),d=WE(h,f,o,s,u,c);return[d.selectedIndices,d.validOutputs]}},HE=g.nonMaxSuppressionV5Impl,KE={kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;v.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n,h=l.readSync(a.dataId),f=l.readSync(i.dataId),d=HE(h,f,o,s,u,c);return[d.selectedIndices,d.selectedScores]}},XE=function e(t,n,r,a){_classCallCheck2(this,e),this.variableNames=["Image"],this.outputShape=[];var i=t[1],o=t[2],s=Math.sin(n).toFixed(3),u=Math.cos(n).toFixed(3);this.outputShape=t;var c,l=_slicedToArray2(v.getImageCenter(a,i,o),2),h=l[0],f=l[1],d=h.toFixed(3),p=f.toFixed(3);c="number"==typeof r?"float outputValue = ".concat(r.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(r.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - ".concat(d,") * ").concat(u," - (float(y) - ").concat(p,") * ").concat(s,";\n          float coordYFloat = (float(x) - ").concat(d,") * ").concat(s," + (float(y) - ").concat(p,") * ").concat(u,";\n          int coordX = int(round(coordXFloat + ").concat(d,"));\n          int coordY = int(round(coordYFloat + ").concat(p,"));\n          ").concat(c,"\n          if(coordX >= 0 && coordX < ").concat(o," && coordY >= 0 && coordY < ").concat(i,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")},QE={kernelName:"RotateWithOffset",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new XE(a.shape,i,o,s);return u.runWebGLProgram(c,[a],a.dtype)}},YE=WA("if (isnan(x)) return x;\n  return sin(x);\n"),ZE={kernelName:Ge,backendName:"webgl",kernelFunc:YE},JE={kernelName:"Square",backendName:"webgl",kernelFunc:WA("return x * x;")},$E={kernelName:"SquaredDifference",backendName:"webgl",kernelFunc:GA({opSnippet:"return (a - b) * (a - b);",packedOpSnippet:"return (a - b) * (a - b);"})},eI="return a - b;",tI=GA({opSnippet:eI,packedOpSnippet:eI,supportsComplex:!0,cpuKernelImpl:xS}),nI={kernelName:He,backendName:"webgl",kernelFunc:tI},rI=WA("return tan(x);"),aI=0,iI=[KA,XA,QA,YA,$A,aE,UA,fE,pE,vE,bE,wE,SE,VA,TE,cE,NE,DE,PE,FE,ME,BE,qE,UE,GE,KE,tE,rE,hE,QE,ZE,JE,nI,$E,{kernelName:Ke,backendName:"webgl",kernelFunc:rI},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(e){for(var t,n=e.inputs,r=e.attrs,a=e.backend,i=n.x,o=r.perm,s=a,u=new Array(i.shape.length),c=0;c<u.length;c++)u[c]=i.shape[o[c]];if(s.shouldExecuteOnCPU([i])){var l=s.texData.get(i.dataId),h=CS(l.values,i.shape,i.dtype,o,u);t=s.makeTensorInfo(u,i.dtype),s.texData.get(t.dataId).values=h}else t=OE(i,o,s);return t}},{kernelName:"Unique",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;lS(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=SS(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}}];aI<iI.length;aI++){$e(iI[aI])}n.d(t,"version",(function(){return oI})),n.d(t,"AdadeltaOptimizer",(function(){return Ma})),n.d(t,"AdagradOptimizer",(function(){return za})),n.d(t,"AdamOptimizer",(function(){return Va})),n.d(t,"AdamaxOptimizer",(function(){return Ka})),n.d(t,"MomentumOptimizer",(function(){return Qa})),n.d(t,"Optimizer",(function(){return Fa})),n.d(t,"RMSPropOptimizer",(function(){return Ya})),n.d(t,"SGDOptimizer",(function(){return Xa})),n.d(t,"Tensor",(function(){return _t})),n.d(t,"TensorBuffer",(function(){return vt})),n.d(t,"Variable",(function(){return St})),n.d(t,"Rank",(function(){return bt})),n.d(t,"sumOutType",(function(){return Et})),n.d(t,"upcastType",(function(){return At})),n.d(t,"Reduction",(function(){return Pc})),n.d(t,"customGrad",(function(){return Na})),n.d(t,"grad",(function(){return Aa})),n.d(t,"grads",(function(){return Ea})),n.d(t,"valueAndGrad",(function(){return Ia})),n.d(t,"valueAndGrads",(function(){return Ra})),n.d(t,"variableGrads",(function(){return Oa})),n.d(t,"Environment",(function(){return Le})),n.d(t,"env",(function(){return ze})),n.d(t,"ENV",(function(){return je})),n.d(t,"version_core",(function(){return"2.7.0"})),n.d(t,"nextFrame",(function(){return nl})),n.d(t,"browser",(function(){return u})),n.d(t,"io",(function(){return o})),n.d(t,"math",(function(){return s})),n.d(t,"serialization",(function(){return f})),n.d(t,"test_util",(function(){return d})),n.d(t,"util",(function(){return r})),n.d(t,"backend_util",(function(){return v})),n.d(t,"tensor_util",(function(){return a})),n.d(t,"slice_util",(function(){return h})),n.d(t,"gather_util",(function(){return c})),n.d(t,"scatter_util",(function(){return l})),n.d(t,"device_util",(function(){return i})),n.d(t,"kernel_impls",(function(){return g})),n.d(t,"KernelBackend",(function(){return W})),n.d(t,"DataStorage",(function(){return U})),n.d(t,"abs",(function(){return qa})),n.d(t,"acos",(function(){return Za})),n.d(t,"acosh",(function(){return Ja})),n.d(t,"add",(function(){return ba})),n.d(t,"addN",(function(){return $a})),n.d(t,"all",(function(){return ui})),n.d(t,"any",(function(){return ci})),n.d(t,"argMax",(function(){return li})),n.d(t,"argMin",(function(){return hi})),n.d(t,"asin",(function(){return fi})),n.d(t,"asinh",(function(){return di})),n.d(t,"atan",(function(){return pi})),n.d(t,"atan2",(function(){return mi})),n.d(t,"atanh",(function(){return vi})),n.d(t,"avgPool",(function(){return Ri})),n.d(t,"avgPool3d",(function(){return Oi})),n.d(t,"basicLSTMCell",(function(){return zi})),n.d(t,"batchToSpaceND",(function(){return Bi})),n.d(t,"batchNorm",(function(){return Vi})),n.d(t,"batchNorm2d",(function(){return qi})),n.d(t,"batchNorm3d",(function(){return Ui})),n.d(t,"batchNorm4d",(function(){return Wi})),n.d(t,"broadcastTo",(function(){return Gi})),n.d(t,"buffer",(function(){return qn})),n.d(t,"cast",(function(){return Un})),n.d(t,"ceil",(function(){return Hi})),n.d(t,"clipByValue",(function(){return Ki})),n.d(t,"clone",(function(){return Wn})),n.d(t,"complex",(function(){return Ht})),n.d(t,"concat",(function(){return Pi})),n.d(t,"concat1d",(function(){return Xi})),n.d(t,"concat2d",(function(){return Qi})),n.d(t,"concat3d",(function(){return Yi})),n.d(t,"concat4d",(function(){return Zi})),n.d(t,"conv1d",(function(){return $i})),n.d(t,"conv2d",(function(){return Ji})),n.d(t,"conv2dTranspose",(function(){return to})),n.d(t,"conv3d",(function(){return no})),n.d(t,"conv3dTranspose",(function(){return ao})),n.d(t,"cos",(function(){return io})),n.d(t,"cosh",(function(){return oo})),n.d(t,"cumsum",(function(){return so})),n.d(t,"depthToSpace",(function(){return uo})),n.d(t,"depthwiseConv2d",(function(){return co})),n.d(t,"diag",(function(){return lo})),n.d(t,"dilation2d",(function(){return ho})),n.d(t,"div",(function(){return wa})),n.d(t,"divNoNan",(function(){return mo})),n.d(t,"dot",(function(){return vo})),n.d(t,"elu",(function(){return go})),n.d(t,"equal",(function(){return fo})),n.d(t,"erf",(function(){return yo})),n.d(t,"exp",(function(){return _o})),n.d(t,"expandDims",(function(){return bo})),n.d(t,"expm1",(function(){return ko})),n.d(t,"eye",(function(){return xo})),n.d(t,"fill",(function(){return La})),n.d(t,"floor",(function(){return Co})),n.d(t,"floorDiv",(function(){return ka})),n.d(t,"gather",(function(){return Ro})),n.d(t,"greater",(function(){return Oo})),n.d(t,"greaterEqual",(function(){return No})),n.d(t,"imag",(function(){return Do})),n.d(t,"isFinite",(function(){return Po})),n.d(t,"isInf",(function(){return Fo})),n.d(t,"isNaN",(function(){return Mo})),n.d(t,"leakyRelu",(function(){return Lo})),n.d(t,"less",(function(){return zo})),n.d(t,"lessEqual",(function(){return Bo})),n.d(t,"linspace",(function(){return jo})),n.d(t,"localResponseNormalization",(function(){return Vo})),n.d(t,"log",(function(){return qo})),n.d(t,"log1p",(function(){return Uo})),n.d(t,"logSigmoid",(function(){return Ho})),n.d(t,"logSoftmax",(function(){return Qo})),n.d(t,"logSumExp",(function(){return Yo})),n.d(t,"logicalAnd",(function(){return Zo})),n.d(t,"logicalNot",(function(){return Jo})),n.d(t,"logicalOr",(function(){return $o})),n.d(t,"logicalXor",(function(){return es})),n.d(t,"matMul",(function(){return dr})),n.d(t,"max",(function(){return Ko})),n.d(t,"maxPool",(function(){return ts})),n.d(t,"maxPool3d",(function(){return ns})),n.d(t,"maxPoolWithArgmax",(function(){return rs})),n.d(t,"maximum",(function(){return Ha})),n.d(t,"mean",(function(){return os})),n.d(t,"min",(function(){return ss})),n.d(t,"minimum",(function(){return us})),n.d(t,"mirrorPad",(function(){return cs})),n.d(t,"mod",(function(){return ls})),n.d(t,"moments",(function(){return hs})),n.d(t,"mul",(function(){return xa})),n.d(t,"multiRNNCell",(function(){return fs})),n.d(t,"multinomial",(function(){return ds})),n.d(t,"neg",(function(){return Wo})),n.d(t,"notEqual",(function(){return ps})),n.d(t,"oneHot",(function(){return pr})),n.d(t,"ones",(function(){return is})),n.d(t,"onesLike",(function(){return vs})),n.d(t,"outerProduct",(function(){return gs})),n.d(t,"pad",(function(){return ys})),n.d(t,"pad1d",(function(){return _s})),n.d(t,"pad2d",(function(){return bs})),n.d(t,"pad3d",(function(){return ks})),n.d(t,"pad4d",(function(){return ws})),n.d(t,"pool",(function(){return Cs})),n.d(t,"pow",(function(){return Ba})),n.d(t,"prelu",(function(){return Ss})),n.d(t,"print",(function(){return Gn})),n.d(t,"prod",(function(){return Ts})),n.d(t,"rand",(function(){return As})),n.d(t,"randomGamma",(function(){return Ns})),n.d(t,"randomNormal",(function(){return Ds})),n.d(t,"randomUniform",(function(){return Ps})),n.d(t,"range",(function(){return Ms})),n.d(t,"real",(function(){return ms})),n.d(t,"reciprocal",(function(){return Ls})),n.d(t,"relu",(function(){return zs})),n.d(t,"relu6",(function(){return Bs})),n.d(t,"reshape",(function(){return fr})),n.d(t,"reverse",(function(){return js})),n.d(t,"reverse1d",(function(){return Vs})),n.d(t,"reverse2d",(function(){return qs})),n.d(t,"reverse3d",(function(){return Us})),n.d(t,"reverse4d",(function(){return Ws})),n.d(t,"round",(function(){return Gs})),n.d(t,"rsqrt",(function(){return Hs})),n.d(t,"scalar",(function(){return Pa})),n.d(t,"selu",(function(){return Ks})),n.d(t,"separableConv2d",(function(){return Xs})),n.d(t,"setdiff1dAsync",(function(){return Qs})),n.d(t,"sigmoid",(function(){return Fi})),n.d(t,"sign",(function(){return Ys})),n.d(t,"sin",(function(){return Zs})),n.d(t,"sinh",(function(){return Js})),n.d(t,"slice",(function(){return Mi})),n.d(t,"slice1d",(function(){return $s})),n.d(t,"slice2d",(function(){return eu})),n.d(t,"slice3d",(function(){return tu})),n.d(t,"slice4d",(function(){return nu})),n.d(t,"softmax",(function(){return ru})),n.d(t,"softplus",(function(){return Go})),n.d(t,"spaceToBatchND",(function(){return xs})),n.d(t,"fft",(function(){return au})),n.d(t,"ifft",(function(){return iu})),n.d(t,"irfft",(function(){return ou})),n.d(t,"rfft",(function(){return cu})),n.d(t,"split",(function(){return uu})),n.d(t,"sqrt",(function(){return Ca})),n.d(t,"square",(function(){return Sa})),n.d(t,"squaredDifference",(function(){return lu})),n.d(t,"squeeze",(function(){return hu})),n.d(t,"stack",(function(){return fu})),n.d(t,"step",(function(){return du})),n.d(t,"stridedSlice",(function(){return pu})),n.d(t,"sub",(function(){return ja})),n.d(t,"sum",(function(){return Xo})),n.d(t,"tan",(function(){return mu})),n.d(t,"tanh",(function(){return Li})),n.d(t,"tensor",(function(){return Xt})),n.d(t,"tensor1d",(function(){return Fs})),n.d(t,"tensor2d",(function(){return vu})),n.d(t,"tensor3d",(function(){return gr})),n.d(t,"tensor4d",(function(){return gu})),n.d(t,"tensor5d",(function(){return yu})),n.d(t,"tensor6d",(function(){return _u})),n.d(t,"tile",(function(){return wo})),n.d(t,"topk",(function(){return bu})),n.d(t,"truncatedNormal",(function(){return ku})),n.d(t,"unique",(function(){return wu})),n.d(t,"unsortedSegmentSum",(function(){return xu})),n.d(t,"unstack",(function(){return Cu})),n.d(t,"variable",(function(){return Su})),n.d(t,"where",(function(){return po})),n.d(t,"whereAsync",(function(){return Au})),n.d(t,"zeros",(function(){return as})),n.d(t,"zerosLike",(function(){return Ta})),n.d(t,"op",(function(){return Gt})),n.d(t,"OP_SCOPE_SUFFIX",(function(){return"__op"})),n.d(t,"image",(function(){return Yc})),n.d(t,"linalg",(function(){return Zc})),n.d(t,"losses",(function(){return Jc})),n.d(t,"spectral",(function(){return Xc})),n.d(t,"fused",(function(){return m})),n.d(t,"signal",(function(){return Qc})),n.d(t,"train",(function(){return el})),n.d(t,"enableProdMode",(function(){return $r})),n.d(t,"enableDebugMode",(function(){return ea})),n.d(t,"disableDeprecationWarnings",(function(){return ta})),n.d(t,"deprecationWarn",(function(){return na})),n.d(t,"disposeVariables",(function(){return ra})),n.d(t,"engine",(function(){return aa})),n.d(t,"memory",(function(){return ia})),n.d(t,"profile",(function(){return oa})),n.d(t,"tidy",(function(){return sa})),n.d(t,"dispose",(function(){return ua})),n.d(t,"keep",(function(){return ca})),n.d(t,"time",(function(){return la})),n.d(t,"setBackend",(function(){return ha})),n.d(t,"ready",(function(){return fa})),n.d(t,"getBackend",(function(){return da})),n.d(t,"removeBackend",(function(){return pa})),n.d(t,"findBackend",(function(){return ma})),n.d(t,"findBackendFactory",(function(){return va})),n.d(t,"registerBackend",(function(){return ga})),n.d(t,"backend",(function(){return ya})),n.d(t,"setPlatform",(function(){return _a})),n.d(t,"getKernel",(function(){return Ye})),n.d(t,"getGradient",(function(){return Ze})),n.d(t,"getKernelsForBackend",(function(){return Je})),n.d(t,"registerKernel",(function(){return $e})),n.d(t,"registerGradient",(function(){return et})),n.d(t,"unregisterKernel",(function(){return tt})),n.d(t,"unregisterGradient",(function(){return nt})),n.d(t,"copyRegisteredKernels",(function(){return rt})),n.d(t,"Abs",(function(){return"Abs"})),n.d(t,"Acos",(function(){return"Acos"})),n.d(t,"Acosh",(function(){return"Acosh"})),n.d(t,"Add",(function(){return"Add"})),n.d(t,"AddN",(function(){return"AddN"})),n.d(t,"All",(function(){return"All"})),n.d(t,"Any",(function(){return"Any"})),n.d(t,"ArgMax",(function(){return"ArgMax"})),n.d(t,"ArgMin",(function(){return"ArgMin"})),n.d(t,"Asin",(function(){return"Asin"})),n.d(t,"Asinh",(function(){return"Asinh"})),n.d(t,"Atan",(function(){return"Atan"})),n.d(t,"Atanh",(function(){return"Atanh"})),n.d(t,"Atan2",(function(){return"Atan2"})),n.d(t,"AvgPool",(function(){return"AvgPool"})),n.d(t,"AvgPoolBackprop",(function(){return"AvgPoolBackprop"})),n.d(t,"AvgPool3D",(function(){return"AvgPool3D"})),n.d(t,"AvgPool3DBackprop",(function(){return"AvgPool3DBackprop"})),n.d(t,"BatchMatMul",(function(){return"BatchMatMul"})),n.d(t,"BatchToSpaceND",(function(){return"BatchToSpaceND"})),n.d(t,"BroadcastTo",(function(){return"BroadcastTo"})),n.d(t,"Cast",(function(){return"Cast"})),n.d(t,"Ceil",(function(){return"Ceil"})),n.d(t,"ClipByValue",(function(){return"ClipByValue"})),n.d(t,"Complex",(function(){return"Complex"})),n.d(t,"Concat",(function(){return"Concat"})),n.d(t,"Conv2D",(function(){return"Conv2D"})),n.d(t,"Conv2DBackpropFilter",(function(){return"Conv2DBackpropFilter"})),n.d(t,"Conv2DBackpropInput",(function(){return"Conv2DBackpropInput"})),n.d(t,"Conv3D",(function(){return"Conv3D"})),n.d(t,"Conv3DBackpropFilterV2",(function(){return"Conv3DBackpropFilterV2"})),n.d(t,"Conv3DBackpropInputV2",(function(){return"Conv3DBackpropInputV2"})),n.d(t,"Cos",(function(){return Ue})),n.d(t,"Cosh",(function(){return"Cosh"})),n.d(t,"Cumsum",(function(){return"Cumsum"})),n.d(t,"CropAndResize",(function(){return"CropAndResize"})),n.d(t,"DepthToSpace",(function(){return"DepthToSpace"})),n.d(t,"DepthwiseConv2dNative",(function(){return"DepthwiseConv2dNative"})),n.d(t,"DepthwiseConv2dNativeBackpropFilter",(function(){return"DepthwiseConv2dNativeBackpropFilter"})),n.d(t,"DepthwiseConv2dNativeBackpropInput",(function(){return"DepthwiseConv2dNativeBackpropInput"})),n.d(t,"Diag",(function(){return"Diag"})),n.d(t,"Dilation2D",(function(){return"Dilation2D"})),n.d(t,"Dilation2DBackpropInput",(function(){return"Dilation2DBackpropInput"})),n.d(t,"Dilation2DBackpropFilter",(function(){return"Dilation2DBackpropFilter"})),n.d(t,"Div",(function(){return We})),n.d(t,"Elu",(function(){return"Elu"})),n.d(t,"EluGrad",(function(){return"EluGrad"})),n.d(t,"Erf",(function(){return"Erf"})),n.d(t,"Equal",(function(){return"Equal"})),n.d(t,"Exp",(function(){return"Exp"})),n.d(t,"Expm1",(function(){return"Expm1"})),n.d(t,"FFT",(function(){return"FFT"})),n.d(t,"Fill",(function(){return"Fill"})),n.d(t,"FlipLeftRight",(function(){return"FlipLeftRight"})),n.d(t,"Floor",(function(){return"Floor"})),n.d(t,"FloorDiv",(function(){return"FloorDiv"})),n.d(t,"FusedBatchNorm",(function(){return"FusedBatchNorm"})),n.d(t,"GatherV2",(function(){return"GatherV2"})),n.d(t,"GatherNd",(function(){return"GatherNd"})),n.d(t,"Greater",(function(){return"Greater"})),n.d(t,"GreaterEqual",(function(){return"GreaterEqual"})),n.d(t,"Identity",(function(){return"Identity"})),n.d(t,"IFFT",(function(){return"IFFT"})),n.d(t,"Imag",(function(){return"Imag"})),n.d(t,"IsFinite",(function(){return"IsFinite"})),n.d(t,"IsInf",(function(){return"IsInf"})),n.d(t,"IsNan",(function(){return"IsNan"})),n.d(t,"Less",(function(){return"Less"})),n.d(t,"LessEqual",(function(){return"LessEqual"})),n.d(t,"LinSpace",(function(){return"LinSpace"})),n.d(t,"Log",(function(){return"Log"})),n.d(t,"Log1p",(function(){return"Log1p"})),n.d(t,"LogicalAnd",(function(){return"LogicalAnd"})),n.d(t,"LogicalNot",(function(){return"LogicalNot"})),n.d(t,"LogicalOr",(function(){return"LogicalOr"})),n.d(t,"LogSoftmax",(function(){return"LogSoftmax"})),n.d(t,"LRN",(function(){return"LRN"})),n.d(t,"LRNBackprop",(function(){return"LRNBackprop"})),n.d(t,"Max",(function(){return"Max"})),n.d(t,"Maximum",(function(){return"Maximum"})),n.d(t,"MaxPool",(function(){return"MaxPool"})),n.d(t,"MaxPoolBackprop",(function(){return"MaxPoolBackprop"})),n.d(t,"MaxPool3D",(function(){return"MaxPool3D"})),n.d(t,"MaxPool3DBackprop",(function(){return"MaxPool3DBackprop"})),n.d(t,"MaxPoolWithArgmax",(function(){return"MaxPoolWithArgmax"})),n.d(t,"Mean",(function(){return"Mean"})),n.d(t,"Min",(function(){return"Min"})),n.d(t,"Minimum",(function(){return"Minimum"})),n.d(t,"MirrorPad",(function(){return"MirrorPad"})),n.d(t,"Mod",(function(){return"Mod"})),n.d(t,"Multiply",(function(){return"Multiply"})),n.d(t,"Negate",(function(){return"Negate"})),n.d(t,"NotEqual",(function(){return"NotEqual"})),n.d(t,"NonMaxSuppressionV3",(function(){return"NonMaxSuppressionV3"})),n.d(t,"NonMaxSuppressionV4",(function(){return"NonMaxSuppressionV4"})),n.d(t,"NonMaxSuppressionV5",(function(){return"NonMaxSuppressionV5"})),n.d(t,"OnesLike",(function(){return"OnesLike"})),n.d(t,"OneHot",(function(){return"OneHot"})),n.d(t,"PadV2",(function(){return"PadV2"})),n.d(t,"Pool",(function(){return"Pool"})),n.d(t,"Pow",(function(){return"Pow"})),n.d(t,"Prelu",(function(){return"Prelu"})),n.d(t,"Prod",(function(){return"Prod"})),n.d(t,"Range",(function(){return"Range"})),n.d(t,"Real",(function(){return"Real"})),n.d(t,"Reciprocal",(function(){return"Reciprocal"})),n.d(t,"Relu",(function(){return"Relu"})),n.d(t,"Reshape",(function(){return"Reshape"})),n.d(t,"ResizeNearestNeighbor",(function(){return"ResizeNearestNeighbor"})),n.d(t,"ResizeNearestNeighborGrad",(function(){return"ResizeNearestNeighborGrad"})),n.d(t,"ResizeBilinear",(function(){return"ResizeBilinear"})),n.d(t,"ResizeBilinearGrad",(function(){return"ResizeBilinearGrad"})),n.d(t,"Relu6",(function(){return"Relu6"})),n.d(t,"Reverse",(function(){return"Reverse"})),n.d(t,"Round",(function(){return"Round"})),n.d(t,"Rsqrt",(function(){return"Rsqrt"})),n.d(t,"ScatterNd",(function(){return"ScatterNd"})),n.d(t,"SelectV2",(function(){return"SelectV2"})),n.d(t,"Selu",(function(){return"Selu"})),n.d(t,"Slice",(function(){return"Slice"})),n.d(t,"Sin",(function(){return Ge})),n.d(t,"Sinh",(function(){return"Sinh"})),n.d(t,"Sign",(function(){return"Sign"})),n.d(t,"Sigmoid",(function(){return"Sigmoid"})),n.d(t,"Softplus",(function(){return"Softplus"})),n.d(t,"Sqrt",(function(){return"Sqrt"})),n.d(t,"Sum",(function(){return"Sum"})),n.d(t,"SpaceToBatchND",(function(){return"SpaceToBatchND"})),n.d(t,"SplitV",(function(){return"SplitV"})),n.d(t,"Softmax",(function(){return"Softmax"})),n.d(t,"SquaredDifference",(function(){return"SquaredDifference"})),n.d(t,"Square",(function(){return"Square"})),n.d(t,"Sub",(function(){return He})),n.d(t,"SparseToDense",(function(){return"SparseToDense"})),n.d(t,"StridedSlice",(function(){return"StridedSlice"})),n.d(t,"Tan",(function(){return Ke})),n.d(t,"Tanh",(function(){return"Tanh"})),n.d(t,"Tile",(function(){return"Tile"})),n.d(t,"TopK",(function(){return"TopK"})),n.d(t,"Transpose",(function(){return"Transpose"})),n.d(t,"Unique",(function(){return"Unique"})),n.d(t,"Unpack",(function(){return"Unpack"})),n.d(t,"UnsortedSegmentSum",(function(){return"UnsortedSegmentSum"})),n.d(t,"ZerosLike",(function(){return"ZerosLike"})),n.d(t,"Step",(function(){return"Step"})),n.d(t,"FromPixels",(function(){return"FromPixels"})),n.d(t,"RotateWithOffset",(function(){return"RotateWithOffset"})),n.d(t,"_FusedMatMul",(function(){return"_FusedMatMul"})),n.d(t,"FusedConv2D",(function(){return"FusedConv2D"})),n.d(t,"FusedDepthwiseConv2D",(function(){return"FusedDepthwiseConv2D"})),n.d(t,"booleanMaskAsync",(function(){return Eu})),n.d(t,"equalStrict",(function(){return Iu})),n.d(t,"greaterEqualStrict",(function(){return Ru})),n.d(t,"greaterStrict",(function(){return Ou})),n.d(t,"lessEqualStrict",(function(){return Nu})),n.d(t,"lessStrict",(function(){return Du})),n.d(t,"notEqualStrict",(function(){return Pu})),n.d(t,"addStrict",(function(){return Fu})),n.d(t,"divStrict",(function(){return Mu})),n.d(t,"maximumStrict",(function(){return Lu})),n.d(t,"minimumStrict",(function(){return zu})),n.d(t,"modStrict",(function(){return Bu})),n.d(t,"mulStrict",(function(){return ju})),n.d(t,"powStrict",(function(){return Vu})),n.d(t,"squaredDifferenceStrict",(function(){return qu})),n.d(t,"subStrict",(function(){return Uu})),n.d(t,"transpose",(function(){return mr})),n.d(t,"norm",(function(){return Wu})),n.d(t,"movingAverage",(function(){return Gu})),n.d(t,"scatterND",(function(){return Hu})),n.d(t,"sparseToDense",(function(){return Ku})),n.d(t,"gatherND",(function(){return Xu})),n.d(t,"dropout",(function(){return Qu})),n.d(t,"enclosingPowerOfTwo",(function(){return Yu})),n.d(t,"cosineWindow",(function(){return Zu})),n.d(t,"inTopKAsync",(function(){return Ju})),n.d(t,"CallbackList",(function(){return mp})),n.d(t,"CustomCallback",(function(){return yp})),n.d(t,"History",(function(){return gp})),n.d(t,"Callback",(function(){return l_})),n.d(t,"callbacks",(function(){return v_})),n.d(t,"EarlyStopping",(function(){return m_})),n.d(t,"InputSpec",(function(){return rp})),n.d(t,"SymbolicTensor",(function(){return ap})),n.d(t,"LayersModel",(function(){return bm})),n.d(t,"input",(function(){return Em})),n.d(t,"loadLayersModel",(function(){return Am})),n.d(t,"model",(function(){return Sm})),n.d(t,"registerCallbackConstructor",(function(){return Im})),n.d(t,"sequential",(function(){return Tm})),n.d(t,"RNN",(function(){return Sv})),n.d(t,"Sequential",(function(){return Cm})),n.d(t,"LayerVariable",(function(){return $d})),n.d(t,"version_layers",(function(){return"2.7.0"})),n.d(t,"constraints",(function(){return y})),n.d(t,"initializers",(function(){return _})),n.d(t,"layers",(function(){return b})),n.d(t,"metrics",(function(){return k})),n.d(t,"models",(function(){return w})),n.d(t,"regularizers",(function(){return x})),n.d(t,"GraphModel",(function(){return Cb})),n.d(t,"loadGraphModel",(function(){return Sb})),n.d(t,"deregisterOp",(function(){return b_})),n.d(t,"registerOp",(function(){return y_})),n.d(t,"version_converter",(function(){return"2.7.0"})),n.d(t,"data",(function(){return V}));var oI={"tfjs-core":"2.7.0","tfjs-backend-cpu":"2.7.0","tfjs-backend-webgl":"2.7.0","tfjs-data":Dk,"tfjs-layers":"2.7.0","tfjs-converter":"2.7.0",tfjs:"2.7.0"}},zn8P:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="zn8P"}},[[0,0]]]);